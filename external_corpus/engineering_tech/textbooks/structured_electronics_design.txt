Structured Electronics Design - A conceptual approach to amplifier design - 3rd ed.

Anton J.M. Montagne
Structured Electronics Design

A conceptual approach to amplifier design
Structured Electronics Design

A conceptual approach to amplifier design

  basic design theory
  design of application-specific amplifiers

       in CMOS , Bipolar and BiCMOS technology
       in PCA technology
  using SLiCAP (python) and Spice
  summary of background knowledge

Anton J.M. Montagne
IV

© Delft Academic Press / VSSD
1st edition 2018
2nd edition 2021
© TUDelft Open 2023
3rd edition
ISBN 978-94-6366-712-8 (Ebook)
ISBN 978-94-6366-711-1 (Paperback)
DOI: https://doi.org/10.59490/t.2023.005
This work is licensed under a
https://creativecommons.org/licenses/by/4.0/

Keywords: electronics, design
                                                                                  V

    Scientific theories deal with concepts, never with reality. All theoretical
results are derived from certain axioms by deductive logic. In physical sci-
ences the theories are so formulated as to correspond in some useful sense
to the real world, whatever that may mean. However, this correspondence
is approximate, and the physical justification of all theoretical conclusions is
based on some form of inductive reasoning.

A. Papoulis [Papoulis1965]1                                                       1 Athanasios Papoulis. Probability Random
                                                                                  Variables and Stochastic Processes. McGraw-
                                                                                  Hill, New York, 1965

                             To Ernst Nordholt
                                                             VII

Contents

1 Introduction                                           1

1.1 Electronics                                          2

1.1.1 Analog Electronics                                 2

1.1.2 Structured design                                  3

1.1.3 This chapter                                       3

1.2 Selected topics from systems engineering             3

1.2.1 Basic concepts                                     4

1.2.2 Basic design process                               7

1.2.3 Design data and documents                          10

1.3 Electronic information processing                    10

1.3.1 Basic concepts                                     11

1.3.2 Limitations of information processing              12

1.4 Structured Electronics Design                        13

1.4.1 Outline of the design language                     13

1.4.2 Basic functions and basic objects                  14

1.4.3 Performance, costs, and FOM                        16

1.4.4 Error-reduction techniques                         16

1.4.5 Differences with traditional analog design         17

1.5 This book                                            18

1.5.1 What you will know after studying this book        18

1.5.2 Part 1: design of application-specific amplifiers  21

1.5.3 Part 2: background knowledge                       28

1.5.4 How to use this book                               29

I Design of application-specific amplifiers              31

2 Modeling and specification of amplifiers               33

2.1 Introduction to amplifier design                     35

2.1.1 Functionality                                      35

2.1.2 Definition                                         35

2.1.3 Information-processing quality                     36

2.1.4 Physical appearance                                36

2.1.5 Cost factors and environmental conditions          37

2.1.6 Figure of merit                                    37

2.1.7 This chapter                                       37

2.2 Amplifier port requirements                          38

2.2.1 Amplifier types                                    40

2.2.2 Ground                                             41

2.2.3 Port configurations                                41

2.2.4 Summing and distributing signals                   43

2.3 Modeling of the ideal behavior                       44

2.3.1 Transmission matrix-1 representation               44

2.3.2 Source-to-load transfer                            45

2.3.3 Input and output impedance                         46

2.3.4 Available power gain                               48

2.3.5 Idealized amplifier models                         50
VIII

      2.4 Modeling of the non-ideal behavior                       52

         2.4.1 Modeling of the source and load isolation           53

         2.4.2 Modeling of the power supply isolation              54

         2.4.3 Modeling of the noise behavior                      56

         2.4.4 Modeling of the power efficiency                    65

         2.4.5 Power losses and amplifier classes                  67

         2.4.6 Modeling of the small-signal dynamic behavior       69

         2.4.7 Modeling of the static nonlinear behavior           71

         2.4.8 Modeling of the dynamic nonlinear dynamic behavior  75

         2.4.9 Modeling of temperature effects                     77

         2.4.10 Ageing                                             77

      2.5 Cascaded Amplifiers                                      77

         2.5.1 Port isolation                                      78

         2.5.2 Noise behavior                                      79

         2.5.3 Small-signal dynamic behavior                       80

         2.5.4 Static nonlinear behavior                           80

      2.6 Amplifier requirement specification                      80

         2.6.1 Operational requirements                            80

         2.6.2 Requirements from other life cycle processes        83

      3  Amplification Mechanism                                   85

      3.1 Introduction                                             86

         3.1.1 Active devices                                      86

         3.1.2 This chapter                                        86

      3.2 Two-terminal resistive elements                          86

         3.2.1 Voltage-controlled and current-controlled notation  87

         3.2.2 Resistive two-terminal elements                     87

         3.2.3 Complementary devices                               88

         3.2.4 Operating point                                     88

         3.2.5 Linearization and available power gain              90

      3.3 Multi-terminal resistive elements                        91

         3.3.1 Complementary multi-terminal elements               91

         3.3.2 Resistive two-ports                                 91

         3.3.3 Complementary two-ports                             91

         3.3.4 Operating point                                     91

         3.3.5 Linearization and available power gain              92

      3.4 Introduction to biasing                                  93

         3.4.1 Independent and dependent bias sources              93

         3.4.2 Biasing of 3-terminal elements                      94

         3.4.3 Amplification mechanism                             94

         3.4.4 Deriving the bias sources from the power supply     95

      3.5 Conclusions                                              96

         3.5.1 Generalized biased active device                    96

      4 Active Devices                                             97

      4.1 Introduction                                             98

         4.1.1 Design equations and symbolic circuit analysis      98

         4.1.2 Numeric circuit analysis                            99

         4.1.3 Simulation accuracy                                 99

         4.1.4 This chapter                                        100

      4.2 Bipolar transistors                                      100

         4.2.1 Operation                                           100

         4.2.2 Gummel-Poon model                                   101

         4.2.3 Device parameters                                   106

         4.2.4 Simulated device characteristics                    106

         4.2.5 Other models                                        112

         4.2.6 Simplified models for hand calculations             112
                                                                    IX

4.3 Junction Field Effect Transistors                          115

4.3.1 JFET simulation model                                    115

4.3.2 Device parameters                                        119

4.3.3 JFET simulated device characteristics                    119

4.3.4 Simplified models for hand calculation                   121

4.4 MOS transistors                                            123

4.4.1 Operation                                                124

4.4.2 MOSFET modeling                                          125

4.4.3 MOSFET level 1 model                                     126

4.4.4 Device parameters                                        130

4.4.5 Simplified models for hand calculations                  132

4.4.6 Capacitance models                                       135

4.4.7 MOS EKV Model                                            137

4.5 SLiCAP device models                                       146

4.5.1 Signal path and biasing                                  147

4.5.2 SLiCAP parametric small-signal models                    147

4.5.3 BJT forward region, no saturation                        147

4.5.4 NMOS EKV forward region, saturation range                148

4.5.5 NMOS EKV forward region, linear and saturation range     151

4.5.6 SLiCAP MOS device characteristics                        153

4.5.7 PMOS EKV models                                          154

4.6 Conclusions                                                155

5 Basic amplification: CS stage                                159

5.1 Introduction                                               160

5.1.1 The CS stage                                             160

5.1.2 This chapter                                             160

5.2 The intrinsic CS stage                                     160

5.2.1 Instantaneous behavior                                   163

5.2.2 Small-signal dynamic behavior                            166

5.2.3 Large-signal dynamic behavior                            170

5.2.4 Noise behavior                                           172

5.3 Small-signal behavior of CS stage between source and load  176

5.3.1 Transimpedance                                           177

5.3.2 Current gain                                             177

5.3.3 Qualitative description of the dynamic behavior          178

5.3.4 Quantitative description of the dynamic behavior         178

5.3.5 Input impedance                                          182

5.3.6 Influence of the gate series resistance                  184

5.4 Optimization of the noise performance of a CS stage        184

5.4.1 Noise design considerations                              185

5.4.2 Noise minimization for resistive source                  185

5.4.3 Noise minimization for capacitive voltage source         195

5.4.4 Noise minimization for capacitive current source         200

5.5 Conclusions                                                204

6 Balancing techniques                                         205

6.1 Introduction                                               206

6.1.1 Additive compensation                                    206

6.1.2 Balancing                                                206

6.1.3 Multiplicative or cascaded compensation                  207

6.1.4 Odd function synthesis                                   207

6.1.5 This chapter                                             208

6.2 Balancing of two-terminal devices                          208

6.2.1 Anti-series and complementary-series connection          209

6.2.2 Anti-parallel and complementary-parallel connection      213
X

   6.3 Balancing of two-ports                                    216

      6.3.1 Balanced two-port configurations                     216

      6.3.2 Design of complementary two-ports                    217

   6.4 Balanced CE and CS stages                                 218

      6.4.1 Anti-series stages                                   218

      6.4.2 Anti-series CS stage                                 220

      6.4.3 Complementary-parallel stages                        223

      6.4.4 Complementary-parallel CS stage                      224

   6.5 Conclusions                                               228

   7 Design of feedback amplifier configurations                 229

   7.1 Introduction                                              231

      7.1.1 Design tasks                                         231

      7.1.2 Brute force port impedance design                    231

      7.1.3 Negative feedback amplifiers                         233

      7.1.4 This chapter                                         233

   7.2 Design of feedback configurations                         234

      7.2.1 Step-by-step design of the feedback configuration    234

      7.2.2 Direct sensing and comparison techniques             237

      7.2.3 Indirect sensing and comparison techniques           239

   7.3 Implementation of negative feedback                       239

      7.3.1 Feedback networks                                    240

      7.3.2 Ideal gain of a feedback amplifier                   240

      7.3.3 Negative and positive feedback                       241

   7.4 Nonenergic feedback                                       241

      7.4.1 Design of nonenergic amplifier configurations        242

      7.4.2 Noise behavior of nonenergic feedback amplifiers     243

      7.4.3 Power efficiency of nonenergic feedback amplifiers   243

   7.5 Passive feedback                                          243

      7.5.1 Single-loop passive feedback configurations          244

      7.5.2 Noise behavior of passive feedback configurations    245

      7.5.3 Power efficiency of passive feedback configurations  255

      7.5.4 Dual-loop passive feedback configurations            256

   7.6 Active feedback                                           257

      7.6.1 Single-loop active feedback                          257

      7.6.2 Multiple-loop active feedback                        258

   7.7 Design of balanced amplifiers                             259

      7.7.1 Anti-series connected amplifiers                     259

      7.7.2 Balanced single-loop configurations                  260

      7.7.3 Common-mode behavior of balanced amplifiers          261

      7.7.4 Design of natural two-ports                          266

      7.7.5 Dual-loop balanced passive feedback amplifiers       267

      7.7.6 Design of common-mode port impedances                269

   7.8 Indirect feedback                                         269

      7.8.1 Indirect sensing                                     270

      7.8.2 Indirect comparison                                  270

   8  Application and specification of operational amplifiers    271

   8.1 Introduction                                              272

      8.1.1 Operational Amplifier types                          272

      8.1.2 Idealized models                                     273

      8.1.3 This chapter                                         274

   8.2 Characterization of operational amplifiers                274

      8.2.1 Commonly used terms                                  275

      8.2.2 Terminal voltages and currents                       275

      8.2.3 Static nonlinear behavior                            276
                                                                        XI

8.2.4 Noise and small-signal dynamic behavior             276

8.2.5 Large-signal dynamic behavior                       277

8.3 Modeling of the operational amplifier                 277

8.3.1 Small-signal dynamic behavior                       278

8.3.2 Noise behavior                                      282

8.3.3 PSRR and CMRR                                       284

8.3.4 Bias and offset quantities                          284

8.3.5 Modeling of other effects                           285

8.3.6 Macro models                                        285

8.4 Design of feedback configurations with Op-Amps        286

8.4.1 Single-loop passive feedback configurations         286

8.4.2 Active feedback amplifier configurations            288

9 Introduction to amplifier biasing                       291

9.1 Introduction                                          292

9.1.1 This chapter                                        293

9.2 Basic techniques                                      293

9.2.1 Basic biasing technique                             293

9.2.2 DC coupling and AC coupling                         294

9.2.3 Deriving bias quantities from the power supply      295

9.3 Evaluation of biasing errors                          298

9.3.1 Power supply and resistor tolerances                299

9.3.2 Controller bias imperfections                       305

9.3.3 Total biasing error                                 307

9.3.4 Biasing design limits and budgets                   308

9.4 Application of error reduction techniques             309

9.4.1 Negative feedback and auto-zero biasing             310

9.4.2 Modulation and demodulation techniques              312

9.5 Common-mode biasing                                   313

9.5.1 AC coupling                                         313

9.5.2 DC-coupled floating port amplifiers                 313

10 Modeling of negative feedback circuits                 317

10.1 Introduction                                         318

10.1.1 Two-step design approach                           318

10.1.2 This chapter                                       319

10.2 Black's feedback model                               319

10.2.1 Model description                                  319

10.2.2 Application of the model                           320

10.2.3 Conclusions                                        323

10.3 Asymptotic gain model                                324

10.3.1 Superposition model                                324

10.3.2 Asymptotic gain model                              326

10.3.3 Selection of the loop gain reference               327

10.3.4 Hand calculations of the loop gain                 334

10.3.5 Impedance model                                    338

10.3.6 Port impedance of single-loop feedback amplifiers  341

10.3.7 Port impedance of multi-loop feedback amplifiers   343

10.3.8 Application of asymptotic gain model in balanced amplifiers 344

10.3.9 Asymptotic gain model and network analysis         345

10.3.10 Conclusions                                       348

11 Amplifier performance and controller requirements      349

11.1 Introduction                                         350

11.1.1 This chapter                                       350
XII

     11.2 Accuracy design considerations                        351

     11.2.1 Static inaccuracy of the servo function             351

     11.2.2 Design conclusion                                   352

     11.3 Nonlinearity design consideration                     352

     11.3.1 Loop gain differential gain error                   352

     11.3.2 Design conclusion                                   353

     11.4 Bandwidth design considerations                       353

     11.4.1 Midband frequency range and bandwidth               354

     11.4.2 All-pole loop gain functions                        354

     11.4.3 Low-pass cut-off and loop gain-poles product        355

     11.4.4 High-pass cut-off and DC loop gain                  364

     11.4.5 Low-pass cut-off with poles and zeros               369

     11.4.6 High-pass cut-off with poles and zeros              370

     11.4.7 Procedure for determination of the servo bandwidth  370

     11.4.8 Design conclusions                                  372

     11.5 Stability of negative feedback amplifiers             372

     11.5.1 Routh-Hurwitz criterion                             373

     11.5.2 Nyquist criterion                                   374

     11.5.3 Root locus analysis                                 376

     11.5.4 Non-observable and non-controllable states          380

     11.5.5 Design conclusions                                  381

     12 Frequency compensation                                  383

     12.1 Introduction                                          385

     12.1.1 Filter design approach                              386

     12.1.2 Compensation techniques                             388

     12.1.3 Compensation strategies                             389

     12.1.4 This chapter                                        389

     12.2 Phantom zero compensation                             390

     12.2.1 The phantom zero concept                            390

     12.2.2 Second order compensation                           391

     12.2.3 Third order compensation                            397

     12.2.4 Implementation of phantom zeros                     405

     12.2.5 Phantom zeros in the feedback network               406

     12.2.6 Phantom zeros at source and load                    412

     12.2.7 Active phantom zeros                                420

     12.2.8 Interaction with other performance aspects          421

     12.2.9 Bandwidth limitation with phantom zeros             422

     12.3 Pole-splitting                                        424

     12.3.1 Pole-splitting in operational amplifier circuits    425

     12.3.2 Miller effect                                       426

     12.3.3 Interaction with other performance aspects          427

     12.4 Pole-zero canceling                                   427

     12.4.1 Insertion of impedances into the signal path        428

     12.4.2 Interaction with other performance aspects          431

     12.5 Resistive broadbanding                                432

     12.5.1 Insertion of resistors into the signal path         432

     12.5.2 Interaction with other performance aspects          432

     12.6 Phase margin design                                   432

     12.6.1 Lag and lead compensators                           433

     12.6.2 Interaction with other performance aspects          437

     12.7 Reduction of the servo bandwidth                      437

     12.7.1 Excessive pole-splitting                            437

     12.7.2 Pole frequency reduction                            437

     12.7.3 DC loop gain reduction                              438

     12.7.4 Interaction with other performance aspects          438
                                                                 XIII

12.8 Feedback biasing frequency compensation                438

12.8.1 Negative feedback biasing concepts                   438

12.8.2 Dynamic behavior with feedback biasing               439

12.9 Nested control                                         443

12.9.1 PID controllers with local feedback amplifiers       443

12.9.2 Increasing bandwidth without adding dominant poles   446

12.9.3 Interaction with other performance aspects           446

12.10 Compensation for open and shorted ports               447

12.10.1 Compensation of shorted ports                       447

12.10.2 Compensation of open ports                          448

12.11 Influence of non dominant poles                       448

12.11.1 Bandwidth limitation with phantom zeros             448

13 Local feedback stages                                    449

13.1 Introduction                                           450

13.1.1 Local feedback amplifier stages                      450

13.1.2 This chapter                                         450

13.2 Direct feedback stages                                 451

13.2.1 Nonenergic feedback stages                           451

13.2.2 Common Drain Stage                                   452

13.2.3 Common Gate Stage                                    458

13.2.4 Passive feedback stages                              461

13.3 Application of balancing                               462

13.3.1 Local feedback with balanced CS stage                462

13.3.2 Balanced local feedback amplifier stages             462

13.4 Indirect feedback stages                               463

13.4.1 Current mirror                                       463

13.4.2 Voltage mirror                                       463

14 Multi-stage Feedback Amplifiers                          465

14.1 Introduction                                           466

14.1.1 Summary of previous chapters                         466

14.1.2 This chapter                                         471

14.2 Controller design considerations                       472

14.2.1 Design of the input stage                            473

14.2.2 Design of the output stage                           473

14.2.3 Design of the number of stages                       474

14.2.4 Interconnection of stages                            476

14.2.5 Interconnection of controller and feedback networks  480

14.2.6 Cascode stages                                       481

14.2.7 Application of local feedback stages                 482

15 Amplifier Biasing                                        485

15.1 Introduction                                           486

15.1.1 A structured approach to biasing                     486

15.1.2 Basic passive biasing elements                       486

15.1.3 Outline of the biasing approach                      488

15.1.4 Drawing conventions                                  488

15.1.5 This chapter                                         489

15.2 Setting up the initial biasing scheme                  489

15.2.1 CE and CS stage biasing                              490

15.2.2 Biasing of local-feedback stages                     491

15.2.3 Biasing of cascode stages                            495

15.2.4 Biasing of anti-series stages                        496

15.2.5 Biasing of complementary-parallel stages             500
XIV

     II Background knowledge                                  505

     16 Signal Modeling (selected topics)                     507

     16.1 Introduction                                        508

     16.2 Deterministic signal modeling                       508

     16.2.1 Power signals and energy signals                  509

     16.2.2 Time-domain modeling of signals                   510

     16.2.3 Frequency-domain modeling of signals              511

     16.2.4 Cosine transformation                             512

     16.2.5 Fourier transform                                 512

     16.2.6 Complex frequency domain modeling                 514

     16.3 Random signal modeling                              515

     16.3.1 Stationary and ergodic processes                  516

     16.3.2 Time average and ensemble average                 516

     16.3.3 Correlation function                              516

     16.3.4 Autocorrelation function                          517

     16.3.5 Mean square value                                 518

     16.3.6 Wiener-Khintchine theorem                         518

     16.3.7 Power spectral density                            518

     16.4 Signals, data and information                       518

     16.4.1 Amount of data                                    518

     16.4.2 Bandwidth and minimum sample rate                 519

     16.4.3 Crest factor                                      519

     16.4.4 Data rate                                         519

     16.4.5 Information rate                                  520

     16.4.6 Relevant signal properties                        520

     16.4.7 Channel capacity                                  520

     16.4.8 Spectral efficiency                               521

     17 System Modeling (selected topics)                     523

     17.1 Introduction                                        524

     17.2 Classification of systems                           524

     17.3 Linear stationary instantaneous systems             525

     17.4 Linear stationary dynamic systems                   525

     17.4.1 Time domain analysis                              526

     17.4.2 Frequency domain analysis                         526

     17.4.3 Complex frequency domain analysis                 527

     17.4.4 Time domain analysis using the Laplace transform  529

     17.5 Fixed instantaneous nonlinear systems               530

     17.5.1 Operating point, input and output offset          530

     17.5.2 Small-signal gain and inaccuracy                  531

     17.5.3 Nonlinearity                                      531

     17.5.4 Differential gain                                 531

     17.5.5 Harmonic distortion                               531

     17.5.6 Intermodulation distortion                        532

     17.6 Linear time-variant instantaneous systems           533

     17.7 Modeling of nonlinear dynamic systems               533

     18 Network Theory (selected topics)                      535

     18.1 Introduction                                        536

     18.2 Nodal Analysis                                      536

     18.2.1 The procedure                                     537

     18.2.2 General form of the admittance matrix             540

     18.2.3 Voltage-controlled current sources                541

     18.2.4 Network transformations                           542
                                                          XV

18.3 Modified Nodal Analysis                         543

18.3.1 The procedure                                 543

18.3.2 DC and AC network solutions                   547

18.3.3 MNA stamps                                    547

18.4 Implementation of transfer functions            552

18.4.1 Numerator and denominator substitution        553

18.4.2 Network expansion method                      553

18.4.3 Matrix stamps of expanded transfer functions  555

18.5 Determination of poles and zeros                556

18.5.1 Solving the characteristic equation           557

18.5.2 Eigenvalues of the time-constant matrix       557

18.5.3 Symbolic estimation of poles and zeros        563

18.6 Two-ports                                       571

18.6.1 Two-port conditions                           572

18.6.2 Two-port representations                      574

18.6.3 Two-port properties                           575

19 Noise in electronic systems                       577

19.1 Introduction                                    578

19.1.1 Thermal noise                                 578

19.1.2 Shot noise                                    578

19.1.3 Excess noise                                  579

19.1.4 Noise temperature                             580

19.2 Noise-modeling in two-ports                     580

19.3 Noise performance characterization              581

19.3.1 Signal-to-noise ratio                         581

19.3.2 Dynamic range                                 581

19.3.3 Noise figure                                  582

19.3.4 Equivalent noise bandwidth                    582

Bibliography                                         583

Index                                                587
                                                                                  XVII

Preface

Structured Electronics Design

Structured Electronics Design offers strategies, methods, and techniques
for electronic circuit design.

The complexity of analog electronics

Many people consider analog electronic circuit design complex. This is be-
cause designers can achieve the desired performance of a circuit in many
ways. Together, theoretical concepts, circuit topologies, electronic devices,
their operating conditions, and the system's physical construction constitute
an enormous design space in which it is easy to get lost. For this reason,
analog electronics often is regarded as an art rather than a solid discipline.

Experienced designers and intuitive design

At first glance, there doesn't seem to be a straightforward way to design ana-
log circuits. In daily practice, experienced designers intuitively use all these
degrees of freedom to modify and combine known solutions into new ones.
However, intuition is knowledge of which the origin has become unclear. It
results from a personal internalization process and cannot be shared with
novices who have yet to acquire this knowledge. Therefore, intuition cannot
and should not be a basis for design education.

   The design of electronic circuits can be taught, shared, and understood if
presented in a structured way with a distinct formulation of design goals,
strategies, methods, and techniques. Moreover, it requires a clear distinction
between theoretical concepts and their physical implementations.

Structured Electronics Design

Rather than taking numerous existing circuits as a starting point, it is much
more effective to start a new design with a clear understanding of

1. The application and its environment

2. The required functionality

3. The implementation technology and physical operating mechanisms

4. Theoretical concepts, design strategies, methods, and techniques

   All of this needs to be combined to achieve an acceptable performance-cost
ratio.

   Structured Electronics Design is a systems engineering approach to the de-
sign of analog electronics. It places analog electronics design in the perspec-
tive of information processing and provides a top-down design method with
a bottom-up awareness. The hierarchical design process has a similar struc-
ture at each hierarchical level.

   Important questions driving the design process are

1. How is the information present in the electrical signals?
XVIII                   2. Which physical signals present in the application environment may de-
                           grade the quality of the signal processing?
2 also: materializing.
                        3. In which way and to what extent is the application sensitive to all kinds
                           of information processing errors?

                        4. Which physical operating principles exist for implementing2 the infor-
                           mation processing functions, and to what extent are they available in the
                           desired technology?

                        5. Do the fundamental physical limitations of information processing and
                           technological or economic limitations cause unacceptable design risks?

                        6. Which design methods and techniques are available to maximize the per-
                           formance to costs ratio of the design?

                           The first three questions emphasize the top-down approach, the next two
                        illustrate bottom-up awareness, and the last shows the conceptual design
                        approach.

                           Structured Electronics Design

                        1. Defines a step-by-step design process based on the above questions, and
                           indicates which *design question* is answered at each design step.

                        2. Properly orders and orthogonalizes the design steps, based on solid prin-
                           ciples from physics, signal processing, control theory, and network theory.

                        3. Helps circuit designers efficiently and effectively obtain the desired per-
                           formance to costs ratio.

                        4. Provides a solid foundation for circuit design education and automation.

                        5. Has been developed and educated since the 1980s at the Delft University
                           of Technology.

                        About the author

                        Anton Montagne (Leiden, 1953) received his master's degree in electrical en-
                        gineering in 1984 at the Delft University of Technology. In 1983, he joined
                        Philips Semiconductors in Nijmegen where he designed analog integrated
                        circuits for audio and video applications. At Philips, he also set up training
                        courses on analog electronics. In 1986, he cofounded the product develop-
                        ment company Product Partners where he carried out many analog designs
                        in the field of instrumentation. In 1989, together with Catena Microelectron-
                        ics, Delft University of Technology, and the Institute of Microelectronics in
                        Stuttgart, he cooperated in the development of an intensive training course,
                        covering many topics of analog information processing. Since 1997, he has
                        worked as an independent consultant, trainer, and designer in the field of
                        analog electronics. Over the past 38 years, he developed analog electronics
                        for instrumentation and communication systems for the industry and carried
                        out many training courses on analog electronics at, amongst others, Catena
                        Microelectronics, Philips Semiconductors, Philips Medical Systems, NXP, Er-
                        icsson, Plessey, Texas Instruments, ASML, TNO, Bruco IC design, 3T, Carl
                        Zeiss SMT, TMC and ASMPT.

                           Anton Montagne is the inventor and coinventor of patents in the fields of
                        position sensors, imaging, charge-coupled devices, and high-stability crystal
                        oscillators.

                           Since 2016 Anton Montagne is coaching students and giving lectures and
                        masterclasses "Structured Electronics Design" at the Delft University of Tech-
                        nology.
                                                                                                                                                     XIX

Acknowledgments

This book is the spin-off of workshops I have given and the design projects I
have participated in over the past 35 years. Writing such a book is never the
result of one person's effort. I am indebted to many people I cooperated with
and the many students I have taught. They taught and inspired me, and they
have contributed in their very own way to its creation.

   The design approach for analog electronic signal processing systems, pre-
sented in this book, was suggested around 1987 by Dr. Ir. Ernst H. Nordholt.
At that time, we both cooperated in educating circuit designers around Eu-
rope. Ernst suggested that analog electronic signal processing systems could
be designed with a limited number of basic information-processing functions
and references. As a result of the fundamental physical limitations of infor-
mation processing, and due to technological limitations, their performance
would deviate from that of their idealized function concepts. The number of
signal processing errors, however, could be reduced through the application
of a limited number of so-called error-reduction techniques. Limitation of
both the number of basic functions and the number of techniques that can be
exploited for their improvement helps to solve day-to-day design problems
in a structured way and facilitates circuit design education. Moreover, it can
be a basis for partial automation of the complex design process.

   In the subsequent years, developed design courses based on this approach.
In our day-to-day design work, we applied and improved this design method.
I am very grateful to have cooperated with Ernst and to be inspired by him.
Without this cooperation, this book would not have been written.

   Despite my interest in signal processing, during my education in analog
electronics, I was primarily focused on all kinds of aspects of circuit design.
I am therefore very grateful to have cooperated with Dr. Ir. Huib Dane. His
ability to explain complex topics from statistical signal processing helped me
with my professional development and inspired me in developing training
courses for the design education of professionals.

   It has been a pleasure and honor to work together with Catena Microelec-
tronics in Delft. Since 1999 this company offered me the possibility to educate
their novice analog IC designers, and in this way, it contributed very much
to the development of this material.

   I am also very grateful to cooperate with The High-Tech Institute and Ir.
Hans Vink. Since 2010. They organize my training courses, which allows me
to spend my time teaching, serving my customers, and writing this book.

   A special word of gratitude is reserved for my friend Dr. Ir. Jan Deiman.
I am indebted to him for the pleasant conditions he offered me in his guest
house in Bali, which facilitated the writing of this book in a most inspiring
way.

   I also want to thank Ir. Dr. Chris Verhoeven from the TU Delft for offering
me the opportunity to coach students during the execution of their master
thesis and for giving guest lectures and masterclasses at the TU Delft. Coop-
eration with him very much encouraged me to complete this work. Thanks
to him, this book is now used for teaching Structured Electronics Design at the
Delft University of Technology and, I have the pleasure of working with him.
Our conversations about the structured design method, orthogonality, basic
functions, and error reduction techniques, were very inspiring.
   I also had many fruitful discussions about this material with Ir. Jeroen van
Duivenbode, a fellow at the TU Eindhoven. He inspired me in writing the
MATLAB version of SLiCAP and contributed the name servo function used in
this book. I would like to thank Jeroen for this contribution and our pleasant
and inspiring cooperation.

   While working with this book, many students gave me valuable feedback.
I am very grateful for their contributions and encourage everyone to inform
me about errata and future improvements.

   Edition 3, June 2023
   Delft, The Netherlands
   Anton Montagne
                                                             1

1Introduction

1.1 Electronics                                          2

1.1.1 Analog Electronics                                 2

1.1.2 Structured design                                  3

1.1.3 This chapter                                       3

1.2 Selected topics from systems engineering             3

1.2.1 Basic concepts                                     4

1.2.2 Basic design process                               7

1.2.3 Design data and documents                          10

1.3 Electronic information processing                    10

1.3.1 Basic concepts                                     11

1.3.2 Limitations of information processing              12

1.4 Structured Electronics Design                        13

1.4.1 Outline of the design language                     13

1.4.2 Basic functions and basic objects                  14

1.4.3 Performance, costs, and FOM                        16

1.4.4 Error-reduction techniques                         16

1.4.5 Differences with traditional analog design         17

1.5 This book                                            18

1.5.1 What you will know after studying this book        18

1.5.2 Part 1: design of application-specific amplifiers  21

1.5.3 Part 2: background knowledge                       28

1.5.4 How to use this book                               29
2 INTRODUCTION                                1.1 Electronics

1 L. De Forest. Wireless Telegraphy, Januari  The invention of the Audion by De Forest, patent [Forest1907]1, can be re-
1907                                          garded as the birth of electronics. Since then, around the world, thousands
                                              of amateurs, scientists, and engineers have contributed to its development.
                                              Nowadays, concepts developed in the first decennia of its existence are con-
                                              tinuously being adapted for application to new technologies, while new ones
                                              are still being developed.

2 The intentional behavior is also referred   1.1.1 Analog Electronics
to as: the ideal behavior, or the conceptual
behavior.                                     Although signal processing is mainly implemented digitally nowadays, ana-
                                              log electronics still play a significant role in all kinds of electronic equipment.
3 EMI: Electromagnetic interference can be    On the one hand, fast digital processing and strict EMC requirements require
considered as noise.                          knowledge about the continuous nature of electrical signals. On the other
                                              hand, interfacing with sensors, actuators, transmission lines, or communica-
                                              tion channels often requires information embedded in analog or multilevel
                                              digital signals.

                                                 Electronics deals with the manipulation of electrical currents with nonlinear
                                              electrical devices. According to this definition, electronics does not deal with
                                              the meaning of electrical signals. However, when designing electronic cir-
                                              cuits, one cannot ignore their information processing tasks. This is a conse-
                                              quence of the fundamental physical and technological limitations of informa-
                                              tion processing:

                                                      The amount of information that can be processed by any physical system is

                                                  limited. This is due to the addition of noise, the limited availability of power and

                                                  the limitation of the rate of change of signals.

                                                 In addition, the physical principles for the implementation of information
                                              processing functions are usually imperfect and contribute to information pro-
                                              cessing errors. For example, the nonlinear behavior of semiconductor devices
                                              and vacuum tubes introduces technology-dependent errors into intended lin-
                                              ear systems.

                                                 Hence, we first need definitions for the intentional behavior of information
                                              processing systems.2 Secondly, we need knowledge about the manifestation
                                              of information processing errors due to physical and technological limita-
                                              tions. These manifestations depend on how the information is present in the
                                              signal. For example, binary digital signals will be less sensitive to nonlinear-
                                              ity than multi-valued digital signals or analog signals.

                                                 Usually, information processing happens in an environment where differ-
                                              ent noise sources adversely affect the signal quality.

                                                 Another aspect of information processing is its costs. Electronic informa-
                                              tion processing requires matter, space, and electrical energy. It also contami-
                                              nates its environment with temperature rise and EMI.3

                                                 Apparently, during the design of electronic information processing sys-
                                              tems, the designer has to deal with many aspects.

                                                 At first glance, there does not seem to be a straightforward way to design
                                              such systems. However, the complexity of its design is not unique for analog
                                              electronics. Designing cars, airplanes, production equipment, test equipment,
                                              and many other modern products is highly complex. Proper structuring of
                                              complex design processes is a proven key to their success!
1.2. SELECTED TOPICS FROM SYSTEMS ENGINEERING 3

1.1.2 Structured design                                                                 4 Benjamin S. Blanchard and Wolter J.
                                                                                        Fabrycky. Systems engineering and analysis.
There exists considerable literature about structured design methods. It is             Prentice-Hall, Inc, New York, 1981. ISBN:
suggested that interested readers study systems engineering, for example [Blan-         013-135047-1
chardEA1998]4 and [KossiakoffEA2003]5. Particularly those who fear a con-               5 Alexander Kossiakoff and William N.
flict between creativity and structured design methods are encouraged to                Sweet. Systems engineering principles and
read [Terninko1998]6 and [Altshuller1999]7 about TRIZ, a Russian acronym                practice. John Wiley and Sons, Inc., New
for Theory of Inventive Problem Solving. TRIZ is a generalized design theory            Jersey, 2003. ISBN: 0-471-23443-5
that offers discipline and technology-independent design methods and tech-              6 Terninko et al. Systematic Innovation, An
niques.                                                                                 introduction to TRIZ. CRC Press LLC, USA,

   In this book, we will present a structured approach to the design of nega-           1998
tive feedback amplifiers, based on clear concepts from systems engineering,             7 Altshuller. The Innovation Algorithm, TRIZ,
information processing, network theory and control theory. The design ap-               systematic innovation and technical creativity,
proach is also inspired by TRIZ.                                                        Translated by Lev Shulyak and Steven Rodman.
                                                                                        Technical Innovation Center, Inc., USA,
   This book elaborates the work presented in [Nordholt1983]8 and the work              1999. ISBN: 0-9640740-4-4
presented in [Verhoeven2003]9. It uses SLiCAP for deriving and solving                  8 Ernst H. Nordholt. Design of High-
design equations.10 By doing so, it provides a solid basis for (partial) au-            Performance Negative Feedback Amplifiers.
tomation of amplifier design.                                                           Delft Academic Press / VSSD, 1 edition,
                                                                                        1983-2006. ISBN: 9789040712470
1.1.3 This chapter                                                                      9 C.J.M. Verhoeven, A. van Staveren, G.L.E.
                                                                                        Monna, M.H.L. Kouwenhoven and E.
In this chapter, we will introduce and define the basic concepts of Structured          Yildiz. Structured Electronic Design. Kluwer
Electronics Design. In section 1.2, we will summarize basic concepts and tech-          Academic Publishers, Boston - Dordrecht -
niques from Systems Engineering, and in section 1.3, we will review some                London, 2003. ISBN: 1-4020-7590-1
concepts from electronic information processing. In section 1.4, we will com-           10 SLiCAP; Symbolic Linear Circuit
bine these concepts and techniques and outline the principles of Structured             Analysis Program, written by the author
Electronics Design. In section 1.5, we will summarize what you will know af-            (free, open-source, Python-based).
ter studying this book, briefly discuss its contents, and suggest how it can be
organized in courses.

1.2 Selected topics from systems engineering

In essence, Structured Electronics Design is a systems engineering approach to
analog electronics design. There exist many different definitions of systems
engineering, the one below is taken from https://en.wikipedia.org/wiki/
Systems_engineering:

        Systems engineering is an interdisciplinary field of engineering and engi-
    neering management that focuses on how to design, integrate, and manage
    complex systems over their life cycles. At its core, systems engineering utilizes
    systems thinking principles to organize this body of knowledge. The individual
    outcome of such efforts, an engineered system, can be defined as a combina-
    tion of components that work in synergy to collectively perform a useful function.

   In this section, we will briefly summarize some topics from systems en-
gineering. In section 1.2.1, we will introduce some basic concepts, such as
innovation, development, research, the invention, the product life cycle, the
hierarchical organization of the design process, and the idea of considering a
design process from a risk management point of view.

   In section 1.2.2 we will present a basic design process that can be used at
any hierarchical level of the design.

   All sub-processes of this design process result in various kinds of data.
Design documents are views upon this data, captured over time. In section
1.2.3, we will describe these results in more detail.
4 INTRODUCTION

                1.2.1 Basic concepts

                Innovation

                Innovation can be defined as a process in which the implementation of new
                ideas results in new markets, new technologies or new products.

                Product, market and technology development

                Mature companies innovate by developing only one of these three at a time:

                · Market development:
                   Development of new markets for existing product-technology combina-
                   tions

                · Technology development:
                   Development of new technologies for existing product-market combina-
                   tions

                · Product development:
                   Development of new products for existing market-technology combina-
                   tions

                   Simultaneous development of combinations of the above is called diver-
                sification. Diversification is considered risky. In practice, it has a very low
                success rate.

                   Innovation plans are often presented in road maps. Such maps illustrate
                the successive development of products, markets, and technologies over time.

                Research

                Research is a process in which one acquires knowledge about something. It
                must be separated from innovation. Knowledge about products, markets,
                and technologies, is the basis for their development, and missing knowledge
                must be identified and acquired before starting a development that needs it.

                The invention

                The innovation process in start-ups usually differs from that in mature com-
                panies. The latter ones have a well-defined product-market-technology port-
                folio and innovate by improving or extending products, markets, or technolo-
                gies. Start-ups often start with a basic idea based on a discovery or an in-
                vention, while they don't yet have a well-defined product-market-technology
                portfolio. The source of the invention can be a dream, an annoyance, some-
                thing that somehow pops up in the mind of an engineer, but in many cases
                also: the result of a structured design process!

                Product life-cycle processes

                In this book, we confine ourselves to the design of application-specific am-
                plifiers. One important aspect is to determine the requirements of such am-
                plifiers. In general, the product requirements follow from the interests of the
                stakeholders of the product life cycle processes. Figure 1.1 shows an IDEF0
                model of the product life cycle processes.

                   The IDEF0 drawing convention for processes is shown in Figure 1.2. A
                process, is a collection of activities that generates output (right) from its input
                (left). The process is controlled by its control input (top), and the activities
                are based on resources, methods, or mechanisms (bottom); see https://www.
                idef.com/.
                                                      1.2. SELECTED TOPICS FROM SYSTEMS ENGINEERING 5

                                                                                       use data

customer          Marketing                specific customer need                      Use             customer
needs           Development  installation / service / maintenance data                                 satisfaction

                                                                                                 customer
                                                                                                 dissatisfaction

                             sales / distribution data

product         Design             use data
requirements                       demolishment data
                                                         Installation                       demolishment data   raw
raw material                 production / test          Service and                                             material
parts                        packaging data             Maintenance                             Collection and  parts
sub assemblies                                                                                  Demolishment    waste
                        Manufacturing   Sales and                             product
                               Test    Distribution

                           Packaging

   The life cycle processes shown in Figure 1.1 are:                               Figure 1.1: IDEF0 product life cycle process
                                                                                   model. The viewpoint of this model is the
1. Marketing                                                                       data that needs to be generated during
                                                                                   design.
2. Design
                                                                                                 control
3. Manufacturing/test/packaging
                                                                                       input       Process:     output
4. Sales and distribution                                                                        collection of

5. Installation service and maintenance                                                            activities

6. Use                                                                                           method /
                                                                                                 mechanism
7. Collection and demolishment
                                                                                   Figure 1.2: Business process model accord-
   The viewpoint of the model from Figure 1.1 is the data to be generated          ing to the IDEF0 standard.
during the design process. The figure clearly shows that during the design
process, data is generated for almost all other life cycle processes. Therefore,
the stakeholders of almost all life cycle processes contribute to the product
requirements in one way or another.

   Fortunately, many of their requirements are covered by regulations and
standards. Standardization of components, materials, production methods,
and many other aspects enable a short time-to-market and facilitate global
mass production.

Hierarchically organized design processes

In general, engineers solve complex problems by breaking them down into
less complex. In this way, they create a hierarchical structure in which the
level of detailing increases at each level of hierarchy. This process ends when
all product parts can be purchased or manufactured. Hence, designing is a
top-down, hierarchically structured process.

   The materialization of the design, however, proceeds bottom-up. Hierar-
chical levels in this phase correspond with those in the design phase. This
way of working makes it possible to perform predefined integration tests of
physical (sub)systems at each hierarchical level.

   A design process with an identical structure at each hierarchical level fa-
cilitates the management of design projects. In section 1.2.2 we will present
such a design process.

Risk management

We have seen that the design of a product is a top-down process, while its
materialization is a bottom-up process. As a result, the feasibility of a product
6 INTRODUCTION

                                             is proven only when all components and parts can be purchased or manu-
                                             factured. Therefore, potential design risks may not manifest themselves until
                                             the end of the design process. This, of course, is unacceptable because it
                                             causes loops in the design process.

                                                There are several ways to avoid design loops resulting from unforeseen
                                             risks:

                                             1. Keep the innovation level low:

                                             (a) Separate research from development
                                             (b) Avoid diversification
                                             (c) Identify and justify assumptions

                                             2. Start design projects with a risk analysis

11 Don't let them unresolved so they appear  3. Solve design risks at the hierarchical level of their appearance.11
at the next hierarchical level.
                                                From the above, it is clear that product development can be regarded as
12 Low-hanging fruit may not be consumed     risk management. Risks, with the greatest product of their assumed proba-
first.                                       bility of occurrence and their assumed impact, should always be addressed
                                             first.

                                                From a risk management point of view, one should not start a design
                                             detailing familiar parts of the product. Design risks that will manifest them-
                                             selves later while designing the unfamiliar parts may force the designer to
                                             reconsider the entire structure of the product. As a result, requirements of
                                             these previously detailed parts may change drastically, or worse, these parts
                                             may no longer be required.12

                                             Show stoppers
                                             In this book, we will pay attention to the early identification of show stoppers.

                                                     A show stopper is something that stops or could stop the progress of the
                                                 design process, such as a performance-cost ratio that cannot be achieved.

                                                Experienced designers are often intuitively aware of the consequences of
                                             economic and technological constraints on the design. Therefore they usually
                                             intuitively account for them at an early stage of the design process. A novice
                                             designer, who is not yet fully aware of the impact of such limitations, may
                                             encounter a show stopper for a design proposal at a later stage and may then
                                             be forced to reconsider the earlier selection of this proposal.

                                                In general, design risks increase with increasing levels of innovation. Con-
                                             ducting research is the way to reduce those risks.

                                             Figure Of Merit (FOM)

                                             Throughout the design process, designers need to select the most promis-
                                             ing solution from a set of possible solutions. Such selections are generally
                                             based on the performance-cost ratio of the different solutions. A Figure Of
                                             Merit (FOM) is the most compact way to represent the performance-cost ra-
                                             tio. It is the ratio of the weighted product of the performance parameters and
                                             the weighted product of the cost factors of a solution:

                                                            FOM = product of weighted performance measures (1.1)
                                                                                product of weighted cost factors
                                                                     1.2. SELECTED TOPICS FROM SYSTEMS ENGINEERING 7

1.2.2 Basic design process

In this section, we will introduce a basic design process to be used at any
hierarchical level. The underlying idea is to consider the product itself, as
well as all of its parts, as objects. These objects or combinations thereof
perform functions in a physical environment and at the expense of resources,
such as matter, energy, time, and space.

   This basic design process is depicted in Figure 1.3. It consists of a series
of activities that together define a composition of objects that fulfills the re-
quirements of the main object. The output at the lowest hierarchical level is
purchase or production data for the object. At higher levels, the outputs are
initial object performance requirement specifications of subsystems. These
initial specifications are the inputs at the next hierarchical level. The input at
the highest hierarchical level, is the initial specification of the product.

Initial        Interpretation:                            Engineering                            OPS: Object Performance Specification
specification  setting up the                             characteristics                        OTS: Object Test Specification
               OPS and OTS                                                                       ODS: Object Design Specification
                                                                              Design             OTR: Object Test Results
                         Functional                                           data
                     requirements    Generation of
                                     functional           Generation of                    Analysis results
                                     decompositions       physical
                                                          compositions
                                             Functional                       Performance                    Design
                                                  design                      analysis                       data

                                     Design  proposals              Physical                     Selection                               Design
                                     data                             design                                                                data
                                                                                      Weighted                Most
                                                          Design  proposals           physical                promising  Specification:
                                                          data                        design                  solution   setting up the
                                                                                      proposals
                                                                              Design                                     ODS and OTR
                                                                              data

   The different activities of this basic design process are elucidated below.                   Figure 1.3: This Functional Flow Block
Object Performance Specification (OPS) and Object Test Specification (OTS)                       Diagram shows the basic object design
                                                                                                 process applied at any hierarchical level of
                                                                                                 the design process.

The first activity in the basic design process is the translation of the incoming
initial specification into an Object Performance Specification (OPS) and an
Object Test Specification (OTS). The OPS contains a variety of requirements
and conditions arising from life cycle processes. The OTS specifies the test
methods for these requirements. Below is a list of topics that are included in
the OPS.

1. Functional requirements
   Specification of the functions that have to be performed by the object.

2. Reliability requirements                                                                      13 Robin E. McDermott, Raymond J. Miku-
                                                                                                 lak, Michael R. Beauregard. The basics of
   Specification of the required reliability level of the performance. This is                   FMEA. Productivity Inc., Portland, USA,
   usually expressed in parameters, such as MTTF: mean time to failure,                          1996. ISBN: 0-527-76320-9
   MTTR: mean time to repair, MTBF: mean time between failures, etc.

   Failure Mode Effect Analysis (see: [McDermottEA1996]13) can be used to
   specify the probability of occurrence, the detectability, and the action to be
   taken at specific failure modes.

       Reliability requirements can be accounted for in the FOM by defining
   them as performance parameters.

3. Safety requirements
       Specification of the required safety level of the performance. This is

   usually done by referring to applicable safety standards.
       Like reliability requirements, safety requirements can be accounted for

   in the FOM by defining them as performance parameters.
8 INTRODUCTION

                                                                          4. Performance requirements
                                                                                 Specification of the required quality level of the performance. This is

                                                                             done by defining the desired values of performance parameters.

                                           The Object Performance Specification

1. Introduction                                                  1.2. Application description                                      1.3. Overview of functions and interfaces

     1.1. Primary function

       A description of the main function of the product.        A description of the way in which the product should be applied.  A block diagram of the functions and interfaces that should be
                                                                 - External equipment that has to be used                          included.
2. Overall requirements                                          - Interaction with its environment                                These functions and interfaces (ports) will be described in more
                                                                 - etc.                                                            detail in a separate section of the document.

2.1. Environmental                         Life-cycle process
               conditions
                                           Manufacturing         Testing          Certification  Transport           Storage       Installation    Operation  Service                      Demolishment
                        Temperature
                                   Shock

                              Vibration
                              Humidity
                         Air pressure
             Cleanroom standard

                                 Optical
                                      ESD
                                      EMI

whatever is relevant | during any of the life-cycle processes                     Give values or refer to standards

2.2. Reliability                            MTTD                 MTTR            MTTF
                                           diagnose              repair   normal operation

                                                                 MTBF

2.3. Safety 2.3.1. Human safety                            2.3.2. Product safety       2.3.3. FMEA: Failure Mode Effect Analysis                   2.3.4. Single-point failure:

                                - Injury                   - Short circuit protection  RPN: Risk Priority Number         > 300 Critical            - Failure does not propagate (cause more failures)
                                - Accessibility            - Overload                  Severity x Occurence x Detection  < 125 No action required  - Failure does not cause a hazardous situation
                                - Fire                     - Over voltage
                                - Polution                 - Mechanical damage         S = 1 ... 10: 1: no problem, 10: dangerous
                                      Refer to standards:                              O = 1 ... 10: 1: never, 10: very often
                                      CE, UL                                           D = 1 ... 10: 1: sure, 10: impossible

2.4. Cost factors

Life-cycle process Design                  Manufacturing                 Testing       Certification  Transport          Storage   Installation    Operation                               Service  Demolishment

2.4.1. Methods
2.4.2. Means

Methods/tools required | during any of the life-cycle processes  Give values or refer to standards Examples: Test tools, IPC standards, PCB classes, tools for reparing and servics, etc.

2.4.3. Dimensions Dimensions of the product, referring to a mechanical drawing

2.4.4. Mass     Mass of the product

2.4.5. Output to the environment - Power dissipation                                                                 4. Power supply requirements

Might be relevant during                   - Emission (EMI, light, radiation, etc.)                                             Description of the required power suppl(y)(ies)
                                                                                                                                - Voltage range
different life-cycle processes - Waste                                                                                          - Noise and ripple voltage
                                                                                                                                - Over voltage
2.4.6. Price    Target cost price of the product                                                                                - Source/sink current rating
                                                                                                                                - Short circuit current
3. Physical interface requirements                                                                                              - Isolation voltage w.r.t. safety ground
                                                                                                                                - Additional requirements
3.1. Mechanical drawing with physical interfaces
                                                                                                                     5. Functional requirements
 - Connectors
 - Mounting holes                                                                                                           Functions that are listed in the introduction will be described in separate sub sections.
 - Other interfaces to the environment, such as , optical indicators
                                                                                                                          5.x. Specification of function x
3.2. Description of physical interfaces
                                                                                                                                5.x.1. Description of the function
3.2.1. Description of the connectors                       3.2.2. Description of display/indicators                                 - A diagram with text explaining the desired behavior of the function.
- Type                                                     - LED indicators                                                         - Expressions for input-output relations of the function or of sub functions
- Part number                                              - Displays                                                               - Performance measures and test methods with pass/fail criteria of the function
- BCB mount / panel mount                                                                                                             or of sub functions
- Description of the pins                                  3.2.3. Description of other interfaces
                                                           - Jumpers                                                            5.x.2. Interfaces connected to this function
 - Number                                                  - DIP switches
 - Name                                                    - Whatever is relevant                                                   5.x.2.x. Different interfaces can be described in separate sub sections
 - Schematic reference RefDes                                                                                                       - References to interfaces to this function that have been described in (3).
 - Signal type                                                                                                                      - Specification of the signals to these interfaces:

3.3. Grounding and shielding concept                                                                                                  - Voltage / current / impedance / noise level / bandwidth / rise time / fall time /
                                                                                                                                       equivalent network / test conditions
Drawing and description of the way of interconnection of
the signal reference, the shields and the safety ground                                                                               - For indicator use specific descriptions:
with other system parts.                                                                                                               LED: color, display: rows / columns / menu, etc

Figure 1.4: Example of a structure of an                                  5. Environmental conditions
object performance specification of a                                            Specification of operating conditions. These are the conditions under
Printed Circuit Board Assembly (PCA).
                                                                             which the object must perform its function with the specified quality,
                                                                             safety, and reliability.

                                                                                 If relevant, environmental conditions during other life cycle processes,
                                                                             such as storage and transport should also be specified.

                                                                          6. Resources
                                                                                 Specification of resources (also called cost factors) that are needed or
                                                                     1.2. SELECTED TOPICS FROM SYSTEMS ENGINEERING 9

   available during the different life cycle processes. Operational resources
   are those necessary for the operation of the product. Examples are matter,
   time, and space.

       Sometimes, the means or the lack of means during other life-cycle pro-
   cesses also must be specified.

7. Interaction with the environment
       Every physical product influences its environment. Examples of such

   influences are temperature rise and pollution. Allowed and forbidden in-
   fluences have to be specified.

8. Interfacing with the environment
       Specification of interfaces with other products and operators, such as

   mechanical interfaces, electrical interfaces, and user interfaces.

   The collective noun for all measurable quantities from 2-8 is: engineering
characteristics (see Figure 1.3).

Generation of functional decompositions                                           14 Nigel Cross. Engineering Design Methods,
                                                                                  Strategies for Product Design. John Wiley
As stated before, engineers solve complex problems by breaking them down          & Sons Ltd., England, 1989. ISBN: 0-471-
into less complex. This way of working results in the presented hierarchical      94228-6
design method. Functional decomposition is a collective term for techniques
that create a set of sub-functions that together perform the complete func-
tionality of an object. Functional decomposition techniques are numerous.
Brainstorming sessions, literature study, patent study, or techniques, such as
Objectives Tree Analysis as described by Cross [Cross1989]14, can all be used
for this purpose.

Generation of physical compositions

The functions defined during functional decomposition must be performed
by physical objects. The first step is to find a physical mechanism or operating
principle to perform the function. This mechanism must then be embodied
in a physical system that consists of objects realized in some technology and
supplied with energy.

Performance analysis and selection                                                15 The one with the best performance-cost
                                                                                  ratio.
To determine the FOM of the different solutions, the designer must analyze
their performance parameters and cost factors. Such analyses can be carried
out through modeling and computer-aided symbolic and/or numerical anal-
ysis. If necessary, these analyses can be supported by testing and measuring
the performance and costs of so-called functional models. A functional model,
or Fumo for short, is a physical model of an object that contains only the parts
needed to determine specific performance aspects or cost factors. In this way,
a Fumo differs from a prototype, which is a fully manufactured object that is
used for the evaluation of performance and cost.

   After the designer has a complete picture of the performance and the costs
of all design proposals, the most promising one15 is selected for further en-
gineering.

Object Design Specification (ODS) and Object Test Results (OTS)

The Object Design Specification is a report that summarizes the object's de-
sign process. It discusses the functional decomposition, possible physical
implementations, the performance and cost analysis, the figure of merit, and
the considerations regarding the selection of the design proposal.

   The Object Test Results gives the results of the tests defined in the Object
Test Specification.
10 INTRODUCTION

                                             1.2.3 Design data and documents

                                             Throughout the design process, all kinds of data are generated. Examples
                                             are:

                                             · Calculations

                                             · Simulation models

                                             · Technical drawings and schematics

                                             · Purchase data

                                             · Production data

                                             · etc.

                                                Parts of this data often need to be included or elucidated in documents,
                                             such as the Object Performance Specification and the Object Design Specifi-
                                             cation. Documents can be considered a specific view on the design data at
                                             some moment. These documents are intended for project management, and
                                             for securing the acquired knowledge.

                                             1.3 Electronic information processing

                                             The structured design approach presented in this book puts the design of
                                             analog electronics in the perspective of information processing. To fully ap-
                                             preciate this approach, one must first understand some basic concepts from
                                             information processing.

                                             Information processing systems

                                             Figure 1.5 shows the architecture of a simple information processing system.
                                             The information processing system processes the information acquired by
                                             some source and passes the results to an observer. All takes place in an
                                             environment in which noise is present.

Figure 1.5: Architecture of a data acquisi-  noise          noise                         noise
tion system.

                                             source  electronic signal processing system  observer

                                                     noise         noise

                                                In the above description, we used some terms that need further explana-
                                             tion:

                                             · What is a signal?

                                             · What is data?

                                             · What is information?

                                             · What is noise?

                                                Figure 1.6 shows a more complex situation. The system depicted in this
                                             figure also controls the process. Hereto, it provides control signals to actua-
                                             tors that influence the progress of the process.
                                                         1.3. ELECTRONIC INFORMATION PROCESSING 11

noise                      noise                         noise                   Figure 1.6: Architecture of a system that
                                                                                 acquires information from a process,
                                                                                 processes the information, and controls the
                                                                                 process.

sensor(s)           electronic signal processing system  actuator(s)

                    noise                         noise

acquired signal(s)         process under control         excitation(s)

   In the section 1.3.1, we will define important concepts from information
processing.

   In section 1.3.2 we will show that the amount of information that can be
processed by a physical system is limited, and introduce the fundamental
physical, technological and economical limitations.

1.3.1 Basic concepts

· Signal
   A signal is a physical quantity that contains meaningful data. In electronic
   systems, we use electrical signals: the time-varying values of electrical
   current or electrical voltage.

· Data
   Data comes from the Latin word datum, which means: something given.
   Here, data are properties or details of the signal that may contain informa-
   tion.

· Information
   Information is the meaning of the data. One could say: if the data provides
   an answer to a question, it contains information.

· Interpretation
   Interpretation is the process of extracting the information from the data.

· Environment
   The environment is the total of surroundings in which this all takes place.
   Each environment imposes specific limitations to environmental condi-
   tions, such as temperature, shock, vibration, humidity, sensitivity to radi-
   ation of any kind, etc.

· Noise
   Noise is a physical quantity whose data is meaningless. If added to a
   signal, it compromises the retrieval of the information from the signals.
   Noise can be of any kind: thermal, optical, acoustic, electromagnetic, etc.

· Interference
   Interference is considered noise of which specific properties are known.
   This knowledge can be used to compensate for the adverse effects of inter-
   ference on the retrieval of information.
12 INTRODUCTION

                                            · Signal source
                                               The signal source provides a signal.

                                            · Observer
                                               The observer is the device or the person that needs the information.

                                            · Excitation
                                               Excitation is a signal with specific properties that lets a process generate
                                               responses that provide information about the process.

                                            · Transducer
                                               A transducer is a device that transfers the signal from one physical domain
                                               to another.

                                            · Sensor
                                               A sensor is a transducer that converts a non-electrical signal into an elec-
                                               trical signal.

                                            · Actuator
                                               An actuator is a transducer that converts an electrical signal into a non-
                                               electrical signal.

                                            1.3.2 Limitations of information processing

                                            The amount of information that can be processed by a physical system is
                                            limited. We will distinguish fundamental physical, technological and eco-
                                            nomical limitations.

16 Claude E. Shannon and Warren Weaver.     Fundamental physical limitations
The Mathematical Theory of Communication.
The University of Illinois Press, Ubana, 1  According to Shannon [ShannonWeaver1963]16 the amount of information
edition, 1963. ISBN: 0-88179-205-5          processing errors can be arbitrarily low if the amount of information trans-
                                            ported over a linear channel, perturbed by white noise is limited to the Chan-
                                            nel Capacity C:

                                                                            C = B log2 P + N bits N s , (1.2)

                                            where B [Hz] is the bandwidth of the channel, P [W] the signal power, and
                                            N [W] the noise power. Any physical system adds noise and suffers from
                                            power and speed limitations. Hence, the addition of noise, the limitation
                                            of the signal power, and the limitation of the rate of change of signals are
                                            regarded as fundamental physical limitations of information processing.

                                            Technological limitations

                                            The technology not only determines the strength of the above fundamental
                                            physical limitations. It also introduces processing errors that result from the
                                            non-ideal implementation of the physical operating mechanism. An example
                                            is the distortion of a signal in amplifiers due to their non-linear behavior.

                                            Economical limitations

                                            A shortage of the required resources, such as matter, energy, time, and space,
                                            can also lead to errors in information processing. Like technological limita-
                                            tions, they determine the strength of the manifestation of the fundamental
                                            physical limitations.
                                                                                      1.4. STRUCTURED ELECTRONICS DESIGN 13

1.4 Structured Electronics Design

In sections 1.2 and 1.3, we have summarized topics from systems engineering
and information processing. Together with statistical signal processing, con-
trol theory and network theory, these disciplines are the basis for Structured
Electronics Design.

   The idea behind Structured Electronics Design is the creation of a design lan-
guage. In the next section, we will give an outline of such a design language.

1.4.1 Outline of the design language                                                       17 The grammar of the language.

Like any language, the design language must have a set of words and rules17,
and we want to create an unlimited amount of stories using only relatively
small sets of words and rules. The stories we want to write with the design
language are electronic information processing systems.

   The words of the design language are the so-called basic functions. We
state:

    The functional behavior of any electronic information processing system can
be obtained from a combination of basic functions.

   The materialization of a function in an object requires the implementation              functional  Generation of        physical
of one or more physical operating principles in some technology. Therefore,                design      physical             design
physical operating principles are part of the grammar of the design language.              proposal    composition          proposal

   Due to the physical, technological, and economic limitations, the perfor-                                   operating error-
mance of these objects may be insufficient or the cost to achieve their desired                                principles reduction
performance may be too high. The application of techniques and methods                                         in available techniques
from network theory, control theory, and statistical signal processing can im-                                 technologies
prove the performance-cost ratio. Hence, these so-called error reduction tech-
niques are also part of the grammar of the design language. Application of                 Figure 1.7: Generation of a physical com-
error reduction techniques changes the functionality or optimizes the imple-               position from a functional decomposition
mentation of one or more operating principles.                                             according to Structured Electronics Design.

   We now have the design language with its words and its grammar:

        With relatively small sets of basic functions, physical principles, and error re-
    duction techniques, we can create an unlimited amount of information processing
    systems.

   Figure 1.7 illustrates the design of a physical composition from a functional
decomposition.

   At this moment, the above may sound rather abstract, and the concepts
introduced require further explanation. In section 1.4.2, we will introduce a
set of basic functions and discuss their materialization in basic objects. Ma-
terialization or implementation is the application of one or more physical
operating principles in available technologies. In electronic systems, the im-
plementation of functions is based upon operating mechanisms of electronic
devices.

   The reader is assumed to be familiar with elementary physical principles
from electrostatics and electrodynamics. The operation of semiconductor de-
vices is summarized in Chapter 4.

   In section 1.4.3 we will summarize important performance aspects and
costs factors of electronic information processing systems and give examples
of Figures Of Merits.

   In section 1.4.4, we will give some examples of error reduction techniques.
In this book, we will apply:

1. Balancing techniques
2. Negative feedback techniques
14 INTRODUCTION

                 3. Frequency compensation techniques

                    In the concluding section 1.4.5 we will discuss the differences between
                 Structured Electronics Design and the traditional approach to the design of
                 electronics.

                 1.4.2 Basic functions and basic objects

                 Top-down definition of basic functions
                 One way of defining basic functions is to consider elementary mathematical
                 operations required for information processing. Information processing deals
                 with performing operations on time-varying physical quantities.

                    Below, is a list with basic information processing and reference functions
                 for the functional decomposition of information processing systems:

                 1. Addition of signals

                 2. Subtraction of signals

                 3. Multiplication of signals

                 4. Integration of signals

                 5. Differentiation of signals

                 6. Selection of signals
                    Mathematical selection is simply comparing two variables. The physical
                    nature of the variables is not of interest. From the viewpoint of informa-
                    tion processing, it is useful to distinguish comparison in different physical
                    domains:

                    (a) Selecting of signal levels
                    (b) Selecting of signal frequencies
                    (c) Selecting of signal time intervals
                    (d) Selection of signal locations

                    Selecting also requires a reference, which brings up the group of basic
                    references:

                 7. References

                    (a) Level reference
                    (b) Frequency reference
                    (c) Time reference
                    (d) Location reference

                 8. Shifting of signals
                    Mathematically shifting of a signal is adding a constant to it. From the
                    viewpoint of information processing, the physical domain is of interest:

                    (a) Level shift (adding a constant)
                    (b) Frequency shift (modulation)
                    (c) Time-shift (memorization)
                    (d) Location shift (transportation)
1.4. STRUCTURED ELECTRONICS DESIGN 15

9. Change the power of a signal

   In the context of information processing, it is also meaningful to consider
   the two types of variables associated with physical signals: across variables
   and through variables. Examples of across variables are voltage, force, and
   pressure. Examples of through variables are current, velocity, and flow.
   The product of an across variable and its associated through variable at
   a certain time instant is the instantaneous signal power. The ratio of an
   across variable and its associated across variable shows a relation with the
   impedance of the signal source or load. For maximum power transfer from
   a source to a load, the load impedance needs to be the complex conjugate
   of the source impedance. The maximum power that can be delivered by a
   signal source is called the available power of that source.

   Basic functions related to the power transfer are:

(a) Impedance transformation (optimization of power transfer)
(b) Attenuation (reducing the available power)
(c) Amplification (increasing the available power)

10. Solving

   Solving an equation is considered an essential mathematical operation of-
   ten applied in control theory. In network theory, the nullor provides this
   function. A nullor consists of a nullator and a norator. The nullator sets a
   condition and a norator that provides the dependent variable to be solved.

   The set of functions listed above is not a minimum set of orthogonal func-     18 A periodic signal

tions. As an example, consider frequency shift. This function can be resolved
in multiplication of the signal with a frequency reference18 and selection in

the frequency domain. Another example is the level shift. This function can

be replaced with addition and a level reference.

Bottom-up definition of basic functions

A basic object is a physical implementation or the materialization of a basic
function. There exists not necessarily a one-to-one mapping of basic func-
tions onto basic objects. The materialization of basic functions in basic ob-
jects strongly depends on the physical operating principles in the available
technologies. Moreover, a physical operation principle in some technology
may contribute an attractive function not listed above. Bipolar transistors, for
example, exhibit an exponential relation between their base-emitter voltage
and their collector current. This relation holds over many decades. Resolv-
ing the functionality of a system into exp(x) functions may then result in
a straightforward mapping of the functional decomposition on the physical
composition in bipolar technology. For example, the design of integrated
circuit analog multipliers is based upon the application of the exponential
function and its inverse. In this example, multiplication is decomposed into
lin-log conversion, addition, and lin-exp conversion.

Implementation of basic functions in basic objects

There are many ways to materialize basic functions. As an example, con-
sider the implementation of impedance transformation. Both transformers
and impedance matching networks can be used for this purpose. These two
implementations use different operating principles. A transformer uses the
principle of electromagnetic induction, while the operation of a matching
network is based upon resonance.

   Another example is the selection of time intervals. This function requires
a switch. Switches can be realized with nonlinear electronic devices or with
16 INTRODUCTION

                 electromechanical devices, such as relays. These two implementations use
                 different physical operating principles and technologies.

                    In this book, we mainly focus on the design of application-specific ampli-
                 fiers. The amplification function increases the available power of a signal. Its
                 embodiment requires a power source and a mechanism to control the power
                 transfer from this source to the load with the input signal.

                 1.4.3 Performance, costs, and FOM

                 As discussed in section 1.2.2, the performance and the costs of the object
                 are specified in the Object Performance Specification (OPS). An in-depth treat-
                 ment of the structure of the Object Performance Specification for electronic
                 information processing systems is beyond the scope of this book. Compa-
                 nies usually use their own templates for it. Figure 1.4 shows an example of
                 the contents of an Object Performance Specification for a Printed Circuit board
                 Assembly (PCA).

                    In section 1.2.2 we also introduced the Figure Of Merit as the most compact
                 representation of the performance-cost ratio. Throughout the design process,
                 design decisions can be based on this FOM.

                    An example of a FOM for electronic information processing systems is the
                 amount of information that can be processed per unit of energy and per Euro:

                                                       FOM = bits (1.3)
                                                                  Joule · e

                    In this book, we confine ourselves to the circuit design of amplifiers. It
                 is impossible to define a figure of merit for amplifier design because the
                 relevant performance aspects and the relevant cost factors strongly depend
                 on the application and the technology.

                 1.4.4 Error-reduction techniques

                 In most cases, the materialization of a function in an object proceeds stepwise.
                 This is because the performance-cost ratio of a first physical design proposal
                 is not as required and needs improvement. The performance-cost ratio can
                 be improved by applying error-reduction techniques. We distinguish two
                 groups of error-reduction techniques.

                 1. Improvement of the performance-cost ratio while maintaining the way the
                    information is coded in the signal.
                    Techniques that belong to this group are:

                    (a) Optimization techniques
                    (b) Compensation techniques

                        Examples of compensation techniques are:

                        i. Balancing techniques
                        ii. Frequency compensation techniques
                        iii. Error feedforward techniques

                    (c) Negative feedback techniques

                 2. Changing the way the information is coded in the signal.
                    Examples of techniques in this group are:

                    (a) Sampling
                    (b) Quantization
                    (c) Modulation
                                                          1.4. STRUCTURED ELECTRONICS DESIGN 17

functional  Application of   Generation of  physical                                Figure 1.8: Detailed process model of the
design      error-reduction  physical       design                                  implementation of functions in objects
proposal    technique        composition    proposal                                according to Structured Electronics Design.

error-                                      operating
reduction                                   principles
techniques                                  in available
                                            technologies

   (d) Coding

   Figure 1.8 shows a more elaborated model of the physical design. It shows
that the application of an error-reduction technique may change the func-
tional decomposition.

1.4.5 Differences with traditional analog design

Traditionally, the design of analog electronics predominantly consists of anal-
ysis and improvement of the behavior of known circuits. These improve-
ments, in turn, usually consist of applying commonly known changes, and
the impact of such changes on the cost factors often remains unclear. In ad-
dition, these circuits and their improvements often carry the name of their
inventor or their topology. As a result, it is difficult or impossible to rec-
ognize the intended functionality, the applied operating principles, and the
applied design methods with their intended effects. Therefore, the traditional
design approach is a rather heuristic process.

   A clear separation between functions, the applied operating principles,
error-reduction techniques, their intended effect, and their technological im-
plementation is the distinguishing difference of Structured Electronics Design.
Moreover, Structured Electronics Design uses circuit analysis for setting-up de-
sign equations for well-defined performance parameters and cost factors, and
numeric simulation is considered a verification method rather than a design
method.

   The advantages of Structured Electronics Design for analog design automa-
tion and design education are evident, and presented below.

1. There exist two different approaches to design automation:

   (a) A big-data oriented approach
       This approach searches a circuit database circuits for viable circuits that
       solve a set of design problems. However, new problems cannot always
       be solved with known solutions. In many cases, these solutions require
       modifications. Modification of existing solutions without knowledge of
       the underlying principles is risky. It may result in show stoppers, and it
       requires extensive simulations to prove the viability under all possible
       conditions. The above can only partly be solved using parameterized
       designs.

   (b) An algorithmic approach
       Structured Electronics Design essentially is an algorithmic approach. It is
       very well suited for design automation. This approach identifies show
       stoppers at an early design stage and requires less extensive simulations
       because it considers the viability of a solution throughout the design
       process. Moreover, an algorithmic approach can invent new solutions
       because it does not start with an existing solution but builds up from
       well-defined concepts.
18 INTRODUCTION

                 2. Design education requires an approach that facilitates the internalization
                    of newly acquired knowledge. Therefore, the structured design approach
                    is well suited for design education. Each step of the design process can
                    be motivated because it uses principles from physics, signal processing,
                    control theory or network theory, and last but not least: principles familiar
                    to the student.

                 1.5 This book

                 The approach to education in analog electronics in this book strongly dif-
                 fers from the traditional approach that focuses on circuit analysis rather than
                 synthesis. This book gives the synthesis of analog electronics a solid scientific
                 foundation: it gives clear motivations for design steps to be taken. Knowl-
                 edge of physics, signal processing, network theory, and control theory is in-
                 dispensable for taking design decisions, while knowledge of mathematics is
                 required for deriving design equations.

                    This book is primarily intended for educating students in Electrical Engi-
                 neering but is also very well suited for designers educated in applied physics,
                 mechatronics, or control theory. It is divided into two parts:

                 1. Design of application-specific amplifiers

                 2. Background knowledge

                 1.5.1 What you will know after studying this book

                 1. You will know the characteristic properties of ideal(ized) amplifiers, and
                    you will be able to derive the functional requirements for amplifiers from
                    their application:

                    (a) The input and output impedance
                    (b) The source-to-load transfer
                    (c) The port isolation

                 2. You will be able to characterize the non-ideal behavior of amplifiers, and
                    you will know to derive performance requirements from the application
                    description:

                    (a) The small-signal noise behavior
                    (b) The small-signal dynamic behavior
                    (c) The instantaneous nonlinear behavior
                    (d) The dynamic nonlinear behavior
                    (e) The influence of temperature and ageing

                 3. You will come to understand other relevant design aspects of amplifiers,
                    such as:

                    (a) Environmental conditions
                    (b) Cost factors

                 4. You will understand the operating principle of amplification

                    (a) You will be able to evaluate the available power gain of a two-port
                    (b) You will understand the concept of biasing

                 5. You will be understand the operation and modeling of active devices
                                                                                1.5. THIS BOOK 19

   (a) BJT: Gummel-Poon model: relate the parameters of small-signal and
       noise model to device parameters, geometry and operating point

   (b) JFET: Shichman and Hodges model: relate the parameters of the small-
       signal and noise model to the device parameters, the geometry and the
       operating point

   (c) MOS: Shichman and Hodges model: relate the parameters of the small-
       signal and noise model to the device parameters, the geometry and the
       operating point

   (d) MOS: Meyer capacitance model: relate the small-signal capacitances
       to the device parameters, the geometry and the operating point

   (e) MOS: Ward-Dutton capacitance model: relate the small-signal capaci-
       tances to the device parameters, the geometry and the operating point

   (f) MOS: EKV model: relate the parameters of the small-signal and noise
       model to the device parameters, the geometry and the operating point

6. You can design a basic CS or CE stage amplifier stage

   (a) You can select a transistor or design the transistor geometry consider-
       ing its noise contribution and source impedance

   (b) You can select a transistor or design its geometry considering its load
       and its required voltage and current drive capability

   (c) You can design the operating point and bias the basic stage
   (d) You can determine the source to load transfer, the input impedance

       and the output impedance of a CE and CS stage for resistive and/or
       R C type source and load impedances

7. You can apply balancing techniques

   (a) You will understand the concepts of additive compensation and bal-
       ancing

   (b) You know the behavioral modifications resulting from anti-series con-
       nection

   (c) You can apply this to evaluate the behavior of a differential pair
   (d) You can bias a differential pair using only common-mode current

       sources
   (e) You know the behavioral modifications resulting from complementary-

       parallel connection
   (f) You can apply this to evaluate the behavior of a push-pull stage
   (g) You can bias a push-pull stage using only common-mode voltage

       sources

8. You will be able to design low-noise and power efficient amplifier struc-
   tures for arbitrary port impedance and port isolation requirements with
   the aid of feedback techniques, balancing techniques and isolation tech-
   niques:

   (a) Direct feedback and indirect (model-based) feedback
   (b) Nonenergic, passive and active feedback
   (c) Balancing and port isolation

9. You will be able to relate the properties of the components in the feed-
   back network to important performance aspects and costs factors of the
   amplifier:
20 INTRODUCTION

                    (a) Inaccuracy
                    (b) Noise
                    (c) Nonlinearity
                    (d) Power efficiency

                 10. You will be able to model individual performance aspects of voltage-
                    feedback and current-feedback operational amplifiers:

                    (a) Noise behavior
                    (b) Gain and input and output impedances, including their dynamic be-

                        havior
                    (c) Offset and bias quantities
                    (d) PSRR and CMRR

                    And you will become familiar with other relevant performance aspects,
                    such as:

                    (a) Input voltage range
                    (b) Output voltage and current drive capability
                    (c) Voltage slew rate

                 11. You will know in which way and to what extent the equivalent input
                    noise sources of an operational amplifier affect the noise performance of
                    the negative feedback amplifier.

                 12. You will be able to apply the asymptotic gain negative feedback model to
                    derive budgets for properties of the operational amplifiers and the passive
                    components of the negative feedback amplifier

                 13. You will be able to design the dynamic behavior of a negative feedback
                    amplifier with the aid of frequency compensation techniques:

                    (a) Phantom-zero compensation
                    (b) Pole-splitting by means of capacitive feedback
                    (c) Pole-splitting by means of pole-zero canceling
                    (d) Resistive broadbanding
                    (e) Bandwidth reduction
                    (f) Nested loops

                    And you will qualitatively know in which way these high-frequency com-
                    pensation techniques interact with other performance aspects:

                    (a) Noise behavior
                    (b) Accuracy
                    (c) Distortion
                    (d) Overdrive recovery

                 14. You will know in which way and to what extent the temperature behav-
                    ior of an operational amplifier affects the operating point of a negative
                    feedback amplifier, and you will be able to derive requirements for the
                    temperature behavior of the operational amplifier from the performance
                    requirements of its application.
                    You will be able to apply techniques to reduce this influence:

                    (a) AC coupling
                                                                                1.5. THIS BOOK 21

   (b) Negative-feedback biasing
   (c) Auto-zero techniques

15. You can apply negative feedback to a CS or CE stage

   (a) You can design single-transistor feedback stages
   (b) You will be able to relate the properties of local feedback stages to

       those of the CE or CS stage by considering the behavioral modifications
       resulting from application of negative feedback
   (c) You will understand that the CD and CC stage can be considered as
       non-inverting, unity-gain, negative feedback voltage amplifiers
   (d) You will understand that the CG and CB stage can be considered as
       non-inverting, unity-gain, negative feedback current amplifiers
   (e) You will understand that the current mirror can be considered as an
       inverting indirect feedback current amplifier
   (f) You can apply balancing techniques to local feedback amplifier stages
   (g) You can design cascode stages and the CC-CB and CD-CG cascade
       stages

16. You can design multiple-stage negative feedback amplifiers

   (a) You will be able to define the type of input stage, its geometry and
       operating point on ground of its noise performance

   (b) You will be able to define the type of output stage, its geometry and
       operating point on ground of its current and voltage drive capability

   (c) You will be able to define the number of stages on grounds of the
       static accuracy, the low-pass and high-pass cut-off frequencies and the
       distortion of the amplifier

   (d) You will know how to combine multiple stages in a controller
   (e) You will be able to apply common-mode feedback biasing techniques

       and optimize the biasing concept of a multiple-stage controller

17. You can design the bias sources

   (a) You will be able to define the specifications for the bias sources con-
       sidering their influence on the noise performance, the dynamic perfor-
       mance, the static accuracy and the temperature stability

   (b) You will be able to design the bias sources

1.5.2 Part 1: design of application-specific amplifiers                         19 Ernst H. Nordholt. Design of High-
                                                                                Performance Negative Feedback Amplifiers.
The design method presented in this book has been introduced by Nordholt        Delft Academic Press / VSSD, 1 edition,
[Nordholt1983]19. It is further developed at the TU-Delft by Verhoeven, van     1983-2006. ISBN: 9789040712470
Staveren, Monna, Kouwenhoven and Yildiz [Verhoeven2003]20. This book            20 C.J.M. Verhoeven, A. van Staveren, G.L.E.
builds further on this material. It is based upon course material for post-     Monna, M.H.L. Kouwenhoven and E.
graduate education in Structured Electronics Design, developed by the author.   Yildiz. Structured Electronic Design. Kluwer
                                                                                Academic Publishers, Boston - Dordrecht -
   The first part of this book presents the design method for application-      London, 2003. ISBN: 1-4020-7590-1
specific, negative feedback amplifiers.
22 INTRODUCTION

                                                  Application, modeling and characterization of amplifiers

                                                  In Chapter 2, we will give applications of amplifiers, define the amplification
                                                  function and discuss the ideal behavior of amplifiers. We will then discuss the
                                                  nature of information processing errors of practical amplifiers and introduce
                                                  related performance aspects.

                                                     In this chapter, we will also discuss some physical appearances of ampli-
                                                  fiers. The construction of amplifiers results from trade-offs between perfor-
                                                  mance and costs made during the design process. Cost factors of amplifiers
                                                  can be numerous, and some examples of cost factors will be given. For de-
                                                  sign decisions, it is convenient to have a figure of merit at one's disposal, and
                                                  some suggestions will be given.

                                                     We will then discuss the modeling and the characterization of the ideal
                                                  behavior of amplifiers.

                                                     The fundamental physical limitations of information processing and the
                                                  technological limitations cause the behavior of practical amplifiers to deviate
                                                  from their desired behavior. How the observer experiences these deviations
                                                  depends on how the information is present in the signal. This will be eluci-
                                                  dated with some examples.

                                                  Principle of amplification

                                                  In Chapter 3, we will study how the principle of amplification is material-
                                                  ized in electronic amplifiers. We will show that signal amplification can be
                                                  obtained through the proper interconnection of electrical power sources and
                                                  passive, electronic devices. Examples of such devices are MOS transistors,
                                                  bipolar transistors, and vacuum tubes. It will be shown that these devices,
                                                  when used in combination with power sources, can provide an available
                                                  power gain larger than unity; which is a distinguishing property of ampli-
                                                  fiers. For this reason, these devices are often called active devices. Combining
                                                  power sources with such devices is usually called biasing. This chapter con-
                                                  cludes with a conceptual approach to biasing. We will show that the quies-
                                                  cent operating conditions of a correctly biased amplifier stage do not depend
                                                  on the stage's drive and termination resistances.

21 H. K. Gummel and H. C. Poon. An                Modeling of semiconductor devices
integral charge control model of bipolar
transistors. Bell Syst. Tech. J., 49(5):827-852,  Knowledge of the operation and modeling of modern semiconductor de-
May-June 1970                                     vices is indispensable when designing analog electronic circuits. However,
                                                  in-depth treatment of semiconductor physics and modeling techniques is be-
22 H. Shichman and D. Hodges. Modeling            yond the scope of this book. Chapter 4 briefly describes the construction,
and simulation of insulated-gate field-           operation, and modeling of BJTs, JFETs, and MOS transistors. The main
effect transistor switching circuits. IEEE J.     goal is to provide a basic understanding of the construction and operation of
Solid-State Circuits, 3(3):285-289, September     the devices as a basis for modeling the device's performance during various
1968                                              stages of the design. The Gummel-Poon model for BJTs [GummelPoon1970]21
                                                  and the Shichman and Hodges model for JFETs [ShichmanHodges1968]22
23 J. Meyer. MOS models and circuit               will be presented and simple models for hand calculations will be derived
simulation. RCA Review, 32:42-63, 1971            from them. For MOS devices, the basic Shichman and Hodges model, the
24 D. Ward and R. Dutton. A Charge-               Meyer capacitance model [Meyer1971]23 and the Ward and Dutton capaci-
Oriented Model for MOS Transistor                 tance model [Ward1998]24 will be discussed. The latter model is used in the
Capacitances. IEEE Solid-state Circuits,          BSIM3 small-signal model [BSIM3-1995]25, often used in spice.
sc-13(5):703-708, October 1978
25 Cheng, Y. et al. BSIM3 Version 3.0 Man-           With the EKV model [EnzVittoz2006]26, the small-signal parameters can be
ual. University of California/Berkeley,           written expressed in the device geometry, the drain current, and the drain-
Electronics Research Laboratory, 1995             source voltage. These expressions are valid from weak to strong inversion,
26 Christian C. Enz, and Eric A. Vittoz.          including short-channel effects. In this way, it is possible to design the small-
Charge-based MOS Transistor Modeling. John        signal dynamic transfer and the noise performance independent from the
Wiley & Sons Inc., 2006. ISBN: 978-0-470-         biasing circuitry. SLiCAP has built-in small-signal models for CMOS18 de-
85541-6                                           vices whose parameters depend on the channel width and length, the opera-
                                                                                  1.5. THIS BOOK 23

tion current and voltage, and only a few EKV model parameters. This way of        27 Binkley, David M. Tradeoffs and Optimiza-
working facilitates the design of CMOS circuits using the inversion coefficient   tion in Analog CMOS Design. John Wiley &
or the transconductance efficiency, as described by Binkley[Binkley2008]27.       Sons Inc., 1997. ISBN: 978-0-470-03136-0

Basic amplification with CS stage                                                 28 This is called "orthogonal design".

In Chapter 5, we will study the performance limitations and the design con-
siderations for the common-source (CS) stage, which can be considered as
the basic MOS transistor amplifier stage. At a later stage, we will show that
other MOS amplifier stages can be derived from the CS stage through the
application of error reduction techniques such as compensation or negative
feedback.

   The common-emitter (CE) stage can be regarded as the basic BJT amplifier
stage. Performance limitations and design considerations for this stage will
be added in a future version of this book.

   For these basic amplifier stages, we will discuss the way in which their
performance can be altered by design. We will see that the designer does not
have many degrees of freedom to optimize the performance of such elemen-
tary amplifier stages. The operating conditions, the fabrication technology,
and the geometry or the device type are the only design variables at the
disposal of the designer to optimize their performance-to-costs ratio. More-
over, the various performance aspects of single-transistor amplifiers cannot
be designed independently28 and compromises between performance aspects
often need to be made.

Application of balancing techniques: differential pair and push-pull stages       29 Shortly: anti-series connection and
                                                                                  complementary-parallel connection.
If the desired performance-cost ratio of an amplifier cannot be achieved with
basic amplifier stages, error-reduction techniques can be applied for its im-
provement. In Chapter 6, we will study the application of balancing tech-
niques and their impact on the performance-cost ratio of an amplifier. Two
particular applications of balancing techniques will be discussed in more de-
tail: anti-series connection of equal devices, and parallel connection of com-
plementary devices.29

   Anti-series connection of basic amplifier stages provides a four-terminal
stage with an odd transfer characteristic and improved isolation between
the input port and the output port. The behavioral modifications that are
a result of series, complementary-series, and anti-series connection, will be
investigated. It will be shown that the properties of the MOS and the BJT
differential pair can easily be related to those of the CS and the CE stage,
only by considering such behavioral modifications. We will see that, when
applied in a truly balanced environment, the small-signal transfer and the
noise performance of the differential pair can equal those of the basic CE
or CS stage at the costs of four times the area and four times the operating
current. As a result of the anti-series connection, offset voltages are canceled
and the bias sources change from differential-mode to common-mode. The
large-signal transfer of these anti-series stages has an odd characteristic with
current saturation.

   The complementary-parallel connection of amplifier stages split an input
signal into a push and a pull current. These currents can be much larger
than the quiescent operating current of the stage and can be used as high-
efficiency amplifier stages. The CMOS inverter is a complementary parallel
stage.

   The behavioral modifications resulting from parallel, anti-parallel, and
complementary-parallel connection of amplifiers or amplifier stages, will be
investigated. The properties of the MOS and the BJT push-pull stage will be
related to those of their constituting CS or CE stage.
24 INTRODUCTION

                    Not all performance aspects of an amplifier or amplifier stage can be im-
                 proved with balancing. The (gain) accuracy, the dynamic transfer, and their
                 temperature dependencies of balanced stages equal those of their unbalanced
                 version. Improvement of those aspects requires the application of techniques
                 with better error-reduction capabilities.

                 Design of negative feedback amplifier configurations

                 Negative feedback is very a powerful error-reduction technique. The charac-
                 teristics of negative feedback amplifiers are primarily fixed with reference net-
                 works or feedback networks. These feedback networks create an accurate copy
                 of the source signal from the load signal. They can be passive or nonenergic
                 elements of which the electrical behavior is accurately defined. A high-gain
                 controller or error amplifier minimizes the difference between the source sig-
                 nal and this copy. In this way, the properties of the feedback amplifier are
                 predominantly determined by its feedback networks; the error amplifier pro-
                 vides the available power gain but does not define the source-to-load transfer.

                    The design of application-specific negative feedback amplifiers is discussed
                 in Chapter 7. In this chapter, we will discuss the design of negative feed-
                 back amplifier configurations for specific sources and loads. We will see that
                 the amplifier types, introduced in Chapter 2 can be synthesized by combin-
                 ing voltage and or current sensing at the load with voltage and or current
                 comparison at the signal source. During the conceptual design of negative
                 feedback amplifiers, nullors are used as ideal controllers. The nullor can be
                 considered a network element with an infinite available power gain and no
                 speed limitation. At a later stage of the design, these nullors need to be
                 replaced with error amplifiers, implemented with amplifier stages, or with
                 operational amplifiers.

                    In this chapter, we will show that the amplifier types from Chapter 2 can
                 all be designed using nonenergic feedback elements. Nonenergic feedback el-
                 ements are lossless and have no energy storage. In addition, two of them, the
                 ideal transformer and gyrator behave like natural two ports. Unfortunately,
                 transformers are not ideal and suffer from energy storage and losses, while
                 physical operating mechanisms for gyrators have not (yet) been discovered.
                 The use of more practical passive feedback elements limits the number of
                 negative feedback configurations. If this is the case, the application of active
                 feedback, balancing, or indirect feedback may be considered.

                 The operational amplifier as controller in feedback amplifiers

                 Operational amplifiers are intended as controllers for negative feedback am-
                 plifiers. With their high voltage gain, high common-mode and differential-
                 mode input impedance, high common-mode rejection ratio and low output
                 impedance early types were versatile building blocks for negative feedback
                 voltage amplifiers. Nowadays, the behavior of current-feedback and rail-to-
                 rail output operational amplifiers strongly deviates from this behavior, which
                 complicates their application.

                    Chapter 8 deals with the modeling of operational amplifiers. Aside from
                 modeling all behavioral aspects with so-called macro models, attention will
                 be paid to the modeling of individual performance aspects, which is con-
                 sidered to be more useful for deriving budgets for different performance
                 limitations and for taking early-stage design decisions.

                    Another aspect that is limiting the application of operational amplifiers
                 as universal controller is the fact that their output port, which is usually
                 a high-efficiency push-pull output stage, has a split return path connected
                 to both supply terminals. This imposes difficulties to the implementation
                 of grounded current sensing techniques and limits the number of amplifier
                 configurations that can be realized using solely operational amplifiers as con-
                                                                                   1.5. THIS BOOK 25

trollers. This limitation as well as various ways to deal with it will also be
discussed in this chapter.

Introduction to biasing

An introduction to the biasing of negative feedback amplifiers will be pre-
sented in Chapter 9. In this book, we will advocate a strict separation between
the design of the signal transfer and the design of the biasing of amplifiers
and amplifier stages. At an earlier stage we have already shown that the
principle of amplification requires the application of properly interconnected
power sources and passive nonlinear electronic devices. Biasing refers to the
derivation of all these power sources from the power supply source(s).

   Biasing of (cascaded) amplifier stages will only be presented after we have
discussed the design of the signal processing properties of an amplifier. The
reason for this is that biasing of stages and of interconnected stages only
needs to be done if the signal processing by the conceptually biased stages
is adequate. Biasing of a configuration of which the signal processing is not
according to the requirements is meaningless and regarded as a lost of valu-
able design time. In this introductory chapter, we will only discuss the conse-
quences of errors that are a result of imperfect biasing of controllers. Such er-
rors occur due to device tolerances and temperature deviations. These errors
are usually modeled with the aid of equivalent-input offset and bias currents
and voltages. Statistical description methods will be given and error reduc-
tion techniques to minimize their effects, will be discussed. Examples will be
given for negative feedback amplifiers equipped with operational amplifiers,
but the theory is not limited to these cases. Compensation, AC coupling and
negative feedback biasing will be introduced as methods for the reduction of
biasing errors. The latter two can only be applied if frequency components
of the signal differ from those of temperature changes. These techniques es-
tablish a high-pass character of the signal transfer and design criteria for the
high-pass cut-off frequency will be given. Proper high-pass filter characteris-
tic can be established using frequency compensation techniques.

Modeling of negative feedback circuits

After we are able to design all kinds of application-specific amplifier configu-
rations with nullors as controllers, we need to find specifications for practical
controllers. To this end, we need a way of feedback modeling that facilitates
a two-step design:

1. Design of the ideal transfer which is fixed by the feedback network

2. Design of an acceptable deviation from this ideal behavior caused by the
   nonideal controller.

   The widely used feedback model introduced by Black [Black1934]30 pro-           30 Harold S. Black. Stabilized feed-back
                                                                                   amplifiers. Electrical Engineering, 53(1):114-
vides accurate performance analysis of negative feedback amplifiers only un-       120, January 1934

der limited conditions. It does not account for the so-called direct transfer      31 H.W. Bode. Network Analysis and Feedback
                                                                                   Amplifier Design. Van Nostrand, New York,
from the source to the load, and it assumes unilateral transfer and ideal sens-    1945

ing at the load and comparison at the source. As a result of these limita-         32 W.K. Chen. Active Network Analysis.
                                                                                   World Scientific Publishing Co. Pte. Ltd.,
tions, it is suited for the analysis of negative-feedback systems rather than      Singapore, 1991. ISBN: 9971-50-912-1
                                                                                   33 R.D. Middlebrook. Measurement of loop
for the two-step design of negative-feedback amplifier circuits. The feed-         gain in feedback systems. Int. J. Electronics,
back theory introduced by Bode [Bode1945]31 in 1945 and described by Chen          38:485-512, April 2001
[Chen1991]32 gives a method to analyze the stability of a feedback loop.
Middlebrook [Middlebrook1975]33 introduced the double injection theory to

measure the loop gain. However, all these models focus on stability analysis,

rather than on a two-step design of a well-defined dynamic behavior of the

feedback amplifier.
26 INTRODUCTION                                 The only feedback model that facilitates the two-step design is the asymp-
                                             totic gain model as described by Rosenstark [Rosenstark1974]34. This model
34 Solomon Rosenstark. A Simplified          shows that the design of a negative feedback amplifier can be performed in
Method of Feedback Amplifier Analysis.       the two subsequent and independent steps that have been mentioned above.
Transactions on education, E-17(4):192-198,  Moreover, the source-to-load transfer obtained from this model equals the
November 1974                                one found from network analysis. The asymptotic gain model will be dis-
                                             cussed in Chapter 10.

                                             Setting up controller performance specifications

                                             With the aid of the asymptotic gain model, we are able to relate performance
                                             aspects of the controller to those of the negative feedback amplifier. This
                                             enables use to derive budgets for the performance aspects of the controller,
                                             which is a minimum requirement for the two-step design approach described
                                             above. In Chapter 11 this will be done for the static accuracy, the nonlinearity
                                             and the bandwidth of the amplifier. We will find that:

                                             1. The static error of a feedback amplifier sets a requirement for the con-
                                                troller's contribution to the static or DC loop gain.

                                             2. The low-pass cut-off frequency of a feedback amplifier sets a requirement
                                                for the contribution of the controller to the gain-poles product of the dom-
                                                inant poles of the loop gain.

                                             3. The static differential-gain error of the negative-feedback amplifier sets a
                                                requirement for the contribution of the controller to the static differential
                                                error to gain ratio of the DC loop gain.

                                                Design conclusions for other performance aspects such as the high-pass
                                             cut-off frequency will also be derived. The derivation of budgets for noise
                                             and power losses of the controller has already been dealt with in Chapter 7.

                                                In this chapter, we will also introduce techniques for the evaluation of the
                                             stability of negative feedback amplifiers. Techniques known from control the-
                                             ory, such as the Nyquist stability criterion, the Routh array analysis method
                                             and the root-locus technique will be summarized and elucidated with exam-
                                             ples. Frequency compensation techniques for establishing the desired filter
                                             characteristics will be discussed at a later stage.

                                             Frequency compensation

                                             Frequency compensation techniques for establishing proper high-pass or low-
                                             pass filter characteristics will be extensively discussed in Chapter 12. Con-
                                             cepts and strategies for frequency compensation will be introduced and im-
                                             plementation examples will be given. Special attention will be paid to the
                                             impact that frequency compensation may have on other performance aspects
                                             such as bandwidth, linearity, overdrive recovery and noise. It will be shown
                                             that frequency compensation with the aid of phantom zeros is the most pow-
                                             erful method because it has the lowest interaction with other performance
                                             aspects. Implementation of both active and passive phantom zeros will be
                                             discussed and illustrated with examples. Other techniques such as pole-
                                             splitting techniques, resistive broadbanding and nested control will be dis-
                                             cussed as well.

                                             Design of local feedback stages

                                             Amplifier stages that use a single, unbalanced or balanced CE or CS stage as
                                             controller are called local feedback stages. Local feedback stages can be used
                                             as single-stage amplifiers, or as stages in negative feedback amplifiers. In
                                             Chapter 13, we will discuss the design of local feedback stages. We will
                                                                                  1.5. THIS BOOK 27

show that the well-known CD stage or source follower as well as its bipolar
version, known as the emitter follower or CC stage, can be considered as unity-
gain voltage amplifiers that exploit nonenergic feedback and that have the
CS or CE stage as controller, respectively. Similarly, the common-gate (CG)
or the common-base (CB) stage can be considered as nonenergic negative
feedback current followers. The advantage of such an description method is
evident. If those stages are feedback versions of the basic CS or CE stages,
then the loop gain, which can be regarded as a measure for the amount of
negative feedback, indicates the extent to which their behavior deviates from
that of the CE or CS stage. It will then become clear that commonly known
properties, such as the low output impedance of the CC stage, are only true if
the stage is driven from an impedance that establishes a relatively large loop
gain. If such a stage is driven from a current source, accurate input voltage
comparison cannot be performed, the loop gain will be low and the output
impedance does not differ from that of a CS stage. In addition, since the
CS and CE stages are nonenergic negative feedback amplifiers, they inherit
the properties of nonenergic feedback amplifiers. Without further analysis it
then becomes clear that the equivalent input noise sources of a CD or the CC
stage equal those of the CS or the CE stage of which they are constituted,
respectively. Similar things can be said about their power efficiency.

   Aside from the design of CD, CC, CG and CB stages, the design of other
basic local feedback stages, such as the series, the shunt stage and some dual-
loop local feedback stages, as well as the application of balancing techniques
will be discussed as well. A separate section will be devoted to the so-called
cascode stage. This stage consists of a cascade connection of the CS and CG
stage (MOS version) or a CE and a CB stage (BJT version). Its interesting
properties makes it an ideal inverting amplifier stage in multiple-stage neg-
ative feedback amplifiers that ensures low interaction between stages. It will
be shown that the CD-CG cascode and its bipolar version, the CC-CB cascode,
can similarly be regarded as basic non-inverting amplifier stages.

Design of multiple-stage negative feedback amplifiers

High-gain amplifiers may be constructed from a cascade connection of ampli-
fier stages. High-performance negative feedback amplifiers, however, require
controllers that comprise multiple amplifier stages. The CS or the CE stage,
the cascode stages, the local feedback stages as well as the balanced versions
of all these stages may be candidates for amplifier stages in such a multiple-
stage controller. In Chapter 14 we will discuss the design of multiple-stage
controllers. We will show that by selecting a CS or CE (cascode) stage, or
their balanced version, the controller will have the best possible noise per-
formance if the noise performance of this stage is optimized for the given
source impedance and feedback network(s). Similarly, by selecting a CE or
CS (cascode) stage or its balanced version the contribution to the differential
error to gain ratio of the loop gain will be as low as possible.

   Design criteria for the number of stages and the preferred type(s) for inter-
mediate stages will also be given. It is important to have a rough estimate for
the number of stages at an early stage of the design. If the number of stages
is more that two or three, frequency compensation may become difficult and
one may consider to construct the amplifier from a number of multiple-stage
feedback amplifiers. Nested feedback techniques will also be discussed and
illustrated with examples.

   The motivation of the type of stages inside the controller may also be
driven from practical limitations such as the power supply voltage and the
complexity of the biasing. In modern analog CMOS design, the low power
supply voltage may put a serious constraint to the architecture of the con-
troller. Since biasing considerations may seriously influence the design of
28 INTRODUCTION

                 amplifiers, they need to be accounted for during all stages of the design pro-
                 cess. However, this does not change the design approach for amplifiers. If
                 the signal processing performance of an optimally designed signal path does
                 not leave room for any degradation possibly resulting from biasing, the de-
                 tailed design of the bias sources is of no use. Hence, the design of the noise
                 performance, the bandwidth, the linearity and the frequency compensation
                 should always be done before implementing the bias sources.

                 Biasing

                 The biasing and design of the biasing elements is performed in four steps:

                 1. Simplification of the biasing scheme.
                    During the design of the signal path of the amplifier we use conceptually bi-
                    ased amplifier stages as introduced in Chapter 3. Such stages use four bias
                    sources. During this design step, this biasing scheme will be simplified
                    and the remaining bias sources will be replaced with the power supply
                    and nonlinear resistive elements that exhibit a voltage or current source
                    character. This step will be elucidated in Chapter 15.

                 2. Setting up specifications for the resulting bias sources.
                    After a biasing scheme has been developed, the performance requirements
                    for the bias sources need to be derived from error budgets for noise, band-
                    width and nonlinearity. This step will also be elucidated in Chapter 15.

                 3. Design of the bias sources.
                    The design of bias sources will be added to a future edition of this book.

                 4. Application of error reduction techniques for minimization of biasing er-
                    rors resulting from device tolerances and temperature changes.

                    This has been discussed in Chapter 9.

                 1.5.3 Part 2: background knowledge

                 Part 4 summarizes background knowledge and places it in the context of the
                 design method.

                 1. Selected topics from signal, data and information modeling can be found
                    in Chapter 16.

                 2. Selected topics from system modeling can be found in Chapter 17.

                 3. Selected topics from network theory are included in Chapter 18.
                    This summary requires knowledge of linear algebra. Four topics are usu-
                    ally not found in other books, but helpful for a better understanding am-
                    plifier design:

                    (a) The time constant matrix and its eigenvalues
                    (b) Estimation of poles and zeros of a transfer function by network inspec-

                        tion
                    (c) Decomposition of balanced circuits into differential-mode and common-

                        mode equivalent circuits
                    (d) Two-port conditions

                 4. Physical mechanisms, modeling and characterization of noise in electronic
                    circuits is summarized in Chapter 19.
                                                                                1.5. THIS BOOK 29

1.5.4 How to use this book                                                      35 Each course requires the knowledge of its
                                                                                preceeding course.
This book is organized in such a way that it can be used in three subsequent
courses:35

1. An introduction course

   The introduction course summarizes the background knowledge that is
   required to study the BSc and MSc level courses. It comprises determin-
   istic and random modeling of signals and systems, network theory, basic
   knowledge about noise in electronic circuits and hands-on experience with
   Python, SLiCAP and SPICE.

2. A BSc level course

   At the end of the BSc level course the students are able to specify and
   design an application-specific negative feedback amplifier using an oper-
   ational amplifier as controller. This course is intended for board design-
   ers who need to design signal conditioning amplifiers between sensors
   and analog-to-digital converters and amplifiers that convert output sig-
   nals from digital-to-analog converters to actuators. A chapter about the
   design of class D amplifiers will be added in future versions of this book.

3. An MSc level course

   At the end of the MSc level course, the students are able to specify and
design an application-specific amplifier using in Bipolar, BiCMOS or CMOS
technology. This course is intended for board designers who want to con-
struct amplifiers using both operational amplifiers and discrete transistors,
and for IC designers. Table 1.1 gives an overview of the chapters for each
class.

Chapter  Description                                                                  Courses
                                                                                Intro BSc MSc
1        Introduction to structured electronic design
2        Amplifiers: application, classification, modeling & characterization              
3        Principle of amplification                                                        
4        Modeling of active devices
5        Basic amplification: CS stage                                                              
6        Balancing techniques                                                                       
7        Design of negative feedback amplifier configurations                                       
8        Application and modeling of operational amplifiers                                         
9        Introduction to biasing                                                           
10       Modeling of negative feedback circuits                                            
11       Deriving controller requirements from amplifier specifications                    
12       Frequency compensation                                                            
13       Design of local feedback amplifier stages                                         
14       Design of multiple-stage negative-feedback amplifiers                             
15       Design of controller biasing concepts                                                      
16       Signal modeling (selected topics)                                                          
17       System modeling (selected topics)                                                          
18       Network theory (selected topics)                                         
19       Noise in electronic systems (selected topics)                            
                                                                                  
                                                                                  

                                                                                Table 1.1: Subsequent course programs:
                                                                                Introduction, BSc level and MSc level.
                                                                                                                                                       31

I

Design of application-specific
amplifiers
                                                              33

2Modeling and specification of am-

plifiers

2.1 Introduction to amplifier design                      35

2.1.1 Functionality                                       35

2.1.2 Definition                                          35

2.1.3 Information-processing quality                      36

2.1.4 Physical appearance                                 36

2.1.5 Cost factors and environmental conditions           37

2.1.6 Figure of merit                                     37

2.1.7 This chapter                                        37

2.2 Amplifier port requirements                           38

2.2.1 Amplifier types                                     40

2.2.2 Ground                                              41

2.2.3 Port configurations                                 41

2.2.4 Summing and distributing signals                    43

2.3 Modeling of the ideal behavior                        44

2.3.1 Transmission matrix-1 representation                44

2.3.2 Source-to-load transfer                             45

2.3.3 Input and output impedance                          46

2.3.4 Available power gain                                48

2.3.5 Idealized amplifier models                          50

2.4 Modeling of the non-ideal behavior                    52

2.4.1 Modeling of the source and load isolation           53

2.4.2 Modeling of the power supply isolation              54

2.4.3 Modeling of the noise behavior                      56

2.4.4 Modeling of the power efficiency                    65

2.4.5 Power losses and amplifier classes                  67

2.4.6 Modeling of the small-signal dynamic behavior       69

2.4.7 Modeling of the static nonlinear behavior           71

2.4.8 Modeling of the dynamic nonlinear dynamic behavior  75

2.4.9 Modeling of temperature effects                     77

2.4.10 Ageing                                             77

2.5 Cascaded Amplifiers                                   77

2.5.1 Port isolation                                      78

2.5.2 Noise behavior                                      79
34 MODELING AND SPECIFICATION OF AMPLIFIERS

2.5.3 Small-signal dynamic behavior                 80

2.5.4 Static nonlinear behavior                     80

2.6 Amplifier requirement specification             80

2.6.1 Operational requirements                      80

2.6.2 Requirements from other life cycle processes  83
2.1. INTRODUCTION TO AMPLIFIER DESIGN 35

2.1 Introduction to amplifier design                                               Figure 2.1: The 'Solo' is a high-end mono
                                                                                   audio power amplifier, designed by the
Amplification is the most important basic electronic information processing        author.
function. Electronic amplifiers are the physical objects that embody this func-
tion.                                                                                                                                          Input port

   Application areas for electronic amplifiers are numerous. Amplifiers are                                                                output port
applied in radio receivers to raise the level of an antenna signal to such an ex-                                        Power port
tent that digitization and/or demodulation can be carried out. In all kinds of
electronic equipment, amplifiers are applied to adapt the level of sensor sig-     Figure 2.2: The back side of the 'Solo'
nals to the input range of analog to digital converters, or to adapt the output    clearly shows its input, output port and
level of a digital to analog converter to the driving level of actuators. Am-      power port.
plification is also implemented in other basic functions, such as voltage and      1 The definition of the available power gain
current references, oscillators, active filters, comparators, limiters and mem-    will be given in section 2.3.4.
ory circuits. As a matter of fact, the principle of amplification is applied in
basic digital cells, such as inverters, gates and digital memory circuits. Am-     +      Modulation
plification of electrical signals is thus indissolubly connected with electronic          mechanism
information processing, and amplifiers can be found in many manifestations.        input
                                                                                   port
2.1.1 Functionality
                                                                                   -
Intuitively, one might say that an amplifier provides its load with an enlarged
copy of the source signal. According to this assumption, amplifiers would          +      Power           +
need one input port and one output port to which the signal source and load               transfer
are connected, respectively. This, however, is not true. The signal power that     power              output
an amplifier can deliver exceeds the available power of the signal source. Am-     port               port
plifiers therefore, have an additional port to which a power source needs to
be connected. Due to the power from this source and the amplification mech-        -                     -
anism embodied in the amplifying devices, the amplifier's so-called available
power gain can exceed unity.1 This property makes amplifiers fundamentally         Figure 2.3: Amplifier with input port,
different from transformers and lossless electrical networks, such as, match-      output port and power port.
ing networks. Transformers and matching networks can have either a voltage
or a current gain that exceeds unity, but their available power gain is limited
to unity.

   The amplification mechanism itself is embodied in the biased amplifying de-
vices from which the amplifier is constructed. Biased amplifying devices are
combinations of power sources and devices such as MOS transistors, bipo-
lar transistors and/or vacuum tubes. The principle of amplification will be
elucidated in Chapter 3.

   Figure 2.3 shows a model of an amplifier with its three ports: the input
port, the output port and the power port. It gives a simple representation of
the amplification mechanism: the source signal modulates the power transfer
from the amplifier's power source to the load.

   Ideally, the information at the input port will be copied to the output port
and the input and the output signals will not be affected by variations of
the power supply. For this reason, amplifiers are functionally modeled as
two-ports. In a functional description, the power port is simply omitted.

   In most cases, we do not want any reverse signal transfer from the output
port to the input port. Amplifiers with this property are called unilateral.

2.1.2 Definition

According to the previous description, we can define an amplifier as follows:

    An amplifier is a physical object having at least three electrical ports:

1. An input port to which the source signal will be connected (referred to as the
    "input")
36 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                            2. An output port to which the load will be connected (referred to as the "output")
                                                            3. An input port to which the power supply will be connected (referred to as the

                                                                "supply")
                                                                An amplifier provides the load with an accurate copy of the source signal, and
                                                            its available power gain exceeds unity.

                                                      This definition is a good starting point for a discussion of the quality of
                                                  information transfer by the amplifier.

2 EMI: Electro Magnetical Interference.       2.1.3 Information-processing quality
3 Also called cost factors.
                                              The quality of information processing tells us something about the amount
                                              of correspondence between the load signal and the source signal. By their
                                              physical nature, electronic amplifiers generate noise and are sensitive to elec-
                                              tromagnetic fields (EMI2). These and other effects will adversely affect the
                                              correspondence between the source signal and the load signal. Fortunately, a
                                              unique correspondence between signal values at the load and signal values at
                                              the source at any time instant is not required. The correspondence between
                                              the load and the source signal has to be such that an observer can retrieve
                                              the relevant information from the load signal. Errors due to the fundamental
                                              physical limitation of speed, power and noise and those due to technologi-
                                              cal limitations are thus allowed, as long as the information can be retrieved.
                                              The manifestation of these information processing errors also depends on the
                                              physical construction of the amplifier. This physical construction, in its turn,
                                              shows a strong interaction with the cost price of the amplifier. Hence, the
                                              amplifier's information processing characteristics, its physical construction
                                              and the economical constraints3 show a strong interaction.

Figure 2.4: The inside of the 'Solo' clearly  2.1.4 Physical appearance
shows the PCAs comprising other amplifier
circuits and biased active components that    Audio amplifiers, antenna amplifiers and operational amplifiers are names
together constitute the main amplification    for different objects that have at least one thing in common: they are all
function.                                     amplifiers. The meaning of the word "amplifier" thus depends on one's per-
                                              spective. A designer of audio power integrated amplifier circuits might use
                                              the term audio amplifier for a single IC, while the user of an audio amplifier
                                              refers to a complete product with housing and its user interface.

                                                 Generally, electronic amplifiers can have the following physical appear-
                                              ance:

                                              1. A complete product, including housing, power supply and user interface

                                              2. A hard wired electromechanical assembly

                                              3. A printed circuit board assembly (PCA)

                                              4. A thick or thin film assembly

                                              5. An integrated circuit (IC)

                                              6. A part of an integrated circuit.

                                                 These physical realizations of amplifiers can be nested in a hierarchical
                                              way. A complete audio amplifier, for example, may consist of several printed
                                              circuit board assemblies and other parts that are mechanically and electrically
                                              interconnected. One or more of these printed circuit board assemblies can be
                                              an electronic amplifier itself. Such an amplifier, in its turn, may be built with
                                              discrete components, as well as with integrated circuit operational amplifiers.
                                              These integrated circuits also comprise interconnected electronic devices. The
                                              ability to amplify signals that finds its origin in the biased amplifying devices,
                                              is used in these different forms of amplifiers.
                                                                                  2.1. INTRODUCTION TO AMPLIFIER DESIGN 37

2.1.5 Cost factors and environmental conditions

The processing of information by amplifiers is not free of cost. It requires
physical resources such as power, matter and space. The amplifier also gen-
erates heat and electromagnetic interference signals. Among others, these are
called costs factors.

   The quality of information processing should not be affected by normal
changes in the operating conditions. The environmental operating conditions,
or shortly environmental conditions, such as, interference signals, temperature
range, humidity, shock and vibration should be specified.

   The aim of a good design is to provide the required information processing
capability for an acceptable level of cost factors under specific environmental
conditions.

2.1.6 Figure of merit

In order to compare the performance-to-cost ratio of various amplifiers, it
would be nice to have some figure of merit (FOM). Moreover, such a figure
of merit, would help the designer in selecting solutions for specific design
problems. There are various kinds of figure of merit. They usually relate the
most important performance aspects to the most important cost factors, the
degrees of importance usually being defined by the user. Some examples are
listed below.

· Output power versus dimensions or weight

· Output power versus consumed power

· Output power versus product costs

· Noise figure versus power consumption

· Dynamic range versus power consumption

· Bandwidth versus power consumption

· etc.

2.1.7 This chapter

In section 2.2, we will start with the description of the functional behavior of
an amplifier. At the start of the design, questions that need to be answered
follow from the information that needs to be processed, the character of the
source and the character of the load of the amplifier:

· Which electrical quantity (current or voltage) should be selected as the
   electrical input quantity of the amplifier?

· Which electrical quantity should be delivered to the load?

· Is the signal source electrically connected to the power supply or is it
   floating with respect to the power supply?

· Is the load electrically connected to the power supply or is it floating with
   respect to the power supply?

   Based on this knowledge, we will make an inventory of amplifier types (or
concepts) and model their (ideal) behavior with the aid of a two-port. This
will be done in section 2.3.

   Due to fundamental physical and technological limitations, the behavior of
practical amplifiers will deviate from that of their idealized function concept
38 MODELING AND SPECIFICATION OF AMPLIFIERS

+              +                               and information processing errors are inevitable. However, as long as the
                                               load signal shows a sufficiently large correspondence with the source signal,
-                            -                 the observer will be able to retrieve the relevant information. Predictable
                                               errors do not necessarily degrade the information handling capability of the
Signal source  Input port of                   amplifier. Known errors can be compensated for in pre- or post-processing
               the amplifier                   functions, thereby restoring the correspondence between the source signal
                                               and the load signal. Reproducible errors due to nonlinearity, for example,
Figure 2.5: Interfacing of the signal source   can be compensated for by adding opposite pre- or post-distortion to input
with the input port of the amplifier in cases  or output signal, respectively. This also holds for reproducible errors that
in which the voltage of the signal source      result from bandwidth limitation. However, we will consider the conceptual
accurately represents the information,         amplifier to behave instantaneously, linearly and time-invariantly, and model it
while the source impedance may be partly       accordingly.
unpredictable.
                                                  In section 2.4, we will introduce performance parameters that describe the
Signal source  Input port of                   non-ideal behavior of amplifiers. We will discuss:
               the amplifier
                                               1. Errors arising from imperfect isolation between the input port and the
Figure 2.6: Interfacing of the signal source      output port, and between the power supply port and the two signal ports
with the input port of the amplifier in cases
in which the current of the signal source      2. Errors due to a nonzero transfer from the power port to the input port or
accurately represents the information,            vice versa, and from the power port to the output port or vice versa
while the source admittance may be partly
unpredictable.                                 3. Signal processing errors due to fundamental physical and technological
                                                  limitations. We will study different kinds of errors resulting from:

                                                  (a) The addition of noise and interference

                                                  (b) Limitation of the current and voltage handling capability due to the
                                                      physical limitation of power and due to the nonlinear signal transfer of
                                                      the characteristics of biased amplifying devices

                                                  (c) Small-signal bandwidth limitation and slew rate limitations due to the
                                                      physical limitation of the rate of change of electrical currents and volt-
                                                      ages

                                                  (d) Ageing due to changes in the properties of electronic devices over time

                                                  (e) Temperature changes

                                                  In section 2.5, we will describe the performance aspects of cascaded ampli-
                                               fiers and learn about error propagation in cascaded amplifiers. This helps us
                                               to relate properties of individual amplifiers to those of a chain of amplifiers.

                                               2.2 Amplifier port requirements

                                               The first step in amplifier design is to determine which electrical quantities
                                               must be used at the amplifier's input and output ports. If the source and
                                               the load of an amplifier consist of transducers, we have to select the electrical
                                               port quantity that shows the best correspondence to the physical input or
                                               output signal of the transducer.

                                               1. If the open circuit voltage of a signal source is accurately related to the pri-
                                                  mary physical information, we will model the signal source as a voltage
                                                  source in series with its source impedance. This impedance may be com-
                                                  plex and depend on the signal level and on the temperature. For accurate
                                                  (unity-gain) transfer of the information from the signal source to the in-
                                                  put port of the amplifier, the impedance of the input port of the amplifier
                                                  should be infinite. This has been elucidated in Figure 2.5.

                                               2. If the short-circuit current of a signal source is accurately related to the
                                                  primary physical information, we will model the signal source as a cur-
                                                  rent source in parallel with its source impedance. The source impedance
2.2. AMPLIFIER PORT REQUIREMENTS 39

   may be complex and depend on the signal level and on temperature. For                 +                 +
   accurate (unity-gain) transfer of the information from the signal source to
   the input port of the amplifier, the input impedance of the amplifier should          -                        -
   be zero. This has been shown in Figure 2.6.
                                                                                         Output port       Load
3. If the voltage across the load is accurately related to the information pro-          of the amplifier
   vided by the load and the load impedance is inaccurately known, the out-
   put port of the amplifier should have zero output impedance to ensure that            Figure 2.7: Interfacing of the load with
   the information transfer does not depend on the load impedance. This is               the output port of the amplifier in cases
   illustrated in Figure 2.7.                                                            in which the voltage across the load accu-
                                                                                         rately represents the information, while
4. If the current through the load is accurately related to the information              the load impedance may be partly unpre-
   provided by the load and the load impedance is inaccurately known, the                dictable.
   output impedance of the amplifier should be infinite to ensure that the
   information transfer does not depend on the load impedance. This has                  Output port       Load
   been shown in Figure 2.8.                                                             of the amplifier

5. If the source or the load has an accurately known linear impedance, there             Figure 2.8: Interfacing of the load with
   is no preference for current or voltage as the electrical quantity at the input       the output port of the amplifierin cases
   port or at the output port of the amplifier, respectively. In such cases, the         in which the current through the load
   current to voltage conversion or the voltage to current conversion by the             accurately represents the information,
   source or the load impedance does not impose an error on the information              while the load impedance may be partly
   to be processed.                                                                      unpredictable.

   In all other cases, the transducer mechanism determines whether current
or voltage shows the best correspondence to the information acquired by the
sensor or delivered by the actuator.

   The interfacing with some popular transducers has been described in the
examples below.

   Example 2.1

       A PIN diode can be used as a sensor that converts optical power into electrical
   current. Study of the transducer mechanism shows that the short-circuit current
   of a PIN diode is accurately (linearly and instantaneously) related to the intensity
   of the light on the diode. The open circuit voltage across the PIN diode terminals
   shows both a logarithmic and a dynamic relation to the light intensity. This light
   intensity to voltage relation also strongly depends on temperature and is only
   partly reproducible due to fabrication tolerances. An accurate and reproducible
   conversion from the optical input quantity to the electrical output quantity is thus
   obtained when the short-circuit current of the PIN diode is taken as the electrical
   quantity.

Example 2.2

   A microphone converts acoustical power into electrical power. The microphone
is designed such that its open-circuit output voltage shows the best correspondence
with the sound pressure.

Example 2.3                                                                              Figure 2.9: A microphone is designed such
                                                                                         that its open-circuit output voltage shows
   An electric motor can be used as an actuator converting electrical signals into       the best correspondence with the sound
mechanical signals. Investigation of the transducer mechanism shows an accurate          pressure.
relation between the electrical current driving the motor and the torque it delivers.
The electrical voltage shows the best relation with the angular speed.

Example 2.4

   Piezoelectric transducers can be applied for the conversion of mechanical sig-
nals into electrical signals and vice versa. Study of the transducer mechanism
shows the mechanical force is converted into electrical charge and vice versa. This
charge can be measured by taking the open-circuit voltage at the output of the
40 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                      sensor, or by taking the time integral of the short-circuit current. Investigation
                                                      of the transducer mechanism shows the latter method is more accurate, since the
                                                      influence of the nonlinear Q-V relation of the transducer will then be negligible.

                                                  Example 2.5

                                                          Transmission lines and filters have to be driven from and/or terminated with
                                                      accurate and linear impedances. There is no preference for either voltage or current
                                                      as electrical input and output quantity.

                                                      Often, it is not directly clear which electrical quantity best reproduces
                                                  the non-electrical quantity of the transducer and a study of the operation
                                                  of the transducer is required to obtain this knowledge. Usually modeling,
                                                  of sensors and actuators with the focus on information transfer is required
                                                  to define proper interfacing with the amplifier and to define possible pre- or
                                                  post-processing functions that compensate for predictable signal processing
                                                  errors.

                                                      Based on the requirements for the port impedances of the amplifier, we
                                                  will first define nine different amplifier types in section 2.2.1.

                                        2.2.1 Amplifier types

                                                  In the previous section, we investigated the selection of the electrical quantity
                                                  at the input port and at the output port of the amplifier. We found three
                                                  possibilities for each port. For the input port, we have one of the following
                                                  cases:

                                                  1. Sensing of the source current. The input port must behave as a short-
                                                      circuit in which the current is sensed. The amplifier's input impedance
                                                    should be zero: Zi = 0.

                                                  2. Sensing of the source voltage. The input port must behave as an open-
                                                      circuit and the voltage across the input port terminals must be sensed. In
                                                    this case, the amplifier's input impedance should be infinite: Zi = .

                                                  3. Sensing of current or voltage and termination of the source with an ac-
                                                      curate linear impedance. The amplifier's input impedance should now be
                                                      accurately fixed to some characteristic value Zi. The voltage across this
                                                      impedance or the current through this impedance can be used as the elec-
                                                      trical input quantity of the amplifier.

                                                      For the output port, we have one of the following situations:

                                                  1. The load must be driven from a voltage source. The output port behaves as
                                                      an ideal controlled voltage source. The output impedance of the amplifier
                                                    should be zero: Zo = 0.

                                                  2. The load must be driven from a current source. The output port behaves
                                                      as an ideal controlled current source. In this case, the output impedance
                                                    of the amplifier should be infinite: Zo = .

                                                  3. The load must be driven from an accurate linear impedance Zo. The out-
                                                      put behaves as a controlled voltage source with an accurate and linear
                                                      impedance in series, or as a controlled current source with an accurate
                                                      and linear impedance in parallel.

                                                      Based on the impedance requirements for both ports, nine amplifier types
                                                  can now be defined. If they have zero reverse transfer (from the output port
                                                  to the input port) they are called unilateral. The nine types are listed in Table
                                                  2.1.
                                                                         2.2. AMPLIFIER PORT REQUIREMENTS 41

                       no amplifier type  source quantity load quantity  Zi Zo                              Table 2.1: Amplifier types and their input
                                                                                                            and output port impedances.
                       1 Voltage amplifier voltage  voltage              0

                       2 Transadmittance voltage    current              

                       3 Voltage to V/I   voltage   voltage or current  Zo

                       4 Transimpedance current     voltage              00

                       5 Current amplifier current  current              0

                       6 Current to V/I current     voltage or current 0 Zo

                       7 V/I to voltage   voltage or current voltage     Zi 0

                       8 V/I to current   voltage or current current     Zi 

                       9 V/I to V/I       voltage or current voltage or current Zi Zo

nt and instantaneous.     According to the above, all amplifiers can be characterized by their transfer
                       characteristics and their port characteristics. For an ideal4 voltage amplifier,

                       these characteristics are shown in Figure 2.10.

                                                                                                            Figure 2.10: Transfer and port character-
                                                                                                            istics of an ideal voltage amplifier with a
                                                                                                            voltage gain that equals tan().

                          In section 2.2.4 we will find more arguments for selecting the proper am-
                       plifier type for a specific application. First, we first need to introduce the con-
                       cept ground and study possible design consequences that follow from inter-
                       connections between the source, the load and the power supply. The ground
                       concept will be introduced in section 2.2.2, and design consequences that fol-
                       low from interconnections between the amplifier ports will be discussed in
                       section 2.2.3.

                       2.2.2 Ground

                       In electrical systems, we often use the concept of the electrical ground, also
                       simply know as the ground node or the ground.

                          In network theory, the ground is the reference node of a network. The volt-
                       age at other nodes is given with respect to the ground potential (see Chapter
                       18). The absolute potential of the ground node itself cannot be defined and
                       is simply assumed to be zero.

                          In real-world electrical systems, the electrical connection with the largest
                       dimensions is usually taken to be the ground node. In most cases, this is a
                       power supply terminal.

                       2.2.3 Port configurations

                       Until now, we did not consider whether one of the terminals of the source
                       and/or load may be connected to the ground, or if both terminals should
                       be floating with respect to the ground. At a first glance, its seems easy and
                       straightforward to share the ground node; this is the case for example in
                       cars. The ground is the metal chassis, and all devices like batteries, lamps,
                       radio, etc. have one terminal connected to it. This simplifies the wiring: the
42 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                  metal chassis can be used as a return wire for all devices. However, in many
                                                  situations, it is not possible nor desirable to use the ground as the common
                                                  electrical connection for source, amplifier and load. Safety regulations in
                                                  medical equipment or ground noise due to the physical dimensions of the
                                                  ground connection and currents flowing through it may force us to use so-
                                                  called floating input or output ports that do not share one of their terminals
                                                  with the ground.

                                                      Regarding this aspect, we can define five different versions for each of the
                                                  nine amplifier types listed in Table 2.1. Figure 2.11 shows the five different
                                                  port configurations with their commonly used names.

            differential        differential                      differential         isolated                  common
            receiver-driver     driver                            receiver or          power                     ground
                                                                  instrumentation
                                                                  amplifier

            +       +           +              +                  +       +            +              +          +                 +

            --                  --                                --                   --                        --

            power               power                             power                       power              power
            supply              supply                            supply                      supply             supply

Figure 2.11: Five different versions for each
amplifier type.

                                               Common-mode and differential-mode signals

                                               The electrical behavior of ports that are floating with respect to the ground is
                                               not uniquely defined by the impedance between the two port terminals.

                                                  Let us, for example, consider the application depicted in Figure 2.12A.
                                               There, a signal voltage source Vs with a source impedance Zs has been con-
                                               nected to the floating input port of an amplifier.

Figure 2.12: A signal source which is                    +                                                       +
floating with respect to ground has been
connected to the amplifier's input port.              +  input                                                              input
Both terminals of the input port exhibit a           -   port
equal, weak capacitive coupling to a noise                                                                 + port
voltage source.                                    A     -
                                                                                           +
                                                                                                           -     -
                                                                                           -

                                                                                       B

                                                   Let us now assume that the signal source exhibits a capacitive coupling

+                   +                          to a noise voltage source Vn, which is referred to the ground. The coupling

         +           Amplifier                 capacitance between the signal source and the noise source is Cc. In Figure
--                   port
                                               2.12B, this coupling is modeled by means of two capacitors, each with a value
                    -
                                               of  Cc ,  between  the  noise  voltage  source  Vn     and  both  terminals         of  the  input

                                                   2
                                               port of the amplifier.

                                                   If both terminals of the input port exhibit an infinite impedance to the

                                               ground, the voltage of this noise source is found at both port terminals. Such

Figure 2.13: Port definition with nodal        a voltage is then called a common-mode voltage: it is common for both inputs.
voltages at the port terminals and currents
flowing into the port terminals.               In this case, we speak of a common-mode noise voltage at the input port,

                                               introduced by Vn. Although this common-mode noise does not necessarily

                                               affect the so-called differential-mode signal voltage between the two terminals,

                                               it may hamper the signal processing performed by the amplifier. This will,

                                               for example, be the case if this common-mode voltage becomes too large.
                                                             2.2. AMPLIFIER PORT REQUIREMENTS 43

In such cases, the amplifier will not be able to process the differential-mode        +           +
input signal because the common-mode noise voltage drives the input port of
the amplifier out of its linear operating range. A low port impedance would        +  -     +     -
then be beneficial: it would attenuate the common-mode voltage of the port.
At a later stage, we will show that common-mode and differential-mode port
impedances can be designed independently.

                                                                                   -        -

Definitions of common-mode and differential-mode quantities

The definitions of the common-mode quantities and the differential-mode         A        B
quantities below refer to the circuit in Figure 2.13.
                                                                                Figure 2.14: Measurement setup for deter-
   The common-mode voltage Vcm of a port is defined as the sum of the two       mination of:
terminal voltages of that port divided by two:
                                                                                  A: The common-mode port admittance
             Vcm = V1 + V2 .                                 (2.1)                B: The differential-mode port admittance
                          2                                                       The port can be an input port or an
                                                                                output port of a grounded circuit.

   The common-mode current Icm that flows into a port is defined as the sum
of the currents that flow into the two-port terminals:

             Icm = I1 + I2.                                  (2.2)

The differential-mode voltage Vdm of a port is defined as the difference input
between the voltages at the two terminals:
                                                                                            port

             Vdm = V1 - V2.                                  (2.3)

   The differential-mode current Idm is defined as the difference between the
currents that flow into the two-port terminals, divided by two:

             Idm = I1 - I2 .                                 (2.4)              Figure 2.15: Addition of currents requires
                         2                                                      parallel connections. All sources may be
                                                                                connected to ground.
Figure 2.14A and B show the test setup for determination of the common-
                                                                                                                           input
mode and the differential-mode input admittances, Ycm and Ydm, respectively.                                               port

The common-mode impedance Zcm is the reciprocal value of Ycm, it is                      +

defined as:  Zcm = dVcm .                                                                                                  input
                      d Icm
                                                             (2.5)                      - port

The differential-mode impedance Zdm is the reciprocal value of Ydm, it is                                                  input
                                                                                                                           port
defined as:  Zdm = dVdm dI . dm
                                                                                Figure 2.16: Distribution of voltages re-
                                                             (2.6)              quires parallel connections. All receiving
                                                                                inputs may be connected to ground.
   The port impedances from Table 2.1 refer to Zdm.
   In section 2.4.1, we will introduce techniques for modeling the common-      5 A common-ground system is a system in
mode and the differential-mode behavior of the amplifier ports.                 which all signal sources and loads share
   In Chapter 7, we will present methods for designing amplifiers with spe-     the ground terminal.
cific port isolation properties and we will show the way in which the common-
mode impedance and the differential-mode impedance of a port can be de-
signed independently.

2.2.4 Summing and distributing signals

The need for addition (combination) and/or distribution of signals may also
provide arguments for the selection of the information carrying electrical
quantity. Figure 2.15 shows the addition of currents in a common-ground
system.5 Addition of voltages requires voltage sources to be connected in
series, which is not possible in a common-ground system. Similarly, distri-
bution of voltages in a common-ground input-output system is much easier
than the distribution of currents (see Figure 2.16).
44 MODELING AND SPECIFICATION OF AMPLIFIERS

+  +  +                            +        2.3 Modeling of the ideal behavior

-  --                              -        Although the amplification mechanism requires a power source, it is usually
                                            omitted in a functional description of the amplifier. The functional model of
Figure 2.17: Two-port definition.           the amplifier only describes the signal transfer from the source to the load.
                                            The load power is simply assumed to be delivered by a voltage or a current
                                            source, which is controlled by the signal source. The simplest network model
                                            of an ideal(ized) amplifier thus has two ports:

                                            1. An input port, which is modeled as an open-circuit, a short circuit or as
                                               an accurate and linear impedance.

                                            2. An output port, which is modeled as a controlled current source or a
                                               controlled voltage source, which is controlled by the input quantity. A
                                               linear impedance in series with a controlled voltage source, or in parallel
                                               with a controlled current source, can be added if a finite nonzero output
                                               impedance is required.

                                               The symbol and the sign conventions of such a two-port model are shown
                                            in Figure 2.17. The sign of the current in the output port is opposite to what
                                            is customary in network theory. This to prevent minus signs in the transfer
                                            of cascaded two-ports.

                                               A two-port representation of a network only yields a complete description
                                            if the two-port constraints apply:

                                            1. A current that flows into one terminal of a port, flows out of the opposite
                                               terminal of that port.

                                            2. A voltage difference between the input port and the output port does not
                                               affect any of the two-port currents.

                                               The two-port constraints are always valid if the ports of a two-port are
                                            terminated with one-ports. Two-ports for which the port constraints are al-
                                            ways satisfied, regardless of the electrical network to which it is connected,
                                            are called natural two-ports. Examples of natural two-ports are ideal transform-
                                            ers, ideal gyrators and ideal controlled sources. If the two-port constraints are
                                            not valid, the four-terminal network requires a 3 × 3 matrix representation.
                                            For more information on two-ports and the two-port constraints, see Chapter
                                            18.6.

6 Anti-causal: The input quantities of the  2.3.1 Transmission matrix-1 representation
two-port are described as a function of
the output quantities, while the physical   The transmission-1 matrix representation will be used as the two-port model
operation is opposite: the input signals    during amplifier design. This anti-causal two-port model relates the input
cause the output signals.                   port quantities to the output port quantities.6 It will be shown that all ampli-
7 Including zero.                           fier types can be described by this model, using finite values7 for the model
                                            parameters only.

                                               The transmission-1 matrix equation for the two-port depicted in Figure
                                            2.17 is:

                                             Vi = A B  Vo Io .  (2.7)
                                             Ii  CD

                                               The parameters are defined and measured as shown in Figure 2.18. The
                                            reciprocal values of A, B, C and D are called the voltage gain factor µ, the
                                            transadmittance factor , the transimpedance factor  and the current gain factor
                                            , respectively. The word factor indicates that it refers to a property of the
                                            two-port itself: a transfer from a port input quantity to a port output quantity,
                                            rather than the transfer from the source to the load.

                                               The transmission-1 two-port parameters A, B, C and D can be obtained
                                            through measurement of the gain factors µ, ,  and . The parameters A
                                                                   2.3. MODELING OF THE IDEAL BEHAVIOR 45

                                                                              Figure 2.18: Test benches for determination

                                                                              of the Transmission-1 two-port parameters:

       +  +              ++          +        +                 +  +          A:  A  =  1
                         --                                                             µ

       -  -              ++          -        -                 -  -          B:  B  =  1
                         --                                                             

A                                                                             C:  C  =  1
                                                                                        
                                B
                                                                              D:  D  =  1
                                                                                        

                   +                               +            +  +

                -                               -               -  -
C                               D

and C are determined when the output port is left open (Io = 0), while B and
D are determined with the output port shorted (Vo = 0):

                            A = 1 = Vi ,                               (2.8)
                                   µ Vo Io=0                           (2.9)
                                                                      (2.10)
                            B = 1 = Vi ,                              (2.11)
                                    Io Vo=0

                            C = 1 = Ii ,
                                    Vo Io=0

                            D = 1 = Ii .
                                    Io Vo=0

2.3.2 Source-to-load transfer

We can express the source-to-load transfer in terms of the transmission pa-
rameters of the two-port and the source and the load impedance. From these
expressions, we can draw some important design conclusions.

   The test setup for determination of the voltage gain Av and the transad-
mitance Ay is shown in Figure 2.19A.

    +                 +  +   +                                                                  Figure 2.19: Measurement setup for the
    -                                                   + + + source-load relations:
                      -  -   -
A                                                                                                    (a) The voltage to voltage transfer and
                                     B                  - - - the voltage to current transfer, and

                                                                                                     (b) The current to current and current to
                                                                                                voltage transfer.

The voltage gain Av can be written as:8                                       8 Please notice it is our intention to show
                                                                              these transfer functions and draw design
                         Av = V = 1 Zs 1 .                            (2.12)  conclusions rather than to derive these
                                Vs A + B Z + CZs + D Z                        expressions.

                                                      

The transadmittance Ay is found as:

                         Ay = I V = 1 s AZ .  + B + CZZs + DZs        (2.13)

   The test setup for the transimpedance Az and for the current gain Ai is
depicted in Figure 2.19B. The transimpedance Az is found to be:

                         Az = V = 1 1 1 1 .                           (2.14)
                                 Is A Zs + B ZsZ + C + D Z
46 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                The current gain Ai can be obatined as:

                                                                         Ai = I = Z 1 1 .                             (2.15)
                                                                                Is A Zs + B Zs + CZ + D

                                                   At this stage, we can already draw some design conclusions from expres-

                                                sions (2.12) through (2.15). Consider, for example, a situation in which we

                                                need to design a voltage amplifier of which the source-to-load transfer should
                                                not depend on the source impedance Zs and on the load impedance Z. Ex-
                                                pression (2.12) shows us that we need to assign a nonzero value to the trans-
                                                mission parameter A, while all other parameters should be zero. Only for

                                                this situation, the source-to-load transfer will not depend on the source and
                                                load impedances. This conclusion can already be seen from the T1 matrix
                                                equation itself. With B, C and D zero, we have Vi = AVo, and Ii = 0 for
                                                all values of Io. Hence, Vi will be equal to Vs and V will be equal to Vo. In
                                                the next section, we will study the expressions for the port impedances in a

                                                similar way, and derive design conclusions for all nine amplifier types from

                                                Table 2.1.

                                                2.3.3 Input and output impedance

                                                The input impedance and the output impedance of the amplifier can also be
                                                expressed in terms of the transmission parameters and of the load and the
                                                source impedance.

                                                Input impedance

                                                The test setup for the input impedance is shown in Figure 2.20A.

                                                   The input impedance Zi of a two-port terminated with a load impedance
                                                Z can be written as:

                                                                             Zi = ViI = AZ + B . i CZ + D             (2.16)

                                                Please notice that the input impedance Zi does not depend on the load
                                                                   A     C,
                                                impedance  Z   if  B  =      which  is  equivalent  to:  AD   =  BC.
                                                                         D

                                                Output impedance

Figure 2.20: Measurement setup for:                        ++                +                      +            ++
    (A) The input impedance                                                                        -             --
    (B) The output impedance.
                                                                                        B
                                                           --                -

                                                A

                                                   The test setup for the output impedance is depicted in Figure 2.20B. The
                                                output impedance Zo of the two-port driven from Zs can be written as:

                                                                             Zo = Vo I = DZs + B o CZs + A .          (2.17)

                                                Please notice that the output impedance Zo does not depend on the source
                                                                   D     C,
9 In a unilateral amplifier, the input          impedance  Zs  if  B  =      which  is  equivalent  to:  AD   =  BC.
impedance does not depend on the load                                    A
impedance and the output impedance does
not depend on the source impedance.             Unilateral behavior

10 The reverse transfer of an amplifier is the  Amplifiers of which the input impedance does not depend on the load impedance
transfer from its output to its input.          are called unilateral.9 The reverse transfer of unilateral amplifiers is zero.10
The condition for unilateral behavior is:                 2.3. MODELING OF THE IDEAL BEHAVIOR 47
                                           AD = BC.                 (2.18)

Design conclusions

In the following example, we will demonstrate how to derive design conclu-
sions from the above expressions.

Example 2.6

Let us assume we want to design an amplifier that needs to drive a cable from its

characteristic impedance. This cable driver itself should be driven from a voltage

source of which the internal impedance Zs is not accurately known. The input

impedance of the cable driver thus needs to be infinite and the output impedance

must equal the characteristic impedance of the cable. This type of amplifier is listed

under line 3 in Table 2.1. An infinite input impedance is obtained if C = 0 and

D = 0. A finite output impedance that does not depend on the source impedance

requires either A = 0 and B = 0, or C = 0 and D = 0. If we combine both

requirements: an infinite input impedance and a finite accurate output impedance,

we need C = 0 and D = 0, as well as finite, nonzero values for A and B. The
                                                      B.
output  impedance  of  this  amplifier  then  equals
                                                      A

   The parameter values for the nine amplifier types from Table 2.1 are listed
in Table 2.2.

no amplifier type                                         Zi Zo A B C D                 Table 2.2: Transmission parameters of the
1 Voltage amplifier                                       0 A0 0 0                      nine amplifier types from Table 2.1.

2 Transadmittance amplifier                                0 B0 0

3 Voltage input, finite nonzero output impedance  Zo A B 0 0

4 Transimpedance amplifier                                0 0 0 0 C0

5 Current amplifier                                       0 0 00D

6 Current input, finite nonzero output impedance 0 Zo 0 0 C D

7 Finite nonzero input impedance, voltage output Zi 0 A 0 C 0

8 Finite nonzero input impedance, current output Zi  0 B 0 D

9 Finite nonzero input and output impedance               Zi Zo A B C D

   As we have seen, the transfer and the port impedances of the nine types of
amplifiers that are listed in Table 2.2 can be characterized with the amplifier's
transmission-1 matrix parameters A, B, C and D. The desired values of these
parameters are either zero or finite.

   The first eight amplifier types from Table 2.2 are unilateral (see section
2.3.3). The last amplifier is unilateral if AD = BC.

   In total, there exist sixteen possible combinations of zero and finite nonzero
transmission parameters. The other seven other amplifier types are:

· The nullor. This is a network element that has all its transmission-1 pa-             11 This will be discussed in Chapter 7.
   rameters equal to zero (A = B = C = D = 0). See Chapter 18.3 for the
   formal definition of the nullor. Although the input impedance and the
   output impedance of the nullor are undefined, the nullor is a unilateral
   two-port: AD = BC. The nullor will be applied as the ideal controller in
   negative-feedback amplifiers.11

· The transformer-like configuration (A and D nonzero and B and C zero).
   This amplifier is not unilateral.
       The name transformer-like configuration stems from the similarity of the
   transmission-1 matrix of this configuration to that of the transformer. An
   ideal transformer has transmission-1 parameters: B = C = 0 and AD = 1.
   See Chapter 18 for the formal definition of this network element.

· The gyrator-like configuration (A and D zero and B and C nonzero). This
   amplifier is not unilateral.
48 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                          The name gyrator-like configuration stems from the similarity of the transmission-
                                                      1 matrix of this configuration with that of the gyrator. A gyrator has
                                                    transmission-1 parameters: A = D = 0 and BC = 1. See Chapter 18
                                                      for the formal definition of this network element.
                                                  · Four amplifier configurations that have three out of four nonzero parame-
                                                    ters. These amplifiers are not unilateral because AD = BC.

12 A, B, C, D, Zs and Z are real.  2.3.4 Available power gain

                                   We have seen that amplifiers can be distinguished from passive two-ports by
                                   their available power gain. The available power gain of amplifiers exceeds
                                   unity, while that of passive two-ports will always be smaller than unity. In
                                   this section, we will give the definitions of the available power and the avail-
                                   able power gain. We will also express the available power gain of a two-port
                                   in its transmission-1 parameters. We will do this for the simple case of a
                                   resistive two-port driven from a resistive source and terminated with a resis-
                                   tor.12

                                   Available power of a source

                                       The available power of a source is defined as the maximum power it can
                                   deliver to a load.

                                      The available power Ps of a signal source that delivers an RMS voltage Vs
                                   and that has an internal impedance Zs equals

                                   Ps = Vs2 .                                   (2.19)
                                         4 Re (Zs)

                                      It is the power which is delivered to a load with an impedance Z that is
                                   the complex conjugated of Zs: Z = Zs.

                                      Please notice that the available power of a source has nothing to do with

                                   the actual power delivered by that source: the available power is a property
                                   of the source itself. If we leave a source open (Z = ), or if we short the
                                   source (Z = 0), the power delivered to the load equals zero because the load
                                   current equals zero if Z = , and the load voltage equals zero if Z = 0.

                                   However, the available power of that source, for all source terminations, is

                                   given by (2.19).

                                   Available power at the output of a two-port

                                   Similarly, the available power at the output of a two-port is the maximum
                                   power that can be delivered by that port. In this case, the output port is
                                   considered a signal source. The available power Pp of a port with an port
                                   impedance Zo that delivers an open circuit port voltage Vo thus equals:

                                   Pp = Vo2 .                                   (2.20)
                                          4 Re (Zo)

                                      Again, this power is delivered to a load impedance which is the complex
                                   conjugated of the port impedance: Z = Zo.

                                   Available power gain of a two-port

                                      The available power gain Gp of a two-port is defined as the ratio of the avail-
                                   able power at the output port and the available power of the source connected to

                                   its input.
                                                                2.3. MODELING OF THE IDEAL BEHAVIOR 49

With the aid of (2.19) and (2.20), it can be shown that:

                                    Gp = Av2 Re (Zs)   ,        (2.21)

                                             Re (Zo)

where Av is the voltage gain factor of the two-port, which is the reciprocal
value of the T1 matrix parameter A.

    +                                   +                 +  +                   Figure 2.21: Available power at optimum
    -                                   -                                        port termination:

A                                   B                                                (A) of a source,
                                                                                     (B) of a two-port.

                                                          -  -

   We will now express the available power gain of a two-port in its transmission-
1 matrix parameters and in the impedance of the source connected to its in-
put port. For the sake of simplicity, we will do this for the simple case of a
resistive two-port (A, B, C, D are real) and a resistive source and load, with
resistances Rs and R, respectively.

   We will evaluate the available power of a signal source as shown in Figure
2.21A and the available power at the output of the two-port as shown in
Figure 2.21B.

   The available power Ps of the signal source is found to be:

                                    Ps = Vs2 .                  (2.22)
                                           4Rs

The test setup for the evaluation of the available power of the two-port is

shown in Figure 2.21B. The transmission-1 parameters of the amplifier are A,

B, C and D.

The amplifier will deliver its maximum power if R = Ro. According to

(2.17), this is the case if:        R = DRs + B .
                                           CRs + A
                                                                (2.23)

This maximum power is the available power of the two-port Pp. It can be

obtained as:                        Pp = Vo2 ,
                                           4Ro
                                                                (2.24)

where Vo is the open circuit voltage at the amplifier output with the input
port being driven from the signal source.

   With the aid of (2.12), we obtain

                                    Vo = Vs A + CRs .           (2.25)

   With the aid of expressions (2.23) through (2.25), we may express the avail-
able power of the amplifier in terms of the signal source voltage and the
transmission-1 parameters of the amplifier:

                              Pp =           Vs2 .              (2.26)
                                    4 (DRs + B) (CRs + A)

   The available power gain Gp of an instantaneous two-port with (real) trans-
mission parameters A, B, C, D, driven from a resistive source with resistance
Rs, is then obtained as

              Gp = 1 AD + AB/Rs + BC + CDRs .                   (2.27)

Expression (2.27) shows that a large available power gain is obtained when
50 MODELING AND SPECIFICATION OF AMPLIFIERS

                                             all transmission parameters approximate zero. A two-port that has all its

                                             transmission parameters equal to zero is called a nullor. In Chapter 7 we

                                             will use the nullor as an ideal controller when designing negative feedback

                                             amplifier configurations. The operational amplifier (OpAmp) can be viewed

                                             as a particular implementation (and approximation) of the nullor.

                                             Expression (2.27) also shows that for a given two-port with transmission

                                             parameters A, B, C, D, the available power gain has maximum value Gp,max at

                                             some optimum source resistance Rs,opt. This optimum source resistance can

                                             be found as:

                                                           Rs,opt =    AB .                                     (2.28)
                                                                       CD

                                                After substitution of (2.28) in (2.27) we obtain an expression for the maxi-
                                             mum available power gain of a two-port:

                                                           Gp,max =    1   2.                                   (2.29)

                                                                       AD + BC

                                             If the amplifier is unilateral, we have AD = BC, which simplifies (2.29) to:

                                                           Gp,max = 1 = 1 µ.                                    (2.30)
                                                                        4AD 4

                                                Hence, the maximum available power gain of a unilateral resistive two-
                                             port is a quarter of the product of the voltage gain factor µ and the current
                                             gain factor  of that two-port.

                                                Expressions (2.29) and (2.30) can be used to evaluate the amplifying capa-
                                             bilities of a two-port.

                                             Available power gain, power gain and transducer power gain

                                             The power gain or operating power gain of an amplifier is defined as the ratio
                                             of the power delivered to the load and the power delivered by the source. It
                                             depends on the properties of the amplifier, and of the source impedance Zs
                                             and the load impedance Z. It will be clear that if Re(Z) =  or Re(Z) = 0,
                                             the power gain equals zero, because in that case, no power is delivered to
                                             the load. The available power gain of the amplifier, however, can still be much
                                             larger than unity.

                                                The transducer power gain of an amplifier is defined as the ratio of the load
                                             power and the available power of the source.

13 Basic two-port elements are the con-      2.3.5 Idealized amplifier models
trolled sources :
                                             In the previous sections, we have discussed the modeling of the ideal behav-
  - VCVS: voltage-controlled voltage source  ior of amplifiers with the aid of a two-port and the T1 matrix representation.
  - VCCS: voltage-controlled current source  In order to evaluate the idealized behavior of an amplifier with simulation
  - CCVS: current-controlled voltage source  programs, it is convenient to have two-port models at our disposal that can
  - CCCS: current-controlled current source  be constructed from basic network elements, available to the simulator.13

                                             Basic models

                                             Figure 2.24 shows four high-level network models of amplifiers that have at
                                             least one nonzero coefficient in their T1 matrix. At a later stage, we will
                                             introduce one high-level model for all amplifier types.

                                                In the models from Figure 2.24, the power delivered to the input port
                                             equals the total power dissipated in the controlled sources at the input port.
                                             The power delivered to the load is the total power delivered by the controlled
                                             sources at the output port. Similar things can be said about the energy stored
                                             in the two-port. If the sum of the powers dissipated all the controlled sources
                                                                        2.3. MODELING OF THE IDEAL BEHAVIOR 51

equals zero and the total energy storage equals zero, we speak of non-energic                +                            +
two-ports. Those two-ports are not amplifiers, because the output port de-
livers as much power to the load, as the input port takes from the source.             A-                                 -
Transformers (AD = 1, B = 0, C = 0) and gyrators (BC = 1, A = 0 , D = 0)
are non-energic two-ports.                                                                      +-

   In the following example we will present two models for transformers that           B-                           -
can be derived from the models presented in Figure 2.24.                                                               +

Example 2.7

Let us assume we need a network model of an ideal transformer such as the

one in Figure 2.22A. The transmission-1 parameters of an ideal transformer are:                    +                      +

AD = 1, B = 0 and C = 0. Hence, we can use the two-port models for A = 0

and D = 0.                            1                                                C           -                      -
                                      n
The  model  for  A  =  0  with  A  =     is  shown  in  Figure  2.22B.

The model for D = 0 with D = n is shown in Figure 2.22C.                            Figure 2.22: Network models of ideal
                                                                                    transformers.
It can be seen that both models are equal: one can be derived from another after
                                                                                      A. Symbol of ideal transformer
interchanging the input port and the output port, while replacing the turns ratio     B. Network model for voltage-controlled
                                                                                    output port
n with its reciprocal value.                                                          C. Network model for current controlled
                                                                                    output port
   Transformers and gyrators have an available power gain of unity; this di-
rectly follows from (2.27).                                                         14 In the strict sense, transistors are passive
                                                                                    devices.
   Two-ports of which the sum of the powers dissipated in the controlled
sources is negative, deliver more power to the load than they take from the
source. They are called active two-ports.

   Practical implementations can be constructed from passive devices and
power sources.14

   If a two-port delivers less power to the load than it takes from the source, it
can still be an amplifier. As discussed before, all amplifiers have an available
power gain larger than unity, but the actual power gain in an application may
be much less.

   The high-level models presented here do not tell us anything about the
power losses in the amplifier. They only model the power delivered to the
load and the power taken from the source. Hence, if there are losses in an
amplifier we have to add them to the model.

   So, if an amplifier has an output impedance of 50 and it delivers a voltage
of 1V into a 50 load, it does not mean that there is a 50 resistor in series or
in parallel with the load that reduces the power efficiency of the amplifier to
50%. At a later stage, we will discuss the design of accurate port impedances
without degrading the power efficiency of the amplifier.

   Similar things can be said about the relation between the input impedance
and the noise performance. If an amplifier has an input impedance of 50,
and the input port is connected to a source with an internal impedance of 50
it does not mean that this amplifier contributes as much noise as the source.
At a later stage, we will discuss the design of accurate port impedances with-
out degrading the noise performance of the amplifier.

                                                                                    (3)   +              (5)                 (1)

                                                                                    +                 +                      +

General network model

                                                                                    -                 -                      -

Figure 2.23 shows a general model that can be applied in all situations. The        (4)                                      (2)
model comprises a nullor: a network element that consists of a nullator and
a norator. The nullator sets the network condition: zero voltage across its                           nullator            norator
terminals with no current flow through it. The norator provides an extra
degree of freedom to satisfy this condition by introducing an unknown port          Figure 2.23: Universal 4-terminal network
current Io. In this way, we simply implemented the equations:                       model of a two-port with T1 parameters.

                       V3 - V4 = A(V1 - V2) + BIo,                      (2.31)
                              Ii = C(V1 - V2) + DIo,
52 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                where V3 - V4 = Vi and V1 - V2 = Vo.
                                                      Readers who are not familiar with the concept of the nullor are invited to

                                                  study Chapter 18.
                                                      The MNA matrix stamp of this two-port is:

                                                    0 0 0 0 0 -1 0                   
                                                 0                                    V1

                                                 0  0          0 00 0       1   0     V2  
                                                                                          
                                                  0   C -C 0 0 0            D   1     V3
                                                                                          
                                                  0  =  -C     C  00     0  -D  0     V4       (2.32)
                                                                                          ,
                                                 0  0          0 00 0       0   -1    V5  
                                                                                    

                                                                                          
                                                                                          
                                                  0   0 0 0 1 -1 0 0   Io 

                                                 0  -A A 1 0 -1 -B 0                  Ii

                                              where Vn is the voltage at node (n) with respect to that of the reference node
                                              (0). For more information about modified nodal analysis and matrix stamps,
                                              please refer to Chapter 18.

                                                 The simpler models from Figure 2.24 require at least one nonzero coeffi-
                                              cient in their T1 matrix.

Figure 2.24: Network models of am-            +                       +               +
plifiers that have at least one nonzero
transmission-1 matrix parameter.                                      - ++

    From top to bottom:                                               +                     --
    1. Left: High-level model for amplifiers
having A = 0.                                 -                       -               -
    1. Right: Voltage-controlled voltage
source (VCVS): B = C = D = 0.                 +                                       +     +
    2. Left: High-level model for amplifiers
having B = 0.                                 -                                       -     -
    2. Right: Voltage-controlled current
source (VCCS): A = C = D = 0.                 +             +         +               +
    3. Left: High-level model for amplifiers
having C = 0.                                                                                  +
    3. Right: Current-controlled voltage
source (CCVS): A = B = D = 0.
    4. Left: High-level model for amplifiers
having D = 0.
    4. Right: Current-controlled current
source (CCCS): A = B = C = 0.

                                                            +         -
                                                            -
                                                                      +                        -

                                              -             -         -               -

                                              +             +                         +

                                                            +
                                                            -

                                              -             -                         -

                                              2.4 Modeling of the non-ideal behavior

                                              In this section, we will discuss the modeling of errors that adversely affect
                                              the information processing by the amplifier.

                                                 The amount of information that can be processed by any information pro-
                                              cessing system is limited by the three fundamental physical limitations. Any
                                                         2.4. MODELING OF THE NON-IDEAL BEHAVIOR 53

physical system will:

1. Add noise to the signal

2. Suffer from speed limitations

3. Suffer from power limitations.

   The influence of these limitations on the quality of the information transfer
strongly depends on:

1. The way in which the information is embedded in the signal

2. The applied technology

3. The way in which the observer perceives these errors

   The influence of a particular physical effect that causes information pro-     15 The input port, the output port and the
cessing errors can often be characterized in various ways. There are many         power supply port, see Figure 2.11.
ways, for example, to specify the amount of nonlinearity that can be accepted.
In audio applications, we often use the amount of harmonic distortion, while
for radio applications, the amount of gain compression and third-order inter-
modulation distortion are more useful measures.

   Since the design method for amplifiers as presented in this book can be
used for a wide range of applications, we will use the most common descrip-
tion methods, but we will not discuss the perception of errors for all kinds
of applications. The designer of amplifiers should use error descriptions that
closely match the error perception in the particular field of application.

   Before we begin with the description of the errors that result from the
fundamental physical limitations, we will first pay attention to the non-ideal
isolation between the three amplifier ports. The non-ideal port isolation15
adds unwanted functionality to the amplifier. This undesired functionality
results in a sensitivity of the amplifier to power supply noise and common-
mode noise.

   We will then discuss the modeling of non-ideal behavior due to the influ-
ence of the fundamental physical and the technological limitations. We will
discuss the modeling of the noise behavior, the dynamic behavior and the
nonlinear behavior, and introduce specific amplifier classes related to their
power efficiency.

2.4.1 Modeling of the source and load isolation

                                                                                  Figure 2.25: Measurement setup for deter-
                                                                                  mination of the parameters of the two-port
                                                                                  with non-ideal port isolation

   -  +                            +  +

   +  -                            -  -

+                                                              +

-                                                              -

   Modeling of the non-ideal source-to-load isolation requires a four terminal
network description of the amplifier instead of a two-port model. This sim-
ply follows from network theory: the behavior of an electrical network with
four nodes can be fully described with three nodal equations (a 3 × 3 ma-
trix; see Chapter 18.2). A convenient representation that closely matches the
previous description of the amplifier's behavior would use the transmission
54 MODELING AND SPECIFICATION OF AMPLIFIERS

parameters A, B, C and D, plus five parameters that describe the non-ideal

port isolation. Figure 2.25 shows the model of an amplifier with a floating

input port and its output port referenced to the ground. The sum of the cur-

rents that flow into the input port is defined as the common-mode current Ic.
The information is embedded in the differential-mode quantities Vid, Iid, Vod
and Iod.

   Descriptions for amplifiers with 3 × 3 matrices are rarely found. In prac-

tice, far simpler and, unfortunately, often incomplete description methods

for the imperfect port isolation are used. These simplified methods are only

valid for particular port terminations that are assumed during simplification.

   It is common practice to describe the influence of the imperfect port isola-

tion with the common-mode rejection ratio CMRR, and the common-mode input

impedance Zcm only. Moreover, the CMRR is usually only defined for the
voltage transfer. It is defined as the ratio of a common-mode voltage Vc at
the input of the amplifier and the differential-mode voltage Vid which is re-
quired to compensate for the change in the output voltage Vo due to this
common-mode voltage:

                                             CMRR = Vc .                  (2.33)
                                                           Vid Vod=0

   Alternatively, it can be defined as the ratio of the differential-mode voltage
gain Adm = VVodid and the common-mode to differential-mode voltage conver-
sion gain Acd = VVodc :

                                                     Adm  Vod         Vc
                                                          Vid
                                             CMRR =       =V = .          (2.34)
                                                     Acd   od Vid
                                                          Vc

   The common-mode input impedance is defined as the ratio of the common-
mode input voltage and the common-mode input current:

                                             Zcm = Vc .                   (2.35)
                                                       Ic

   It will be clear that a description of the non-ideal port isolation with only
two extra parameters can never be complete. Different drive and terminating
conditions for each input port terminal, generally result in different values
of the CMRR. This compels us to specify the conditions under which the
CMRR has been measured.

2.4.2 Modeling of the power supply isolation

An even more complex situation occurs if both the input port and the output
port are floating with respect to the power supply port and if there exists a
nonzero transfer from the power supply port to the input port or to the out-
put port, or vice versa. Figure 2.26 shows a network model for this situation.
The voltages at the port terminals with respect to the ground are denoted as
V1 · · · V4. The currents that flow into the input port terminals are I1 and I2,
and the currents that flow out of the output port terminals are I3 and I4.

   The network model of the amplifier in this configuration requires five
nodal equations. Usually one of the power supply terminals is selected as
the reference node. The definitions of the common-mode and the differential-
mode quantities are listed in Table 2.3.

   The coefficients of the 5 × 5 matrix can be divided into nine groups:

1. Four coefficients that describe the differential-mode transfer from input to
   output
                                                  2.4. MODELING OF THE NON-IDEAL BEHAVIOR 55

         -       +                                                               Figure 2.26: Definition of input and output
                                                                                 quantities of a voltage amplifier with
+                        +  +  +                           +                     floating ports.
-
                         -  -  -                           -

           +     -

                            +
                            -

Symbol  Value            Description                                             Table 2.3: Definition of the common-mode
                         differential-mode input voltage                         and differential-mode quantities for the
Vid     V1 - V2          differential-mode input current                         differential amplifier with power supply
Iid                      common-mode input voltage                               from Figure 2.26
Vic     1  ( I1  -  I2)  common-mode input current
Iic     2                differential-mode output voltage
Vod     1                differential-mode output current
Iod     2  (V1   +  V2)  common-mode output voltage
Voc                      common-mode output current
Ioc     I1 + I2          power supply voltage
Vp                       current flow through Vp
Ip      V3 - V4

        1  ( I3  -  I4)
        2
        1
        2  (V3   +  V4)

        I3 + I4

        Vp

        I (Vp )

2. Four coefficients that describe the common-mode input to differential-
   mode output transfer

3. Four coefficients that describe the differential-mode input to common-
   mode output transfer

4. Four coefficients that describe the common-mode input to common-mode
   output transfer

5. Two coefficients that describe transfer from the power supply voltage to
   the common-mode input quantities

6. Two coefficients that describe transfer from the power supply voltage to
   the common-mode output quantities

7. Two coefficients that describe transfer from the power supply voltage to
   the differential-mode input quantities

8. Two coefficients that describe transfer from the power supply voltage to
   the differential-mode output quantities

9. One coefficient that describes the power supply voltage to power supply
   current transfer.

   In situations in which either the input or the output port has one terminal
in common with the power supply port, a 4 × 4 matrix representation is
sufficient.

   However, the port isolation is usually only described by a few parameters.
As stated earlier, such a description can only be accurate if the connection of
the amplifier to its electrical environment is completely specified.

   The most commonly used characteristics are:

1. The CMRR (see definition in expression 2.33).
56 MODELING AND SPECIFICATION OF AMPLIFIERS

                                             2. The Power Supply Rejection Ratio: PSRR.

                                                Like the CMRR, the PSRR is usually defined for voltages only. It is defined
                                                as the ratio between the change in power supply voltage and the input
                                                voltage that must be applied to compensate for its effect at the output:

                                             PSRR = Vp .                              (2.36)
                                                         Vid Vod=0

                                             3. The common-mode input impedance Zcm.

                                             4. The rejection factor F for voltages (for voltage amplifiers with floating
                                                input and output). It is defined as the ratio of the differential-mode voltage
                                                gain and the common-mode voltage gain:

                                             F = Vod Vic .                            (2.37)
                                                   Vid Voc

                                             A large rejection factor, implies a relatively small common-mode transfer,
                                             which, in a case of cascaded differential amplifiers, reduces the influence
                                             of the next stage's common-mode to differential-mode conversion.

-  +

      +  +                                   2.4.3 Modeling of the noise behavior

      -  -                                   The general aspects of noise modeling are discussed in Chapter 19. Readers
                                             who are unfamiliar with noise in electronic circuits are advised to study this
Figure 2.27: Two-port noise model con-       chapter before continuing. They may also want to study the summary on
sisting of two noise sources connected to a  signal modeling to understand the concepts of probability density functions
noise-free two-port.                         and spectral density.

                                                In section 19.2, it has been shown that the noise behavior of a two-port can
                                             be modeled with the aid of two equivalent noise sources. Figure 2.27 shows
                                             a noise model with those two equivalent noise sources at the input port:
                                             a noise current source in parallel with the input port and a noise voltage
                                             source in series with the input port of the amplifier. With the aid of the
                                             Thévenin or Norton transformations, these two sources can be represented
                                             by one equivalent input noise source of the same type as the signal source
                                             (voltage or current source). This makes it possible to model the degradation
                                             of the signal-to-noise ratio due to these two equivalent sources. The noise of
                                             this source is usually called the total equivalent input noise or the total source-
                                             referred noise.

                                                Its evaluation will be elucidated in the following example.

                                                Example 2.8

                                                    We will study the influence of the equivalent noise sources on the signal-to-
                                                noise ratio at the output of the amplifier. Since the amplifier processes noise and
                                                signals in the same way, this can be done by relating the RMS value of the source
                                                voltage or current to the total equivalent input RMS noise voltage or current.
                                                respectively.

                                                    Figure 2.28A shows a situation in which the source signal is a voltage. The
                                                signal-to-noise ratio then needs to be expressed in terms of voltage ratios, hence,
                                                we need to evaluate the total source-referred noise voltage.

                                                    In Figure 2.28A, the amplifier's noise behavior is modeled with the aid of an
                                                equivalent input voltage noise source Vn and an equivalent input current noise
                                                source In. The noise associated with the signal source Vs is modeled by Vns.

                                                    The total equivalent input noise voltage can now be obtained by transforming
                                                the equivalent input current noise source In into an equivalent input voltage noise
                                                source using the Thévenin equivalent of In and Zs, as shown Figure 2.28B. The
                                                result with one equivalent input voltage noise source is shown in Figure 2.28C. If
                                                              2.4. MODELING OF THE NON-IDEAL BEHAVIOR 57

                       -     +        -   +                                       Figure 2.28: Determination of the total
                          +                                                       equivalent input noise voltage for an
                 +                                      +     +                   amplifier driven from a voltage source.

A                -                                      -     -

                    -              -  +   -          +
              +
                                                        +     +

B             -                                         -     -

                                                  -  +
                                +
                                                        +     +

C                               -                       -     -

we assume no correlation between In, Vn and Vns, the spectral density SVn,tot of
the total equivalent input voltage noise Vn,tot can be obtained as:

                          SVn,tot = SVns + SVn + SIn |Zs|2 ,       (2.38)

where SVns [V2/Hz] is the spectral density of Vns, SVn [V2/Hz] is the spectral
density of Vn and SIn [A2/Hz] is the spectral density of In.

Noise figure

The total source-referred noise can thus be evaluated with the aid of its two     16 The noise figure F of a system has been
                                                                                  defined in section 19.3.
equivalent input noise sources, the source impedance and the noise associ-

ated with the source signal. The noise figure F is a measure for the deteriora-
tion of the signal-to-noise ratio due to noise added by the amplifier.16 It can

now alternatively be defined as:

              F = (weighted) total equivalent input noise power .  (2.39)

                               (weighted) source noise power

According to this definition, we obtain:

                                   0 SVn,tot |W( f )|2 d f
                          F=                                       (2.40)
                                   0 SVns |W( f )| d f2

In which W( f ) is a weighting function that models the frequency dependent
noise sensitivity of the observer.

Determination of the equivalent input noise sources

Figure 2.27 shows an amplifier, modeled as a noise-free two-port with two
equivalent noise sources at the input. The spectral densities of these voltage
and current noise sources accurately model the amplifier's noise behavior for
any input port termination.

   In fact, these two noise sources model the contributions of all physical
noise sources that exists in the amplifier. They can be obtained by multi-
plying the internal noise sources of the circuit with the reciprocal values of
their associated transfer functions to the input current and voltage of the cir-
cuit. As a consequence, the equivalent input noise current and noise voltage
58 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                  sources may be partly correlated.
                                                      Transformation of internal noise sources to equivalent input noise sources

                                                  can be performed with the aid of two-port models. This will be elucidated in
                                                  the following example.

                                                  Example 2.9

                                                          We will calculate the total equivalent input noise of an amplifier that is modeled
                                                      as a noise-free two-port with two uncorrelated equivalent output noise sources, as
                                                      shown in Figure 2.29.

Figure 2.29: Noisy amplifier modeled as                                                              +-
noise-free two-port with two equivalent                                +
output noise sources.                          +    +     +             ++                                          +

                                               -          -             --                                          -

                                            We have the following network equations:

                                                      Vi = A B                                        V                (2.41)
                                                      Ii         CD
                                                                                                        o

                                                                                                       ,
                                                                                                      Io

                                                             Vo  =  V    +  Vn,                                        (2.42)
                                                                                                                       (2.43)
                                                                      o

                                                             Io  =  I   +   In,

                                                                     o

                                            where Vn and In denote the equivalent output noise sources. If we substitute the
                                            expressions for Vo and Io in the two-port equations, we obtain

                                                  Vi = A B                            Vo - Vn Io - In .                (2.44)
                                                  Ii         CD

                                            The output noise sources can now be transferred to the input:

                                               Vi + AVn + BIn Ii + CVn + DIn = A B C D                     Vo Io .     (2.45)

Figure 2.30: Circuit equivalent to that of     -          -
Figure 2.29, but now with equivalent input
noise sources.                              +                                         +                    +        +

                                            -                                         -                    -        -

                                               Expression 2.45 and Figure 2.30 clearly show correlation between the volt-
                                            age noise and the current noise. Both the total noise voltage and the to-
                                            tal noise current consist of contributions of the two originally uncorrelated
                                            sources Vn and In. In the next example, we will demonstrate how to evaluate
                                            the total equivalent input noise for partly correlated input noise sources.

                                               Example 2.10

                                                   Let us now connect a signal voltage source Vs with internal impedance Zs
                                               to the input of the amplifier from Figure 2.30, and calculate the total equivalent
                                               input voltage noise.

                                                   Figure 2.31A shows the initial model. The spectral density of the voltage noise
                                                                              2.4. MODELING OF THE NON-IDEAL BEHAVIOR 59

                                                                                                         Figure 2.31:

                                 -  -                               +-                                      A. Amplifier from Figure 2.30 con-
                                                +
                                    +                                                                    nected to a signal source Vs with source

           +                                                               +  +                    +     impedance Zs.
         -
                                                                                                            B. Equivalent noise model.
A
                                                                           -  -                    -
           +
         -                                                                 +  +                    +

B                                                                          -  -                    -

           +                                                               +  +                    +
         -
                                                                           -  -                    -
C

associated with the source is Vns is given as:

                                       SVns = 4kT Re {Zs} .                         (2.46)

   The noise Vns is assumed to be uncorrelated with In and Vn.
   With the aid of the Thévenin transformation, we can convert the current noise
sources into equivalent voltage noise sources. Figure 2.31B shows the result of
this transformation. Figure 2.31C shows the final model in which the total source
referred noise Vntot has been represented with one voltage noise source. The power
spectral density of Vneq of the total noise is obtained as:

              SVntot = 4kT Re (Zs) + |A + CZs|2 SVn + |B + DZs|2 SIn .              (2.47)

                              2        2                                                                 2              3  2                        3

 +                                                                     +n     +
                                                                                  -
 -                                                                                      -

                              1                                                                 +

A                                                                                n

                                       1                               -                                    1

                                                B                                                     C                                 1

   Transformation of noise sources can sometimes be simplified using net-                                Figure 2.32: Network transformation:
work transformation techniques. The use of Thévenin and Norton equivalent                                    (A) Thévenin and Norton equivalent
networks has already been demonstrated in the previous examples. Figure
2.32 shows the Thévenin and Norton transformation, as well as Blakesley's                                networks
voltage shift theorem (see [Blakesley1994]17) and its dual version, the current                              (B) voltage shift theorem
split (redirecetion) theorem.                                                                                (C) current split theorem.

   The current split theorem states that the network solutions remains un-                               17 T. A. Blakesley. A New Electrical The-
changed if a current flowing from node (1) into node (2) is redirected via                               orem. Proc. Phys. Soc. London, 13:65-67,
node (3). The voltage shift theorem states that the network solutions remain                             1994
unchanged if a voltage source is shifted from one branch through a node and
inserted into all the other branches connected to that node.

   Example 2.11

       In this example, we will evaluate the influence of impedance in series and in
   parallel with the signal path on the noise performance using the above network
60 MODELING AND SPECIFICATION OF AMPLIFIERS

                                              transformations.

Figure 2.33:

    The noise sources in this figure are (1)                                         -     +                         (2) -  +
uncorrelated. The plus signs in the figure
                                                                                                                     (2)       +
indicate the summation of the Fourier
                                                                                                                     (2)          Amplifier
Transforms of noise voltages or currents,                                                                                         input port

rather than the summation of RMS val-         A                                                                                -

ues. A: Amplifier with equivalent input          (0)                                                                           +

noise sources, signal (current) source and (1)                                    -     +  -    +                                 Amplifier
impedances in series and parallel with the                                                                                        input port

signal path.                                                                                                        -          -
                                                                                                                    +
B: Vn is shifted through node (2).                                                                                             +

C: The network between node (2) and                                                                                               Amplifier
                                                                                                                                  input port
(0) has been replaced with its Norton
                                                                                                                               -
equivalent circuit: the currents in parallel
                                                                                                                               +
with Yp and the voltages in series with Zse   B
                                                                                                                                  Amplifier
have been totalized.                             (0)                                                                              input port

D: The total noise current in parallel                                  (1)       -     +                                      -

with the input port of the amplifier has                                                   (2)                                 +

been redirected over node (1): the noise                                                                                          Amplifier
                                                                                                                                  input port
currents in parallel with the signal source
                                                                                                                               -
have been totalized.

E: The circuit between node (1) and

node (2) has been replaced with its

F: The series connection of the voltage Thévenin equivalent circuit. C                     -    +

of this Thévenin equivalent circuit and the (0)

source adtmittance Ys has been replaced                                      (1)

with its Norton equivalent circuit; the

currents in parallel with the signal source

have been totalized.

                                              D                                                                        +
                                                                                                                 -

                                              E

                                                                                                                                                              +

                                                                                                                                                                                      Amplifier
                                                                                                                                                                                      input port

                                                                                                                                                -

                                                F

                                                     Let us consider the circuit from Figure 2.33A. It shows a signal current source
                                                  Is with a source admittance Ys, which has been connected to an amplifier through
                                                 a passive network that consists of an admittance Yp in parallel with the signal
                                                 path and an impedance Zse in series with the signal path. The uncorrelated noise
                                                 sources in Figure 2.33A are:

                                              · Ins: current noise associated with Ys. It has a spectral density SIns = 4kT Re(Ys)
                                                 A2/Hz.

                                              · In: equivalent input current noise of the amplifier. It has a spectral density SIn
                                                 A2/Hz.

                                              · Vn: equivalent input voltage noise of the amplifier. It has a spectral density SVn
                                                 V2/Hz.
2.4. MODELING OF THE NON-IDEAL BEHAVIOR 61

· Ip: current noise associated with Yp. It has a spectral density SIp = 4kT Re(Yp)
   A2/Hz.

· Vse: voltage noise associated with Zse. It has a spectral density SVse = 4kT Re(Zse)
   V2/Hz.

   The noise transformation steps have been listed with the figure. Please notice
that all the above noise sources are assumed uncorrelated. Hence, the plus signs
in the figure indicate the summation of the Fourier Transforms of noise voltages
or currents, rather than the summation of RMS values.

   The spectral density SIn,tot of the total equivalent input noise In,tot is obtained
as:

Sin,tot = SIns + SIn |1 + ZseYs|2 + SVn Yp + Ys 1 + ZseYp 2  (2.48)
      + SIp |1 + ZseYs|2 + SVp |Ys|2 .

   Evaluation of the noise performance with the aid of network transforma-
tions, as illustrated in the previous example is not always the fastest or the
most straightforward method. It is also difficult to automate this procedure.

   Clear and straightforward noise analysis can be performed with the aid of
the modified nodal analysis technique. This method is used by SPICE-like
simulators and by SLiCAP.

   The procedure is as follows:

1. Set up the matrix equations of the network and use independent sources
   for uncorrelated noise sources and for the signal source. Correlation be-
   tween noise sources needs to be modeled with the aid of controlled sources.

2. Define the load quantity: a nodal voltage or a current through a voltage
   source.

3. Define the source quantity: the voltage or current of an independent
   source.

4. For each noise source:

(a) Evaluate the squared magnitude of the transfer function from that
   noise source to the load quantity.

(b) Evaluate the contribution to the load-referred noise by multiplying the
   spectral density of that noise source with the result from the previous
   step.

5. The total spectral density of the load-referred noise is found by adding all
   of the above contributions.

6. The total spectral density of the source-referred noise is found by dividing
   the above result by the squared magnitude of the source-to-load transfer.

   This procedure will be elucidated in the example below.

   Example 2.12

       Figure 2.34 shows a signal source represented by a current source Is in parallel
   with a capacitance Cs. This signal source is connected to the input of a noisy
   two-port. An attenuator that consists of a series impedance Zs and a parallel
   admittance Yp has been placed between the current source and the input port
   of the noisy two-port. The noisy two-port is modeled as a noise-free two-port
   with an equivalent-input noise voltage source Ve and an equivalent-input noise
   current source Ie. Noise sources associated with Zs and Yp have been included.
   The spectral densities of the noise sources have been shown in the figure.
62 MODELING AND SPECIFICATION OF AMPLIFIERS

                                             We will determine the spectral density of the total source-referred current noise

                                          using Modified Nodal Analysis. We will use the voltage at node 4 (V4) as the
                                          output variable. By doing so, we do not need to include the noise-free two-port in

                                          the matrix equations. This is allowed if the transfer from V4 to the actual signal
                                          load differs from zero. For the sake of simplicity, we will assume this to be the

                                          case.

Figure 2.34: A capacitive current source  (1)            -                                                    +-    (4)
cascaded with a passive network is con-                       +
nected to the input of a noisy two-port.                                          (3)
                                                                                                                             +     +
                                                                (2)    admittance in
                                                                       parallel with
                                                                       signal path                                           -     -

                                           (0)           impedance in                  equivalent-input                  noise-free two port
                                          Signal source  series with                   noise sources of
                                          with internal  signal path                   the noisy two port
                                          impedance

                                          The MNA matrix equation for the circuit, excluding the noise-free two-port

                                          can be written as:

                                                                              I = MV.                                                 (2.49)

                                             In this equation, I is the vector with the Fourier Transforms of the independent
                                          noise and uncorrelated noise voltages and currents:

                                                              I = 0 0 IY Ie VZ Ve T .                                                 (2.50)

                                          The matrix M is the MNA matrix (see Chapter 18):

                                                               jCs 0          0 0 -1 0 

                                                              0        1      - Z1s 0 1 0 
                                                                       Zs
                                                                              Z1s + Yp 0 0 -1  ,
                                                               0 -1
                                                  M=                      Zs                                                          (2.51)
                                                              0        0      0              00                     1
                                                                                                                             
                                                                                                                             

                                                               -1 1           0 0 0 0

                                                                0      0      -1 1 0 0

                                          and V is the vector the Fourier Transforms of the dependent variables:

                                                            V = V1 V2 V3 V4 IVZ IVe .                                                 (2.52)
                                          The voltage V4 can be obtained with the aid of Cramer's rule:                               (2.53)

                                                                       V4 =   det M    ,

                                                                              det M

                                          where:

                                                               jCs 0          0 0 -1 0 

                                                              0        1      -1             0                   1 0
                                                                         Zs   Zs
                                                                           1  Z1s + Yp IY                                -1  
                                                                    0                                            0
                                                  M =                  - Zs                                                           (2.54)
                                                                                                                             
                                                                                                                                .
                                                                                             Ie                              
                                                              0        0      0                                  0 1

                                                               -1 1           0           VZ 0 0 

                                                                0      0      -1 Ve 0 0

                                          In order to evaluate the source referred noise, we need to know the transfer
                                                             2.4. MODELING OF THE NON-IDEAL BEHAVIOR 63

from the source to V4. This transfer can be obtained as:

        V4 = cofactor(M, 1, 4) ,                                    (2.55)
        Is                               det M

where:

· cofactor(M, 1, 4) = (-1)(1+4) minor(M, 1, 4)

· minor(M, 1, 4) : determinant of matrix M, after deleting row 1 and column 4 :

                              0          1      1- Zs 1 0        

                                         Zs
             0 -1                               Z1s + Yp     -1
                                         Zs               0      
                                                                 
minor(M, 1, 4) = det                                             .  (2.56)
                              0          0      0         0  1   

             -1 1                               0 0 0

                              00                -1 0 0

The source-referred noise Ins can thus be obtained as:

        Intot = VV4 =                        det M .                (2.57)

                           4
                              Is cofactor(M, 1, 4)

   After collecting the terms for each (uncorrelated) noise source, the result can
be written as:

        Intot = Ie (1 + jCsZs)                                      (2.58)
             + IY (1 + jCsZs)
             + Ve Yp + jCs 1 + YpZs
             + VZ jCs.

   In this way, we found the transfer from each noise source to its source-referred
contribution. The spectral density of the total source-referred noise current is
found as the sum of the spectral densities of the individual noise sources, each
multiplied by the squared magnitude of their corresponding transfer:

        SIns = SIe |1 + jCsZs|2

        + SIY |1 + jCsZs|2

        + SVe Yp + jCs 1 + YpZs 2

        +  SVZ                2  C2   .                             (2.59)

                                   s

Determination of the equivalent input noise sources by measurements

If we want to determine the equivalent noise sources through measurements,
we connect a spectrum analyzer to the output of an amplifier and measure the
output voltage noise spectrum SVm [V2/Hz] for two different terminations
for the input port :

1. The input terminals of the amplifier are shorted

2. The input terminals of the amplifier are left open.

   Figure 2.35 shows the noise measurement setup. The amplifier is modeled
as a noisy two-port with transmission-1 parameters A, B, C, D. It has a finite
input impedance Zm.
64 MODELING AND SPECIFICATION OF AMPLIFIERS

Figure 2.35: Determination of the equiv-

alent input noise sources with the aid of     +

noise measurements.                              -
                                                 -
(A) The equivalent input noise voltage                               +

is determined from noise measurements

with the input port shorted. A -

    (B) The equivalent input noise current is

determined from noise measurements with

the input port left open.

                                              +

                                                                     +

                                           B                         -

                                              With shorted input port terminals (see Figure 2.35A), the equivalent input

                                           noise current In flows through the short. The measured output noise must
                                           then be caused by the equivalent input noise voltage source Vn. The spectral
                                           density SVn [V2/Hz] of the input noise voltage Vn can thus be found with the
                                           aid of expression (2.12) as:

                                                    SVn = A +  B2 2
                                                                   SVm [V /Hz].  (2.60)
                                                               Zm

                                              When the input port is left open (see Figure 2.35B), the equivalent input

                                           noise voltage Vn is floating, thus the measured output voltage noise can only
                                           be caused by the equivalent input noise current source In. The spectral den-
                                           sity SIn [A2/Hz] of the input noise current In can then be found with the aid
                                           of expression (2.14) as:

                                                    SIn = C +  D2 2
                                                                   SVm [A /Hz].  (2.61)
                                                               Zm

                                           Design conclusions

                                           Expression 2.48 clearly shows the result of inserting impedances in series or
                                           in parallel with the signal path between the source and the input port of an
                                           amplifier:

                                           1. If an impedance in series with the source has a nonzero real part, it adds
                                               noise.

                                           2. Any nonzero impedance in series with the source increases the contribution
                                               of the equivalent input noise current of the amplifier.

                                           3. If an admittance in parallel with the source has a nonzero real part, it adds
                                               noise.

                                           4. Any admittance in parallel with the source increases the contribution of the
                                               equivalent input voltage noise of the amplifier.

                                           From this, we obtain an important design conclusion:

                                               Insertion of impedances in series or in parallel with the signal path at the input
                                           of the amplifier should be avoided!
                                                                             2.4. MODELING OF THE NON-IDEAL BEHAVIOR 65

   The deterioration of the signal-to-noise ratio due to the insertion of impedances
in series or in parallel with the signal path between the source and the input
of the amplifier can be explained as follows.

   In general, those impedances reduce the available signal power at the in-
put port of the amplifier. Hence, if we first reduce the available power of
the source and then add noise, it will become clear that the signal-to-noise
ratio will be lower compared with the situation in which no attenuator was
inserted.

   Only in narrow-band applications, the insertion of impedances in parallel
or in series with the signal path between the source and the input port of
the amplifier may result in an improvement of the signal-to-noise ratio in the
frequency band of interest. Such situations will be discussed at a later stage.

2.4.4 Modeling of the power efficiency

The power efficiency  of an amplifier is defined as the ratio of the load power
P and the power Ps delivered by the power supply sources of the amplifier:

 = P .                                  (2.62)
      Ps

The ideal amplifier has a power efficiency of at least unity. Real-world am-
plifiers have a power efficiency less than unity.

Two-port model                                                                     18 This will be discussed in Chapter 7.

We have modeled the ideal amplifier as a two-port. The output port of this
two-port can be modeled as a controlled source or, in the case of negative
feedback, as a norator.18 This element delivers the load power in case there
are no impedances placed in series or in parallel with the load. In real world
amplifiers, the power that needs to be delivered by the power supply exceeds
the load power. This is the result of power losses in the amplifier.

   Power losses (dissipation) in amplifiers arise from:

1. Quiescent losses                                                                               Output port
                                                                                                  of two-port
   Electronic circuits may consume power even in the case in which no power
   or energy is transferred to the load. These quiescent losses are measured                         +
   in the absence of a source signal.
                                                                                   delivers
   Quiescent losses can be modeled with the aid of a voltage source VQ and         load power
   a nonlinear resistor RQ. This is shown in Figure 2.36. If VQ is equal to
   the supply voltage, the v - i characteristic of this nonlinear resistor should                 -
   equal that of the power supply port of the amplifier. The quiescent losses
   then equal the power dissipated in this nonlinear resistor.                                Amplifier power port

2. Signal-dependent losses and energy storage                                      delivers   +
                                                                                   quiescent             +
   Voltage drop across devices, as well as current flow through devices, may       power
   result in energy storage or power dissipation in those devices. Energy                                       Nonlinear
   stored in devices that, under dynamic signal conditions, is not fully ex-
   changed with the power supply, contributes to power losses.                                -                resistor

   Signal-dependent power dissipation and energy storage can be modeled            Figure 2.36: Load power delivered by the
   with the aid of two controlled sources: a voltage-controlled source and a       output port and quiescent power delivered
   current-controlled source.                                                      by VQ.

   Figure 2.37 shows the application of a linear voltage-controlled voltage
   source and a linear current-controlled current source for this purpose. In
   this figure, the impedance Zp models the frequency-dependent and signal
   dependent energy storage and power dissipation in the case in which the
   amplifier output terminals have been left open. The impedance Zse models
66 MODELING AND SPECIFICATION OF AMPLIFIERS

Figure 2.37: Load power delivered by the                 Output port      +
output port and load voltage-dependent                   of two-port     -
and load current-dependent power losses
and energy storage, modeled with the                        +          Load current dependent
aid of controlled sources and linear                                   power losses and energy
impedances.                               delivers                     storage
                                          load power

                                                         -

                                          Load voltage dependent   --
                                          power losses and energy  ++
                                          storage

                                             the frequency-dependent and signal dependent energy storage and power
                                             losses in the case in which the amplifier terminals have been shorted.

                                             However, modeling of the power losses and of the energy storage as de-
                                             scribed above is seldom performed. This is because:

                                             (a) Linear models for power losses and energy storage seldom apply to
                                                 real world amplifiers in which those effects usually show a strong non-
                                                 linear relationship with the load voltage and the load current.

                                             (b) The above model does not provide design information other than min-
                                                 imization of energy storage and power losses in elements that carry
                                                 signal.

                                          Impedances in the signal path

                                          We have seen that insertion of impedances in series or in parallel with the
                                          signal path adversely affects the signal-to-noise ratio. Similarly, insertion of
                                          such impedances also reduces the power efficiency. In properly designed
                                          amplifiers, the largest signal excursions occur at the load. For this reason,
                                          care should be taken with insertion of impedances in series or in parallel
                                          with the load:

                                              1. If an impedance in series with the load has a nonzero real part, it decreases
                                                  the power efficiency because it dissipates power.

                                              2. If an impedance in series with the load has a nonzero imaginary part, it in-
                                                  creases the energy storage in the amplifier. If, under dynamic signal con-
                                                  ditions, this energy is not recovered, it results in an increase of the power
                                                  dissipation of the amplifier and reduces its power efficiency.

                                              3. If an admittance in parallel with the load has a nonzero real part, it decreases
                                                  the power efficiency because it dissipates power.

                                              4. If an admittance in parallel with the load has a nonzero imaginary part, it
                                                  increases the energy storage in the amplifier. If, under dynamic signal con-
                                                  ditions, this energy is not recovered, it results in an increase of the power
                                                  dissipation of the amplifier and reduces its power efficiency.

                                             In narrow-band amplifiers, the power efficiency of the amplifier does not
                                          necessarily degrade due to energy storage. In such amplifiers, the power
                                          losses can be minimized with the aid of resonant circuits.
2.4. MODELING OF THE NON-IDEAL BEHAVIOR 67

2.4.5 Power losses and amplifier classes                                             19 Bipolar currents: currents that can flow in
                                                                                     positive and negative directions.
More accurate modeling of the power losses requires knowledge about the
amplifier's internal structure, especially about its output stage.                     Unipolar currents: currents that flow in
                                                                                     either a positive or negative direction.
   Many amplifiers have to provide bipolar currents to their loads.19 The            20 Single-quadrant operation in the v - i
electronic devices from which they are constructed, however, are operating           plane.
in unipolar mode20. As a consequence, devices in output stages can either
source a current to a load, or sink a current from a load as shown in Figure                               +
2.38.
                                                                                               Amplifier
   One method for delivering bipolar currents is to add a bias current to a                    output port
device such that it will conduct for both positive and negative load currents.
Amplifiers that use this principle are referred to as class A amplifiers. Their                         -
output stage is said to operate in class A mode: the output device conducts          Figure 2.38: The amplifier sources current
during the source and the sink phase. Class A output stages suffer from a low        to its load if the current flows out of its
power efficiency. Different classes of output stages have been developed to          positive output terminal. The amplifier
increase the power efficiency of amplifier output stages. A short overview is        sinks current from its load if the current
given below.                                                                         flows into its positive output terminal.

1. Class A: a sourcing output device and a sinking output device both con-           21 Pulse Width Modulated
   duct during the entire source phase and during the entire sink phase.

   Class A amplifiers suffer from a low power efficiency.

2. Class B: a sourcing output device conducts exclusively during the entire
   source phase, while a sinking output device conducts exclusively during
   the entire sink phase.

   A class B amplifier has no overlap between the source and the sink phase.
   In practice, this will never be the case: either there will be an overlap (class
   AB operation) or there will be a dead zone (class C operation). Class B,
   therefore, is a concept without implementations.

3. Class AB: a sourcing output device conducts predominantly during the
   source phase, while a sinking output device conducts predominantly dur-
   ing the sink phase.

   All operational amplifiers and almost all low-frequency non-switching
   power amplifiers have a class AB output.

   The power efficiency of class AB amplifiers exceeds that of class A ampli-
   fiers.

4. Class C: a sourcing and/or a sinking output device conduct only during
   a part of the source phase and/or the sink phase, respectively.

   Class C output stages produce a large amount of distortion due to a dead
   zone in their transfer. In narrow-band applications the resulting distortion
   components can be attenuated with band pass filters. Class C amplifiers
   are often applied as narrow-band RF output stages with a relatively high
   power efficiency.

5. Class D: switching output stage.

   Class D amplifiers have a switching output stage. The information at the
   output of the switching stage is the low-frequency contents of a PWM21
   signal. This low-pass contents is passed to the load through a low-pass
   filter. High-frequency components of the PWM signal are reflected into
   the power supply. This gives the class D amplifier a high power efficiency.

6. Class E: tuned (narrow-band) resonant switching output stage.
       Class E amplifiers are resonant switching amplifiers: a switch closes

   when the voltage across it equals zero. A narrow-band and slightly de-
   tuned series resonator is placed between the switch output and the load.
   Class E amplifiers are applied as RF transmitter amplifiers. They exhibit a
   better power efficiency compared with class C amplifiers.
68 MODELING AND SPECIFICATION OF AMPLIFIERS

7. Class F: tuned (narrow-band) switching output stage with stacked output
   filters
       Class F amplifiers are switching amplifiers with a more complex output
   filter. This filter is designed such that the voltage at the output of the
   switches approximates a square wave, while the load voltage is sinusoidal.
   These amplifiers are used in narrow-band applications.

8. Class G: class AB with step-wise adaption of the power supply voltages
   to the load voltage
       Class G amplifiers have class AB output stages of which the power sup-
   ply voltages are step-wise adapted to the load voltage.
       This technique reduces the power dissipation of the class AB amplifier.

9. Class H: class AB with continuous adaption of the power supply voltages
   to the load voltage
       Class H amplifiers have class AB output stages of which the power
   supply voltages are continuously adapted to the load voltage.
       With this technique, a low and constant voltage drop across the output
   devices minimizes the power dissipation.

   It is common practice to speak of linear amplifiers (class A, B, AB and C)
versus switching amplifiers (class D, E and F). Unfortunately, this is rather
confusing and conceptually wrong. All amplifiers are intended to be linear,
and switching is not the opposite of linear. It would be better to speak of
amplifiers with switching output stages and those with non-switching out-
put stages. Alternatively, one could speak of baseband output stages and
modulating output stages.

   In the following example, we will evaluate the power losses of an amplifier
that periodically charges and discharges a capacitive load.

Example 2.13 The amplifier has a positive supply voltage source with a value

Vp and a negative supply voltage source with a value Vn. In the absence of an
input signal, the amplifier draws a negligible quiescent current. Hence we may

assume class B operation.

When charging the load with a charge q(t), the positive supply delivers the

source current ip(t):

                                             ip(t) = d q(t).           (2.63)
                                                       dt

   The momentary source power P+(t) delivered by the positive supply source
can be calculated as:

                                             P+(t) = ip(t)Vp.          (2.64)

   The average supply power Pc over period T delivered during the charging phase
can be calculated as:

                                             Pc = 1 P+ T (t)dt,        (2.65)
                                                    T0                 (2.66)
                                                                       (2.67)
                                                = 1 ip T (t)Vpdt,      (2.68)
                                                    T0

                                                = 1 q T d (t)Vpdt,
                                                    T 0 dt

                                                = 1 (q(T) - q(0)) Vp,
                                                    T

where q(T) is the load charge at the end of the charging phase, say, Qp, and q(0)
is the load charge at the start of the charging phase, say, Qn, we can write:

                                             Pc = 1 Qp - Qn Vp.        (2.69)
                                                    T

If the load conserves the charge, the power dissipation in the load is zero and
                                               2.4. MODELING OF THE NON-IDEAL BEHAVIOR 69

the power delivered by the positive supply is dissipated in the amplifier.

   During a discharging phase, the negative voltage supply delivers the sink cur-

rent. The average supply power Pd over the period T delivered during the dis-
charging phase can be similarly obtained:

                    Pd = 1T Qn - Qp Vn.                                   (2.70)

   Again, if the load conserves the charge, this power is dissipated in the amplifier.
   Hence, if the amplifier periodically charges and discharges a capacitive load,
the average power dissipation in the amplifier PA can be obtained as:

                    PA = 1 Qp - Qn  Vp - Vn ,                             (2.71)
                            T                                             (2.72)

or, alternatively,

                    PA = f Qpp Vp - Vn ,

where Qpp is the peak to peak charge.
   If the load is a linear capacitor with a capacitance C, we may write:

                    Qpp = CVpp,                                           (2.73)

where Vpp is the peak to peak load voltage. After substitution of (2.72) in (2.73),
we obtain:

                    PA = f C Vp - Vn Vpp.                                 (2.74)

   From this we see that although the amplifier is loaded with a lossless element,
the periodic change of the energy storage in it results in amplifier losses.

2.4.6 Modeling of the small-signal dynamic behavior                                     Figure 2.39: Example of a small-signal step
                                                                                        response of an amplifier.
The ideal amplifier is an instantaneous, linear time-invariant system. How-
ever, due to the fundamental limitation of speed, all real world amplifiers will              1.2           overshoot
behave like dynamic systems. In fact, they will behave like nonlinear dynamic                           rise time
systems. The specification and design of amplifiers, however, is strongly facil-              1.0
itated by separating performance aspects such as nonlinearity and dynamic
behavior. For ease of design, we consider them either as linear(ized) dy-               90%
namic systems or as nonlinear instantaneous systems. At relatively low rates
of change of the signals, such an approach is almost always justified. Hence,                 0.8
the amplifier's behavior for small signals up to high frequencies may be con-
sidered linear dynamic, and its behavior for low speed signals up to large                    0.6       delay time
signal excursions may be considered as nonlinear instantaneous. Behavior at
relatively high rates of change of the signals is often referred to as large signal     50%
dynamic behavior. This will be discussed later.
                                                                                              0.4
   The reader is assumed to be familiar with the modeling of linear time-
invariant dynamic systems. Those who are not, or those who want to refresh              0.2
their knowledge, can find a summary on modeling of linear time invariant-
dynamic systems in Chapter 17.4.                                                        10%

   The small-signal dynamic behavior of an amplifier can be characterized               0.0        0.0  0.2         0.4  0.6  0.8  1.0
with:
                                                                                        Figure 2.40: Characterization of a step
1. Time-domain responses:                                                               response.

   (a) Impulse response h(t). The unit impulse response is only of theoretical
       use.

   (b) The step response a(t) = - t h()d is often used for time domain
       characterization. As a matter of fact, a periodic square wave signal is
       often used instead of a single step. The response to such a periodic
       signal can easily be observed on an oscilloscope (see Figure 2.39).
70 MODELING AND SPECIFICATION OF AMPLIFIERS

22 MFM: Maximally Flat Magnitude.         Characterization of the step response is done in terms of:

                                          i. Settling time: the time it takes before the difference between the sig-
                                             nal value and the final value stays within a predefined error budget

                                          ii. Final value: the value after settling
                                          iii. Ringing, overshoot and undershoot: peak errors with respect to set-

                                             tling value
                                          iv. Delay time: the time it takes to reach 50% of the settling value
                                          v. Rise time: the time it takes to rise from 10% to 90% of the settling

                                             value
                                          vi. Fall time: the time it takes to fall from 90% to 10% of the settling

                                             value
                                          vii. Droop or tilt: rate of change of a relatively slow signal change after

                                             settling

                                          Figure 2.40 shows a step response with the definition of the most im-
                                          portant parameters.

                                   2. Frequency domain description: the transfer function H(j) is the Fourier
                                      transform of its unit impulse response h(t). It can be characterized by:

                                      (a) Bode plots. These plots consist of a magnitude versus frequency plot
                                          |H(j)| and a phase versus frequency plot (j) = arg(H(j))

                                      (b) The transfer bandwidth B of H(j), which is characterized by means
                                         of the low frequency -3dB frequency and the high frequency -3dB
                                          frequency and the order of the low-frequency and high-frequency roll-
                                          off

                                      (c) The group delay () versus frequency: () = -d()/d

                                      (d) The real part and the imaginary part of H(j) versus frequency
                                          This can be a useful presentation for the small-signal port impedances.
                                          If the real part of a port impedances is positive for all frequencies, the
                                          amplifier is stable for all termination impedances of that port. In other
                                          words the reflected power at that port is always less than the power
                                          transmitted to that port.

                                   3. Complex frequency domain description: the system function H(s) is the
                                      Laplace transform of its unit impulse response h(t)

                                      (a) The amplifier's system function H(s) is often characterized by means
                                          of its poles and zeros.
                                          As we will see later, this representation method is often used during
                                          design. Performance evaluation by means of measurements is always
                                          done with time domain of frequency domain measurements.

                                      (b) Poles and zeros are real or complex conjugated.

                                      (c) A system is stable if all system poles have a negative real part.

                                      All these description methods can be translated into each other. The reader
                                   is assumed to be familiar with relations between pole-zero diagrams, Bode
                                   plots and step responses.

                                      Figure 2.41 shows various graphic representations of the small-signal dy-
                                   namic behavior of a second order low-pass transfer function with an MFM
                                   characteristic.22
   2.4. MODELING OF THE NON-IDEAL BEHAVIOR 71

                                        Figure 2.41: Various representations of the
                                        small-signal transfer of a linear stationary
                                        dynamic system.

u

2.4.7 Modeling of the static nonlinear behavior

In this section, we will discuss deviations from the linear behavior of ampli-
fiers. General techniques and for describing stationary instantaneous nonlin-
ear behavior have been summarized in section 17.5. Readers who are not fa-
miliar with Taylor series and with the terms 'offset', 'nonlinearity', 'differen-
tial gain', 'harmonic distortion' and 'intermodulation distortion' are referred
to this section.

Instantaneous, DC and AC behavior                                                  23 DC: direct current
                                                                                     AC: alternating current
Description methods for the static or instantaneous behavior of amplifiers
are valid for amplifiers that behave instantaneously. In practice, this does not
necessarily mean that the amplifier shows no dynamic behavior. It simply
means that dynamic effects are not of interest, or simply neglected because
they are too small. This may be the case if one is only interested in the DC
solution of a network, or if the frequencies of the poles and zeros are outside
the frequency range of interest.23

   In electronics, it is common practice to speak of DC behavior and of AC
72 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                  behavior. The DC behavior of a circuit describes the behavior of a circuit
                                                  all the capacitors of which have been replaced with open circuits and all
                                                  inductors with short circuits, and in which all independent sources have their
                                                  DC values, as described in section 18.3.2. The modified circuit thus shows no
                                                  dynamic elements and behaves instantaneously. The AC behavior of a circuit
                                                  describes the small-signal dynamic behavior at an operating point. The circuit
                                                  is linearized at an operating point, obtained with a DC analysis. This small-
                                                  signal model is also valid at zero frequency. The term AC is thus somewhat
                                                  misleading.

                                                      The operating point of a circuit at a time instant t is the network solution
                                                  of the circuit that instant in time. This solution accounts for flux in inductors
                                                  and charge on capacitors and is generally not the same as the DC operating
                                                  point in which such initial conditions are usually ignored.

                                                      In the network simulation program SPICE, these two operating points are
                                                  known as:

                                                  · The DC operating point

                                                  · The operating point using initial conditions (UIC).

                                            Example 2.14

                                                An amplifier with a frequency-independent transfer between 10Hz to 10MHz
                                            shows an approximate instantaneous behavior over this frequency range. The
                                            DC transfer of this amplifier may, however, strongly differ from the AC transfer
                                            over this frequency range. An audio amplifier, for example, should behave in-
                                            stantaneously at audible frequencies, however, a nonzero DC transfer is neither
                                            necessary nor desirable.

                                            Amplifiers that need to transfer signals with zero frequency are usually
                                         called DC amplifiers.

Figure 2.42: Example of a static Ip(Vp)  Bias and offset quantities
relation of an amplifier port.
                                         In section 2.2, we have characterized the instantaneous behavior of amplifiers
                                         with three curves:

                                         1. The input port's v - i characteristic

                                         2. The input port to output port transfer characteristic

                                         3. The output port's v - i characteristic.

                                            For ideal amplifiers, these curves are straight lines through the origin, but
                                         in practice, these curves will be nonlinear and not pass the origin.

                                            Figure 2.42 shows an example of a static nonlinear v - i characteristic of
                                         a port. If we can select a point Q = (VpQ, IpQ) of this curve as the desired
                                         quiescent operating point of that port, this means that, in the absence of a
                                         signal, the port should operate in Q. This can be achieved by inserting a
                                         bias voltage source VpQ in series with the port and a bias current source IpQ in
                                         parallel with the port, as shown in Figure 2.43. By doing so, the quiescent
                                         operating point of the port becomes (VpQ, IpQ), while that of the termination
                                         (source or load) is (0, 0). Hence, in this way, the poert operates in its de-
                                         sired operating point, which does not depend on the DC characteristics of a
                                         passive, nonlinear termination.

                                            Application of the correct operating point to electronic devices is called
                                         biasing. In practice, after the devices have been biased, small offset errors
                                         may remain due to device tolerances, supply voltage variations, temperature
                                         variations and other causes. The influence of those small offset errors can be
                                         evaluated in a similar way as noise: small output offsets may be converted
                                                                      2.4. MODELING OF THE NON-IDEAL BEHAVIOR 73

-operating point                                                +-                                            Figure 2.43: Insertion of a bias voltage
+termination:                    +
                                                                                         + operating point    source VpQ in series with the port and a
                            -                                                                                 bias current source IpQ in parallel with the
                                +                                                                      port:  port, shifts the operating point of the port
                                                                                                              with v - i characteristics depicted in Figure
                                                                                      -                       2.42 from (0, 0) to (VpQ, IpQ).

-                                                                                                             Figure 2.44: The influence of small input
                                                                                                              port and output port offset voltages and
                                   +                               +                                          currents can be evaluated in a similar way
                                                                                                              as has been done with noise sources.

                                   -                               -

into equivalent input offsets, or vice versa, using a linearized model for the                                +          + Amplifier
two-port.                                                                                                                - port
                                                                                                                      +
   Figure 2.44 shows a two-port of which those offset errors have been mod-                                   --
eled with the aid of equivalent input current and voltage offset sources. As
with noise, two equivalent offset sources are required for correct modeling                                   Figure 2.45: The common-mode bias
for all DC port terminations.                                                                                 voltage of an amplifier port is defined as:

Common-mode port bias quantities                                                                                Vbias = 2 VP +VN .
                                                                                                                The port terminal bias currents are IP
Although we do not (yet) want to discuss the detailed design of electronic am-                                and IN for the '+' and the '-' port terminal,
plifiers, we should realize ourselves that practical amplifiers always exhibit                                respectively.
limitations that directly depend on the properties of the electronic devices
from which they have been constructed.

   One of those limitations is that the operating voltage of electronic devices
is limited by the power supply voltage and by the breakdown voltages of
these devices. This poses limitations to the amplifier's terminal voltages,
which is of particular interest for amplifiers with floating ports. In those
cases, proper (common-mode) operating conditions for the floating port need
to be provided by external circuitry.

· The common-mode bias voltage of an amplifier port is defined as half the
   sum of the port terminal voltages that need to be applied for correct port
   operation.

· The bias current is defined as the current that needs to flow into a port
   terminal for proper port biasing.

These definitions have been elucidated in Figure 2.45.

Clipping and voltage and current drive capability

The current and voltage drive capability of amplifiers is limited by the power
supply and by voltage and current limiting mechanisms in the amplifier itself.
If an amplifier delivers its maximum drive capability, we speak of clipping or
hard-limiting of the output signal. It is usually characterized by the maximum
voltage the amplifier can deliver for a given output current or vice versa.
74 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                  Weak nonlinearity

                                                  When operating in the normal operating region (no clipping), the source to
                                                  load transfer is intended to be linear. However, imperfections in the oper-
                                                  ating mechanism of the amplifier usually cause so-called weakly nonlinear
                                                  behavior. The perception of signal processing errors due to weakly nonlinear
                                                  behavior strongly depends on the way in which the information is embed-
                                                  ded in the signal and the way in which the error is perceived by the observer.
                                                  For this reason, there exist many different description methods for nonlinear
                                                  behavior. Harmonic distortion, intermodulation distortion, gain compression
                                                  and differential gain all express a specific perception of such behavior. In gen-
                                                  eral, terms that accurately describe the observer's error perception should be
                                                  used. In radio applications, intermodulation distortion and gain compres-
                                                  sion often closely describe the phenomena observed. Nonlinear behavior of
                                                  amplifiers in control systems can better be characterized by their differential
                                                  gain.

24 Also: time-invariant or fixed.  Harmonic distortion

                                   Sinusoidal signals retain their shape in linear stationary dynamic systems.
                                   The nonlinearity of a stationary24, nonlinear system can thus be characterized
                                   by the amount of distortion in the response to a sinusoidal excitation. The
                                   total harmonic distortion (THD) is defined as

                                                               THD = 1        n=     (2.75)
                                                                          d1
                                                                               d2n,

                                                                              n=2

                                   where dn is the amplitude of the n - th harmonic in the output signal.
                                      Even order nonlinearity causes even harmonic distortion as well as signal-

                                   dependent offset. This can easily be seen from the following expression:

                                   A cos2 x = A + A cos 2x.                          (2.76)
                                                  22

                                   This phenomena is known as "operating point shift" or "bias point shift".

                                   Intermodulation distortion

                                   If the excitation of a stationary non-linear system consists of two sinusoidal

                                   components with different frequencies 1 and 2, nonlinearity will give rise
                                   to output signal components at multiples of 1 and 2 (known as harmonic
                                   distortion) and at m1 ± n2 (m and n are integers). The latter effect is called
                                   intermodulation distortion. The amplitudes of the signal components at these

                                   frequencies will be denoted as Am1±n2 .
                                      The second-order intermodulation distortion I M2 is defined as the relative

                                   magnitude of the component in the output signal with m = 1 and n = 1,

                                   when the components at 1 and 2 have equal amplitudes:

                                                               I M2 = |A1±2 | .      (2.77)
                                                                          |A1 |

                                      The third-order intermodulation distortion I M3 is defined as the relative
                                   magnitude of the component with m = 2 and n = 1, or m = 1 and n = 2,

                                   when both the components at 1 and 2 have equal amplitudes:

                                   I M3 = A1±22 = A21±2 .                            (2.78)
                                                               |A1 |          |A1 |
                                                                             2.4. MODELING OF THE NON-IDEAL BEHAVIOR 75

2.4.8 Modeling of the dynamic nonlinear dynamic behav-
         ior

The characterization of the large signal dynamic behavior, or the nonlinear
dynamic behavior of amplifiers, also strongly depends on the perception
of errors by the observer. In transceiver amplifiers, intermodulation distor-
tion and gain compression are effects that are used to characterize nonlinear
behavior. For video amplifiers and amplifiers in negative feedback control
loops, differential gain and differential phase are often used. Other perfor-
mance parameters for characterizing nonlinear dynamic behavior, such as
overdrive recovery, slew rate limitation and hysteresis will be introduced in
this section.

Harmonic distortion

Harmonic distortion can also be used to characterize the large signal dynamic
behavior of amplifiers. In nonlinear dynamic systems, the relation between
harmonic distortion and differential gain, as found in 17.35 for instantaneous
nonlinear systems, is not longer valid.

Intermodulation intercept points

In Chapter 17 is has been shown that at low distortion levels, the amplitude
of the I M2 component is proportional to the squared amplitude of the input
signal, while the amplitude of the I M3 component is proportional to the third
power of the amplitude of the input signal. Hence, if we plot the output
power Po versus the input power Pi on a double logarithmic scale, we can
predict the I M2 and I M3 distortion levels at any input signal level from the
intermodulation intercept points. This is shown in Figure 2.46.

                       extrapolated                                               Figure 2.46: Definition of the intermodula-
                       linearized transfer                                        tion intercept points IP2 and IP3.
                       slope = 1

                 [dB]

output power                                       [dB]
second-order IM
                        extrapolated
output power            IM2 curve
third-order IM          slope = 2
                       extrapolated
                       IM3 curve
                       slope = 3

   The IP2 (second order I M intercept point) is the intersection point of the
extrapolated output level line Pout(Pin) and the I M2 level line. The IP3 (third
order I M intercept point) is the intersection point of the extrapolated output

level line and the I M3 level line.
   The coordinates IP2i , IP2o and IP3i , IP3o of these intercept points can be

obtained from the second and third-order intermodulation distortion levels:

IP2i , IP2o = (Pi + |I M2| , Po + |I M2|) ,              (2.79)
76 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                         IP3i , IP3o = Pi + I M3 2 , Po + I M3 2 ,  (2.80)

                                            where Pi and Po are the input power and the output power in dB at one fre-
                                            quency component applied for the intermodulation distortion measurement,

                                            respectively. I M2 is the power of the second order intermodulation distor-
                                            tion component in dB relative to the power of the fundamental, and I M3
                                            is the power of the third order intermodulation distortion component in dB

                                            relative to the power of the fundamental. Input power levels should be at a

                                            level where quadratic and qubic extrapolation of the I M2 and the I M3 are
                                            justified, respectively.

                                            1dB compression point

25 Weakly nonlinear systems exhibit a       At high input levels, the gain usually drops due to clipping of the load sig-
smooth transition from linear to clipping.  nal. This gain compression is shown in Figure 2.46. The 1 dB compression
                                            point is defined for a sinusoidal input signal, as the input level at which the
                                            (large-signal) gain drops 1 dB with respect to the small-signal gain. Gain
                                            compression is a consequence of odd nonlinearity. For systems with that ex-
                                            hibit a weak nonlinearity25, the relation between the 1 dB compression input
                                            level X-1dB, and the IP3 input level XIP3, can be determined as:

                                                         20 log10  X-1dB   = -9.6 dB                (2.81)
                                                                    XIP3

                                            Differential gain and differential phase

                                            In dynamic nonlinear systems, the differential gain depends on the frequency.
                                            Since the small-signal gain in dynamic systems is a complex quantity, the
                                            differential gain is a complex quantity as well, with both a magnitude and a
                                            phase (differential gain and differential phase).

Figure 2.47: Response of an amplifier       Slew rate limitation
to a square wave. This response suffers
from slew-rate limitation and ringing. The  In electronic amplifiers, clipping of amplifier stages may give rise to lim-
amplifier behaves as a nonlinear dynamic    itation of the rate of change of the output signsl. This slew rate limitation
system.                                     generally arises from two effects:

                                            1. Limitation of the current through capacitors

                                            Let Imax be the maximum current for charging a linear capacitor with ca-

                                            pacitance C. The maximum rate of change of the capacitor voltage is then

                                            obtained as            dV = Imax .
                                                                   dt max C
                                                                                                    (2.82)

                                            2. Limitation of the voltage across inductors

                                               Let Vmax be the maximum voltage that can be applied across a linear in-
                                               ductor with inductance L. The maximum rate of change of the inductor
                                               current is then obtained as:

                                                                   dI = Vmax .                      (2.83)
                                                                   dt max  L

                                            Full-power bandwidth

                                            The full-power bandwidth is defined as the maximum frequency for which
                                            the system can deliver its maximum peak to peak sinusoidal output signal
                                            without distortion due to slew rate effects. Let yp be the maximum amplitude
                                                                                 2.5. CASCADED AMPLIFIERS 77

of a sinusoidal signal delivered by a system at a frequency for which it can
be considered to be instantaneous. If we increase the frequency, the rate
of change of the output signal will increase. The maximum frequency f f p
(full power frequency) at which the system with a slew rate SR can deliver a
sinusoidal output signal with an amplitude yp can be determined as

f f p = SR 2yp .  (2.84)

Hysteresis

Hysteresis is a nonlinear memory effect. A system with hysteresis shows
a different behavior for rising and falling slopes of the input signal. Such a
behavior can be quasi-static, which means that is does not depend on the rate
of change of the signal. In such cases we speak of rate-independent hysteresis.

Overdrive recovery                                                               Figure 2.48: Response to a sinusoidal signal
                                                                                 of an amplifier that has its input driven
The signal excursions at the amplifier's output are limited by the power sup-    outside its specified operating range. This
ply voltage. When the maximum excursion is achieved, any increase of an          effect is called phase reversal.
input signal generally causes an increase of energy storage in the amplifier.
After the excessive drive signal has been removed, it will generally take some
time before the amplifier returns to its normal state. This phenomenon is
called overdrive recovery. The overdrive recovery time specifies the time the
amplifier needs to return to its linear operating range. Figure 2.48 shows so-
called phase-reversal, an even more harsh effect when an amplifier is driven
outside its specified operating range.

2.4.9 Modeling of temperature effects

The characteristics of electronic devices all depend on temperature. As a re-
sult, the characteristics of amplifiers will depend on temperature. Hence, all
characteristics that have been discussed in this chapter depend on temper-
ature. A change of a performance parameter over time is often referred to
as drift. Since temperature slowly varies with time, we speak of temperature
drift that results in offset drift, bandwidth drift, etc.

   Due to power dissipation in the amplifier, temperature drift may become
signal-dependent. Gain and offset drift may then be observed differently, for
example, as a slow droop or tilt in the step response.

2.4.10 Ageing

The change of amplifier characteristics over time is called ageing. On a time
scale, parameter changes due to ageing are usually much slower than param-
eter changes due to temperature drift.

2.5 Cascaded Amplifiers                                                          +  +  ++  +  +

The available power gain of amplifiers or amplifier stages can be increased      -  - -- -    -
by using cascaded amplifiers or amplifier stages. In this section, we will
discuss the behavior of cascade connections of amplifiers. Figure 2.49 shows     Figure 2.49: A cascade connection of two
a cascade connection of two two-ports. The output of the first two-port is       two-ports.
connected to the input port of the second.

   If we want to design a system that consists of two or more cascaded sub-
systems, we need error distribution methods for specification of the perfor-
mance of each subsystem. In this section, we will give expressions for the
78 MODELING AND SPECIFICATION OF AMPLIFIERS

                                            evaluation of the total error due to the limitations of noise, speed and power.
                                            These expressions form the basis for error distribution in designing cascaded
                                            systems.

                                               The transmission parameters of a two-port that consists of the cascade
                                            connection of two two-ports, as shown in Figure 2.49 are:

                                            ViIi = A1 A2 + B1C2 A1B2 + B1D2 A2C1 + C2D1 B2C1 + D1D2     Vo Io ,  (2.85)

                                            where A1, B1, C1, D1 and A2, B2, C2, D2 are the transmission parameters of the
                                            first and the second two-port of the cascade connection, respectively.

                                            2.5.1 Port isolation

                                            In section 2.4.2, we have seen that the non-ideal port isolation of an ampli-
                                            fier is usually described with a few parameters. Under well-specified condi-
                                            tions for source, load and power supply, such simplified descriptions can be
                                            meaningful. Figure 2.50 shows two cascaded differential voltage amplifiers
                                            that have been connected to one power supply. Under appropriate drive con-
                                            ditions, the port isolation properties of the amplifier chain can be estimated
                                            from the port isolation properties of the individual amplifiers. We will give
                                            some expressions in the following paragraphs.

Figure 2.50: Cascaded differential voltage                                                                 -
amplifiers.                                                                                                +

                                                                   1                                 3

                                            +                         +  +  +               +           +

                                            -+                        -  -  -               -+ -

                                                                   2                             4

                                                              -                                      -

                                            Rejection Factor

                                            If n amplifiers form a cascaded amplifier chain, the rejection factor of the

                                            chain Ftot can be obtained from the rejection factors Fi of the amplifiers that

                                            constitute the chain:

                                                                         Ftot = F1F2...Fn.                       (2.86)

                                            Please consider the remarks about the completeness of such a description set
                                            down in section 2.4.2.

                                            Common-Mode Rejection Ratio

                                            If n amplifiers form a cascaded amplifier chain, the common-mode rejection

                                            ratio of the chain CMRRtot can be obtained from the common-mode rejection
                                            ratios CMRRi and the rejection factors Fi of the amplifiers that constitute the
                                            chain:

                                            1 = 1 + 1 + ... +                                           1.       (2.87)
                                            CMRRtot CMRR1 F1CMRR2                           F1 F2 Fn-1 C M R Rn
                                                                                                         2.5. CASCADED AMPLIFIERS 79

   The index number i refers to the amplifier's position in the chain; i = 1
refers to the first amplifier and i = n to the last amplifier of the chain.

   Please consider the remarks about the completeness of such a description
as set down in section 2.4.2.

   If the rejection factor of all amplifiers is much larger than unity, and their
common-mode rejection ratios are in the same order of magnitude, then the
total common-mode rejection ratio approximates that of the first amplifier in
the chain.

Power Supply Rejection Ratio

If n amplifiers in a cascaded amplifier chain are connected to the same power

supply source, the power supply rejection ratio of the chain PSRRtot can be
obtained from the power supply rejection ratios PSRRi and the gains Ai of
the individual amplifiers. The index number i refers to amplifier's position
in the chain; i = 1 refers to the first amplifier and i = n to the last amplifier

of the chain.

   We will give the expression for voltage amplifiers (Avi is the voltage gain
of the i - th voltage amplifier):

    1 = 1 + 1 + ... +                              1               .  (2.88)
PSRRtot PSRR1 Av1PSRR2                 Av1 ... Av(n-1)    PSRRn

Please consider the remarks about the completeness of such a description as
they have been made in section 2.4.2.

   If the gain of all amplifiers is much larger than unity, and their power
supply rejection ratios are in the same order of magnitude, then the total
power supply rejection ratio equals that of the first amplifier in the chain.

2.5.2 Noise behavior

The noise figure of a system that consists of cascaded amplifiers that have a      26 H.T. Friis. Noise Figures of Radio
finite nonzero available power gain, can be calculated from the noise figures      Receivers. Proceedings of the IRE, 32:419-
and the available powers gains of the individual amplifiers. This was shown        422, February 1944
by Friis (see [Friis1944]26).

   For n cascaded subsystems from which the input of the first system is
connected to the signal source and the input of each following subsystem
is connected to the output of the previous subsystem, the total noise factor
NFtot can be expressed as:

NFtot = NF1 + NF2 - 1 + ... + NFn - 1 ,                               (2.89)
                              Ap1      A p1 ... A p(n-1)

where NFi [-] is the noise factor of subsystem i, calculated with respect to the
output impedance of its driving subsystem, and Api [-] the available power
gain of subsystem i.

   Given a unilateral voltage amplifier with voltage gain Av, an input resis-
tance Ri and an output resistance Ro, and driven from a source impedance
Rs, the available power gain can be written as

Ap =                             Ri    2 2 Rs                         (2.90)
                              Rs + Ri   Av .
                                             Ro

Expression 2.89 is only useful for situations in which the cascaded amplifiers
have a nonzero, finite output resistance. This is often the case in so-called
characteristic impedance systems. If this is not the case, the noise of cascaded
amplifiers can be evaluated with the aid of the techniques described in section
2.4.3.
80 MODELING AND SPECIFICATION OF AMPLIFIERS

2.5.3 Small-signal dynamic behavior

If n amplifiers form a cascaded amplifier chain, the small-signal transfer func-
tion Htot(j) can be obtained as the product of the transfer functions Hi(j)
of all amplifiers in the chain:

Htot(j) = H1(j)H2(j)...Hn(j).                                             (2.91)

The pole-zero patterns of all constituting amplifiers thus have to be added.

2.5.4 Static nonlinear behavior

The small-signal gain of a chain of n cascaded amplifiers that all operate

at their quiescent operating point is the product of the small-signal gains

of the individual amplifiers. This simply follows from expression 2.91. If

the amplifiers show nonlinear behavior, the gain at an excursion from the

quiescent point differs from that at the quiescent operating point. This can

be expressed with the aid of the differential gain error. Let Ai be the gain
at the quiescent operating point of an amplifier located at position i in the
amplifier chain, and let i(yi) be the differential gain error of that amplifier
at an output signal excursion yi from the quiescent operating point. Then,
if the amplifier's nonlinearity is small, the small-signal gain Ai(yi) at output
excursion yi can be approximated by

                                             Ai(yi) = Ai (1 + i(yi)) .    (2.92)

If the signal excursion from the quiescent point at the output of the last am-
plifier in the chain equals y, the excursion at the output of the i - th amplifier
in the chain can be approximated by

                                             yi = y A . i+1 Ai+2...An     (2.93)

We then obtain the total differential gain tot of the amplifier chain as

tot = 1 y + 2 y + ...                                                     (2.94)
                                             A2 A3...An  A3 A4...An

2.6 Amplifier requirement specification

In this chapter, we have discussed the modeling and characterization of am-
plifiers. We have found description methods for their ideal behavior and for
their non-ideal behavior. Now, we will use this knowledge for the specifica-
tion of amplifiers. In section 2.6.1, we will discuss the so-called operational
requirements of application-specific amplifiers. Operational requirements de-
scribe the desired functionality, the performance measures, the cost factors
and the environmental conditions that apply during the process of opera-
tion. This process, however, is not the only process that introduces design
constraints. Generally, all life-cycle processes (see section 1.2.1) generate vari-
ous requirements that need to be accounted for during design. As a matter
of fact, even the requirements of the design process itself may seriously limit
the set of possible solutions. A few remarks on relevant requirements that
follow from those life-cycle processes will be made in section 2.6.2.

2.6.1 Operational requirements

A complete list of performance aspects for application-specific amplifiers can-
not be given. The definition of relevant performance aspects and limitations,
                                                                             2.6. AMPLIFIER REQUIREMENT SPECIFICATION 81

as well as the definition of available resources and environmental conditions,
needs to be extracted from a description of the application of the amplifier
to be designed. This task is usually performed by experienced system ar-
chitects. However, based on the knowledge acquired in this chapter, we can
make a list of groups of items that usually need to be described.

   As mentioned above, setting up the requirements for a design usually
starts with describing the application of the amplifier. This comprises a de-
scription of:

1. The signal processing task to be performed by the amplifier (also: fucn-
   tional specification)

2. The quality level of the execution of these tasks (also: performance mea-
   sures)

3. The environment in which the signal processing takes place (also: envi-
   ronmental conditions)

4. The resources that are available for the performance of this task (also: cost
   factors).

   The description of the application needs to be translated into a clear list of
measurable properties of the amplifier, including their test methods and test
conditions. During the design of the amplifier, the performance measures of
various design alternatives with their specific cost factors can be compared.
Design choices can then be made on grounds of the performance-to-cost ratio.

Performance requirements

The performance requirements describe the electrical properties of the am-
plifier that are required for its proper operation in the application, as well
as their test methods. The following list of specification items is usually re-
quired (but not complete!).

1. Input port requirement specification
   Relevant performance aspects for the input port are:

   (a) Input port configuration (grounded, floating)
   (b) Input impedance
   (c) Input signal specification

   In many cases, these specifications need to be extracted from the source
   specification:

   (a) Source configuration (grounded, floating)
   (b) Source impedance
   (c) Source signal specification (current or voltage , frequency spectrum,

       rate of change, peak values, etc.)

2. Output port requirement specification
   Relevant performance aspects for the output port are:

   (a) Output port configuration (grounded, floating)
   (b) Output impedance
   (c) Output signal specification

   In many cases, these specifications must be found from the load specifica-
   tion:
82 MODELING AND SPECIFICATION OF AMPLIFIERS

                                                      (a) Load configuration (grounded, floating)
                                                      (b) Load impedance
                                                      (c) Load signal specification (current or voltage, frequency spectrum, rate

                                                          of change, peak values, ...)

                                                  3. Signal transfer specification (type, value and error budgets)
                                                      Relevant performance aspects for the signal transfer are usually derived
                                                      from the source and the load specification and from the specification of
                                                      the environmental conditions. Usually, error budgets should be given for:

                                                      (a) Imperfect port isolation (common-mode port impedances, CMRR and
                                                          PSRR)

                                                      (b) Noise addition
                                                      (c) Small-signal dynamic behavior (frequency range and filter characteris-

                                                          tics)
                                                      (d) Static nonlinear behavior (offset, gain error, nonlinearity, voltage and

                                                          current clipping)
                                                      (e) Nonlinear dynamic behavior (slew rate, overdrive recovery)

                                                  Operating conditions

                                                  The operating conditions represent the environmental conditions under which
                                                  the amplifier should perform according to its requirements. All environmen-
                                                  tal conditions that affect the operation of the amplifier should be specified.
                                                  Amongst others, the operating conditions listed below are relevant to the
                                                  functioning of electronics in general.

                                                  1. Temperature (affects electrical properties of all electronic devices and ther-
                                                      mal noise)

                                                  2. Humidity (may cause parasitic current paths between devices)

                                                  3. Shock and vibration (may cause defects in connections and in electronic
                                                      devices)

                                                  4. Electro Magnetic Interference (EMI: may cause degradation of signal qual-
                                                      ity or failure during operation)

                                                  5. Power supply noise

                                                  6. Electro Static Discharge (ESD: may cause degradation of the performance
                                                      of devices or failure of devices)

                                                  Operating cost factors

                                                  The operating cost factors are the resources that are required for the operation
                                                  of the amplifier. Typical resources are:

                                                  1. Power supply voltage(s) and current(s)

                                                  2. The amount of space

                                                  3. The maximum mass or weight

                                                  Reliability requirements

                                                  Some examples of reliability requirements are:

                                                  1. Mean Time To Failure (MTTF)

                                                  2. Mean Time To Repair (MTTR)

                                                  3. Mean Time Between Failures (MTBF)
                                                                             2.6. AMPLIFIER REQUIREMENT SPECIFICATION 83

Safety requirements
Safety regulations for electronic products strongly depend on the applica-
tion domain (consumer, automotive, industrial, medical, space) and on the
nationality or region of use (e.g. CE compliance and UL compliance).

2.6.2 Requirements from other life cycle processes

Although the operating process is the most important life-cycle process of
the amplifier, other life-cycle processes may introduce serious design con-
straints. Life-cycle design is the name for a design process that accounts for
requirements from all life-cycle processes. We will restrict ourselves to a few
remarks on certain life-cycle processes.

Design
The availability of design resources such as device models, device samples,
design tools and design verification tools may seriously limit the solution
space.

Production
Electronic circuits are usually produced in standardized production processes.
Such processes introduce design constraints that have to be accounted for.
Design For Production (DFP) indicates that production aspects have been
accounted for during design.

Test
Test processes and the availability of test tools also introduce design con-
straints that have to be accounted for. Design For Testability (DFT) indicates
that test aspects have been accounted for during design.

Transport
Environmental conditions during transportation, as well as cost factors, may
strongly differ from those during operation. This has to be accounted for
during design.

Installation
The availability of tools for installation may put specific constraints on the
design of an amplifier.

Service
The availability of tools, as well as the service environment, may introduce
specific constraints that have to be accounted for during design
                                                              85

3Amplification Mechanism

3.1 Introduction                                          86

3.1.1 Active devices                                      86

3.1.2 This chapter                                        86

3.2 Two-terminal resistive elements                       86

3.2.1 Voltage-controlled and current-controlled notation  87

3.2.2 Resistive two-terminal elements                     87

3.2.3 Complementary devices                               88

3.2.4 Operating point                                     88

3.2.5 Linearization and available power gain              90

3.3 Multi-terminal resistive elements                     91

3.3.1 Complementary multi-terminal elements               91

3.3.2 Resistive two-ports                                 91

3.3.3 Complementary two-ports                             91

3.3.4 Operating point                                     91

3.3.5 Linearization and available power gain              92

3.4 Introduction to biasing                               93

3.4.1 Independent and dependent bias sources              93

3.4.2 Biasing of 3-terminal elements                      94

3.4.3 Amplification mechanism                             94

3.4.4 Deriving the bias sources from the power supply     95

3.5 Conclusions                                           96

3.5.1 Generalized biased active device                    96
86 AMPLIFICATION MECHANISM

                                 3.1 Introduction

                                                  In Chapter 2, we discussed the characterization of amplifiers. We concluded
                                                  that an amplifier should provide its load with an accurate copy of its source
                                                  signal, while the power available to the load should exceed the available
                                                  power of the source. In this chapter, we will discuss the principle of am-
                                                  plification, as it is based upon the application of nonlinear, passive devices
                                                  and power sources. We will discuss under which conditions the available
                                                  small-signal power gain of a network comprising nonlinear, passive devices
                                                  and bias sources can exceed unity. To this end, a formal introduction of the
                                                  concepts operating point, biasing and available power gain will be presented.

1 According to network theory, a network      3.1.1 Active devices
delivers power if the sum of the products
of its branch currents and the correspond-    Electronic devices with amplifying capabilities, such as, MOSFETs, Junction
ing branch voltages is negative.              FETs, Bipolar Junction Transistors and Vacuum Tubes are often referred to as
                                              active devices. However, the adjective active is somewhat misleading. These
                                              devices themselves are passive because they do not provide any electrical
                                              power. The term active means that when these devices are properly com-
                                              bined with power sources it appears as if they can provide electrical power
                                              themselves.1 From now on, we will also use the term active devices, while
                                              bearing in mind the fact that we actually refer to passive devices that require
                                              power sources to behave as such.

                                              3.1.2 This chapter

                                              In this chapter, we will show the way in which passive devices have to be
                                              combined with power sources, such as to obtain amplifying capabilities. In
                                              section 3.2 we will do this for two-terminal, passive, resistive elements. We
                                              will also give a formal definition of complementary elements and of the concepts
                                              operating point, biasing and available power gain.

                                                 In section 3.3 we will discuss the deployment of the amplifying capabilities
                                              of biased, passive, resistive, multi-terminal elements and especially of biased,
                                              passive, resistive, two-ports and biased, passive, resistive three-terminal ele-
                                              ments.

                                                 In section 3.4 we will give a formal approach to the biasing of electronic
                                              devices. We will discuss the selection of independent and dependent bias
                                              sources and briefly introduce methods to derive those sources from the power
                                              supply sources. We will also discuss the application of a biased, passive,
                                              three-terminal element as basic amplifier stage and elucidate the amplifica-
                                              tion mechanism.

2 Or, alternatively, the voltage across them  3.2 Two-terminal resistive elements
equals zero if they are left open,
                                              Two-terminal, resistive elements are two-terminal network elements whose
+                   +                         behavior can be described with an instantaneous v - i relation. Hence, the
                                              shape of their v - i plot does not depend on the rate of change of thevoltage
                -            -                or the current across the resistive element. Passive, resistive, two-terminal
                                              elements have their v - i characteristic pass through the origin: they do not
voltage-controlled  current-controlled        carry any current when shorted.2 Figure 3.1 shows the schematic symbol of
notation            notation                  a two-terminal, passive, nonlinear, resistive element with associated signs for
                                              the voltage across and the current through it.
Figure 3.1: Schematic symbol of a two-
terminal, non-linear resistor with reference
directions for voltage and current.
                                                                                    3.2. TWO-TERMINAL RESISTIVE ELEMENTS 87

3.2.1 Voltage-controlled and current-controlled notation

There are two representation methods for the v - i characteristic of these
elements: the voltage-controlled and the current-controlled representation. Two-
terminal, resistive elements of which the branch current is uniquely defined
by the branch voltage, are called voltage-controlled. Two-terminal, resistive
elements of which the branch voltage is uniquely defined by the branch cur-
rent, are called current-controlled elements.

   Monotonously increasing or decreasing v - i relations can be expressed in
both voltage-controlled and current-controlled notation.

   Examples of voltage-controlled and current-controlled, nonlinear resistors
with a non-monotonic relation between voltage and current are shown in
Figure 3.2.

                                                                                                                                     Figure 3.2:
                                                                                                                                    A. i(v) function of a voltage-controlled,

                                                                                                                                     nonlinear resistor
                                                                                                                                    B. v(i) function of a current-controlled,

                                                                                                                                     nonlinear resistor.

   A                        B

   A voltage-controlled representation of a v - i characteristic is shown in
Figure 3.2A. A voltage-controlled v - i relation is written in the form

               I = I (V) .                   (3.1)

In words: the branch current is uniquely defined by the branch voltage.
   An example of a current-controlled representation of the characteristic of a

nonlinear, two-terminal, resistive element is shown in Figure 3.2B. We speak
of a current-controlled v - i relation if the branch voltage is uniquely defined
by the branch current:

               V = V(I).                     (3.2)

3.2.2 Resistive two-terminal elements

Some examples of nonlinear, resistive elements and their characteristics are
shown in Figure 3.3. The v - i relations of these elements are given table 3.1.

                                                                                  Figure 3.3: Examples of two-terminal,
                                                                                  resistive elements:

                                                                                      A. Linear resistor
                                                                                      B. Independent current source
                                                                                      C. Independent voltage source
                                                                                      D. Ideal diode.

      +     +                  +          +

A     -  B  -  C-                 D-
88 AMPLIFICATION MECHANISM

Table 3.1: Examples of two-terminal nonlin-    element          parameters  current-controlled        voltage controlled
ear resistive elements                         linear resistor  r
                                               voltage source   v           V(I) = Ir                 I  (V)      =  V
                                               current source   i                                                    r
                                                                is
                                               ideal diode                  V(I) = v                  I (V) = undefined

                                                                            V(I) = undefined          I (V) = i

                                                                            V(I)  =  kT  ln  1 + Iis  I (V) = is exp kT qV - 1
                                                                                     q

                                                                            valid for I > - is

                                               3.2.3 Complementary devices

                                               Let us consider two current-controlled, nonlinear, resistive elements of which
                                               the behavior is described by their respective v - i relations V(I) and Vc(I).
                                               These elements are said to be complementary if:

                                                                   Vc(I) = -V(-I).                                         (3.3)

                                                  Similarly, two nonlinear, resistive elements with their respective voltage-
                                               controlled notations I(V) and Ic(V) are said to be complementary if:

                                                                   Ic (V) = -I (-V) .                                      (3.4)

Figure 3.4: v - i Characteristics of a non-       A graphical interpretation of this relation is shown in Figure 3.4. It il-
linear, two-terminal resistor and its comple-  lustrates that the v - i relation of a complementary, two-terminal element is
mentary device.                                obtained from is normal version by rotating it over 180 degrees. Note that
                                               a two-terminal, resistive element is always complementary to its reversely
                                               connected element.

                                               3.2.4 Operating point

                                               The quiescent operating point, or shortly the operating point of a device is a point
                                               on the v - i curve of the device at which it is operating in the absence of a
                                               signal. At a later stage, we will show that if the (small-signal) resistance of
                                               a two-terminal resistive element in its operating point is negative, the ele-
                                               ment exhibits amplifying capabilities. As a matter of fact, we will see that the
                                               amplifying capabilities of active devices strongly depend on the device's op-
                                               erating point. Selection and design of proper operating conditions of active
                                               devices is an important activity of analog circuit design engineers.

                                               Fixing the operating point

Figure 3.5:
    A. v - i characteristic of a PN diode
    B. Definition of the operating point and

the application of bias sources.
    C. v - i characteristic of the biased

diode.

                                                     R1                                      R1 V2

                                                                                                            -  +

                                                  V1 + +                        V1 +            +                       +
                                                                                    -
                                                                                                         I1
                                                                            B
                                               A  -             -                               -                       -

                                                  The operating point of a two-terminal device can be altered by placing a
                                               voltage source in series with the element and a current source in parallel with
                                                                                    3.2. TWO-TERMINAL RESISTIVE ELEMENTS 89

it. This process is called biasing, and the added voltage and current sources
are called bias sources.

   Figure 3.5 illustrates the process of biasing a diode. Figure 3.5A shows the
unbiased diode connected to a signal voltage source V1 with source resistance
Rs. If the signal voltage v equals zero, the diode operates in the origin of its
v - i characteristic. Hence, the quiescent operating point is (0, 0). If the signal
voltage deviates from zero, a signal current i will flow through the source.

   Let us now change the operating point of the diode, while maintaining the
quiescent operating conditions of the signal source. In other words: we still want
no current through V1 if v = 0.

   Figure 3.5B shows the way in which this can be achieved. The operating
point of the diode has been changed to (VQ, IQ) through the addition of a
bias voltage VQ in series with the diode and a bias current IQ in parallel with
the diode. The bias voltage source V2 provides the bias voltage VQ and the
bias current source I1 provides the bias current IQ. In the quiescent state,
the bias current IQ causes a voltage VQ across the diode. The bias voltage
source V2 compensates for this voltage, such that the quiescent operating
conditions of the signal source have not changed. Please notice that this way
of biasing makes the operating point insensitive for variations in Rs. In fact,
any change in a passive, resistive termination of the biased diode will not
alter its operating point.

Dependent and independent bias sources

Either the bias voltage, or the bias current can be selected by design, while the
other follows from the one selected and the V - I characteristic of the device.
If the current IQ is selected by design, the value of the voltage source should
equal the voltage across the diode, with the current IQ flowing through it,
hence: VQ = V(IQ). If the voltage VQ is selected by design, the value of the
current source equals IQ = I(VQ).

Biasing errors

Since the real-world v - i characteristic of an element to be biased is usually
not fully known and temperature-dependent, biasing errors will be inevitable
and error reduction may be required to improve the biasing accuracy and
temperature stability. At a later stage we will present techniques for the
reduction of biasing errors.

Biased device v - i characteristic

The v - i characteristic of the biased device can be found from the V(I) func-
tion of the unbiased device and the operating point (VQ, IQ).

   The voltage-to-current transfer of the biased device can be written in terms
a modified nonlinear transfer IQ(v):

                        i = IQ (v) ,                             (3.5)

where v and i are the voltage and the current excursion from the operating

point, respectively.

The function IQ(v) can be obtained from the original nonlinear device

characteristic I(V) as

                        IQ (v) = I VQ + v .                      (3.6)

Similarly, but now in current-controlled notation, we may write

                        v = VQ (i) ,                             (3.7)

where

                        VQ (i) = V IQ + i .                      (3.8)
90 AMPLIFICATION MECHANISM

                                                    The modified functions IQ (v) and VQ (i) now pass through the origin,
                                                while the quiescent operating point of the nonlinear device itself is (VQ, IQ).

                                                             3.2.5 Linearization and available power gain

                                                             For small excursions from the operating point the v - i relation can be lin-
                                                             earized. The small-signal conductance and resistance in the operating point
                                                             in voltage-controlled or current-controlled notation, are:

                                                                                           i = gQv;       gQ = IQ (v) ,                           (3.9)
                                                                                           v = rQi;                  dv v=0                      (3.10)

                                                                                                         rQ = VQ (i) ,
                                                                                                                   di i=0

                                                             respectively.
                                                                We will now study the conditions under which nonlinear resistive two-

                                                             terminal elements can provide an available power gain larger than unity. As
                                                             discussed earlier, an available power gain that exceeds unity is a distinguish-
                                                             ing property of amplifiers.

                                                                                                                       -     +

         +  +                                                +                          +                +                                    +

A-          -  B-                                                                       -            C-                                       -

Figure 3.6:                                                     Let us hereto consider a signal source that consists of a voltage source with
    A. Resistive load connected to a voltage                 a nonzero source resistance, as shown in Figure 3.6A. The source voltage
                                                             equals Vs and the source resistance equals Rs. The source is connected to a
source with source resistance Rs.                            load that has a resistance R.
    B. A nonlinear resistor is placed be-
                                                                The available power of the source equals
tween the source and the load.
    C. The nonlinear resistor is biased in an                                                         Pav = V2 .                                 (3.11)
                                                                                                              4Rs
operating point (vQ, iQ). In this operating
point its small-signal equivalent resistance                    Let us now place a biased two-terminal nonlinear device R (v, i) between
equals rQ.
                                                             the source and the load as shown in Figure 3.6B. The device is biased in an
                                      Operating region with
                                      negative small-signal  operating point Q and its small-signal equivalent resistance in this operating
                                      resistance
                                                             point is assumed rQ. The maximum power will be delivered to a load with
Figure 3.7: Typical v - i characteristic of a                                                                          P
tunnel diode.                                                a  resistance   R  =  Rs   +  rQ.  The  available  power        of  the  series  connection  of
                                                                                                                         av

                                                             the source and the biased nonlinear device equals

                                                                                                P     =         V2 .                             (3.12)
                                                                                                         4 Rs + rQ
                                                                                                  av

                                                                The available power gain GP of the two-terminal device R is obtained as
                                                                             P
                                                             the  ratio  of        and  Pav:
                                                                               av

                                                                                                G P P = av = Rs .                                (3.13)
                                                                                                        Pav Rs + rQ

                                                                It appears that the available power gain will exceed unity if the small-
                                                             signal resistance rQ of the two-terminal device in the operating point Q has a
                                                             negative value. The tunnel diode is an example of a two-terminal device that
                                                             has a negative small-signal resistance in a certain operating region. The v - i

                                                             characteristic of a tunnel diode is shown in Figure 3.7.
                                                      3.3. MULTI-TERMINAL RESISTIVE ELEMENTS 91

3.3 Multi-terminal resistive elements

Most active electronic devices are three-terminal elements. The behavior of a
multi-terminal resistive element with n terminals can be described by n - 1
relations that have all n - 1 branch voltages and n - 1 branch currents as
arguments. The general form of such a set of equations is

        f1...n-1 (V1...Vn-1, I1...In-1) = 0.                  (3.14)

3.3.1 Complementary multi-terminal elements

Let us consider two n-terminal resistive elements. One is described by a
set of multi-variate functions f1...n-1 (V1...Vn-1, I1...In-1) and the other by
g1...n-1 (V1...Vn-1, I1...In-1). These two n-terminal elements are complemen-
tary if

   f1...n (V1...Vn-1, I1...In-1) = -g1...n-1 (-V1... - Vn-1, -I1... - In-1) . (3.15)

NMOS and PMOS transistors are complementary if the above is true. Similar
holds for NPN and PNP bipolar transistors.

3.3.2 Resistive two-ports

Nonlinear resistive two-ports can be represented by a pair of nonlinear func-

tions:

        f1,2 (Vi, Vo, Ii, Io) = 0.                            (3.16)

The arguments of the functions are the port voltages Vi and Vo and the port
currents Ii and Io. By selecting two independent variables and two depen-
dent variables out of the four variables, we obtain six different representation

methods. These representation methods have been listed in table 3.2.

Voltage-controlled representation:  Ii = Ii (Vi, Vo)  Io = Io (Vi, Vo)                    Table 3.2: Six representation methods for
Current-controlled representation:  Vi = Vi (Ii, Io)  Vo = Vo (Ii, Io)                    nonlinear resistive two-ports
Hybrid 1 representation:            Ii = Ii (Vi, Io)  Vo = Vo (Vi, Io)
Hybrid 2 representation:            Vi = Vi (Ii, Vo)  Io = Io (Ii, Vo)
Transmission 1:                     Io = Io (Vi, Ii)  Vo = Vo (Vi, Ii)
Transmission 2:                     Vi = Vi (vo, Io)  Ii = Ii (Vo, Io)

3.3.3 Complementary two-ports

Let us consider two resistive two-ports that are described by their respec-
tive multi-variate functions f1,2 (Vi, Vo, Ii, Io) and g1,2 (Vi, Vo, Ii, Io). These two-
ports are complementary if

        f1,2 (Vi, Vo, Ii, Io) = -g1,2 (-Vi, -Vo, -Ii, -Io) .  (3.17)

3.3.4 Operating point

Nonlinear resistive two-ports may, under specific operating conditions, ex-
hibit amplifying capabilities. Similar as with two-terminal devices, such op-
erating conditions may be established by adding bias sources. Biasing of a
port requires the insertion of a voltage sources in series with the port and
a current sources in parallel with the port. This is illustrated in Figure 3.8.
Because the output port quantities depend on the input port quantities, two
of those bias sources may be selected by design, while the remaining two
follow from the ones selected and the device equations. The two selected by
design will be referred to as independent bias sources and the two remaining
as dependent bias sources.
92 AMPLIFICATION MECHANISM

Figure 3.8: Biased non-linear two-port.

                                         -
                                                                   ++
                                                               --
                                                                                                               +
                                         +
                                                                           --
                                                                           ++
                                                                                                       -

                                            Let us consider a nonlinear two-port described by two voltage controlled
                                         relations:

                                         Ii = Ii (Vi, Vo) ,                                                       (3.18)
                                         Io = Io (Vi, Vo) .                                                       (3.19)

                                         After biasing the input port in the operating point (ViQ, IiQ) and the out-
                                         put port in the operating point (VoQ, IoQ), we obtain the modified two-port

                                         equations for deviations from the operating point as

                                         ii = IiQ (vi, vo) ,                                                      (3.20)
                                         io = IoQ (vi, vo) ,                                                      (3.21)

                                         where vi, ii and vo, io represent the voltage and current excursions from the
                                         quiescent operating point of the input port and the output port, respectively.

                                         The modified functions IiQ (vi, vo) and IoQ (vi, vo) can be obtained from the
                                         original two-port functions Ii (Vi, Vo) and Io (Vi, Vo) , and the operating points
                                         (ViQ, IiQ) and (VoQ, IoQ) of the input port and the output port, respectively:

                                         IiQ (vi, vo) = Ii ViQ + vi, VoQ + vo ,                                   (3.22)
                                         IoQ (vi, vo) = Io ViQ + vi, VoQ + vo .                                   (3.23)

                                            Such description methods can also be given for other two-port representa-
                                         tion methods.

                                         3.3.5 Linearization and available power gain

                                         For small excursions from the operating point a linearized two-port model
                                         can be used. In amplifier design, the anti-causal transmission-1 matrix repre-
                                         sentation will often be used (see Chapter 2 and Chapter 2).

                                            The transmission-1 matrix parameters can be obtained from v - i relations
                                         of the biased device as

                                         A = ViQ (vo, io) ,                                                       (3.24)
                                                                       vo                                         (3.25)
                                                                           io =0                                  (3.26)
                                                                                                                  (3.27)
                                         B = - ViQ (vo, io) ,
                                                                       io
                                                                           vo =0

                                         C = IiQ (vo, io) ,
                                                                       vo
                                                                           io =0

                                         D = - IiQ (vo, io) .
                                                                       io
                                                                           vo =0

                                         Because the direction of the positive output current of the two-port differ
                                         from the positive current direction in the elements, minus signs appear in the
                                         expressions for B and D.

                                            The available power gain of a two-port can be expressed in the transmission-
                                         1 matrix parameters and the source impedance; see expressions (2.27), (2.29)
                                                                                                  3.4. INTRODUCTION TO BIASING 93

and (2.30). A biased, nonlinear, multi-terminal device can have an available
power gain that exceeds unity, a property that will be exploited in amplifiers.

3.4 Introduction to biasing

In the previous sections we have discussed under which conditions a nonlin-
ear resistive element can be used as an amplifying device. First of all, there
needs to be an operating point at which the available power of a signal source
can be increased. Secondly, we must apply bias voltage and current sources
that let the device operate at such an operating point. In order not to ad-
versely affect the signal processing, we may place only ideal voltage sources
in series with the signal path and ideal current sources in parallel with the
signal path.

   However, the bias sources to be applied cannot be chosen freely. For a
two-terminal element we may assign an arbitrary value to either the voltage
source or the current source. The other one relates to the selected one through
the element's v - i relation. In general, in a resistive network with n terminals
we may define n - 1 bias sources freely while the values of another n - 1 bias
sources relate to ones selected.

   In practice, we will also have to face numerous implementation difficul-
ties. Even if we carefully select the desired operating point and design the re-
quired bias sources, the device tolerances as well as temperature dependency
of the device characteristics cause temperature-dependent biasing errors that
may be too large to maintain the proper operating conditions.

   Another practical limitation is imposed by the requirement of a single
power supply source. All bias voltage and current sources should in some
way be derived from a single source or a limited number of power sources.
If we have multiple sources at our disposal, these sources usually share a
common terminal. This will impose serious limitations to the implementation
of floating bias sources.

   In this section we will only give a brief introduction to biasing and not
addresses all these topics. A more detailed treatment of biasing will be given
in Chapter 15.

3.4.1 Independent and dependent bias sources

In the introduction we have already stated that not all operating point vari-
ables can be chosen independently. The first question we need to answer is
which one(s) do we want to fix by design and which one(s) as dependent
variable(s). To this end, let us consider a biased two-port with amplifying
capabilities. Such a two-port will exhibit a large available power gain if its
transmission-1 small-signal parameters in the operating point are close to
zero. This can be seen from (2.27). In such cases, the voltage and current
excursions at the output port exceed those at the input port. If we take the
input bias quantities as independent and fixed, then the output bias current
and bias voltage will depend on the device characteristics and on the tem-
perature. In order to prevent from clipping during large signal excursions at
the output port, we may need to apply much larger bias sources than strictly
required on grounds of the signal handling requirements. This is because
we have to account for device tolerances and temperature changes. Hence,
it will be clear that selecting the output port bias quantities on grounds of
the signal handling requirements, while adapting the values of the input bias
sources to device tolerances and temperature changes, will result in a better
power efficiency. Moreover, in later chapters we will see that many perfor-
mance aspects, such as the noise behavior, the bandwidth and the linearity of
biased amplifying devices show a direct relation with the operating voltage
94 AMPLIFICATION MECHANISM
                                                  and current of the output port.

                                                 3.4.2 Biasing of 3-terminal elements

                                                 Amplifying devices such as MOSFETs, JFETs and BJTs can be used as 3-
                                                 terminal active devices. Operation and modeling of these devices will be
                                                 discussed in Chapter 4. Here, we will discuss generalized biasing methods
                                                 for these devices.

                                                    Let us assume that a passive nonlinear resistive 3-terminal element can
                                                 deliver a sufficiently large load signal if its output port is biased at a voltage
                                                 of VO and at a current IO. Let us also assume that, at a given temperature,
                                                 the biasing of its output port requires a bias voltage VI and a bias current II
                                                 at its input port. This situation is shown in Figure 3.9.

                                                    The question is how to obtain the required values of the input port bias
                                                 quantities VI and II. One way is to use the device equations and obtain an-
                                                 alytical expressions for the input port quantities. With strongly simplified
                                                 device equations this may yield useful estimations for taking early stage de-
                                                 sign decisions.
-                                                                                                                                                             +
+                                                                                                                                                        +
                  -
                 nonlinear                                                                    +

      + 3-terminal                         +

                 element

     -

Figure 3.9: A nonlinear two-port with its
output port biased at (VO, IO). In order to
achieve zero load voltage and current at a
given temperature, the input port needs to
be biased at (VI , II ).

Figure 3.10: Determination of the input                         nonlinear                                                                                      -
port biasing quantities (VI , II ) with the aid                                                                                                                +
of a nullor.                                           + 3-terminal                                                                                                                     -

                                                                element                                                                                          -
                                                                                                                                                                  +
                                                       -                                                                                                                            -

                                                    If we want to create an accurately biased two-port that can be used during

                                                 simulation, we can use the approach sketched in Figure 3.10. In this con-

                                                 figuration a nullator sets the zero load condition and the norator provides
                                                 (VI, II ) that satisfies this condition. Such a setup works if this network has a
                                                 unique DC solution at the temperature of interest. This will usually be the
                                                 case with amplifier stages. If not, (VI, II ) should be limited to a range in
                                                 which a unique solution exists.

Figure 3.11: Biased 3-terminal element.             Biased 3-terminal element (at reference temperature)

                                                    -

                                                                                        nonlinear

                                                 +  + 3-terminal                                                                                                                           +

                                                       element

                                                 -  -                                                                                                                                      -

                                                    Figure 3.11 shows the biasing result. A bias current source and a bias
                                                 voltage source are connected to the input port to create zero load conditions
                                                 for all passive, DC port terminations, while having its output port biased at
                                                 (VO, IIO).

                                                 3.4.3 Amplification mechanism

                                                 Figure 3.12A shows an amplifier stage with a biased 3-terminal element,
                                                 driven from a voltage source with a finite, nonzero source resistance. The
                                                 stage is biased as described in section 3.4.2. We assume positive nonzero val-
                                                 ues for all the bias sources. In Chapter 4 we will see that the commonly used
                                                                                                  3.4. INTRODUCTION TO BIASING 95

(N-type) amplifying devices require such biasing conditions. The amplifica-
tion mechanism is explained in the caption of this figure.

A-       +                   Quiescent state        +  -                           Figure 3.12: Voltage-driven amplifier stage
                                   nonlinear                                       with the three terminal, passive, resistive
                                                                                   element, which is biased according to
   +  +                      + 3-terminal      +          +                        Figure 3.11.
                             passive
                                                                                       A: Biased 3-terminal element in the
      -                      resistive                    -                        quiescent state. For proper operation of
                             - element                                             this device, all bias voltages and currents
   -                                           -                                   are positive (NMOS, NPN, vavuum tube).

B-       +                   Current sinking state  +  -                               B: Sink state: the stage is driven from
                                      nonlinear                                    a positive voltage. The output current of
                                                                                   the 3-terminal device increases. The extra
   +  +                      + 3-terminal      +          +                        (sink) current is delivered by the output
                             passive                                               bias voltage source. The output voltage of
                                                                                   the 3-terminal device drops below VO and
                             resistive                                             the load voltage v drops below zero.
      -                      - element                    -
   -                                           -                                       C: Source state: the stage is driven from
                                                                                   a negative voltage. The output current
C Current sourcing state                                                           of the 3-terminal device decreases. The
      -  +                                          +                              excess current delivered by the output bias
                             nonlinear                 -                           current source flows through the load. The
      -                                                                            output voltage of the 3-terminal device
                             + 3-terminal                 +                        rises above VO and the load voltage v
   +                         passive           +                                   becomes positive.

      + - element resistive -                                                          D: Compact model of the biased 3-
   -                                           -                                   terminal element. This model comprises
                                                                                   an active element: a voltage-controlled
D                            Equivalent model                                      voltage source. For the sake of simplicity,
                                                                                   a possible reverse transfer is not modeled.
   -  + Nonlinear            +                            +                        Under the conditions that no breakdown
   +                                                                               or saturation effects are present, this stage
         Resistors and                                                             operates in Class A.

         voltage-controlled  -                            -
      - current source

   This Figure 3.12D shows that a combination of a passive, resistive, three-
terminal amplifying device and properly configured bias sources, can be
modeled with the aid of a controlled source, which is an active network ele-
ment since it delivers power to its load.

3.4.4 Deriving the bias sources from the power supply                              Figure 3.13: V - I characteristic of a two-
                                                                                   terminal resistive elements that exhibits a
The biasing of a 3-terminal element with four bias sources is conceptually         current source character when biased at a
correct, but not very practical. Generally we want the amplifier to be supplied    sufficiently large voltage.
from a few power sources that share the reference terminal. This means
that the bias voltages and currents in some way have to be derived from the        3 A two-terminal resistive element ex-
power supply source(s). The general procedure for this is first to minimize        hibits a voltage source character if, at an
the number of bias sources and then derive them from the power supply              operating point (VQ, IQ), its small-signal
with passive, (nonlinear) resistive elements. Such elements should exhibit         resistance is smaller than IVQQ .
either a voltage source character when operating at a non-zero current, or
a current source character when operating at a non-zero voltage.3 For bias           A two-terminal resistive element ex-
voltage sources we will use elements with a voltage-source character and for       hibits a current source character if, at an
bias current sources we will use elements with a current source character.         operating point (VQ, IQ), its small-signal
                                                                                   conductance is smaller than VIQQ .
   Figure 3.13 shows an example of the V - I characteristic of a nonlinear
resistive two-terminal element that exhibits a current source character when
biased at a voltage between saturation and breakdown: Vsat < V < Vbr.
Outside this range we speak of voltage limiting or clipping.

   Chapter 15 is devoted to this topic. There, we will also discuss biasing tech-
niques that use AC coupling. The concept of AC coupling will be introduced
in Chapter 9. A chapter about the design of the bias sources themselves has
not yet been included.
96 AMPLIFICATION MECHANISM

                                 3.5 Conclusions

                                                  In this chapter, we have discussed in which way the amplification function
                                                  can be implemented with the aid of electronic devices and power sources.

                                                      We have seen that a two-terminal, nonlinear, passive device, in conjunction
                                                  with power sources can provide an available gain larger than unity, if such a
                                                  device is biased in an operating point in which its small-signal resistance is
                                                  negative. Biasing of such a device is performed by placing a current source
                                                  in parallel with the device and a voltage source in series with the device, in
                                                  such a way that the operating point of the device does not depend on the
                                                v - i characteristic of a passive, DC termination. Either the bias voltage or
                                                  the bias current can be selected freely, while the other one follows from the
                                                one selected and from the device's v - i characteristic and the temperature.

                                                      The implementation of amplification with three-terminal devices proceeds
                                                  similarly. Three-terminal active devices such as MOS transistors, BJTs or vac-
                                                  uum tubes can be regarded as nonlinear two-ports of which the input port
                                                  and the output port share one terminal. When properly biased, these de-
                                                  vices can also provide an available power gain that exceeds unity. To this
                                                  end, we need to select a proper operating point and bias each port with a
                                                  current source and a voltage source in such a way that the biasing is inde-
                                                  pendent of the passive DC termination resistance at both ports. Two of the
                                                  four bias sources can be designed freely, while the other two follow from the
                                                  device characteristics. As we will see later, important performance aspects,
                                                  such as the noise performance, the dynamic behavior and the nonlinearity
                                                  show a direct relation with the biasing quantities at the output port. For this
                                                  reason, the bias current and the bias voltage of the output port are usually
                                                  selected by design, while the bias voltage and current of the input port have
                                                  to be adjusted such that the device's operating point does not depend on the
                                                  temperature and on the passive DC termination resistance at both ports.

                                        3.5.1 Generalized biased active device

                                                  In the following chapters, we will design amplifiers using biased active de-
                                                  vices. Since the design theory itself is technology-independent, we will use
                                                  one symbol for a generalized biased device. This symbol is shown in Figure
                                                  3.14A. It refers to any type of biased active device, as indicated in Figure
                                                  3.14B.

           3                              -                                                                                                          +- -
   1                                                                                                              +
                                                                                +
                                             +
                                                -
                                       1           31                                                                                                      3

                                                   OR:

   2

                                             2                          2

   Symbol for

   biased 3-terminal                            Also similarly biased:

A  active device.                      B        PMOS, PNP, NJFET, PJFET or Vacuum Tube

Figure 3.14: Symbol for a generalized
biased 3-terminal active device.
                                                                 97

4Active Devices

4.1 Introduction                                            98

4.1.1 Design equations and symbolic circuit analysis        98

4.1.2 Numeric circuit analysis                              99

4.1.3 Simulation accuracy                                   99

4.1.4 This chapter                                          100

4.2 Bipolar transistors                                     100

4.2.1 Operation                                             100

4.2.2 Gummel-Poon model                                     101

4.2.3 Device parameters                                     106

4.2.4 Simulated device characteristics                      106

4.2.5 Other models                                          112

4.2.6 Simplified models for hand calculations               112

4.3 Junction Field Effect Transistors                       115

4.3.1 JFET simulation model                                 115

4.3.2 Device parameters                                     119

4.3.3 JFET simulated device characteristics                 119

4.3.4 Simplified models for hand calculation                121

4.4 MOS transistors                                         123

4.4.1 Operation                                             124

4.4.2 MOSFET modeling                                       125

4.4.3 MOSFET level 1 model                                  126

4.4.4 Device parameters                                     130

4.4.5 Simplified models for hand calculations               132

4.4.6 Capacitance models                                    135

4.4.7 MOS EKV Model                                         137

4.5 SLiCAP device models                                    146

4.5.1 Signal path and biasing                               147

4.5.2 SLiCAP parametric small-signal models                 147

4.5.3 BJT forward region, no saturation                     147

4.5.4 NMOS EKV forward region, saturation range             148

4.5.5 NMOS EKV forward region, linear and saturation range  151

4.5.6 SLiCAP MOS device characteristics                     153

4.5.7 PMOS EKV models                                       154

4.6 Conclusions                                             155
98 ACTIVE DEVICES

                                       4.1 Introduction

                                       Since the invention of the vacuum tube, the design of electronic circuits has
                                       indissolubly been connected with the development of electronic devices. In
                                       fact, the design of electronic circuits cannot be performed without knowledge
                                       of the physical operation of the devices from which they will be constructed.
                                       However, the approach to the design of application-specific amplifiers, as pre-
                                       sented in this book, does not depend on the technology in which the cir-
                                       cuits finally will be realized. The design approach, the concepts and the
                                       techniques presented can be used for designing vacuum tube amplifiers, am-
                                       plifiers realized with discrete components or amplifiers realized in modern
                                       CMOS IC processes. Different technologies, simply introduce different de-
                                       sign constraints and offer different possibilities for the implementation of the
                                       concepts. The designer's task is to deal with the limitations and maximally
                                       exploit the specific implementation possibilities of the selected technology.
                                       For this reason, knowledge of the operation and modeling of electronic de-
                                       vices is regarded indispensable for designers of electronic circuits. However,
                                       physics and modeling of electronic devices has become a field of knowledge
                                       on its own. A full treatment would require a bookshelf full of material and
                                       is considered outside the scope of this work. The reader is assumed to have
                                       basic knowledge of the operation and modeling of discrete semiconductor
                                       devices, of passive devices and of CMOS and BiCMOS IC technology.

                                          During circuit design, the designer must know in which way the perfor-
                                       mance aspects of the circuit are related to those of the electronic devices and
                                       how they can be affected by design. In general, the performance aspects
                                       of electronic devices depend on the device type and on its operating con-
                                       ditions. In IC technology, device scaling may also be used for performance
                                       optimization. Hence, our aim is to briefly summarize topics related to de-
                                       vice selection, device scaling and selection of an operating point. This will
                                       be done for so-called active semiconductor devices only, hence for semicon-
                                       ductor devices that, when applied in conjunction with power sources, exhibit
                                       amplifying capabilities. We will confine ourselves to Bipolar Junction Tran-
                                       sistors (BJTs), Junction Field Effect Transistors (JFETs) and Metal Oxide Semi-
                                       conductor Field Effect Transistors (MOSFETs). We will describe their basic
                                       operation and device models.

                                          In this book, we will advocate the use of different device models at differ-
                                       ent stages of the design process. At an early stage, we usually want to use
                                       relatively simple models that describe performance aspects of interest accu-
                                       rate enough to motivate early stage design decisions. Based on the analysis
                                       of relevant performance aspects, we will be able to select the device and its
                                       operating region. Parameters for these simplified models can be found from
                                       simulation with more complete models, or by estimating them from the pa-
                                       rameters of those models or graphs. At a later stage, numeric simulation
                                       with more elaborate models is required to give an accurate prediction of the
                                       circuit operation. Nowadays, automated circuit optimization is used to ob-
                                       tain the best possible performance with the lowest cost factors and sensitivity
                                       for production process variations. Automated circuit optimization, however,
                                       is outside the scope of this book.

1 Based on Python and Maxima Computer  4.1.1 Design equations and symbolic circuit analysis
Algebra Systems.
                                       Setting up design equations for specific performance aspects, such as, noise
                                       behavior, small-signal dynamic behavior and temperature stability requires
                                       symbolic circuit analysis. SLiCAP (Symbolic Linear Circuit Analysis Program)
                                       is an open-source symbolic simulator that can be used for this purpose.1 It
                                       uses linearized (small-signal) device models of which the parameters can be
                                       related to the technology, the geometry and the operating point of a device.
                                                                                  4.1. INTRODUCTION 99

SLiCAP will be used throughout this text book.

4.1.2 Numeric circuit analysis                                                    2 Laurence W. Nagel and D.O. Pederson.
                                                                                  Technical Report UCB/ERL M382, EECS
The development of device models and the development of circuit simulators        Department, University of California,
is an ongoing process that helps to increase the predictability of the behavior   Berkeley, April 1973
of electronic circuits. The first version of Berkeley spice (Simulation Pro-      3 Laurence W. Nagel. SPICE2: A Computer
gram with Integrated Circuit Emphasis) was released in 1973. The program was      Program to Simulate Semiconductor Circuits.
written in Fortran by Nagel (see [Nagel-M382]2 and [Nagel-M520]3). Within         PhD thesis, EECS Department, University
a few years, spice2 was released and widely accepted by circuit manufac-          of California, Berkeley, 1975
turers. spice3 was written in C by Quarles (see [Quarles-M89/42]4), it was        4 Thomas L. Quarles. Analysis of Performance
released in 1989. Nowadays many spice-like simulators have been integrated        and Convergence Issues for Circuit Simulation.
in CAD software packages.                                                         PhD thesis, EECS Department, University
                                                                                  of California, Berkeley, 1989
   Most spice-like simulators can perform DC, AC + Noise and Transient
analysis. The DC analysis uses nonlinear instantaneous device descriptions.       5 P. Antognetti and G. Massobrio. Semi-
During DC analysis all dynamic effects are discarded. The AC analysis uses        conductor Device Modeling with SPICE.
linearized dynamic device descriptions. The operating point for the lineariza-    McGraw-Hill, 1988
tion is found from a DC analysis that always precedes the AC analysis. The
AC analysis is in fact a small-signal frequency-domain analysis.

   The influence of stationary noise sources can be evaluated with a small-
signal noise analysis.

   The transient analysis performs a time-domain analysis thereby using non-
linear dynamic device descriptions.

   Some spice-like simulators are also capable of performing time domain
noise analysis.

   In this chapter, we will briefly describe basic models for spice3x versions.
For a more detailed study of device modeling for spice, the reader is re-
ferred to literature: [SPICE1988]5. From these spice models, we will derive
simplified descriptions that can be used for hand calculations for estimating
dominant behavioral properties of the device. Some spice versions as well
as other simulators support more elaborate models.

   Most simulators also provide operating point information that can be used
for the analysis of linearized circuits. If not, design engineers have to use IC
design manuals or data sheets and extract these parameters from measured
device characteristics. Alternatively, they can be determined from simula-
tions with more complex models.

4.1.3 Simulation accuracy

The validity of the simulation results is limited by the level of detailing in
the device models, the accuracy of the model parameters and the numerical
routines that have been implemented in the simulator. Both the numerical
routines and the device models are continuously improved. The validity of
the model parameters, however, is not always obvious; particularly when us-
ing discrete components. Many CAD packages include device libraries with
parameter values that are represented by more than three digits. However,
the suggested accuracy may be far beyond reality. On the one hand, physi-
cal reproducibility does not justify the suggested accuracy, while on the other
hand the characteristics obtained from simulation with typical parameter val-
ues may not correspond to those obtained from typical measurement data.
Parameter extraction is a critical process and the designer should be aware
of the validity of the models and the parameters. In case of any doubts the
designer should check whether results obtained with measurements given in
data sheets, can be reproduced with simulations.
100 ACTIVE DEVICES

                                             4.1.4 This chapter

                                             Basic models for the BJT, the JFET and the MOSFET will be discussed in
                                             sections 4.2, 4.3 and 4.4, respectively. For all these devices will start with a
                                             brief description of the available device types, their symbols and their sim-
                                             plified physical structure. We will then focus on the device models that are
                                             implemented in spice and derive simplified models for hand calculations.

                                                Section 4.5 is devoted to the implementation of these device models in
                                             SLiCAP.

6 William Shockley. Circuit element utiliz-  4.2 Bipolar transistors
ing semiconductive material, June 1948
                                             In December 1947, John Bardeen, Walter Brattain and William Shockley dis-
                                             covered the transistor effect and developed the first device. The patent [Shock-
                                             ley1952]6 was issued on September 25, 1951. For this invention, the inventors
                                             obtained the Nobel Prize in Physics in 1956.

          Vertical NPN                                                 LATERAL PNP

substrate collector base emitter                                     base emitter collector

     p                     n+                p n+        p           n+  p            p      p
isolation                                           isolation                                isolation
                                                                     n- epitaxial layer
                           n- epitaxial layer      p-substrate

                           n+ buried layer                           n+ buried layer

       c                                                  c                   e                       e
 b                                                  bs                  b                       b
                                                                                                  sc
       e                                                  e                   c          Integrated Circuit PNP
Discrete NPN                                 Integrated Circuit NPN  Discrete PNP

Figure 4.1: Cross-section of an integrated      Bipolar junction transistors (BJTs) are available as discrete components or
circuit vertical NPN transistor and a        as integrated circuit devices. Figure 4.1 shows the cross sections of a vertical
lateral PNP transistor and their schematic   NPN transistor and a lateral PNP transistor, realized in a simple junction-
symbols.                                     isolated bipolar integrated circuit process. Both vertical NPN and PNP bipo-
                                             lar transistors are available in so-called complementary bipolar IC processes. In
                                             IC technology, the transistors are realized in separate islands, isolated either
                                             by depleted PN junctions or by SiO2. Figure 4.1 also shows the symbols that
                                             are used for both transistors with and without substrate connection.

7 Minorities in the base.                    4.2.1 Operation

                                             In the so-called forward active region, the emitter base junction is forward
                                             biased and the base collector junction is reverse biased. In an NPN transistor
                                             electrons are then injected from the emitter into the base.7 Due to this injec-
                                             tion the concentration in of electrons in the base at the emitter-base junction
                                             increases. This causes a diffusion current of electrons in the base towards the
                                             collector. At the base-collector junction the concentration of electrons is zero
                                             because the drift field in the reverse biased base-collector junction accelerates
                                                                             4.2. BIPOLAR TRANSISTORS 101

them towards the collector terminal. In modern transistors, the recombina-         8 James M. Early (July 25, 1922 - January
tion of the minorities (electrons) in the base is very low and almost all elec-    12, 2004) was an American engineer, best
trons injected by the emitter will reach the collector terminal. A small reverse   known for his work on transistors and
injection of holes from the base into the emitter causes a so-called ideal base    charge-coupled device imagers. He is also
current. This current can be kept low by keeping the doping level of the base      known as Jim Early. Early was the first to
much lower than that of the emitter.                                               make a transistor that would oscillate faster
                                                                                   than "a thousand megacycles" (1 GHz),
   The width of the base-collector depletion layer depends on the collector-to-    circa 1952, for which feat he won a bottle
base voltage. Since the base doping level usually exceeds the collector doping     of Scotch whisky from John Robinson
level, the depletion layer extends mostly in the collector region. However, an     Pierce. He also developed the transistors
increase the reverse collector-to-base voltage causes a small decrease of the      for America's first commercial commu-
base width, thereby increasing the collector current. The resulting collector-     nications satellite, the Telstar I.[2] In the
to-base voltage dependency of the collector current is called the Early effect,    early 1970s, Early led research for Fairchild
named after its discoverer James M. Early8 (see [Early1952]9).                     Semiconductor, where he invented the
                                                                                   vertical anti-blooming drain for CCD image
   When the excess minority density in the base exceeds the doping level, we       sensors.
speak of high injection. At high injection levels the majority carrier concentra-  9 J.M. Early. Effects of space-charge layer
tion increases with the excess minority concentration, resulting in a reduction    widening in junction transistors. Proceed-
of the emitter efficiency by a factor two.                                         ings IRE, 40:1401-1406, 1952

4.2.2 Gummel-Poon model                                                            10 H. K. Gummel and H. C. Poon. An
                                                                                   integral charge control model of bipolar
The Gummel-Poon model (see [GummelPoon1970]10) is a charge-control model           transistors. Bell Syst. Tech. J., 49(5):827-852,
of the bipolar transistor that is used in spice-like simulation programs. It de-   May-June 1970
scribes the behavior of bipolar transistors outside the breakdown or strong
saturation regions. The operation of parasitic substrate transistors is also not
modeled. Since, at high frequencies the substrate current can generally not
be neglected, a voltage-dependent junction capacitance is added to the three-
terminal transistor model. Four-terminal NPN transistors that are fabricated
in standard bipolar processes, have their substrate capacitance connected to
the collector. spice also has a model for lateral PNP transistors. These tran-
sistors have their substrate capacitance connected to the base.

   In this section, we will give a short description of this charge-control model
and its implementation in spice. The Gummel-Poon model for four-terminal
NPN transistors is shown in Figure 4.2.

                                                                                   Figure 4.2: spice Gummel-Poon model of
                                                                                   the four-terminal vertical BJT.

   The charge based Gummel-Poon model is an enhancement of the older               11 J.J. Ebers and J.L Moll. Large-signal
                                                                                   behavior of junction transistors. Proceedings
Ebers-Moll model that describes the transistor as two merged PN diodes (see        of the IRE, 42(12):1761-1772, 1954
[EbersMoll1954]11).
102 ACTIVE DEVICES

12 The intrinsic transistor is the transistor    Static (DC) operation
without the bulk resistors Re, Rb and Rc.
its connections to the external circuit are e',  For static operation, the transistor is modeled as a nonlinear resistive net-
b'and c'.                                        work that consist of the intrinsic transistor12 with added bulk resistances Re,
                                                 Rb and Rc. The intrinsic transistor is modeled with a number of nonlinear
                                                 voltage-controlled elements. In the expressions, the Gummel-Poon model
                                                 parameters are written in small capitals. An overview of all the model
                                                 parameters is given in section 4.2.3.

                                                 1. The ideal base currents consists of injected majorities from the base into
                                                    the emitter, or from the base into the collector (in reverse operation). They
                                                    are described by Ibe and Ibc:

                                                                           Ibe = Is  exp Vbe - 1 , F nfUT                    (4.1)

                                                                           Ibc = Is  exp Vbc - 1 , R nrUT                    (4.2)

                                                 where c, b and e are the collector, base and emitter of the intrinsic transis-
                                                                                                         kT ,
                                                 tor,  respectively.  The  thermal  voltage  UT  equals        in  which  k  represents
                                                                                                         q

                                                 the Boltzmann constant 1.381 × 10-23J/K and q the elementary charge

                                                 1.602 × 10-19 C . At room temperature (T = 293K), UT equals 25.26mV.

                                                 The forward current gain F and the reverse current gain R both depend
                                                 on temperature. Their values at reference temperature T0 are given by
                                                 the parameters bf and br, respectively. Their temperature behavior is

                                                 modeled with the parameter xtb as

                                                                           F(T) = bf         T xtb  ,                        (4.3)
                                                                                                                             (4.4)
                                                                                             T0

                                                                           R(T) = br         T xtb  .

                                                                                             T0

                                                 2. The non-ideal base currents model recombination of minorities in the base.

                                                 For forward and reverse operation they are given by Ire and Irc, respec-

                                                 tively as

                                                                           Ire = ise exp      Vb e  -1 ,                     (4.5)
                                                                                             neUT

                                                                           Irc = isc exp      Vb c  -1 .                     (4.6)
                                                                                             ncUT

                                                 3. The transport current of minorities from the emitter to the collector is
                                                    represented by the transport current Icc

                                                            Icc = Qb0 is exp Vbe - exp Vbc ,                                 (4.7)
                                                                      Qb            nfUT                 nrUT

                                                 where Qb0 and Qb are the total minority charges in the base at zero bias
                                                 and applied bias (Vbe , Vbc ) , respectively. Their ratio is defined as

                                                 Qb = 1      1 + Vcb + Veb   +               exp Vbe - 1       + Is                 (4.8)
                                                 Qb0 2             vaf var  2 + Is                nfUT            ikr     exp Vbc - 1 .

                                                         1  1 + Vcb + Veb        ikf                                           nrUT
                                                         4       vaf var

                                                    The parameters vaf and var represent the forward and the reverse Early
                                                 voltages, respectively. The saturation current Is is a function of temperature.
                                                 Its value at the reference temperature T0 equals is. The temperature effects
                                                                                 4.2. BIPOLAR TRANSISTORS 103

are described by xti and the bandgap voltage eg:

                 Is (T) = is T xti exp eg (T - T0) .               (4.9)
                 T0        UT T0

   The temperature dependence of the non-ideal base currents Ise and Isc can
differ for the various spice versions. We therefore refer to the appropriate
reference manual. The bulk resistors Rc, Rb and Re in series with the ter-
minals of the intrinsic transistor are modeled by the parameters rb, re and
rc, respectively. Some spice versions support the modeling of temperature
effects on these resistors.

   The parameters ikf and ikr represent the current at which high injection
occurs for forward and reverse operation, respectively.

Dynamic effects

Under non-equilibrium conditions, changes in the excess minority base charge
and in the charge stored in the base-emitter and base-collector junction capac-
itances cause dynamic currents. The dynamic parts of the terminal currents
Ib, Ic and Ie can be obtained as

Ic = Icc - Ibc - Irc + dQdc dt - cjc dVbc dt + cjs dVcs dt ,       (4.10)
Ie = -Icc - Ibe - Ire + dQde dt - cje dVbe dt ,                    (4.11)
Ib = Ibe + Ibc + Ire + Irc + ddt Qb + cjc dVbc dt + cje dVbe dt ,  (4.12)
Is = -cjs dVcs dt ,                                                (4.13)

where Qde and Qdc represent the excess minority charges in the base, and
cjc and cje are the (small-signal) base-collector and base-emitter junction ca-
pacitances, respectively. The total excess minority charge depends on the mi-

nority transport current Icc and the minority transit time in the base. These
transit times are modeled by t f and tr for forward and reverse operation,

respectively. The associated excess minority charges Qde and Qdc can be ex-
pressed as

                 Qde = Iccf exp Vbe U , T                          (4.14)
                 Qdc = Icctr exp Vbc U . T                         (4.15)

   The forward transit time f is modeled as a function of both the forward       13 C. T. Kirk. A theory of transistor cut-
ideal transport current It f and the collector to base voltage Vbc . At high     off frequency ( ft) falloff at high current
currents f increases due to the so-called base push-out or Kirk effect (see      densities. IEEE Trans. Electron Devices,
[Kirk1962]13):                                                                   ED-9(2):164-174, February 1962

                  2
                     It f                         Vb c
f = tf 1 + xtf It f + itf  exp 1.44vtf ,                           (4.16)

where the ideal forward transport current It f is defined as

                 It f = is exp Vbe nfU . T                         (4.17)

   The amount of charge stored in the depletion capacitances of PN-junctions
depends on the voltage across these junctions. Due to the voltage dependence
of the depletion layer width, this charge shows a nonlinear relation with the
104 ACTIVE DEVICES

                                              voltage. In spice the cj(V) relation instead of the Qj(V) relation is modeled.

                                              For reverse biased junctions (V  0) the value of the depletion capacitance is

                                              modeled as:            Cj(0)
                                                                    1- V M
                                                           cj(V) =                     (4.18)
                                                                           Vj

                                              Where Cj(0) is the zero bias depletion capacitance, Vj the built-in junction
                                              barrier voltage and M the junction grading factor, M = 0.33 for linear graded
                                              junctions and M = 0.5 for step junctions. These expressions are also used for
                                              weakly forward biased junctions. spice uses this expression if the forward
                                              junction voltage V is smaller than fc times the built-in junction voltage. The
                                              spice parameter fc has a default value of 0.5.

                                                 The bipolar transistor model has three junction capacitances. Their values
                                              for reverse biased junctions are

                                                           cjc =       cjc      mjc ,  (4.19)
                                                           cje =                mje ,  (4.20)
                                                           cjs =         Vb c  mjs .   (4.21)

                                                                  1 - vjc
                                                                       cje

                                                                         Vb e

                                                                  1 - vje
                                                                      cjs

                                                                  1 - Vcs

                                                                         vjs

                                              Model improvements

                                              One improvement of the enhanced Gummel-Poon model is the modeling of
                                              a current-dependent base resistance. This effect, however, is not found from
                                              noise measurements. The current-dependency of Rb is characterized by three
                                              parameters rb, rbm and ibm that represent the maximum value, the mini-
                                              mum value at high currents and the current where the resistor is halfway its
                                              minimum value, respectively. In some spice versions, the temperature de-
                                              pendency of the bulk resistors is modeled. Some spice versions have model
                                              extensions for deep saturation (strongly forward biased collector-base junc-
                                              tion).

                                              Small-signal dynamic model

Figure 4.3: Small-signal equivalent circuit
of the bipolar transistor in the active
forward region. In the Gummel-Poon
model, the collector base resistance rµ is .

                                                 For small excursions from an operating point Q, at which the DC oper-
                                              ating currents and voltages are given by IB, IC, VBE and VCE, we can use a
                                              small-signal equivalent circuit. The values of the small-signal model param-
                                              eters are obtained from differentiation of the v - i and q - v relations in the
                                              operating point Q. The small-signal equivalent model of the BJT is shown in
                                                                                   4.2. BIPOLAR TRANSISTORS 105

Figure 4.3. The Gummel-Poon model does not include rµ. This small-signal
model is usually referred to as the hybrid- small-signal equivalent circuit, its
parameters are

rb = Rb|Q ,  r = Vbe ,                     cbc = Q V dc bc + cjc xcjc Q ,
Re = re,                   Ib Q            cbx = (1 - xcjc) cjc Q ,
Rc = rc,                                   c = V Qde be + cje Q ,
             gm = VIcbe Q ,                cjs = cjs Q .

             r = Vce ,  o
                           Ic Q

             r = Vce ,  µ
                           Ib Q

Stationary noise model

                                                                                                                 +  -
                           +
                           -

                                                      +
                                                      -

   In spice, frequency-domain noise analysis can be performed with a small-                                         Figure 4.4: Small signal hybrid  equiva-
signal noise analysis. For this purpose independent and stationary noise                                            lent circuit with noise sources.
sources are added to the small-signal hybrid- equivalent circuit from Figure
4.3. The resulting noise model is shown in Figure 4.4. The noise sources vb, ve
and vc represent the thermal noise of the bulk resistors. These sources have
a Gaussian amplitude distribution function and a uniform spectrum. Their
spectral densities are

                           Svb = 4kTrb     [V2/Hz],                        (4.22)
                           Sve = 4kTRe      [V2/Hz],                       (4.23)
                           Svc = 4kTRc      [V2/Hz].                       (4.24)

   The current sources ib and ic represent the shot noise of the base current
and the collector current in the operating point, respectively. These sources

have a Gaussian amplitude distribution function and a uniform spectrum.

Their spectral densities are given by

                           Sib = 2qIB      [A2/Hz]                         (4.25)
                           Sic = 2qIC      [A2/Hz]                         (4.26)

   The noise source ib f represents the flicker noise associated with the base
current. This source has a Gaussian amplitude distribution function and a

power spectrum that is inversely proportional with frequency. The spectral

density Sib f of this source is modeled as

                                    kfIaf  [A2/Hz],                        (4.27)
                           Sib f = B f
106 ACTIVE DEVICES

                                              where kf and af are the model parameters for this 1/ f noise term.
                                                 The noise current associated with the base current is often described with

                                              the aid of the noise corner frequency f of the 1/ f noise:

                                                                  Sibt = 2qIB 1 + ff [A2/Hz],                                       (4.28)

                                              where  the  corner  frequency  f  of  the  1  noise  is  obtained  from  (4.25)  and  (4.27)
                                                                                         f
                                              as kf (af-1)
                                                                             f = IB                [Hz].                            (4.29)
                                                                                    2q

                                                 Low-noise BJTs can have f below 100Hz. This cut-off frequency strongly
                                              depends on the applied technology. In modern RF IC processes it may exceed
                                              10kHz.

                                              4.2.3 Device parameters

                                              In this section, we will give an overview of the Gummel-Poon model parame-
                                              ters. Both NPN and PNP devices have positive valued parameters. spice has
                                              different BJT models for vertical and for lateral transistors. The supported
                                              BJT types are listed in Table 4.1.

Table 4.1: Types of BJTs supported in spice.  model description

                                              NPN         vertical NPN transistor with collector-substrate capacitance

                                              PNP         vertical PNP transistor with collector-substrate capacitance

                                              LPNP lateral PNP transistor with base-substrate capacitance

                                                 The spice parameters of the Gummel-Poon model are listed in Table 4.2.
                                              There are two arguments area and temp that represent the device emitter
                                              area scaling factor and the device temperature, respectively.

                      +-                      4.2.4 Simulated device characteristics
                   -+
Figure 4.5: Circuit for determination of the  Figure 4.5 shows a test bench for simulation of the device characteristics. The
DC characteristics of a BJT with spice.       netlist file is shown below:

Figure 4.6: Determination of the forward       1 DCchars
Early voltage vaf from the extrapolated        2 * FILE: myNPN_DCchars.cir
IC(VCE) curve.                                 3 * LTspice circuit file
                                               4 VBE 1 0 0
14 Named after Hermann Karl Gummel             5 VCE 2 0 0
(1923, Hannover Germany), a pioneer in         6 Q1 2 1 0 myNPN
the semiconductor industry.                    7 .model myNPN NPN
                                               8 + IS=0.5f BF=100 NF=1 IKF=100m ISE=10f NE=2 RB=10 VAF=20
                                               9 + TF=1n CJE=5p CJC=1p VJE=0.6 VJC=0.8 XTF=1 VTF=2 ITF=20m
                                              10 .dc VCE 0 5 10m VBE 0.6 0.65 10m
                                              11 * .dc VBE 0 0.65 10m VCE 1 5 1
                                              12 .end

                                                 The simulation results are shown in Figure 4.7. These figures show that
                                              the BJT behaves as a voltage-controlled current source. In the Gummel-Poon
                                              model the input current IB only depends on the input voltage. The output
                                              current is controlled by the input voltage. Over a wide range of output volt-
                                              ages it shows a weak dependence of the output voltage. For the forward
                                              active region, this is characterized with the forward Early voltage vaf. The
                                              value of this parameter can be found from the intersection point of the ex-
                                              trapolated IC (VCE) characteristic and the x-axis, as shown in Figure 4.6.

                                              Gummel plot

                                              The IB (VBE) characteristic and the IC (VBE) characteristic plotted together
                                              on a semi-logarithmic scale is called the Gummel plot.14 It shows the ex-
                                                                  4.2. BIPOLAR TRANSISTORS 107

name description                                      unit default area

is   transport saturation current                     A     10-16 *

nf   forward emission coefficient                     -     1

vaf forward early voltage                             V

ikf  forward high-injection knee current              A           *

bf   ideal forward DC current gain factor             -     100

ise  base-emitter leakage saturation current          A0          *

ne   base-emitter leakage emission coefficient        -     1.2

eg   bandgap voltage                                  V 1.11

xti  temperature coefficient (is)                     -     3

nr   reverse emission coefficient                     -     1

var reverse early voltage                             V

ikr reverse high-injection knee current               A           *

br   ideal reverse DC current gain factor             -     1

isc  base-collector leakage saturation current        A0          *

nc   base-collector leakage emission coefficient      -     2

xtb temperature coefficient (bf, br, ise, isc)        -     0

rb   zero-bias base resistance                        0           *

irb current at which Rb falls halfway to rbm          A           *

rbm minimum value of Rb at high current                rb         *

re   emitter bulk resistance                          0           *

rc   collector bulk resistance                        0           *

tnom temperature for parameter measurement            oC 27

tf   ideal forward transit time                       s     0

xtf coefficient for bias dependence of tf             -     0

vtf voltage describing VBC dependence of tf           V

itf  high-current parameter for effect on tf          A0          *

ptf excess phase at f = 1/(2tf) [Hz]                  deg 0

tr   ideal reverse transit time                       s     0

cje base-emitter zero-bias depletion capacitance      F     0     *

vje base-emitter built-in potential                   V 0.75

mje base-emitter junction grading coefficient         -     0.33

cjc base-collector zero-bias depletion capacitance    F     0     *

vjc base-collector built-in potential                 V 0.75

mjc base-collector junction grading coefficient       -     0.33

xcjc fraction of Cbc connected to internal base       -     1

cjs  collector-substrate zero-bias depletion capacitance F  0     *

vjs  collector-substrate built-in potential           V 0.75

mjs collector-substrate junction grading coefficient  -     0

fc   forward bias depletion capacitance coefficient   -     0.5

kf   flicker noise coefficient                        -     0

af   flicker noise exponent                           -     1

                                                                  Table 4.2: BJT Gummel-Poon model pa-
                                                                  rameters. An asterix (*) in the area column
                                                                  indicates scaling of the corresponding
                                                                  parameter with area.
108 ACTIVE DEVICES

Figure 4.7: DC input and output character-    ponential relation between the base to emitter voltage and the base current
istic of the transistor "myNPN", obtained     components. Figure 4.8 shows the simulation setup for this plot. The spice
from simulation with the circuit from         netlist file is shown below:15
Figure 4.5.
                                               1 * FILE: gummelPlot.cir
15 Simulation of very small currents re-       2 * LTspice circuit file
quires a modification of the minimum           3 VBE b 0 0
conductance simulation parameter gmin.         4 VCB c b 0
This parameter determines the value of the     5 Q1 c b 0 myNPN
conductance that spice places between the      6 .model myNPN NPN
nodes to enhance the convergence during        7 + IS=0.5f BF=100 NF=1 IKF=100m ISE=10f NE=2 RB=10
determination of the operating point.          8 .options gmin=1f
                                               9 .dc VBE 0 1 10m
                                   (c)        10 .end
                      +
                                                 Figure 4.9 shows the resulting Gummel plot. It shows the exponential re-
                    -                         lation between the base-emitter voltage and the collector current over many
                  (b)                         decades. The parameter bf models the ratio between the ideal collector cur-
                                              rent and the ideal base current. At very low current levels, the non-ideal base
                      +                       current models the recombination of minorities in the base. At high collector
                                              currents, high injection reduces the slope of the IC (VBE) curve by a factor
                    -                         two, while the voltage drop across the bulk resistors causes a deviation of the
                                              ideal exponential relation.
Figure 4.8: Circuit for determination of the
Gummel plot with spice.

                                              Definition of DC

                                              The DC current gain DC of a bipolar transistor is defined as the ratio of the
                                              DC collector current IC and the DC base current IB:

                                                                                        DC = IC .
                                                                                                     IB

                                              The DC current gain is a function of the collector current. This can be seen
                                              from the Gummel plot. Due to the Early effect, it also increases with the
                                              collector-emitter voltage.

                                              Definition of AC

                                              The small-signal current gain is somewhat misleadingly denoted by AC.
                                              This small-signal quantity is defined for infinitesimally small excursions from
ideal collector                                                           4.2. BIPOLAR TRANSISTORS 109
current: IS, NF
                                                                                       Figure 4.9: Gummel plot of the transistor
        ideal base current:                                                            "myNPN", obtained by simulation with the
        BF, IS, NF                                                                     circuit from figure 4.8.

                                                           bulk resistances
                                                           and high injection
                                                           RB, IKF

                             nonideal base current:
                             ISE, NE

the operating point:        AC = Ic ,       (4.30)
alternatively we may write            Ib Q

AC = Ic · Vbe = gmr.                        (4.31)
          Vbe Q Ib Q

   Figure 4.10 shows the DC current gain and the static (zero-frequency) for-

ward small-signal current gain AC versus the collector current of myNPN for
VCB = 0V.

                                                                               Figure 4.10: The forward DC current gain

                                                                               DC and the forward static small-signal
                                                                               current gain AC of "myNPN" as a function
                                                                               of the collector current.

Dynamic behavior of AC

At high frequencies the small-signal current gain AC drops below its static
value. This is caused by charge storage in the base due to the finite transit
time for minorities and in the depletion regions. The cut-off frequency of
a bipolar transistor is defined as the frequency at which the magnitude of
AC equals unity. The cut-off frequency T is a figure of merit for the speed
limitation of the bipolar transistor.

   Figure 4.11 shows the simulation test bench for the determination of the
110 ACTIVE DEVICES                                                             (4)

Figure 4.11: Simulation test bench for             +  V1             V2
determination of the cut-off frequency fT
as a function of the DC collector current.

                                                                (2)  +   -(3)

                                              (1)  -  ++
                                            C1           E1
                                                                         Q1         I1
                                                      --

                                                  cut-off frequency using spice. The voltage amplifier E1 provides the driving
                                                  conditions for the bipolar transistor such that its operating collector current
                                                  and collector-emitter voltage equal IC and VCE, respectively. The large capac-
                                                  itor C1 prevents feedback at signal frequencies of interest, while it concur-
                                                  rently provides the condition for measuring the short circuit collector current.
                                                  Below is the LTspice listing of the netlist file of the circuit from Figure 4.11:

                                                                1 myNPN_FT
                                                                2 * FILE: myNPN_FT.cir
                                                                3 * LTspice circuit file for plotting fT(Ic)
                                                                4 V1 4 1 3
                                                                5 V2 2 3 DC 0 AC 1
                                                                6 I1 0 4 {Ic}
                                                                7 C1 1 0 1
                                                                8 E1 2 0 1 0 1
                                                                9 Q1 4 3 0 myNPN
                                                               10 .model myNPN NPN
                                                               11 + IS=0.5f BF=100 NF=1 IKF=100m ISE=10f NE=2 RB=10
                                                               12 + TF=1n CJE=5p CJC=1p VJE=0.6 VJC=0.8 XTF=1 VTF=2 ITF=20m
                                                               13 .ac dec 50 1 1G
                                                               14 * LTspice syntax for plotting fT(Ic)
                                                               15 .step dec param Ic 100n 10m 10
                                                               16 .meas AC fT FIND Frequency WHEN dB(I(V1)/I(V2))=0 CROSS=1
                                                               17 * Run this netlist and press CTRL + L in the trace window
                                                               18 * This will bring up the output file (Spice error log) window
                                                               19 * In this window right-click "Plot .step'ed .meas data"
                                                               20 .end

Figure 4.12: Plot of FT versus frequency of
"myNPN", obtained with the simulation
test bench from Figure 4.11.

                                               The simulation results for myNPN are shown in Figure 4.12. At low currents
                                            the cut-off frequency is dominated by the depletion capacitance, while at high
                                            frequencies it is limited by the forward transit time tf. The maximum value
                                                                                    4.2. BIPOLAR TRANSISTORS 111

fT max of the cut-off frequency can be estimated from tf:

                             fT max  1 .                   (4.32)
                                        2tf

   At high collector currents, the base region tends to extend towards the col-     16 C. T. Kirk. A theory of transistor cut-
lector. This base push-out or Kirk-effect (see [Kirk1962]16) causes a reduction     off frequency ( ft) falloff at high current
                                                                                    densities. IEEE Trans. Electron Devices,
of the cut-off frequency at high collector currents.                                ED-9(2):164-174, February 1962

Operating point information

The current-drive capability and voltage-drive capability of a BJT depend on                       (1)+   -
                                                                                                                        (3)++-
the DC collector current IC and the collector-emitter voltage VCE, respectively.
Many other performance aspects, such as, the noise performance and the              (2)                           -
                                                                                               +
cut-off frequency also show a direct relation with the collector current. As
                                                                                              -
a consequence, we usually want to fix the operating point through fixing IC
and VCE.                                                                               implementation of
                                                                                       the nullor with two
   A method for fixing the operating point of nonlinear resistive multi-terminal       unity-gain VCVS

devices has been discussed in Chapter 3. According to the presented method,              (4)

fixing the operating point of a BJT by means of IC and VCE, requires the ad-        ++
dition of a voltage source VCE between the collector and the output and a
current source IC that flows from the emitter to the collector.                     1   1

   In order to obtain zero output voltage and zero output current for all DC        --

input and output terminations, a voltage source VBE has to be placed in series      Figure 4.13: Simulation test bench for de-
with the base and a current source IB has to be connected in parallel with          termination of the small-signal parameters.
the base-emitter junction. The values of these input sources depend on the

required values of IC and VCE, on the DC characteristics of the device and
on the operating temperature. They can be determined with the aid of the

circuit from Figure 4.13. The nullator at the output port (collector-emitter)

sets the condition for zero output voltage and zero output current, while the

norator at the input port delivers the correct driving quantities to satisfy these

conditions. The nullor is not available in spice but it can be implemented

with two unity-gain voltage-controlled voltage sources as illustrated in this

figure.

    Spice returns small-signal parameters in a certain operating point as the

result of an operating point analysis (.op statement). The parameters re-

turned depend on the device model and the spice version. Table 4.3 gives

an overview of the small-signal parameters of the Gummel-Poon model re-

turned by different spice versions.

   Below the listing of a circuit for determination of the small-signal param-
eters of myNPN for IC = 1mA and VCE = 3V.

 1 * FILE: myNPN_OP.cir
 2 * SPICE circuit file
 3*
 4 * Transistor with VCE and IC definition
 5 Q1 1 2 0 myNPN
 6 VCE 1 3 {V_CE}
 7 IC 0 3 {I_C}
 8*
 9 * nullor
10 E1 4 0 3 0 1
11 E2 2 0 2 4 1
12 *
13 .model myNPN NPN
14 + IS=0.5f BF=100 NF=1 IKF=100m ISE=10f NE=2 RB=10
15 + TF=1n CJE=5p CJC=1p VJE=0.6 VJC=0.8 XTF=1 VTF=2 ITF=20m
16 *
17 .param V_CE=3 I_C=1m
18 .op
19 .end

   If simulators do not provide the operating point information for the hybrid-
 equivalent circuit from Figure 4.3, the designer can:
112 ACTIVE DEVICES

                                                1. Estimate it from the characteristics given in data sheets or design manuals
                                                2. Obtain it from AC (small-signal) analysis in the desired operating point.

name description (see Figure 4.3)                               LTspice SIMetrix Pspice ngspice

DC               DC current gain                                BetaDC BetaDC  BETADC

 AC              Zero frequency small-signal current gain       BetaAC BetaAC  BETAAC

cbc              Small-signal internal base-collector capacitance Cbc  Cjc     CBC     cmu

c                Small-signal base-emitter capacitance          Cbe    Cje     CBE     cpi

ccs              Small-signal collector-substrate capacitance   Cjs    Cjs     CJS     csub

cbx              Small-signal external base-collector capacitance Cbx  Cxjc    CBX     cbx

gm               Forward transconductance                       Gm     Gm      GM      gm

IB               DC base current                                Ib     IB      IB      ib

IC               DC collector current                           Ic     IC      IC      ic

IE               DC collector current                           -      IE              ie

IS               DC substrate current                           -      IS      -       -

P                DC power dissipation                           -      Power   -       -

rb               Small-signal base resistance                   Rx     Rbase   -       -

gb = r1b Small-signal base conductance -                               -       GX      gx

ro               Small-signal output resistance                 Ro     Ro      RO      -

go = r1o Small-signal output conductance                        -      -               go

r                Small-signal internal base-emitter resistance  Rpi    Rpi     RPI     -

g = r1 Small-signal internal base-emitter conductance -                -       -       gpi

rµ               Reverse resistance                             -      -       -       -

gµ = r1µ Reverse conductance                                    -      -       -       gmu

FT               Cut-off frequency                              Ft     -       FT      -

VBE              DC base-emitter voltage                        Vbe    Vbe     VBE     vbe

VCB              DC collector-base voltage                      Vbc    Vcb     VBC     vbc

VCE              DC collector-emitter voltage                   Vce    Vce     VCE     -

Table 4.3: Small-signal parameters of the       4.2.5 Other models
Gummel-Poon model, returned from an
operating point analysis with various           For modern SiGe RF IC processes the Vertical Bipolar Inter-Company (VBIC)
simulators.                                     model of the BJT is often used. The model is a public domain replacement
                                                for the Gummel-Poon model. It has improved modeling of the saturation
17 Colin C. McAndrew, Jerold A. Seitchik,       region and includes modeling of breakdown and thermal effects. For more
Derek F. Bowers, Mark Dunn, Mark Foisy,         information, the reader is referred to literature [VBIC1996]17.
Ian Getreu, Marc McSwain, Shahrir
Moinian, James Parjer, David J. Roul-           4.2.6 Simplified models for hand calculations
ston, Michael Schroeter, Paul van Wijnen,
Lawrence F. Wagner. VBIC95, The Vertical        Complete spice models are suitable for numerical simulations but they are
Bipolar Inter-Company Model. IEEE Jour-         too complex to provide design information from analytical expressions. For
nal of solid-state circuits, 31(10):1476-1483,  this purpose we need simplified models that are suited for hand calculations.
October 1996                                    In this section, we will derive these models from the Gummel-Poon model.
                                                We will introduce a large-signal static model, a small-signal dynamic model
                                                and a noise model that can be used for analytical determination of the oper-
                                                ating point, the dynamic small-signal transfer and the noise behavior of the
                                                bipolar transistor, respectively.

18 DC behavior.                                 DC behavior
                                                The static large-signal behavior18 of a bipolar transistor in the active forward
                                                                                  4.2. BIPOLAR TRANSISTORS 113

operating region can roughly be predicted from the model shown in Figure
4.14. In this model, the bulk resistances, the high-injection effect, the non-
ideal base current and reverse operation have not been modeled. The model
describes port currents of a nonlinear resistive two-port as a function of the
port voltages:

                 IC = is exp VBE                    1 + VCE ,            (4.33)
                                     UT                  vaf             (4.34)

                 IB = IC .                                                        +                                       +
                        bf

The active forward operating range is limited by                                  -                                       -

                                    VBE > 0,                             (4.35)   Figure 4.14: Simplified BJT model for
                                    VCE > VCE,SAT.                       (4.36)   nonlinear instantaneous (DC) behavior.

Where VCE,SAT is the collector-emitter voltage where the base-collector junc-
tion is forward biased at a current that cannot longer be neglected with re-
spect to the current in the forward biased base-emitter junction.

   A simple model for hand calculations that includes operation in the for-
ward saturation region can be formulated as

IC = is          exp VBE - exp VBC                         1 + VCE ,     (4.37)
                                UT       UT                     vaf      (4.38)

IB = is exp VBE - 1 - is exp VBC - 1 .
                betaf               UT              betar  UT

Small-signal dynamic model

In most cases, the small-signal dynamic behavior of the bipolar junction tran-

sistor in the active forward operating region can sufficiently accurate be de-

scribed with the simplified hybrid- equivalent circuit from Figure 4.15. The

bulk resistances Re and Rc have been omitted. If xjc  0.5, the base-collector

capacitances cbc and cbx can both be connected to the internal node (b'), if            s

not, they should both be connected to the external node (b). For both cases

we may then use                                                                   b

                                    cµ = cbx + cbc.                      (4.39)      +                                    c

   The small-signal parameters of the simplified hybrid- equivalent circuit                                    -
can be estimated from the Gummel-poon model parameters and the operat-                                              e
ing point, thereby ignoring the current dependency of the current gain, of
the base resistance and of the forward transit time. In this way we obtain, for   Figure 4.15: Simplified hybrid- small-
operation in the active forward region                                            signal equivalent circuit of the BJT.

                rb = rb,        ro = I vaf+VCE C ,  c = cje + tf VICT ,  (4.40)
                r = bf VI TC ,  gm = IVC ,          cµ = cjc.

                                                T

fT and fmax

The cut-off frequency fT is defined as the unity-gain frequency of AC. It can

be obtained as                           gm .

                                fT =    2 c + cµ                         (4.41)

   The cut-off frequency can be seen as a figure of merit for the amplifying
capabilities of a transistor.

   A better figure of merit for the amplifying capabilities of an active device,
is the frequency at which the power gain of the transistor equals unity, when
114 ACTIVE DEVICES                         is driven from and terminated with the complex conjugate of its input and
                                           output impedances, respectively. Unity power gain of the BJT is found at the
Figure 4.16: Simplified hybrid- small-     frequency fmax, were
signal equivalent circuit with stationary
noise sources.                                                                              fmax =     fT .                       (4.42)
                                                                                                    8rbcµ

                                           Noise model

                                           The simplified noise model is shown in Figure 4.16. The noise contributions
                                           of the bulk resistances Re and Rc are omitted, while the remaining noise
                                           sources of the complete noise model from Figure 4.4 have been added to the
                                           simplified hybrid- equivalent circuit from Figure 4.15.

                                                                                                                            s

                                           b  +                                                                                c
                                       -
                                       +                                                            +
                                       -
                                       +                                                              -
                                                                                                    e
                                                                                         -
              +                            Determination of hybrid- parameters from simulation

            -                              The small-signal parameters can also be obtained from simulation. Figure
              +                            4.17 shows the simulation test bench for determination of the small-signal
                                           hybrid- parameters.
            -
                                              The procedure is as follows:
Figure 4.17: Simulation test bench for
determination of the hybrid- equivalent    1. Bias the transistor in the required operating point with the aid of the DC
circuit parameters.
                                              voltage sources VBE and VCE. The value of VBE can be obtained from an
                                              operating point simulation with the test bench from Figure 4.13.

                                           2. Make VAC1 = 1, 0 (magnitude 1, phase 0) and VAC2 = 0 and perform an
                                              AC analysis over the frequency range of interest

                                           3. Obtain approximations the values of the following parameters

                                                                                                rb + r = 1 Re{-I(V , AC1)}        (4.43)
                                                                                            gm r r = Re{-I(V b + r AC2)},         (4.44)
                                                                                                                                  (4.45)
                                                                                               c + cµ = Im{-I(VAC1)} .
                                                                                                                     2 f

                                           4. Make VAC1 = 0 and VAC2 = 1, 0 (magnitude 1, phase 0)                                (4.46)
                                                                                                                                  (4.47)
                                           5. Obtain approximations for the values of the following parameters                    (4.48)

                                                                            ro = 1 Re{-I(V , AC2)}
                                                                           cµ = Im{I(VAC1)} ,

                                                                                          2 f
                                                                            rµ = r + rb 1 r Re{-I(V . AC1)}

                                           6. The base resistance rb can at best be determined from noise measurements.
                                              This will be explained later.
                                                                                 4.3. JUNCTION FIELD EFFECT TRANSISTORS 115

4.3 Junction Field Effect Transistors

The principle of operation of a Junction Field effect device was first patented                                       19 Julius Edgar Lilienfeld. Method and
by J. E. Lilienfeld in 1925: [Lilienfeld1925]19. In 1952 Shockley (see [Shock-                                        apparatus for controlling electric currents,
leyFET1952]20) presented the theory for this device. The first working devices                                        October 1925
were reported by Dacey and Ross in 1953: [DaceyRoss1952]21.                                                           20 W. Shockley. A Unipolar "Field-Effect"
                                                                                                                      Transistor. Proc. of the I.R.E, pages 1365-
   Junction field effect transistors (JFETs) have a gate that is isolated by a                                        1376, November 1952
depletion layer. They are available as discrete devices and in integrated circuit                                     21 G.C. "Dacey and I.M." Ross. Unipolar
technology.                                                                                                           "Field-Effect" Transistor. Proc. of the I.R.E,
                                                                                                                      pages 970-979, August 1953
   Figure 4.18 shows how a P-channel JFET is realized in a bipolar integrated
circuit process. N-channel and P-channel JFETs are also available as discrete                                         Figure 4.18: Cross section and device
devices.                                                                                                              symbol of a p-channel JFET in (bipolar)
                                                                                                                      integrated circuit technology
          substrate gate source gate drain

                                                                                                                   s

     p     n+  p n+                          p                    g
isolation                               isolation                   sub d
           n- epitaxial layer

               p-substrate                                        Integrated
                                                                  Circuit
                                                                  PJFET

4.3.1 JFET simulation model

The spice simulation model for Junction field effect transistors is derived                                           22 H. Shichman and D. Hodges. Modeling
from the model proposed by Shichman and Hodges [ShichmanHodges1968]22,                                                and simulation of insulated-gate field-
it is shown in Figure 4.19. The intrinsic JFET with connections g, d and s, is                                        effect transistor switching circuits. IEEE J.
                                                                                                                      Solid-State Circuits, 3(3):285-289, September
modeled with two diodes, two nonlinear capacitors and a voltage-controlled                                            1968

current source. Source and drain series resistances Rs and Rd complete the                                            Figure 4.19: NJFET model according to
model.                                                                                                                Shichman and Hodges.

                                 s'     d'
           s                                                   d

                                     g

Instantaneous behavior

The instantaneous behavior of the intrinsic JFET is described by the I(V) rela-
tions of the two diodes and by a voltage-controlled channel current Ids Vgs , Vds .
116 ACTIVE DEVICES

                    The I(V) relations of the two diodes are

                                                                                2  M
                                                                                   2
                              exp Vgs - 1         exp Vgs - 1       1 - Vgs
                    Igs = Is       nUT     + isr       nrUT               pb       + 0.005 ,

                                                                    1 - Vgs        (4.49)
                                                                          pb
                                                                                2  M
                                                                                   2
                              exp Vgd - 1         exp Vgd - 1
                    Igd = Is       nUT     + isr       nrUT                        + 0.005 + Ii,

                                                                                   (4.50)

                    where Ii is the impact ionization current, which differs from zero in the for-
                    ward saturation region (Vgs > Vt and Vgd < Vt)

                                                                                

                    Ii = alpha Vds - Vgs - Vt     exp               -vk         .  (4.51)

                                                                Vds - Vgs - Vt

                    The saturation currents Is is obtained from the model parameter is, the

                    temperature coefficient xti, the temperature T and the scaling parameter

                    area as                Is = area · is T xti .
                                                                T0
                                                                                   (4.52)

                       The reference temperature T0 is the temperature at which the parameters
                    have been measured. Its default value in spice is 300K. The scaling factor
                    area scales the device as if area devices are connected in parallel.

                       The DC gate current IG is the sum of the two diode currents:

                                           IG = Igs + Igd .                        (4.53)

                       The bulk resistances Rd and Rs are obtained from the model parameters
                    re and rs, respectively. They depend on the scaling factor area:

                                                  Rd = rd ,                        (4.54)
                                                          area                     (4.55)

                                                  Rs = rs .
                                                          area

                       The voltage-controlled current Ids Vgs , Vds is modeled differently for
                    different operating regions:

                    1. Forward mode (Vds > 0) cut-off region: Vgs < Vt

                    With the gate-source voltage Vgs below the threshold voltage Vt the device

                    is turned off:

                                                  Ids = 0.                         (4.56)

                    2. Forward mode (Vds > 0) linear region: Vgs > Vt and Vgd > Vt

                       When both the intrinsic gate-source voltage Vgs and the intrinsic gate-
                       drain voltage Vgd are above threshold, the device operates in the so-called
                       linear region. In the linear region the device can be considered a voltage-
                       controlled resistor. The resistance of this resistor also depends on the in-
                       trinsic drain-source voltage

                    Ids = area. (1 + lambda.Vds ) Vds 2 Vgs - Vt - Vds . (4.57)

                    3. Forward mode (Vds > 0) saturation region: Vgs > Vt and Vgd < Vt

                       With the intrinsic gate-source voltage Vgs above threshold and the intrin-
                       sic gate-drain voltage Vgd below threshold the device acts as a voltage-
                       controlled current source. The drain-source current depends approxi-
                                            4.3. JUNCTION FIELD EFFECT TRANSISTORS 117

mately quadratically on the so-called effective intrinsic gate-source voltage
Vgs - Vt:

                                                                                        2  (4.58)

       Ids = area. (1 + lambda.Vds ) Vgs - Vt .

4. For reverse mode operation (Vds < 0) the above conditions and equations
   hold after the source and the drain connections have been swapped.
   The transconductance factor  [A2/V] and its temperature dependency is

modeled with two parameters beta and betatc:

                                = beta × 1.01betatc(T-T0).

   The threshold voltage Vt is defined by the parameter vto, its temperature
coefficient vtotc and the temperature T:

                               Vt = vto + (T - T0) vtotc.

The parameter lambda models the change of the drain-source current due to
a change of the channel voltage Vds of the intrinsic JFET, in a similar way as
the Early voltage for a bipolar transistor. The Shichman and Hodges model
does not have a smooth transition between the cut-off region, the linear region
and the saturation region. This results in discontinuities in the dI(V)/dV
characteristic, which may result in unreliable distortion simulation results
with signals that show large drain-source voltage excursions.

Modeling of dynamic effects

The charge storage in JFETs is modeled by the voltage-dependent junction ca-
pacitances. The built-in junction voltage pb, the grading coefficient m and the
zero bias depletion capacitances cgs, cds and fc are associated parameters.
Similar as with bipolar transistors the parameter fc is used for modeling
of the capacitances in case of a forward-biased junction. The capacitances
Cgs and Cgd are proportional with the scaling constant area. The model
equations are

Cgs =  m area.cgs ;  Vgs  fc.pb,                                                           (4.59)
       1 - pb Vgs                                                                          (4.60)
                                                                                           (4.61)
Cgs = (1 - fc)m+1 area.cgs 1 - fc (m + 1) + m Vgs pb ; Vgs > fc.pb,                        (4.62)

Cgd =  m area.cds ;  Vgd  fc.pb,
       1 - pb Vgd

Cgs = (1 - fc)m+1 area.cgs 1 - fc (m + 1) + m Vgd pb ; Vgd > fc.pb.

Small-signal equivalent circuit

The small-signal equivalent circuit of the JFET is shown in Figure 4.20. It is
obtained from linearization of the model from Figure 4.19 in an operating
point Q , defined by VGS, VDS, IG and IDS.

   The parameter values are

       cgs = Cgs Q ,  Vd s                  Rd = rd area ,
       cgs = Cgs Q ,  rds = I            ,  Rs = rs area .
                                  ds  Q
                                                                                           (4.63)
                                  Id s

                      gm = V  ,

                                    gs Q
118 ACTIVE DEVICES                                                       g                                 d'         d
                                                                                  s'
Figure 4.20: JFET small-signal equivalent                                                  s
circuit.

                                           Stationary noise model

                                           Figure 4.20 shows the small-signal noise model of the JFET. It models noise
                                           associated with the bulk resistances and with the channel current.

Figure 4.21: JFET small-signal equivalent

circuit with stationary noise sources.                   g                                     d'                     +  -  d

                                                                         s'

                                                                                +
                                                                               -

                                                                                  s

                                           The thermal noise of the two bulk resistors is given by                                (4.64)
                                                                              Svs = 4kT rs ,
                                                                                             area

                                                                              Svd = 4kT rd .                                      (4.65)
                                                                                           area

                                           The shot noise ig associated with the gate current has a spectral density

                                                                                     Sig = 2qIG.                                  (4.66)

                                           The    thermal     noise  of  the  channel  current     shows   has  a  1  component:
                                                                                                                   f

                                                                                         2 kf af                                  (4.67)
                                                                         Sid = 4kTgm + IDS.

                                                                                         3f

                                           This can be denoted as

                                                                         Sid = 4kTgm 23 1 + ff ,                                  (4.68)
                                                                                                                                  (4.69)
                                                                         f =         3kf af
                                                                                            IDS,
                                                                                     8kTgm

                                           where  f  is  the  corner  frequency      for  the  1   noise.  Low  noise    JFETs  can  have
                                                                                               f

                                           f below 100Hz. This cut-off frequency strongly depends on the technology

                                           and may as well exceed 10kHz.
                                                                                 4.3. JUNCTION FIELD EFFECT TRANSISTORS 119

4.3.2 Device parameters

In this section we will give an overview of the spice model parameters for
junction FETs. The following model types are supported:

        model  description
               N-channel Junction Field Effect Transistor
        NJF    P-channel Junction Field Effect Transistor
        PJF

   Table 4.4 gives an overview of the spice JFET model parameters. The
scaling factor area scales the device as if area devices are connected in
parallel. Some spice versions have additional parameters. The parameters
listed in table 4.4 are supported by LTspice, SIMetrix and PSPICE.

name    description                                 unit   default               Table 4.4: SPICE JFET model parameters;
vto     pinch-off voltage                           V      -2                    currents, transconductance and capaci-
beta    transconductance factor                     A/V2   10-4                  tances are proportional to area, resistances
lambda  channel length modulation coefficient       1/V    0                     are inversely proportional to area.
rd      drain bulk resistance                              0
rs      source bulk resistance                             0
is      gate junction saturation current            A      10-14
cgs     zero-bias gate-source capacitance           F      0
cgd     zero-bias gate-drain capacitance            F      0
pb      built-in gate junction potential            V      1
fc      forward bias depl. cap. coefficient         V      0.5
af      flicker noise exponent                             1
kf      flicker-noise coefficient                   -      0
n       gate junction emission coefficient          -      1
nr      gate junction recombination coefficient     -      2
xti     saturation current temperature coefficient  A      3
isr     recombination saturation current            1/V    0
alpha   ionization coefficient                      V      0
vk      ionization knee voltage                     -      0
m       junction grading coefficient                V/oC   0.5
vtotc   vto temperature coefficient                 %/oC   0
betatc  beta exponential temperature coefficient           0

4.3.3 JFET simulated device characteristics                                      -                      +
                                                                                 +
Figure 4.22 shows a test bench for simulation of the device characteristics.                         -
The netlist file is shown below:
                                                                                 Figure 4.22: Circuit for determination of
 1 DCchars                                                                       the DC characteristics of an n-channel JFET
 2 * FILE: myNJF_DCchars.cir                                                     with spice.
 3 * LTspice circuit file
 4 VGS 1 0 0
 5 VDS 2 0 0
 6 J1 2 1 0 myNJF
 7 .model myNJF NJF Beta=25m Betatce=-.5 Rd=1 Rs=10 Lambda=40m
 8 + Vto=-.6 Vtotc=-2m Is=250p Isr=1p N=1 Nr=2 Xti=3 Alpha=-1m
 9 + Vk=30 Cgd=5p M=.6 Pb=.5 Fc=.5 Cgs=5p Kf=50a Af=1
10 * Syntax of nested DC analysis depends on spice version
11 *.dc VDS 0 5 10m VGS -0.6 0 0.1
12 .dc VGS -0.6 0 10m VDS 1 5 1
13 .end

   Figure 4.7 shows the forward transfer characteristics and the output char-
acteristics of the junction FET myNJF. The transfer characteristics in the for-
120 ACTIVE DEVICES

                                             ward saturation region and with lambda = 0 can be approximated by

                                                                 Ids = area.beta Vgs - vto 2 .                  (4.70)

Figure 4.23: DC transfer characteristics     Saturation current
and output characteristics of "myNJF",
obtained from simulation with the circuit
from Figure 4.22.

                                             When Vgs = 0 the drain current equals the so-called saturation current Idss.

                                             Since the gate-source junction of a JFET should be reversely biased, Idss is the
                                             largest possible drain current; with lambda = 0, it equals

                                                                 Idss = area.beta.vto2.                         (4.71)

                                             Cut-off frequency

                                             The cut-off frequency of a JFET is defined in a similar way as with bipolar
                                             transistors. The unity gain frequency for the current gain is found as

                                                                 fT =  gm ,                                     (4.72)
                                                                       2 Cgs + Cds
             +-
    ++        -                                                  fT = gm .                                      (4.73)
    + 2Ciss
                      -
                                  Where Ciss is defined as the input capacitance with the output shorted.

    -

   implementation of                         Operating point information
   nullor with two
   unity-gain VCVS                           Similar as with the bipolar transistor, the current drive capability and the
                                             voltage drive capability of a JFET depend on the DC drain current ID and
++                                           the drain-source voltage VDS, respectively. Many other performance aspects,
                                             such as, the noise performance, and the cut-off frequency also show a direct
1   1                                        relation with the drain current. As a consequence, we often want to fix the
                                             operating point by means of fixing ID and VDS.
--
                                                A method for fixing the operating point of nonlinear resistive multi-terminal
Figure 4.24: Simulation test bench for de-   devices has been discussed in Chapter 3. According to the presented method,
termination of the small-signal parameters.  fixing the operating point of a JFET by means of ID and VDS, requires the ad-
                                             dition a voltage source VDS between the drain and the output, and a current
                                             source ID that flows from the source to the drain.
                                          4.3. JUNCTION FIELD EFFECT TRANSISTORS 121

   In order to obtain zero output voltage and zero output current for all DC
input and output terminations, a voltage source VGS has to be placed in series
with the gate, and a current source IG has to be connected in parallel with
the gate-source junction. The values of these sources depend on the required
values of ID and VDS, on the DC characteristics of the device and on the op-
erating temperature. They can be determined with the aid of the circuit from
Figure 4.24. The nullator at the output port (drain-source) sets the condi-
tion for zero output voltage and zero output current, while the norator at the
input port delivers the correct driving quantities to satisfy these conditions.
Although the nullor is not available in spice, it can be implemented with the
aid of two unity-gain voltage-controlled voltage sources as illustrated in this
figure.

   Spice returns the small-signal parameters in a certain operating point as
the result of an operating point analysis (.op statement). The parameters
returned depend on the device model and the spice version. Table 4.5 gives
an overview of the small-signal parameters of the JFET returned by different
spice versions.

name description (see Figure 4.20) LTspice SIMetrix Pspice ngspice

cgd  Gate-drain capacitance   Cgd  CGDt   CGD

cgs  Gate-source capacitance  Cgs  CGSt   CGS

gm   Forward transconductance Gm   GM     GM   gm

g    Input conductance                         ggs

gds  Output conductance       Gds         GDS  gds

IG   DC gate current               IG          ig

ID   DC drain current         Id   ID     ID   id

IS   DC source current        -    IS          is

IGD DC drain-gate current                      igd

P    DC power dissipation     -    Power

VGS DC gate-source voltage    Vgs         VGS  vgs

VGD DC gate-drain voltage                      vgd

VDS DC drain-source           Vds         VDS  -

   SiMetrix does not output data for the output conductance gds and the op-      Table 4.5: Small-signal parameters of the
erating voltages. However, the latter can be obtained from the nodal voltages.   JFET, returned from an operating point
                                                                                 analysis with various simulators.
ngspice does not provide data for the small-signal capacitances.

4.3.4 Simplified models for hand calculation                                     G  D

The complete spice models are suitable for numerical simulations but are too            S
complex to provide design information. For this purpose we need simplified
models that are suitable for hand calculations. In this section we will derive   Figure 4.25: Simplified JFET DC model for
such models. We will introduce a large signal static model, a small-signal       hand calculations.
dynamic model and a noise model that can be used for determination of the
operating point, the dynamic small-signal transfer and the noise behavior
of the JFET, respectively. We will only discuss the active forward saturation
region.

DC behavior

The instantaneous large-signal model that is suitable for hand calculations is
depicted in Figure 4.25. The diodes, the capacitances and the bulk resistances
have been omitted and only the nonlinear voltage-controlled current source
remains. The current of the controlled source depends on both the gate-
source and the drain-source voltage. Different expressions must be used for
the cut-off region, the linear region and the saturated region.
122 ACTIVE DEVICES

                                                  1. Forward mode (VDS > 0), cut-off region: VGS-vto< 0               (4.74)
                                                                                                IDS = 0.

                                                  2. Forward mode (VDS > 0), linear region: VDS < VGS - vto, or, alterna-
                                                     tively: VDG < -vto

                                                         IDS = area.beta (1 + lambdaVDS) VDS2 (VGS - vto) - VDS). (4.75)

                                                  3. Forward mode (VDS > 0), saturation region: 0  VGS - vto  VDS, or,
                                                     alternatively: VDG > -vto

                                                          IDS = area.beta (1 + lambdaVDS) (VGS - vto)2 .              (4.76)

                                                  Small-signal dynamic behavior
                                                  The simplified small-signal dynamic model is shown in Figure 4.26.

Table 4.6: JFET small-signal model parame-        param.  cut-off.  linear region                 saturation region
ters for given device model parameters and        Cgs     area.cgs  see expression 4.59
operating point.                                  Cds     area.cds  see expression 4.61           see expression 4.59
                                                  gm      0         2area.betaVDS
                                                                                                  see expression 4.61
                                                  gds     0         2area.beta(VGS - vto)
                                                                                                  2area.beta (VGS - vto)
                                                                    voltage controlled resistor;      

                                                                    approx. for VDS = 0           = 2 area.betaIDS
                                                                                                  l a m b da IDS
                                                                                                  (lambda  1)

G  +                                           D

                  -                                  The parameters can be obtained from a spice operating point analysis.
       S                                          They can also be estimated from the device parameters and the DC operating
                                                  voltages and currents. The equations are shown in Table 4.6.
Figure 4.26: Simplified hybrid  small-
signal equivalent circuit of the JFET.

   G+ D                                           Noise model
                      -
                                                  A simplified noise model is shown in Figure 4.27. The noise of the bulk
   S                                              resistances Rs and Rd is omitted, while the remaining noise sources are added
Figure 4.27: Simplified small-signal equiva-      to the simplified hybrid- equivalent circuit from Figure 4.26.
lent circuit of a JFET with noise sources.
                                            -     Determination of hybrid- parameters from simulation
              +                             +
            -                               -     The small-signal parameters can also be obtained from simulation. Figure
              +                             +     4.17 shows the simulation test bench for determination of the small-signal
            -                                     hybrid- parameters.

Figure 4.28: Simulation test bench for               The procedure is as follows:
determination of the hybrid- equivalent
circuit parameters.                               1. Bias the JFET in the required operating point with the aid of the DC volt-

                                                     age sources VGS and VDS. The value of VGS can be obtained from an
                                                     operating point simulation with the test bench from Figure 4.24.

                                                  2. Make VAC1 = 1, 0 (magnitude 1, phase 0) and VAC2 = 0 and perform an
                                                     AC analysis over the frequency range of interest

                                                  3. Obtain approximations the values of the following parameters

                                                                           gm = Re{-I(VAC2)},                         (4.77)
                                                                    cgs + cds = Im{-I(VAC1)} .                        (4.78)

                                                                                          2 f

                                                  4. Make VAC1 = 0 and VAC2 = 1, 0 (magnitude 1, phase 0)
                                                                                4.4. MOS TRANSISTORS 123

5. Obtain approximations for the values of the following parameters  (4.79)
                                                                     (4.80)
                                      ro = 1 Re{-I(V , AC2)}
                                     cds = Im{I(VAC1)} .

                                                     2 f

4.4 MOS transistors                                                             23 Kahng and Dawon. Electric Field Con-
                                                                                trolled Semiconductor Device, May 1960
The Metal Oxide Semiconductor Transistor was invented by Kahng and Da-          24 F. "Wanlass and C." Sah. Nanowatt logic
won in 1959: [KahngDawon1960]23. The first CMOS circuit has been reported       using field-effect metal-oxide semicon-
in 1963 by Wanlass and Sah (see [Wanlass-Sah1963]24).                           ductor triodes. 1963 IEEE International
                                                                                Solid-State Circuits Conference. Digest of
   MOS Transistors are field effect devices with their gate isolated from the   Technical Papers, VI:32-33, 1963
channel by SiO2. Aluminium and polysilicon are commonly used as gate
materials. Depending on their application MOS transistors are fabricated in
different ways:

1. Standard IC CMOS devices are lateral devices with a symmetrical struc-
   ture: the source and the drain can be interchanged.

2. Modern IC Fin FET devices have a three dimensional gate structure that
   almost completely surrounds the channel.

3. High-voltage MOS transistors can be fabricated as lateral devices or as
   vertical devices. They are strongly asymmetrical: the low-voltage gate-
   source structure differs from the high-voltage gate-drain structure.

   MOS transistors found their first application in digital circuits. Although  25 Combined bipolar and CMOS IC technol-
bipolar and BiCMOS25 IC processes are still in use, high-volume analog ICs      ogy.
and mixed signal ICs26 are nowadays predominantly fabricated in CMOS            26 Mixed-signal: analog and digital signal
                                                                                processing combined in one IC.
technology.
   Power MOS transistors are available in high-voltage IC processes and as

discrete devices. They are mostly used as power switches in switched regu-
lators and switched amplifiers.

   Figure 4.29 shows a simplified cross section of P-substrate C-MOS (com-
plementary MOS) process as well as the device symbols for NMOS and
PMOS transistors.

         PMOS                  NMOS                                             Figure 4.29: Cross section of a standard
                                                                                CMOS integrated circuit process.
source gate drain bulk  source gate drain bulk

p SiO2 p     n+                  n+ SiO2 n+
                        p-substrate
n well

          d                       d
g
                        gb
          b                       s

          s                 NMOS
    PMOS
124 ACTIVE DEVICES

                    4.4.1 Operation

                    We will describe the basic MOS operation for the NMOS from Figure 4.29. We
                    will assume that the source and the bulk (substrate) of the NMOS have been
                    connected to a reference potential (0V), while the drain has been connected
                    to a fairly large positive voltage VDS. For this set up, we will briefly describe
                    the relation between the drain-source current IDS and the gate-source voltage
                    VGS.

                       With VGS = 0 the potential at the interface between the oxide and p-doped
                    substrate is defined by the built-in junction voltage and the oxide capacitance.

                       At small values of VGS, due to capacitive coupling with the gate, this so-
                    called surface potential almost linearly increases with VGS and the source starts
                    injecting electrons in the p-region. The electrons injected in the p-region start
                    to form an n-type channel under the gate and we speak of weak inversion.
                    These electrons reach the accelerating electrical field of the drain depletion
                    layer through diffusion. They are collected at the drain terminal. As a result
                    the IDS (VGS) characteristic shows an exponential relationship comparable
                    with that of the IC (VBE) relationship of a lateral bipolar NPN transistor.

                       At increasing values of VGS, the channel extends further under the gate,
                    and the surface potential does no longer increase significantly with the gate-
                    source voltage. The drain current now increases quadratically with the differ-
                    ence between VGS and the so-called threshold voltage VT, just as with the JFET.
                    The device now operates in strong inversion. The threshold voltage VT is de-
                    fined as the gate-source voltage at which the transition from weak inversion
                    to strong inversion takes place.

                       As long as the effective gate-source voltage VGS - VT is below VDS, the chan-
                    nel does not extend to the drain. In this pinch-off or saturation region the
                    drain-source current only shows a minor dependency of VDS due to the chan-
                    nel length modulation, an effect comparable to the Early effect in bipolar tran-
                    sistors.

                       If VGS increases to a level of VT above VDS the channel extends from the
                    source to the drain and IDS becomes strongly dependent on VDS as well. The
                    transistor then acts as a voltage-controlled resistor and we speak of the linear
                    operating region.

                    Small geometry effects

                    The basic operation described above holds for large MOS transistors. How-
                    ever, with shrinking dimensions in CMOS IC processes, small geometry ef-
                    fects have to be taken into account. Below a listing of the most important
                    small-geometry effects.

                    1. With shrinking oxide thickness, the influence of the vertical component
                       of the electrical field in the channel on the charge carrier mobility cannot
                       longer be ignored. This field influences the vertical current density profile.
                       A high vertical field causes a reduction of the mobility of the electrons
                       moving horizontally from the source to the drain.

                    2. A shrinking channel length also results in an increase of the lateral elec-
                       trical field. At high field strengths the velocity of the charge carriers satu-
                       rates.

                    3. The electrical field in the gate increases with shrinking oxide thickness.
                       This causes a slow change of charge storage in the oxide over time and re-
                       sults in a slow change of VT over time. This effect may limit the operational
                       life time of CMOS ICs.

                    4. In large MOSFETs the channel length modulation is the main contributor
                       to the VDS dependency of IDS. In short-channel MOSFETs the depletion
                                                                                 4.4. MOS TRANSISTORS 125

region of the drain reaches far and deep under the channel and reduces the
channel to bulk depletion capacitance under the channel. This improves
the coupling between the gate-source voltage and the surface potential.
This drain-induced barrier lowering (DIBL) effect causes VT to decrease with
VDS. As a result IDS increases with VDS.

4.4.2 MOSFET modeling                                                            27 Daniel P. Foty. MOSFET modeling with
                                                                                 SPICE: principles and practice. Prentice-Hall,
MOS transistors found their first application in digital circuits. Adequate      Inc., USA, 1997. ISBN: 0-13-227935-5
simulation of these digital circuits could be preformed with relatively simple   28 H. Shichman and D. Hodges. Modeling
simulation models. Nowadays MOS transistors are also applied in analog           and simulation of insulated-gate field-
integrated circuits, which requires an accurate description for all possible     effect transistor switching circuits. IEEE J.
operating conditions.                                                            Solid-State Circuits, 3(3):285-289, September
                                                                                 1968
   The behavior of MOS transistors strongly depends on both their geome-
try and their manufacturing technology. The rapid development of new IC          29 B. Sheu, D. Scharfetter, P. Ko, and M.
technologies and the reduction of dimensions continuously present new chal-      Jeng. BSIM: Berkely Short Channel IGFET
lenges to MOSFET modeling. For a complete description of MOSFET models           Model for MOS Transistors. IEEE Journal of
including references to publications about underlying physical mechanisms        Solid State Circuits, SC-22:558-566, 1987
the reader is referred to literature. Foty describes the following models(see    30 HSPICE User's Manual. Campbell,
[Foty1997]27):                                                                   California, 1993

1. The Level 1 model is usually referred to the model presented by Shichman      31 Cheng, Y. et al. BSIM3 Version 3.0 Man-
   and Hodges (see [ShichmanHodges1968]28). This is a relatively simple first    ual. University of California/Berkeley,
   generation MOS model for thick-oxide, long and wide channel MOSFETs,          Electronics Research Laboratory, 1995
   operating in strong inversion. It can be used if simulation speed is more
   important than accuracy. Due to its low complexity, this model can also be    32 D. Velghe, R. Klaassen and F. Klaassen.
   used as a basis for hand calculations.                                        MOS Model 9, 1994. Unclassified Report
                                                                                 NL-UR 003/94
2. The Level 2 model is also a first generation model. It is based on the Level
   1 model. Corrections are in the form of additional equations that account
   for small-geometry effects. They make the model mathematically complex
   and inefficient.

3. The Level 3 model is also based on the Level 1 model, but the added
   equations that account for small-geometry effects have a more empirical
   character. They use less parameters and are more simple than those of
   the Level 2 model. The Level 3 model also includes basic modeling of
   operation in weak inversion.

4. The BSIM (Berkeley Short-Channel IGFET Model, see [SheuEtAll1987]29 )
   is a second generation MOSFET model. The model has its focus on fast
   and robust simulation rather than on a physical basis.

5. The HSPICE Level 28 model is a second generation model based on the
   BSIM model (see [HSPICE1993]30). Its improvements strongly facilitated
   analog CMOS circuit design. It is a proprietary model developed by Meta-
   Software.

6. The BSIM2 model is also a second generation MOSFET model. It is an
   improvement of the BSIM model developed by the university of Berkeley.

7. The BSIM3 model is a third generation model (see [BSIM3-1995]31). Sec-
   ond generation models are constructed with an extrinsic model on top of
   the intrinsic model structure. The third generation BSIM3 model has its
   geometry parameters included the intrinsic model.

8. The MOS Model 9 is a third generation MOS model developed at Philips
   Laboratories that has been made generally available (see [MOS9]32). The
   modeling approach differs from the approach taken in the development of
   the BSIM3 model. The MOS Model 9 still distinguishes an intrinsic and an
   extrinsic structure, but it has improved mathematical modeling.
126 ACTIVE DEVICES

                                              9. The EKV model (see [EnzVittoz2006]33) has a physical base and is oriented       33 Christian C. Enz, and
                                                 on low-power analog design. It differs from other third generation models       Charge-based MOS Trans
                                                 because it takes the bulk node as reference rather than the source node.        Wiley & Sons Inc., 2006
                                                 Source and drain are treated equally, yielding a symmetrical model with         85541-6
                                                 smooth analytical equations for all operating regions. Hence, it is very
                                                 well suited for analog design simulation.

34 Chetan Kumar Dabhi, Shivendra Singh        10. The BSIM4 model is suited for analog CMOS design in technology nodes
Parihar, Harshit Agrawal, Navid Paydavosi,       below 100nm (see [BSIM4-2017]34).
Tanvir Hasan Morshed, Darsen D. Lu,
Wenwei(Morgan)Yang, Mohan V. Dunga,              In the following sections only a selection of the above models will be dis-
Xuemei (Jane) Xi, Jin He, Weidong Liu,        cussed. Due to its relative simplicity, the Level 1 model can be used as a basis
Kanyu, M. Cao, Xiaodong Jin, Jeff J. Ou,      for hand calculations for devices working in strong inversion in the saturated
Mansun Chan, Yogesh Singh Chauhan, Ali        and in the linear operating region. We will discuss the model in section 4.4.3.
M. Niknejad, Chenming Hu. BSIM4 4.8.1
MOSFET Model. University of Californi-           The Level 1 model is not accurate enough to predict the behavior of ana-
a/Berkeley, 2017                              log CMOS circuits in modern sub micron technology. In modern IC design
                                              predominantly BSIM3, BSIM4 and MOS Model 9 are used. Because of their
35 Binkley, David M. Tradeoffs and Optimiza-  complexity they are not very well suited for hand calculations. For hand cal-
tion in Analog CMOS Design. John Wiley &      culations of the voltage and current handling capabilities of MOS transistors,
Sons Inc., 1997. ISBN: 978-0-470-03136-0      the Level 1 is still widely used. In section 4.4.6 we will confine ourselves
                                              to a brief discussion of small-signal models and model data obtained from
                                              simulation with some of these models.

                                                 More attention will be paid to the EKV model. The physical bases of this
                                              model with smooth analytical expressions that cover all operating conditions,
                                              makes them very well suited for deriving design information at early stages
                                              of the design. Binkley describes the application of the EKV model, and par-
                                              ticularly, the use of the inversion coefficient, for taking design decisions (see
                                              [Binkley2008]35).

                                                 The symbolic simulator SLiCAP uses small-signal models of which the
                                              parameters are related to the device geometry and the inversion coefficient.
                                              Both the basics and the application of the EKV model will be discussed in
                                              section 4.4.7.

                                              4.4.3 MOSFET level 1 model

Figure 4.30: spice MOSFET model

                                                     b

                                                 s'                       d'

                                              s                               d

                                                                                                              g

                                                 Figure 4.30 shows the level 1 MOSFET model as it is implemented in spice.
                                              The model consists of a four-terminal intrinsic MOS transistor and two bulk
                                              resistances in series with the intrinsic transistor. Some spice versions support
                                              bulk resistances for the gate and the bulk connections. Some geometrical
                                              arguments can be given to the MOS model (see the spice reference manual).
                                              We will give an overview of these arguments and the parameters in section
                                              4.4.4. The expressions are given for N-channel MOSFETs.
                                                                                4.4. MOS TRANSISTORS 127

Instantaneous behavior

The gate and bulk currents for all operating conditions are given by the diode
currents:

                         IG = 0,                                  (4.81)
                         IB = IBS + IBD,                          (4.82)
                        IBS = Ibs exp Vbs U - 1 , T               (4.83)
                        IBD = Ibd exp Vbd U - 1 , T
                                                                  (4.84)

if js = 0, as = 0, or ad = 0 (as and ad are arguments for the drain and
source areas, respectively) we have

                           Ibs = is,                              (4.85)
                           Ibd = is,                              (4.86)

else:

                           Ibs = as.js,                           (4.87)
                           Ibd = ad.js,                           (4.88)

where is and js represent the drain-bulk and source-bulk junction satura-
tion current and current density, respectively. The bulk resistances can be
modeled with geometrical arguments:

       Rs = rsh.nrs or Rs = rs/w,                                 (4.89)
       Rd = rsh.nrd or Rd = rd/w,                                 (4.90)

or without geometrical arguments:

                           Rs = rs,                               (4.91)
                           Rd = rd.                               (4.92)

   The model equations of the controlled source Ids differ for the various
operating regions:

1. Normal mode (Vds > 0), cut-off region: Vgs - Vto < 0; the cut-off voltage
   Vto depends on the bulk-source or "back-gate" voltage:

       Vto = vto + gamma                                          (4.93)
                                   (phi - Vbs ) - phi ,

while

                                   Ids = 0.                       (4.94)

2. Normal mode (Vds > 0), linear region: Vds < Vgs - Vto, or, alternatively:
   Vdg < -Vto

       IDS = w kp (1 + lambda.Vds ) Vds      Vgs - Vto - Vds 2 .  (4.95)
                l

3. Normal mode (Vds > 0), saturation region: 0  Vgs - Vto  Vds , or,
   alternatively: Vdg > -Vto

       IDS = w kp l 2 (1 + lambda.Vds ) Vgs - Vto 2 .             (4.96)

4. Reverse mode (Vds < 0)
128 ACTIVE DEVICES

                    For reverse mode operations the drain and the source connections are
                    swapped.

                       If not given, the transconductance factor kp is obtained from geometrical
                    input parameters and physical constants:

                                     kp = uo × 10-4 ox [A/V2],                   (4.97)
                                                           tox

                    in which ox is the permittivity of SiO2, which is about 34 × 10-12F/m. The
                    factor 10-4 is a consequence of the units given to the surface mobility uo:
                    cm2/Vs. If we define Cox as the oxide capacitance per unit of area:

                                            Cox = oxw.l [F],                     (4.98)
                                                      tox

                    the transconductance factor can alternatively be written as

                                     kp = uo × 10-4Cox [A/V2].                   (4.99)

                       In IC design manuals, the MOS transconductance factor kp is often de-

                    noted as sq. Modern low-voltage MOS processes can have sq values larger
                    than 100 × 10-6A/V2.

                    Dynamic effects

                    The dynamic behavior of the MOS transistor is modeled with the capaci-

                    tances from Figure 4.30. The input capacitance Cgs is the sum of the gate-
                    source overlap capacitance Cgso and a portion of the oxide capacitance. The
                    latter one depends on the operating mode of the MOS. In the linear operating
                    range it is 21 Cox and in the saturation region it amounts 23 Cox.

                       The capacitance Cgd also depends on the mode of operation. In the linear
                    operating range it is 12 Cox + Cgdo and in the saturation range it equals the
                    gate-drain overlap capacitance Cgdo. The gate-source overlap capacitance Cgso
                    and the gate-drain overlap capacitance Cgdo depend on the device width:

                                            Cgso = cgso.w,                       (4.100)
                                            Cgdo = cgdo.w.                       (4.101)

                       The gate-bulk capacitance Cgb also depends on the operating mode. In this
                    model it is determined by the bulk-gate overlap capacitance:

                                                   Cgb = cgbo.l.                 (4.102)

                       The source-bulk and drain-bulk depletion capacitances depend on the
                    junction voltages:

                    Cbs =              cj.as         cjsw.ps       Vbs  fc.pb,   (4.103)
                                          V  mj +       V  mjsw ;

                                     1 - bs        1 - bs

                                             pb            pb

                    Cbd =              cj.ad         cjsw.pd       Vbd  fc.pb.   (4.104)
                                          V  mj +       V  mjsw ;

                                     1 - bd        1 - bd

                                             pb            pb

                    If no geometrical arguments are given, w and l have their default values and
                    the model equations for these capacitances are:

                                     Cbs =      cbs       Vbs  fc.pb,            (4.105)
                                     Cbd =       V  mj ;  Vbd  fc.pb.            (4.106)

                                            1 - bs

                                                    pb

                                               cbd
                                                 V  mj ;

                                            1 - bd

                                                    pb
                                                                                4.4. MOS TRANSISTORS 129

Small-signal equivalent circuit

The small-signal equivalent circuit of the MOSFET is shown in Figure 4.31. It
consists of the five capacitances, two linear controlled sources and the bulk
resistances.

   g                                                   d'        d              Figure 4.31: Small-signal equivalent circuit
                                                                                of a MOS transistor.

   b
                                               s'

                                                s

The transconductances of the controlled sources are defined as

                          gm = IDS ,                                (4.107)
                                  Vgs                               (4.108)

                         gmb = IDS V . bs

The capacitances are according to the definitions above. The output resis-

tance rds is defined as  rds = Vds I . DS

                                                                    (4.109)

   The values of the bulk resistances are obtained according to expression
4.89 to 4.92.

Stationary noise model

A frequency domain noise analysis can be performed in spice. For this
purpose, stationary noise sources are added to the small-signal equivalent
circuit from Figure 4.31. This stationary noise model is shown in Figure 4.32.

                                                                                Figure 4.32: Small-signal equivalent circuit

g                                                  d'      +  -     d           of a MOS transistor with added noise

                                                                                sources.

b
                                            s'

                         +

                         -
                             s

   The thermal noise of the two bulk resistors Rs and Rd is given by their
voltage spectral densities Svs and Svd, respectively:

                         Svs = 4kTRs,                               (4.110)

                         Svd = 4kTRd.                               (4.111)
130 ACTIVE DEVICES

                                             The  noise  related  to  the  channel  current  shows    a  1  component:
                                                                                                         f

                                                                                           2 kf af                          (4.112)
                                                                           Sid = 4kTgm + IdsQ .

                                                                                           3f

                                             This can also be denoted as

                                                                           Sid = 4kTgm 23 1 + ff ,                          (4.113)
                                                                                                                            (4.114)
                                                                           f =      3kf af
                                                                                           IdsQ ,
                                                                                    8kTgm

                                             where  f    is  the  corner   frequency  for  the     1  noise.  The cut-off frequency
                                                                                                   f

                                             strongly depends on the technology and can exceed 1 [MHz].

                                             4.4.4 Device parameters

                                             Geometrical scaling factors
                                             Table 4.7 shows the geometrical scale factors for MOS devices.

Table 4.7: MOS device model equations               name description                                          unit default
scale factors.
                                                    w        channel width                                    m 10-4
                                                                                                              m 10-4
                                                    l        channel length

                                                    ad drain area                                             m2 0

                                                    as       source area                                      m2 0

                                                    pd       perimeter of drain junction                      m0

                                                    ps       perimeter of source junction                     m0

                                                    nrd number of squares drain diffusion -                         0

                                                    nrs number of squares source diffusion -                        0

                                             Model parameters instantaneous behavior

                                             The MOS model parameters that describe the instantaneous behavior are
                                             listed in Table 4.8.

Table 4.8: MOS level 1 model parameters      name            description                                 unit default       note
that describe the instantaneous behavior of  vto                                                                            1
the device                                   kp              pinch-off voltage                           V     0            1
                                             lambda          transconductance factor                     A/V2  2 × 10-5
                                             phi                                                                            1
                                             gamma           channel length modulation coeff. 1/V 0                         1
                                             rd                                                                             1,2
                                             rs              surface potential                           V     0.6          1,2
                                             rsh             bulk threshold parameter
                                             is                                                          V1/2 0.0           1
                                             js
                                             tnom            drain bulk resistance                             0
                                             note 1
                                             note 2          source bulk resistance                            0

                                                             drain and source sheet resistance           /     10-14
                                                             bulk junction saturation current                  0
                                                             bulk junction sat. current density          A     27
                                                             nominal temperature                         A/m2
                                                                                                         oC

                                                             overrides results from process and geometry input

                                                             either resistance, or resistance per unit of channel width

                                             Model parameters dynamic behavior and noise

                                             Additional parameters that are required for the description of a MOSFET's
                                             dynamic behavior are listed in Table 4.9.
                                                                                  4.4. MOS TRANSISTORS 131

Process parameters

The process parameters are used to calculate the instantaneous model pa-
rameter values. For the relations between the process parameters and the
instantaneous model parameters we refer to the literature. These parameters
are listed in Table 4.10.

name  description                                               unit              default
cgso  gate-source overlap capacitance per meter channel width   F/m               0
cgdo  gate-drain overlap capacitance per meter channel width    F/m               0
cgbo  gate-bulk overlap capacitance per meter channel length    F/m               0
cbd   zero-bias bulk-drain capacitance                          F                 0
cbs   zero-bias bulk-source capacitance                         F                 0
cj    zero-bias bulk bottom capacitance per area                F/m2              0
pb    built-in gate junction potential                          V                 0.8
mj    bulk junction bottom grading coefficient
mjsw  bulk junction sidewall grading coefficient                V                 0.5
cjsw  zero-bias bulk-junction sidewall capacitance              -                 1
fc    forward bias depletion capacitance coefficient            -                 0
af    flicker noise exponent
kf    flicker-noise coefficient                                                     Table 4.9: Parameters for modeling the
                                                                                    dynamic behavior

Cut-off frequency

The cut-off frequency fT of a MOSFET is defined as the unity-gain frequency
of the current gain factor:

                                         fT = gm ,              (4.115)
                                                  2Ciss

where Ciss is the total input capacitance with shorted output:

                   Ciss = Cgs + Cdg                             (4.116)

name  description                                   unit        default           Table 4.10: MOS process parameters
tox   gate oxide thickness                          m           10-7
nsub  substrate doping                              1/cm3       0
nss   surface state density                         1/cm2       0
tpg   type of gate material:                        -           1
      +1: poly silicon, type opposite to substrate
ld    -1: poly silicon, type same as substrate      m           0
uo                                                  cm2/Vs      600
utra   0: Al gate                                   -           0
      lateral diffusion
      surface mobility
      transverse field coefficient

Operating point information

Similar as with the BJT and the JFET, the current drive capability and the
voltage drive capability of a MOS transistor depend on the DC drain current
ID and the drain-source voltage VDS. Many other performance aspects, such
as the noise performance and the cut-off frequency, also show a direct rela-
tion with the drain current. As a consequence, we usually want to fix the
operating point by means of fixing ID and VDS.

   A method for fixing the operating point of nonlinear resistive multi-terminal
devices has been discussed in Chapter 3. According to the presented method,
132 ACTIVE DEVICES

      +                               fixing the operating point of a MOSFET by means of ID and VDS requires the-
                                      addition a voltage source VDS between the drain and the output and a current
                                      source ID that flows from the source to the drain.

                                          In order to obtain zero output voltage and zero output current for all DC
                                      input and output terminations, a voltage source VGS has to be placed in se-
                                      ries with the gate and a current source IG has to be connected in parallel
                                      with the gate-source junction. The values of these input sources depend on
                                      the required values of ID and VDS, on the DC characteristics of the device and
                                      on the operating temperature. They can be determined with the aid of the
                                      circuit from Figure 4.33. The nullator at the output port (drain-source) sets
                                      the condition for zero output voltage and zero output current, while the no-
                                      rator at the input port delivers the correct driving quantities to satisfy these
                                      conditions. Although the nullor is not available in spice, it can be imple-
                                      mented with the aid of two unity-gain voltage-controlled voltage sources as
      + illustrated in this figure.

      -

Figure 4.33: Simulation test bench for     4.4.5 Simplified models for hand calculations
determination of the operating point
information.                               Complete spice models are suitable for numerical simulations but they are
                                           too complex to provide design information from analytical expressions. For
g                                       d  this purpose we need simplified models that are suited for hand calculations.
                                           In this section we will derive such models. We will introduce a large signal
   +                   +                   static model, a small-signal dynamic model and a noise model that can be
                                           used for analytical determination of the operating point, the dynamic small-
s-                     -s                  signal transfer and the noise behavior of a MOSFET. We will deal with the
                                           active forward region only.
Figure 4.34: Simplified DC MOSFET model
for hand calculations.                     DC behavior

                                           A DC model, suitable for hand calculations is depicted in Figure 4.34. The
                                           diodes, the capacitances and the bulk resistances have been omitted and only
                                           the nonlinear voltage-controlled current source remains. The current of this
                                           controlled source depends on both the gate-source and the drain-source volt-
                                           age. The bulk is connected to the source, hence the threshold voltage Vto is
                                           not affected by Vbs. Different relations exist for the cut-off region, the linear
                                           region and the saturation region.

                                           1. Normal mode (Vds > 0), cut-off region: Vgs-vto< 0, we have  (4.117)
                                                                                         Ids = 0.

                                           2. Normal mode (Vds > 0), linear region: Vds < Vgs - vto, or, alternatively:
                                              Vdg < -vto

                                           Ids = w kpVds Vgs - vto (1 + lambda.Vds) .                     (4.118)
                                                   l

                                           3. Normal mode (Vds > 0), saturation region: 0  Vgs - vto  Vds, or,
                                              alternatively: Vdg > -vto

                                           Ids = w kp l 2 Vgs - vto 2 (1 + lambda.Vds) .                  (4.119)

                                           4. Reverse mode (Vds < 0)
                                              For reverse operation, the drain and the source connections are swapped.
                                                                                                                   4.4. MOS TRANSISTORS 133

Small-signal dynamic behavior                                                                                 g                                    d

The simplified small-signal dynamic model for a source-bulk connected MOS-                                            +
FET is shown in Figure 4.35.
                                                                                                              s       -                            s
   The model parameters can roughly be determined from the Level 1 device
model, the geometry parameters and the operating voltages and currents.                                    Figure 4.35: Simplified small-signal equiv-
These approximations are shown in Table 4.11.                                                              alent circuit for a MOSFET of which the
                                                                                                           source has been connected to the bulk.

par. cut-off.                           linear region                        saturation region

Cgs cgso.w+cgbo.l+                      cgso.w+cgbo.l+                       cgso.w+cgbo.l+

+ w.l tox ox (max. value)               +1    tox w.l ox   (max.  value)     +2    tox w.l ox  (max.       value)

                                           2                                    3

Cgd cgdo.w                              cgdo.w+                              cgdo.w

                                        +1    tox w.l ox   (max.  value)

                                           2

Cds cj.ad+cjsw.pd or cbd cj.ad+cjsw.pd or cbd cj.ad+cjsw.pd or cbd

gm 0                                    w  .  k  p  VD  S                    w  .kp(VDS        -     vto)  =
                                        l                                    l

                                                                             =     2  w  .  k  p  I  D  S
                                                                                      l

rds                                     lw .kp (VGS - vto) -1 1/(lambda IDS)

                                        voltage controlled resistor (lambda  1)

                                        approximation (VDS = 0)

Noise model                                                                                                Table 4.11: MOSFET small-signal model
                                                                                                           parameters obtained from operating point
                                                                                                           and device model parameters

The simplified noise model is shown in Figure 4.36. The bulk resistances

Rs and Rd are omitted and the remaining noise sources are added to the
simplified hybrid- equivalent circuit from Figure 4.35.

             g                                                            d                                Figure 4.36: Simplified small-signal equiv-
                                     +
                                                                                                           alent circuit with noise sources of a bulk-

                                                                                                           source connected MOSFET.

             s             -                                              s

Determination of the hybrid- parameters by a simulation

If the small-signal parameters of a MOSFET are not provided by the simu-
lator's operating point analysis, they can be determined with the aid of a
small-signal analysis. The procedure is similar to that of bipolar transistors
as discussed in section 4.2.6. Figure 4.37 shows the simulation setup.

   The procedure is as follows:

1. Bias the device in the required operating point with VGS and VDS +                                                                +

2. Add an AC signal (AC 1 0) to VAC1 only -                                                                                          -

3. Perform an AC analysis over the frequency range of interest                                                     +     +           +

4. Obtain the following small-signal parameters                                                                    -     -           -

                               gm = Re {I(VAC2)} ,                                          (4.120)        Figure 4.37: Simulation test bench for
                              Cgg = Ciss = - Im {I(VAC1)} ,                                 (4.121)        determination of the small-signal MOS
                                                                                                           parameters.
                                                          2 f
                              Cgb = Im {I(VAC3)} .                                          (4.122)

                                               2 f

1. Now add the AC signal (AC 1 0) to VAC3 only
134 ACTIVE DEVICES

                                                   2. Perform an AC analysis over the frequency range of interest    (4.123)
                                                                                                                     (4.124)
                                                   3. Obtain the following small-signal parameters                   (4.125)

                                                                                       gmb = Re {I(VAC2)} ,
                                                                                       Cbs = - Im {I(VAC1)} ,

                                                                                                           2 f
                                                                                       Cbd = - Im {I(VAC2)} .

                                                                                                           2 f

                                                   4. Now add the AC signal (AC 1 0) to VAC2 only                    (4.126)
                                                   5. Perform an AC analysis over the frequency range of interest    (4.127)

                                                   6. Finally obtain the following small-signal parameters
                                                                                     go = 1r = - Re {I(V ds AC2)} ,

                                                                                   Cdg = - Im {I(VAC1)} .
                                                                                                      2 f

                                                      In the following example, we will demonstrate the determination of the
                                                   small-signal parameters of a biased NMOS that has its source connected to
                                                   the bulk, by means of a spice simulation.

                                                      Example 4.1

                                                          Figure 4.38 shows the simulation test bench for the determination of the small-
                                                      signal parameters of an NMOS transistor.

Circuit for determination of Vgs

      E1                          V1            +  -  (o1)      .param L=180n W=220n Ids=10u Vds=0.9
            (Vgs) (d1)              +                       I1
++
--        M1

Circuit for determination of Y11 and Y12                        Circuit for determination of Y21 and Y22

(Vgs) (i2) -                        (g2)               (d2)     (Vgs) (g3)                   (d3)
                                                           V2                                    V4
+ E2 +                                                +         + E3 +                      +

                        V3

--                                                    -         --                          -

                                    M2                                                  M3

Figure 4.38: Simulation test bench for                    The netlist, including the LTspice .measure statements for the determination
determination of the small-signal Y param-             of gm, go, ciss, coss, and cdg, has been listed below:
eters of an NMOS transistor.
                                                    1 YparHyPiPar.cir
                                                    2 *LTspice netlist
                                                    3
                                                    4 *Circuit for determination of Vgs
                                                    5 M1 d1 Vgs 0 0 C18nmos L={L} W={W}
                                                    6 V1 d1 o1 {Vds}
                                                    7 I1 0 o1 {Ids}
                                                    8 E1 Vgs 0 o1 0 1k
                                                    9
                                                   10 *Circuit for determination of Y11 and Y12
                                                                                     4.4. MOS TRANSISTORS 135

11 M2 d2 g2 0 0 C18nmos L={L} W={W}

12 V2 d2 0 {Vds}

13 V3 g2 i2 AC 1 0

14 E2 i2 0 Vgs 0 1

15

16 *Circuit for determination of Y21 and Y22
17 M3 d3 g3 0 0 C18nmos L={L} W={W}

18 V4 d3 0 {Vds} AC 1 0

19 E3 g3 0 Vgs 0 1

20

21 .lib CMOS18TT.lib

22

23 .AC LIN 3 9.5Meg 10.5Meg

24

25 * Device parameters
26 .param W=220n L=180n

27

28 * Operating point
29 .param Vds=0.9 Ids=10u

30

31 * LTspice specific instructions for printing the small-signal parameters (at f

                =10MHz) in dB:

32 .meas AC g_m FIND Re(-I(V2)) AT 10MEG
33 .meas AC g_o FIND Re(-I(V4)) AT 10MEG
34 .meas AC c_iss FIND Im(-I(V3))/(2*pi*10meg) AT 10MEG
35 .meas AC c_oss FIND Im(-I(V4))/(2*pi*10meg) AT 10MEG
36 .meas AC c_dg FIND Im(I(E3))/(2*pi*10meg) AT 10MEG

   The simulation results are printed in dB the LTspice output file (error log).
The results are listed in the table below:

parameter  dB value  value                                units
           -80.9417  89.725                               µAV-1
gm         -109.767  3.2483                               µAV-1
go         -305.649  521.86
ciss       -316.932  142.36                               aF
coss       -317.011  141.07
cdg                                                       aF

                                                          aF

   From these values we find                                     (4.128)
                                                                 (4.129)
                            cgs = ciss - cdg = 380.79aF,

and
                              cds = coss - cdg = 1.29aF.

4.4.6 Capacitance models                                                             36 Daniel P. Foty. MOSFET modeling with
                                                                                     SPICE: principles and practice. Prentice-Hall,
One of the challenges of the modeling of the behavior of semiconductor de-           Inc., USA, 1997. ISBN: 0-13-227935-5
vices is to translate the dynamic spacial charge distribution in the physical
device, into a lumped element network model in which charge is concen-
trated on capacitances, while the dynamic currents in the device terminals
depend on the changes of these charges. By using these techniques, effects of
a limited carrier velocity cannot be accounted for accurately.

   For an in depth treatment of this subject, the reader is referred to literature.
Foty (see [Foty1997]36) addresses two topics related with the modeling with
lumped elements: charge conservation and the reciprocity of the capacitive
elements. In this section we will simply introduce two capacitance models
for the intrinsic MOS transistor without discussion of the underlying physical
mechanisms.

Meyer model                                                                          37 J. Meyer. MOS models and circuit
                                                                                     simulation. RCA Review, 32:42-63, 1971
The model proposed by Meyer is commonly applied in the first generation
MOS models (see [Meyer1971]37). The model assumes reciprocal capacitances
136 ACTIVE DEVICES                         cdg = cgd . The model equations of the capacitances cgs , cgd and cgb differ

38 D. Ward and R. Dutton. A Charge-       for the linear region, the saturation region and the cut-off region.
Oriented Model for MOS Transistor            The general implementation of the Meyer capacitance model is as follows:
Capacitances. IEEE Solid-state Circuits,     In the linear region we have
sc-13(5):703-708, October 1978
                                                                                                 2                (4.130)
                                          cgs = 23 w.lCox 1 -                                       2  + cgso.w,
                                                                            Vgd - Vt                              (4.131)
                                                                     Vgs - Vt + Vgd - Vt                          (4.132)
                                          cgd = 23 w.lCox 1 -                                       2  + cgdo.w,
                                                                                                2
                                          cgb = 0.
                                                                            Vgs - Vt
                                                                     Vgs - Vt + Vgd - Vt

                                          In the saturation region the model equations are:

                                              cgs = 23 w.lCox + cgso.w,                                           (4.133)
                                              cgd = cgdo.w,                                                       (4.134)
                                                                                                                  (4.135)
                                              cgb = 0.

                                          In the cut-off region we have:

                                          cgs = cgso.w,                                                           (4.136)
                                          cgd = cgdo.w,                                                           (4.137)
                                          cgb = w.lCox + cgbo.l (maximum value at VGB = 0).                       (4.138)

                                          Ward-Dutton capacitance model

                                          The Ward-Dutton capacitance model (see [Ward1998]38), uses a capacitance
                                          matrix that relates the four dynamic terminal currents of the intrinsic transis-
                                          tor to the nodal voltages at the corresponding terminals. The capacitances are
                                          calculated from the charge equations of the MOSFET model. The resulting
                                          capacitance matrix is not necessarily reciprocal.

                                             The matrix equation is

                                                                     -CGD  -CGS  -CGB                
                                          ig  CGG                          -CDS                     vg
                                                                      CDD
                                           is   id  = s  -CSG  -CDG  -CSD   CSS  -CSB   vs  -CDB   vd  ,          (4.139)
                                                                     -CBD  -CBS
                                          ib  -CBG                               CBB                vb

                                             where ig, id, is and ib are the terminal currents of the intrinsic transistor,
                                          and vg, vd, vs and vb the nodal voltages at the corresponding terminals.

                                             If the source and the bulk are connected together, and the source-bulk

                                          connection is taken as the reference node, this model simplifies to

                                              igid = s CGG -CGD -CDG CDD                            vgs vds .     (4.140)

                                             The resulting model can be written in a form of which the equivalent
                                          hybrid- network can be constructed:

                                          igid = s CGG -CGD (CGD - CDG) - CGD CDD                   vgs vds .     (4.141)

                                          The simplified hybrid- equivalent circuit of the intrinsic transistor is
                                                                                             4.4. MOS TRANSISTORS 137

found after addition of the static transadmittance gm and the static output
resistance ro. This circuit is shown in Figure 4.39.

       g                                                                        d            Figure 4.39: Hybrid- equivalent circuit
                                                                                             of the intrinsic MOSFET according to the
                          +                                                                  Ward-Dutton capacitance model.

       s,b                -                                                     s,b

4.4.7 MOS EKV Model                                                                          39 Christian C. Enz, and Eric A. Vittoz.
                                                                                             Charge-based MOS Transistor Modeling. John
In this section, we will give a brief summary of the construction and the use                Wiley & Sons Inc., 2006. ISBN: 978-0-470-
of the EKV MOS model. The model is developed by Enz and Vittoz: [En-                         85541-6
zVittoz2006]39. The application of the model and especially the use of the                   40 Binkley, David M. Tradeoffs and Optimiza-
inversion coefficient as basis for early stage design decisions, is extensively de-          tion in Analog CMOS Design. John Wiley &
scribed by Binkley (see [Binkley2008]40). Expressions in this section involving              Sons Inc., 1997. ISBN: 978-0-470-03136-0
the inversion coefficient have been taken from Binkley, but adapted in such
a way that they can be used for estimation of the small-signal parameters of                     G
the hybrid- equivalent model for all modes of operation.
                                                                                             S  D
   Figure 4.40 illustrates the basic idea behind the static model of the intrinsic
MOS: the drain-source current is the sum of a forward and a reverse com-                     B  B
ponent. Both components IF and IR have smooth expressions with a validity
range that covers weak inversion through strong inversion, including velocity                Figure 4.40: Basic static EKV model of the
saturation. The bulk node has been taken as reference node.                                  intrinsic MOS transistor.

   The expressions for IR equal those for IF after swapping VD and VS. This
makes the model symmetrical for the forward and reverse operation. The
current equations are based upon the charge equations of the model.

   In this section, we will briefly discuss the modeling of the IDS (VGS, VDS)
characteristic for the different operating regions, introduce the inversion co-
efficient and relate the parameters of the small-signal model to the operating
point, the technology parameters and the device geometry.

The technology current

Binkley (see [Binkley2008]41) defines the technology current I0 as                           41 Binkley, David M. Tradeoffs and Optimiza-
                                                                                             tion in Analog CMOS Design. John Wiley &
                                 I0 2nµ0CO XUT2 [A],                            (4.142)      Sons Inc., 1997. ISBN: 978-0-470-03136-0

where n is the substrate factor:

                                 n = 1+  C   DEP [-],                           (4.143)

                                             
                                         COX

C      is   the  surface  depletion   capacitance  and    C     is  the  oxide  capacitance

  DEP                                                       OX
per unit of area:
                                        or
                                 COX =             -2
                                                  [Fm ],                        (4.144)
                                        tox

where r is the relative permittivity of SiO2, tox is the thickness of the gate

oxide and UT is the thermal voltage.                      (1)

The    reciprocal  value     of  the   substrate  factor   n    models   the  coupling  be-

tween the gate voltage and the surface potential at weak inversion.

The transconductance factor                                                     (4.145)
The transconductance factor sq is defined as

                                    sq = µ0CO X [AV-2],
138 ACTIVE DEVICES

                                    where µ0 is the low-field channel carrier mobility in [m2V-1s-1]. The technol-
                                    ogy current can be expresses in sq as

                                                                  I0 = 2nsqUT2 [A].           (4.146)

                                    Weak inversion

42 Read this expression as folows:  In weak inversion the drain-source current IF,R shows an exponential relation
                                    with the gate voltage:42
                   n VG -VT0 -VS
IF  =  I0  W  exp        UT                                        W n VG-VT0 - VS,D
           L                                            IF,R = I0 L exp UT [A].

IR  =  I0  W  exp  n VG -VT0 -VD                                                              (4.147)
           L             UT

                                       The voltage VT0 is the equilibrium threshold voltage. For VS = 0 it corre-
                                    sponds with the threshold voltage Vto of the models discussed above.

                                    Strong inversion

                                    When the device is operating in strong inversion, the drain-source current
                                    depends quadratically on the drive voltage:

                                                        IF,R = W sq (VG - VT0 - nVS,D)2 [A],  (4.148)
                                                                  L 2n

                                    where W and L are the effective width and length of the channel, respectively.

                                    Weak inversion to strong inversion

                                    With the aid of a transition function F(x), the expressions for weak inversion
                                    and strong inversion can be combined into one:

                                                        F (x) =   ln 1 + exp x        2       (4.149)
                                                               =                   2          (4.150)
                                                                                        [-],

                                                                  exp(x) if x  0,

                                                                  x2    if x  0.
                                                                  2

                                       This function returns the forward and the reverse inversion coefficient, ICF
                                    and ICR, respectively:

                                                        ICF,R = F VG - VT0 - nVS,D [-].       (4.151)
                                                                                 nUT

                                       These coefficients are a measure for the level of inversion at which the tran-
                                    sistor operates. An inversion coefficient much smaller than unity indicates
                                    weak inversion. An inversion coefficient much larger than unity indicates
                                    operation in strong inversion. Between weak and strong inversion we speak
                                    of moderate inversion. The actual forward and reverse current can be calcu-
                                    lated from the technology current, the device geometry and their respective
                                    inversion coefficients as:

                                                        IF,R = I0 W ICF,R [A],                (4.152)
                                                                    L

                                    or, alternatively:

                                                                          2W                  (4.153)
                                                        IF,R = 2nsqUT ICF,R [A].

                                                                             L
                                                                                           4.4. MOS TRANSISTORS 139

Total drain-source current

The total drain-source current IDS is the difference between the forward and
the reverse current (see Figure 4.40):

                                       IDS = IF - IR [A].                     (4.154)

   When the transistor is operating in the saturation region, one of the current
components IR or IF can be ignored with respect to the other.

Vertical field mobility reduction

The reduction of the mobility caused by the vertical field in the channel is

modeled as reduction of the transconductance factor sq due to the gate-
source voltage. A simple mobility reduction model uses the vertical field
mobility reduction factor  [V-1]

                                    =  sq VG-VT0 [AV-2].                      (4.155)
                                       1+ n
                                sq

With  this  expression              increases  below  threshold  and  has  a  singularity

                                sq

at  VG-V n T0 = -1.  This can be corrected by softly clipping the VFMR effect
below threshold:
                                       sq  [AV-2].
                                    =  1 + 2UT ICF                            (4.156)

                                sq

Channel length modulation and velocity saturation

Channel length modulation and velocity saturation occur if the device is op-               43 Matthias Bucher, Christoff Lallement,
erating in the saturation region. In the spice EKV 2.6 model, the channel                  Christian Enz, Fabien Théodoloz and
length modulation (CLM) and velocity saturation (VS) have been modeled                     François Krummenacher. The EPFL-EKV
through modification of the reverse current IR. For a full spice implemen-                 MOSFET Model Equations for Simulation.
tation of the EKV2.6 model the reader is referred to the EKV2.6 manual (see                Technical report, Electronics Laboratory,
[spiceEKV2.6]43). Both the velocity saturation and the channel length modu-                Swiss Federal Institute of Technology
lation can be modeled in a relatively simple way by ignoring their absence in              (EPFL), Lausanne, Switzerland, July 1998
the linear operating region. This will provide sufficiently accurate values for
taking early stage design decisions.                                                       44 Binkley, David M. Tradeoffs and Optimiza-
                                                                                           tion in Analog CMOS Design. John Wiley &
   Similar as with bipolar transistors, the channel length modulation can be               Sons Inc., 1997. ISBN: 978-0-470-03136-0
modeled with an Early voltage. The Early voltage VA is assumed propor-
tional with the length of the device

                                       VA = VAL L [-],                        (4.157)

where VAL [Vm-1] is the Early voltage per unit of length. After including the
CLM in the expression of the drain-source current, IDS changes to

      IDS = IF 1 + VD - VS - IR 1 + VS - VD [A].                              (4.158)
                              VAL L                     VAL L

   Binkley (see [Binkley2008]44) describes the modeling of velocity saturation
in the forward saturation operating region through introduction of a second
term in sq (4.156):

                           =  1+                sq         [AV-2],            (4.159)
                                        + ECRIT 1 L  2UT ICF
                       sq

where ECRIT [Vm-1] is the value of the lateral field at which velocity satura-
tion occurs.

   At a later stage we will use the critical inversion coefficient ICCRIT, which
is defined as the inversion coefficient at which the reduction of the mobility
140 ACTIVE DEVICES

                                              due to VFMR and velocity saturation sets in:

                                              ICCRIT ICF,R| + L ECRIT 1 n VG-VT0 -VS,D =1 [-].                    (4.160)
                                                                                                                  (4.161)
                                              It can be approximated by

                                                       ICCRIT                       1              2 [-].
                                                                                   + 1
                                                                             4nUT
                                                                                          L EC

                                              Static device characteristics

                                              Figure 4.41 shows the model with the source taken as reference node: VS = 0
                                              and VB = 0.

Figure 4.41: EKV model with the Source           G                                                            D
and Bulk connected togeter and taken as             +                                                      +
reference node.
                                              S,B -                                                        - S,B

                                                 With the aid of this model we can find the IDS (VGS, VDS) characteristic for
                                              the linear and saturation region at strong inversion and compare them with

                                              those of provided by the Level 1 model.

                                                 In the saturation region, IR can be ignored. If we discard the velocity
                                              saturation and the channel length modulation we can simplify (4.158) to the

                                              well known quadratic relation:

                                                       IDS = W sq (VG - VT0 - nVS)2 [A].                          (4.162)
                                                                L 2n

                                                 With VS = 0, this equation simplifies to the one the Level 1 model uses for
                                              the saturation region:

                                                       IDS = W sq (VGS - VT0)2 [A].                               (4.163)
                                                                L 2n

                                                 In the linear region, we cannot ignore the reverse current component and,
                                              under the above conditions, we may write

                                              IDS = W sq (VG - VT0 - nVS)2 - (VG - VT0 - nVD)2 [A].               (4.164)
                                                       L 2n

                                                 If VS = 0, this simplifies to the equation the Level 1 model uses for the
                                              linear region:

                                                       IDS = W sq VD VGS - VT0 - 1 VDS [A].                       (4.165)
                                                       Ln                                       2

45 Binkley, David M. Tradeoffs and Optimiza-     Figure 4.42 shows the static device characteristics of an NMOS transistor
tion in Analog CMOS Design. John Wiley &      myNMOS (W = 220nm, L = 180nm) calculated according to the above (sim-
Sons Inc., 1997. ISBN: 978-0-470-03136-0
                                              plified) model with parameters of a standard CMOS18 process as listed by
                                              Binkley (see [Binkley2008]45). The technology current for this device is 634nA
                                              and the critical inversion coefficient ICCRIT equals about 41. Hence, velocity
                                              saturation starts to play a role at about 32µA. It should be noted that with this

                                              simple model of the channel length modulation and the velocity saturation,

                                              the characteristics are not accurate for short devices operating in the linear

                                              region.
                                                                                                      4.4. MOS TRANSISTORS 141

Linear and saturation region                                                                          Figure 4.42: Device characteristics myN-
                                                                                                      MOS, CMOS18 process.
The transition from the linear to the saturation region occurs at VDS,sat:
                                                                                                          Left:
                                                                                                          Transfer characteristics IDS (VGS, VDS)
                                                                                                          Right:
                                                                                                          Output characteristics IDS (VDS, VGS)

                    VDS,sat = 2UT ICF + 0.25 + 3UT [V].                         (4.166)

   For reverse operation VDS,sat and ICF should be replaced with VSD,sat and
ICR, respectively.

Small signal parameters

Figure 4.43 shows the small-signal model for the case that the source is taken
as the reference node. Since the transconductance is defined at shorted out-
put, we have vgs = -vds.

              G     +                                              -         D                        Figure 4.43: Static small-signal model of the
                                                                                                      intrinsic MOS transistor with the source
                 +                                                        +                           taken as reference node according to the
                       -                                                                              EKV model.
              - S - S

                 +
              B

   The forward small-signal transconductance gm can be written as a function
of the forward current and its associated inversion coefficient

gmF =                                          VS -VD                             [AV-1]. (4.167)
         nUT                                                                 +1
                             IF 1 + VAL L
              ICF 1 + ICICF CRIT + 0.5 ICF 1 + ICICF CRIT

The reverse transconductance gmR can similarly be written as:

gmR =                                          VD -VS                                [AV-1]. (4.168)
         nUT                                                                    +1
                             IR 1 + VAL L
              ICR 1 + ICICR CRIT + 0.5 ICR 1 + ICICR CRIT

The total transconductance is found as the difference between the two:

                       gm = gmF - gmR [AV-1].                                   (4.169)
142 ACTIVE DEVICES

                                                Figure 4.44 shows the transconductance as a function of the drain current
                                             of myNMOS.

Figure 4.44: Device characteristics myN-        In the forward operating range, the finite small-signal output conductance
MOS, CMOS18 process.                         gds is caused by the channel length modulation and by gmR :

    Left: gm calculated from IDS and the                           gds = goF + gmR [AV-1].         (4.170)
inversion coefficient according to (4.169).
                                                In the saturation region, gmR approximates zero and the output conduc-
    Right: gds calculated from IDS and the
inversion coefficient according to (4.172).  tance is determined by the channel length modulation only. This part of the
                                             output conductance modeled in go:46
46 The effect of the drain induced barrier
lowering has not been modeled.                                     goF = IDS V [AV-1]. DS + VAL L

                                                                                                   (4.171)

                                                  In the linear region gds equals gmR, however, expression (4.168) includes

                                             the effect of velocity saturation, which yields a too small value for the output

                                             conductance. A better estimate for gds in the forward linear operating range

                                             is:

                                                                   gds = goF + gmR 14  1 + ICR.    (4.172)
                                                                                       4

                                                Figure 4.44 also shows the output conductance of myNMOS as a function
                                             of the drain current.

                                                The body effect simply follows from gm and n as

                                                                   gmb = (n - 1) gm [AV-1]         (4.173)

                                             Transconductance efficiency

47 About 25.                                 The transconductance efficiency is defined as the ratio of the transconduc-

                                             tance and the drain current. It is a measure for the transconductance pro-

                                             duced per unit of drain current. The transconductance is used as a measure

                                             for the level of inversion. In weak inversion and in the saturation region, the
                                             transconductance efficiency has its largest value: 47

                                                                          gm = 1 [V-1].            (4.174)
                                                                          IDS nUT

                                                  In strong inversion (without short channel effects) and in the saturation

                                             region, it drops to:

                                                                          gm = 2 [V-1],            (4.175)
                                                                          IDS Ve f f
                                                                                                   4.4. MOS TRANSISTORS 143

where Ve f f = VGS - VT0.
   The transconductance efficiency of a MOS operating at an arbitrary inver-

sion level in the forward saturation region, can be obtained from the inversion

coefficient as:

gm =                                      1                                  [V-1].       (4.176)
IDS                                     + 0.5                           +1
              ICF 1 + ICCRIT ICF                    ICF 1 + ICCRIT ICF
         nUT

Intrinsic capacitances                                                                             48 Matthias Bucher, Christoff Lallement,
                                                                                                   Christian Enz, Fabien Théodoloz and
The EKV2.6 manual gives expressions for the intrinsic small-signal capaci-                         François Krummenacher. The EPFL-EKV
                                                                                                   MOSFET Model Equations for Simulation.
tances (see [spiceEKV2.6]48). The small-signal dynamic model with these ca-                        Technical report, Electronics Laboratory,
                                                                                                   Swiss Federal Institute of Technology
pacitances is shown in Figure 4.45. A complete small-signal model requires                         (EPFL), Lausanne, Switzerland, July 1998

addition of the extrinsic capacitances and the series resistances in the drain,                    Figure 4.45: Dynamic small-signal model of
                                                                                                   the intrinsic MOS transistor with the source
the source and the gate.                                                                           taken as reference node according to the
                                                                                                   EKV model.
The intrinsic capacitances can be expressed as a part of the total oxide

capacitance COX:              COX = W LCO X [F]

                                                                                          (4.177)

                           +                                                  -
                                                                                    +
G                                                                                      D
                              -
                        +

- S - S

   +B
B

   The spice EKV2.6 model uses two parameters for calculation of these rel-
ative parts:

                                 xf =        1 + ICF [-],                                 (4.178)
                                  xr =       4                                            (4.179)
The intrinsic capacitances are               1 + ICR [-].
                                             4                                            (4.180)
                                                                                          (4.181)
                                                                                          (4.182)

                           2            x2   +  xr  +  21 x f
                  cgsi = 1 -                           2  COX [F],
                                          r

                           3 xr + x f

                                                               

                           2            x2   +  xf  +  1 xr
                  cgdi = 1 -
                                          f            2
                                                       2  COX [F],

                           3 xr + x f

                  cgbi = n - 1 COX - cgsi - cgdi [F],
                             n

                           csbi = (n - 1) cgsi [F],                                       (4.183)

                           csdi = (n - 1) cgdi [F].                                       (4.184)

   In the linear region, cgbi drops to zero because it is completely covered by                    49 At very low values of VGS, the intrinsic
the conductive channel. The value of cgbi below accumulation is not mod-                           gate bulk capacitance equals COX.
eled.49

   The total input capacitance with shorted output ciss is the sum of the three
144 ACTIVE DEVICES

                                              capacitances. The cut-off frequency fTi of the intrinsic transistor is defined
                                              as: f g Ti = m [Hz]. (4.185)

                                                                                             2ciss

Figure 4.46: Device characteristics myN-         Figure 4.46 shows the plots of cgsi and cgdi against IDS, with VDS as param-
                                              eter. The plots
MOS, CMOS18 process.
    Left: cgsi plotted against VGS with VDS      show that cgsi rapidly increases from zero to 32 COX, but it drops to 12 COX,
                                              while cgdi increases from zero to 21 COX when the device starts operating in
as parameter.                                 the linear region.
    Right: cgdi plotted against VGS with VDS

as parameter.

Figure 4.47: Device characteristics myN-         Figure 4.47 shows the intrinsic source-bulk and drain-bulk capacitances,

MOS, CMOS18 process.                          csbi and cdbi, respectively. These are parts of the junction capacitances under
                                              the channel, assigned to the source and the drain terminal.
    Left: csbi plotted against VGS with VDS
as parameter.                                    Figure 4.48 shows the plots of cgbi and fTi against IDS with VDS as param-
                                              eter.
    Right: csbi plotted against VGS with VDS
as parameter.

                                              Extrinsic capacitances

                                              The extrinsic capacitances have to be added to this intrinsic model. They
                                              consists of the overlap capacitances, the source-bulk junction capacitance and
                                              the drain-bulk capacitances. As a first approximation they can be modeled
                                              as in the Level 1 model.
                                                                                                                    4.4. MOS TRANSISTORS 145

Intrinsic noise model                                                                                               Figure 4.48: Device characteristics myN-
                                                                                                                    MOS, CMOS18 process.
Figure 4.49 shows the small-signal model of the intrinsic MOS transistor with
                                                                                                                        Left: cgbi plotted against VGS with VDS
added noise sources ig and id.                                                                                      as parameter.
   The spectral density Sig of ig equals
                                                                                                                        Right: The cut-off frequency of the
                                                                                                                    intrinsic transistor fti plotted against the
                                                                                                                    drain current with VDS as parameter.

                                         Sig = 2qIG [A2Hz-1],                            (4.186)

where IG is the DC gate (leakage) current. Flicker noise, associated with this
                                                                1
noise  source,  can   be     modeled     with  the  aid  of  a  f  corner  frequency  fg:

                             Sig = 2qIG        1 + fg        [A2Hz-1].                   (4.187)
                                                      f

                                      +                                                                             Figure 4.49: Dynamic small-signal noise

                                                                                                     -              model of the intrinsic MOS with the source
                                                                                                              +
G                                                                                                                D  taken as reference node according to the
                                   +     -
                                                                                                                    EKV model.
S - -
                                                                                                                 S

+ B B

The spectral density of id differs for the linear and the saturation region.

In the linear region (VDS < VDS,sat) the spectral density Sid is that of a resistor
                   1
with   resistance
                   go :
                                      Sid,lin = 4kTgo [A2Hz-1],
                                                                                         (4.188)

where go can be written according to (4.172).                                                                       50 Assuming no VFMR and velocity satura-
                                                                                                                    tion.
The spectral density Sid of the current noise associated with the drain cur-
                                                                                                                    51 These are idealized values for . In prac-
rent can be written as                                                                                              tice much larger values may be observed.

                                         Sid = 4kTngm,                                   (4.189)                    52 Binkley, David M. Tradeoffs and Optimiza-
                                                                                                                    tion in Analog CMOS Design. John Wiley &
where    equals    1     in  weak     inversion  and     2  in  strong  inversion50,51.  Binkley                    Sons Inc., 1997. ISBN: 978-0-470-03136-0
                   2                                     3
(see [Binkley2008]52) describes several expressions that model a smooth tran-

sition from weak inversion to strong inversion. The simplest function for 

including VFMR and VS is:

                                               1 + 2 IC                                  (4.190)
                                          = 2 3 1 + IC [-].
146 ACTIVE DEVICES

                                              Due      to  fluctuations  in  the  carrier  mobility,  a  flicker  noise  or  1  noise   com-
                                                                                                                             f

                                              ponent is associated with the channel current. The spectral density of this

                                              noise current is               S kfg id f = m2 [A2Hz-1],
                                                                                      COX f
                                                                                                                                        (4.191)

                                              where kf [J] is the flicker noise coefficient. The corner frequency f is defined

                                              as the frequency at which Sid f = Sid. With the aid of this corner frequency, the
                                              spectral density Sid,tot of the total noise current associated with the channel
                                              current can be written as:

                                                                   Sid,tot = 4KTngm 1 + ff [A2Hz-1],                                    (4.192)

                                              The corner frequency f is obtained as:

                                                                             f = kfgm [Hz].                                             (4.193)
                                                                                   4kTnCOX

                                                 If the transistor operates in the saturation region, the cut-off frequency T
                                              equals the ratio of gm and 32 COX. We then may write:

                                                                             f = kf  3kTn fT [Hz].                                      (4.194)

                                              Hence, for a specific IC process the ratio between the flicker noise corner

                                              frequency f and the cut-off frequency fT is constant. In a 180nm CMOS

                                              process with the transistor operating in the saturation region we have: n 

                                              1.35,    =   2  and  kf  4 × 10-25  J.  With  these  values  we     find  f        fT
                                                           3
                                                                                                                                9000 .

53 Binkley, David M. Tradeoffs and Optimiza-  Summary
tion in Analog CMOS Design. John Wiley &
Sons Inc., 1997. ISBN: 978-0-470-03136-0      Expressions for the parameters of the small-signal static model of the intrinsic
                                              MOS transistor operating in the saturation region have been described by
54 Matthias Bucher, Christoff Lallement,      Binkley (see [Binkley2008]53). Extension of the validity to the linear operating
Christian Enz, Fabien Théodoloz and           range is possible by using the both the forward and the reverse inversion
François Krummenacher. The EPFL-EKV           coefficient. Full-range expressions for the small-signal intrinsic capacitances
MOSFET Model Equations for Simulation.        can be found in the EKV2.6 manual [spiceEKV2.6]54.
Technical report, Electronics Laboratory,
Swiss Federal Institute of Technology            Modeling of the small-signal parameters with the forward and the reverse
(EPFL), Lausanne, Switzerland, July 1998      current requires the use of VGS and VDS as independent variables for the
                                              operating point. The use of the preferred output quantities IDS and VDS
                                              requires an iterative calculation process for resolving IDS in a forward and a
                                              reverse component.

                                              4.5 SLiCAP device models

                                              The design method for amplifiers described in this book separates the design
                                              of the signal path from the design of the biasing. We will first design the
                                              signal path and then the biasing. Reasons for this are:

                                              1. The signal performance with ideal biasing should be within specifications
                                                 and leave extra room for degradation due to biasing errors. If the biasing is
                                                 designed together with the signal path, it is hard to find the cause of pos-
                                                 sible performance limitations. The performance of the signal path might
                                                 then be out of specifications, while the focus may be on improvement of
                                                 the biasing. If so, the designer is improving the biasing of an unfeasible
                                                 amplifier, valuable design time gets lost and possible show stoppers may
                                                 appear during a relatively late design phase.

                                              2. If the signal path of an amplifier shows unstable behavior, a numeric sim-
                                                 ulation may not be able to find the correct quiescent operating point due
                                                                                                   4.5. SLICAP DEVICE MODELS 147

to convergence problems. As a consequence, the noise performance and
the small-signal performance cannot be evaluated. This makes it hard or
even impossible to find the causes for instability and trial and horror meth-
ods may be the only way to obtain stability. Only after stable behavior has
been achieved, it may become clear that the performance is not as desired
and valuable design time has gone lost.

4.5.1 Signal path and biasing

Designing the signal path first does not mean that the designer shouldn't
account for biasing constraints while designing the signal path. Biasing con-
siderations should be taken into account as early as possible. Especially in
low-power applications, the selection of the device type, the operating con-
ditions and the circuit topology are to a large extent driven by the feasibility
of the biasing circuits that will be designed at a later stage. However, inves-
tigation of the adverse effects of the implementation of bias sources can very
well be done without implementing them in the complete circuit.

   One way to achieve this is to design the amplifier's signal path using a
linearized approach. In such an approach the frequency stability of an am-
plifier is investigated in operating points that occur during operation. Biasing
circuitry can be omitted if the parameters of the small-signal models of the
active devices can be related to the operating point. Operating points of in-
terest can be estimated from the excursions and the rates of change of the
signals that occur at the various nodes of the amplifier. By doing so, budgets
for parasitic impedances that will be introduced by bias sources can be de-
termined by inserting those impedances in the small-signal equivalent circuit
and studying their effect independently from biasing changes.

   Spice-like numeric simulators do not support this way of working. Those
simulators can determine the small-signal parameters in an operating point
only after a bias solution has been found. In other words: they need a biased
circuit to work with. SLiCAP however, is designed for this purpose.

4.5.2 SLiCAP parametric small-signal models                                       55 Einstein: "Everything should be made as
                                                                                  simple as it can be, but not simpler."
SLiCAP is a symbolic simulator that can be used at an early stage of the
design for:

· The design of the noise behavior

· The design of the small-signal dynamic behavior

· Deriving budgets for biasing imperfections

   SLiCAP does not need to find a DC solution to determine the small-signal
parameters. It has built-in parameterized sub-circuits with small-signal mod-
els of active devices. Operating conditions and device geometry parameters
can be passed to these sub-circuits, while technology parameters and device
equations relate them to the small-signal parameters.

   In the following sections, we will give a brief description of some device
models that have been included in SLiCAP. These sub-circuit definitions
arebe found in the libraries supplied with SLiCAP.

   SLiCAP is intended to be used to motivate early-stage design decisions
and useful design information can be obtained with low complexity mod-
els.55

4.5.3 BJT forward region, no saturation

The subcircuit BJTV4 is a parameterized small-signal model of a four-terminal
vertical BJT. It can be used for simulation of the small-signal behavior under
148 ACTIVE DEVICES

                    variation of the collector current IC and the collector-emitter voltage VCE. The
                    transconductance gm (IC) of the device is modeled for operation in the for-
                    ward active region (no saturation). The base-emitter capacitance is modeled

                    as a function of the collector current. The base-collector capacitance is mod-

                    eled as a function of the collector-emitter voltage. For the sake of simplicity,

                    the base resistance and the substrate capacitance are both set to zero.

                       The sub-circuit definition is found in the SLiCAP library SLiCAP.lib.

                    358 * device equations EKV model

                    359 * See Binkley: "Tradeoffs and Optimization in Analog CMOS Design"
                    360 + IC_CRIT = {1/(4*(N_s_P18*U_T)*(Theta_P18+1/L/E_CRIT_P18))^2}
                    361 + g_m      = {-ID/(N_s_P18*U_T*sqrt(IC*(1+IC/IC_CRIT)+0.5*sqrt(IC*(1+IC/IC_CRIT

                              ))+1))}

                    362 + g_o      = {-ID/VAL_P18/L}

                    363 + c_gs     = {2/3*W*L*C_OX_P18 + CGS0_P18*W}
                    364 + c_dg     = {CGSO_P18*W}
                    365 + c_gb     = {CGBO_P18*2*L+(N_s_P18-1)/N_s_P18*C_OX_P18*W*L/3}
                    366 + c_db     = {CJB0_P18*W*LDS_P18}
                    367 + IC_i     = {-ID*L/W/I_0_P18} ; Correction for initial estimate of inversion

                              coefficient

                    368 + IC       = {IC_i*(1+IC_i/4/IC_CRIT)} ; Inversion coefficient corrected for

                              short-channel effects

                    369 + V_GS = {-2*N_s_P18*U_T*ln(exp(sqrt(IC))-1)+Vth_P18}

                    370 .ends

                    371

                    372 .subckt BJTV4 collector base emitter bulk IC={IC} VCE={VCE}

                    373 * small-signal GP model of vertical BJT

                    374 Q1 collector base emitter bulk BJTV4

                    375 .model BJTV4 QV

                    376 * device small-signal parameters
                    377 + gm = {g_m} ; transconductance

                    378 + go = {g_o} ; output conductance

                    379 + gpi = {g_pi} ; input conductance

                    380 + gbc = 0      ; not modeled in GP model

                    381 + cpi = {c_pi} ; base-emitter capacitance

                    382 + cbc = {c_bc} ; base-collector capacitance

                    383 + cbx = 0      ; no external collector-base capacitance

                    384 + cs = 0       ; no substrate capacitance

                    385 + rb = 0       ; zero base resistance

                    386 .param

                    387 * device equations GP model
                    388 + g_m = {IC/U_T}

                    389 + g_o = {IC/(VAF+VCE)}

                       The first line of the listing defines the name, the nodes and the parameters
                    to be passed. The syntax is that of spice. Symbolic parameters that will be
                    used in the sub-circuit are placed between curly brackets.

                       Lines 17 through 21 define the device equations for the small-signal pa-
                    rameters of this model. If desired, an equation for the substrate capacitance
                    can be added here. Line 13 should then be changed to:

                        + cs = {c_s}

                       Where c_s is the parameter name used in the equation. Other equations
                    can be added or modified in a similar way.

                       Line 360 places the SLiCAP small-signal model in the sub-circuit. The
                    small-signal model is shown in Figure 4.51. A full description of this model
                    can be found in the SLiCAP help file. The model itself is also defined as a
                    spice subcircuit, it can be found in the SLiCAP library: SLiCAPmodels.lib,
                    together with the definition of global parameters and technology parameters.
                    Please view the SLiCAP manual for details.

                    4.5.4 NMOS EKV forward region, saturation range

                    The sub-circuit CMOS18N is a parameterized small-signal model of an NMOS
                    transistor in CMOS18 technology. It can be used for simulation of the small-
                    signal behavior under variation of the channel current IDS. The small-signal
                    parameters are a function of IDS, W and L. The model equations cover op-
                    eration in the saturation region from weak inversion until strong inversion
                    including velocity saturation. Capacitances of the small-signal model are
    vertical BJT                                                                                 4.5. SLICAP DEVICE MODELS 149

    Qx C B E S myBJT                                                                                 Figure 4.50: SLiCAP small-signal dynamic
    .model myBJT QV                                                                                  model of the vertical BJT.
    + gm={gm}
    + go={go}                                                (C)
    + gbc={gbc}                                                      (S)
    + gpi={gpi}
    + rb={rb}                                    (B)
    + cpi = {cpi}
    + cbc = {cbc}                                             (E)
    + cbx = {cbx}

    Model: QV

                      name = Cbx                                                              S

          name = Rb   model = C      name = Gbc     name = Cbc            name = Cs
          model = r   value = {cbx}  model = g      model = C             model = C
                                                    value = {cbc}         value = {cs}
    B value = {rb}               int value = {gbc}
                                                                                              C
           name = Gpi        name = Cpi     + name = Gm
           model = g         model = C                                     name = Go
           value = {gpi}     value = {cpi}      model = G                  model = g
                                                                           value = {go}
                                            - value = {gm}

    E

calculated from the oxide capacitance, the overlap capacitances and the zero-
voltage depletion capacitances of the drain and the source. The voltage de-
pendency of these capacitances has not been modeled, but the model can be
extended, if desired. The model can easily be adapted to another technology
by changing the technology parameters.

   The CMOS 18 model parameters are defined in the SLiCAP library SLiCAPmodels.lib.

1 "SLiCAPmodels"

2

3 * Physical constants
4 ********************
5

6 .param

7 +q                  = 1.60217662e-19 ; Electron charge in [C]

8 +c                  = 2.99792458e+08      ; Speed of light in [m/s]
                                            ; Permeability of vacuum in [H/m]
9 + mu_0              = {4*pi*1e-7}         ; Relative permittivity of SiO2 [-]

10 + epsilon_SiO2 = 3.9

11 + k                = 1.38064852e-23      ; Boltzmann constant in [J/K]
12 + epsilon_0        = {1/mu_0/c^2}        ; permittivity of vacuum in [F/m]

13

14 * Temperature and thermal voltage
15 *********************************
16

17 .param

18 + T                = 300                 ; Default value of the absolute

        temperature in [K]

19 + U_T              = {k*T/q}             ; Thermal voltage [V]
20

21 * CMOS18 technology parameters for EKV models (SI units)
22 ********************************************************
23

24 .param

25 + TOX_N18    = 4.1n ; oxide thickness [m]

26 + Vth_N18    = 0.36 ; threshold voltage [V]

27 + N_s_N18    = 1.35 ; substrate factor [-]

28 + Theta_N18 = 0.28 ; vertical field mobility reduction coefficient [1/V]

29 + E_CRIT_N18 = 5.6M ; lateral field strength for velocity saturation [V/m]

30 + u_0_N18    = 42m ; zero field carrier mobility [m^2/V/s]

31 + CGBO_N18 = 1p ; gate-bulk overlap capacitance [F/m]

32 + CGSO_N18 = 300p ; gate-source and gate-drain overlap capacitance [F/m]

33 + CJB0_N18 = 1m ; source/bulk drain/bulk capacitance [F/m^2]

34 + LDS_N18    = 180n ; length of drain and source [m]

35 + VAL_N18    = 40M ; Early voltage per unit of length [V/m]

36 + KF_N18     = 2e-27 ; flicker noise (1/f noise) coefficient, zero for f_ell

        =0 [C/m^2]

37 + AF_N18     =1           ; flicker noise exponent [-]
38 + C_OX_N18
                = {epsilon_0 * epsilon_SiO2 / TOX_N18}; oxide capacitance per

        unit of area [F/m^2]
150 ACTIVE DEVICES

                    39 + I_0_N18     = {2*N_s_N18*u_0_N18*C_OX_N18*U_T^2} ; technology current [A]
                    40 + V_KF_N18
                                     =2     ; flicker noise voltage coefficient [V]

                    41

                    42 .param

                    43 + TOX_P18     = 4.1n ; oxide thickness [m]

                    44 + Vth_P18     = -0.36 ; threshold voltage [V]

                    45 + N_s_P18     = 1.35 ; substrate factor [-]

                    46 + Theta_P18 = 0.35 ; vertical field mobility reduction factor [1/V]

                    47 + E_CRIT_P18 = 14M ; lateral field strength for velocity saturation [V/m]

                    48 + u_0_P18     = 8.92m ; zero field carrier mobility [m^2/V/s]

                    49 + CGBO_P18 = 1p ; gate-bulk overlap capacitance [F/m]

                    50 + CGSO_P18 = 300p ; gate-source and gate-drain overlap capacitance [F/m]

                    51 + CJB0_P18 = 1m ; source/bulk drain/bulk capacitance [F/m^2]

                    52 + LDS_P18     = 180n ; length of drain and source [m]

                    53 + VAL_P18     = 40M ; Early voltage per unit of length [V/m]

                    54 + KF_P18      = 1e-27 ; flicker noise (1/f noise) coefficient, zero for f_ell

                              =0 [C/m^2]

                    55 + AF_P18      =1     ; flicker noise exponent [-]
                    56 + C_OX_P18
                                     = {epsilon_0 * epsilon_SiO2 / TOX_P18}; oxide capacitance per

                              unit of area [F/m^2]

                       The sub-circuit of the small-signal model (see Figure 4.51) is defined in the
                    same library file:

                    76 .ends
                    77
                    78 * MOSFET
                    79 .subckt M d g s b gm=1m gb=0 go=0 cgs=0 cdg=0 cgb=0 cdb=0 csb=0 ; default

                                    values

                    80 Gm d s g s g value={gm}
                    81 Gb d s b s g value={gb}
                    82 Go d s d s g value={go}
                    83 Cgs g s {cgs}
                    84 Cdg d g {cdg}
                    85 Cgb g b {cgb}
                    86 Cdb d b {cdb}

                       Symbolic parameters that will be used in the sub-circuit are placed be-
                    tween curly brackets.

                       The definition of the EKV model based on this sub circuit is found in the
                    SLiCAP library SLiCAP.lib.

                    117 .ends

                    118

                    119 .subckt O_dcvar 1 2 4 COMMON

                    120 + sib={sib}

                    121 + sio={sio}

                    122 + svo={svo}

                    123 + iib={iib}

                    124 Ib 1 5 I dc={iib} dcvar={sib^2}

                    125 F1 2 COMMON 5 COMMON 1

                    126 Io 1 2 I dcvar={sio^2}

                    127 Vo 1 3 V dcvar={svo^2}

                    128 N1 4 COMMON 3 2

                    129 .ends

                    130

                    131 .subckt CMOS18N drain gate source bulk W={W} L={L} ID={ID}

                    132 * EKV model of transistor without bulk resistances

                    133 * Voltage dependency of bulk capacitances not modeled

                    134 * Operating in forward saturation region

                    135 *

                    136 M1 drain gate source bulk CMOS18N

                    137

                    138 .model CMOS18N M

                    139 + gm      = {g_m}

                    140 + go      = {g_o}

                    141 + gb      = {g_b}

                    142 + cgs     = {c_gs}

                    143 + cdg     = {c_dg}

                    144 + cgb     = {c_gb}

                    145 + cdb     = {c_db}

                    146 + csb     = {c_sb}

                    147 * Parameters will be substituted if simType has been set to "numeric"

                    148 .param

                    149 * device equations EKV model

                    150 * See Binkley: "Tradeoffs and Optimization in Analog CMOS Design"
                    151 + IC_CRIT = {1/(4*(N_s_N18*U_T)*(Theta_N18+1/L/E_CRIT_N18))^2}
                                                                                       4.5. SLICAP DEVICE MODELS 151

   Line 122 places the SLiCAP small-signal model in the sub-circuit. The
model is shown in Figure 4.51. A full description of this model can be found
in the SLiCAP help file.

4-terminal MOSFET                                                                           Figure 4.51: SLiCAP small-signal dynamic
                                                                                            model of the MOS transistor.
Mx D G S B myMOS
                                 D
.model myMOS M
+ gm={gm}                 G      B
+ gb={gb}
+ go={go}                        S
+ cgs={cgs}
+ cgb={cgb}
+ cdg={cdg}
+ cdb={cdb}
+ csb={csb}

Model: M (G)                                       (D)            (B)

               name = Cdg name = Cgb               name = Cdb
                                                   model = C
               model = C         model = C         value = {cdb}

               value = {cdg} value = {cgb}

name = Cgs         +             name = Go              -         name = Csb
model = C                        model = g              +         model = C
value = {cgs}      -             value = {go}                     value = {csb}

                   name = Gm                  (S)  name = Gb
                   model = G                       model = g
                   value = {gm}                    value = {gb}

Lines 125 through 132 define the parameter that will be used for symbolic

analysis. In order to keep the symbolic expressions as compact as possible,

simple single-parameter values have been used. If desired, numeric values

or more complex expressions may as well be used.

Lines 135 through 150 give the device equations for the elements of the

small-signal model. All intermediate parameters such as ICCRIT in line 137,
will be local parameters and appear in the main circuit as PARNAME_Xnnn,

where PARNAME is the name of the parameter and Xnnn the name of the sub-

circuit. In case of nested sub-circuits it will be PARNAME_XnnnXmmm, etc, where

Xmmm is the sub-circuit that calls Xnnn. The values and expressions of these

parameters can be listed in the HTML output or passed to the PYTHON

workspace.  Please notice that the thermal voltage UT      =      kT ,  is  a  global  pa-

                                                                  q

rameter. See the SLiCAP help file for more information about the use of

global and local parameters.

In section 4.5.6 we will demonstrate in which way the device parameters

can be plot against each other. This makes it possible to compare the small-

signal element values obtained with SLiCAP with those obtained from other

simulators, and to adjust the SLiCAP device equations and technology pa-

rameters to obtain optimum model correspondence.

4.5.5 NMOS EKV forward region, linear and saturation
         range

The sub-circuit CMOS18N_V is a parameterized small-signal model of an NMOS
transistor in CMOS18 technology. It can be used for simulation of the small-
signal behavior under variation of the voltages VDB, VGB and VSB. The small-
signal parameters of the intrinsic transistor are modeled for forward oper-
ation in the linear region and in the saturation region from weak inversion
until strong inversion including velocity saturation. The model equations for
the elements of the small-signal model of the intrinsic transistor are those de-
scribed in section 4.4.7. The extrinsic capacitances have been added as in the
CMOS18N sub-circuit. This model can easily be adapted to another technology
by changing the technology parameters.

   The definition of this sub-circuit is listed below:
152 ACTIVE DEVICES

                    153 + g_o   = {ID/VAL_N18/L}

                    154 + g_b   = {(N_s_N18-1)*g_m}
                    155 + c_gs  = {2/3*W*L*C_OX_N18 + CGSO_N18*W}
                    156 + c_dg  = {CGSO_N18*W}
                    157 + c_gb  = {CGBO_N18*2*L+(N_s_N18-1)/N_s_N18*C_OX_N18*W*L/3}
                    158 + c_db  = {CJB0_N18*W*LDS_N18}
                    159 + c_sb  = {CJB0_N18*W*LDS_N18}
                    160 + IC_i  = {ID*L/W/I_0_N18} ; Initial estimate of inversion coefficient
                                = {IC_i*(1+IC_i/4/IC_CRIT)} ; Inversion coefficient corrected for
                    161 + IC

                              short-channel effects

                    162 + V_GS  = {2*N_s_N18*U_T*ln(exp(sqrt(IC))-1)+Vth_N18}
                    163 + f_T   = {g_m/2/pi/c_iss}

                    164 + c_iss = {c_gs+c_dg+c_gb}

                    165 .ends

                    166

                    167 .subckt CMOS18N_V drain gate source bulk W={W} L={L} VD={VD} VG={VG} VS={VS}

                    168 * EKV model of transistor without bulk resistances

                    169 * Voltage dependency of bulk capacitances not modeled

                    170 * Operating voltages with respect to the bulk

                    171 * Assumes forward operation: VDS > 0

                    172 *
                    173 M1 drain gate source bulk CMOS18N_V

                    174

                    175 .model CMOS18N_V M

                    176 + gm    = {g_m}

                    177 + go    = {g_o}

                    178 + gb    = {g_b}

                    179 + cgs   = {c_gs}

                    180 + cdg   = {c_dg}

                    181 + cgb   = {c_gb}

                    182 + cdb   = {c_db}

                    183 + csb   = {c_sb}

                    184 * Parameters will be substituted if simType has been set to "numeric"

                    185 .param

                    186 * device equations EKV model

                    187 * See Binkley: "Tradeoffs and Optimization in Analog CMOS Design"

                    188 * See EKV2.6 model manual
                    189 + V_A   = {VAL_N18*L}

                    190 + C_gso = {CGSO_N18*W}
                    191 + C_gdo = {CGSO_N18*W}
                    192 + C_gbo = {CGBO_N18*2*L}
                    193 + C_sb0 = {CJB0_N18*W*LDS_N18}
                    194 + C_db0 = {CJB0_N18*W*LDS_N18}
                    195 + IC_CRIT = {1/((4*N_s_N18*U_T)*(Theta_N18+1/L/E_CRIT_N18))^2}
                    196 + V_effF = {(VG-Vth_N18-N_s_N18*VS)}
                    197 + V_effR = {(VG-Vth_N18-N_s_N18*VD)}
                    198 + IC_F = {(ln(1+exp(V_effF/2/N_s_N18/U_T)))^2}

                    199 + IC_R = {(ln(1+exp(V_effR/2/N_s_N18/U_T)))^2}

                    200 + x_f   = {sqrt(1/4+IC_F)}

                    201 + x_r   = {sqrt(1/4+IC_R)}

                    202 + I_DSF = {W/L*I_0_N18*(IC_F)*(1+(VD-VS)/V_A)/(1+(Theta_N18+1/L/E_CRIT_N18)

                                     *2*U_T*sqrt(IC_F))}

                    203 + I_DSR = {W/L*I_0_N18*(IC_R)*(1+(VS-VD)/V_A)/(1+(Theta_N18+1/L/E_CRIT_N18)

                                     *2*U_T*sqrt(IC_R))}

                    204 + I_DS = {I_DSF-I_DSR}

                    205 + g_mF = {I_DSF/(N_s_N18*U_T*sqrt(IC_F*(1+IC_F/IC_CRIT)+0.5*sqrt(IC_F*(1+

                                     IC_F/IC_CRIT))+1))}

                         The first line of the listing defines the name, the nodes and the parameters

                    to be passed. Line 159 places the SLiCAP small-signal model in the sub-

                    circuit. The model is shown in Figure 4.51. Line 162 through 169 define the

                    parameter values or equations that will be used for symbolic analysis. They

                    are the same as in the CMOS18N sub-circuit.

                         Lines 172 through 204 give the device equations for the elements of the

                    small-signal model. All intermediate parameters such as VA in line 175, will
                    be local parameters and appear in the main circuit as PARNAME_Xnnn, where

                    PARNAME is the name of the parameter and Xnnn the name of the sub-circuit. In

                    case of nested sub-circuits it will be PARNAME_XnnnXmmm, etc. Where Xmmm is the

                    sub-circuit that calls Xnnn. The values and expressions of these parameters

                    can be listed in the HTML output or passed to the PYTHON workspace.

                    Please  notice  that  the  thermal  voltage  UT  =  kT ,  as  well  as  0  and  Si O2 ,  are

                                                                        q

                    global parameters. Please see the SLiCAP help file for more information

                    about the use of global and local parameters.
                                                                                                       4.5. SLICAP DEVICE MODELS 153

   The technology parameters are taken from the SLiCAP library SLiCAPmodels.lib
(see description above). In section 4.5.6 we will demonstrate in which way the
device parameters can be plot against each other. This makes it possible to
compare the small-signal element values obtained with SLiCAP with those
obtained from other simulators, and to adjust the SLiCAP device equations
and technology parameters to obtain optimum model correspondence.

4.5.6 SLiCAP MOS device characteristics

The simulation results obtained with the SLiCAP models can be adjusted
to those obtained from measurements or from other simulators. This can be
done by comparing graphs obtained from measurement or simulation with
similar graphs obtained from SLiCAP and adjust the SLiCAP model param-
eters or model equations to reduce differences to an acceptable level.

   In this section we will demonstrate how to plot the device characteristics
with SLiCAP.

   Below is the listing of a SLiCAP file that can been used for this purpose:

1 #!/usr/bin/env python2

2 # -*- coding: utf-8 -*-
3 """

4 Created on Sun Jul 5 19:15:00 2020

5

6 @author: anton

7 """

8

 9 from SLiCAP import *
10 t1 = time()

11

12 prj = initProject('NMOS EKV plots') # Creates the SLiCAP libraries and the

13                               # project HTML index page

14
15 fileName = 'mosEKVplotsN_V.cir'

16 i1 = instruction()            # Creates an instance of an instruction object

17 i1.setCircuit(fileName)       # Checks and defines the local circuit object and

18                               # sets the index page to the circuit index page

19 htmlPage('Circuit data')

20 netlist2html(fileName)

21 elementData2html(i1.circuit)

22 params2html(i1.circuit)

23

24 # Put the plots on a page

25 htmlPage('CMOS18 EKV model plots')

26

27 i1.setDataType('params')
28 i1.defPar('V_G', 1.8)
29 i1.defPar('V_D', 1.8)

30

31 i1.stepOn()
32 i1.setStepVar('V_G')

33 i1.setStepStart(0.6)

34 i1.setStepStop(1.8)

35 i1.setStepNum(6)

36 i1.setStepMethod('lin')

37

38 result = i1.execute()

39
40 fig_Ids_Vds = plotSweep('IdsVds', '$I_{ds}(V_{ds})$', result, 0, 1.8, 50,

                sweepVar= 'V_D', xUnits = 'V', yVar = 'I_DS_X1', yScale = 'u', yUnits = '

                A', funcType = 'param', show = True)

41 fig2html(fig_Ids_Vds, 600)

42
43 i1.setStepVar('V_D')

44 result = i1.execute()

45
46 fig_Ids_Vgs = plotSweep('IdsVgs', '$I_{ds}(V_{gs})$', result, 0, 1.8, 50,

                axisType = 'lin', sweepVar= 'V_G', xUnits = 'V', yVar = 'I_DS_X1', yScale

                 = 'u', yUnits = 'A', funcType = 'param', show = True)

47 fig2html(fig_Ids_Vgs, 600)

48
49 fig_Ids_Vgs_Log = plotSweep('IdsVgsLog', '$I_{ds}(V_{gs})$', result, 0.01,

                1.8, 50, axisType = 'semilogy', sweepVar= 'V_G', xUnits = 'V', yVar = '

                I_DS_X1', yScale = 'u', yUnits = 'A', funcType = 'param', show = True)
154 ACTIVE DEVICES

56 After recursive substitution of all param-  50 fig2html(fig_Ids_Vgs_Log, 600)
eters.                                         51
                                               52 fig_gm_Ids = plotSweep('gmIds', '$g_m(I_{ds})$', result, 0, 1.8, 50, sweepVar

                                                               = 'V_G', xVar = 'I_DS_X1', xScale = 'u', xUnits = 'A', yVar = 'g_m_X1',
                                                               yScale = 'u', yUnits = 'S', funcType = 'param', show = True)

                                               53 fig2html(fig_gm_Ids, 600)
                                               54
                                               55 fig_fT_Ids = plotSweep('fTIds', '$f_{T}(I_{ds})$', result, 0, 1.8, 50,

                                                               sweepVar= 'V_G', xVar = 'I_DS_X1', xScale = 'u', xUnits = 'A', yVar = '
                                                               f_T_X1', yScale = 'G', yUnits = 'Hz', funcType = 'param', show = True)

                                               56 fig2html(fig_fT_Ids, 600)
                                               57
                                               58 fig_CissVg = plotSweep('CissVg', '$c_{iss}(V_{gs})$', result, 0, 1.8, 50,

                                                               sweepVar= 'V_G', xScale = '', xUnits = 'V', yVar = 'c_iss_X1', yScale = '
                                                               f', yUnits = 'F', funcType = 'param', show = True)

                                               59 fig2html(fig_CissVg, 600)
                                               60
                                               61 t2=time()
                                               62 print(t2-t1,'s')
                                               63
                                               64 LTspiceTraces = LTspiceData2Traces('nmosChar.txt')
                                               65 traces2fig(LTspiceTraces, fig_Ids_Vgs)
                                               66 traces2fig(LTspiceTraces, fig_Ids_Vgs_Log)
                                               67 fig_Ids_Vgs.plot()
                                               68 fig_Ids_Vgs_Log.plot()
                                               69
                                               70 figLT = plot('LTspiceIdsVgs', 'LTspice $I_{ds}(V_{gs})$', 'lin', LTspiceTraces

                                                               , xName = '$V_{gs}$', xUnits = 'V', yName = '$I_{ds}$', yUnits = 'A',
                                                               yScale = 'u', show = True)

                                                   SLiCAP needs a circuit file to work with. Checking of a circuit creates an
                                               internal data structure with circuit parameters, which is needed for calculat-
                                               ing parameter values. Checking of the circuit is performed by the instruction
                                               in line 1.

                                                  The circuit file itself is a very simple netlist comprising the transistor and
                                               the inclusion of the library with the model and initial parameter definitions.
                                               The listing of this circuit file is shown below:

                                                1 mosEKVplots
                                                2 * SLiCAP netlist file
                                                3 .include C18.lib
                                                4 X1 d g s 0 CMOS18N_V W={W} L={L} VD={V_D} VG={V_G} VS={V_S}
                                                5 .param V_D=1.8 V_G=0.5 V_S=0 W=220n L=180n
                                                6 .end

                                                  Line 4 of the circuit file assigns numeric values to the parameters to be
                                               passed to the sub-circuit. These values can be changed from within the
                                               PYTHON environment.

                                                  The instructions in lines 13 until 16 create an HTML page that shows the
                                               circuit data after the circuit has been checked. Figure 4.53 and 4.54 show this
                                               HTML page. The parameter listing section shows the symbolic expression
                                               and the numeric value56 of each parameter. Thanks to the math rendering
                                               they are easier to read than those in the sub-circuit definition in the library
                                               file. Please note that all local parameters of the sub-circuit X1 have X1 added
                                               to the subscript of their parameter name.

                                                  The graphs have been shown in section 4.4.7.

                                               4.5.7 PMOS EKV models

                                               Similar as for NMOS devices, SLiCAP has two sub-circuits for PMOS EKV
                                               models:

                                               1. CMOS18P
                                                  The only difference with the NMOS sub-circuit CMOS18N is the technology
                                                  section in the model definition. The direction of the drain current is not
                                                  accounted for; the parameter ID should be given a negative value.

                                               2. CMOS18P_V
                                                                                   4.6. CONCLUSIONS 155

Apart from the technology definition and the signs of the voltages, this
sub-circuit is identical to its NMOS version: CMOS18N_V. Please notice that
all voltages should be given a positive value with respect to the bulk volt-
age, similar as with the NMOS devices.

4.6 Conclusions

In this chapter, we have briefly studied the operation and modeling of mod-
ern active devices. We have seen that those devices can be considered as
nonlinear two-ports, of which the input port and the output port share one
terminal. When biased properly, they can provide an available power gain
that exceeds unity.

   Although the fabrication, the operation and the modeling of active devices
differs for each device, they have a lot in common:

1. The physical operation mechanism of all these active devices is that the        57 A current will flow in the output port
   current in the output port is controlled by the voltage across the input        only if both the input port voltage and the
   port, while building up this voltage requires a nonzero charge. This charge     output port voltage differ from zero.
   controls the current in the output port.57

2. The static intrinsic noise sources of all devices are the noise currents asso-
   ciated with the static (DC) port currents. We have studied in which way
   they can be converted into equivalent-input noise sources.

3. When properly biased, the active devices, together with their bias sources,
   can provide an available power gain that exceeds unity. In the following
   chapters we will design amplifiers using biased active devices. Since the
   design theory itself is technology-independent, we will often use general-
   ized biased three-terminal devices from Figure 3.14. Figure 4.52 shows a
   simple small-signal of such a device that can be used during early stages
   of the design. It models the small-signal behavior of an intrinsic device.
   For BJTs we have gi = gm/AC. For field effect devices gi equals zero.

                                                                                   Figure 4.52: Generalized small-signal
                                                                                   model of the active devices.

+      +  -
          +
input     output

-      -
156 ACTIVE DEVICES

Figure 4.53: SLiCAP html page with circuit
data.
          4.6. CONCLUSIONS 157

Figure 4.54: SLiCAP html page with circuit
data.
                                                                    159

5Basic amplification: CS stage

5.1 Introduction                                               160

5.1.1 The CS stage                                             160

5.1.2 This chapter                                             160

5.2 The intrinsic CS stage                                     160

5.2.1 Instantaneous behavior                                   163

5.2.2 Small-signal dynamic behavior                            166

5.2.3 Large-signal dynamic behavior                            170

5.2.4 Noise behavior                                           172

5.3 Small-signal behavior of CS stage between source and load  176

5.3.1 Transimpedance                                           177

5.3.2 Current gain                                             177

5.3.3 Qualitative description of the dynamic behavior          178

5.3.4 Quantitative description of the dynamic behavior         178

5.3.5 Input impedance                                          182

5.3.6 Influence of the gate series resistance                  184

5.4 Optimization of the noise performance of a CS stage        184

5.4.1 Noise design considerations                              185

5.4.2 Noise minimization for resistive source                  185

5.4.3 Noise minimization for capacitive voltage source         195

5.4.4 Noise minimization for capacitive current source         200

5.5 Conclusions                                                204
160 BASIC AMPLIFICATION: CS STAGE

                                 5.1 Introduction

                                                  In this chapter, we will study the amplifying capabilities of a MOS transis-
                                                  tor. We will do this for the MOS in common-source (CS) configuration. A
                                                  common-source, or CS amplifier stage is a biased MOS transistor of which
                                                  the source has been taken as common terminal for both the input port and
                                                  the output port. At a later stage it will become clear that all other MOS stages
                                                  can be derived from the CS stage with the aid of error reduction techniques.
                                                  At this stage, we will simply assume that the CS stage can be considered as
                                                  the basic MOS amplifier stage.

                                               5.1.1 The CS stage

                                               Figure 5.1 shows the MOS CS stage biased as proposed in Chapter 3.4.

Figure 5.1: Biased NMOS CS stage.

                                                       -                                                   +
                                               +          +
                                               -                -
                                                          +     +                                             +
                                                                                     -
                                                          -                                                   -

                                                             +

                                                                            NMOS CS stage

                                                             -

1 In floating CS stages, the source may also      The biased gate-source is the input port and the biased drain-source is
carry signal with respect to the bulk.
                                               the output port of the stage. In this CS configuration the source is assumed

                                               to carry no signal with respect to the bulk, however, the bias voltage of the
                                               source may differ from that of the bulk.1 For an NMOS device VBS  0. For
                                               a PMOS device all polarities of the bias sources are opposite to those of an

                                               NMOS device.

                                               5.1.2 This chapter

                                               The ideally biased CS stage from Figure 5.1 will be referred to as the intrinsic
                                               CS stage. An intrinsic CS stage has no source and load connected to it. Its be-
                                               havior will be studied in section 5.2. There, we will evaluate its transmission-
                                               1 matrix parameters A, B, C and D. Studying the behavior of the intrinsic
                                               CS stage is helpful in understanding the source-to-load signal transfer of a
                                               CS stage driven from and terminated with finite non-zero impedances. The
                                               behavior of the CS stage between source and load will be discussed in section
                                               5.3. The primary focus will be on source and load impedances that consists
                                               of parallel RC networks. This is because such drive and load conditions ap-
                                               proximate those present in many applications. However, the theory can as
                                               well be applied for other source and load types.

+                                  +           5.2 The intrinsic CS stage

-                                  -           The intrinsic CS stage is a CS stage biased with ideal sources. For the sake
                                               of simplicity we leave the bias sources out of the schematics. The fact that
Figure 5.2: Simplified circuit diagram of the  the CS stage is based in a quiescent operating point Q will be indicated by
intrinsic CS stage.                            denoting the relevant operating point quantities in the schematics. This has
                                               been shown in Figure 5.2, where the quiescent operating voltage and current
                                               of the output port have been selected as operating quantities that somehow
                                               need to be fixed.
                                                                                                                                                     5.2. THE INTRINSIC CS STAGE 161

   In the following example, we will demonstrate the biasing of a CS stage                                                                                               VdsQ
according to the method discussed in Chapter 3.                                                                                                              (1) (2)

   Example 5.1

       In this example, we will determine the input port bias quantities of a CS stage
    for biasing its output port at: IDSQ = 10µA, VDSQ = 0.9V and VSBQ = 0V.
    The transistor is an NMOS with W = 220nm and L = 180nm, fabricated in a
    typical CMOS18 process.

       Figure 5.3 gives the circuit for determination of VGSQ and IGSQ . Its spice
    netlist is shown below:

 1 CSbias0_9V-10uA
 2 * file: CSbias0_9V-10uA
 3 * Spice circuit file
 4 .include CMOS18TT.lib
 5 M1 2 1 0 0 C18nmos W=220n L=180n
 6 VdsQ 2 3 0.9
 7 IdsQ 0 3 10u
 8 E1 1 0 3 0 1k
 9 .op
10 .end
                                                                                                                           +-                        ++                                                                  (3)
                                                                                                                                                                                                                      -E1    IdsQ
                    +
      +                                                                                                                                              --

                                                                                                                                                             M1

                                                                                                                                                     Figure 5.3: Circuit for determination of the

                                                                                                                                                     input bias sources of a C18 nmos transistor
                                                                                                                                                     with W = 220nm and L = 180nm, biased at
                                                                                                                                                     IDSQ = 10µA, VDSQ = 0.9V and VSB = 0V.

       After running spice, the operation point information can be found in the
   output file. It shows: VGSQ = 643.709mV and IGSQ = 0. Since the gain of E1
   equals 1000, a small error voltage of VGSQ /1000 is expected at the output port.
   This error voltage can be reduced by increasing the gain of E1.

   In the next example, we will apply the above results to the biasing of the
CS stage.

   Example 5.2

       Figure 5.4 shows the biased stage. A resistor has been added to prevent from
   having a floating node at the input port. Its value is large enough not to affect the
   properties of the stage in practical situations. The resulting operating voltages at
   the input port the output port have been shown in the circuit. They approximate
   zero; as expected.

VgsQ                    VdsQ                                                                                                                         Figure 5.4: Biased CS stage with a C18
                                                                                                                                                     nmos transistor with W = 220nm and
         (4) - (1) (2)                                                                                                      (3)                      L = 180nm, biased at IDSQ = 10µA,
0                                                                                                                                       V=631.547uV  VDSQ = 0.9V and VSB = 0V.

           R1                                                                                                                         IdsQ

      M1

       The spice netlist file of this circuit has been shown below:

 1 CSbiased0_9V-10uA
 2 * file: CSbiased0_9V-10uA
 3 * Spice circuit file
 4 .include CMOS18TT.lib
 5 M1 2 1 0 0 C18nmos W=220n L=180n
 6 VdsQ 2 3 0.9
 7 IdsQ 0 3 10u
 8 VgsQ 1 4 643.709m
 9 R1 4 0 1T
10 .op
11 .end

   In the following sections, we will discuss various performance aspects of
the intrinsic CS stage. In section 5.2.1, we will discuss the instantaneous
behavior of the intrinsic CS stage. In section 5.2.2, we will discuss its small-
162 BASIC AMPLIFICATION: CS STAGE

                                              signal dynamic behavior and in section 5.2.3, its large-signal dynamic behav-
                                              ior.

Figure 5.5: Simulation test benches for de-                                -  +                 +
                                                                  +                             -
termination of the transfer characteristics:                    -                +              +                       +
                                                                                 -                                   -  -
    A. Circuit for determination of vo =      A
voQ (vi )                                                                  -                 +  -                           +
                                                                                            -   +                           -
    B. Circuit for determination of io =                          +                                                  -
ioQ (vi )                                                       -                +
                                                                                 -              -
    C. Circuit for determination of vo =      B                                                 +
voQ (ii )                                                                                    +                       -
                                                                                            -
    D. Circuit for determination of io =                                                        -
ioQ (ii )                                                                                       +
                                                                                                                     -
                                                                              +                 +

                                                 -                            +                 +

                                                                                 +                                      +

                                                                                 -                                      -

                                                                                    +

                                              C                                     -

                                                 -                            +                 +

                                                                                 +                                         +

                                                                                 -                                         -

                                                                                    +

                                              D                                     -

                                                 In those sections, the following transfer characteristics have our interest:

                                              1. Voltage transfer vo = voQ(vi) (voltage driven input, open output)

                                              2. Voltage-to-current transfer io = ioQ(vi) (voltage driven input, shorted out-
                                                 put)

                                              3. Current-to-voltage transfer vo = voQ(ii) (current driven input, open out-
                                                 put)

                                              4. Current transfer io = ioQ(ii) (current driven input, shorted output)

                                                 Simulation test benches for determination of these characteristics are shown
                                              in Figure 5.5.

                                                 The voltage transfer, the current-to-voltage transfer, the voltage-to-current
                                              transfer and the current transfer can be determined with the aid of the circuits
                                              from Figure 5.5A through D. The four characteristics together fully describe
                                              the behavior of the intrinsic CS stage. The nonlinear dynamic input and
                                              output characteristics of this stage, that also may have our interest, can be
                                              derived from these characteristics. As an example, the input vi(ii) or ii(vi)
                                              characteristic with shorted output can be derived from the io(ii) transfer and
                                              the io(vi) transfer. They may as well be determined with dedicated simulation
                                              test benches.
                                                             5.2. THE INTRINSIC CS STAGE 163

   In practice, only the instantaneous transfer characteristics can be measured  2 Ideal drive and termination conditions:
using ideal drive and termination conditions.2 At high frequencies, such         Zs = 0 or Zs =  and Z = 0 or Z = 

ideal drive and termination conditions can never be met. For this reason, the

measurement of the dynamic transfer parameters is usually performed with
S-parameter test equipment, using 50 drive and termination impedances.

   In section 5.2.4 we will study the noise behavior of the intrinsic CS stage.

5.2.1 Instantaneous behavior

In this section, we will discuss the instantaneous nonlinear transfer of a CS
stage. We will confine ourselves to the following transfer characteristics:

1. Voltage transfer vo = voQ(vi) (voltage driven input, open output)

2. Voltage-to-current transfer io = ioQ(vi) (voltage driven input, shorted out-
   put)

3. Output v - i characteristic vo = voQ(io)
   In case of a nonzero instantaneous (DC) reverse transfer, the output v - i
   characteristic will depend on the resistive termination of the input port.
   The intrinsic MOS transistor in CS configuration has zero instantaneous
   reverse transfer because both the DC gate current and the DC gate voltage
   do not depend on the DC drain voltage and the DC drain current. Par-
   asitic DC feedback from the output port to the input port, however, may
   introduce a non-zero reverse transfer. Such feedback can for example be
   caused by a non-zero resistance of the source, or by a gate leakage cur-
   rent that depends on the drain voltage. In most cases such effects can be
   neglected for taking early stage design decisions.

   Due to the absence of a DC gate current, the DC input resistance, the DC
current to voltage transfer as well as the DC current gain of the CS stage are
infinite. Hence, they need no further study here.

   The study of the instantaneous behavior of the intrinsic CS stage will be
performed with the aid of the biased CS stage from Figure 5.4.

Voltage-to-current transfer

Figure 5.6 shows the spice simulation test bench for the determination of the
voltage-to-current transfer of the intrinsic CS stage from Figure 5.4.

                                                                                                                                                     Io(Vi)

         VgsQ           VdsQ

         (4) - (1) (2)
                             +  (3)
               +                                   -
                                                      +
      +                              IdsQ                Vo
Vi                              -

     -

               M1

   The graph shows the simulation results for vi = -0.2 · · · 0.2V. It clearly   Figure 5.6: Left: Circuit for determination
shows that the io (vi) characteristic of the properly biased transistor passes   of the io(vi) characteristic of the biased CS
                                                                                 stage from Figure 5.4

                                                                                     Right: Io(Vi) charactersitic.
164 BASIC AMPLIFICATION: CS STAGE

                                                  through the origin. For negative input voltage excursions the current through
                                                  the MOS decreases and the portion of IdsQ that flows through the shorted
                                                  output increases until its maximum value of 10µA is achieved. The transcon-
                                                  ductance drops with the current through the MOS transistor. For positive
                                                  excursions the transconductance does not increase noticeably with IDS due
                                                  to the VFMR and the velocity saturation. The maximum current that can
                                                  be delivered to the shorted output is now limited by VdsQ and the channel
                                                  resistance of the MOS transistor.

                                                      The netlist of this circuit is:

                                                                1 CSbiased0_9V-10uAViIo
                                                                2 * file: CSbiased0_9V-10uAViIo
                                                                3 * Spice circuit file
                                                                4 .include CMOS18TT.lib
                                                                5 M1 2 1 0 0 C18nmos W=220n L=180n
                                                                6 VdsQ 2 3 0.9
                                                                7 IdsQ 0 3 10u
                                                                8 VgsQ 1 4 643.709m
                                                                9 Vi 4 0 0
                                                               10 Vo 3 0 0
                                                               11 .dc Vi -0.1 0.1 10m
                                                               12 .end
                                                               13 .graph "Vo#p"

                                                  Voltage transfer

                                                  Figure 5.7 shows the spice simulation test bench for the determination of the
                                                  voltage transfer of the intrinsic CS stage from Figure 5.4. The graph shows
                                                the simulation results for vi = -0.1 · · · 0.1V. It clearly shows that the vo (vi)
                                                  characteristic of the properly biased transistor passes through the origin. For
                                                small voltage excursions: vi = -0.02 · · · 0.02V, the voltage transfer is approx-
                                                  imately linear. At large negative voltage excursions both DIBL and increased
                                                  leakage of the drain bulk diode limit the positive voltage excursion. At large
                                                  positive voltage excursions, the transistor operates in the linear region and
                                                the output voltage is limited to -VDSQ = -0.9V.

         VgsQ                                  VdsQ

         (4) - (1) (2)
                             +                 -     (3)
               +

      +                                                            +
Vi
                                                          IdsQ Vo
     -                                                            -

               M1

Figure 5.7: Left: Circuit for determination      The netlist of this circuit is:
of the vo(vi) characteristic of the biased CS
stage from Figure 5.4                          1 CSbiased0_9V-10uAViIo
                                               2 * file: CSbiased0_9V-10uAViIo
    Right: Vo(Vi) charactersitic.              3 * Spice circuit file
                                               4 .include CMOS18TT.lib
                                               5 M1 2 1 0 0 C18nmos W=220n L=180n
                                               6 VdsQ 2 3 0.9
                                               7 IdsQ 0 3 10u
                                               8 VgsQ 1 4 643.709m
                                                            5.2. THE INTRINSIC CS STAGE 165

 9 Vi 4 0 0
10 .dc Vi -0.05 0.05 1m
11 .end
12 .graph "3"

Output characteristics

Figure 5.8 shows the spice simulation test bench for the determination of
the output v - i characteristic at shorted input of the intrinsic CS stage from
Figure 5.4. The graph shows the simulation results for ii = -20µA· · · 20µA.
It clearly shows that the vo (io) characteristic of the properly biased transistor
passes through the origin. For small current excursions: io = -3µA· · · 3µA,
the output v - i characteristic is approximately linear. At large positive volt-
age excursions both DIBL and increased leakage of the drain bulk diode
limit the positive voltage excursion. At large negative voltage excursions the
transistor operates in the linear region and the output voltage is limited to
-VDSQ = -0.9V.

             VgsQ                 VdsQ
         (4) -
                                 +      (3)
                   +
                         (1) (2)    -

      +                                      IdsQ        +
Vi
                                                   Io Vo
     -                                                  -

                         M1

   The netlist of this circuit is:                                                  Figure 5.8: Left: Circuit for determination
                                                                                    of the vo(io) characteristic of the biased CS
 1 CSbiased0_9V-10uAVoIo                                                            stage from Figure 5.4
 2 * file: CSbiased0_9V-10uAVoIo
 3 * Spice circuit file                                                                 Right: Vo(Io) charactersitic.
 4 .include CMOS18TT.lib
 5 M1 2 1 0 0 C18nmos W=220n L=180n
 6 VdsQ 2 3 0.9
 7 IdsQ 0 3 10u
 8 VgsQ 1 4 0.643709
 9 Vi 4 0 0
10 Io 0 3 0
11 .dc Io -20u 20u 1u
12 .end

   The output v - i characteristic at open input is obtained after replacing
the voltage source Vi with a high-value resistor that prevents from having a
floating node at the input port (see Figure 5.3). For the given C18nmos model
this characteristic equals the one obtained with shorted input.

Conclusions

At this stage we may draw the following conclusions concerning the large
signal instantaneous behavior of the biased CS stage:

1. When properly biased, the transfer characteristics and the v - i character-
   istics of the input port and the output port all pass through the origin.
166 BASIC AMPLIFICATION: CS STAGE

                                                  2. The maximum positive current that can be delivered to the output port
                                                      equals IDSQ . This current is called the maximum source current: the max-
                                                      imum current that can be sourced or provided to the load.

                                                  3. The maximum negative current that can be delivered to the output port
                                                      depends on VDSQ and the channel resistance of the MOS transistor. This
                                                      current is called the maximum sink current: the maximum current that
                                                      can be taken from the load.

                                                  4. The maximum positive voltage that can be delivered to the load is limited
                                                      by the breakdown voltage of the source-bulk diode at IDSQ or by the DIBL
                                                      effect and IDSQ .

                                                  5. The maximum negative voltage that can be delivered to the load equals
                                                    -VDSQ .

(g)     (d)                                   5.2.2 Small-signal dynamic behavior

     +                                        In this section, we will study the small-signal dynamic behavior of the in-
                                              trinsic CS stage. We will derive expressions for the transmission-1 matrix
         -                                    parameters A, B, C and D. Expressions for the input impedance with shorted
                                              and open output and expressions for the output impedance with open and
                          (s)                 shorted input can be derived from these matrix parameters. They can also
                                              directly be obtained using network analysis and we will give circuits to do
Figure 5.9: Hybrid-pi equivalent circuit of   so.
the intrinsic CS stage that can be used if
the source carries no signal with respect to     The small-signal dynamic behavior of the intrinsic CS stage can be ob-
the bulk. The model is a simplified version   tained from network analysis using the hybrid-pi equivalent circuit of the
of the one shown in Figure 4.31: the bulk     MOSFET. The small-signal model of the MOS has been shown in Figure 4.31.
resistances have been omitted.                If we neglect the bulk resistances and if the source carries no signal with
                                              respect to the bulk, the model can be simplified to the one shown in Figure
                                              5.9. Such simplifications are usually justified for taking early stage design
                                              decisions.

                                              Voltage gain factor

                                              Figure 5.10 shows the network for the determination of the small-signal volt-
                                              age gain factor µ of the CS stage.

Figure 5.10: Circuit for determination of        (1)                                  (2)
the small-signal voltage gain factor of the                                                    +
biased CS stage.                              +       +
                                                                                              -
                                              -       -

                                              The voltage gain factor is obtained as

                                              µ = 1 = vo = -g 1 - s mro gm cgd .                         (5.1)
                                                 A vi io=0                            1 + sro cgd + cds

                                                 It has a right half plane zero at s = cgmgd , and a pole at s = - 1 ro(cgd+cds) .
                                              If the device is operating in the saturation region, the frequency of the zero

                                              exceeds that of the pole.

                                              Transadmittance factor

                                              Figure 5.11 shows the network for the determination of the small-signal
                                              transadmittance factor  of the CS stage.
   (1)                                         (2)                                     5.2. THE INTRINSIC CS STAGE 167

+             +                                                                     -       Figure 5.11: Circuit for determination of
                                                                                    +       the small-signal transadmittance factor of
                                                                                            the biased CS stage.
                                                                                    -
-             -                                                                     +

The transadmittance factor is obtained as

    = 1 = io     = -gm 1 - s cgd .                                                     (5.2)
   B vi vo=0                                   gm

It has a right half plane zero at s = cgmgd .

Transimpedance factor

Figure 5.12 shows the network for the determination of the small-signal tran-
simpedance factor  of the CS stage.

   (1)                                         (2)                                            Figure 5.12: Circuit for determination of
            +                                           +                                     the small-signal transimpedance factor of
                                                                                              the biased CS stage.

              -                                                    -

The transimpedance factor is obtained as

 = 1 = vo ;                                                                            (5.3)
      C ii io=0                                                                        (5.4)

  = -g 1 - s mro gm cgd .
                                                     ro (cgs cds +cgs cgd +cds cgd )

              s cgs + (1 + gmro) cgd 1 + s cgs+(1+gmro)cgd

   It has a right half plane zero at s = cgmgd , and two poles. One pole is found
in the origin of the s-plane; at: s = 0 and a second pole is found at

   s = - cgs + (1 + gmro) cgd ;                                                        (5.5)
          ro cgscds + cgscgd + cdscgd

Current gain factor

Figure 5.13 shows the network for the determination of the small-signal cur-
rent gain factor  of the CS stage.

   (1)                                         (2)                                            Figure 5.13: Circuit for determination of
                                                                                              the small-signal current gain factor of the
              +                                                                               biased CS stage.

              -

The current gain factor is obtained as

   1 io                                        gm 1 - s gm cgd
   = =           =-                                             .                      (5.6)
   D ii vo=0                                   s cgs + cgd
168 BASIC AMPLIFICATION: CS STAGE

                                                  It has a right half plane zero at s = cgmgd , and a pole in the origin. In the
                                               saturation region the capacitance cgs is much larger than cgd. The unity-gain
                                               frequency T of the current gain is then obtained as

                                                                   T = gm cgs + c . gd                            (5.7)

                                               This frequency is called the cut-off frequency of the transistor.

                                               Input impedance

                                               Figure 5.14A and Figure 5.14B show the circuits for determination of the
                                               input impedance with open output and shorted output, respectively.

Figure 5.14: Left: Circuits for determination                 (1)                       (2)
of the input impedance of the biased CS

stage:                                            +                +

A. With open output

B. With shorted output.                           -                -

                                               A

                                                              (1)                       (2)

                                                  +                +                         -
                                                                                             +
                                                  -                -

                                               B

                                               The input impedance with open output can be obtained as

                                                              zi|io=0 = vi   = A,                                 (5.8)
                                                                          ii io=0 C

                                               which yields:

                                                  zi|io=0 =        1 + sro cgd + cds
                                                                             ro(cgscds+cgscgd+cdscgd) .           (5.9)

                                                              s cgs + (1 + gmro) cgd 1 + s cgs+(1+gmro)cgd

                                                  The poles equal those of the transimpedance factor. It can be shown that
                                               the zero is located between the two poles (see section 5.3.5). Thus, at frequen-
                                               cies below that of the zero, the input is capacitive. At frequencies between
                                               the frequency of the zero and the frequency of the second pole, the input
                                               impedance is resistive, and at frequencies above those of the second pole the
                                               input impedance is capacitive.

                                                  The input impedance with shorted output can be obtained as

                                                              zi|vo=0 = B =  1.                                   (5.10)
                                                                      D s cgs + cgd

                                                  It consists of the parallel connection of cgs and cgd. This input capacitance
                                               at shorted output is often referred to as ciss:

                                                                   ciss = cgs + cgd.                              (5.11)

                                               Output impedance

                                               Figure 5.15A and Figure 5.15B show the circuits for determination of the
                                               output impedance with shorted input and open input, respectively.

                                                  The output impedance with shorted input is obtained as the parallel con-
              (1)                                                (2)                        5.2. THE INTRINSIC CS STAGE 169
                                                                                         +
       +           +                                                                  -          Figure 5.15: Left: Circuits for determination
                                                                                                 of the output impedance of the biased CS
       -           -                                             (2)                             stage:
                                                                                         +
                                                                                      -               A. With shorted input
                                                                                                      B. With open input.

A

                               (1)
                                           +

                                      -

B

nection of ro and the output capacitance at shorted input coss:

                   zo|vi=0 = BA = ro 1 + srocoss ,                                          (5.12)
                                                                                            (5.13)
where

                                              coss = cgd + cds.

The output impedance with open input can be obtained as

                                              zo|ii=0 = DC ,                                (5.14)

which yields

       zo|ii=0 = ro cgs + cgd cgs + (1 + gmro) cgd           1.                             (5.15)
                                                    ro (cgs cds +cgs cgd +cds cgd )
                                                    1 + s cgs+(1+gmro)cgd

It consists of a parallel RC network with

                   R = ro                           cgd 1 ,                                 (5.16)
                                              1 + gmro cgs+cgd

and

                   C = cgscds + cgscgd + cdscgd .                                           (5.17)
                                  cgs + cgd

   If the transistor is operating in the saturation, and cgs  cgd, the output
resistance R with open input approximates

                                              R=      1                                     (5.18)
                                                    cgd 1 .
                                                  gm cgs + ro

Under these conditions, the output capacitance C approximates coss.

Conclusions

At this stage we may draw the following conclusions from the small-signal
analysis above:

1. Right half plane zeros

   (a) The four gain factors µ, ,  and  are inverting and have a right half
       plane zero.

   (b) This zero is the consequence of the inverting transconductance gm and
       the transfer through the gate-drain capacitance cgd.
170 BASIC AMPLIFICATION: CS STAGE

                                                      (c) If the transistor is operating in the saturation region the frequency of
                                                          this zero exceeds T and its influence on the magnitude characteristics
                                                          for frequencies below T can often be ignored.

                                                  2. Poles

                                                    (a) The voltage gain has one pole at s = - ro(cgd+cds 1 )
                                                      (b) The transadmittance factor can be considered instantaneous up to the

                                                          frequency of the right half plane zero.
                                                      (c) The transimpedance factor has two poles, of which one is found at

                                                       s = 0.
                                                    (d) The current gain has one pole at s = 0. The unity-gain frequency T

                                                          of the current gain factor is called the cut-off frequency of the transistor.

                                                  3. Input impedance

                                                      (a) The input impedance of a shorted CS stage is purely capacitive.
                                                      (b) The input impedance of a CS stage of which the output has been left

                                                          open has two poles. These poles equal those of the transimpedance
                                                          factor.

                                                  4. Output impedance

                                                      (a) The output impedance of a CS stage of which the input is left open
                                                          (current-driven) is resistive up to high frequencies. If the MOS transistor
                                                          operates in the saturation region, the output resistance of a current-
                                                          driven CS stage approximates 1/gm up to frequencies above T.

                                                      (b) The output impedance of a CS stage with shorted input consists of ro
                                                       in parallel with cds + cgd.

5.2.3 Large-signal dynamic behavior

In this section, we will briefly discuss some important aspects of the large
signal dynamic behavior of the intrinsic CS stage. We will only give a brief
summary because the large-signal behavior of a system cannot easily be an-
alyzed using simple hand calculations. Modeling of the nonlinear dynamic
behavior of a system requires the use of nonlinear differential equations. Such
equations can usually only be solved numerically. The transient analysis tech-
nique in spice can be used for this purpose.

   In some special cases it is possible to obtain clear design information for
the nonlinear dynamic behavior.

Slew rate limitation

Limitation of the rate of change of a voltage or current is called slew rate
limitation.

1. Voltage limiting across inductors causes current slew rate limitation.

If a voltage change across an inductor with inductance L is limited to

Vmax,  the  rate  of  change  of  the  current  dIL  through  that  inductor  is  limited
                                                dt
to Vmax .
L

· In section 5.2.1, we have studied voltage limiting mechanisms at the
   output of the CS stage.
                                                                                            5.2. THE INTRINSIC CS STAGE 171

2. Current limitation through capacitors causes voltage slew rate limitation.

If a current change through a capacitor with capacitance C is limited to

Imax,  the  rate  of  change  of  the  voltage            dVC  across  that  capacitor  is  limited
                                                           dt
to Imax .
C

· In section 5.2.1, we have studied current limiting mechanisms at the
   output port. Since the output source current is limited by the bias cur-
   rent IDSQ and the CS stage has a nonzero output capacitance we may
   expect slew rate limitation for rising output voltages.

· In section 5.2.2, we have seen that the input impedance of a CS stage
   has a pole at s = 0. For low frequencies the input port thus behaves
   capacitively. If such a stage is driven from a current source with limited
   drive capabilities, input voltage slew rate limitation will occur.

   In the following example we will determine the slew rate limitation of the
output voltage of the biased CS stage from Figure 5.4.

   Example 5.3

       In this example we will study the large-signal pulse response of the voltage
   transfer of the biased CS stage from Figure 5.4.

                VgsQ      M1           VdsQ
           (4) -      (1)
                                                 +   (3)                                    cross-talk through c_gd:
             +        +                                                                     right half plane zero
                                  (2)               -
       Vi -
                                                                   +

                                                          IdsQ Vo
                                                                  -

      Figure 5.16 shows the circuit. A square wave input voltage of ±100mV with                      Figure 5.16: Left: Circuit for determination
  a rise and fall time of 2ps and a period of 200ps has been applied to the input                    of the voltage pulse reponse of the biased
  of the biased CS stage. Both the input and the output voltage of the biased CS                     CS stage from Figure 5.4
  stage have been shown in the graph. The figure clearly shows that the rise time
  exceeds the fall time. This is because the current sinking capability of the biased                    Right: Input voltage and output voltage
  CS stage is larger than its current sourcing capability. The latter one is limited to              of the biased CS stage.
  the bias current of 10µA. This causes slew rate limitation. The graph also shows
  the effect of the right half plane zero caused by forward transfer through cgd. This
  transfer is caused by the coupling between the input and the output port. It is
  often referred to as crosstalk between input and output port. This crosstalk differs
  for positive output and negative output voltage. This is because when the output
  voltage is negative, the transistor operates in the linear region, while at positive
  output it operates in the saturation region. In the linear region cgd is larger than
  in the saturation region, while gm is smaller.

      The netlist of the circuit is:

1 CSbiased0_9V-10uAViVoPulse
2 * file: CSbiased0_9V-10uAViVoPulse
3 * Spice circuit file
4 .include CMOS18TT.lib
5 M1 2 1 0 0 C18nmos W=220n L=180n
6 VdsQ 2 3 0.9
7 IdsQ 0 3 10u
8 VgsQ 1 4 0.643.709
9 Vi 4 0 0 pulse(-100m 100m 20p 2p 2p 98p 200p)
172 BASIC AMPLIFICATION: CS STAGE

                                                               10 .tran 0 200p 0 0.2p
                                                               11 .end

                                              Operating point shift

                                              Even order nonlinearity gives rise to operating point shift. This effect can
                                              be observed in the graph shown in Figure 5.16: the mean value of the input
                                              voltage is zero, while the mean value of the output voltage is about 58mV.
                                              Since the properties of the CS stage strongly depend on its bias point, oper-
                                              ating point shift should be kept as small as possible. At a later stage we will
                                              introduce techniques for creating transfer functions with predominantly odd
                                              order nonlinearity.

                                              5.2.4 Noise behavior

                                              In this section, we will discuss the modeling of the noise behavior of the CS
                                              stage. The small-signal noise model of the MOS transistor has already been
                                              introduced in Figure 4.32. Figure 5.17 shows a simplified small-signal noise
                                              model for the CS stage. In this model, the source is assumed to carry no
                                              signal with respect to the bulk and the drain and source series resistances
                                              have been omitted. These simplifications are usually justified for taking early
                                              stage design decisions.

Figure 5.17: Small signal noise model of the      g                                                    d

intrinsic CS stage. +

                                                  s                                    -               s

                                                 A more design friendly model would be one that has the noise sources
                                              modeled at the input port of the CS stage. With such a model we can find
                                              design equations and show stopper values for the noise contribution of the
                                              CS stage to the total source-referred noise.

                                                 The equivalent input noise sources of the CS stage can be found by mul-
                                              tiplying the output noise current with the small-signal transmission parame-
                                              ters B and D of the CS stage (see Chapter 2). Multiplication with B yields a
                                              contribution to the equivalent input voltage noise, while multiplication with
                                              D yields a contribution to the equivalent input current noise. The transmis-
                                              sion parameters B and D of the intrinsic CS stage have been evaluated in
                                              section 5.2.2. If we ignore the influence of the right half plane zero in the
                                              transmission parameters, we may write

                                                                                          B=- 1 ,         (5.19)
                                                                                                   gm     (5.20)

                                                                                          D=- s .
                                                                                                   T

Figure 5.18: Small signal noise model of

the intrinsic CS stage with equivalent input  g-     +                                                 d

noise sources.                                                                            +

                                              s                                           -            s

                                                 The small-signal noise model with equivalent input noise sources is shown
                                              in Figure 5.18.
                                                                                                      5.2. THE INTRINSIC CS STAGE 173

   At a later stage, we will show that, if designed properly, the noise perfor-
mance of an amplifier of which the first stage is equipped with a CS stage
is determined by the noise contribution of this CS stage. If the amplifier is
a negative feedback amplifier, also the noise contributions of the feedback
elements as well as their influence on the noise contributions of the CS stage
to the source-referred noise have to be considered. Hence the noise perfor-
mance of an amplifier can be designed with the aid of a noise model of the
CS stage that comprises its equivalent input noise sources only.

SLiCAP MOS EKV noise model

Figure 5.19 shows a simplified EKV noise model. This model is available as a
SLiCAP sub-circuit. It can be used for determination of the device geometry
and the drain current of a MOS transistor for minimum noise contribution.

          Vn                                                              (ext)                            Figure 5.19: SLiCAP equivalent input noise
                                                                                                           sources of the CS stage.
(ext)                                                               + H1

                                                                    -

                                                                                                (int)
                                                                                                                                                                         +(int)
           +
                                                                                                                                                         -In
              -
                  (common)

                                                             F1

                                                                                   (common)

   Below netlist of the sub circuit NM18_noise that models the noise of an
NMOS in a typical CMOS18 process as a function of the device width W and
length L, the gate leakage current IG and the drain bias current ID. It can be
found in the SLiCAP library file SLiCAP.lib.

457 + c_pi = {tau_F*g_m + CJE}
458 + c_bc = {CJC*(1+((VCE-VBE)/VJC)^-MJC)} ; Divide by zero error if VBE-VCE=VJC
459 + VBE = {U_T*ln(IC/Is)}

460 * technology parameters (SI units)

461 + Is          = 1e-16

462 + VAF         = 50

463 + beta_AC = 100

464 + VJC         = 0.7

465 + MJC         = 0.33

466 + CJC         = 1p

467 + CJE         = 5p
468 + tau_F       = 1n

469 .ends

470                                                                                                                                                         out
471 .subckt NM18_noise ext comm int ID={ID} IG={IG} W={W} L={L}                                                       V1 + V
                                                                                                                     0- I
472 * intrinsic noise sources, gate resistance should be added externally
473 * CMOS18 N device: copy and modify this model for other devices                                                                 X1
474 I1 0 1 I value=0 noise={4*k*T/R_N*(1+(f_ell/f)^AF_N18)} ; channel noise                                                         NM18_noise
                                                                                                                                    ID={ID}
           current                                                                                                                  IG= 0
                                                                                                                                    W={W}
475 H1 ext int 1 10 {1/g_m}                          ; equivalent-input voltage                                                     L={L}

           noise                                                                                                .param W=220n L={W} ID=1u
                                                                                                                .include SLiCAP.lib
476 F1 ext comm 10 0 {s/2/pi/f_T}                    ; gate-induced noise
                                                                                                           Figure 5.20: SLiCAP test bench for determi-
477 I2 ext comm I value=0 noise={2*q*IG}             ; gate shot noise                                     nation of the input voltage noise of a MOS
478 .param                                                                                                 transistor. The circuit uses the subcircuit
                                                                                                           NM18_noise from the SLiCAP library.
    Lines 460 through 463 describe the netlist with circuit elements, lines                                3 Binkley, David M. Tradeoffs and Optimiza-
                                                                                                           tion in Analog CMOS Design. John Wiley &
465 through 477 list the EKV model noise equations. The CMOS 18 tech-                                      Sons Inc., 1997. ISBN: 978-0-470-03136-0

nology parameters and global constants are defined in the SLiCAP library

file SLiCAPmodels.lib. The device equations and the technology parameters

have been adapted from Binkley [Binkley2008]3. They have been discussed

in Chapter 4.

    Figure 5.20 shows a test bench for determination of the equivalent input

voltage noise of an NMOS according to this model. The effect of the channel

length on the corner frequency of the flicker noise can clearly be observed
                                                                    W,
by  maintaining     the    drain  current  and  the  aspect  ratio      while  sweeping                W.
                                                                    L
174 BASIC AMPLIFICATION: CS STAGE

The SLiCAP file for plotting the input voltage noise is listed below:

1 #!/usr/bin/env python3

2 # -*- coding: utf-8 -*-
3 """

4 N18noise.py

5 """

6 from SLiCAP import *
7 prj = initProject('N18noise');

8 makeNetlist('N18noise.asc', 'CS stage noise');

9 i1 = instruction();

10 i1.setCircuit('N18noise.cir')
11 #i1.defPar('AF_N18', 1)

12 htmlPage('Circuit data')

13 img2html('N18noise.svg', 500)

14 netlist2html('N18noise.cir')

15 elementData2html(i1.circuit)

16 params2html(i1.circuit)

17 i1.setSimType('numeric');

18 i1.setGainType('vi');

19 i1.setDataType('noise');

20 i1.setSource('V1');
21 i1.setDetector('V_out');

22 htmlPage('Voltage noise NMOS')
23 # Plot S_vi for ID=10uA, step W and L, while keeping W/L=1

24 i1.defPar('ID','10u')

25 i1.setStepVar('W')

26 i1.setStepMethod('list')

27 i1.setStepList([0.2e-6, 0.5e-6, 1e-6, 2e-6, 5e-6, 10e-6, 20e-6, 50e-6])

28 i1.stepOn()

29 noiseResult = i1.execute()

30 SvN18mos = plotSweep('SvN18mos', 'Svi V/rt(Hz) NMOS W/L=1 ID=10uA',

31                                          noiseResult, 10, 100e6, 200, funcType='inoise', show=True)

32 fig2html(SvN18mos, 800)
33 # Another method is to calculate S_vi(f, W), define it as a circuit parameter

34 # and plot this parameter.

35 # Calculate the function and define it as a circuit parameter

36 i1.delPar('W') # Delete the definition of W, this keeps it a symbolic variable

37 i1.stepOff() # Disable parameter stepping to obtain a single expression
38 inoise_f_W = sp.N(i1.execute().inoise) # calculate S_vi(f,W)
39 i1.defPar('Si_f_W', inoise_f_W) # define a circuit parameter for this function

40 i1.defPar('W', '1u') # Redefine the parameter W otherwise it cannot be

                                   stepped

41 i1.defPar('f', 1)                        # Define the parameter f otherwise it cannot be swept

42 i1.stepOn()                              # Enable parameter stepping

43 i1.setDataType('params')

44 result = i1.execute()
45 S_vi_f_W = plotSweep('S_vi_f_W', 'Svi V/rt(Hz) noise NMOS W/L=1 ID=10uA',

46                                          result, 10, 100e6, 200, funcType='param', axisType='log',

47                                          sweepVar='f', xUnits='Hz', yVar='Si_f_W', yUnits='$V^2/

                                            Hz$',

48                                          show=True)

49 fig2html(S_vi_f_W, 800)

50 # Plot f_T and f_l versus W for W/L=1 and ID=10uA (dataType = 'params')

51 i1.setDataType('params')

52 i1.stepOff()

53 result = i1.execute()
54 f_T_f_L = plotSweep('f_T_f_L', '$f_T,\, f_{\ell}, NMOS W/L=1 ID=10uA$', result

                                   ,

55                                          0.2e-6, 50e-6, 200, funcType='param', axisType='log',

56                                          sweepVar='W', xUnits='m', xScale='u',

57                                          yVar=['f_T_XU1', 'f_ell_XU1'], yScale='G', yUnits='Hz',

58                                          show=True)

59 fig2html(f_T_f_L, 800)

60 i1.delPar('f')                           # Remove the numeric definition of the frequency

61 # Plot S_vi for W = L = 50u while stepping ID

62 i1.defPar('W', '50u')

63 i1.setDataType('noise');

64 i1.setStepVar('ID')

65 i1.stepOn()

66 i1.setStepMethod('list')

67 i1.setStepList([10e-6, 20e-6, 50e-6, 100e-6, 1e-3, 2e-3, 5e-3])

68 i1.stepOn()

69 noiseResult = i1.execute()

70 SvN18mos50u = plotSweep('SvN18mos50u', 'Svi V/rt(Hz) noise W=50u', noiseResult

                                   ,

71                                          1, 1e6, 200, funcType='inoise', show=True)

72 fig2html(SvN18mos50u, 800)

    Figure 5.21 shows the simulation results.
5.2. THE INTRINSIC CS STAGE 175

     Figure 5.21: SLiCAP noise simulation
     results of a CMOS18 NMOS.
176 BASIC AMPLIFICATION: CS STAGE

                                             The upper figure shows the equivalent input voltage noise spectral density

                                             for a transistor operating at 10µA. The length and the width of this transistor

                                             are stepped simultaneously from 200nm to 50µm. By doing so both fT and

                                             f drop with increasing dimensions, as shown in the middle figure. The

                                             middle figure clearly shows the fixed ratio vetween fT and f, as derived
                                                                                                       W
                                             in (4.194).  Since  the  drain  current  and  the  ratio  L  are kept constant, the

                                             floor noise does not change, it is determined by gm and weakly depends on

                                             the inversion coefficient. The lower figure shows the way in which the floor

                                             noise depends on the current for a transistor that has W = L = 50µm. At

                                             high currents, gm the transconductance efficiency drops and an increase of

                                             the channel current does not result in a significant decrease of the floor noise.

                                             SLiCAP generic MOS and JFET noise model

                                             SLiCAP also has a noise model for a MOS transistor that operates in strong
                                             inversion in the saturation region. At a later stage we will see that this op-
                                             erating mode is preferred for low-noise operation at high frequencies. This
                                             model does not include effects due to VFMR and velocity saturation and can
                                             also be applied for JFETs. The listing of the sub circuit J_noise is shown
                                             below.

                                             1 + R_N      = {(1+IC)/(1/2 + 2/3*IC)/N_s_P18/g_m}

                                             2 + IC_CRIT = {1/((4*N_s_P18*U_T)*(Theta_P18+1/L/E_CRIT_P18))^2}
                                             3 + g_m      = {-ID/(N_s_P18*U_T*sqrt(IC*(1+IC/IC_CRIT)+0.5*sqrt(IC*(1+IC/IC_CRIT

                                             ))+1))}

                                              4 + c_gs    = {2/3*W*L*C_OX_P18 + CGSO_P18*W}
                                              5 + c_dg    = {CGSO_P18*W}
                                              6 + c_gb    = {CGBO_P18*2*L+(N_s_P18-1)/N_s_P18*C_OX_P18*W*L/3}
                                              7 + c_db    = {CJB0_P18*W*LDS_P18}
                                              8 + f_T     = {g_m/2/pi/c_iss}
                                              9 + c_iss   = {c_gs+c_dg+c_gb}
                                             10 + IC_i    = {-ID*L/W/I_0_P18} ; Initial estimate of inversion coefficient
                                                          = {IC_i*(1+IC_i/4/IC_CRIT)} ; Inversion coefficient corrected for
                                             11 + IC

                                             short-channel effects

                                             12 + f_ell = {3*KF_P18*g_m*(1+2*N_s_P18*U_T*sqrt(IC)/V_KF_P18)/(8*k*T*W*L*

                                                             N_s_P18*C_OX_P18^2)}

                                             13 .ends

                                             14
                                             15 .subckt J_noise ext comm int ID={ID} IG={IG} W={W} L={L}

                                             16 * simplified intrinsic noise sources, gate resistance should be added

                                             externally

                                             17 * MOS or JFET: copy and modify this model for other devices
                                             18 I1 0 1 I value=0 noise={8*k*T*g_m/3*(1+f_ell/f)}
                                                                                                       ; channel noise current

                                             5.3 Small-signal behavior of CS stage between
                                                    source and load

Figure 5.22: CS stage driven from a current            source                      intrinsic CS stage                    load
source with Rs Cs source impedance and                                (1)                                 (2)
loaded with R C.
                                                                                  +                                +

                                                                                -                                 -

                                                Now that we have studied the behavior of the intrinsic CS stage, we study
                                             the small-signal behavior of a CS stage placed between a source and a load.
                                             We will only consider source and load impedances that can be modeled as
                                             parallel RC networks. This is because such situations usually occur in prac-
                                             tice. However, the analysis methods used in this study can easily be applied
                        5.3. SMALL-SIGNAL BEHAVIOR OF CS STAGE BETWEEN SOURCE AND LOAD 177

for other types of source and load impedances.
   Figure 5.22 shows a CS stage driven from a current source with an RC type

source impedance and loaded with a parallel RC network. We will study the
transimpedance and the current gain of this stage.

                                                                                                  Figure 5.23: Simplified network from
                                                                                                  Figure 5.22.

                                    +                                      +

                                    -                                      -

   In order to obtain relatively simple expressions, we will combine the ele-
ments of the circuit as shown in Figure 5.23.

   The nodal equations for this network are

       Is    R1s + s(Cs + Cr)                       -sCr                   Vi V ,
       0=                                                                               (5.21)
                        gm - sCr            1   + s(C + Cr)
                                            R 

where

                                  C    =  Cs    +  cgs,                                 (5.22)
                                                                                        (5.23)
                                    s                                                   (5.24)

                                 C     =  C     +  cds,                                 (5.25)

                                   

                                  Cr = cgd,

                                 R =          Rro     .

                                          R + ro

5.3.1 Transimpedance

These equations can be solved to obtain the transimpedance Zt = Is V ; it is
found as

Zt =                                   -gm Rs R 1 - s gCrm
                                                                + s2Rs R Cs C + Cs Cr + C Cr .
                                                         
      1 + s CsRs + C R + Cr Rs + R + RsR gm                                           
                                                                                                

                                                                                        (5.26)

The transimpedance has one right-plane zero, which is caused by the

transfer through Cr. The two poles of the transimpedance can be found from

their product and their sum.

The product of the two poles is found from the coefficient of s2 in the

denominator of (5.26):

             p1 p2 =                            1               .                       (5.27)

                                                    
                              Rs R CsC + CsCr + CCr

   The sum of the two poles is found from the coefficient of s and from the
product of the poles:

           p1 + p2 = -  C    Rs  +  C   R   +   Cr  Rs       +  R   +  Rs  R   gm  .    (5.28)

                          s                                                  

                                                                    
                                 Rs R CsC + CsCr + CCr

We will study these expressions later.

5.3.2 Current gain

The current gain Ai of this CS stage can be obtained as

                        Ai = Zt = Zt 1 + sRC .                                          (5.29)
                                  Z                 R
178 BASIC AMPLIFICATION: CS STAGE

                                                    The current gain has a zero at s = - R 1C , at this complex frequency the
                                                  load impedance is infinite, hence no current can flow through it. The current
                                                  gain has the same poles as the transimpedance. This is because they are
                                                  determined with the same network.

                                               5.3.3 Qualitative description of the dynamic behavior

                                               In the previous sections, we have seen that the transimpedance and the cur-
                                               rent gain of a CS stage driven from and R C source and loaded with an R C
                                               load both have two poles. These poles are the solutions of the characteristic
                                               equation of the network from Figure 5.23. We will first discuss the dynamic
                                               behavior of the CS stage in a qualitative way. This helps us to find conditions
                                               for simplifying the characteristic equation and derive design conclusions. We
                                               will then elucidate these conclusions with the aid of some examples.

                                                  The small-signal dynamic behavior of the CS stage which is driven from
                                               and loaded with an R C network can easily be understood if Cr = 0. In this
                                               case the network consists of two current-driven R C networks that show no
                                               interaction. This network has two independent capacitor voltages and thus
                                               two poles. The poles of the network with Cr = 0 are

                                                                 p1 = -  1 , p2 = -   1 .                               (5.30)
                                                                 Rs Cs                   R C

                                               Since Cr = 0, the zero in the right half plane is not present.

                                               A non-zero value of Cr adds a right half plane zero to the transfer, but it

                                               does not add a pole because it introduces a loop of capacitors rather than an

                                               independent capacitor voltage. The presence of a non-zero capacitance Cr,

                                               however, does affect the positions of the two poles. The influence of Cr on
                                               the poles strongly depends on the low-frequency voltage gain VVi of the stage.

                                                  If the voltage gain of the stage is low, we have |V|  |Vi| and the CS stage

                                               can be considered shorted. In that case, the voltage across Cr approcimates
                                               Vi, hence, Cr appears to be in parallel with Cs . If the MOS is operating in the
                                               saturation region, we have cdg  cds and thus Cr  Cs , and the effect of Cr

                                               on the pole positions can usually be neglected.

                                               The situation becomes different if |V|  |Vi| and the CS stage cannot

                                               longer be considered as shorted. In this case the voltage across Cr amounts
                                               (1 - Av) Vi, where Av = VVi . At low frequencies the voltage gain Av can be
                                               approximated as:
                                                                 Av = -gm R
                                                                                                                        (5.31)

                                               The voltage across Cr causes a current ICr through it:

                                                                 ICr = Vi  1  +  gm  R   sCr .                          (5.32)

                                                                                       

                                               From this expression, it can be seen that it appears as if the voltage Vi
                                                                                                                            R
                                               causes a current through an input capacitor with capacitance Ci =  1  +  gm       Cr .
                                                                                                                              

                                               The increase of the input capacitance due to a non-zero value of Cr by a

4 John M. Miller. Dependence of the input      factor (1 - Av) is known as the Miller effect, named to its discoverer James
impedance of a three-electrode vacuum          Miller.[Miller1920]4
tube upon the load in the plate circuit.
Scientific Papers of the Bureau of Standards,  5.3.4 Quantitative description of the dynamic behavior
15(351):367-385, 1920
                                               We will now study the above effects in a quantitative way. We will first study
                                               the expression for the product of the poles in more detail. If Cr is small with
                                 5.3. SMALL-SIGNAL BEHAVIOR OF CS STAGE BETWEEN SOURCE AND LOAD 179

respect     to  both  C   and  and    Cs ,  expression       (5.27)  can    be  approximated           as

                        

                                      p1 p2 =    1 .                                                   (5.33)
                                                Rs RCsC

   Hence, under the above assumptions, the product of the poles does not

depend on Cr.
   Let us now study the influence of Cr on the sum of the poles as described

in (5.28).
   If Cr = 0 (5.28) changes to:

                                      C     Rs  +   C   R            1          1

                                        s                 
                        p1 + p2 = -                =-  -  .                                            (5.34)
                                          Rs RCsC                 RsCs RCs

    We then have two separate poles, one at s = - 1 R C and another at s =
                                                                            ss
      1
         ,  which   confirms     our  expectations          from  the   above   qualitative           descrip-
- R C
    s

tion.                                                                              C                   Cs ,

    If  Cr  is  larger  than  zero,   but   small      with  respect    to  both            and   and        the

sum of the poles can be approximated by

                                            1 1 Cr Rs R Rs+R + gm

                                                                                          
                        p1 + p2 = -  -   -                                    ,                        (5.35)
                                      RsCs RC C                             Cs

which can be written as                                                                                (5.36)
                         p1 + p2 = -  1 -   1 -   Cr 1 ,
                                           RsCs RC C RpCs

where                                 Rp = 1 11 .
                                              R + Rs + gm
                                                                                                       (5.37)
                                                      

    The last term of (5.36) shows that |p1 + p2| increases with Cr. Since the

product of the poles does not change with Cr, one pole must move to a

higher frequency while the other one moves to a lower frequency. This effect

is called pole-splitting by means of capacitive feedback. It occurs if the last term
                                                                                                  C          Cs .
in  (5.36)  dominates,        while   Cr    is  still   small  with   respect     to        both      and
                                                                                                    

Hence, if in (5.28)

                          Cr   Rs  +  R     +   Rs  R   gm     Cs Rs    +   C R .                      (5.38)

                                                                              

    If  Rs       1  the   above  condition      can     be  simplified      to
                gm

                                                                R C                                    (5.39)
                              Cr 1 + gm R > Cs 1 +   RsCs .

    If Rs   this condition changes to

                                      Cr    1   +   gm  R    > Cs .                                    (5.40)

                                                          

   This describes a situation in which, as a result of the Miller effect, the input
capacitance at low frequencies is predominantly determined by Cr.

   Pole-splitting can be used to manipulate the poles of a negative feedback
amplifier into their desired positions, without changing the bandwidth of the
amplifier. However, undesired pole-splitting in a negative feedback amplifier
may move one of the poles out of the dominant group, which reduces the
achievable bandwidth of the amplifier (see Chapter 12). At a later stage,
we will introduce techniques for removing undesired pole-splitting. Without
pole-splitting, a CS stage always contributes maximally to the loop gain poles
product in a negative feedback amplifier.
180 BASIC AMPLIFICATION: CS STAGE

                                              In the following example, we will investigate the presence of pole-splitting
                                           in a CS stage.

                                           Example 5.4

                                           Let us consider a CS stage which is driven from a current source with a source

                                           impedance that can be represented by a resistor of 100k in parallel with a capac-

                                           itor of 0.2pF. The source is loaded with a parallel RC network with a resistance of

                                           100k in parallel with a capacitance of 0.5pF. The small-signal parameters of the

                                           MOS in the operating point are: gm = 0.5mA/V, go = 20µA/V, cgs = 1.25fF,

                                           cgd = 0.3fF and cds = 0.2fF.

                                           We want to investigate whether pole-splitting occurs in this stage.

                                           The values of the components of the simplified equivalent circuit according to
                                                                                C                   R                  C
                                           Figure  5.23    are:  Rs  =  100k,        =  0.20125pF,      =   33.33k,        =     0.5002pF,
                                                                                  s                                      

                                           Cr = 0.3fF and gm = 0.5mA/V. Since gmRs  1 we may use expression 5.39 to

                                           determine whether pole-splitting occurs in this stage. We obtain

                                           Cr  1   +  gm   R     = 0.3 · 10-15   1 + 0.5 · 10-3 × 33.33 · 103          = 5.3fF.  (5.41)

                                                             

                                           Since      C    =     0.20125pF,  we  may    conclude  that  no  significant    pole-splitting

                                                        s

                                           occurs in this stage.

                                           In the following example we will check the above results with SLiCAP.

                                           Example 5.5

                                              Figure 5.24 shows the circuit file of the CS stage driven from and terminated
                                           with an RC network.

Figure 5.24: Circuit for demonstration of                        (1)                                           (2)
poles splitting with SLiCAP.                                                            M1 R2 C2 +

                                                           I1           C1 R1                                       -

                                                  The netlist of this circuit is listed below:

                                            1 mosPoleSplitting
                                            2 * SLiCAP netlist file
                                            3 I1 0 1 {I_s}
                                            4 C1 1 0 {C_s}
                                            5 R1 1 0 {R_s}
                                            6 R2 2 0 {R_ell}
                                            7 C2 2 0 {C_ell}
                                            8 .include C18.lib
                                            9 M1 2 1 0 0 M gm=0.5m cgs=1.25f cdg={c_dg} cdb=0.2f go=20u
                                           10 .param c_dg=0.3f I_s=1 C_s=0.2p R_s=100k R_ell=100k C_ell=0.5p
                                           11 .end

                                                  Lines 1 through 23 of the script mosPolesSplitting.py determine the sum
                                               of the poles for cdg = 0.3fF and cdg = 0.

                                            1 #!/usr/bin/env python3
                                            2 # -*- coding: utf-8 -*-
                                            3 """
                                            4 mosPoleSplitting.py
                                            5 """
                                            6 from SLiCAP import *
                                            7 prj = initProject('mosPoleSplitting')
                                            8 i1 = instruction()
                                            9 i1.setCircuit('mosPoleSplitting.cir')
                                           10 htmlPage('Circuit data')
                                           11 netlist2html('mosPoleSplitting.cir')
                                           12 elementData2html(i1.circuit)
                                           13 params2html(i1.circuit)
                                           14 i1.setSimType('numeric')
                                           15 i1.setSource('I1')
                                 5.3. SMALL-SIGNAL BEHAVIOR OF CS STAGE BETWEEN SOURCE AND LOAD 181

16 i1.setDetector('V_2')
17 i1.setGainType('gain')
18 i1.setDataType('poles')
19 htmlPage('Pole splitting in CS stage:')
20 result = i1.execute()
21 poles = result.poles
22 sp.symbols('p_1 p_2')
23 sumOfPoles = poles[0] + poles[1]
24 text2html('The sum of the poles in [rad/s] with $c_{dg}=300$fF equals:')
25 eqn2html('p_1+p_2', sumOfPoles)
26 i1.defPar('c_dg', 0);
27 result =i1. execute()
28 poles = result.poles
29 sumOfPoles = poles[0] + poles[1]
30 text2html('The sum of the poles in [rad/s] with $c_{dg}=0$ equals:')
31 eqn2html('p_1+p_2', sumOfPoles)
32 htmlPage('Pole splitting with $c_{dg}$')

       The results are displayed on the HTML page shown in Figure 5.25. They
    confirm our conclusion from the previous example: with cdg = 0.3fF we have no
    significant pole-splitting.

   In the next example, we will determine the value of a capacitor that needs        Figure 5.25: SLiCAP simulation results
to be placed in parallel with cgd to increase the sum of the poles by a factor 2.

Example 5.6

   The sum of the poles of the CS stage from the previous example can be calculated
using (5.34). We obtain

p1 + p2 = - 100 · 103 × 0.20125 · 10-12 1 - 33.33 · 103 × 0.5002 · 10-12 1 ,

= -1.096 7 · 108rad/s.                                 (5.42)

If we need to increase this by a factor two we require (see expressions (5.36)

and (5.37))

                      -   Cr 1 = -1.0967 · 108,        (5.43)
                        C RpCs

from which we obtain

Cr = 1.0967 · 108 × 0.20125 · 10-12 × 0.5002 · 10-12×  (5.44)
   × 1 1 33.33·103 + 100·103 + 500 · 10-6 1 ,          (5.45)
   = 20.44fF.

   Since cgd = 0.3fF, we need to place an external capacitance of 20.14fF in
parallel with cgd.
182 BASIC AMPLIFICATION: CS STAGE

                                                      In the following example, we will check these results with SLiCAP.

                                                 Example 5.7

                                                          The circuit and its netlist have already been shown in example 3.5.5.
                                                          Lines 33 - 38 of the script file mosPolesSplitting.py perform the calculation
                                                    of the sum of the poles with cdg = 20.44fF. Lines 39 through 46 create a root locus
                                                      plot with cdg stepping 0 to 50fF and display this plot on the HTML page.

                                                               33 i1.defPar('c_dg', 20.44e-15);
                                                               34 result = i1.execute();
                                                               35 poles = result.poles
                                                               36 sumOfPoles = poles[0] + poles[1]
                                                               37 text2html('The sum of the poles in [rad/s] with $c_{dg}=20.44$fF equals:')
                                                               38 eqn2html('p_1+p_2', sumOfPoles)
                                                               39 i1.setStepVar('c_dg')
                                                               40 i1.setStepStart(0)
                                                               41 i1.setStepStop('50f')
                                                               42 i1.setStepNum(100)
                                                               43 i1.setStepMethod('lin')
                                                               44 i1.stepOn()
                                                               45 figPZ = plotPZ('poleSplitting', 'Poles vs $c_{d_g}$', i1.execute(), show=True)
                                                               46 fig2html(figPZ, 500)

                                                          This page is shown in Figure 5.26. It shows that the sum of the poles with
                                                    cdg = 20.44fF is approximately two times the sum of the poles with cdg = 0. The
                                                      root locus plot shows the pole-splitting for increasing values of cdg.

Figure 5.26: SLiCAP simulation results

                                        5.3.5 Input impedance

                                        Knowledge of the input impedance of an RC loaded CS stage, is useful for
                                        the determination of the dynamic behavior of cascaded stages. If the input
                             5.3. SMALL-SIGNAL BEHAVIOR OF CS STAGE BETWEEN SOURCE AND LOAD 183

impedance of an RC loaded CS stage can be described by a parallel RC net-                                           (1)              (2)
work, then the poles of cascaded CS stages could be estimated as described                                + M1 I1        R2 C2
above.
                                                                                                          -
   In section 5.2.2 we have seen that the input impedance of a shorted CS
stage can be described by a parallel RC network. The input impedance of a                                 Figure 5.27: SLiCAP test circuit for detern-
non-shorted CS stage has two poles and one zero (see expression (5.9)). For                               imation of the input impedance of an RC
the circuit from Figure 5.27, this impedance can be written as                                            loaded CS stage.

     Zi =                            1  +  s  R   cgd   +  C

                                                                                                  (5.46)
                                      R(cgsC +cgscgd+C cgd) .
             s cgs + 1 + gmR cgd 1 + s                        cgs +(1+gm R )cgd  

Below the frequency of the zero and the second pole, the input impedance

is capacitive:

                  Zi = 1 =                                  1.                                    (5.47)
                             sCi,             cgs +        +            R
                                           s            1      gm           cgd
                                                                          

The low-frequency input capacitance Ci is found as

                             Ci = cgs +           1  +  gm  R        cgd.

                                                              

   This is the value predicted by the Miller effect. At high frequencies, the
character of the input impedance depends on the relative position of the pole
and the zero. We may write

                                        Zi = 1 1 + sz sC , i 1 + sp                               (5.48)

and  obtain  the  ratio  of  the  frequency       of  the   pole        and  the   zero  from  z  as
                                                                                               p

                  z =        R c gd  +  R C           cgs + cgd + gm Rcgd
                  p
                                                                                   .              (5.49)

                                  R     cgsC + cgscgd + C cgd

                                    

This can be written as

                  z = R 1 + cgd cgd + gm R(cgd + C .                                              (5.50)
                  p                  R        cgsC + cgscgd + C cgd

                                       

   From which we see that the zero always has a lower frequency than the
second pole. Hence, for frequencies between the frequency of the zero and
the frequency of the second pole the input impedance is resistive.

   Above the frequency of the second pole, the input impedance is capacitive.
The input capacitance Ch at those frequencies is found as

                                  Ch = cgs +            c gd C       .                            (5.51)

                                                      cgd + C

   Figure 5.28 shows the equivalent circuit for the input impedance of a CS                               Figure 5.28: Equivalent circuit of the the
                                                                                                          input impedance of an RC loaded CS stage.
stage. The left branch of this network is introduced by the Miller effect. The

value of the resistor in this branch follows from the frequency of the zero and
the capacitance cgdgmR.

   The circuit shows that the Miller effect can be ignored if the circuit is
shorted gmR  1.
184 BASIC AMPLIFICATION: CS STAGE

                                        5.3.6 Influence of the gate series resistance

                                                  Until now, we have assumed that the RC type source impedance can simply
                                                  be considered in parallel with the gate-source input of the intrinsic CS stage.
                                                  In fact, we neglected any effect due to the gate series resistance. The influence
                                                  of this resistance, however, cannot always be ignored. In CMOS processes
                                                  with poly silicon gates, the series resistance may be relatively large and its
                                                  influence on the dynamic behavior cannot always be ignored.

Figure 5.29: Equivalent network of the                      Signal source   Gate series Input impedance RC loaded CS stage
driving point impedance at the input of an                                  resistance
RC loaded CS stage with a nonzero gate
series resistance, and driven from an RC
source.

                                            The influence of the series gate resistance on the dynamic behavior of the

                                            RC driven and loaded CS stage can be studied by investigating the poles of

                                            the driving point impedance at the input of the CS stage. Figure 5.29 shows

                                            the circuit for evaluation of these poles.

                                            Until now, we studied the transimpedance and the current gain of the CS

                                            stage with Rg = 0. In this case the Rs and Cs are simply in parallel with Zi.

                                            First of all, the source capacitor does not introduce a new pole. Secondly, the
                                                                                                                      -1,
                                            dominant  pole  is  no  longer  found  at  s  =  0.  It  moves  to  s  =            where  Ct
                                                                                                                         Rs Ct
                                            is the total capacitance in parallel with Rs.

                                            If Rg > 0 the source capacitance is decoupled from the input capacitance.

                                            In this case we have three independent capacitor voltages and thus three

                                            poles. The exact influence of Rg depends on the values of all other circuit

                                            elements. However, since Rg introduces an attenuation between the source

                                            and the input of the CS stage it will be clear that its influence will somehow

                                            contribute to bandwidth reduction. Hence, for high-frequency applications

                                            we need to keep Rg as small as possible!

                                            For small values of Rg, a shorted CS stage and cgs  cgd, the value of p3

                                            can be estimated as:            p3  - Cs + cgs .
                                                                                      R g Cs c gs
                                                                                                                                (5.52)

                                               Hence, if Rg > gmCs Cs+cgs , the frequency of this pole is found below fT of
                                            the transistor. This gives a rough design criterion for Rg in high-frequency

                                            applications.

                                            5.4 Optimization of the noise performance of
                                                   a CS stage

                                            In this section, we will discuss the design of the noise performance of a CS
                                            stage. We will show that the noise contribution of a CS stage can often be
                                            reduced to an acceptable level by proper selection of the device geometry and
                                            the operating conditions. However, reduction or even minimization of the of
                                            the noise contribution is not without costs, and in some cases the associated
                                            cost factors, such as the device width and the operating current, may become
                                            unacceptably large.
                                               5.4. OPTIMIZATION OF THE NOISE PERFORMANCE OF A CS STAGE 185

   Determination of the optimum device geometry and operating conditions
is essential for evaluation of the feasibility of noise performance requirements
at an early stage of the design. If the noise performance cannot be met under
optimized conditions, it certainly cannot be met under sub-optimum condi-
tions.

5.4.1 Noise design considerations

The equivalent input noise model of the intrinsic CS stage has already been       5 In this case the noise performance versus
                                                                                  the current consumption.
shown in Figure 5.18. For a low noise contribution, both gm and fT need to
be as large as possible. This follows from (5.19) and (5.20). To achieve this,

the device needs to operate in the saturation region. Since for a given device

geometry, gm increases with the device current and fT is proportional with
gm and inversely proportional with ciss, we require the smallest possible de-
vice, operating at the highest possible level of inversion. However, above the

critical inversion coefficient ICCRIT, the transconductance gm does not signifi-
cantly increase with the inversion coefficient. Hence, increasing the inversion
level above ICCRIT, does not improve the performane-to-cost ratio.5 So, a
general design rule is to let the device operate around its critical inversion

coefficient and use the device width W as design parameter to optimize the

sum of the contributions of the equivalent input voltage noise source and the

equivalent input current noise source, for the specified source impedance.

   We will discuss the design of the noise contribution of a CS stage driven

from a resistive source and a capacitive source. The design method, however,

is not limited to specific source types.

5.4.2 Noise minimization for resistive source

Figure 5.30 shows the equivalent input noise model of a CS stage driven
from a voltage source with source resistance Rs. This model is equal to the
intrinsic model discussed in section 5.2.4, added with the resistive source and
its associated noise.

                   +  -                                                           Figure 5.30: Equivalent input noise model
                                                                                  of a CS stage driven from a resistive source.

   The voltage spectral density of the source-referred input noise can be ob-
tained after transformation of the current noise sources into voltage noise
sources. The spectral density SVn of the total source-referred (voltage) noise
is obtained as

    SVn = 4kTRs + 2qIG R2s + 4kTngm  1   2 f2        1 + f    [V2Hz-1].
                                       2 + Rs 2            f
                                     gm  fT

                                                              (5.53)

    We will investigate the noise optimization process for frequencies above f

and assume IG = 0. Under these conditions, equation (5.53) can be simplified

to                 4kTn                  2 f 2 2 -1

    SVn = 4kTRs +     gm  + 4kTRs ngm 2 [V Hz ].              (5.54)
                                                 fT
186 BASIC AMPLIFICATION: CS STAGE

                                              Qualitative description of the noise minimization

                                              Let us now study expression (5.54) in more detail and see if we can find
                                              means to minimize the noise contribution of the CS stage. If so, we can
                                              quickly estimate the feasibility of noise requirements. If the minimum noise
                                              contribution is too large we have a show stopper and either the specifications
                                              have to be relieved, or a different technology needs to be considered.

                                                 Expression (5.54) has an optimum for gm:

                                                           gm,opt = fT [AV-1].                                     (5.55)
                                                                       Rs f

                                                 This optimum depends on f which means that it depends on the frequency
                                              range over which the noise contribution should be minimized. This is elu-
                                              cidated in Figure 5.31. In this figure we assume that the device operates in
                                              strong inversion and that the effective gate source voltage is held constant
                                              while the channel width is varied. This implies that the transistor operates at
                                              a constant inversion coefficient and that gm is proportional with W.

Figure 5.31: Noise optimization process for                                                      increasing Width
a CS stage driven from a resistive source.
The contribution of the gate induced noise
to the total RMS noise over the frequency
range of interest is made equal to the
contribution of the equivalent input voltage
noise.

                                                           increasing Width

                                                           increasing Width

                                                           frequency range of interest

                                              When gm is below its optimum, the contribution of the frequency indepen-

                                              dent part, the second term in (5.54), to the total RMS noise over the frequency

                                              range of interest, dominates over the contribution of the third term in (5.54).

                                              The dominating part is thus the term Bin, usually referred to as the equiv-

                                              alent input voltage noise of the MOS. When gm is above its optimum, the

                                              contribution of the third term dominates over the second term. This term

                                              originates from Din, usually referred as the gate induced noise. Hence, mini-

                                              mization of the noise can be achieved if gm can be adjusted to its optimum

                                              value, without affecting n,  and fT. This can be done by adjusting the chan-

                                              nel width W of the MOS, while maintaining the effective gate-source voltage

                                              VGS,e f f . By doing so, the operating current, the transconductance factor gm

                                              and the total input capacitance ciss are proportional with the width, while the

                                              cut-off frequency fT maintains its value. By increasing the width, the corner

                                              frequency fc moves towards a lower value. This can be seen if we write (5.54)

                                              in the form  SVn = 4kT Rs + n                  f2
                                                                                   gm  1+ 2
                                                                                                 [V2Hz-1],         (5.56)
                                                                                             fc

                                              where the corner frequency fc equals

                                                           fc = 1                      1 + gmRs [Hz].              (5.57)
                                                                 2ciss Rs                     n

                                                 Since both ciss and gm are proportional with the width, fc is about inversely
                                              proportional with the square root of the width.

                                                 We will now derive the value of the best possible noise factor that can be
                                               5.4. OPTIMIZATION OF THE NOISE PERFORMANCE OF A CS STAGE 187

achieved with a CS stage when driven from a resistive source. This value
and the conditions under which it can be achieved, help us to give a quick
estimation of the feasibility of the noise performance of an amplifier driven
from a resistive source that should be realized in a MOS process.

Quantitative description of the noise minimization

From the above formulated noise design considerations we may already con-
clude that for a low noise addition the transistor should operate in the sat-
uration region and in strong inversion. Operation in strong inversion with
velocity saturation is not very effective because in this region gm does not
significantly increase with the inversion coefficient. Hence, a good starting
point is to let the device operate at IC = ICCRIT.

   The method for finding the best possible noise figure and the conditions
to achieve it is as follows:

1. Express gm in the process parameters, the operating conditions and in the
   geometry parameters W and L

2. Assume a brick wall (frequency) weighting function for the noise, and
   determine the optimum device with and the optimum noise figure as a
   function of the frequency range of interest

In the saturation region and at strong inversion without velocity satura-

tion, the transconductance gm is proportional with the effective gate-source

voltage Ve f f :

                     gm = W sqVe f f [S].                               (5.58)
                                 Ln

After substitution of (5.58) in (5.54) we obtain

SVn = 4kT         Rs + n2L           W                   f2  [V2Hz-1].
                         W sqVe f f  1 +  sqVe f f Rs 2                 (5.59)
                                     L                   fT

The mean square value v2n of the source-referred noise, over a frequency

range from fmin to fmax, is obtained after integration over this frequency

range:

                     v2n =            fmax SVnd f [V2].                 (5.60)

                                     fmin

   For a given value of Ve f f , the total source-referred noise has a minimum
value at W = Wopt. This can be seen from (5.59) which has a term that
is proportional with W and a term that is inversely proportional with W.

Notice that by changing W, while keeping the effective gate-source voltage

constant, the inversion coefficient does not change. Hence, the drain-source

current increases linearly with the device width.

   The optimum width can be found as the solution of W of

                                      d2                                (5.61)
                                         vn = 0.

                                     dW

   If we assume a uniform weighting function over a frequency range from
fmin to fmax, v2n can be calculated as

v2n = 4kTRs       1 + 1 n2L + fm3 ax - fm3 in     n22 Rs sqVe f f         [V2].
                       W sq RsVe f f fmax - fmin         2+       2W    (5.62)
                                                  3 fT       3L fT

A minimum value v2n  min             of the source-referred noise is obtained if
188 BASIC AMPLIFICATION: CS STAGE

W = Wopt. The optimum width is found when the coefficient of W and
the coefficient of W-1in 5.65 are equal. This yields

                                             2        3n2L2 f 2      fmax - fmin  2

                                                                  T
                                             Wopt = 2 2 2 3              3 [m ].               (5.63)
                                                    sq Rs Ve f f fmax - fmin

After substitution of

                                             fT =     3gm         = 2  3sqVe f f [Hz],         (5.64)

                                                             
                                                   4W LCOX L n4COX

we obtain                                                 

                                        Wopt =         33              3 3 fmax - fmin [m].    (5.65)
                                                                       fmax - fmin
                                                           
                                                    4LCOX Rs

   After substitution of (5.65) and (5.64) in (5.62), we obtain the minimum of
the mean square value of the total source-referred noise voltage v2n as:

                                                                                      2
                                                                       fm3 ax - fm3 in  [V2].
                                   v2n  =    4kTRs  1  +   n           fmax - fmin             (5.66)
                                                          
                                                               3 fT

   The best possible noise factor Fopt is obtained by dividing the total source-
referred noise by the contribution of the source resistance:

                                                                                    2          (5.67)
                                                                     fm3 ax - fm3 in  [-].
                                                           n         fmax - fmin
                                                 
                                        Fopt = 1 + 

                                                            3 fT

If fmax  fmin, we can simplify the expressions for Wopt to

                                                                        3 [m].

                                                  Wopt =  2 fmaxRs LCOX                        (5.68)

   The mean square value of the source-referred noise voltage under this
condition becomes

                                        v2n  min   = 4kTRs fmax           n fmax  2            (5.69)
                                                                     1+ 
                                                                                    [V2],
                                                                            fT 3

and the noise figure is obtained as

                                                Fmin =         n fmax    2                     (5.70)
                                                          1+ 
                                                                           [-].
                                                                  3 fT

This noise figure is achieved with the device operating in the saturation

region at strong inversion without velocity saturation and with the width of

the device designed such that:

                                                                                               (5.71)
                                                    ciss = 3 2 fmaxRs [F],

assuming

                                                               2       
                                                    ciss  W LCOX [F].                          (5.72)
                                                               3

In the following example, we will estimate the feasibility of the noise per-

formance of a resistively driven CS stage.

Example 5.8

   The voltage of a voltage source with an internal resistance of 600 needs to
be amplified. The information is contained in a frequency range from 1 · · · 5GHz.
                                     5.4. OPTIMIZATION OF THE NOISE PERFORMANCE OF A CS STAGE 189

    The noise figure of the amplifier should be less than 1dB. The amplifier should be
    realized in a 180nm CMOS process. The NMOS process characteristics are:

1. Technology current: I0 = 640nA

2. Critical inversion coefficient: ICCRIT = 31.7

3. Effective gate-source voltage at critical inversion: Ve f fCRIT = 393mV

4.  Normalized  oxide  capacitance:  C     =  0.0084Fm-2

                                       OX

5. Zero field carrier mobility: µ0 = 0.042

6. Substrate factor: n = 1.35

7. Noise constant:  = 0.7

    We will check if the required noise figure can be achieved with an NMOS CS

    stage.

    The minimum noise figure that can be achieved can be approximated by (5.67).

    Hence, we need to calculate fT. If we substitute (4.145) in the expression for fT
    (5.64) we obtain an expression for the cut-off frequency as function of the effective

    gate-source voltage:

                               fT = 2nL2 µ0Ve f f [Hz].                     (5.73)

       At IC = ICCRIT, and with L = 180nm this yields fT = 60GHz.
       With the aid of (5.67) and fmax = 5GHz we find the best possible noise figure
    at IC = ICCRIT: F = 1.104 which corresponds with 0.43dB. Hence, a noise

    figure of 1dB can be realized with an NMOS CS stage.

    However, the estimated value of the cut-off frequency is rather optimistic.

    This is because at IC = ICCRIT the effects of velocity saturation and vertical
    field mobility reduction are already noticeable, and fT will not be proportional
    with Ve f f . Although not very efficient, increasing the inversion coefficient to a
    level above ICCRIT may still yield a larger gm and a larger fT and thus reduce
    the noise. The increasing of gm and fT with the inversion coefficient ends if the
    velocity saturation and vertical mobility reduction become too strong, or if Ve f f
    exceeds Vds and the transistor does no longer operate in the saturation region.

   Realization of this noise figure is not free of costs. In the following example
we will determine the device width and the operating current of the NMOS
to achieve the optimum noise figure of 0.43dB over the frequency range of
interest driven from a source resistance of 600.

    Example 5.9

    According to (5.65) we require an optimum device width of: Wopt = 54.6µm.

    With the device operating at IC = ICCRIT we can determine the operating current

    IDS and obtain        IDS = I0 W ICCRIT = 6.15mA.
                                      L
                                                                            (5.74)

   In the next example, we will verify the above result with SLiCAP. We will
use the built-in EKV noise model and the model for gm according to (4.167).
This will result in a lower cut-off frequency then estimated in the previous
example and yields a larger noise figure.

    Example 5.10

       In this example we will verify the results of the previous examples with SL-
    iCAP. Below is the listing of the SLiCAP script file for determination of the
    source-referred noise spectrum, the total source-referred RMS noise and the noise
    figure versus the width at constant inversion coefficient.
190 BASIC AMPLIFICATION: CS STAGE

       In line 20, the parameter KF is set to zero, this sets the 1/ f noise to zero. The
    instructions in lines 22 through 27 set the drain current to a value at which the
    device operates at critical inversion. The instructions in lines 29 through 44 print
    the device width and the drain current at critical inversion on the html page with
    the circuit data.

1 #!/usr/bin/env python3

2 # -*- coding: utf-8 -*-

3 """

4 CSresnoise.py

5 """

6 from SLiCAP import *

7 prj = initProject('CS stage noise with resistive source')

8 fileName = 'CSresNoise'

9 i1 = instruction()

10 i1.setCircuit(fileName + '.cir')

11 htmlPage('Circuit data')

12 img2html(fileName + '.svg', 700)

13 netlist2html(fileName+'.cir')

14 # Set value of 1/f noise to zero, and I_D to critical inversion

15 i1.defPar('KF_N18', 0)

16 i1.setSimType('numeric')

17 I_D                             = i1.getParValue('ID')

18 IC                              = i1.getParValue('IC_X1')

19 IC_CRIT = i1.getParValue('IC_CRIT_X1')

20 I_D                             = I_D*IC_CRIT/IC

21 i1.defPar('ID', I_D)

22 # Print some important noise parameters to an HTML page

23 htmlPage('Operating point parameters')

24 R_N                             = i1.getParValue('R_N_X1')

25 R_s                             = i1.getParValue('R_s')

26 f_T                             = i1.getParValue('f_T_X1')

27 g_m                             = i1.getParValue('g_m_X1')

28 Width = i1.getParValue('W')

29 text2html('Device width:')

30 eqn2html('W', Width)

31 text2html('Dain current at critical inversion:')

32 eqn2html('I_D', I_D)

33 text2html('Effective noise resistance $R_N$:')

34 eqn2html('R_N', R_N)

35 text2html('Cut-off frequency $f_T$:')

36 eqn2html('f_T', f_T)

37 i1.setSource('V1')

38 i1.setDetector('V_out')

39 i1.setGainType('vi')

40 i1.setDataType('noise')

41 i1.setSimType('numeric')

42 noise_result = i1.execute()

       Figure 5.32 shows the page with the circuit data, and Figure 5.33 shows the
    page with the operating point information.

       Lines 43-45 of the script plot the spectral density of the source referred noise
    over a frequency range from 100MHz to 100GHz. Line 47 calculates the total
    RMS input noise over this frequency range, lines 49-51 the noise figure, and line
    53 estimates the corner frequency fc. The corner frequency can be estimated using
    expression (5.75) with the data from Figure 5.32.

                                   fh = fT 1 g = f mnRs T RN Rs                             (5.75)

    These obtained results are all shown on an HTML page (lines 54 until 62).

43 figInoise                       = plotSweep('Inoise', 'Source-referred noise spectrum',

44                                                   noise_result, 1e8, 1e11, 100, funcType = 'inoise',

45                                                   show=True)

46 # Calculate the noise figure at critical inversion and the given width

47 tot_inoise                      = rmsNoise(noise_result, 'inoise', 1e9, 5e9)

48 # Calculate the noise figure

49 tot_inoise_src = rmsNoise(noise_result, 'inoise', 1e9, 5e9,

50                                                   source = noise_result.source)

51 NF                              = 20*sp.log(tot_inoise/tot_inoise_src)/sp.log(10)

52 # Estimation of the corner frequency f_c:

53 f_c                             = f_T*sp.sqrt(R_N/R_s)

54 htmlPage("Noise analysis-1")
5.4. OPTIMIZATION OF THE NOISE PERFORMANCE OF A CS STAGE 191

                                                                          Figure 5.32: SLiCAP html page with the
                                                                          circuit data.

                                                                          Figure 5.33: SLiCAP html page with the
                                                                          operating point information.
192 BASIC AMPLIFICATION: CS STAGE

55 text2html("The figure below shows the spectrum of the source-referred " +

56                                    "voltage noise.")

57 fig2html(figInoise, 500)

58 text2html("The source-referred RMS noise voltage over this frequency range " +

59                                    "equals: %s [$\mu$V]."%(sp.N(1e6*tot_inoise, ini.disp)))

60 text2html("The noise figure equals: %s [dB]."%(sp.N(NF, ini.disp)))

61 text2html("The estimated conrner frequency $f_c$" +

62                                    ": %s [GHz]."%(sp.N(f_c*1e-9, ini.disp)))

        The output page with the plot is shown in Figure 5.34. It clearly shows the
     increase of the source-referred noise at high frequencies as a result of the gate-
     induced noise.

        The third part of the script (lines 63-118) calculates the width for the best noise
     figure (at critical inversion) and shows how do do this for different frequency
     ranges. Inline comments in this script file elucidate the way of working.

63 # Calculate the width W at which we will have the best noise performance.

64 W                                          = sp.Symbol('W') # 'W' in the Python environment

65 i1.circuit.delPar('W')                                # delete the numeric definition of the width

66 # We will keep the inversion coefficient at critical inversion, hence we scale

67 # the current with the width.
68 i1.defPar('ID', I_D*W/Width)
69 noise_w = i1.execute() # calculate the noise spectra as a function of W and f

70 # We now calculate the noise as a function of W over a frequency range

71 # 'fmin' to 'fmax':

72 f_min = sp.Symbol('f_min')

73 f_max = sp.Symbol('f_max')

74 rms_noise_w                                  = rmsNoise(noise_w, 'inoise', f_min, f_max)

75 rms_noise_w_source = rmsNoise(noise_w, 'inoise', f_min, f_max, noise_w.source)

76 # We now calculate the noise figure as a function of 'W', 'f_min' and 'f_max':

77 # Use the variance instead of the RMS value (simpler equation for later use)

78 NF_W                                         = (rms_noise_w/rms_noise_w_source)**2

79 # We now calculate the optimum width as a function of 'fmin' and 'fmax':

80 W_opt                                        = sp.solve(sp.diff(NF_W, W), W)

81 # The sympy solve function returns a list with solutions, we will print the

82 # positive one.

83 for w in W_opt:

84                                 w = sp.N(w.subs([(f_min, 1e9), (f_max, 5e9)]), ini.disp)

85                                 if w > 0:

86                                    W=w

87                                    print(W)

88 # Create a plot of the noise figure versus the with for different values of
89 # f_max and f_min = 1G

90 # Define the plot parameters, 'fw', 'W' and 'fmax'

91 i1.defPar('W', W)
92 i1.defPar('f_max', '10G')
93 # Define the noise figure as a function of f_max:
94 i1.defPar('NF', 10*sp.log(NF_W.subs([(f_min, 2e8)]))/sp.log(10))

95 # Define the step parameters
96 i1.setStepVar('f_max')

97 i1.setStepStart('2G')

98 i1.setStepStop('10G')

99 i1.setStepMethod('lin')

100 i1.setSimType('numeric')

101 i1.setStepNum(5)

102 i1.stepOn()

103 i1.setDataType('params')

104 result = i1.execute()

105 # Plot the function
106 fig_NF_W = plotSweep('NF_W', 'Noise Figure versus width, $f_{min}$ = 200MHz',

107                                             result, 10, 200, 50, sweepVar = 'W', sweepScale = 'u',

108                                             funcType = 'param', xUnits = 'm', yVar = 'NF',

109                                             yUnits = 'dB', show = True)

110 # Put it all on an HTML page

111 htmlPage("Noise analysis-2")

112 text2html("The lowest noise figure over a frequency range from 1GHz to 5GHz "

                                   +

113                                   "and at critical inversion is achieved at a width " +

114                                   "of: %s [um]"%(sp.N(W*1e6, ini.disp)))

115 text2html("The figure below shows the noise figure as a function of the " +

116                                   "width and at critical inversion for diferent values of the " +

117                                   "maximum frequency $f_{max}$, and $f_{min}$=200MHz.")

118 fig2html(fig_NF_W, 500)

                                   The results are shown in Figure 5.35.
5.4. OPTIMIZATION OF THE NOISE PERFORMANCE OF A CS STAGE 193

                                                                          Figure 5.34: SLiCAP html page with the
                                                                          plot of the spectrum of the source-referred
                                                                          noise.

                                                                          Figure 5.35: SLiCAP html page with the
                                                                          calculated and estimated values of the
                                                                          noise figure, the plot of the total noise and
                                                                          the noise figure versus the device widths
                                                                          and the calculated optimum width.
194 BASIC AMPLIFICATION: CS STAGE

Model inaccuracies
The following model inaccuracies have to be taken into account:

1.  In strong inversion the theoretical value of  is                             2.        In most cases it will be

                                                                                 3
    larger. This increases the value of the lowest possible noise figure.

2. In the above calculations and simulations, the effect of the right half plane
   zero of the current gain on the gate induced noise has been ignored. Above
   the frequency of the zero the gate induced noise will no longer increase
   with frequency but it will introduce a noise contribution correlated with
   the voltage Bin from Figure 5.30.

3.  We                             also  ignored  the  contribution  of  the  1  noise     and  the  noise  current
                                                                              f

    associated with the gate leakage current IG.

Conclusion
The following conclusion can be drawn:

                                   A CS stage driven from a resistive source has the lowest noise figure if it

    operates in the saturation region and in strong inversion with gm as large as
    possible and with its device width designed such that:

                                                                     3 3 fmax - fmin [F].                   (5.76)
                                                  ciss  3 2Rs        fmax - fmin

Spice simulation

In the following example, we will evaluate the optimum noise figure and
device width with spice and use the BSIM level 49 model of an NMOS fab-
ricated in a 180nm CMOS process.

   Example 5.11

       The LTspice netlist file with the instructions for plotting the source-referred
    noise spectrum and the noise factor as a function of the width is shown below.
    The netlist part can be used for other simulators, but the instruction section is for
    LTspice only.

 1 CS-resNoise
 2 * file: CS-resNoise.cir
 3 * LTspice circuit file
 4 .lib CMOS18TT.lib
 5 C1 1 0 1
 6 E1 2 0 1 0 1k
 7 V1 3 2 0
 8 R1 3 4 600
 9 M1 5 4 0 0 C18nmos L=180n W={W}
10 V2 5 6 0.9
11 R2 6 1 1meg
12 I1 0 6 {W*6.15m/54.6u}
13 .param W=54.6u
14 * instruction for plotting source referred noise spectrum
15 * over a frequency range from 100MHz to 100GHZ
16 ;.noise V(6) V1 DEC 25 0.1G 100G
17
18 * instruction for plotting the noise figure as a function of the width
19 .noise V(6) V1 lin 100 1G 5G
20 .step param W 10u 100u 1u
21 .meas NOISE totOnoise integ V(onoise) FROM 1G TO 5G
22 .meas NOISE totR1noise integ V(R1) FROM 1G to 5G
23 .meas NOISE noiseFig PARAM 20*log10(totOnoise/totR1noise)
24 .end
                                          5.4. OPTIMIZATION OF THE NOISE PERFORMANCE OF A CS STAGE 195

                                                                     +      R2                       Figure 5.36: spice simulation circuit for
                                     +                                     (6)
                                 V1       R1        (5)                 -                            determination of the optimum width at
                        (2) -                  (4)          V2                 I1                    IC = ICCRIT for minimization of the source
                                                                                                     referred noise.

          (1)   ++                   (3)
        C1
                E1

                --

                                                    M1

   Figure 5.36 shows the corresponding circuit. The transistor operates in the
saturation region, at critical inversion: IC = ICCRIT.

   The simulated source-referred spectrum and the noise figure versus the width
are shown in Figure 5.37.

   These results are obtained with SIMetrix. The noise spectrum shows the
influence of the right half-plane zero. This zero was not included in the SLiCAP
simulation model nor in the hand calculations above. The lowest noise figure of
about 0.71dB is found at a width of about 42µm. This optimum width is less
than predicted by the hand calculations and by SLiCAP. This is the result of
differences between the capacitance models used in both simulators. The noise
figure is slightly higher than predicted by SLiCAP. LTspice gives a minimum
noise figure of 0.64dB at a width of 45µm.

                                                                                                     Figure 5.37: SIMetrix noise simulation
                                                                                                     results.

5.4.3 Noise minimization for capacitive voltage source

Figure 5.38 shows the equivalent input noise model of a MOSFET which is

driven from a capacitive voltage source. The signal source itself is noise free

because there is no thermal noise associated with a capacitor.
                     1
If  we  ignore  the  f  noise  and   the  shot  noise  associated          with  the  gate  leakage

current, the spectrum Svn of the source-referred noise can be obtained after

transformation of DSid into a source-referred voltage. This yields

                        Svn = B + D 1           2                                           (5.77)
                                          jCs
                                                 Sid [V2Hz-1].
196 BASIC AMPLIFICATION: CS STAGE                              +     -

Figure 5.38: Equivalent input noise model
of a CS stage driven from a capacitive
voltage source.

    After substitution of B = - gm , D = - c                      1         j     and Sid  = 4kTngm, the source-

referred noise spectrum can be written as                                   iss

                                                  Svn = 4kTn            1 + ciss  2                       (5.78)
                                                             gm               Cs
                                                                                    [V2Hz-1].

   Similar as in the case with the resistive source, both gm and ciss can be
written as a function of the device width. After substitution of (5.58) and

(5.72) in (5.78) we obtain

                                           Svn = 4kTLn2                 1 + W LCO X  2                    (5.79)
                                                   W sqVe f f                    Cs
                                                                                       [V2Hz-1].

    This expression can be expanded to

                                           Svn = 4kTLn2        1        LC        W L2C2       [V2Hz-1].
                                                     sqVe f f     + 2 OX +                OX              (5.80)

                                                               W        Cs           Cs2

    This spectrum does not depend on frequency and it has a minimum if

                                                                  W 2 L2 C2                               (5.81)
                                                                           OX = 1.

                                                                      Cs2

    If we use the approximation for ciss given in (5.72), this condition is equiv-

alent to:

                                                                     ciss = Cs.                           (5.82)

    The value of the noise spectrum at this optimum device width is then

found as                                                       Svn = 16kTn [V2Hz-1].
                                                                           gm
                                                                                                          (5.83)

   In the following example we will evaluate the feasibility of a low-noise CS
stage that is driven from a capacitive voltage source.

    Example 5.12

       The voltage of a capacitive voltage source with an internal capacitance Cs of
    100fF needs to be amplified. The information is contained in a frequency range
    from 100MHz· · · 1GHz.The spectral density of the source-referred noise voltage
    should be less than 5nV/ Hz. The amplifier should be realized in a 180nm CMOS

    process. The NMOS process characteristics are:

1. Technology current: I0 = 640nA

2. Critical inversion coefficient: ICCRIT = 31.7

3. Effective gate-source voltage at critical inversion: Ve f fCRIT = 393mV

4.  Normalized                             oxide  capacitance:    C     =  0.0084Fm-2

                                                                    OX

5. Zero field carrier mobility: µ0 = 0.042
                                     5.4. OPTIMIZATION OF THE NOISE PERFORMANCE OF A CS STAGE 197

6. Substrate factor: n = 1.35

7. Noise constant:  = 0.7

       We will check if the required noise performance can be met with an NMOS CS

    stage.

       The best possible noise performance of a capacitively driven CS stage is achieved
    if ciss = Cs. In this process, and at minimum device length (L = 180nm) this
    requires a device width W of about

                           Cs        0.1 × 10-12
                  W=  =                           = 66µm.                 (5.84)
                                          -9
                        LCOX 180 × 10 × 0.0084

       If we operate the CS stage in strong inversion and in the saturation region, we
    may calculate gm as

    gm = W µ0CO XVe f f = 66 0.042 × 0.0084 × 0.393 = 38 × 10-3 S.        (5.85)
           L      n            0.18       1.35

       This value will probably be too large because at IC = ICCRIT the transcon-
    ductance gm will no longer be proportional with Ve f f .

       With the estimated value of gm, the spectral density of the source-referred volt-
    age noise at optimum width and IC = ICCRIT equals

    Svn =  16 × 1.38 × 10-23 × 300 × 1.35 × 0.7                -18 2 -1
                                                 = 1.65 × 10 V Hz .       (5.86)
                        38 × 10  -3

                                             
       Which is equivalent with 1.3nV/ Hz. Hence, a source-referred noise spectrum
    of 5nV/ Hz seems to be feasible.

    The operating current IDS required for optimum noise performance can be

    found from the technology current, the inversion coefficient and the device geom-

    etry

              IDS,opt = 640 × 10-9 × 66 × 31.7 = 7.44mA.                  (5.87)
                                             0.18

   In the next example, we will verify the above results with SLiCAP. We
expect to find a lower value of gm as well as a different value of W because
of a more accurate estimation of ciss.

   Example 5.13

       Below is the script for the verification of the results from the previous example.
       Lines 1-21 check the circuit and list the most relevant operating point parame-
   ters on the output page.
       Lines 22-38 calculate the source-referred noise spectrum and the RMS value
   of the total source-referred voltage noise, and plot of the spectral density of the
   source-referred noise. Figures 5.39 shows the HTML output.

1 #!/usr/bin/env python3

2 # -*- coding: utf-8 -*-

3 """

4 CScapNoiseV.py

5 """

6 from SLiCAP import *

7 prj = initProject('CScapNoiseV')

8 i1 = instruction()

9 i1.setCircuit('CScapNoiseV.cir')

10 # create an html page for the results

11 htmlPage('Noise analysis')

12 img2html('CScapNoiseV.svg', 300)

13 # Discard 1/f noise

14 i1.defPar('KF_N18', 0)

15 # print important operating point parameters

16 text2html('The inversion coefficient $IC$ equals: ' +

17            '%s'%(sp.N(i1.getParValue('IC_X1'), ini.disp)))

18 text2html('The critical inversion coefficient $IC_{CRIT}$ equals: ' +
198 BASIC AMPLIFICATION: CS STAGE

19                                 '%s'%(sp.N(i1.getParValue('IC_CRIT_X1'), ini.disp)))

20 text2html('The transconductance $g_m$ equals: ' +

21                                 '%s'%(sp.N(i1.getParValue('g_m_X1'), ini.disp)))

22 # calculate source referred noise spectrum

23 i1.setSource('V1')

24 i1.setDetector('V_out')

25 i1.setGainType('vi')

26 i1.setDataType('Noise')

27 i1.setSimType('numeric')

28 noiseResult = i1.execute()

29 head2html('Source referred noise')

30 iNoise = sp.sqrt(noiseResult.inoise)

31 text2html('The spectrum of the source-referred voltage noise [V/rt(Hz)] ' +

32                                 'is: %s'%(sp.N(iNoise, ini.disp)))

33 text2html('The plot below shows the source-referred noise spectrum ' +

34                                 'from 100MHz to 100GHz; as expected, it does not depend on ' +

35                                 'the frequency.');

36 figSin = plotSweep('CScapNoiseVspectrum','Input noise spectrum', noiseResult,

37                                            1e8, 1e11, 100, funcType='inoise', show = True)

38 fig2html(figSin, 500)

       The next part of the script calculates the optimum width at IC = ICCRIT.
    To this end, we need to delete the numeric definition of W given in the .param

    statement of the circuit definition. This is done in line 43. In order to operate at
    IC = ICCRIT for all values of W we let IDS track with W by defining IDS =
    W 66×10-6 7.44 × 10-3 in line 45.

       If we now calculate the input noise spectrum it will consists sum of three terms:

1. A constant
2. A term proportional with W
3. A term inversely proportional with W

       see (5.80).

       This equation has a unique solution for W. The optimum values of W, IDS and
    gm are calculated and displayed on the output page by the instructions in lines
    39-65. Lines 66-79 determine theRMS value of the source-referred input noise as

    a function of the device width. Figure 5.40 shows the results.

       As expected, the results deviate from our estimations:

1. The input capacitance ciss equals the source capacitance Cs at a smaller width.
   This is because we ignored the overlap capacitance in both cgs and cdg.

2. Because we operate at IC = ICCRIT, the operating current will be lower at a
   smaller width. This also reduces gm.

3. At IC = ICCRIT the transconductance is no longer proportional with Ve f f . With
   results in an even smaller value for gm.

       These deviations result in a larger value of the source-referred noise, although
    it appears that 5nV/ Hz is still feasible.

39 # Find the width for the lowest noise

40 htmlPage('Noise performance optimization')

41 # Delete the numeric definition of W so we can calculate the optimum value

42 # symbolically

43 i1.delPar('W')

44 # Keep IC at IC_CRIT

45 i1.defPar('ID', '7.44m*W/66u');
46 Svi_f_W = i1.execute().inoise

47 W = sp.Symbol('W')

48 # Find optimum value of W

49 W_opt = sp.solve(sp.diff(Svi_f_W, W), W)

50 for w in W_opt:

51                                 if w > 0:

52                                 i1.defPar('W', w)

53                                 print(w)

54 text2html('The optimum device width $W_{opt}$ is found as: ' +

55                                 '%s'%(sp.N(i1.getParValue('W'), ini.disp)) + ' [m].')
                             5.4. OPTIMIZATION OF THE NOISE PERFORMANCE OF A CS STAGE 199

56 text2html('At this width we have in input capacitance $c_{iss}$ of: ' +

57  '%s'%(sp.N(i1.getParValue('c_iss_X1'), ini.disp)) + ' [F],')

58 text2html('a drain current $I_{DS}$ of: %s'%(sp.N(i1.getParValue('ID'),

59  ini.disp)) + ' [A],')

60 text2html('and a transadmittance $g_m$ of: %s'%(sp.N(i1.getParValue('g_m_X1'),

61  ini.disp)) + ' [S]')

62 text2html('The plot below shows the total source referred noise over a ' +

63  'frequency range from 0.1GHZ to 1GHz as a function of the ' +

64  'device width, with the inversion coefficient held constant at ' +

65  '$IC_{CRIT}$.')

66 f_max = 1e9

67 f_min = 1e8

68 B = f_max-f_min

69 i1.defPar('Vni', sp.sqrt(Svi_f_W*B))

70 # Redefine the width so it can be used as sweep variable, any value is K

71 i1.defPar('W', 0)

72 i1.setDataType('params')

73 result = i1.execute()

74 fig_Vni_W = plotSweep('Vni_W', 'Source-referred noise voltage versus ' +

75                        'width: 0.1GHz-1GHz',

76                    result, 10, 200, 200, sweepVar = 'W', sweepScale = 'u',

77                    funcType = 'param', xUnits = 'm', yVar = 'Vni',

78                    yUnits = 'V', yScale='u', show = True)

79 fig2html(fig_Vni_W, 500)

                                                                                   Figure 5.39: SLiCAP simulation results,
                                                                                   page 1.
200 BASIC AMPLIFICATION: CS STAGE

Figure 5.40: SLiCAP simulation results,
page 2.

                                         Model inaccuracies

                                         1. Model inaccuracies are identical as those mentioned with the resistive
                                            source. The right half plane zero in the current gain causes a change in
                                            the frequency spectrum of the source-referred voltage noise. In this case it
                                            gives it a low-pass character.

                                         2.  The contributions of the  1  noise and the noise current associated with the
                                                                       f

                                             gate leakage current IG have been ignored.

                                         Conclusion
                                         The following conclusion can be drawn:

                                                 A CS stage driven from a capacitive voltage source, has the lowest noise fig-

                                             ure if it operates in the saturation region and in strong inversion with gm as large
                                             as possible and with its device width designed such that: ciss  Cs. The spectral
                                             density of the total source-referred noise voltage can then be approximated by

                                             (5.83).

                                         5.4.4 Noise minimization for capacitive current source

                                         Figure 5.41 shows a setup in which an electrical signal is generated by a
                                         capacitive current source.

                                            In order to determine the source-referred signal to noise ratio, the voltage
                                         source Bid needs to be converted into a current source. The spectral density
                                         Sin of the total source-referred current noise in is obtained as

                                                             Sin = |BjCs + D|2 Sid [A2Hz-1].  (5.88)
                             +     -  5.4. OPTIMIZATION OF THE NOISE PERFORMANCE OF A CS STAGE 201

                                                                                                                Figure 5.41: Equivalent input noise model
                                                                                                                of a CS stage driven from a capacitive
                                                                                                                current source.

    After substitution of B = - g1m , D = - jgciss m and Sid = 4kTngm, this can

be written as     S 16kTn2 f 2 in = (Cs + ciss)2 [A2Hz-1].
                                 gm
                                                                            (5.89)

   The mean square value i2n of the source-referred current noise is obtained
after integration of this spectrum over the frequency range of interest, say

fmin · · · fmax:

    i2n =  fmax S 16kTn2 (C ind f = s + ciss)2         3    -   3    [A2].  (5.90)
           fmin                    3gm
                                                      fmax     fmin

   Similar as in the previous cases, both gm and ciss can be written as a func-
tion of the device width W.

   Substitution of (5.58) and (5.72) in (5.90) yields

2 16kTn2L2           3        3       C2s                      2 2   [A2]. (5.91)
in =                      -                + 2LCOXCs + W L COX
                    fmax     fmin     W
         3sqVe f f

    Hence, the mean square value of the total source-referred current noise

has a minimum value if          W 2 L2 C2
                                         OX = 1.
                                                                            (5.92)
                                    Cs2

    If we use the approximation for ciss from (5.72) this condition is equivalent

to

                                   ciss = Cs.                               (5.93)

   The minimum of the mean square value of the source-referred current
noise is found after substitution of the optimum width in (5.91):

                    2 64kTn2Cs2             3    -     3    [A2].           (5.94)
                    in =
                                           fmax       fmin
                                3gm

    At this optimum width the spectral density of the source-referred noise

equals

                    S 64kTn2 f 2C in = s2 [A2Hz-1].                         (5.95)
                                    gm

   In the following example, we will evaluate the feasibility of a low-noise CS
stage driven from a capacitive current source.

    Example 5.14

       The current of a capacitive current source with an internal capacitance Cs of
    100fF needs to be converted into a voltage. The information is contained in a
    frequency range from 100MHz· · · 1GHz. The RMS value of the source-referred
    noise current over the frequency range of interest should be less than 50nA. The
    amplifier should be realized in a 180nm CMOS process. The NMOS process
    characteristics are:

1. Technology current: I0 = 640nA
202 BASIC AMPLIFICATION: CS STAGE

2. Critical inversion coefficient: ICCRIT = 31.7

3. Effective gate-source voltage at critical inversion: Ve f fCRIT = 393mV

4.  Normalized                          oxide    capacitance:     C     =  0.0084Fm-2

                                                                    OX

5. Zero field carrier mobility: µ0 = 0.042

6. Substrate factor: n = 1.35

7. Noise constant:  = 0.7

       We will check if the required noise performance can be met with an NMOS CS
    stage.

       The width and the operating current for optimum noise can be taken from the
    previous example. With SLiCAP we found: Wopt = 57.4µm and with IC =
    ICCRIT the operating current should equal 6.47mA. The transconductance in this
    operating point equals 22.46 × 10-3AV-1.

       With the aid of (5.94) we find

                                                              i2n = 4.1 × 10-16 A2.                                (5.96)

       Hence, the RMS value of the total source-referred current noise equals 20.3nA
    and we may conclude that the required noise performance seems feasible.

    In the following example we will check the above result with SLiCAP.
                                                                               2
Since                              the  default  value  of    in  SLiCAP   is  3  the  result  will  be  slightly  less  than

predicted by (5.96).

    Example 5.15

       The listing of the script for the determination of the spectrum and the RMS
    value of the total source-referred noise is shown below:

1 #!/usr/bin/env python3

2 # -*- coding: utf-8 -*-

3 """

4 CScapNoiseI.py

5 """

6 from SLiCAP import *

7 prj = initProject('CScapNoiseI')

8 i1 = instruction()

9 i1.setCircuit('CScapNoiseI.cir')

10 htmlPage('Noise analysis')

11 img2html('CScapNoiseI.svg', 300)

12 # Discard 1/f noise

13 i1.defPar('KF_N18', 0)

14 i1.setSource('I1')

15 i1.setDetector('V_out')

16 i1.setGainType('vi')

17 i1.setDataType('noise')

18 i1.setSimType('numeric')

19 noiseResult = i1.execute()

20 head2html('Source referred noise');

21 text2html('The figure below shows the source referred noise spectrum ' +

22                                      'from 100MHz to 100GHz for $W=W_{opt}$ and at $IC=IC_{CRIT}$.')

23 figSin = plotSweep('CScapNoiseIspectrum', 'Input noise spectrum',

24                                               noiseResult, 1e8, 1e11, 100, funcType='inoise', show=True)

25 fig2html(figSin, 500)

26 IniRMS = rmsNoise(noiseResult, 'inoise', 100e6, 1e9);

27 text2html('The total source referred RMS current noise $i_{ni}$ amounts: ' +

28                                      '%s [A]'%(sp.N(IniRMS, ini.disp)))

                                   Figure 5.42 shows the results of the SLiCAP simulation. They are as expected.
                                 5.4. OPTIMIZATION OF THE NOISE PERFORMANCE OF A CS STAGE 203

                                                                                         Figure 5.42: SLiCAP simulation results.

Model inaccuracies

1. Model inaccuracies are identical as those mentioned with the resistive
   source. The right half plane zero in the current gain causes a change in
   the frequency spectrum of the source-referred voltage noise. In this case it
   adds a frequency independent part (noise floor) to the spectrum.

2.  The contributions of the  1  noise and the noise current associated with the
                              f

    gate leakage current IG have been ignored.

Conclusion
The following conclusion can be drawn:

        A CS stage driven from a capacitive current source has the lowest noise figure

    if it operates in the saturation region and in strong inversion with gm as large as
    possible and with its device width designed such that: ciss  Cs. The spectral
    density of the total source-referred noise voltage can then be approximated by

    (5.95). The mean square value over a uniformly weighted frequency range from

    fmin · · · fmax is given by (5.83).
204 BASIC AMPLIFICATION: CS STAGE

                                 5.5 Conclusions

                                                  In the previous sections, we investigated the criteria to achieve optimum
                                                  noise performance with a CS stage for resistive and capacitive sources. We
                                                  have seen that in general a low noise contribution comes at the cost of area
                                                  and current consumption. For the lowest noise contribution, the CS stage
                                                  should operate in the saturation region in strong inversion and with its op-
                                                  timum device width. However, such operation is not always required nor
                                                  desired. If the noise addition of a CS stage can be designed well above its
                                                  lower limit, both the costs for area and for current consumption can be re-
                                                  duced.

                                                      In general, the noise design proceeds as follows:

                                                  1. Check if the requirements are feasible as this has been done in the ex-
                                                      amples. If the requirements are not feasible, the noise requirement spec-
                                                      ification imposes a show stopper on the design and either it needs to be
                                                      relieved or another CMOS process with better performance parameters
                                                      should be selected.

                                                  2. If the noise requirements can easily be met, reduce the current and the
                                                      device width in such a way that the noise requirements are met at lower
                                                      cost factors, while some reserve has been built in for device tolerances and
                                                      model inaccuracies.
                                                                205

6Balancing techniques

6.1 Introduction                                           206

6.1.1 Additive compensation                                206

6.1.2 Balancing                                            206

6.1.3 Multiplicative or cascaded compensation              207

6.1.4 Odd function synthesis                               207

6.1.5 This chapter                                         208

6.2 Balancing of two-terminal devices                      208

6.2.1 Anti-series and complementary-series connection      209

6.2.2 Anti-parallel and complementary-parallel connection  213

6.3 Balancing of two-ports                                 216

6.3.1 Balanced two-port configurations                     216

6.3.2 Design of complementary two-ports                    217

6.4 Balanced CE and CS stages                              218

6.4.1 Anti-series stages                                   218

6.4.2 Anti-series CS stage                                 220

6.4.3 Complementary-parallel stages                        223

6.4.4 Complementary-parallel CS stage                      224

6.5 Conclusions                                            228
206 BALANCING TECHNIQUES

                                 6.1 Introduction

                                                  In Chapter 5, we have seen that a CS stage operating in the saturation re-
                                                  gion can provide a large available power gain. We have also seen that the
                                                  source-to-load transfer of a CS stage suffers from noise addition, nonlinear-
                                                  ity and bandwidth limitation. In addition, we learned that a single CS stage
                                                  shares one terminal of the input port with one terminal of the output port.
                                                  Hence, such an amplifier stage cannot provide port isolation without using
                                                  transformers. In this chapter, we will discuss the use of balancing techniques.
                                                  These techniques can be applied for improvement of the port isolation and
                                                  for reduction of reproducible errors due to offset and nonlinearity.

Figure 6.1: Principle of additive compensa-  6.1.1 Additive compensation
tion.
                                             Balancing is a form of additive compensation. We will speak of additive
                                             compensation if an undesired effect is compensated by adding an opposite
                                             effect. Additive compensation can be used to compensate for reproducible
                                             errors.

                                                                                                                           +
                                                                                                                         -

                                                The principle of additive compensation is elucidated in Figure 6.1. A
                                             known error signal (t) which equals the error caused by the nonideal be-
                                             havior of an amplifier with small-signal gain A, is subtracted from the out-
                                             put signal of the amplifier. The resulting output signal is the amplified signal:
                                             y(t) = Ax(t).

                                        6.1.2 Balancing

                                                  Balancing is a technique in which anti-series, complementary series, anti par-
                                                  allel and complementary-parallel connections of amplifier stages are used to
                                                  obtain such compensating effects. Parallel connections are used to add or
                                                  subtract currents, while series connections are used to add or subtract volt-
                                                  ages.

Figure 6.2: Balancing technique using
amplifiers or amplifier stages with comple-
mentary characteristics.

                                                                                                                                                     +

                                             C  +

                                                Figure 6.2 illustrates this principle using complementary amplifiers or am-
                                             plifier stages. The input signal is supplied to both amplifiers. If both am-
                                             plifiers have complementary characteristics, their errors have opposite signs.
                                             After addition, the error is eliminated and the output signal is doubled.

                                                Alternatively, one could use a setup as shown in Figure 6.3. There, both
                                             amplifiers are equal but they carry either the non-inverted or the inverted
                                                                                      6.1. INTRODUCTION 207

signal at their input. Their output signals are subtracted which results in           Figure 6.3: Balancing technique using
elimination of the error and doubling of the desired signal.                          identical amplifiers with inverted signals.

                                                                                  +

                                 -

6.1.3 Multiplicative or cascaded compensation

Aside from additive compensation, there exists multiplicative or cascaded
compensation. This type of compensation uses cascade connections of com-
pensating systems. It can be used for linearization and for correction of the
small-signal dynamic transfer of a system.

                                                                                      Figure 6.4: Multiplicative or cascaded
                                                                                      compensation uses cascaded systems that
                                                                                      together constitute a linear and instanta-
                                                                                      neous relation between the input and the
                                                                                      output signal.

   Figure 6.4 shows an arrangement in which two cascaded systems together
constitute a linear and instantaneous relation between the input and the out-
put signal.

6.1.4 Odd function synthesis

The v - i characteristics of the input and the output port, as well as the
transfer characteristics of an ideal amplifier, are first order odd characteristics.
These functions are of the form

                    y(x) = a1x,                            (6.1)

where y is the response signal and x is the excitation.
   The instantaneous source-to-load transfer characteristics, as well as the

v - i characteristics of the input port and of the output port of amplifier
stages such as the CS stage have both even and odd terms.

   The series expansion of instantaneous nonlinear functions with odd and
even nonlinearity can be written in the form

                    y(x) = a0 + a1x + a2x2 + a3x3 + ... .  (6.2)

Odd and even functions can be synthesized from these functions. This can

be seen if we write (6.2) as the sum of an odd function yodd(x) and an even

function yeven(x):

                    y(x) = yodd(x) + yeven(x),             (6.3)

where:              yodd(x) = a1x + a3x3 + ... ,

                                                           (6.4)

and                 yeven(x) = a0 + a2x2 + ... .

                                                           (6.5)
208 BALANCING TECHNIQUES

                                                    The functions yodd(x) and yeven(x) can be obtained from y(x) as

                                                                                yodd(x) = 12 (y(x) - y(-x)) , (6.6)
                                                                               yeven(x) = 1 (y(x) + y(-x)) . (6.7)

                                                                                                  2
                                                      In order to obtain odd characteristics for amplifiers, even order terms can
                                                be compensated for by adding -y(-x) to y(x). This can be done with the aid
                                                of a complementary amplifier as shown in Figure 6.2, or by passing the x(t)
                                                and -x(t) through two equal amplifiers and subtracting their output signals
                                                  as shown in Figure 6.3.

                                        6.1.5 This chapter

                                                  In this chapter, we will discuss the application of balancing techniques with
                                                  two-terminal elements and for two-ports. Balancing of two-terminal elements
                                                  will be discussed in section 6.2. We will start with an introduction of the basic
                                                  balancing techniques:

                                                  1. Anti-series connection of equal devices

                                                  2. Anti-parallel connection of equal devices

                                                  3. Series connection of complementary devices

                                                  4. Parallel connection of complementary devices.

                                                      We will see that balancing converts the biasing quantities into common-
                                                  mode quantities and the signal quantities into differential-mode quantities.
                                                  This makes balanced amplifiers less sensitive to changes in the operating
                                                  conditions due to temperature variations. This mechanism is often referred
                                                  to as offset compensation and compensation of the offset drift.

                                                      In section 6.3 we will discuss the balancing of two-ports. Practical imple-
                                                  mentations of balancing techniques with the basic amplifier stages will be
                                                  discussed in section 6.4.

                                             6.2 Balancing of two-terminal devices

                                             In this section, we will discuss the balancing of two-terminal elements using
                                             complementary elements or reversely connected elements.

Figure 6.5: v - i Characteristics of a two-

terminal device (red), of its reversely

connected and of its complementary device    +             +             +

(both: blue).                                                                      C

                                             -             -             -

                                             nonlinear     reversively   complementary
                                             resistive     connected     nonlinear
                                             two-terminal  nonlinear     resistive
                                             element       resistive     two-terminal
                                                           two-terminal  element
                                                           element

                                                Figure 6.5 shows the static v - i relations of some nonlinear two-terminal
                                             device, its reversely connected device and its complementary device. The
                                             complementary device behaves similar as the reversely connected device.
                                                                            6.2. BALANCING OF TWO-TERMINAL DEVICES 209

This directly follows from the definition of a complementary device (see
Chapter 3).

   If a nonlinear two-terminal device is placed in series with a reversely con-
nected identical device, we speak of an anti-series connection of equal devices
or simply of an anti-series connection. If such a device is placed in series with
its complementary device, we speak of a series connection of complemen-
tary devices or simply of a complementary-series connection. Anti-series and
complementary-series connection can be used to obtain odd v - i character-
istics. This technique will be discussed in section 6.2.1.

   If a nonlinear two-terminal device is placed in parallel with a reversely
connected identical device we speak of an anti-parallel connection of equal
devices or simply of a anti-parallel connection. If such a device is placed
in parallel with its complementary device, we speak of a parallel connec-
tion of complementary devices or simply of a complementary-parallel connec-
tion. Complementary-parallel connections and anti-parallel connections can
be used to obtain odd v - i characteristics. This technique will be discussed
in section 6.2.2.

6.2.1 Anti-series and complementary-series connection

Figure 6.6 shows the complementary-series connection and the anti-series + +
connection of two nonlinear resistors. Let us assume that the v - i relation of
the nonlinear resistor is given by

                         v = v(i).                 (6.8)                                                            C

The v - i relation of the anti-series or complementary-series connection            (A) -  (B) -

can then be obtained as

                         vs = v(is) - v(-is).      (6.9)                            Figure 6.6:
                                                                                      A: anti-series connection of identical
If we write v(i) as a series expansion, we obtain
                                                                                    devices
v(i) = ao + a1i + a2i2 + a3i3 + ... .              (6.10)                             B: series connection of complementary

                                                                                    devices

   The series expansion of the v - i relation of the anti-series or complementary-
series connection becomes

vs = v(is) - v(-is) =                              (6.11)
   + a0 + a1is + a2i2s + a3i3s + ...
   - a0 + a1is - a2i2s + a3i3s - ... ,             (6.12)
                                                   (6.13)
   = 2 a1is + a3i3s + ... .

   The resulting vs - is relation is an odd function. All even terms are can-       (A)    (B)
celed out, while the odd terms have twice the value of the corresponding
terms of the v - i relation of the single element.                                  Figure 6.7:
                                                                                      A: v - i relation of a non-linear resistor
   Figure 6.7A shows a graph of v(i) of a nonlinear resistor. Figure 6.7B             B: construction of the v - i relation of
shows the construction of the v - i relation of the complementary-series or
the anti-series connection from v(i).                                               the anti-series or complementary series

                                                                                    connection.

Differential-mode and common-mode quantities

Until now, we have studied the behavior of anti-series and complementary-
series connections, isolated from their electrical environment. In practice
there may exist a connection and/or parasitic current paths between the ele-
ments of the interconnected devices and other nodes of the circuits. An anti-
series or a complementary-series connection is only truly balanced if there is
no current flow to the reference node. This will always be the case if the
210 BALANCING TECHNIQUES

                                           common-mode (signal) voltage equals zero and if the signal voltage at inter-
                                           connection of the two devices equals zero. If the circuit is not truly balanced
                                           the v(i) relation of the interconnected devices may deviate from the one de-
                                           scribed.

                                              We will now study the common-mode behavior of two commonly used
                                           configurations of interconnected devices.

Figure 6.8: Common-mode and differential        +                ++
mode quantities in anti-series or comple-                      -
mentary series connected two-terminal
devices.                                                               (C)
                                                                 +
    A: Anti-series connection with
grounded interconnection point.                    (B) - -

    B: Anti-series connection with split
input voltage source.

                                           (A)  -

                                              Figure 6.8A shows a situation in which the common node of the two in-
                                           terconnected resistors has been connected to the reference node. If this is
                                           the only connection between the interconnected resistors and the reference
                                           node, there will be no current flow to this reference. In this arrangement the
                                           common-mode voltage vcm of the interconnected resistors is defined as:

                                                                                 vcm = V+ + V- ,    (6.14)
                                                                                                 2

                                           with V+ = v(is) and V- = v(-is) we may write:

                                                vcm = 1 (v(is) + v(-is)) =                          (6.15)
                                                         2
                                                                                                    (6.16)
                                                    + a0 + a1is + a2i2s + a3i3s + ...               (6.17)

                                                    + a0 - a1is + a2i2s - a3i3s + ... ,

                                                     = a0 + a2i2s + ... .

                                              Hence, the common-mode voltage comprises all the even terms while the
                                           differential-mode voltage vs comprises all the odd terms of the function v(i).

                                              Figure 6.8B shows an arrangement in which the anti-series connection is
                                           driven from two voltage sources, carrying ± 12 vs with respect to the reference
                                           node. The common-mode voltage now equals zero, while the voltage at node
                                           'C' comprises all the even terms of v(i):

                                                   VC = -a0 - a2i2s - ... .                         (6.18)

             +-                               Any impedance between node 'C' and the reference node will change the
                         +                 v(i) relation of the series connection. In fact, due to the rectifying properties
                                           of even functions, any parasitic capacitance or inductance between node 'C'
                         +                 and the reference node changes the operating point of the interconnected
             --                            devices.
Figure 6.9: Anti-series connection of two
biased two-terminal devices.               Anti-series connections of biased resistive elements

                                           We will now study the behavior of anti-series and complementary series con-
                                           nection of biased devices. We will see that if such interconnections are used
                                           in a truly balanced way, the biasing can be done with common-mode current
                                           sources only.

                                              The biasing of two-terminal resistive elements has been discussed in Chap-
                                           ter 3. Figure 6.9 shows the anti-series connection of two biased nonlinear
                                           resistors. The quiescent operating point Q of the resistors is fixed with a bias
                                                                                   6.2. BALANCING OF TWO-TERMINAL DEVICES 211

voltage source VQ and a bias current source IQ. If the v - i relation of the de-
vices is described by the function v(i) the bias voltage can be obtained from

this function operating on IQ:

                                        VQ = v(IQ).                                     (6.19)

   Figure 6.10 shows the construction of the v - i characteristic of the anti-
series connection from the single-device v - i characteristic and the selection
of the operating point.

                                                                                                Figure 6.10:
                                                                                                    A: v - i relation of a non-linear resistor

                                                                                                and selection of the quiescent operating
                                                                                                point

                                                                                                    B: v - i relation of the biased device
                                                                                                    C: construction of the v - i relation of
                                                                                                the anti-series connection of the biased
                                                                                                devices

        (A)                        (B)                                             (C)

Common-mode biasing                                                                             Figure 6.11: Biasing of an anti-series

                   +-                                                                           connection of two biased two-terminal
                                +
                                                                                                devices.
                                                 +
                                                       -                                            A: Circuit from Figure 6.9 with nodal
                                                                                                voltages V+, V- and VC

                                                                                                    B: Common-mode biasing of the circuit

                                                                                                from Figure 6.9

                                   +-
                                                                                +

                                                          -
                   +

             --

        (A)                                      (B)

   Until now, the anti-series connection is considered to be isolated from the

reference node. In Figure 6.11A the voltages at the outer nodes of the series
connections are assumed V+ and V-; these values need to be defined by the

electrical environment of this anti-series connection. The quiescent voltage at
                                                 1           (V+  + V-).
node  'C'  equals  the  common-mode     voltage  2

   Figure 6.11B shows an alternative biasing scheme using exclusively common-

mode bias sources. The current sources providing IQ in Figure 6.9 have

been redirected over the reference node using the current split theorem.

The two bias voltage sources are transformed into one common-mode volt-

age source using the Blakesley[Blakesley1994]1 transformation. This volt-                       1 T. A.  Blakesley.   A New Electrical The-
                                                                                                orem.    Proc. Phys.  Soc. London, 13:65-67,
age only changes the voltage across the current source that carries 2IQ. The                    1994

quiescent voltage at the interconnection of the two resistors has changed to
1  (V+     V-)
2       +       -  VQ.
212 BALANCING TECHNIQUES

                                           Small-signal equivalent circuit

                                           Until now, we have only studied the instantaneous behavior of anti-series or
                                           complementary series connections. An anti-series connection of two-terminal
                                           elements that also exhibits a nonlinear voltage-charge relation q = q(v) and/or
                                           a nonlinear current-flux  = (i) relation, yields odd characteristics for these
                                           relations as well.

                                              We will now study the small-signal behavior of anti-series connected non-
                                           linear devices.

                                              The small-signal resistance, capacitance and inductance of a biased non-
                                           linear two-terminal element are defined as:

                                           1. The small-signal resistance rQ in an operating point i = IQ of a device
                                              modeled with a nonlinear v - i relation v(i) is defined as

                                                                   rQ = dv(i) .                           (6.20)
                                                                             di i=IQ

                                           2. The small-signal capacitance cQ in an operating point v = VQ of a device
                                              modeled with a nonlinear q - v relation q(v) is defined as

                                                                   cQ = dq(v) .                           (6.21)
                                                                             dv v=VQ

                                           3. The small-signal inductance lQ in an operating point i = IQ of a device
                                              modeled with a nonlinear  - i relation (i) is defined as

quiescent                 +    quiescent                           lQ = d(i) .                            (6.22)
operating                 -    operating                                     di i=IQ
voltage                        current
                                              Figure 6.12 shows the network model of a biased two-terminal device with
                         +   nonlinear     a nonlinear v - i relation and a nonlinear q - v relation. Such behavior can
                             v-q relation
                      -

nonlinear
v-i relation

                                           be found in PN diodes.

Figure 6.12: Biased two-terminal device    Figure 6.13A, shows the anti-series connection of two devices. The cur-
with nonlinear v - i and nonlinear v - q
                                           rent is represents a deviation from the quiescent operating point. It is not
relation.                                  necessarily a small-signal current.

                                           The impedance can be represented by the series connection of two parallel

                                           RC networks as depicted in Figure 6.13B. The small-signal impedance zs of
                                           this circuit can then be written as

                                                                   zs = r1 1 + s + r2 , 1 1 + s2          (6.23)

                                           where 1 = r1c1 and 2 = r2c2. The resistances and capacitances are found as
                                           the derivative of v(i) and q(v) in the device's operating point, respectively.

                                              This impedance has two poles and one zero which is located between the

                                           two poles

                                                                   1 + s 1 r2 + 2 r1
                                                                   r1 +r2                         r1 +r2
                                           zs = (r1 + r2) (1 + s1) (1 + s2) .                             (6.24)

                                              Only if the two time constants are equal the impedance can be written as
                                           a single-pole function. If 1 = 2 =  we may write

                                                                   zs = r1 + r2 1 + s .                   (6.25)

                                              At zero excursion from the operating point (i = 0, and v = 0), this

                                           impedance can be simplified to a parallel connection of a resistance 2rQ and
                                           a capacitance 12 cQ, as shown in Figure 6.13C.
+                         -                                         6.2. BALANCING OF TWO-TERMINAL DEVICES 213
                          +
                         +                                                                               Figure 6.13:
                      -   +                                                                                  A: Anti-series connection of nonlinear
                      -   -
                         +                                                                               two-terminal devices.
                                                                                                             B: Small-signal equivalent circuit
-                                                                                                            C: Small-signal equivalent circuit in the

(A)                          (B)                                                                       quiescent operating point (is = 0).

                                                                       (C)

Stationary noise behavior

The spectral density Svn of the thermal noise voltage vn associated with an
impedance Z can be written as

                             Svn = 4kT Re(Z) V2Hz-1.                (6.26)

   Hence, the voltage noise spectrum in [V2Hz-1] of an anti-series connec-
tion, which is operating in its quiescent operating point, is twice that of its
constituting biased device.

   Since the small-signal impedance of nonlinear two-terminal devices de-
pends on the operating conditions, the associated noise spectrum may vary
with signal.

6.2.2 Anti-parallel and complementary-parallel connec-
         tion

Anti-parallel connection or complementary-parallel connection is dual to anti-
series connection or complementary-series connection. All conclusions from
anti-series connection hold for anti-parallel connection if voltage is replaced
with current, resistance with conductance, impedance with admittance, charge
with flux, and series connection with parallel connection and vice versa.

Anti-parallel and complementary-parallel connection of resistive elements

Figure 6.14 shows the complementary-parallel connection and the anti-parallel      +    +
connection of two nonlinear resistors. Let us assume that the v - i relation of
the nonlinear resistor is given by                                                           C

                             i = i(v).                              (6.27)         -    -

The v - i relation of the anti-parallel or complementary-parallel connection       (A)  (B)

can then be obtained as                                                          Figure 6.14:
                                                                                   A: anti-parallel connection of identical
                             ip = i(vp) - i(-vp).                   (6.28)
                                                                                 devices
If we write v(i) as a series expansion, we obtain                                  B: parallel connection of complementary

                                                                                 devices

                             i(v) = ao + a1v + a2v2 + a3v3 + ... .  (6.29)

The series expansion of the v - i relation of the anti-parallel or complementary-
214 BALANCING TECHNIQUES

                                              parallel connection becomes

                                              ip = i(vp) - i(-vp) =                          (6.30)
                                                + ao + a1vp + a2v2p + a3v3p + ...
                                                - ao + a1vp - a2v2p + a3v3p + ... ,          (6.31)
                                                                                             (6.32)
                                                 = 2 a1vp + a3v3p + ... .

(A)  (B)                                         The resulting vp - ip relation is an odd function. All even terms are can-
                                              celed out and the odd terms have twice the value of the corresponding terms
                                              of the v - i relation of the single element.

                                                 Figure 6.15A shows a graph of i(v) of a nonlinear resistor. Figure 6.15B
                                              shows the construction of the v - i relation of the complementary-parallel or
                                              the anti-parallel connection from i(v).

Figure 6.15:                                  Differential-mode and common-mode quantities
  A: i - v relation of a non-linear resistor
  B: construction of the i - v relation of    Until now, we have studied the behavior of anti-parallel and the complementary-
                                              parallel connection, isolated from their electrical environment.
the anti-parallel or complementary parallel
                                                 Figure 6.16 shows a situation in which one side of the parallel connection
connection.                                   has been connected to the ground.

              +                                  In this arrangement, the signal current ip is the sum of I2 and I2. The
                                              common-mode current icm in the interconnected resistors is now defined as
            -
                                                                           icm = I1 - I2 ,   (6.33)
Figure 6.16: Common-mode current in                                                    2
anti-parallel or complementary parallel
connected two-terminal devices.               with I1 = i(vp) and I2 = -i(-vp) we may write

                                              icm = 1 i(vp) + i(-vp) =                       (6.34)
                                                      2
                                                                                             (6.35)
                                                  + ao + a1vp + a2v2p + a3v3p + ...          (6.36)
                                                  + ao - a1vp + a2v2p - a3v3p + ... ,

                                                  = 2 aovp + a2v2p + ... .

                                                 Hence, icm comprises all the even terms while the signal current ip com-
                                              prises all the odd terms of the function i(v).

        +-                                    Anti-parallel connection of biased resistive elements
     +
       -                   +                  We will now study the behavior of anti-parallel and complementary-parallel
Figure 6.17: Anti-parallel connection of two- connection of biased devices. We will see that the biasing can be done with
biased two-terminal devices.                  voltage sources only.

                                                 The biasing of two-terminal resistive elements has been discussed in Chap-
                                              ter 3. Figure 6.17 shows the anti-parallel connection of two biased nonlinear
                                              resistors. The quiescent operating point Q of the resistors is fixed with a bias
                                              voltage source VQ and a bias current source IQ. If the v - i relation of the
                                              devices is described by the function i(v) we the bias voltage can be obtained
                                              from this function operating on VQ:

                                                                           IQ = i(VQ)        (6.37)

                                                 Since the sum of the two bias current sources equals zero, they can be
                                              omitted. In fact the two bias voltage sources deliver the bias current.

                                                 Figure 6.18 shows the construction of the v - i characteristic of the anti-
                                              parallel connection from the single-device v - i characteristic and the selec-
                                              tion of the operating point.
                                              6.2. BALANCING OF TWO-TERMINAL DEVICES 215

                                                                                   Figure 6.18:
                                                                                      A: v - i relation of a non-linear resistor

                                                                                   and selection of the quiescent operating
                                                                                   point

                                                                                      B: v - i relation of the biased device
                                                                                      C: construction of the v - i relation of
                                                                                   the anti-parallel connection of the biased
                                                                                   devices

(A)            (B)                       (C)

               -                                                                      +
               +                                                                      -
                                  +
Common-mode biasing            -                                                   +

Figure 6.19 shows a biasing scheme of a anti-parallel connection with one of                                                                         --+
its terminals connected to ground. The directions of I1 and I2 are according                                                                                           +
to those in Figure 6.16. For obvious reasons the positive direction of I2 is                                                                         --
usually taken opposite.                                                                                                                                                +
                                                                                   Figure 6.19: Biasing of an anti-parallel or
   Although it appears as if both devices are in series for the biasing, the       complementary parallel connection with
circuit is a complementary-parallel or anti-parallel connection from a signal      bias voltage sources only. The common
processing point of view. The function ip vp is an odd function, and ip is         mode-current is determined by the device
constituted from the sum of the device currents.                                   characteristics and the bias voltage sources.

Small-signal equivalent circuit

In the case of the anti-series or complementary-series connection, we consid-
ered nonlinear dynamic elements that showed both a nonlinear v - i relation
and a nonlinear q - v relation. The complementary situation is the anti-
parallel or complementary-parallel connection of nonlinear devices that have
both a nonlinear v - i relation and a nonlinear  - i relation. Because of its
practical relevance, however, we will discuss the anti-parallel connection of
devices with a nonlinear v - i relation and a nonlinear q - v relation. Figure
6.20A shows the anti-parallel connection two biased nonlinear devices from
Figure 6.12. Figure 6.20B shows the small-signal equivalent circuit and Fig-
ure 6.20C shows the small-signal equivalent circuit that is valid for zero static
excursion from the operating point.

     +      -                                                                      Figure 6.20: A: Anti-parallel connection
                                                                                   of biased identical non-linear dynamic
            +                                                                      devices

                                 +                                                     B: Small-signal equivalent circuit for
                                                                                   any static excursion from the operating
(A) -                            -  (C)                                            point

                                                                                       C: Small-signal equivalent circuit for
                                                                                   zero excursion from the operating point.

         +

(B) -
216 BALANCING TECHNIQUES

                                              Stationary noise behavior

                                              The spectral density Sin of the thermal noise current in associated with an
                                              admittance Y can be written as

                                                       Sin = 4kT Re(Y) A2Hz-1.                                       (6.38)

                                                 Hence, the current noise spectrum in [A2Hz-1] of an anti-parallel connec-
                                              tion, operating in its quiescent operating point is twice that of its constituting
                                              biased device.

                                                 Since the small-signal impedance of nonlinear two-terminal devices de-
                                              pends on the operating conditions, the associated noise spectrum may vary
                                              with signal.

+  +  +  -                                    6.3 Balancing of two-ports
         +
-  --    -                                    Before we will develop the balanced versions of the CS stage, we will apply
         +                                    the balancing techniques from the previous section to two-ports.
+  +C +
                                                 In a similar way as with two-terminal resistive elements, odd functions can
-  --                                         be obtained through application of anti-series, complementary-series, anti-
                                              parallel and complementary-parallel connections at the ports.
Figure 6.21: Upper: Symbol of a nonlinear
two-port                                         Figure 6.21 shows the schematic symbols that we will use for a nonlinear
                                              two-port and for its complementary version. Their v - i relations can be
  Lower: Complementary version of the         written as presented in section 3.3.
nonlinear two-port.
                                                 In section 6.3.1, we will give an overview of balanced two-ports that are
                                              constructed from anti-series, complementary-series, anti-parallel and complementary-
                                              parallel connections of two-ports. If not available, complementary devices
                                              can be constructed with the aid of transformers. Section 6.3.2 will be devoted
                                              to this topic.

                                              6.3.1 Balanced two-port configurations

                                              Below an inventory of balanced two-ports with odd transfer functions.

                                              1. Anti-series or complementary-series connection of both input and output
                                                 ports (Figure 6.22):

                                                       vii = vi(ii, io) - vi(-ii, -io),                              (6.39)
                                                       voo = vo(ii, io) - vo(-io, -io).                              (6.40)

Figure 6.22: Left: anti-series connection of     +  +                                    +  +
two-ports
                                              +                          +  +                  +
    Right: complementary-series connection
of two-ports                                     --                                      --

                                                 --                                 +C +
                                                                            -
                                              - ++                       -                     -
                                                                                     --

                                              2. Anti-series or complementary-series connection of the input ports and
                                                 anti-parallel or complementary-parallel connection of the output ports
                                                 (Figure 6.23):

                                                       vii = vi(ii, vo) - vi(-ii, -vo),                              (6.41)
                                                       ioo = io(ii, vo) - io(-ii, -vo).                              (6.42)
      +     +                    +                   +           6.3. BALANCING OF TWO-PORTS 217

   +                 +        +                               +             Figure 6.23: Left: input anti-series connec-
                                                                            tion and output anti-parallel connection of
      --                         --                                         two-ports

      --                              +C +                                       Right: input complementary-series
                              -                                             connection and output complementarry-
                                                                            parallel connection of two-ports
                                       --
   - ++              -                                        -

3. Anti-parallel or complementary-parallel connection of the input ports and
   anti-series or complementary-series connection of the output ports (Figure
   6.24):

            +     +                                  +     +                   Figure 6.24: Left: input anti-parallel con-
                                                                               nection and output anti-series connection
   +                 +        +                               +                of two-ports

            --                                       --                            Right: input complementary-parallel
                                                                               connection and output complementary-
            --                                 +C +                            series connection of two-ports
                              -
   - ++              -                                        -
                                                 --

                   iii = ii(vi, io) - ii(-vi, -io),              (6.43)
                  voo = vo(vi, io) - vo(-vi, -io).               (6.44)

4. Anti-parallel or complementary-parallel connection of the input ports and
   anti-parallel or complementary-parallel connection of the output ports
   (Figure 6.25):

                  iii = ii(vivo) - ii(-vi, -vo),                 (6.45)
                  ioo = io(vi, vo) - io(-vi, -vo).               (6.46)

         +     +                    +                   +                      Figure 6.25: Left: input anti-parallel con-
                                                                               nection and output anti-parallel connection
+                       +  +                                     +             of two-ports

         --                         --                                             Right: input complementary-parallel
                                                                               connection and output complementary-
         --                                 +C +                               parallel connection of two-ports
                           -
- ++                    -                                        -
                                              --

6.3.2 Design of complementary two-ports

Instead of using complementary elements, one can create complementary
versions of a nonlinear two-ports with the aid of transformers. This is shown
in Figure 6.26. This technique was used in vacuum tube amplifiers.
218 BALANCING TECHNIQUES

Figure 6.26: Nonlinear two-port and                                +    +  +

complementary versions. Complementary                                                            -
                                                                                                   +
two-ports can be constructed with the aid                          -    --
                                                                                                 -
of transformers:                                        (A)                                        +

A: Nonlinear two-port                                                                             -
                                                                                                    +
B: Complementary two-port
                                                                                   -
C: Complementary two-port using                                    +    +C +       +

isolated signal inversion at the input port                                        -
                                                                                   +
and non isolated signal inversion at the                (B)        -    --

output port

D: Complementary two-port using non

isolated signal inversion at the input port                     +       +  +

and isolated signal inversion at the output

port (C)                                                        -       --

    E: Complementary two-port using

isolated signal inversion at both ports.

                                                                +       +  +

                                                        (D)     -       --

                                                                +       +  +

                                                        (E)     -       --

             +    +                          6.4 Balanced CE and CS stages

             --                              Since active devices are three terminal elements, the input port and the out-
                                             put port of single-device amplifier stages share one common terminal. Due to
                                             this limitation, there are only two useful balanced configurations of elemen-
                                             tary amplifier: the anti-series stage and the complementary-parallel stage.

                                                The anti-series stage is known as the differential pair amplifier stage. It will
                                             be discussed in section 6.4.1.

                                                The complementary-parallel stage is known as the push-pull stage. It will
                                             be discussed in section 6.4.3.

                                                The properties of the anti-series stage and the complementary-parallel
                                             stage will be related to those of the single-device amplifier stage by consider-
                                             ing behavioral modifications due to the application of balancing techniques.

                                             6.4.1 Anti-series stages

                                                      -
                                             +

                                                       +
                                             -

         -        -                                -         -

           +      +                                  +       +

(A)                                       (B)                      (C)        (D)                      (E)

Figure 6.27: Anti-series connection of:         The anti-series connection of two identical devices is shown in Figure 6.27.
    A: Identical two-ports                   The resulting balanced CE- and CS stages are usually called differential pairs.
    B: Identical three-terminal elements
    C: IC NMOS devices                          We will first discuss the behavioral modifications in the small-signal dy-
    D: N channel JFETs
    E: NPN transistors.
                                                                                             6.4. BALANCED CE AND CS STAGES 219

namic behavior and the noise behavior as a result of anti-series connection
of two identical two-ports. With the aid of these behavioral modifications
we can easily predict the noise behavior and the small-signal behavior of all
differential pair stages.

   We will then discuss the behavior of the differential pair CS stage and the
differential pair CE stage.

Small-signal dynamic behavior of anti-series connected stages                                    +  -
                                                                                 +                  -
Let us consider the anti-series of two identical two ports as shown in Figure
6.28. The Transmission-1 matrix equation of each two port is given as                          -                    +
                                                                                               -    +
      Vi = A B            Vo Io .                               (6.47)
          Ii     CD

   If Vii is the voltage across the anti-series connection of the input ports    -  +                     -
and Voo the voltage across the anti-series connection of the output ports, the
Transmission-1 matrix equation of the anti-series connection can be written                         +

as

      IiVii = 1A 2B       Voo Io .                              (6.48)           Figure 6.28: The effect of anti-series con-
                 2C D                                                            nection on the Transmission-1 matrix
                                                                                 parameters.

Static noise behavior of anti-series stages

Figure 6.29 illustrates the way in which the equivalent input noise sources
of the anti-series connection can be obtained from the equivalent input noise
sources of the individual two-ports. Figure 6.29A shows the anti-series con-
nection of the two two-ports with their individual equivalent input noise
sources. This noise representation is not very convenient for evaluation of
the equivalent input noise sources of the (anti) series connection. A represen-
tation with two voltage sources is more suited to this situation. With such a
representation the total noise voltages at the input and at the output of the
resulting two port are simply found by adding those of the constituting two-
ports. An equivalent input representation can then be obtained by replacing
the output voltage source with equivalent input sources, thereby using the
transmission parameters of the (anti-) series connection.

   Figure 6.29B shows the equivalent voltage noise representation while Fig-
ure 6.29C shows the final result.

   +  +                -                +  +                    -
                          +                                     -                                     ++
                                                             +
                                                                                                      --
   --                                   --                                          C
   --                                   --

   +  +                -                +  +
                                                             +
                          +

A                B

   The power spectral densities of the equivalent noise sources of the anti-     Figure 6.29: Equivalent input noise sources
series connection are thus obtained as                                           of (anti-) series connected two-ports.

      Svtot = Svn1 + Svn2 [V2/Hz],                              (6.49)

      Sitot = 1 Sin1 + 1 Sin2 [A2/Hz].                          (6.50)
              4     4

If both constituting two-ports have identical noise behavior, we have: Svn1 =
220 BALANCING TECHNIQUES                                                                                                                                                      (6.51)
                                                                                                                                                                              (6.52)
                                                Svn2 = Sv [V2/Hz] and Sin1 = S1n2 = Si [A2/Hz] and we obtain
                                                                                     Svtot = 2Sv [V2/Hz],
                                                                                     Sitot = 1 Si [A2/Hz].
                                                                                                  2

                                          6.4.2 Anti-series CS stage

                                          In this section, we will apply the above theory about balancing to the biased
                                          anti-series CS stage. Figure 6.30 shows the anti-series connection of two bi-
                                          ased CS stages. The DC common-mode voltages of the stage with respect to
                                          the ground have yet been undefined.

-                                                                                                                                                                       +---
                                                                                                                                       +
Figure 6.30: Anti-series connection of       Similar as with the anti-series connection of two-terminal elements, the
biased NMOS CS floating with respect to                                                                                 +bias voltages are converted into common-mode voltages and the bias current
the substrate.                                                                          +sources can be converted into common-mode current sources. The conver-
                                          sion of the bias current sources into common-mode sources is the result of
Figure 6.31: Anti-series connection of  + redirecting these sources via the ground node. Figure 6.31 shows the result
biased NMOS CS floating with respect      of this transformation.
to the substrate with its bias sources
converted into common-mode bias sources.     In this figure the common-mode input voltage is defined by the voltage
                                          Vci. The common-mode output voltage Vco equals

                                                                     Vco = Vci - VGS + VDS.                                                                                   (6.53)

                                          Due to the current source character of the output port of the CS stage,

                                          this common-mode output voltage will be extremely sensitive to temperature

                                          changes and device tolerances. In practice, additional measures will have to

                                          be taken to reduce this sensitivity. This will be discussed at a later stage.

                                          If Vdi = 0, Vss equals

                                                                     Vss = Vci - VGS.                                                                                         (6.54)

                                             If Vdi = 0, Vss comprises even terms of Vd only, similar as with the anti-
                                          series connection of two-terminal elements.

Figure 6.32: Anti-series connection of                                        -
biased NMOS CS stages with its input
common-mode voltage defined by external
circuitry.

                                                        +                  +
                                                                          -
                                                      -              +
                                                                     -
                                          +
                                                        +

                                          -
                                                      -
                                                                           6.4. BALANCED CE AND CS STAGES 221

Large-signal static behavior

The physical nature of the amplification mechanism of the active devices is
a voltage-controlled current source. For this reason the voltage-to-current
transfer is often considered the most important of the four transfer param-
eters. Figure 6.33 shows the simulation test bench for determination of the
voltage-to-current transfer of the anti-series CS stage.

  (dd)                                                                          Figure 6.33: spice simulation test bench for
                                                                                plotting the DC voltage to current transfer
V2 +                                                                            of the anti-series CS stage.

1.8                           (G1)                                   (G2)
                                             (ss)
    -               +               M1
                                    C18nmos              M2
    +             V3                W=220n               C18nmos
                                    L=180n               W=220n
V1             0-                                I1 L=180n
                                                 {Iss}
0.9 -                         (c)

        + E1 +

              -1

        --

   The LTspice netlist of this circuit is shown below:

 1 antiSeriesCS
 2 * File: antiSeriesCS.cir
 3 * LTspice netlist file
 4 .lib CMOS18TT.lib
 5 M1 dd G1 ss 0 C18nmos W=220n L=180n
 6 M2 dd G2 ss 0 C18nmos W=220n L=180n
 7 V1 c 0 0.9
 8 V2 dd 0 1.8
 9 V3 G1 c 0
10 E1 c G2 c G1 -1
11 I1 ss 0 {Iss}
12 .param Iss=100n
13 * LTspice specific command section
14 .DC V3 -400m 400m 1m
15 .step param Iss list 100n 10u 20u 50u 100u
16 .end

   The circuit from Figure 6.33 uses the biasing scheme from Figure 6.31. The   2 The transconductance efficiency is defined
common-mode input voltage Vci is provided by V1. It is set to half the supply   as the ratio of the transconductance and the
voltage. According to the definition of the transconductance, the output has    drain current.
been shorted. For proper biasing in the saturation region the drains are con-
nected to the supply source V2. The stage is fully balanced because its input
is driven symmetrically with respect to ground. Hence, there is no signal
current flowing from the input to the output via the ground connection. The
differential input voltage is twice the voltage of V3.

   The bias current Iss of this anti-series stage determines the inversion co-
efficient in the quiescent operating point of the devices. Since the transcon-
ductance efficiency2 strongly depends on the inversion coefficient, the shape
of the voltage to current transfer characteristic will strongly depend on the
inversion coefficient.

   At weak inversion, the voltage-to-current transfer of a MOS transistor has
an exponential character; see (4.147). In this operating region, the transcon-
ductance is proportional with the drain current. In strong inversion the
voltage-to-current transfer has a quadratic relationship and the transconduc-
tance is proportional with the square root of the drain current; see (4.148).
At very high inversion levels the transconductance saturates to a maximum
value due to velocity saturation and vertical field mobility reduction.

   The left plot from Figure 6.34 shows the simulated transfer characteristics
for Iss = 100nA· · · 100µA. At Iss = 100nA, the transistors operate in weak
222 BALANCING TECHNIQUES

Figure 6.34: Characteristics of the anti-     inversion. The transfer characteristic can then be approximated by
series CS stage, when operating from weak
inversion to strong inversion with velocity                         ID1 - ID2 = Iss tanh VG1 - VG2 2nU . T                     (6.55)
saturation
                                                 At about ±180mV differential input voltage, the differential output current
    Left: Normalized differential output
current versus differential input voltage     equals ±99% of Iss.
                                                 At Iss = 100µA, the transistors operate at strong inversion with velocity
    Right: Voltage at source interconnection
node versus differential input voltage,       saturation. In this operating region, the transconductance does not signifi-

                                              cantly depend on the drain current. The transfer is linear over a wide input

                                              voltage range, but the differential input voltage required for full differential

                                              output  excursion     increases  to  Idss  where  gm  is  the  transconductance  of  the

                                                                                   gm ,

                                              unbalanced CS stage at full velocity saturation.

                                                 The right plot from Figure 6.34 shows the voltage Vss. It clearly shows
                                              the rectifying properties of the even function. In the linear range of the

                                              differential-mode transfer, Vss approximates Vci - VGS. Outside this range,
                                              Vss increases with the absolute value of the differential-mode input voltage.

                                              Small-signal dynamic behavior

Figure 6.35: Simplified small-signal equiv-

alent circuits of the anti-series CS stage. +
The bulk capacitances as well as the bulk

transconductance gb have been omited. -                                                                        +
    A: Small-signal equivalent circuit of the                                                               -

anti-series CS-stage                                                                     (B)

B: Small-signal equaivalent diagram of                -

the anti-series CS stage in the quiescent

operating point.                                                 +

                                              (A)

                                                 Figure 6.35A shows the simplified small-signal equivalent circuit of the

                                              anti-series CS stage. The bulk capacitances cgb, csb and cdb have been omitted.
                                              The influence of the bulk transconductance gb can usually be omitted. In a
                                              fully balanced environment and in the quiescent operating point it has no

                                              influence.

                                                 Figure 6.35B shows the simplified small-signal equivalent circuit for oper-

                                              ation in the quiescent operating point. The element values are those of the
                                                                  6.4. BALANCED CE AND CS STAGES 223

single CS stage, gm = gm1 = gm2, etc.

Differential-mode and common-mode equivalent circuits

Sometimes it is useful to model the differential-mode behavior and the common-
mode behavior of balanced networks separately. In Chapter 7.7 a both prac-
tical and a theoretical modeling techniques will be presented.

Stationary noise behavior

The stationary noise behavior in fully balanced application, and in the qui-
escent operating point, has been described with equations (6.51) and (6.52).
From these equations we can draw the following important design conclu-
sion:

        For an anti-series CS stage to achieve the same noise performance at a given
    source impedance as a single CS stage, the quiescent operating current, as well
    as the width of each transistor of the anti-series connection, should be twice
    those of the single CS stage.

   Hence, the cost factors for an equal noise performance with the differential
pair, are four times area and four times current, when compared to the CS
stage.

6.4.3 Complementary-parallel stages

The parallel connection of two complementary devices is shown in Figure
6.36. The resulting balanced CE- and CS stages are usually called push-pull
stages.

     +  +                                       -
                                       +

     --                                          +
                                       -

     +C +                              +C +
                                       --

     --

(A)            (B)                                           (C)                      (D)  (E)

   We will first discuss the behavioral modifications in the small-signal dy-         Figure 6.36: Parallel connection of:
namic behavior and in the noise behavior due to parallel connection. With the             A: Complementary two-ports
aid of these behavioral modifications we can easily predict the noise behavior            B: Complementary three-terminal
and the small-signal behavior of all push-pull stages.
                                                                                      elements
   We will then discuss the behavior of the complementary-parallel CS stage               C: IC NMOS and PMOS devices
and the complementary-parallel CE stage.                                                  D: N channel and P channel JFETs
                                                                                          E:Bipolar NPN and PNP transistors.

Small-signal dynamic behavior of complementary-parallel stages

Let us consider the anti-parallel of two identical two ports as shown in Figure
6.37. The Transmission-1 matrix equation of each two port is given as

           Vi = A B                                 Vo Io .       (6.56)
           Ii       CD

   If Iii is the current that flows into the parallel connection of the input
ports and Ioo the current that flows out of the parallel connection of the out-
224 BALANCING TECHNIQUES

                      +  -                             put ports, the Transmission-1 matrix equation of the complementary-parallel
+                        -                             connection can be written as

                   -                             +        Vi =       A 1B             Vo Ioo .  (6.57)
                   -     +                                Iii
                                                                             2
                                                                     2C D

-  +                           -                       Static noise behavior of complementary-parallel stages

                         +                             Figure 6.38 illustrates the way in which the equivalent input noise sources
                                                       of the anti-series connection can be obtained from the equivalent input noise
Figure 6.37: The effect of parallel connec-            sources of the individual two-ports. Figure 6.38A shows the anti-parallel
tion of two-ports on the Transmission-1                connection of the two two-ports with their individual equivalent input noise
matrix parameters.                                     sources. This noise representation is not very convenient for evaluation of
                                                       the equivalent input noise sources of the (anti) parallel connection. A repre-
                                                       sentation with two current sources is more suited to this situation. With such
                                                       a representation the total noise currents at the input and at the output of the
                                                       resulting two port are simply found by adding those of the constituting two-
                                                       ports. An equivalent input representation can then be obtained by replacing
                                                       the output current source with equivalent input sources, thereby using the
                                                       transmission parameters of the (anti) parallel connection.

                                                          Figure 6.38B shows the equivalent current noise representation, while Fig-
                                                       ure 6.38C shows the final result.

                         +  +                          +       +

                         --                            --                                       ++

                         +  +                          +       +

                         --                            --                                              --
                                                                                C
A                                                   B

Figure 6.38: Equivalent input noise sources               The power spectral densities of the equivalent noise sources of the anti-
of (complementary-) parallel connected                 series connection are thus obtained as
two-ports.

                                                       Svtot = 1 Svn1 + 1 Svn2 [V2/Hz],         (6.58)
                                                                  4  4

                                                          Sitot = Sin1 + Sin2 [A2/Hz].          (6.59)

                                                          If both constituting two-ports have identical noise behavior, we have: Svn1 =
                                                       Svn2 = Sv [V2/Hz] and Sin1 = S1n2 = Si [A2/Hz] and we obtain

                                                               Svtot = 1 Sv [V2/Hz],            (6.60)
                                                                         2                      (6.61)

                                                               Sitot = 2Si [A2/Hz].

                                                       6.4.4 Complementary-parallel CS stage

                                                       In this section, we will apply the above theory about balancing to the biased
                                                       complementary-parallel CS stage. Figure 6.39 shows the parallel connection
                                                       of two biased complementary CS stages.

                                                          Similar as with the complementary-parallel connection of two-terminal el-
                                                       ements, the bias currents are converted into common-mode currents and the
                                                       bias voltage sources can be converted into common-mode voltage sources.
                                                                                                                                                                   6.4. BALANCED CE AND CS STAGES 225

                                                                                                                                                                                       Figure 6.39: Parallel connection of biased

                  -                                                                                  +                                                                                 complementary MOS CS stages.
                                                                                              +                                                                                 -
                                                                                                                                                                                           +-
                                                      +
The conversion of the bias voltage sources into common-mode sources is the+                                  -                                                                         +
result of shifting these sources through de MOS transistors. This effectively
adds -VDS to the nodal voltages of the NMOS transistor and +VDS to those+                                                                                                       -      -                                                                       +
of the PMOS transistor. Figure 6.40 shows the result of this transformation.                                                                                                               +
The output port bias voltages have been converted into power supply volt-                                                                                                              + + -
ages. This circuit is known as the CMOS inverter stage.                                                                                                                                                                                   -
                                                                                                                                                                                                                                                            +-
   The drain current and the gate current have become common-mode cur-                                                                                                                                                                    --
rents. They cannot be observed at the input and the output of the stage.                                                                                                                                                                                    +
They are determined by the voltage sources and the characteristics of the                                                                                                              Figure 6.40: Parallel connection of biased
MOS transistors. This makes this stage very sensitive to variations in the                            -                                                                                CMOS CS stages. The output bias voltage
power supply voltages and the temperature changes. In practice, measures                                                                              -                                VDS has been shifted through the ground
will have to be taken to reduce these sensitivities.                                                                                                                                   node.

Large-signal static behavior

Similar as with the anti-series stage, we will now study the large-signal dy-
namic behavior of the push-pull stage.

                  M1                                                                                             (A)                      M3                                           Figure 6.41: spice test bench for determina-
                  C18pmos                                                                                                                                                              tion of the static voltage to current transfer
                  L=180n                                                                                             I1                   C18pmos                  (5)                 of the complementary-parallel CS stage.
                  W=770n                                                                                             {IQ}
                                                                                                               (2)                        L=180n                                 V5        A: Circuit for determination of the bias
                                    V1                                                                                                                                           {VP}  voltage VGS of the PMOS
--                                  {VP}                                                                                   (VgsP) -       W=770n
                                                                                                                                                                                           B: Circuit for determination of the bias
    E1                       -                                                                                                              - (7)                                      voltage VGS of the NMOS

+ 1meg+                                                                                                                                   E3                                               C: Biased complementary-parallel CS
                                                                                                                                                                                       stage.
                                                                                                                                      +1 +

          (VgsP)  (1)                                                                                                                               (9)

                                                                                                                                              +

                                                                                                                           V7             V3
                                                                                                                           DC 0 (in)
                                                                                                                                          {VP} -

                                                                                                                           + V4 +

          (VgsN)  (3)                                                                                                                                        {VN}

++                                                                                                    +        (4) - - - - (10)

    E2                                                                                                   V2      I2                    +  E4
    1meg                                                                                                 {VN}    {IQ}
                                                                                                                               (VgsN)     1 + (8)
--                                                                                                             (B)                                                               V6
                                                                                                                           (C)                M4                                 {VN}
                  M1                                                                                                                          C18nmos
                  C18nmos                                                                                                                     L=180n               (6)
                  L=180n                                                                                                                      W=220n
                  W=220n

   Figure 6.41 shows a simulation test bench for this purpose. Since in general
we want to fix the operating voltage and current at the output port of an
amplifier stage, we need to determine the input bias voltage VGS for fixing
IDS to its desired value at a given value of VDS. The width of the PMOS
has been taken 3.5 times larger than that of the NMOS because the zero field
mobility of electrons is larger than the mobility of holes. Relative scaling of

the width of both devices can be used to minimize even-order distortion, or to
226 BALANCING TECHNIQUES

                          adjust for different values of the current source and current sink capabilities

                          of the complementary-parallel stage.

                             Figure 6.41A shows the circuit for determination of VGS of the NMOS
                          and Figure 6.41B shows the circuit for determination of VGS of the PMOS
                          transistor. In practice, biasing techniques need to be applied that sufficiently

                          accurate fix the quiescent operating current IDS to its desired value. Such
                          techniques will be discussed at a later stage.

                             Figure 6.41C shows the biased push-pull stage with its output shorted

                          to ground. The output current is the sum of the drain currents and the

                          common-mode current is half the difference between the two currents, sim-

                          ilar as defined with the complementary-parallel connection of two-terminal

                          devices.

                             The LTspice netlist of this circuit is shown below:

                           1 complParlCS
                           2 * File: complParlCS.cir
                           3 * LTspice netlist file
                           4 .lib CMOS18TT.lib
                           5 * Circuit for determination of VgsP
                           6 M1 1 VgsP 0 0 C18pmos L=180n W=770n
                           7 E1 VgsP 0 2 0 1meg
                           8 V1 2 1 {VP}
                           9 I1 2 0 {IQ}
                          10 * Circuit for determination of VgsN
                          11 M2 3 VgsN 0 0 C18nmos L=180n W=220n
                          12 V2 3 4 {VN}
                          13 I2 0 4 {IQ}
                          14 E2 VgsN 0 4 0 1meg
                          15 * Biased complementary parallel stage
                          16 V5 5 0 {VP}
                          17 V6 0 6 {VN}
                          18 V7 in 0 DC 0
                          19 V3 9 in {VP}
                          20 V4 in 10 {VN}
                          21 E3 9 7 0 VgsP 1
                          22 E4 8 10 VgsN 0 1
                          23 M3 0 7 5 5 C18pmos L=180n W=770n
                          24 M4 0 8 6 6 C18nmos L=180n W=220n
                          25 .param VP=0.9 VN=0.9 IQ=1u
                          26 *
                          27 * LTspice command section
                          28 *
                          29 .DC V7 -900m 900m 36m
                          30 .step param IQ list 10n 100n 200n 500n 1u 2u 5u 10u
                          31 .end

                          Figure 6.42 shows the differential-mode output current and the common-

                          mode current both as a function of the input voltage. At zero input sig-

                          nal, the common-mode current equals the quiescent operating current. The

                          complementary-parallel stage is capable of delivering a differential output

                          current much larger than its quiescent current.

                          If the device is biased in weak inversion, the voltage to current transfer

                          can be approximated by

                                                  Io = 2 sinh Vi .         (6.62)
                                                  IQ  nUT

                             Hence, when biased in weak inversion, the gain around the operating
                          point is very low and strongly varies with the input voltage. This phenomena
                          is usually referred to as cross-over distortion. When biased in strong inversion,
                          the gain around the operating point is larger than the gain at relatively large
                          excursions because both transistors contribute to the output current, while at
                          relatively large excursions either the PMOS or the NMOS delivers the output
                          current.

                          Push-pull operating modes

                          Figure 6.42 illustrates that complementary-parallel stages can deliver cur-
                          rents that exceed their operating current. These stages are often referred to
                                                                                            6.4. BALANCED CE AND CS STAGES 227

as push-pull stages, a name that indicates that one transistor is pushing or                Figure 6.42: Characteristics of the
sourcing a current into a load, while the other is pulling or sinking the current           complementary-parallel CS stage, when
from a load. Due to this property, these stages are often used as high-efficient            operating from weak inversion to strong
output stages of amplifiers. Complementary-parallel stages can be biased in                 inversion with velocity saturation
different operation modes or classes:
                                                                                                Left: Output current versus differential
                                                                                            input voltage

                                                                                                Right: Common-mode current versus
                                                                                            differential input voltage,

1. Class A operation: both transistors conduct for all positive and negative
   excursions of the output current. This is the case if the output current is
   smaller than the quiescent current.

2. Class B operation: for all values of the output current, either the push
   transistor or the pull transistor conducts. This is the case if the quiescent
   current equals zero.

3. Class AB operation: for small values of the output current both transistors
   conduct, but at high output currents either the push or the pull transistor
   conducts. This is the case if there is a non-zero quiescent current which is
   much smaller that the peak output current.

4. Class C operation: either the push or the pull transistor conducts, but
   there is a dead-zone in the transfer from input to output.

   High-efficient, low-distortion operation, push-pull stages are often biased
for class AB operation: a small bias current facilitates a smooth transition
between the push and pull operation. Biasing of complementary-parallel
stages will be discussed in Chapter 15.

Small-signal dynamic behavior                                                               Figure 6.43: Simplified small-signal equiva-

                      g                                                                  d  lent circuits of the complementary-parallel

                                      +                                                     CS stage.
                                 -

                                                                                      s

   Figure 6.43 shows the simplified small-signal equivalent circuit of the complementary-
parallel CS stage.
228 BALANCING TECHNIQUES

                                                  Stationary noise behavior

                                                  The stationary noise behavior in the quiescent operating point has been de-
                                                  scribed with equations (6.60) and (6.61). From these equations we can draw
                                                  the following important design conclusion:

                                                      For a complementary CS stage to achieve the same noise performance at a
                                                  given source impedance as a single CS stage, the quiescent operating current
                                                  as well as the width of each transistor of the anti-series connection should be
                                                  half those of the single CS stage.

                                 6.5 Conclusions

                                                  In this chapter we have studied the application of balancing techniques. We
                                                  have introduced balancing as a form of additive compensation. This error
                                                  reduction technique is capable of reducing reproducible errors due to even
                                                  order nonlinearity, including its temperature dependency.

                                                      The two balancing techniques: anti-series connection and complementary-
                                                  parallel connection are of special interest for amplifier design. Anti-series
                                                  connection of the basic three-terminal amplifier stages yields a four terminal
                                                  stage with improved port isolation. Complementary-parallel connection pro-
                                                  vides a push-pull stage that exhibits a high current drive capability at a low
                                                  quiescent current. The noise performance of the balanced stage is similar to
                                                  that of its unbalanced version. The same holds for the dynamic performance.
                                                  Hence, their application for the improvement of the linearity, the reduction
                                                  of the offset and temperature drift, the improvement of the port isolation and
                                                  the extended current drive capability is only at the cost of circuit complexity.
                                                                229

7Design of feedback amplifier con-

figurations

7.1 Introduction                                           231

7.1.1 Design tasks                                         231

7.1.2 Brute force port impedance design                    231

7.1.3 Negative feedback amplifiers                         233

7.1.4 This chapter                                         233

7.2 Design of feedback configurations                      234

7.2.1 Step-by-step design of the feedback configuration    234

7.2.2 Direct sensing and comparison techniques             237

7.2.3 Indirect sensing and comparison techniques           239

7.3 Implementation of negative feedback                    239

7.3.1 Feedback networks                                    240

7.3.2 Ideal gain of a feedback amplifier                   240

7.3.3 Negative and positive feedback                       241

7.4 Nonenergic feedback                                    241

7.4.1 Design of nonenergic amplifier configurations        242

7.4.2 Noise behavior of nonenergic feedback amplifiers     243

7.4.3 Power efficiency of nonenergic feedback amplifiers   243

7.5 Passive feedback                                       243

7.5.1 Single-loop passive feedback configurations          244

7.5.2 Noise behavior of passive feedback configurations    245

7.5.3 Power efficiency of passive feedback configurations  255

7.5.4 Dual-loop passive feedback configurations            256

7.6 Active feedback                                        257

7.6.1 Single-loop active feedback                          257

7.6.2 Multiple-loop active feedback                        258

7.7 Design of balanced amplifiers                          259

7.7.1 Anti-series connected amplifiers                     259

7.7.2 Balanced single-loop configurations                  260

7.7.3 Common-mode behavior of balanced amplifiers          261

7.7.4 Design of natural two-ports                          266

7.7.5 Dual-loop balanced passive feedback amplifiers       267
230 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

7.7.6 Design of common-mode port impedances      269

7.8 Indirect feedback                            269

7.8.1 Indirect sensing                           270

7.8.2 Indirect comparison                        270
                                                                                      7.1. INTRODUCTION 231

7.1 Introduction

In Chapter 2, we have showed that all amplifiers can be characterized by their
input impedance, their output impedance and their transfer characteristic.
We determined nine different unilateral amplifier types and modeled their
ideal behavior with the transmission-1 two port parameters. We found five
different versions for each of those types if we also consider whether the
ports are floating or if they have one their terminals connected to the ground.

7.1.1 Design tasks

In this chapter, we will discuss means to design the port impedances and
the source-to-load transfer. We will do this by designing the transmission-1
two-port parameters of the amplifier.

   We have seen that the port impedances should provide optimum sense
and drive conditions for the source and the load, respectively. Sensing the
open circuit voltage of the signal source, as well as driving the load with
a current, requires an infinite port impedance. In order to sense the short-
circuit current of the signal source, as well as drive the load with a voltage,
the port impedance should be zero. For accurate termination of transmission
lines, the port impedance should equal the characteristic impedance of the
transmission line.

   Let us, for example, consider a voltage amplifier that is driven from a
voltage source with an open-circuit voltage Vs and a source impedance Zs.
The amplifier should provide a voltage V across the load impedance Z.
This voltage should be an accurately amplified copy of the source voltage.
The input impedance of the amplifier is Zi and the output impedance of the
amplifier equals Zo, as shown in Figure 7.1.

   The source-to-load voltage transfer for this configuration can be found as:

   V V = Zi A s Zi + Zs v Z Z ,  + Zo                                       (7.1)  +  ++                                     +

where Av is the voltage amplification factor of the amplifier: Av = VVoi .         -  --                                     -
   Accurate information transfer from source-to-load is only possible if:

1. All impedances are accurately known                                             Figure 7.1: Simple model of a voltage
                                                                                   amplifier with source and load.

2. In cases in which Zs and/or Zi are not accurately known, the input impedance
   of the amplifier should be much larger than the source impedance.

3. In cases in which Z and/or Zo are inaccurately known, the output impedance
   of the amplifier should be much smaller than the load impedance.

7.1.2 Brute force port impedance design

+                   ++                   +                                         Figure 7.2: Voltage amplifier with brute
                                                                                   force correction of its input and output
                                                                                   impedance.

-                   --                   -

   If the optimum drive or termination conditions are not met, accurate and
linear impedances can be inserted into the signal path to improve the source
sense and the load drive conditions. In the case of the voltage amplifier
from Figure 7.1, this can be done by inserting a linear and accurately known
impedance Zse in series with Zs and a linear and accurately known impedance
Zp in parallel with Z, as shown in Figure 7.2.
232 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                                      Techniques by which accurate and linear port impedances are realized
                                                  through their simple insertion in series or in parallel with the signal path, are
                                                  called brute force techniques. In general, these techniques should be avoided,
                                                  because they result in a deterioration of the signal-to-noise ratio and the
                                                  power efficiency of the amplifier.

                                                  Example 7.1

                                                          Let us consider an amplifier with equivalent input noise sources Veq and Ieq.
                                                      The amplifier is driven from a voltage source with an open source voltage Vs and
                                                      an impedance Zs. The noise voltage associated with the source impedance is Vns.
                                                    The spectral density of this voltage equals 4kT Re(Zs) [V2/Hz]. An impedance
                                                      Zse has been placed in series with the signal path and an admittance Yp has been
                                                      placed in parallel with the signal path. The spectral density of the voltage noise
                                                    VnY associated with Zse equals 4kT Re(Zse) [V2/Hz]. The spectral density of the
                                                    current noise InY associated with Yp equals 4kT Re(Yp) [A2/Hz]. The complete
                                                      configuration is shown in Figure 7.3.

Figure 7.3: Impedances in parallel or                 -  -                                            +-
in series with the signal path generally  +                                                    +
degrade the signal-to-noise ratio.        -                                                              +  +  +
                                                                                         +
                                                                                                         --    -
                                                         +
                                                                        -
                                                         +                                               +  +  +
                                                         -
                                                                                                         --    -

                                             For the evaluation of the influence of the noise sources on the signal-to-noise

                                          ratio, the noise sources need to be transformed into one total equivalent noise

                                          voltage Vntot in series with the signal voltage source. The spectral density SVntot
                                          of this total equivalent input noise voltage for the circuit from Figure 7.3, can be

                                          obtained as:

                                          SVntot = 4kT Re (Zs) + Re (Zse) 1 + ZsYp 2 + Re Yp |Zs|2             (7.2)
                                                + SVeq 1 + ZsYp 2
                                                + SIeq Zse + Zs 1 + ZseYp 2

                                          This expression shows an enlarged contribution of both equivalent noise sources

                                          to the total equivalent input noise if Zse and/or Yp differ from zero. Only in
                                          narrow-band applications can the noise be improved by inserting impedances in
                                          series or in parallel with the signal path. This occurs if Zse = - Im(Zs). In
                                          cases in which current is the information-carrying quantity, this condition would
                                          be: Yp = - Im(Ys). Such improvement of the signal-to-noise ratio, however, only
                                          occurs in the vicinity of some (resonance) frequency at which these conditions are

                                          approximately met.

                                          From the above analysis, we may draw the following conclusion:

                                              Impedances in series or in parallel with the signal source will deteriorate the
                                          signal-to-noise ratio of the amplifier. This deterioration has two causes:

                                          1. In general, the contribution of the amplifier's equivalent input noise sources
                                              to the total input noise will increase due to the insertion of these impedances
                                              as has been shown in the above example.
                                                                                     7.1. INTRODUCTION 233

2. If the real part of these impedances differs from zero, the thermal noise as-
    sociated with it, decreases the signal-to-noise ratio.

    Impedances in series or in parallel with the load will deteriorate the power
efficiency of the amplifier. This deterioration also has two causes:

1. Impedances in series or in parallel with the load require the amplifier's out-
    put current or voltage excursions to be larger for the same amount of load
    power. This results in an increase of the power losses in the amplifier. Only
    in narrow-band applications, can improvement be achieved by tuning out un-
    wanted effects from reactive parts of impedances in series or in parallel with
    the load, with impedances that have opposite reactive parts.

2. If the impedances in series or in parallel with the load have a real part, extra
    power has to be delivered by the amplifier.

7.1.3 Negative feedback amplifiers                                                   1 Harold S. Black. Stabilized feed-back
                                                                                     amplifiers. Electrical Engineering, 53(1):114-
The first negative feedback amplifier was built in 1927 by H. Black.[Black1934]1     120, January 1934
He applied negative feedback to obtain linear and stable-gain repeater am-           2 H.S. Black. Wave Translation System,
plifiers for long-distance telephone systems. Black's patent was awarded in          March 1932
1937.[Black1932]2
                                                                                     3 This is usualy called orthogonal design.
   Negative feedback is a powerful error reduction technique that trades gain
for quality improvement. With negative feedback, the source-to-load transfer
of an amplifier, as well as the port impedances, can primarily be fixed with
passive devices, while biased amplifying devices are used to provide power
gain. Such an approach is useful because the characteristics of real world
passive devices closely match those of their corresponding network abstrac-
tion. In other words, real world resistors, capacitors and inductors show
approximate resistive, capacitive and inductive behavior over a wide operat-
ing range, respectively. This cannot be said of the biased amplifying devices
that provide the power gain. Their characteristics are generally nonlinear,
suffer from speed limitation, show relatively large fabrication tolerances and
are rather sensitive to temperature variations.

   We will show that the transmission-1 parameters of amplifiers can accu-
rately be fixed with feedback elements around a high-gain amplifier or con-
troller. Each nonzero parameter can be fixed to an accurate value with one
feedback loop. In this way, we are able to give the port impedances and the
source-to-load transfer their desired values, without significant degradation
of other performance aspects, such as the noise performance, the accuracy,
the linearity, the power efficiency and the dynamic response of the ampli-
fier. As a matter of fact, with negative feedback, we are able to design those
performance aspects almost independently.3

7.1.4 This chapter                                                                   4 A circuit element is nonenergic if the
                                                                                     instantaneous power delivered to it is
In section 7.2, we will present a design procedure for fixing the transmission-      always zero. Hence, nonenergic network
1 parameters through application of negative feedback. We will introduce             elements do not store energy and do not
two different feedback techniques: direct feedback and indirect or model-based       dissipate power. Nonenergic network
feedback.                                                                            elements are:

   In section 7.3, we will discuss various implementation techniques. The best       · Ideal transformers
performance can be obtained with direct nonenergic feedback. Nonenergic
feedback amplifiers use nonenergic feedback elements.4 The practical use             · Ideal gyrators
of nonenergic feedback is restricted due to the limited availability of those
elements. Other techniques that will be discussed are: passive feedback,             · Short circuit
active feedback and balanced feedback.
                                                                                     · Open circuit.
   The following sections will be devoted to a more elaborate treatment of all
the techniques introduced. Section 7.4 discusses the design and the perfor-
mance aspects of nonenergic negative feedback amplifiers. Conceptually, the
234 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                                  best performance can be achieved with this type of amplifiers. Section 7.5 is
                                                  devoted to passive feedback. With passive feedback amplifiers, the feedback
                                                  elements adversely affect the signal-to-noise ratio and the power efficiency.
                                                  These effects, however, can be kept small, when compared to brute-force
                                                  techniques. In amplifiers with passive feedback networks, the sign of the
                                                  source-to-load transfer as well as the source-load isolation, is indissolubly
                                                  connected to the type of transfer. Active feedback, balanced feedback and
                                                  indirect feedback can be used to design the sign of the transfer, as well as
                                                  the source-to-load isolation independent from the type of transfer. These
                                                  techniques will be discussed in sections 7.6, 7.7 and 7.8, respectively.

5 This is achieved with corrective or negative  7.2 Design of feedback configurations
feedback.
                                                The procedure for fixing a tranmission-1 parameter with the aid of negative
                                                feedback is as follows:

                                                1. Sense the load quantity that needs to be related to a source quantity.

                                                2. Multiply the sense result with the value of the transmission-1 matrix co-
                                                   efficient that needs to be fixed; this should yield a copy of the source
                                                   quantity.

                                                3. Nullify the error between the source quantity and the derived copy of it
                                                   with the aid of a high-gain error amplifier or controller.

                                                   This amplifier controls the output signal in such a way that the feedback
                                                   signal is the best possible copy of the source signal.5 At this stage of
                                                   the design of negative feedback amplifiers, we will use nullors as error
                                                   amplifiers. Nullors are two-ports that have a nullator as the input port
                                                   and a norator as the output port. They have infinite available power gain.
                                                   Nullors are introduced in Chapter 18.3.3.

                                                4. Implement the nullor with a practical error amplifier, define its perfor-
                                                   mance requirements and design or select it. Chapter 11, discusses in which
                                                   way, and to what extend the amplifier's performance depends on proper-
                                                   ties of its controller.

                                                7.2.1 Step-by-step design of the feedback configuration

                                                The step-by-step design of a negative feedback voltage amplifier will be il-
                                                lustrated in the following example. The design procedure of other types of
                                                negative feedback amplifiers is similar to the one presented.

                                                   Example 7.2

                                                       Let us consider that we want to design a negative feedback voltage amplifier
                                                   with a voltage gain Av. Such an amplifier should have an infinite input impedance
                                                   and zero output impedance. The values of the transmission-1 parameters of this
                                                   amplifier should be:

                                                                             A = 1 , B = 0, C = 0, D = 0. (7.3)
                                                                                     Av

                                                1. Figure 7.4A shows the situation at the start: we have a signal voltage source with
                                                   open-circuit voltage Vs and source impedance Zs and a load impedance Z. With
                                                   the above values of the transmission-1 matrix parameters, the voltage across Z
                                                   will equal AvVs and will not depend on Zs and Z.

                                                2. We need to sense the load voltage V (see Figure 7.4B).
                                                                7.2. DESIGN OF FEEDBACK CONFIGURATIONS 235

3. Then, we create a copy of the source voltage by multiplying the sensed voltage by
         1
   A  =        To this end, we may use a voltage-controlled voltage source as shown
         Av .
   in Figure 7.4C. The gain of this so-called feedback element should equal the

   reciprocal value of the desired source-to-load transfer Av.

4. We then determine the difference between the source voltage and this copy by
   connecting these two voltages anti-series: see Figure 7.4D.

5. Finally, we nullify this difference between the source voltage and the copy by
   placing a nullator between the anti-series connected voltage sources, and by con-
   trolling the load voltage through placement of a norator in parallel with the load
   (see Figure 7.4E).

6. The nullor is a network abstraction that cannot be realized. After we have de-
   signed the negative feedback configuration with the aid of a nullor, we need to
   design the error amplifier that replaces it. This error amplifier must have a large
   gain so that the error signal will be negligibly small and the signal at the load is a
   sufficiently accurate copy of the source signal.

      +                      +        +                                 +                  Figure 7.4: A until F: step-by-step develop-
                                                                                           ment of the circuit concept for a negative
      -                      -        -                                 -                  feedback voltage amplifier with gain
                                                                                           V Vs = Av.
A                               B
                                                                                               A: The voltage Vs of a grounded
      +                      +        +                                 +                  source must evoke a voltage V across
     -                                                                  -                  the grounded load. Assume the voltage at
                             -        -                                                    the load equals its desired value V.
                   +
                -        --     D                                --                            B: The load voltage is sensed. Sensing
                         ++                                      ++                        of a voltage requires the sense element to
C                                                                                          be placed in parallel with the voltage to be
                         --                                      -                         sensed.
      +               +  ++  +        +                         +++
                                                                                               C: The sensed voltage is converted into
      -               -      -        -                         ---     -                  a copy of the source voltage. Hereto, it is
                                                                ++                         multiplied by the reciprocal value of the
E                               F                                                          desired source-to-load transfer.

      +                      ++                                      +                         D: The difference between the source
     -                                                               -                     voltage and its copy is obtained through
                             -     -                                                       anti-series connection (series connection
                                                                                           with opposite polartities).

                                                                                               E: This difference should be zero. The
                                                                                           nullator sets the zero voltage and zero
                                                                                           current condition for this error signal: the
                                                                                           difference between the source signal and its
                                                                                           intended copy. The norator drives the load
                                                                                           and the feedback network in such a way
                                                                                           that the condition set by the nullator will
                                                                                           be satisfied. In this way, the load voltage V
                                                                                           is generated.

                                                                                               F: The nullor is replaced with a two-
                                                                                           port with a large available power gain,
                                                                                           in such a way that negative feedback is
                                                                                           obtained.

                                                                                               G: The controlled source in the feedback
                                                                                           path is replaced with a nonenergic voltage
                                                                                           attenuator (a transformer).

                                                                                               H: The controlled source in the feed-
                                                                                           back path is replaced with a passive volt-
                                                                                           age attenuator.

G                               H

   Figure 7.4F shows the circuit after the nullor has been replaced with an error
   amplifier. The ports of the error amplifier are connected in such a way, that a
236 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

+              +                               unintentional decrease of the load voltage results in an increase of the error signal
                                               that establishes a correction of the load signal. This technique is called corrective,
-              -                               degenerative or negative feedback. If the opposite is the case, we have positive
                                               feedback, which may result in unstable behavior.
           -
            +                                  In Figure 7.4C we used a voltage-controlled voltage source to generate a
   --                                       copy of the load voltage. This voltage-controlled voltage source is an ac-
   ++                                       tive network element. We applied it to elucidate the synthesis of this neg-
                                            ative feedback voltage amplifier. Amplifiers with active feedback elements
   -                                        are called active feedback amplifiers. Figure 7.4G shows the amplifier with a
   +                                        transformer as the feedback element. An ideal transformer is a nonenergic
                                            network element, and therefore this amplifier is called a nonenergic feedback
Figure 7.5: Quadruple loop negative         amplifier. Figure 7.4H shows an arrangement in which the feedback network
feedback amplifier with controlled sources  consists of a passive voltage divider. This technique is called passive feedback.
as feedback elements.
                                               As already mentioned, the four transmission parameters of an amplifier
                                            can be independently fixed using negative feedback. Here is the procedure:

                                            1. In order to fix the parameters A and C to a nonzero value, we need to sense
                                               the load voltage. Sensing of voltages means parallel connection of the
                                               sense network and the load impedance. This is called load voltage sensing,
                                               parallel sensing, output voltage feedback, output parallel feedback or output shunt
                                               feedback

                                            2. In order to fix the parameters B and D to a nonzero value, we need to
                                               sense the load current. Sensing of a current means series connection of the
                                               sense network and the load impedance. This is called load current sensing
                                               or series sensing, output current feedback or output series feedback.

                                            3. In order to fix the parameters A and B to a nonzero value, we need to com-
                                               pare the feedback voltage with the source voltage. Subtracting or compari-
                                               son of voltages requires anti-series connection of the feedback voltage and
                                               the source voltage. This is called source voltage comparison, series comparison,
                                               input voltage feedback or input series feedback.

                                            4. In order to fix the parameters C and D to a nonzero value, we need to com-
                                               pare the feedback current with the source current. Subtracting or compar-
                                               ing currents requires anti-parallel connection of the feedback current and
                                               the source current. This is called source current comparison, parallel compari-
                                               son, input current feedback, input parallel feedback or input shunt feedback.

                                               Figure 7.5 shows a feedback amplifier in which all four transmission-1
                                            parameters have been independently fixed through application of negative or
                                            corrective feedback. The amplifier has its input port and its output port both
                                            floating with respect to the ground. Each feedback loop fixes one parameter
                                            only. This orthogonal design of the transmission-1 parameters is possible due
                                            to the ideal sense and drive conditions of the feedback elements:

                                            · No voltage drop across current-sensing elements

                                            · No current through voltage-sensing elements

                                            · Zero output impedance of the feedback voltage sources

                                            · Infinite output impedance of the feedback current sources

                                               With passive feedback and nonenergic feedback amplifiers elements, this
                                            is generally not the case. This will be discussed later.

                                               Table 7.1 gives an overview of the way the transmission parameters of the
                                            amplifiers can be fixed with the aid of negative feedback.

                                               Table 7.2 gives an overview of the 16 amplifier types (including the nullor)
                                            that can be realized by leaving out one or more feedback elements from the
                                            circuit from Figure 7.5.
                                                           7.2. DESIGN OF FEEDBACK CONFIGURATIONS 237

Param.  Feedback type at input port         Feedback type at output port     Transfer
A       V - comparison (series feedback)    V - sensing (parallel feedback)
B       V - comparison (series feedback)    I - sensing (series feedback)    [V/V]
C       I - comparison (parallel feedback)  V - sensing (parallel feedback)
D       I - comparison (parallel feedback)  I - sensing (series feedback)    [I/V]

        Amplifier type                               ABCD                    [V/I]

        Nullor                                       0 000                   [I/I]

        Voltage amplifier (unilateral)               1  0  0  0                  Table 7.1: Feedback method for fixing the
                                                     µ                           transmission-1 matrix parameters A, B, C
                                                                                 Table 7.2: Single-loop and multiple feed-
        Transadmittance amplifier (unilateral)       0 100                       or D.
                                                                                 back configurations with controlled sources
        Transimpedance amplifier (unilateral)        0 0 10                      as feedback elements according to Figure
                                                                                 7.5. Removal of a feedback loop, while
                                                                                 maintaining the drive and sense conditions
                                                                                 for the remaining, makes the correspond-
                                                                                 ing transmission coefficient zero.

        Current amplifier (unilateral)               000 1    

        Zi  =  ,  Zo  =    (unilateral)              0 10 1   

               
        Zi = µ , Zo = 0 (unilateral)
                                                     µ10 10                     controller
                                                                                output
        Zi = 0, Zo =  (unilateral)                   0011                       port        Load

        Zi = , Zo = µ (unilateral)                                   

                                                     1 100

                                                     µ

        Transformer-like amplifier (non-unilateral)  1  0  0  1
                                                     µ        

        Gyrator-like amplifier (non-unilateral)      0 1 10                     feedback
        Triple loop 1 (non-unilateral)                                          network
                                                                                input
                                                                                port
                                                     1 1 10

                                                     µ 

        Triple loop 2 (non-unilateral)                1 10 1                                may
                                                     µ                                      be
                                                                                            grounded
        Triple loop 3 (non-unilateral)               µ10 11
                                                           

        Triple loop 4 (non-unilateral)                       111                Figure 7.6: Direct voltage sensing: parallel
        Quadruple loop                                                          sensing or load voltage sensing.
                                                     0  

                                                     1 111
                                                     µ  

7.2.2 Direct sensing and comparison techniques

Until now we discussed the conceptual design of so-called direct feedback am-
plifiers. In direct feedback amplifiers, the load quantity is sensed and the
source quantity is compared with the feedback quantity. With this technique,
high-quality amplifiers can be designed. The opposite to direct feedback is
indirect feedback. We will discuss it at a later stage.

   We will now discuss direct sensing and comparison techniques in more
detail.

Direct voltage sensing techniques

If we need to fix the transmission parameters A or C of an amplifier to
nonzero values, we have to sense the voltage across the load. The input
voltage of the feedback network will equal the load voltage if the input ter-
minals of the feedback network are connected in parallel with the load. This
is shown in Figure 7.6. Hence, if the load must be floating with respect to
the ground, the input of the feedback network should also be floating with
respect to ground. If one terminal of the load is connected to the ground, the
input port of the feedback network will also be grounded.

Direct voltage comparison techniques

If we need to fix the transmission parameter A or B of an amplifier to a
nonzero value, we have to subtract the output voltage of the feedback net-
work from the source voltage. Methods for direct voltage comparison are
shown in Figure 7.7.
238 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

Source      controller  Source                controller  Source                 controller  Source      controller
            input                             input                              input                   input
            port                              port                               port                    port

            feedback                          feedback                           feedback                feedback
            network                           network                            network                 network
            output                            output                             output                  output
            port                              port                               port                    port

A                       B                                 C                                  D

Figure 7.7: Direct voltage comparison, or        The principle of voltage comparison is to connect the source and the feed-
input voltage feedback.                       back network anti-series, with the controller input closing the loop. This is
                                              shown in Figure 7.7A.
    A: The controller input port, the source
and the output port of the feedback net-         Ideally, the differential-mode input voltage, the differential-mode input
work, are floating with respect to the        current and the common-mode input current of the controller are zero (con-
ground.                                       troller is a natural two-port with A, B, C and D equal to zero).

    B: Grounded input port of the controller     Figure 7.7B though 7.7D show different grounding concepts for this loop.
and grounded load. The output port of the     Similar as with direct current sensing, parasitic impedances in parallel with
feedback network has to be floating with      the source, or in parallel with the output of the feedback network, may affect
respect to the ground.                        the ideal gain of the amplifier (see section 7.3.2). This is of particular interest
                                              if the input port of the controller needs to be floating with respect to the
    C: The input port of the controller and   ground (see Figure 7.7D).
the output port of the feedback network
are grounded. the source has to be floating
with respect to the ground,

    D: The source and the output port
of the feedback network are grounded.
The input port of the controller has to be
floating with respect to the ground.

                                              Direct current sensing techniques

controller  Load        controller            Load        controller             Load        controller  Load
output                  output                            output                             output
port                    port                              port                               port

feedback                feedback                          feedback                           feedback
network                 network                           network                            network
input                   input                             input                              input
port                    port                              port                               port

A                       B                                 C                                  D

Figure 7.8: Direct current sensing, or           If we need to fix the transmission parameters B and D of an amplifier to
output series series feedback.                nonzero values, we have to sense the current through the load. The input
                                              current of the feedback network equals the load current if the input port of
    A: The controller output port, the load   the feedback network is placed in series with the load.
and the input port of the feedback network,
are floating with respect to the ground.         Methods for current sensing are shown in Figure 7.8. The principle of
                                              direct sensing of the load current is that the sensing element, the load and
    B: Grounded output port of the con-       the output port of the controller are part of a current loop. This is shown in
troller and grounded load. The input port     Figure 7.8A. Figure 7.8B though 7.8D show different grounding concepts for
of the feedback network has to be floating    this loop.
with respect to the ground.
                                                 If the load and the output port of the controller are grounded, the input
    C: The output port of the controller and  port of the sensing element has to be floating with respect to the ground.
the input port of the feedback network are    This is shown in Figure 7.8B. Figure 7.8C illustrates a situation in which the
grounded. the load has to be floating with
respect to the ground,

    D: The load and input port of the
feedback network are grounded. The
output port of the controller has to be
floating with respect to the ground.
                                                         7.3. IMPLEMENTATION OF NEGATIVE FEEDBACK 239

output port of the controller and the input port of the sensing element are      6 The definition of the ideal gain of a
connected to the ground. In such a situation, the load cannot share one of its   negative feedback amplifier is given in
nodes with the ground. Figure 7.8D shows a situation in which the load and       section 7.3.2.
the input port of the sensing element are connected to the ground. In this
case, the output port of the controller has to be floating with respect to the
ground.

   In all cases, parasitic impedances in parallel with the load and in parallel
with the input port of the sensing element have to be avoided.

   Such impedances create parasitic current paths resulting in a difference
between the load current and the input current of the sensing element. A
parasitic impedance in parallel with the load results in a transfer that de-
pends on the load impedance, while an impedance in parallel with the input
port of the sensing element introduces an error in transfer of the feedback
network, resulting in an error of the ideal gain of the feedback amplifier.6 In
practice, this complicates the design of a controller that requires a floating
output port (see Figure 7.8D). Parasitic impedances between the output ter-
minals of the controller and the ground should be large enough to keep those
errors within acceptable limits.

Direct current comparison techniques                                             Source      controller
                                                                                             input
If we need to fix the transmission parameters C or D of an amplifier, we have                port
to subtract the output current of the feedback network from the source cur-
rent. To do so, the output port of the feedback network needs to be connected                feedback
anti-parallel with the source. This is shown in Figure 7.9.                                  network
                                                                                             output
   If the source must be floating with respect to the ground, the output port                port
of the feedback network should also be floating with respect to the ground.
If one terminal of the source is grounded, the output port of the feedback
network should also be grounded.

   Direct current comparison is dual to direct voltage sensing.

7.2.3 Indirect sensing and comparison techniques                                 may
                                                                                 be
Sometimes it is not possible to sense the load quantity or to compare the        grounded
feedback quantity with the source quantity directly. In those cases, indirect
feedback or model-based feedback can be applied. Basic indirect feedback tech-   Figure 7.9: Direct current comparison:
niques have been illustrated in Figure 7.10. Indirect feedback techniques are    parallel comparison or source current
often used in IC design. A more detailed discussion of indirect feedback will    comparison.
be presented in section 7.8.

direct                  direct   direct                  indirect                indirect                direct
comparison              sensing  comparison              sensing                 comparison              sensing

+           controller           +           controller                          +           controller
       -                                -                                               -

            feedback                         feedback                                        feedback

A                                B                                 C

7.3 Implementation of negative feedback                                          Figure 7.10: Indirect feedback amplifiers
                                                                                 use indirect sensing of the load signal
Until now, we have discussed the principle of negative feedback: sensing of      and/or indirect comparison with the
the load signal of interest, conversion of the sense result into a copy of the   source signal.
source signal and application of a controller that minimizes the difference be-
tween the source signal and its copy derived from the load. There are several
ways to implement this. We have already mentioned nonenergic feedback,
240 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                                  passive feedback and active feedback. In this section, we will give a brief de-
                                                  scription of techniques and terms used. These techniques will be discussed
                                                  in more detail in the following sections.

                                        7.3.1 Feedback networks

                                                  Since the controller is to nullify the error between the input signal and the
                                                  feedback signal, feedback networks predominantly determine the properties
                                                  of the feedback amplifier. For example, their noise performance, signal trans-
                                                  fer sign, and port isolation strongly depend on the type of feedback net-
                                                  work applied. Considering this, it makes sense to classify feedback amplifiers
                                                  based on their type of feedback network. Below is a list of feedback amplifier
                                                  classes based on the type of feedback network.

                                                  1. Nonenergic feedback amplifiers

                                                      Nonenergic negative feedback amplifiers use feedback elements that solely
                                                      consist of nonenergic network elements. It will be shown that the noise
                                                      performance and the power efficiency of these amplifiers is not affected by
                                                      the feedback network. Theoretically, the best possible performance can be
                                                      expected from this class of amplifiers. They will be discussed in section
                                                      7.4.

                                                  2. Passive feedback amplifiers

                                                      Although nonenergic feedback theoretically gives the best possible perfor-
                                                      mance, practical nonenergic feedback elements such as transformers are
                                                      far from ideal, while gyrators can only be realized with the aid of active
                                                      circuits. For this reason, the use of passive feedback networks is of more
                                                      practical importance. Passive feedback amplifiers with either dissipative
                                                      or non-dissipative feedback elements will be discussed in section 7.5.

                                                  3. Active feedback and balanced feedback amplifiers

                                                      Not all amplifier types can be realized using passive feedback. In section
                                                      7.5, we will see that the sign of the transfer of a passive feedback ampli-
                                                      fier does depend on the type of transfer. Moreover, with passive feedback
                                                      networks, isolation between the input port and the output port of the am-
                                                      plifier cannot always be accomplished. In cases in which nonenergic feed-
                                                      back or passive feedback techniques are inadequate for the design of the
                                                      desired amplifier type, other implementations of negative feedback can be
                                                      used. Aside from taking one's refuge in indirect feedback techniques, one
                                                      could also consider the application of:

                                                      (a) Active feedback
                                                          Active feedback amplifiers use one or more active networks as a feed-
                                                          back element. They will be discussed in section 7.6.

                                                      (b) Balanced feedback
                                                          Balanced feedback amplifiers can be used for the design of amplifier
                                                          configurations with their input and/or output port floating with respect
                                                          to the ground. These amplifier types will be discussed in section 7.7.

                                        7.3.2 Ideal gain of a feedback amplifier

                                                  The ideal gain of a negative feedback amplifier is defined as its source-to-load
                                                  transfer when all error amplifiers have been replaced with nullors. During
                                                  the conceptual design of negative feedback amplifiers, we will always use
                                                  nullors as controllers. As a matter of fact, we will use nullators and norators.
                                                  The nullators determine which voltages and the currents need to be nullified
                                                  and the norators provide the dependent currents to satisfy these conditions.
                                                                             7.4. NONENERGIC FEEDBACK 241

7.3.3 Negative and positive feedback                                               +  +  +           +

In feedback configurations with nullors as controllers, we cannot speak of         -  --             -
negative or positive feedback. We just have feedback with an instantaneous
error amplifier that provides an infinite available power gain, always yielding                  -
zero error signal at the input of a nullator. In fact, the nullor is the ideal                    +
controller concept, but it cannot be realized in practice.                               --
                                                                                         ++
   The available power gain of a real-world error amplifier will not be infinite
and will suffer from speed limitation and nonlinearity. Hence, in practice, the          -
error signal will not be zero and there only exists a stable situation in case of        +
corrective or negative feedback. Negative feedback requires a negative loop
gain. A formal definition of the loop gain will be presented in Chapter 10. A      Figure 7.11: Quadruple loop negative
negative loop gain requires a negative sign in the transfer from the positive      feedback amplifier with controlled sources
output port quantity of the error amplifier to the positive input port quantity    as feedback elements.
of the error amplifier. Or, in other words, the sign of the product of the gain
of the controller and the transfer of the feedback network should be negative.
Figure 7.11 shows the quadruple loop negative feedback amplifier of which
the nullor-based concept was shown in Figure 7.5. The nullor is replaced
with a controller with a finite available power gain and all feedback loops
establish negative feedback.

   Although we do not have negative feedback or positive feedback using
nullors, we will use the term 'negative feedback' throughout this chapter.
This is because it is our aim to implement corrective feedback. We will speak
of positive feedback, if it is our intention to implement non-corrective feed-
back.

   If negative and positive feedback are combined, a stable situation is only
obtained if the negative feedback dominates over the positive feedback.

   Positive feedback with a loop gain less than unity does the opposite as
negative feedback:

1. Parallel sensing of the load quantity or parallel comparison with the source
   quantity increases the corresponding port impedance.

2. Series sensing of the load quantity or series comparison with the source
   quantity decreases the corresponding port impedance.

3. Other negative effects of positive feedback will become clear in Chapter
   10.

   Positive feedback with a loop gain larger than unity results in bistable
behavior or in oscillations.

7.4 Nonenergic feedback

Nonenergic negative feedback amplifiers have feedback networks that solely
consist of nonenergic network elements. Nonenergic network elements have
no energy storage and do not dissipate power; they are instantaneous and
noise-free. It will be shown that the noise performance and the power effi-
ciency of nonenergic feedback amplifiers are not affected by their feedback
networks as it will be with passive feedback amplifiers.

   The following network elements are nonenergic:

1. Short circuit (one port, V = 0, for all values of I)

2. Open circuit (one port, I = 0, for all values of V)

3.  Ideal transformer (two port, A =  1  ,  B  =     0,  C  =  0,  D  =  n)
                                      n

4.  Ideal gyrator (two-port, A = 0, B =     1  ,  C  =   G,  D  =  0).
                                            G
242 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

          +     +                                       7.4.1 Design of nonenergic amplifier configurations

          - G1 -                                        All amplifier configurations with floating or grounded ports, having either in-
                                                        verting or noninverting transfer, can be designed as nonenergic feedback am-
   +                 +                                  plifiers, using ideal transformers and gyrators feedback elements. A nonener-
                                                        gic feedback voltage amplifier has already been shown in Figure 7.4G. In the
   -                 -                                  following example, we will demonstrate the design of a dual-loop negative
                                                        feedback amplifier.
          +     +
                                                           Example 7.3
          - T1 -
                                                               We will design a negative feedback amplifier that has zero output impedance
Figure 7.12: Two nonenergic feedback                       and its input impedance accurately fixed to a nonzero value. Let us first study
loops around a nullor that fix A and C                     the expressions for the input and the output impedance of an amplifier (2.16) and
independently.                                             (2.17), respectively. From these expression, we can conclude that we need to fix
                                                           the transmission-1 parameters A and C to a nonzero value and have B = D = 0.
             +  +                                          The amplifier will then have Zi = A/C and a voltage gain factor Vo/Vi = 1/A.
                                                           If we want to fix A with the aid of nonenergic negative feedback, we need to sense
             - G1 -                                        the output voltage Vo and compare it with the input voltage Vi, thereby using
                                                           a nonenergic feedback element. A nonenergic voltage-to-voltage converter is a
                                                     +     transformer. If we want to fix C with the aid of nonenergic negative feedback, we
+                                                          need to sense Vo, convert it into a current and subtract that current from Ii. A
                                                           gyrator can be used for this purpose. If we combine both feedback loops, we obtain
      T2                                -                  the circuit depicted in Figure 7.12. It has: A = 1/n, B = 0, C = G, and D = 0.

-                                                          In the next example, we will add a third loop to fix D of this amplifier.

      + + T1                                               Example 7.4

      -   -                                                    If we also want to fix D, we need to sense the output current of the amplifier.
                                                           If we do this without changing the sensing conditions for the voltage-sensing
Figure 7.13: Three nonenergic feedback                     elements, the third loop will not change the values of the previously designed
loops around a nullor that fix A , C and D                 parameters A and C. Figure 7.13 shows a solution in which a second transformer
independently.                                             is used to sense the output current and subtract an attenuated copy of it from
                                                           the input current. The voltage drop across this transformer has been kept zero
   +                                    +                  by placing its port for the input current comparison in parallel with the nullator.
                                                           Now, the current through the voltage-sensing transformer T1 is not longer zero,
   -                                    -                  but this does not affect the voltage sensing. Hence, the circuit from Figure 7.13
                                                           has: A = 1/n1, B = 0, C = G and D = n2.
A
                                                           A fourth feedback loop can be added to fix the parameter B as well. This
   B                                                    would require a second gyrator that converts the output current into a voltage
                                                        and subtracts that voltage from the input voltage. If we were to place one port
Figure 7.14: (A) Non-energic voltage fol-               of the gyrator in series with the output of the amplifier and the other one in
lower and (B) nonenergic current follower.              series with the input, while maintaining zero current through the voltage
7 Ernst H. Nordholt. Design of High-                    comparison port of this gyrator, it would fix the amplifier's transmission-
Performance Negative Feedback Amplifiers.               1 parameter B without affecting the other parameters. Unfortunately, such
Delft Academic Press / VSSD, 1 edition,                 an arrangement is not possible. Adding this gyrator would also affect the
1983-2006. ISBN: 9789040712470                          other transmission-1 parameters of the amplifier. This was demonstrated by
                                                        Nordholt[Nordholt1983]7.

                                                           All 16 amplifier configurations listed in Table 7.2 can be obtained with the
                                                        aid of negative feedback. One loop fixes one parameter only, if the voltage
                                                        sensing and current sensing of the feedback elements can be realized inde-
                                                        pendently, as demonstrated in the examples above.

                                                           Short circuits and open circuits are also nonenergic elements. The unity-
                                                        gain voltage amplifier and the unity-gain current amplifier, as shown in Fig-
                                                        ure 7.14, use short circuits in series with the signal path and open circuits in
                                                        parallel with the signal path as feedback elements. Hence, these amplifiers
                                                        belong to the class of nonenergic feedback amplifiers.
7.4.2 Noise behavior of nonenergic feedback amplifiers                               7.5. PASSIVE FEEDBACK 243

Figure 7.15 shows a nonenergic negative feedback voltage amplifier. The              -
controller of the amplifier is modeled as a nullor with equivalent input noise
sources Vn and In. Transformation of the noise sources from the input port of
the nullor to the input port of the voltage amplifier shows that the equivalent
input noise sources of the feedback amplifier equal those of the nullor. Hence,
the feedback network does not affect the amplifier's noise performance.

   -     -
      +
                                                                         +
                                                                                                                                             +

A     B                                                                           C

   This transformation proceeds as follows:                                       Figure 7.15: Noise behavior of a nonenergic
                                                                                  negative feedback voltage amplifier.
1. The voltage source Vn in series with the input of the nullor is already at
   the input of the amplifier (see Figure 7.15A).

2. The current source In in parallel with the input of the nullor can be redi-
   rected over the ground terminal of the amplifier. This is shown in Figure
   7.15B. We then obtain a noise current source in parallel with the input of
   the amplifier and a correlated current source in parallel with the trans-
   former.

3. The source in parallel with the transformer can be replaced with a current
   source In/n1 in parallel with the other port of the transformer, as shown
   in Figure 7.15C. This source can be ignored, because it is in parallel with
   the norator. Replacing it with equivalent input noise sources of the nullor
   would yield zero values for those sources.

   The remaining noise sources are a voltage source Vn in series with the
input of the amplifier and a current source In in parallel with the input of
the amplifier. Those two sources thus equal the original noise sources at the
input of the nullor. Hence, the feedback network does not affect the noise
performance of the amplifier.

7.4.3 Power efficiency of nonenergic feedback amplifiers

The nonenergic feedback element does not degrade the power efficiency of
the amplifier. This can easily be seen for the voltage amplifier from Figure
7.15: its feedback element does not carry any current because one of the ports
of the transformer is placed in series with the nullator.

7.5 Passive feedback

In this section, we will discuss the design of amplifier types that have one
or more transmission parameters fixed to a nonzero value with the aid of a
passive feedback network. We will discuss the design of single loop feedback
configurations in section 7.5.1. We will study their influence on the power ef-
ficiency and on the noise performance in sections 7.5.2 and 7.5.3, respectively.
The design of multiple-loop passive feedback configurations will be treated
in section 7.5.4.
244 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                        7.5.1 Single-loop passive feedback configurations

                                                  In the previous sections, we have seen that 15 types of negative feedback am-
                                                  plifiers can be realized using controlled sources as feedback elements. Ap-
                                                  plication of nonenergic feedback elements resulted in the best possible noise
                                                  performance and power efficiency of a feedback amplifier. In practice, nonen-
                                                  ergic feedback cannot always be implemented. Gyrators can only be realized
                                                  with the aid of active circuits, while transformers are expensive, show far
                                                  from ideal behavior and cannot always be integrated in silicon technology.
                                                  Practical application of nonenergic feedback is often restricted to followers in
                                                  which short circuits and open circuits can be used as feedback elements.

                                                      In this section, we will focus on the design of the four basic single-loop
                                                  configurations using passive feedback elements. These basic configurations
                                                  are shown in Figure 7.16. They can be designed according to the procedure
                                                  explained in Figure 7.4. Their ideal gain is the reciprocal transfer of the
                                                  feedback network. It can easily be evaluated through network inspection,
                                                  using the zero voltage and the zero current condition for the nullator.

Figure 7.16: Single-loop passive feedback
amplifiers for source and load referenced to
ground.

                                                      +                                             +
                                                      -
                                                                                                 -
                                                  A                     +

                                                                        -
                                                                                          B

                                                                                 +

                                                                                 -

                                                  C                                      D

                                              A. Voltage amplifier: V = Z1+Z2
                                                                    Vs  Z1

                                              B. Transadmittance amplifier: VIs = - Z11

                                              C.  Transimpedance amplifier:  V   = -Z1
                                                                             Is

                                              D. Current amplifier: I = Z1+Z2Is
                                                                        Z1

                                                 Both the voltage and the current amplifier have noninverting transfers, and
                                              the transadmittance and transimpedance amplifiers have inverting transfers.
                                              This is a consequence of the noninverting character of the transfer of the pas-
                                              sive feedback elements. With natural two-ports as feedback elements (such
                                              as transformers) we can realize both inverting and noninverting transfers of
                                              the feedback network. Using non natural two-ports, we have to find other
                                              ways to realize both inverting and noninverting amplifiers. These techniques
                                              are:

                                              1. Active feedback

                                              2. Balanced feedback
                                                                                        7.5. PASSIVE FEEDBACK 245

3. Indirect feedback.

   These techniques will be discussed in sections 7.6, 7.7 and 7.8, respectively.
   Another restriction due to the application of non-natural two-ports as feed-
back elements, is their lack of port isolation. This is because passive feedback
networks establish interconnections between the input and the output port.
With the aid of active feedback, balanced feedback and indirect feedback we
will be able to design amplifier configurations with floating ports.

7.5.2 Noise behavior of passive feedback configurations

It is to be expected that the insertion of the passive feedback elements into the
signal path causes a deterioration of the signal-to-noise ratio. It can be shown
that such deterioration can be kept small when compared to the application
of brute force techniques.

   The influence of the feedback network on the noise performance of pas-
sive feedback amplifiers can be evaluated in several ways. Hand calculations
can be done using source transformation techniques. Alternatively, one could
use symbolic mathematical tools for this purpose. Network simulation pro-
grams (spice-like programs) can be used to obtain numeric results. We will
demonstrate various methods in the following examples.

   First, we will show the application of source transformation techniques.
Then, we will show the combination of source transformation techniques
and superposition. Finally, we will demonstrate the use of modified nodal
analysis. The latter techniques are more suited for automated noise analysis
as it has been implemented in SLiCAP.

   Example 7.5

       In this example, we will illustrate the use of source transformation technique.

   -  -                                                                                 Figure 7.17: Passive-feedback voltage
                                                                                        amplifier with noise sources.

+     +                            -
                  +
                                                            +

-
                                +

         -

       Figure 7.17 shows a passive feedback voltage amplifier with its noise sources.
   In order to evaluate the deterioration of the signal-to-noise ratio due to passive
   feedback, these noise sources have to be transformed into one total equivalent
   input noise voltage source. The noise sources that have to be accounted for are:

· The noise voltage Vns associated with the signal source. The spectral density of
   this source is given by 4kT Re {Zs} [V2/Hz]

· The equivalent input noise voltage Veq of the nullor. The spectral density of this
   source is given by Sveq [V2/Hz]

· The equivalent input noise current Ieq of the nullor. The spectral density of this
   source is given by Sieq [A2/Hz]

· The thermal noise V1 associated with R1. The spectral density of this source is
   given by 4kTR1 [V2/Hz]
246 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                               · The thermal noise V2 associated with R2. The power spectral density of this source
                                                  is given by 4kTR2 [V2/Hz].

                                                      The starting situation is shown in Figure 7.17. The transformation of all the
                                                  noise sources to one equivalent input voltage source will be illustrated in six steps.

                                               1. In the first step, as shown in Figure 7.18, the equivalent current source of the
                                                  nullor is redirected via the ground. It is then represented by two equal sources:
                                                  one in parallel with R1 and one in parallel with the source.

Figure 7.18: Application of the current-split           -     -
theorem to Ieq.

                                               +           +           -
                                                                       +
                                                                                                        +

                                               -

                                                                    +

                                                                    -

                                               2. With the aid of the Thévenin transformation, both current sources can now be

                                                  transformed into voltage sources, as shown in Figure 7.19. This results in two

                                                  voltage sources, one in series with R1 that has a value IeqR1, and one with a value
                                                  of IeqZs in series with the source. Both sources are correlated, and therefore, we
                                                  will keep track of the signs of these sources.

Figure 7.19: Conversion of noise current             -     -     -
sources into voltage sources.

                                                  +     +              -
                                                                    +
                                                                                 +
                                                                                                        +

                                                  -              +

                                                                 -
                                                                 -

                                                                 +

                                               3. The next step, the result of which is depicted in Figure 7.20, shows how the voltage
                                                  sources in series with R1 are shifted into the branch with R2 and the branch with
                                                  the input of the nullor.

                                               4. The voltage sources in series with the input of the nullor can be shifted through the
                                                  input port of the nullor. They now appear in series with the source. The voltage
                                                  sources in series with R2 can be shifted into the branch connected to the output of
                                                  the voltage amplifier and the branch connected to the output of the nullor. This is
                                                  shown in Figure 7.21.

                                               5. The sources in series with the output port of the nullor can be transformed into
                                                  equivalent input sources of the nullor by multiplying them by the corresponding
                                                  transmission parameters. Since all of the transmission parameters of the nullor
                                                  equal zero, these sources can be neglected.
      -     -  -                                                                             7.5. PASSIVE FEEDBACK 247

                                                                                         Figure 7.20: The voltage sources V1 and
                                                                                         Ieq R1 are shifted through node (a).
         +
                     ++
                                  ++
                                               +-
                                                                    +-
   +                                                                                                  +
                                                                                                                                            +
                  +                -            -
   -                                                                                                                                                                 +-

                                                                                                                                           +(a)

                                                                                                                 +-----(b) -                                             -

                                                                                           +--                                                                        -
                                                                                       +
         +
                                                                       +-
                                                                 +

                                                          +
                                                      +

                                       +
                          +

                     +
         +
The sources in series with the output port of the voltage amplifier can be trans-                                                                                     Figure 7.21: The noise voltage sources at
formed into equivalent input sources of the voltage amplifier by multiplying them                                                                                     the input are shifted through the input port
by the corresponding transmission parameters of the voltage amplifier. Since, for                                                                                     of the nullor and the sources in series with
the voltage amplifier, only the parameter A is fixed at a nonzero value, these out-                                                                                   R2 are shifted through node (b).
put voltage sources can be represented by equivalent input voltage sources that
have a value A times larger, with A = R1/(R1 + R2). These steps are shown in                                                                                          Figure 7.22: Transformation of all noise
Figure 7.22.                                                                                                                                                          sources to the input.

   -     -                            -

               -                          -

+
-

6. Figure 7.23 shows the final result of the noise transformations. The power spectral
   density of the total equivalent input noise voltage source can be expressed as:

SVn,tot = 4kT Re{Zs} + Sveq + 4kT  R1 R2     + Sieq Zs +  R1R2 2   .  (7.4)

                                   R1 + R2                R1 + R2

7. Thus, the influence of the feedback network on the noise performance of the passive
   feedback voltage amplifier can be calculated as if the parallel connection of R1 and
   R2 is in series with the signal source.

   This confirms the equivalence of the noise models from Figure 7.17 and 7.24.

   Conclusions with respect to the noise behavior of the other single loop
passive feedback amplifier configurations can be derived in a similar way:
248 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

Figure 7.23: Final result of the noise trans- -
formations.

                                                                              +
                                                                    -
                                                                            +
+Figure 7.24: Noise model of the voltage                                            in                                out
amplifier, equal to that of Figure 7.17.
                                                                                        Voltage
                                                                                 +      Amplifier
                                                                       -

                                                    1. The total equivalent input noise of the voltage amplifier from Figure 7.16A
                                                       can be calculated from the individual noise contributions as if the parallel
                                                       connection of the feedback elements is in series with the source.

                                                    2. The total equivalent input noise of the transadmittance amplifier from
                                                       Figure 7.16B can be calculated from the individual noise contributions as
                                                       if the feedback element is in series with the source.

                                                    3. The total equivalent input noise of the transimpedance amplifier from Fig-
                                                       ure 7.16C can be calculated from the individual noise contributions as if
                                                       the feedback element is in parallel with the source.

                                                    4. The total equivalent input noise of the current amplifier from Figure 7.16D
                                                       can be calculated from the individual noise contributions as if the series
                                                       connection of the feedback elements is in parallel with the source.

     -                                                 In the next example, we will demonstrate the use of source transformation
                                                    techniques and the application of the superposition theorem. We start with
                                                 +  the determination of the contribution of each individual noise source to the
                                           -        output noise of the amplifier. We then obtain the spectral density of the
Figure 7.25: Contribution of Vns to the             output noise by adding all of these contributions. The spectral density of the
output noise.                                       input noise is then obtained by dividing the output noise spectrum by the
                                                    squared gain of the amplifier.

                                                       Example 7.6

                                                           We will evaluate the contributions of the individual noise sources to the total
                                                       output noise spectrum SVout.

                                                    1. The noise voltage Vns associated with the signal source. The spectral density Svn
                                                       of this source equals: 4kT Re {Zs} [V2/Hz].

                                                       The contribution S1 of this noise source to SVout can be calculated by multiplying
                                                       Svn by the squared gain (see Figure 7.25):

                                                                                    S R 1 = 4kT Re {Zs} 1 + R2 2 .         (7.5)
                                                                                                                  R1
                                                                                        7.5. PASSIVE FEEDBACK 249

2. The equivalent input noise voltage of the nullor Veq. The spectral density of this
   source is given by: Sveq [V2/Hz].

The contribution S2 of this noise source to SVout can be calculated in a similar

way:

      S2 = Sveq                           R1 + R2 2 .                   (7.6)
                                             R1

3. The equivalent input noise current Ieq of the nullor. The power spectral density
   of this source is given by: Sieq [A2/Hz].

                                                                                        Figure 7.26: Evaluation of the contribution
                                                                                        of Ieq to the output noise.

                                                                     +
                                                                     -

We can split this source into two correlated sources as shown in Figure 7.26. The
current source in parallel with the source impedance causes an output voltage V1:

                                 V1 = IeqZs R1 + R2 .                   (7.7)
                                                   R1

The current source in parallel with R1 causes an output voltage V2:

                                 V2 = Ieq R2.                           (7.8)

These are two correlated contributions, so we add these voltages and find their

contribution S3 to the spectrum of the output noise voltage by multiplying the
spectral density of Ieq by the squared magnitude of the transfer from Ieq to the
output voltage. In this way, we obtain

      S R 3 = Sieq Zs 1 + R2 2 + R2 .                                   (7.9)
                          R1

This can be written as           R1 + R2  2 Zs + R1R2 2 .               (7.10)
                      S3 = Sieq     R1             R1 + R2

4. The thermal noise V1 associated with the feedback element R1. The spectral den-
   sity of this source is given by: 4kTR1 [V2/Hz].

   The gain of this noise source to the output voltage equals -R2/R1. The contri-
   bution S4 to the spectral density of the out[put noise voltage is thus obtained by
   multiplying 4kTR1 with the squared magnitude of this transfer. We obtain:

                                             R2                         (7.11)
                                 S4 = 4kT 2 R1

5. The thermal noise V2 associated with the feedback element R2. The spectral den-
   sity of this source is given by 4kTR2 [V2/Hz].
   This noise source can be converted into a current source I2 with a spectral density
   S2 = 4kT/R2 [A2/Hz]. It can be split into two correlated sources, as shown in
250 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

Figure 7.27: Evaluation of the contribution
of the thermal noise of R2 to the output +
noise.

                                                                                                                                                                      -

Figure 7.27. The source in parallel with the norator has no effect. The remaining
source contributes S5 to the output spectrum:

                          S5 = 4kTR2.                                                                                                                                    (7.12)

6. The spectral density of the output voltage noise is obtained by adding the contri-
   butions of S1 through S5:

SVout =   R1 + R2 2       4kT Re {Zs} + Sveq + Sieq     Zs + R1R2 2                                                                                                      +
             R1            ,                                  R1 + R2                                                                                                    (7.13)

+ 4kT     R2
          2 R + R 1 2

which can be written as:

SVout =   R1 + R2 2 ×                Zs + R1R2 R1 + R2  2 + 4kT R2R1 .
       ×      R1                                                  R2 + R1
                                                                             (7.14)
          4kT Re {Zs} + Sveq + Sieq

7. The source-referred noise spectrum is obtained after multiplication of this result
   by the reciprocal value of the squared magnitude of the voltage gain:

SVn,tot = 4kT Re{Zs} + Sveq + Sieq Zs + R1R2 2 + 4kT R1R2 .                                                                                                              (7.15)
                                     R1 + R2            R1 + R2

   Finally, we will evaluate the total equivalent input voltage noise of the
passive-feedback voltage amplifier with the aid of the MNA method. This
method has been implemented in SLiCAP.

   Example 7.7

       In order to keep the matrices as small as possible, we will replace the voltage
   noise sources V1 and V2 with current sources I1 and I2 and combine the noise
   sources Vns and Veq in one voltage source. In addition, we will omit the signal
   source Vs. The simplified equivalent noise model is shown in Figure 7.28. Using
   this model, we will calculate the total equivalent input noise from the total out-
   put noise. We will evaluate the total output noise and obtain the source-referred
   noise after multiplication of the output noise voltage by the reciprocal value of the
   voltage gain: R R1+1R2 . The total output noise will be determined using MNA and
   Cramer's rule.
                            (2)                                                                         7.5. PASSIVE FEEDBACK 251

                                                                      (4)                           Figure 7.28: Equivalent noise model of the
                (1)                                                                                 voltage amplifier for MNA.

                                        (3)

          +

          -

The circuit can be described with the following matrix equation:

                             0                            V1               

                             Ieq                          V2               
                                                                           
           I   -I1 - I2 - Ieq  = M  V   V3  ,
                             2                        4                                     (7.16)

                                            
           Vns + Veq                                  Iin 

                             0                            Iout

where     1  Zs - Zs              1                                              

                                            0             0 10

           -1 1                             0             0                0  0  
           Zs Zs                                                                 
                                         1        1       1
              0                 0 R1 + R2 - R2  0 0  .                           
       M =
          0                     0           -1            1 0 1                             (7.17)

                                              R2          R2                     
          1 0                               0             0 0 0

             01                             -1            0 00

The total equivalent input noise voltage Vntot can be found from

                             Vntot = R1 R V 1 + R2 out                                      (7.18)

The output voltage Vout equals V4. It can be found with the aid of Cramer's rule:

                             Vout = det (M) ,                                               (7.19)
                                      det (M)

where

       1Zs - Zs1                   0                 0                        10    

        -1 1                       0                 Ieq                      0  0  
        Zs Zs                                                                       
                             1        1
     0       1  0 R1 + R2 -I1 - I2 - Ieq 0 0  .                                     
M =
       0    0                   - R2                 I2                       0 1           (7.20)
                                                                                     
       1 0                         0            Vns + Veq 0 0 

        01                        -1                 0                        00

With the aid of a symbolic math tool, this can quickly be simplified to

Vntot = Veq + Vns + Ieq R1R2 R + Z 1 + R2 s + I1 R1R2 R + I 1 + R2 2 R1R2 R . 1 + R2        (7.21)
                                                                                            (7.22)
Hence, for the spectral density SVntot of Vntot, we write:

SVntot = SVeq + SVns + SIeq   R1R2 2 + Zs +              SI1 + SI2                R1R2 2 ,
                             R1 + R2                                             R1 + R2
252 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                            which can again be written as:

                                            SVntot = SVeq + 4kT Re (Zs) + SIeq R1R2 2 + Zs + 4kT R1R2 .    (7.23)
                                                                            R1 + R2  R1 + R2

         x1 N_noise si={S_i} sv={S_v}          In the following example, we will demonstrate the way in which SLiCAP
    (2)                                     can be used to perform such noise calculations.

R1                                             Example 7.8

      (1)               (out)                      Figure 7.29 shows the SLiCAP circuit diagram for the noise analysis of the
                 R2                            passive feedback voltage amplifier. The spectral densities of all uncorrelated noise
+ Vn1         I1                               sources are given in [V2/Hz] or in [A2/Hz].
- (3)
                                                   The SLiCAP netlist for this circuit is shown below. The controller of the
       I2 R3                                   amplifier is the 'noisy nullor' x1. It is a SLiCAP library element (sub circuit
                                               N_noise) that consists of a nullor with two equivalent-input noise sources. The
                                               spectral densities of these noise sources are parameters of this sub circuit.

                                             1 VampNoise.cir
                                             2 X1 2 3 out 0 N_noise si={S_i} sv={S_v}
                                             3 R1 out 3 {R_b}
                                             4 R2 3 0 {R_a}
                                             5 I1 out 3 I noise={4*k*T/R_b}
                                             6 I2 3 0 I noise={4*k*T/R_a}
                                             7 R3 2 1 {R_s}
                                             8 V1 1 0 V noise={4*k*T*R_s}
                                             9 .end

Figure 7.29: Equivalent noise model of the         The SLiCAP script for evaluation of the source-referred noise and the detector-
voltage amplifier for SLiCAP calculations.
                                                referred noise is shown below. The signal source is the voltage source Vn1. The

                                                detector is a voltage detector between node (5) and the ground.

                                             1 #!/usr/bin/env python3
                                             2 # -*- coding: utf-8 -*-
                                             3 """
                                             4 Created on Mon Mar 29 20:31:51 2021
                                             5
                                             6 @author: anton
                                             7 """
                                             8 from SLiCAP import *
                                             9
                                            10 fileName = 'VampNoise';
                                            11 prj = initProject(fileName)
                                            12 i1 = instruction()
                                            13 i1.setCircuit(fileName + '.cir')
                                            14 htmlPage('Circuit data')
                                            15 head2html('Circuit diagram: ' + fileName)
                                            16 img2html(fileName + '.svg', 600)
                                            17 netlist2html(fileName + '.cir')
                                            18 #
                                            19 i1.setGainType('vi')
                                            20 i1.setDataType('noise')
                                            21 #
                                            22 # Define the source and the detector
                                            23 i1.setSource('V1');
                                            24 i1.setDetector('V_out');
                                            25 #
                                            26 htmlPage('Symbolic noise analysis')
                                            27 i1.setSimType('symbolic')
                                            28 noiseResultSym = i1.execute()
                                            29 noise2html(noiseResultSym)

                                            The HTML output, generated by SLiCAP is shown in Figure 7.30.

                                            Example 7.9

                                            In thist example we will demonstrate the determination of show-stopper values

                                            for Ra, Rb, Sv and Si for a given source resistance, noise figure and voltage gain.

                                            To do so, we assign values to Rs and the voltage gain Av and establish a relation

                                            between Ra and Rb.

                                                                Rb = (Av - 1) Ra,                          (7.24)
    7.5. PASSIVE FEEDBACK 253

Figure 7.30: SLiCAP symbolic noise results.
254 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

    and calcuate the noise as a function of these parameters. This is done in lines
    30-42 of the script:

30 #

31 # Let us find show-stopper values for R_a, S_v, and S_i for the case:

32 # - source resistance: R_s = 600 Ohm

33 # - voltage gain      : A_v = 20

34 # - noise figure      : NF = 2 (3dB)

35 #

36 i1.defPar('R_s', 600)

37 # Define R_b = (A_v-1)*R_a
38 i1.defPar('R_b', '(A_v-1)*R_a')
39 i1.defPar('A_v', 20)

40 i1.setSimType('numeric')

41 # Calculate the noise with the given parameters.

42 noiseResultNum = i1.execute()

       The remaining symbolic variables Ra, Sv and Si as well as their show-stopper

    values Ramax , Svmax and Simax , and the noise factor NF are defined in the python
    environment in lines 43-47 of the script:

43 #

44 # Determine the noise figure NF: (the given procedure works with

45 # frequency-independent noise spectra only)

46 #

47 R_a, S_v, S_i, NF, R_a_max, S_i_max, S_v_max = sp.symbols('R_a, S_v, S_i,' +

48                                               'NF, R_a_max, S_i_max, S_v_max')

       The noise factor is calculated as the ratio of the total source-referred noise spec-
    trum and the spectrum of the noise associated with the signal source. This is
    correct if the noise spectra do not depend on frequency (white noise); see lines
    49-57 of the script:

49 htmlPage('Show-stopper values')

50 #

51 text2html('Let us find show-stopper values for $R_a$, $S_v$, and $S_i$ for ' +

52    'the case in which the noise factor $NF$ equals 2 (3dB).')

53 head2html('Noise factor NF')

54 text2html('The noise factor NF [-] is obtained as:')

55 NFact = sp.simplify(noiseResultNum.inoise/noiseResultNum.inoiseTerms['V1'])

56 eqn2html(NF, NFact);

57 #

       The show stopper values of Ramax , Svmax and Simax are found by solving the
    equation of NF for one variable, while assuming the other noise contributions

    zero. Since zero value for the feedback resistances is not meaningful, the show

    stopper values Svmax and Simax are calculated as a function of Ra; see lines 49-57
    of the script. Figure 7.31 shows the results.

58 # Show stopper (= maximum) value $R_{amax}$ for R_a with S_i=0 and S_v=0

59 Ra_max = sp.N(sp.solve(NFact.subs([(S_v, 0), (S_i, 0)])-2, R_a)[0], 3)

60 head2html('Show-stopper value $R_a$');

61 text2html('The show stopper value $R_{amax}$ for $R_a$ with $NF=2$, ' +

62    '$S_v=0$ and $S_i=0$ is obained as:');

63 eqn2html(R_a_max, Ra_max);

64 #

65 # Show stopper (= maximum) $S_{v,max}$ for S_v as a function of R_a and S_i=0

66 Sv_max = sp.N(sp.solve(NFact.subs(S_i, 0)-2, S_v)[0], 3);

67 head2html('Show-stopper value $S_v$');

68 text2html('The show stopper value for $S_v$ with $NF=2$ and $S_i=0$ can be ' +

69    'obained a function of $R_a$ (setting $R_a$ to zero would be ' +

70    'meaningless):')

71 eqn2html(S_v_max, Sv_max);

72 #

73 # Show stopper (= maximum) $S_{i,max}$ for S_i as a function of R_a and S_i=0

74 Si_max = sp.N(sp.solve(NFact.subs(S_v, 0)-2, S_i)[0], 3);

75 head2html('Show-stopper value $S_i$');

76 text2html('The show stopper value for $S_i$ with $NF=2$ and $S_v=0$ can be ' +

77    'obained a function of $R_a$: (setting $R_a$ to zero would be ' +

78    'meaningless):');

79 eqn2html(S_i_max, Si_max);
                                                                                    7.5. PASSIVE FEEDBACK 255

7.5.3                                                                                                                        Figure 7.31: Derivation and solution of the
                                                                                                                             component design equations for the noise
                                                                                                                             performance.

       Power efficiency of passive feedback configurations

In this section we will summarize the influence of the feedback networks of
the basic passive feedback amplifier configurations on their power efficiency.
These conclusions simply follow from network inspection:

1. The power efficiency of the voltage amplifier from Figure 7.16A is affected by
    the feedback elements as if the series connection of the feedback elements
    is in parallel with the load impedance.

2. The power efficiency of the transadmittance amplifier from Figure 7.16B is
    affected by the feedback elements as if the feedback element is in series with
    the load impedance.

3. The power efficiency of the transimpedance amplifier from Figure 7.16C is
    affected by the feedback elements as if the feedback element is in parallel
    with the load impedance.

4. The power efficiency of the current amplifier from Figure 7.16D is affected by
    the feedback elements as if the parallel connection of the feedback elements
    is in series with the load impedance.
256 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                        7.5.4 Dual-loop passive feedback configurations

    +                                                   Figure 7.32 shows the basic single-nullor dual-loop feedback configurations
                                                        that can be realized with passive feedback alone. These are the gyrator-like
    -                                                   configuration and the transformer-like configuration.
                                                     +
                                                           The gyrator-like configuration from Figure 7.32A has some interesting
                                              -         properties. The impedance Z establishes parallel feedback at both the in-
A                                                       put and the output port (load voltage sensing and source current compari-
                                                        son). Hence, it fixes transmission parameter C. The admittance Y establishes
                                                        input and output series feedback (load current sensing and source voltage
                                                        comparison), which fixes parameter B. Due to voltage drop across the cur-
                                                        rent sensing element Y and current though the voltage-sensing element Z, all
                                                        transmission parameters have been fixed by Z and Y. However, only two of
                                                        them can be fixed independently.

                                                           The transmission parameters of this configuration are:

                                                        A= 1 , B= Z , C= Y , D= 1 .                                            (7.25)
                                                        1 - YZ         1 - YZ                    1 - YZ               1 - YZ
   +                                           +

   -                                           -        This configuration is often applied in characteristic impedance systems.

B                                                       Impedance matching at both ports is obtained if: Zs = Z =     Z.

                                                                                                                      Y

Figure 7.32: Dual-loop passive feedback                 In the transformer-like configuration from Figure 7.32B, a voltage atten-
configurations
                                                        uator (Z1, Z2) and a current attenuator (Z3, Z4) are used to fix transmission
  A: Gyrator-like configuration
  B: Transformer like configuration.                    parameters A and D, respectively. Due to current flow through the voltage

                                                        attenuator and voltage drop across the current attenuator, parameter C is also

                                                        fixed. The transmission parameters are:

                                                        A = Z1 , B = 0, C =     Z1 + Z4                  , D = Z4 .            (7.26)

                                                        Z1 + Z2              (Z1 + Z2) (Z3 + Z4)                      Z3 + Z4

                                                        An accurate input impedance can be obtained if the output port is left open.
                                                        This is true in practice, if Z  Z1 + Z2.

                                                           The configuration has an accurate output impedance if it is driven from an
                                                        ideal current source; in practice, if Zs  Z3 + Z4.

                                                           Other passive single-nullor dual-loop configurations have opposite signs

                                                        for their transmission parameters, which results in a negative input or output

                                                        impedance. This will be demonstrated in the next example.

   parallel       parallel                              Example 7.10
   (current)      (voltage)
   comparison     sensing                                  Let us try to design a passive feedback amplifier that has a finite nonzero input
   at input port  at output                             impedance and zero output impedance. For such an amplifier, we need to fix
                  port                                  the parameters A and C to a finite nonzero value, while having B = D = 0.
                                                        Fixing A requires parallel sensing at the output port and series comparison at
      +                                                 the input port. Fixing C requires parallel sensing at the output port and parallel
                                                        comparison at the input port. With passive feedback, this would give the circuit
                       parallel                         shown in Figure 7.33.

      - (voltage)                                          Circuit analysis shows that

                                      sensing

                       at output

                       port

+ series + +                                                           A = Z2 , C = - Z1 1 ,                                   (7.27)

                (voltage)

      comparison                                                       Z1 + Z2                   Z1 + Z2 Z3

-     at input port -                          -

                                                        which yields:

Figure 7.33: Dual-loop single-nullor passive                           Zi = AC = -Z3 Z2 Z .1                                   (7.28)

feedback configuration with A and C fixed               Hence, the input impedance is negative! In order to obtain a positive input
to a nonzero value and B = D = 0.

                                                        impedance, we need to create a signal inversion in one of the feedback loops. Means

                                                        to achieve this will be discussed in the following sections.
                                                                                  7.6. ACTIVE FEEDBACK 257

7.6 Active feedback                                                               +  +

We have seen that the sign of the transfer of the single-loop passive feedback    -  -
amplifiers from Figure 7.16 is indissolubly connected to the type of their
transfer. The voltage amplifier and the current amplifier have a noninverting     Figure 7.34: Circuit known as an inverting
transfer, while the transadmittance amplifier and the transimpedance ampli-       voltage amplifier.
fier have an inverting transfer. The sign of the transfer is the result of the
feedback topology and the noninverting transfer of the passive feedback net-
work. The inverting voltage amplifier, an inverting current amplifier, as well
a noninverting transadmittance amplifier and a noninverting transimpedance
amplifier, all require an inverting feedback network.

   At a first glance, this may be a strange conclusion. Many experienced
designers know the configuration depicted in Figure 7.34 as the inverting
voltage amplifier. Looking at this circuit from a conceptual point of view, one
might more reasonable call it an inverting transimpedance amplifier (the one
from Figure 7.16C) with an input series impedance for (brute-force) voltage-
to-current conversion. In cases in which the source impedance is very small
and the noise performance is not critical, this solution may be good, but in
other situations, brute force is not the way to go.

   Inverting feedback networks can be constructed with the aid of the transad-
mittance amplifier or the transimpedance amplifier. An inventory of invert-
ing voltage networks and inverting current networks is shown in Figure 7.35.
Since these feedback networks comprise an amplifier, they are active circuits.
Amplifiers that use active feedback networks are called active feedback ampli-
fiers.

   We will discuss the design of single loop active feedback amplifiers in sec-
tion 7.6.1 and that of multiple loop active feedback configurations in section
7.6.2.

      +                                                                           Figure 7.35: Inverting voltage attenuators
                                                                                  (A,B) and inverting current attenuators
   +                                                                              (C, D). These attenuators are realized
                                                                                  with the inverting passive-feedback tran-
            +  +                                                                  simpedance configuration (A, C) or the
                                                                                  inverting passive-feedback transadmittance
                                                                                  configuration (B, D).

   -

      -     -  -

A        B

C        D

7.6.1 Single-loop active feedback

Figure 7.36 shows an inverting voltage amplifier, using transimpedance feed-
back. An alternative solution using transadmittance feedback is left as an ex-
ercise to the reader. The inverting current amplifier, the noninverting transad-
mittance amplifier and the noninverting transimpedance amplifier can be
similarly realized. These configurations are not drawn; they are also left as
an exercise for the reader. The reader is also invited to evaluate the influence
of the feedback elements on the noise behavior and the power efficiency for
258 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

+  +                                          these single loop active feedback configurations.
                                                 Let us now consider the inverting voltage amplifier from Figure 7.36. We
-  -
                                              may generate a new circuit with similar properties by pairing the nullators
Figure 7.36: Active-feedback inverting        and norators differently. This is because a network with nullors has a unique
voltage amplifier.                            solution if the input conditions set by n nullators, can be satisfied with n
                                              norators. Theoretically, there exists no transfer from a nullator to a norator: a
Figure 7.37: Alternative solutions for the    nullator sets a network condition by adding an equation and a norator adds
active-feedback inverting voltage amplifiers  the required extra dependent variable such that the condition can be satisfied.
from Figure 7.36.
                                                 After different pairings of the nullators and norators, a new circuit is found
                                              as the cascade connection of two single loop feedback amplifiers. This con-
                                              figuration is shown in Figure 7.37.

                                                                                                                            +
                                                 +

                                                                                                                   -
                                                 -

                                        7.6.2 Multiple-loop active feedback

                                                  Let us assume we need to design a negative feedback amplifier that has an
                                                  accurately fixed finite nonzero input impedance and zero output impedance.
                                                  We tried this already in section 7.5.4, but with a single nullor and passive
                                                  feedback, this resulted in a negative input impedance because A and C had
                                                  different signs. Equal signs for both transmission parameters requires a sig-
                                                  nal inversion in one of the feedback loops. Hence, there are two different
                                                  realizations for each dual-loop feedback configuration.

Figure 7.38: Examples of dual-loop active
feedback configurations.

    (A) A and C fixed, B = D = 0, inverting
transfer.

    (B) A and C fixed, B = D = 0, nonin-
verting transfer.

                                              +                      +  +                                                      +

                                              -                      -  -                                                      -

                                              A  Inverting transfer     B  Noninverting transfer

                                                 Figure 7.38 shows two of those dual-loop configurations using active feed-
                                              back. Both configurations have A and C fixed to a nonzero value while B and
                                              D are zero. The sign of their source-to-load transfer, however, is opposite.
                                                                     7.7. DESIGN OF BALANCED AMPLIFIERS 259

7.7 Design of balanced amplifiers                                                                         +        +

All the passive and active negative feedback configurations that we have in-                              --
troduced until now had their source and their load connected to the ground.
Configurations with one or two amplifier ports floating with respect to the
ground have not yet been discussed.

   In this section, we will focus on the design of amplifier configurations that
have their input and/or output port floating with respect to the ground.

   In section 7.7.1 we will introduce 'anti-series connection' as the basic tech-
nique for converting unbalanced amplifiers into a balanced ones and discuss
the properties of anti-series connected amplifiers.

   We will show that their transfer, their port impedances, their noise perfor-
mance and their nonlinearity can easily be related to the those of the unbal-
anced amplifiers of which they are constructed.

   Although anti-series connection of unbalanced amplifiers results in am-
plifiers that have their ports isolated from the ground, it does not always
establish an isolation between the input port and the output port.

   Modeling and analysis techniques for studying the common-mode behav-
ior of balanced amplifiers will be discussed in section 7.7.3. In that section
we will introduce techniques for converting a balanced circuit into equivalent
circuits that model their common-mode behavior and their differential-mode
behavior separately.

   Section 7.7.4 will be devoted to the design of amplifiers that have natural
two-port behavior.

                                                                                                          --

7.7.1 Anti-series connected amplifiers                                                                    +        +

Amplifiers that have their ports floating with respect to the ground, can be
obtained from anti-series connection of three-terminal amplifiers. Figure 7.39
shows the principle of anti-series connection of two identical two-ports.

                                                                                         Figure 7.39: Anti-series connection of two

                                                                                         equal two-ports. The dashed line shows

Transmission-1 two-port parameters                                                       the connection if both two-ports are three

                                                                                         terminal networks. If both two-ports have

It can be shown that the transmission parameters of a two-port that consists             transmission-1 parameters A, B, C, and D,

of a series or an anti-series connection of two identical two-ports with trans-          the  resulting  two-port  has  A,  2B,  1 C,  and

                                                                                         D, repectively.                         2

mission parameters A,  B,  C, and D, equal  A,  2B,  1  C,  and  D,  respectively.
                                                     2

Noise behavior of anti-series connected amplifiers

   +                   +                    -               +    +                    -
                                                +                                     -
                                                                                   +

   --                                                       --
   --                                                       --

   +                   +                    -               +    +
                                                                                   +
                                                +

A                          B                                                             C

   The equivalent input noise sources of the (anti-) series connection can be            Figure 7.40: Equivalent input noise sources
obtained from the equivalent input noise sources of the individual two-ports.            of (anti-) series connected two-ports.
Figure 7.40A shows the anti-series connection of the two two-ports with their
individual equivalent input noise sources. This noise representation, how-
ever, is not very convenient for evaluation of the equivalent input noise
sources of the (anti-) series connection. A representation with two voltage
sources is more suited to this situation, because with such a representation,
the total noise voltages at the input and at the output of the resulting two-port
260 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                                  are simply found by adding those of the constituting two-ports. An equiva-
                                                  lent input representation of the (anti-) series connection can then be obtained
                                                  by replacing the output voltage source with equivalent input sources, thereby
                                                  using the transmission parameters of the (anti-) series connection. Figure
                                                  7.40B shows the equivalent voltage noise representation (see Chapter 19.2).
                                                  Figure 7.40C gives the equivalent sources of the (anti-) series connection. The
                                                  power spectral densities of the equivalent noise sources of the (anti-) series
                                                  connection are obtained as:

                                                      Svtot = Svn1 + Svn2 [V2/Hz],                 (7.29)
                                                                                                   (7.30)
                                                      Sitot = 1 Sin1 + 1 Sin2 [A2/Hz].
                                                                       4  4

                                              If both constituting two-ports have identical noise behavior, we have: Svn1 =
                                           Svn2 = Sv [V2/Hz] and Sin1 = S1n2 = Si [A2/Hz]. We then obtain:

                                                                       Svtot = 2Sv [V2/Hz],        (7.31)
                                                                       Sitot = 1 Si [A2/Hz].       (7.32)

                                                                                 2

                                              Consider a noise figure F obtained for a two-port driven from a source
                                           impedance Zs. The anti-series connection of two of those two-ports then has
                                           the same noise figure when driven from an impedance 2Zs.

                                           Nonlinearity of balanced amplifiers

                                           Anti-series connection is an additive compensation technique. If an instan-
                                           taneous nonlinear transfer of the individual (identical) two-ports is modeled
                                           by a Taylor series expansion, the corresponding transfer of the anti-series
                                           connection will show odd terms only; all even terms will be cancelled. As a
                                           consequence, with perfect balancing, the offset and all even order nonlinear-
                                           ity are cancelled.

                                           7.7.2 Balanced single-loop configurations

                                           Figure 7.41 shows the four single-loop balanced amplifiers that are obtained
                                           from anti-series connection of their unbalanced versions.

in+    out+                                in+  out+                                          in+  out+

                                                      in+                    out+

A in-  out- B in-                                                 in-        out-

                                                out- C                                  D in- out-

Figure 7.41: Single-loop balanced ampli-      None of the terminals of these amplifiers has been connected to ground.
fiers:
                                           Hence, their source and/or load can be floating with respect to the ground.
    A: Balanced voltage amplifier          However, if the amplifier itself does not behave as a natural two-port8, par-
    B: Balanced transadmittance amplifier
    C: Balanced transimpedance amplifier
8 D: Balanced current amplifier.
 See section 2.2.3.
                                                                                      7.7. DESIGN OF BALANCED AMPLIFIERS 261

asitic impedances from the source or the load to the ground may limit the
CMRR of the amplifier. The analysis of the common-mode behavior as well
as the design of amplifiers that exhibit natural two-port behavior, will be
discussed in the following sections.

7.7.3 Common-mode behavior of balanced amplifiers

If an amplifier behaves as a natural two-port, it can be configured as a dif-
ferential driver, a differential receiver, or a differential driver-receiver (see
section 2.2.3). A natural two-port is a four terminal network to which the
two-port conditions apply (see Chapter 18.6.1).

   Figure 7.42 shows a four-terminal network with the definitions of the input
and the output common-mode and differential-mode voltages and currents.

+  +                                                                                    Figure 7.42: Definitions of the common-

-  -                                                                                    mode and differential-mode currents and

4-terminal network                                                                      voltages for a 4-terminal network.

                                                                                            Vci common-mode input voltage
                                                                                            Vdi differential-mode input voltage
                                                                                            Ici common-mode input current
                                                                                            Idi differential-mode input current
                                                                                            Vco common-mode output voltage
                                                                                            Vdo differential-mode output voltage
                                                                                            Ico common-mode output current
                                                                                            Ido differential-mode output current.

Natural two-ports have the following properties:

1. Under all conditions, the common-mode current into each port equals
   zero.

2. A common-mode voltage across the two ports does not change the differential-
   mode port quantities.

   As stated before, an anti-series connection of two three-terminal ampli-
fiers, does not automatically result in natural two-port behavior of the result-
ing balanced amplifier.

   In order to study the differential-mode and the common-mode behavior
of balanced amplifiers, we will introduce a method for decomposing bal-
anced networks into common-mode and differential-mode equivalent net-
works, that describe their common-mode behavior and differential-mode be-
havior, respectively.

CM and DM equivalent circuits

There are two ways of decomposing a balanced circuit into common-mode
and differential-mode equivalent circuits.

1. Decomposition based on changing the base of the MNA matrix.

2. Decomposition based on network inspection.

   We will illustrate both techniques with the aid of an example.
   In the following example we will decompose a balanced circuit by chang-
ing of the base of the MNA matrix.

   Example 7.11
       The technique of changing the base of a the MNA matrix has been presented in

   Chapter 18.6.1. We will apply this technique for decomposing the balanced voltage
   amplifier from Figure 7.41A into two circuits: one that describes the differential-
   mode behavior, and another that describes the common-mode behavior. Figure
262 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                         (1)               (3)                              (1)                     (3)
                                   (5)
                                   (7)     (4)                                      (5)
                                   (6)
                                                                 B                       (7)
                         (2)
                                                                                    (6)
      A
                                                                            (2)                     (4)
Figure 7.43: Balanced passive-feedback
voltagre amplifier                         7.43A shows the circuit for determination of the MNA matrix stamp of the com-
                                           plete amplifier. Figure 7.43B shows the definitions of the differential-mode and the
    A: Network for MNA analysis            common-mode currents and voltages.
    B: Network with common-mode and
differential-mode quantities.                  The MNA matrix equation of the network from Figure 7.43A can be formulated

9 V is the vector with nodal voltages and  as
branch currents.
                                                                            I = MV,                              (7.33)

                                           where I is the vector with nodal currents and branch voltages:

                                                       I = I1 I2 I3 I4 I5 I6 I7 0 0 T ,                          (7.34)

                                           M is the MNA matrix:

                                               1                                 0            0 0 0 0
                                                    R0 0                0
                                                    3
                                                0 R13 0 0 0
                                                                                              0     0      0  0  
                                                                                                                 
                                                                    1            1
                                                0 0 R1 0                    - R1              0     0 1 0        

                                                                        1                    - R11               
                                                                                                                 
                                                    00 0                R1       0                  0 01
                                                                                                                       
                                           M=          0 -1                 1+1                     -1           ,
                                                    0                   0   R1 R2             0            0  0  
                                                                    R1                              R2

                                                                                                                      
                                                0 0 0 -1                         0       1 + 1 -1 0 0 

                                                                        R1               R1 R2      R2
                                                0 0 0 0 - R12                                -1     R22 -1 -1    

                                               1 0 0 0                      -1                  R2
                                                                                              0     0 0 0

                                                    01 0 0                       0           -1     0 00

                                                                                                                 (7.35)

                                           and V is the vector with nodal voltages and branch currents:

                                                    V = V1 V2 V3 V4 V5 V6 V7 IN1 IN2 T .                         (7.36)

                                               We would like to write this equation in the form

                                                                           Id,c = M · Vd,c,                      (7.37)

                                           where Id,c is a vector with differential-mode and common-mode variables obtained
                                           from I , M is the modified MNA matrix and Vd,c is the vector with differential-
                                           mode and common-mode variables obtained from V.9

                                              These new vectors can be obtained by converting pairs of nodal voltages and
                                           branch currents into a common-mode, and differential-mode equivalents. Let us,
                                           for example convert the pair of nodal voltages (V1, V2) into a differential-mode
                                                                7.7. DESIGN OF BALANCED AMPLIFIERS 263

voltage Vd and a common-mode voltage Vc. We do this by writing

        V1 =               11                     Vd Vc .              (7.38)
        V2
                           2
                            1
                        -2 1

   Similarly, we can decompose a pair of nodal currents (I1, I2) into a differential-
mode current Id and a common-mode current Ic, by writing

        I1        =        11                     IdIc .               (7.39)

                                   2
        I2              -1 2  1

We can now apply the above transformations to (7.36), and obtain

                  V = A · Vd,c.                                        (7.40)

   The differential-mode quantities in Vc,d are grouped in the first rows, while the
common-mode quantities are grouped in the last rows:

Vd,c = Vd1 Vd2 Vd3 INd Vc1 Vc2 Vc3 INc V7 T .                          (7.41)

The base transformation matrix A then becomes

1 2 0 0 0 10000                                               

 -1         0        0     0          1        0  0  0     0  
2                                                             
                     1
  0         0        2     0          0        0  1  0     0  
                                                              
                     -1
 0          0              0          0 0 1 0 0 
                        2
A =  0      1              0 0 1 0 0 0  .                              (7.42)
            2        0

            -2 1                                              
0                    0     0 0 1 0 0 0
                                                      
 0 0 0 0 0 0 0 0 1

                                                     1
 0 0 0 1 0 0 0 2 0
                           -1                        1
  0         0        0                0        0  0  2     0

   The vector Ic,d with the differential-mode and common-mode variables10, can         10 The vector with nodal currents and
be obtained from I. It can be shown that                                               branch voltages.

                     Id,c = AT·I,                                      (7.43)

where the differential-mode and the common-mode quantities in Id,c are grouped
as in Vd,c:

Id,c = Id1 Id2 Id3 0 Ic1 Ic2 Ic3 0 I7 T .                              (7.44)

The original MNA equation can now be rewritten in the form of (7.37):

        Id,c = AT·I,                                                   (7.45)
            = AT· (M · V) ,                                            (7.46)
            = AT· (M· (A · Vd,c)) ,                                    (7.47)
            = AT·M · A · Vc,d,                                         (7.48)

from which we obtain M as                                              (7.49)
                                M = AT·M · A.

   Since det (A) = 1, we have det (M) = det (M). Hence, the base transfor-
mation does not change the characteristic equation of the network.
264 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                           After substitution of A and M in (7.49), we obtain

                                           1                   0            0 0| 0                   0       0 0 0
                                                  2R3
                                                            1 + 1 -1 0 | 0
                                                  0         2R1 2R2         2R1                      0       0         0  0   
                                                                                                                              
                                                                 1          1
                                           0                   - 2R1        2R1 1 | 0                0       0 0 0 
                                           
                                           1                   -1           0 0| 0                   0                            
                                                                                                             0 0 0

                                                  - -                       - - + - - - - - 
                                           M =  0 0                                                          0 0 0  .
                                                                            0 0| 2                   0
                                                                                         R3
                                                                                                 2 + 2 -2                 -2  

                                                  0            0            0       0| 0         R1 R2        R1       0      
                                                                                                                              
                                                                                                                          R2

                                                                                                                              
                                            0 0                             0 0 | 0 - R21                    2 1 0
                                                                                                             R1
                                                                            0 0 | 1 -1                                        
                                           0                   0                                             0 0 0

                                                  0            0            0 0 | 0 - R22                    0 -1 2

                                                                                                                                 R2

                                                                                                                             (7.50)

                                              As a result of the grouping of the differential-mode quantities and the common-
                                           mode quantities in Ic,d and in Vc,d, the matrix M can be split into four matrices:

                                                                            M = Mdd Mcd ,                                 (7.51)
                                                                                        Mdc Mcc

                                           where

                                           · Mdd describes the differential-mode behavior
                                           · Mcd describes the common-mode to differential-mode conversion
                                           · Mdc describes the differential-mode to common-mode conversion
                                           · Mcc describes the common-mode behavior.

(d1)        (d3)                              In this example, all of the coefficients of both Mcd and Mdc are zero, because
                                           the circuit is perfectly balanced.
      (d2)
                                              The MNA matrix equation of the differential-mode equivalent network can be

                                           written as

                                                                 1               0         0     0 Vd1   
                                                 Id1                         1+1
                                                                       2R3                    1
                                                                            2R1 2R2
                                                       Id2             0                 - 2R1   0       Vd2     
                                                                              -1                                 
                                                               =                            1                       ,     (7.52)
                                                       Id3                         2R1     2R1           Vd3     
                                                            
                                                                       0       -1          0     1  

                                                                                                       
                                                                                                    

                                                       0               1                         0       INd

Figure 7.44: Differential-mode equivalent     The equivalent differential-mode circuit is shown in Figure 7.44. It is of course
circuit of the balanced, passive-feedback  similar to the circuit of one of the passive feedback voltage amplifiers of the anti-
voltage amplifier from Figure 7.43.        series connection.

                                              The MNA matrix equation of the common-mode equivalent network can be
                                           written as

                                             2                              0       000                 
                                                  Ic1                                                      
                                                                  R3                                         Vc1
                                            I  c2   0  R21 + R22 - R21 0 - R2  2   V  c2 
(c1)        (c3)

                                                  Ic3       =       0       -2      2    1       0           Vc3   .      (7.53)
                                                                                    R                              
                                                                               R
                                                                                 1    1                      INc
                                           0
      (c2)                                                                  -1       0   0       0                 
                                                               1
                                                                                                           
                                                                                                        

                                                  I7                0 -2            0 -1 2                   V7
                                                                            R2                   R2

      (7)                                  The common-mode equivalent circuit is shown in Figure 7.45.

Figure 7.45: Common-mode equivalent           In the following example, we will derive the differential-mode and the
circuit of the balanced, passive-feedback  common-mode equivalent circuits through circuit inspection.
voltage amplifier from Figure 7.43.
                                           Example 7.12

                                              Let us now consider the circuit from Figure 7.43B. We can derive a differential-
                                           mode equivalent circuit from it, by setting the common-mode currents to zero,
                                           and by redirecting the differential-mode currents via the node that connects both
                                                   7.7. DESIGN OF BALANCED AMPLIFIERS 265

amplifiers of the anti-series connection (node 7). If we also set Vc1 = 0, the
voltage at node 7 becomes zero and we may connect it to ground and take it as the
reference node. In this way we obtain the circuit from Figure 7.44.

   The common-mode equivalent circuit can be found by assuming all differential-
mode currents and differential-mode voltages in the circuit from Figure 7.43B
zero. In this way we obtain:

V1 = V2, V3 = V4, and V5 = V6.                     (7.54)

We then may connect the corresponding nodes of the two networks with each

other, because there will be no current flow through these interconnections. By

doing so, we obtain two identical networks of which all of their corresponding

nodes have been interconnected. These two networks are the equivalent common-      in+  out+

mode circuits. The circuit diagram of the common-mode equivalent circuit of the

network from Figure 7.43 is shown in Figure 7.45.

CM behavior of single-loop balanced feedback configurations

Let us now study the common-mode behavior of the balanced, single-loop,
passive-feedback configurations from Figure 7.41.

1. The balanced voltage amplifier in Figure 7.41A has unity common-mode            in-  out-
   voltage transfer, an infinite common-mode input impedance and, when
   driven from a finite common-mode source impedance, zero common-mode             Figure 7.46: Balanced voltage amplifier
   output impedance.                                                               with grounded norators.

   The CMRR of this amplifier concept is infinite, because the common-mode         in+  out+
   to differential-mode voltage transfer is zero and does not depend on the
   values of the feedback elements. The differential-mode to common-mode
   transfer depends on the values of the feedback elements. If the circuit is
   perfectly balanced, it equals zero.

   This circuit has none of the terminals of the nullors connected to the
   ground. This makes it impossible to replace them with operational am-
   plifiers at a later stage of the design. However, the position of the norators
   can be changed in such a way that such replacement becomes possible.
   This is shown in Figure 7.46. Such a change, however, may adversely af-
   fect the CMRR.

2. The balanced transadmittance amplifier in Figure 7.41B has natural two-
   port behavior. It can be simplified by combining the two feedback elements
   as shown in Figure 7.47. This circuit has none of its norator terminals
   connected to ground. This makes it impossible to replace the nullors with
   operational amplifiers.

3. The balanced transimpedance amplifier in Figure 7.41C has non-unilateral        in-  out-
   common-mode behavior. The common-mode input impedance depends
   on the load impedance and the common-mode output impedance depends              Figure 7.47: Balanced transadmitance
   on the common-mode source impedance. The circuit can be simplified by           amplifier.
   replacing the two nullors with a single nullor, as shown in Figure 7.48.
                                                                                   in+  out+
4. The balanced current amplifier in Figure 7.41D exhibits natural two-port
   behavior. It has none of its norator terminals connected to ground. This
   makes it impossible to replace the nullors with operational amplifiers.

Common-mode feedback                                                               in-  out-

The common-mode transfer parameters of an amplifier can be designed sep-
arately from its differential-mode transfer parameters. This can be done
through application of both differential-mode feedback and common-mode

                                                                                   Figure 7.48: Simplified balanced tran-
                                                                                   simpedance amplifier.
266 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                                  feedback. However, as a result of the lack of port isolation in passive feedback
                                                  networks, the common-mode behavior of passive-feedback amplifiers cannot
                                                  always be designed independently from their differential-mode behavior.

                                                      The procedure for designing the differential-mode behavior and the common-
                                                  mode behavior independently is:

                                                  1. Design the differential-mode behavior in such a way that the amplifier
                                                      behaves as a natural two-port.

                                                  2. Design the common-mode behavior with the aid of common-mode feed-
                                                      back loops.

                                                      In the following section we will give a brief discussion of the design of
                                                  balanced amplifiers that show natural two-port behavior.

                                                      In section 7.7.6, we will discuss the application of negative feedback for
                                                  design of common-mode impedances. In this section, we will also introduce
                                                  techniques for the correction of the common-mode impedance of balanced
                                                  amplifiers that do not exhibit natural two-port behavior.

    +  +                                                        7.7.4 Design of natural two-ports

in  --    out                                                   In section 7.7.1, we introduced anti-series connection of unbalanced ampli-
                                                                fiers as basic principle for the design of balanced amplifiers. We have seen
Figure 7.49: Creation of natural two-port                       that anti-series connection of two unbalanced passive feedback amplifiers
behavior with the aid of transformers.                          does not necessarily result in amplifiers that behave as natural two-ports. In
                                                                many cases such behavior is desired because it guarantees zero influence of
                                                                common-mode disturbances on the quality of the (differential-mode) signal
                                                                transfer, and it allows for significant flexibility in the drive and termination
                                                                conditions of the input and output port, respectively. In this section, we will
                                                                introduce design techniques for designing balanced amplifiers that behave as
                                                                natural two-port behavior.

                                                                Application of transformers

                                                                One approach to the design of floating input ports is to use an cascade con-
                                                                nection of a passive natural two-port element and an unbalanced amplifier.
                                                                The only available practical component that approaches natural two-port be-
                                                                havior is the transformer. Figure 7.49 shows an arrangement in which input
                                                                and output transformers have been used to convert a unbalanced amplifier
                                                                into a natural two-port. This method is not possible for amplifiers that need
                                                                to process signals with frequency components down to zero.

         in+                                                    DC-coupled natural two-port amplifiers

                                                          out+  Natural two-port behavior for amplifiers that have to process frequencies
                                                          out-  down to zero, can be designed using balanced amplifiers configurations that
                                                                exhibit natural two-port behavior. Candidates are the balanced transadmit-
           in-                                                  tance amplifier and the balanced current amplifier from Figure 7.41B and
                                                                7.41D, respectively.
Figure 7.50: Concept of a balanced voltage
amplifier that exhibits natural two-port                           The natural two-port character of the balanced transadmittance amplifier
behavior.                                                       makes it an ideal building block for designing amplifiers that behave as natu-
                                                                ral two-ports. It also owes its importance to the ease of implementation with
                                                                the aid of three-terminal amplifying devices such as MOS transistors, BJTs
                                                                and vacuum tubes.

                                                                   Figure 7.50 shows the concept of a voltage amplifier with natural two-port
                                                                behavior. It consists of a cascade connection of a balanced transadmittance
                                                                amplifier and a balanced and transimpedance amplifier. The rejection fac-
                                                                tor of this amplifier can be much lower than that of the widespread used
                                                                configuration from Figure 7.46. The CMRR can be very high.
                                                         7.7. DESIGN OF BALANCED AMPLIFIERS 267

Balanced active feedback

Figure 7.51 shows the concept of a voltage amplifier with natural two-port

behavior that utilizes active feedback with a balanced transadmittance ampli-

fier. The amplifier topology from Figure 7.51 is applied in the Analog Devices

AMP01 instrumentation amplifier integrated circuit. The voltage gain of this

circuit can be found as      V = Z2 .
                             Vs Z1
                                                         (7.55)

                                                                                Figure 7.51: Floating port voltage amplifier
                                                                                with active feedback.

     +                                     +

     -                                     -

        input balanced         main        output voltage sensing
        transadmittance        controller  and voltage to current
        with feedback                      conversion with a balanced
        voltage across                     transadmittance

7.7.5 Dual-loop balanced passive feedback amplifiers

In balanced passive-feedback amplifiers, inversion in the passive feedback
network can be realized with the aid of a cross-coupling in a feedback net-
work. Some balanced dual-loop configurations that use this technique are
shown in Figure 7.52. The reader is invited to evaluate their ideal gain and
estimate the influence of the feedback network on the noise behavior of the
amplifiers.

                          +in                 out+  +in                         out+

+in     out+                                                                                   +in               out+

-in     out-                                                                                   -in               out-

                          -in                 out-  -in                         out-

A                         B                         C                                          D

                                                                                Figure 7.52: Balanced dual-loop feedback

CM behavior of dual-loop balanced amplifiers                                    configurations with fixed input impedance

Although cross-coupling in a feedback loop can be used to change the sign       (A, B) and fixed output impedance (C, D)
of a differential-mode transmission parameter, it does not affect the corre-
sponding common-mode transmission parameter. In general, the common-            A:    Zin   =  A,   Zout  =0

                                                                                               C
                                                                                               B,
                                                                                B:    Zin  =        Zout  =  
                                                                                               D
                                                                                               B,
                                                                                C:    Zout  =       Zin   =
                                                                                               A
                                                                                               D,
                                                                                D:    Zout  =       Zin   =  0.
                                                                                               C
268 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS

                                                  mode transmission-1 parameters of a balanced amplifier will differ from its
                                                  differential-mode transmission-1 parameters. However, in many cases the
                                                  common-mode impedance does not need to have an accurately defined value.
                                                  Its value should be such that common-mode noise and interference will not
                                                  cause unacceptable large values of the common-mode voltage at the port and
                                                  the common-mode current through it.

                                                      The analysis of the common-mode port impedance can be done using
                                                  a common-mode equivalent circuit, which can be obtained through circuit
                                                  decompostion, as discussed in section 7.7.3. In the following section we
                                                  will demonstrate such a decomposition for a balanced circuit that has cross-
                                                  coupled feedback. The design of accurate common-mode port impedances
                                                  using common-mode feedback will be discussed in section 7.7.6.

                                                  Decomposition of balanced amplifiers with cross-coupled feedback

                                                  In section 7.7.3, we have studied two ways for the decomposing balanced am-
                                                  plifiers into common-mode and differential-mode equivalent circuits. Trans-
                                                  formation of the base of the MNA matrix, has been presented as a straight-
                                                  forward method that can easily be automated. In the following example we
                                                  will demonstrate the method based upon circuit inspection, and illustrate the
                                                  way in which a cross coupling in the feedback network can be dealt with.

                                                  Example 7.13

-  +                                         -  +       -  +

+  -                                         +  -       +  -

+                     -                           -+                          -+
                         +                           +                           +
-                                            -          -
A                           B                           C

Figure 7.53: Decomposition of a balanced        Let us consider the balanced amplifier from Figure 7.53A. This amplifier has its
dual-loop feedback amplifier with cross-     differential-mode input impedance fixed to a positive value that is defined by the
coupled feedback, into a common-mode         differential-mode transmission-1 parameters A and C. The common-mode input
and a differential-mode equivalent circuit.  impedance, however, is infinite.

    A: Dual-loop passive feedback amplifier     In order to investigate both the differential-mode and the common-mode be-
with A and C fixed by passive-feedback.      havior of this amplifier, we will decompose the circuit into a common-mode and
                                             a differential-mode equivalent circuit. In this example we will demonstrate the
    B: Application of substitution theorem:  decomposition based upon circuit inspection.
replace R1 with a current source that
carries the current of R1.                      In Figure 7.53B the substitution theorem has been applied to replace the cross-
                                             coupled resistor with a controlled current source. The controlled sources can then
    C: Redirect the currents of the con-     be redirected via the interconnection node of the anti-series connection (the black
trolled sources over the common node of      dot in the figure).
the anti-series connection.
                                                The result is shown in Figure 7.53C. The circuit can then be decomposed into
                                             a differential-mode equivalent circuit and a common-mode equivalent circuit as
                                             discussed in example 3.7.12. The result of this decomposition is shown in Figure
                                             7.54.
                                +-                                                 7.8. INDIRECT FEEDBACK 269
                             -
                                                                                  Figure 7.54: Result of the decomposition of
        A                                                                         the amplifier from Figure 7.53.

                                                                                      A: Differential-mode equivalent circuit
                                                                                      B: Common-mode equivalent circuit.

            +                                              +-
                                                        -
                                                 +
                                   B

7.7.6 Design of common-mode port impedances                                       inP

In the previous sections, we have seen that the common-mode behavior of                          1:n

balanced passive-feedback amplifiers cannot always be designed indepen-                                  outP

dently from their differential-mode behavior. This is because natural two-

ports cannot be constructed using exclusively passive feedback elements. If                           1
                                                                                                      :
elements that show natural two-port behavior can be used in combination                               n

with passive-feedback elements, independent design of common-mode and

differential-mode behavior may become possible.

   Figure 7.55 shows the concept of an amplifier that has its transmission        1:n                    outN

parameters A and C fixed by means of negative feedback, both for common-

mode and for differential-mode operation. The differential-mode input im-                     inN

pedance and the common-mode input impedance of this amplifier both equal          Figure 7.55: Concept of a low-noise ampli-
                                                                                  fier of which the differential-mode input
A       Rf                                                                        impedance and the common-mode input
C = 1+n . The analysis is left as an exercise to the reader.                      impedance equal 1+n r f , and the differential-
   Figure 7.56 shows a balanced passive-feedback amplifier of which the val-      mode and the common-mode output
                                                                                  impedance equal zero.
ues of A and C have been fixed, both for common-mode and for differential-

mode. To this end, common-mode feedback with two transadmittance am-

plifiers has been added to the balanced amplifier from Figure 7.52A.

   The reader is invited to determine the values of the transmission-1 param-

eters, both for common-mode and for differential-mode operation.

   inP                             outP                                           Figure 7.56: Balanced amplifier that has
                                                                                  its common-mode and differential input
                                                                                  impedance fixed by means of negative
                                                                                  feedback.

                                                              Common-mode
                                                              feedback with
                                                              transadmittance
                                                              amplifiers fixes
                                                              the common-mode
                                                              current to voltage
                                                              conversion.

   inN                             outN

   The use of passive-feedback for establishing the common-mode impedance,
may adversely affect the signal-to-noise ratio of the balanced amplifier. In
the amplifier from Figure 7.56, the output current noise of the two transad-
mittance amplifiers is uncorrelated, and contributes to the differential-mode
equivalent input current noise of the balanced amplifier.

7.8 Indirect feedback

Indirect feedback or model-based feedback uses indirect sensing of the load
quantity or indirect comparison of the feedback quantity with the source
270 DESIGN OF FEEDBACK AMPLIFIER CONFIGURATIONS                                   -
                                                                                  +
                                                  quantity. Compared with direct sensing techniques, indirect sensing and
                                                  comparison techniques usually results in less accurate feedback amplifiers.-
                                                  This is because variations in the values of the source and/or the load impedance+
                                                  is not always accurately observed by indirect feedback.

                                        7.8.1 Indirect sensing

Figure 7.57: Inverting current amplifier
using indirect feedback.

                                                                                                                                        +
                                                                                                                       -

                                                                                                                                        +
                                                                                                                       -

                                               The circuit from Figure 7.57 shows an example of indirect current sensing

                                            in an indirect feedback current amplifier. The load and the feedback network

                                            are driven from two two-ports whose inputs have been connected in parallel.
                                            If those two-ports have A1 = A2 and B1 = B2, and if the parallel connection
                                            of Z2 and Z2 equals Z, the transfer is solely determined by Z1 and Z2. This
                                            is expressed by (7.56):

                                                  I = Z1 + Z2                Z1 Z2             (7.56)
                                                  Is  Z1
                                                                       A1 Z1+Z2 + B1
                                                                                            .

                                                                         A2Z + B2

                                            7.8.2 Indirect comparison

Figure 7.58: Voltage amplifier using indi-
rect voltage comparison.

                                            +  +      +                +          +            +

                                            -  -      -                -          -            -

                                               The circuit from Figure 7.58 shows an example of indirect voltage compari-
                                            son in an indirect feedback voltage amplifier. The source voltage is converted
                                            into a current and then compared with the feedback current that is derived
                                            from the load voltage in a similar way. The difference between the two cur-
                                            rents is nullified. As with indirect current sensing, the source-to-load voltage
                                            transfer is solely determined by Z1 and Z2 if their parallel connection equals
                                            Zs and if B1 = B2 and D1 = D2. This follows from (7.57)

                                                  V = Z1 + Z2 B1 + D1 ZZ11+ZZ22 .              (7.57)
                                                  Vs  Z1               B2 + D2Zs
                                                         271

8Application and specification of op-

erational amplifiers

8.1 Introduction                                    272

8.1.1 Operational Amplifier types                   272

8.1.2 Idealized models                              273

8.1.3 This chapter                                  274

8.2 Characterization of operational amplifiers      274

8.2.1 Commonly used terms                           275

8.2.2 Terminal voltages and currents                275

8.2.3 Static nonlinear behavior                     276

8.2.4 Noise and small-signal dynamic behavior       276

8.2.5 Large-signal dynamic behavior                 277

8.3 Modeling of the operational amplifier           277

8.3.1 Small-signal dynamic behavior                 278

8.3.2 Noise behavior                                282

8.3.3 PSRR and CMRR                                 284

8.3.4 Bias and offset quantities                    284

8.3.5 Modeling of other effects                     285

8.3.6 Macro models                                  285

8.4 Design of feedback configurations with Op-Amps  286

8.4.1 Single-loop passive feedback configurations   286

8.4.2 Active feedback amplifier configurations      288
272 APPLICATION AND SPECIFICATION OF OPERATIONAL AMPLIFIERS

Figure 8.1: K2-W commercial vacuum tube    8.1 Introduction
operational amplifier (1952).
                                           Operational amplifiers (OpAmps) are high-gain voltage amplifiers that have
  Photo by courtesy of 'Studieverzamel-    a differential input and usually a single-ended output and that operate from
ing Elektrotechniek', Delft University of  DC. They were originally developed as controllers in feedback circuits that
Technology.                                performed mathematical operations in analog computers.

                                              Before integrated circuit operational amplifiers became available, there al-
                                           ready existed operational amplifiers with vacuum tubes (Figure 8.1), and
                                           operational amplifier modules constructed with discrete semiconductors.

                                              The first integrated-circuit operational amplifier, realized in a bipolar IC
                                           technology, was the uA702 (Bob Widlar, Fairchild 1964). Since then, JFET
                                           (1970s), MOSFET (1980s) and BiMOS operational amplifiers have become
                                           available, and their performance is continuously improved.

                                              The operational amplifier is a general-purpose amplifier, intended to be
                                           used as loop amplifier or controller in circuits that exploit negative feedback.
                                           Its intended function thus differs from the one given in section 2.1.1. For
                                           its application as loop amplifier or controller , it needs to provide a huge
                                           gain over a wide frequency range, with less than 180 degrees of phase shift.
                                           This will become clear after studying the chapter on the modeling of negative
                                           feedback amplifiers (Chapter 10).

                                              In modern embedded systems (systems that incorporate a microproces-
                                           sor), operational amplifiers are mainly used in applications such as:

                                           · Loop amplifiers in analog active filters

                                           · Input amplifiers for amplification of low-level signals before A/D conver-
                                              sion can take place

                                           · D/A converter output amplifiers for driving actuators and transmission
                                              lines

                                           · Voltage buffers, summing amplifiers, etc.

                                           8.1.1 Operational Amplifier types

                                           Although the operational amplifier was originally intended to be a general-
                                           purpose building block, a huge number of versions have become available.
                                           Obviously, the operational amplifier is not particularly 'general-purpose' at
                                           all, and the immense diversity of its application justifies this apparently un-
                                           limited number of device types. Manufacturers of operational amplifiers pro-
                                           vide the designers with selection tables to narrow the search for devices.

                                              Another consequence of this trend is that data sheets of operational am-
                                           plifiers often specify the devices for typical applications. If the application to
                                           be designed strongly deviates from this typical application, simulation and
                                           breadboarding are required to ensure performance to requirements.

                                           Architecture

                                           Integrated circuit operational amplifiers have been designed such that a posi-
                                           tive current flow through the load (output source current ) is delivered by the
                                           positive power supply and the negative current flow through the load (out-
                                           put sink current ) is delivered by the negative power supply. This is shown
                                           in Figure 8.2. A small and almost signal-independent quiescent current flows
                                           through the operational amplifier from the positive to the negative power
                                           supply terminal (Class AB output stages).

                                              There exist different architectures for operational amplifiers:

                                           1. Voltage-feedback operational amplifiers
                                                                                   8.1. INTRODUCTION 273

Voltage-feedback operational amplifiers have a balanced input stage that                                 source current       -
converts the differential input voltage into a current that drives an output                                                  +
stage with a transimpedance character. The output current of this type                  +                                     -
of input stage is limited. Parasitic capacitances, as well as the limited              -                                      +
current-drive capability of the input stage, may seriously limit the rate of
change of the output voltage (slew-rate). Since the input stage of voltage-                                sink current
feedback operational amplifiers is well-balanced, the input offset voltage
and the offset current of these operational amplifiers can be very low. This       Figure 8.2: Current flow in the output port
makes these amplifiers very well suited for applications in which a high           of the operational amplifier.
low-frequency (DC) accuracy is required.

Voltage-feedback operational amplifiers may have a rail-to-rail input stages.
In fact, such amplifiers have two input stages in parallel. One operates at
common-mode voltages up to the positive supply voltage and the other
down to the negative supply voltage. Due to this architecture, the behav-
ior of these devices may change with the common-mode input voltage.

2. Current-feedback operational amplifiers

   Current feedback operational amplifiers have a push-pull class AB input
   stage with a high-current-drive capability. This input stage drives an
   output stage with a transimpedance character. Due to the high current-
   drive capability of the input stage, current-feedback operational amplifiers
   can have a very high rate of change of the output voltage. This makes
   them very well suited for high-speed applications. The input stage of the
   current-feedback operational amplifier, however, is strongly asymmetrical.
   This results in a relatively large offset voltage and offset current when
   compared to a voltage-feedback type.

3. Auto-zero operational amplifiers

   Auto-zero techniques are often applied for compensation of offset (zero)
   errors. Auto-zero operational amplifiers have very low offset and are
   mainly intended for low-frequency applications in which DC accuracy and
   temperature stability are of utmost importance.

4. Fully-differential operational amplifiers                                       1 They are designed for a specific structure
                                                                                   of the feedback network of which com-
   Relatively new to the family of operational amplifiers are the so-called        ponent values should be within a limited
   fully-differential operational amplifiers. They are mainly intended for         range.
   driving high-speed differential-input ADCs in digital radio and high-speed
   instrumentation systems with sampling frequencies in the GHz range.
   Fully differential operational amplifiers usually offer a limited design flex-
   ibility.1

8.1.2 Idealized models

As mentioned earlier, operational amplifiers are intended to be used as loop
amplifiers or controllers in negative-feedback circuits. In Chapter 7 we in-
troduced the nullor as the ideal controller. The operational amplifier is a
practical implementation of the nullor. In fact, an operational amplifier can
be regarded as a high-gain voltage-controlled voltage source, which is one of
the possible controlled source approximations of the nullor.

Single-ended output operational amplifier

Figure 8.3 shows the nullor, the VCVS approximation of the nullor and the
implementation with a single-ended output operational amplifier. One of the
terminals of the norator is connected to the power supply terminals. In other
words, the return path for the output current is the power supply.
274 APPLICATION AND SPECIFICATION OF OPERATIONAL AMPLIFIERS

Figure 8.3: The operational amplifier can        concept                approximation                   implementation
be regarded as an implementation of the
nullor. One of the terminals of the norator                             +     +                    +                    -
is connected to the supply ground. Please
notice that the nullator does not have       in           out                                  in       +                +
inverting and non-inverting terminals. See                                                                         -
Chapter 18.3 for the network equations of                               -     -                    -          out
the nullor.                                                                                                             -

                                                                                                                         +

                                             Fully differential operational amplifiers

                                             Figure 8.4 shows an idealized model for a fully-differential operational am-
                                             plifier. These amplifiers usually have a control input for the common-mode
                                             output voltage.

Figure 8.4: Implementation of the nul-           concept       approximation                       implementation
lor with a fully-differential operational
amplifier.

                                                                   inP                   outP  inP + +  outP            +
                                                                                                        outN
                                                               +              +                inC                      -

                                                               - inN         -+                inN - -                  +

                                                                   inC  +  -                                            -

                                                               +                         outN

                                                               -        -

                                             8.1.3 This chapter

                                             In section 8.2, we will briefly discuss the characterization of operational am-
                                             plifiers. Most of the parameters that describe the characteristics of these de-
                                             vices have already been introduced in Chapter 2.

                                                In section 8.3, we will discuss the modeling of operational amplifiers. Al-
                                             though it seems attractive to use so-called macro models for numeric simu-
                                             lation with SPICE, we will not pay much attention to this. This is because
                                             manufacturers of operational amplifiers still encourage the use of data sheets
                                             for design, and prototyping for design verification. Moreover, not all aspects
                                             have been modeled correctly in these macro models. Verification of the macro
                                             models with test circuits that correspond to those given in the data sheets , is
                                             indispensable for reliable design.

                                                Instead of working with one complete model for numeric simulation, we
                                             will pay attention to the modeling of individual performance aspects, both
                                             symbolically and numerically. This gives the designer much more control
                                             over the level of complexity of the models used at different stages of design.

                                             8.2 Characterization of operational amplifiers

                                             Operational amplifiers are often specified with the aid of a collection of pa-
                                             rameters and plots. In this section, we will define the most commonly used
                                             parameters and list some frequently used plots. The reader is invited to
                                                            8.2. CHARACTERIZATION OF OPERATIONAL AMPLIFIERS 275

download some data sheets of operational amplifiers and study them to bet-
ter understand the specification of these components.

8.2.1 Commonly used terms

As mentioned earlier, operational amplifiers are almost always used as con-
trollers in feedback circuits. Hence, they are amplifiers and should be spec-
ified as such, as was discussed in Chapter 2. However, in common design
practice , parameter names can be somewhat confusing. This is because the
specification of operational amplifiers is very much connected to the design
of negative-feedback (voltage) amplifiers. In data sheets of operational am-
plifiers , one often finds the terms closed-loop gain and open-loop gain. In this
book, we try to avoid these terms. We speak rather of the gain of the opera-
tional amplifier, the gain of a negative feedback amplifier and the loop gain of
a negative feedback amplifier. These terms have a well-defined meaning in
the asymptotic gain model , that will be used for the design and analysis of
negative feedback circuits (see Chapter 10).

   The popular term open-loop gain in data sheets refers to the gain of the
operational amplifier. It is a property of the operational amplifier itself and
it does not need a feedback loop for its existence, nor for its definition. This
also holds for the term open-loop output impedance. It is simply the output
impedance of the operational amplifier itself.

   The term closed-loop gain in data sheets refers to the gain of a feedback am-
plifier equipped with the operational amplifier. Hence, it is a property of the
circuit with the operational amplifier, rather than a property of the opera-
tional amplifier itself. This is also the case for the term closed-loop output
impedance.

   In Chapter 10, we will discuss the analysis of circuits with feedback. We
will then relate the gain of the negative feedback amplifier to its ideal gain as
it is defined in Chapter 7, and to the gain of the operational amplifier.

8.2.2 Terminal voltages and currents

name                             symbol      definition                            Table 8.1: Definition of the operational
common-mode input voltage                                                          amplifier's terminal voltages and currents
differential-mode input voltage  Vcm         1  (Vi+   +  Vi- )
bias current                     Vdm         2
common-mode input current        IB I AS
differential-mode input current  Icm         Vi+ - Vi-
output voltage                   Idm
output current                   Vout        Ii+, Ii-
supply current (no load)         Iout
                                 Isu p pl y  Ii+ + Ii-                                                +
                                                                                   +
                                             1  ( Ii+  -  Ii- )
                                             2                                         -                    +

                                             Vout                                  -+

                                             Iout                                                           -

                                             1  (IP  -  IN )                       -   +
                                             2
                                                                                                         -
   Figure 8.5 shows the definitions of the terminal voltages and currents of           -                 +
the operational amplifier. Their general names and definitions are given in
the Table 8.1. These names and definitions will be used throughout this            Figure 8.5: Definitions of the terminal
chapter.                                                                           voltages and currents of the operational
                                                                                   amplifier.
   In the following sections, we will discuss parameters that describe the:

1. Static nonlinear behavior of operational amplifiers (section 8.2.3)

2. Small-signal dynamic behavior and noise behavior of operational ampli-
   fiers (section 8.2.4)

3. Large-signal dynamic behavior of operational amplifiers (section 8.2.5).
276 APPLICATION AND SPECIFICATION OF OPERATIONAL AMPLIFIERS

                                        8.2.3 Static nonlinear behavior

                                                  The parameters that characterize the static nonlinear behavior (also large-
                                                  signal instantaneous behavior) are given in Table 8.2.

name                                          symbol         definition
maximum positive Vcm
maximum negative Vcm                          Vcm+           Vcm < Vcm+ for operation within specifications
offset voltage                                Vcm-           Vcm > Vcm- for operation within specifications
offset voltage drift                          Vo f f         standard deviation of the differential-mode input voltage for Vout = 0
bias current drift                            dVo f f /dT    change of Vo f f with temperature
offset current                                d IB I AS /dT  change of IBIAS with temperature
offset current drift                          Io f f         standard deviation of the differential-mode input current for Vout = 0
quiescent supply current (no load)            dIo f f /dT    change of Io f f with temperature
maximum positive Vout (no load)               IQ             (I+ - I-) /2
maximum negative Vout (no load)               Vout+          positive clipping value of Vout
maximum output source current                 Vout-          negative clipping value of Vout
maximum output sink current                   Iout+          maximum positive value of Iout
                                              Iout-          maximum negative value of Iout

Table 8.2: Parameters that describe the          In many cases, manufacturers of operational amplifiers add graphs to
static nonlinear behavior of the operational  these lists of parameters. These graphs show:
amplifier
                                              1. Temperature dependencies (i.e., bias current versus temperature or versus
source  source                                   the common-mode input voltage)

                                              2. Transfer characteristics (i.e., offset voltage versus the common-mode input
                                                 voltage)

                                              3. Statistical information (i.e., histogram of the offset voltage).

                                                 There are three effects that cause limitation of the low-frequency (static)
                                              signal handling capability of operational amplifiers: limitation of the common-
                                              mode input voltage range , limitation of the output current and limitation of
                                              the output voltage of the operational amplifier. The latter two are related to
                                              each other.

                                              1. Limitation of the common-mode input voltage range of the operational
                                                 amplifier:

                                                 The common-mode input voltage range of operational amplifiers is usually
                                                 smaller than the total supply voltage VP - VN. Only operational amplifiers
                                                 with rail-to-rail inputs have a common-mode input voltage range equal
                                                 to or (slightly) larger than the total power supply voltage. When driven
                                                 beyond these limits, some operational amplifiers show phase reversal , an
                                                 effect that may result in a response, as has been shown in Figure 2.48.

                                              2. Limitation of the low-frequency output current and voltage handling ca-
                                                 pability:

                                                 The maximum current that an operational amplifier can source or sink,
                                                 depending on the load voltage. A typical plot of the voltage and current
                                                 drive capability is shown in Figure 8.6.

sink    sink

Figure 8.6: Voltage and current handling      8.2.4 Noise and small-signal dynamic behavior
capability of an operational amplifier.
                                              The small-signal voltage transfer of the operational amplifier is usually char-
                                              acterized with the aid of Bode plots of the gain and a small-signal step re-
                                              sponse of an application. Amplitude and phase characteristics of the opera-
                                              tional amplifier's voltage transfer are indispensable for the design of stable
                                              negative feedback applications.
                                             8.3. MODELING OF THE OPERATIONAL AMPLIFIER 277

   Modern rail-to-rail output operational amplifiers do not have a negligibly
small output impedance. Bode plots of the output impedance of a feedback
circuit with the operational amplifier are sometimes provided and may be
used to estimate this impedance. In many applications, knowledge of this
output impedance is indispensable for the design of the high-frequency sta-
bility of a circuit. Unfortunately, in many cases, the output impedance of an
operational amplifier is not or incompletely specified.

name                                         symbol definition                   Table 8.3: Parameters that describe the
                                                                                 small-signal behavior and the stationary
common-mode input impedance (complex)        Zcm        dVcm/dIcm                noise behavior of the operational amplifier.
differential-mode input impedance (complex)  Zdm        dVdm/dIdm
voltage gain                                 Adm        dVout/dVdm
output impedance                             Zout       -dVout/dIout
gain-bandwidth product                       GB
spectral density of input noise voltage                 unity-gain frequency
spectral density of input noise current      SVinoise
common mode rejection ratio                  S Iinoise  in series with input
positive power supply rejection ratio        CMRR
negative power supply rejection ratio        PSRR+      parallel with input

                                             PSRR-      dV icm /dV idm |Vout =0
                                                        dV p/dVidm Vout=0
                                                        dV n /dV idm |Vout =0

   Plots of the frequency-dependent spectral densities of the equivalent input
voltage and current noise sources are almost always provided.

   The parameters that describe the small-signal dynamic behavior and the
stationary noise behavior of the operational amplifier are listed in Table 8.3.

8.2.5 Large-signal dynamic behavior

name                        symbol  definition                                   Table 8.4: Parameters that describe the
positive slew rate          SR+     maximum positive rate of change of Vout      dynamic nonlinear behavior of the opera-
negative slew rate          SR-     maximum negative rate of change of Vout      tional amplifier
full-power bandwidth        ffp     maximum frequency for sine wave with
                                    amplitude (Vout+ - Vout-) /2
harmonic distortion         THD     see definition in Chapter 2
intermodulation distortion  IM      see definition in Chapter 2
differential gain                   see definition in Chapter 2
differential phase                  see definition in Chapter 2

   Parameters that describe the large-signal dynamic behavior of operational
amplifiers are listed in Table 8.4. Aside from these parameters, graphs of
pulse responses in typical applications are often provided.

8.3 Modeling of the operational amplifier

The ongoing decrease of component dimensions and the development of
high-density multi-layer printed circuit boards have lead to the development
of complex printed circuit board assemblies. As a consequence, the design
and production of a small number of prototypes of such PCAs have become
relatively expensive. This forces designers to reduce the design risks with
the aid of different design verification methods. In general, there are three
design verification methods available to the designer:

1. Numerical simulation with accurate models that incorporate statistical in-
278 APPLICATION AND SPECIFICATION OF OPERATIONAL AMPLIFIERS

                                                      formation
                                                      Macro models for operational amplifiers are provided by IC manufactur-
                                                      ers. Statistical information, however, is seldom incorporated to these mod-
                                                      els. Moreover, not all behavioral aspects that could be relevant to the
                                                      design may have been modeled correctly. For this reason, the designer
                                                      should investigate whether the measurement results obtained with test
                                                      circuits described in the data sheet comply with the simulation results us-
                                                      ing a similar test setup. The use of macro models will be discussed in
                                                      section 8.3.6

                                                  2. Circuit modeling and symbolic analysis
                                                      During the design of circuits with operational amplifiers , the designer
                                                      has to investigate the influences of various performance aspects of the
                                                      operational amplifiers on the behavior of the complete circuit. If the type
                                                      number of the operational amplifier is known, this can be done with the
                                                      aid of numerical simulation using macro-models.
                                                      However, such simulations can only be performed after a device has been
                                                      selected. Selecting a device, however, is a design decision that needs to
                                                      be motivated. Searching, selecting and evaluating devices without clear
                                                      performance criteria easily turns into a time-consuming trial and error
                                                      scenario.
                                                      For the formulation of clear search criteria, we need to derive and solve
                                                      the so-called design equations. These equations relate the performance
                                                      parameters of a device to those of the circuit that comprises that device.
                                                      Derivation of the design equation requires symbolic analysis. This re-
                                                      quired models that model the performance aspects of interest as simple as
                                                      possible (but not too simple). Modeling techniques for various behavioral
                                                      aspects will be discussed in the following sections.
                                                      We will discuss the modeling of the following behavioral aspects:

                                                      (a) Small-signal dynamic behavior (section 8.3.1)
                                                      (b) Noise behavior (section 8.3.2)
                                                      (c) PSRR and the CMRR (section 8.3.3)
                                                      (d) Bias errors , offset and temperature effects (section 8.3.4)
                                                      (e) Other aspects such as the current and the voltage drive capability and

                                                          slew rate (section 8.3.5)

                                                  3. Conducting experiments
                                                      In many cases, elimination of the most important design risks does not
                                                      require the evaluation of the complete product. The manufacturing and
                                                      evaluation of relatively small proof of concepts , designed to eliminate spe-
                                                      cific design risks at an early stage of the design project, strongly facilitates
                                                      the first-time-right design of the complete product.

                                        8.3.1 Small-signal dynamic behavior

                                                  Small-signal dynamic behavioral model for voltage-feedback opamps

                                                  Figure 8.7 shows the symbol and the small-signal dynamic equivalent model
                                                  of a voltage-feedback operational amplifier. An overview of the model pa-
                                                  rameters is given in Table 8.5. This model suffices for evaluation of the small-
                                                  signal frequency response, the small-signal step response, and the small-
                                                  signal impulse response of circuits with operational amplifiers.
                                            8.3. MODELING OF THE OPERATIONAL AMPLIFIER 279

Name       Description                                                                Table 8.5: Parameters of the small-signal
           Differential-mode input conductance                                        model of the voltage-feedback operational
gd         Differential-mode input capacitance                                        amplifier.
Cd         Common-mode input conductance
gc         Common-mode input capacitance                                              Figure 8.7: Simplified small-signal model of
Cc         Laplace transform of the voltage gain                                      a voltage-feedback operational amplifier.
Av(s)      Laplace transform of the output impedance
Zo (s)

Symbol                Model

p+ p                                                                               o

                   o                                  +
                                                      -
n-
                                                                                   c
        c  n                                                                                                                            +
                                                                                                                          -
                                                                                                                                        +
                                                                                                                          -

                      -
                      +
   Common-mode rejection , power supply rejection , noise , bias current and                                                                  V2
offset current and voltage , as well as temperature effects , are not modeled.
Errors due to these performance limitations will be modeled at a later stage.             (1)                                            (4)
                                                                                                       +
   Figure 8.8 shows the test benches for determination of the voltage gain and            +                                                       (3)
the output impedance of a voltage-feedback operational amplifier. The DC
voltage of the signal source Vs equals zero. For very low frequencies (at DC),        V1       -                                                       +
the circuit is a voltage follower , hence the DC output voltage equals zero.
A DC error voltage at the output due to the DC current in the noninverting                - (5) R1
input of the operational amplifier can be kept low by taking R as low as
possible. If necessary, the DC error voltage can be tuned to zero with the aid                                                                         -
of Vs, or by adjusting the DC current source I1, which provides the current for
the inverting input. The capacitor C1 should eliminate the voltage feedback                                                                       (2)
over the frequency range of interest. The conditions for proper measurement
are:

                                                                                          I1                                                  V3       I2

                      RC  Av(0) ,                                                                                                                 C1
                               2 fmin
                                                      (8.1)                           Figure 8.8: Test circuit for determination of
                        R  Rout,                      (8.2)

                                                                                      the voltage gain and the output impedance

where Av(0) is the expected maximum DC voltage gain of the operational                of a voltage-feedback operational amplifier.
amplifier, fmin is the lowest frequency of interest (it cannot be zero) and Rout
is the expected maximum value of the output resistance of the operational             Av = Vo , Zo = Vo
amplifier. The voltage gain Av(s) is obtained as:                                         Vs   Io

                                         Av(s) = Vo , (8.3)
                                                       Vs

                                          Zo(s) = Vo . (8.4)
                                                        Io

   Below is the syntax for the circuit from Figure 8.8, equipped with the
LT1677 operational amplifier:

1 A_v_Z_o
2 * file: A_v_Z_o.cir
3 * LTSpice netlist file
4 * Test bench for A_v and Z_o of a
5 * voltage-feedback operational amplifier
6 * Default settings:
7 *** measurement of A_v
8 *** +/-5V supply voltage
280 APPLICATION AND SPECIFICATION OF OPERATIONAL AMPLIFIERS

                                              9 *** LT1677 operational amplifier
                                                                      ;change to vs=0 for measurement of Z_o
                                              10 .param vs=1

                                              11 .param io=0          ;change to io=1 for measurement of Z_o

                                              12 V1 0 1 0 AC {vs} 0

                                              13 I2 0 3 0 AC {io} 0

                                              14 I1 0 2 0             ;Adjust this value for zero DC output voltage

                                              15 VP 4 0 5             ;Positive supply voltage

                                              16 VN 0 5 5             ;Negative supply voltage

                                              17 C1 2 0 1meg          ;Adjust this value if necessary

                                              18 R1 3 2 1meg          ;Adjust this value if necessary

                                              19 X1 1 2 4 5 3 LT1677 ;Device Under Test (DUT)

                                              20 .include LTC.lib ;Library file with the subcircuit of DUT

                                              21 .ac dec 20 1 10meg ;AC sweep over frequency range of interest 20 points/

                                                       decade

                                              22 .save v(3)           ;Save the output voltage

                                              23 .end

(inP)  ++           (out)                     Poles and zeros of Av(s) and Zo(s)
(inN)  --
                                              Figure 8.8 shows no difference between the test circuit for measurement of
Figure 8.9: Model of a single-pole op-        Av(s) of Zo(s). Only the values of two independent sources differ for the
erational amplifier with infinite input       two different measurements. This implies that the voltage gain and the out-
impedance, zero output impedance, DC          put impedance have the same poles. Only the zeros of both transfers (8.3)
gain A0 and gain-bandwidth product GB.        and (8.4) differ. However, not all of the poles of the voltage gain may be
                                              observable when measuring the output impedance and vice versa. If a pole
                                              in the output impedance cannot be observed in the voltage gain , then the
                                              voltage gain has a zero at the (complex) frequency of that pole in the output
                                              impedance; and vice versa. The concept of observability of poles is discussed
                                              in section 18.5.

                                                 In SPICE Av(s) can be modeled with a voltage-controlled voltage source
                                              of which the value is defined by a Laplace function. Below, you will find
                                              the syntax for an operational amplifier with a gain-bandwidth product GB, a
                                              DC gain A0 and a first-order high-frequency roll-off. The circuit diagram is
                                              shown in Figure 8.9.

                 (P)                          1 * file: simpleOpamp.cir

                           +                  2 * LTspice subcircuit for simple a 3-terminal OpAmp
                                              3 * A voltage controlled voltage source models A_v(s)
                        -
                                              4 * of a single-pole operational amplifier with
                 (N)                          5 * a DC gain A_0=1Meg and a gain-bandwidth product GB=10MHz

Figure 8.10: In SPICE, a noise-free resistor  6 * noninverting input: inP
can be modeled with the aid of a voltage-
controlled current source.                    7 * inverting input: inN

                                              8 * output:             out

                                              9 * reference node:     0

                                              10 .subckt simpleopamp inP inN out params: A_0=1meg GB=10meg

                        (P)                   11 E1 out 0 inP inN laplace = {A_0/(1+s*A_0/2/pi/GB)}

                 +                            12 .ends simpleopamp

           H1                                    In SPICE Zo(s) can be modeled with network elements like noise-free

                -                             resistors, capacitors and inductors. Noise-free resistors can be alternatively

                        (1)

                 +                            be modeled with voltage-controlled current sources, as shown in Figure 8.10.

           V1                                 1  The dynamic behavior of Zo(s) can be modeled by replacing the DC value
                                              R
           -                                     of  the  controlled  source  with  a  Laplace  expression.  Please  notice  that  the

A      B            (N)                       poles of this expression will be the zeros of Zo(s) and vice versa. Since

                                              Laplace expressions in LTspice cannot have more zeros than poles, this tech-

Figure 8.11: In SPICE, a noise-free           nique cannot be used for modeling capacitive behavior at the highest fre-
impedance with a capacitive character
for the highest frequencies, can be modeled   quencies. This limitation can be solved by adding capacitors, or by using a
with the aid of a current-controlled voltage
source.                                       current-controlled voltage source for impedance modeling, as shown in Fig-

  A: RC parallel connection                   ure 8.11.
  B: Network for a noise-free parallel RC
connection in SPICE.                             Below is the SPICE syntax for a parallel connection of a capacitor with

                                              capacitance C and a resistor with resistance R, according to the model from

                                              Figure 8.11:

                                              1 * file: noiseFreeRC.cir
                                              2 * LTspice subcircuit for a parallel connection of a noise-free resistor
                                              3 * and a capacitor
                                                   8.3. MODELING OF THE OPERATIONAL AMPLIFIER 281

 4 * P: positive node
 5 * N: negative node
 6 * R: resistance
 7 * C: capacitance
 8 .subckt noisefreerc P N params: R=1 C=1

 9 V1 1 N 0

10 H1 P 1 V1 laplace = {R/1+s*R*C}
11 .ends noisefreerc

Small-signal dynamic behavioral model for current-feedback opamps

Figure 8.12 shows the small-signal dynamic equivalent model of current-
feedback operational amplifiers. The input impedances, output impedance
and the differential-mode voltage transfer are modeled, either by using Laplace
expressions or by using equivalent networks. This model suffices for evalu-
ation of the small-signal frequency response, the small-signal impulse re-
sponse and the small-signal step response of circuits with operational ampli-
fiers.

Symbol                                      Model                                                  Figure 8.12: Simplified small-signal model
                                                                                                   of a current-feedback operational amplifier.
p+                                                 -+                                              The transimpedance gain Az and the
                                                                                                   resistance R are usually specified in the
           o  p                                                                                 o  data sheet.

n-

        c

              n                                                    c

   An overview of the model parameters is given in Table 8.6. Common-
mode rejection, power supply rejection, noise, bias current and offset current
and voltage as well as temperature effects are not modeled. Errors resulting
from these performance limitations will be modeled at a later stage.

Name       Description                                                                             Table 8.6: Parameters of the small-signal
           Small-signal conductance between noninverting input and ground                          model of the current feedback operational
gp         Small-signal capacitance between noninverting input and ground                          amplifier.
Cp         Small-signal capacitance between noninverting input and inverting input
Cpn        Transconductance of the input stage
gm         Laplace transform of the output stage's transimpedance
Az(s)      Laplace transform of the output impedance
Zo (s)

   Determination of the transconductance of the input stage and the tran-                                      +
simpedance of the output stage can be done with the aid of the test circuit                                    -
from Figure 8.13. The resistance R should be selected such that:
                                                                                                               +
                                                                                                               -     V2

                 R  Rout,                                          (8.5)

                 R  Az(0).                                         (8.6)                                    +   (3)

                                                                                                                         (2)

   The transconductance gm, the transimpedance gain Az(s) and the output                                    -                 +
impedance Zo(s) are obtained as:
                                                                                                                (4) R1

                 gm = Ii ,                                                                                                               -
                         Vi
                                                                                                                            (1)

                                                                                                                         +

                                                                   (8.7)                                I1           V3       I2
                                                                                                   DC
                                                                                                   AC                    -

                 Az(s) = Vo , (8.8)                                                                Figure 8.13: Test circuit for determina-
                             Ii                                                                    tion of the transconductance, the tran-
                                                                                                   simpedance and the output impedance of a
                 Zo(s) = Vo . (8.9)                                                                current-feedback operational amplifier.
                             Io
                                                                                                     gm = IVii ,Az = VIoi , Zo = VI oo
   The DC current IB needs to be adjusted to bring the DC output voltage in
its linear operating region.
282 APPLICATION AND SPECIFICATION OF OPERATIONAL AMPLIFIERS

                                                  Rail-to-rail output operational amplifiers

                                                  Many modern operational amplifiers have so-called rail-to-rail outputs. These
                                                  devices can drive the load with voltages almost equal to the power supply
                                                  voltages. Older operational amplifiers were not capable of doing so. This all
                                                  has to do with the topology of the output stage used in operational ampli-
                                                  fiers. Rail-to-rail output stages usually exhibit a high low-frequency output
                                                  impedance. This implies that the low-frequency voltage gain of the ampli-
                                                  fier strongly depends on the low-frequency value of the load impedance.
                                                  Although the output impedance of the operational amplifier often plays a
                                                  significant role in the dynamic behavior of its application, it is not always
                                                  specified in the data sheets. For reliable designs, only devices that should
                                                  be used of which the relevant performance aspects for the application are
                                                  specified.

2 An equivalent input voltage noise source     8.3.2 Noise behavior
and an equivalent input current noise
source.                                        A simple noise model , with frequency-independent noise sources, can be ob-
                                               tained by adding input-equivalent noise sources to the small-signal dynamic
   + input                                     model. Figure 8.14 shows the way in which two uncorrelated equivalent in-
                                               put noise sources can be added.2 Both sources have uniform power density
                                               spectra (white noise ). The spectra of the equivalent noise voltage and current
                                               source are given by Sv and Si, respectively:

                               +               Sv = 4kTRnv [V2/Hz],    (8.10)
                               -               Si = 4kT R [A2/Hz]. ni  (8.11)

              ++               Noise-free         The values of the resistors from Figure 8.14 are obtained from these spec-
              --               Operational     tra:
                               Amplifier
                                               Rnv = Sv ,
- input                                                 4kT            (8.12)
                                                                       (8.13)
                                               Rni = 4kT .
Figure 8.14: Modeling of the noise perfor-               Si
mance with the aid of two uncorrelated
noise sources with uniform power density          A SPICE model that includes 1/ f noise can be constructed with the aid of
spectra.                                       a PN diode . The noise model of a PN diode is briefly discussed in Chapter
                                               19.

                                                  Figure 8.15 shows the model for a voltage noise source including 1/ f
                                               noise. The syntax for a SPICE subcircuit is listed below:

I1       (1)              (2)            (3)    1 * file: vn.cir
3.125u                                          2 * LTspice subcircuit of a voltage noise source for noise analysis
                               +                3 * sv: noise voltage density (noise-floor) in V/sqrt(Hz)
              C1    +                           4 * fl: 1/f corner frequency
                               - (4)            5 * Lowest frequency 100uHz
              1 V1                              6 * For lower frequencies increase C1
                               H1               7 .subckt vn 3 4 params: fl=1 sv=1n
                  0-           {sv*1E12}        8 I1 0 1 3.125u
                                                9 D1 1 0 dnoise
         D1                                    10 C1 1 2 1
         dnoise                                11 V1 2 0 0
         kf={3.2e-19*fl}                       12 H1 3 4 V1 {sv*1e12}
                                               13 .model dnoise d kf={3.2e-19*fl} af=1
                                               14 .ends vn

                                                  For frequencies at which the impedance of the capacitor C1 is much smaller
                                               than the small signal impedance of the diode, the current noise of the diode
                                               flows through the voltage source V1. This current is converted into a voltage
                                               by the current-controlled voltage source H1.

Figure 8.15: LTspice subcircuit for a voltage
noise source with 1/ f noise.
                                                                          8.3. MODELING OF THE OPERATIONAL AMPLIFIER 283

The spectral density Si of the noise current through V1 can be written as:

                                                        k f I af-1
                                Si = 2qID 1 + D                        ,                       (8.14)
                                                         2q f

where f is the frequency, kf and af are model parameters, q the charge of

the electron and ID the DC current flowing through the diode. With ID =
3.125µA, we have 2qID = 10-24A2/Hz.

   If af = 1, equation 8.14 can be written as:

                                   Si = 2qID 1 + ff ,                                          (8.15)

where the 1/ f corner frequency f equals:                                                      (8.16)
                                            f = kf .
                                                     2q                                                I1
                                                                                                       3.125u
                                                                                                               (1)              (2)              (3)
Hence, if we want a corner frequency f, we need kf = 2q f.
   Figure 8.16 shows the model for a current noise source including 1/ f                                            C1    +                      (4)
                                                                                                                                     F1
noise. The syntax for a SPICE subcircuit is listed below:                                                           1 V1             {si*1E12}

                                                                                                                        0-

 1 * file: in.cir                                                                                              D1
 2 * LTspice subcircuit of a current noise source for noise analysis                                           dnoise
 3 * si: noise current density (noise-floor) in A/sqrt(Hz)                                                     kf={3.2e-19*fl}
 4 * fl: 1/f corner frequency
 5 * Lowest frequency 100uHz                                                                           Figure 8.16: SPICE subcircuit for a current
 6 * For lower frequencies increase C1                                                                 noise source with 1/ f noise.
 7 .subckt in 3 4 params: fl=1 si=1p

 8 I1 0 1 3.125u

 9 D1 1 0 dnoise

10 C1 1 2 1

11 V1 2 0 0

12 F1 3 4 V1 {si*1e12}
13 .model dnoise d kf={3.2e-19*fl} af=1
14 .ends in

                                C1                (inP)                                                Figure 8.17: LTSpice model of a nullor aith
                                                                                                       added equivalent-input voltage and current
              (1)               1       (2)                                                            noise sources.

                   D1                   +                              ++

                   dnoise           Vi                                      E1

I1                 af =1 kf={3.2e-19*fli} 0 - F1                       -1 -
3.125u
                                                                          (5) (6)
                 (3) C2 Vi (inN) 1 (4) {Si*1E12}             +      -                    (outP)
                                                                                         (outN)
                   D2                   +                           H1           + E2 +
                                                                    Vv
                   dnoise           Vv                              {Sv*1E12}         1

                   af = 1 kf={3.2e-19*flv} 0 -                                   --

Figure 8.17 shows an LTSpice sub circuit for a nullor with added equivalent-

input voltage and current noise sources. Both noise sources are uncorrelated
              1
and  exhibit  f  noise.    The  LTSpice         syntax  for  this  circuit  has  been  listed  below.

1 * Sub circuit nNoise

2 * LTspice subcircuit for a noisy nullor for noise analysis

3 * Lowest frequency 100uHz

4 * For lower frequencies increase C1 and C2

5 * Nodes:         in+ in- out+ out-

6 .subckt nNoise inP inN outP outN params: Sv=1n Si=1p flv=1k fli=10k

7 * Parameters:

8 * Sv: input noise voltage density (noise-floor) in V/sqrt(Hz)

9 * flv: 1/f corner frequency of voltage noise

10 * Si: input noise current density (noise-floor) in A/sqrt(Hz)

11 * fli: 1/f corner frequency of current noise

12 E1 outP 6 inP 5 1

13 E2 outP outN 6 outN 1

14 D1 1 3 DnoiseV

15 D2 3 outN DnoiseI

16 I1 outN 1 3.125u

17 C1 1 2 1
284 APPLICATION AND SPECIFICATION OF OPERATIONAL AMPLIFIERS

                                                               18 C2 3 4 1
                                                               19 Vi 2 3 0
                                                               20 Vv 4 outN 0
                                                               21 F1 inP inN Vi {Si*1e12}
                                                               22 H1 inN 5 Vv {Sv*1e12}
                                                               23 .model DnoiseV D kf={3.2e-19*flv} af=1
                                                               24 .model DnoiseI D kf={3.2e-19*fli} af=1
                                                               25 .ends nNoise

                                             8.3.3 PSRR and CMRR

Figure 8.18: Modeling of the influence       +in  -+              -+                                      +
of the finite CMRR and PSRR. The PSRR                             -+
for the positve power supply and for the     -in  -+-+                                                    -
negative power supply have been modeled           -+              -+
with the transfers PSRR+ and PSRR-,                               -+                                                    Operational
respectively. Frequency dependencies can                                                                                amplifier
easily be implemented with the aid of                                                                                   with infinite
passive transfer networks or Laplace blocks                                                                             PSRR and CMRR
to the inputs of the controlled sources.

                                                The PSSR and the CMRR are defined as the equivalent differential-mode
                                             input voltage sources that compensate for the output voltage change due to
                                             a change of the power supply voltage or of the common-mode input volt-
                                             age, respectively. Modeling can be done according to Figure 8.18. Complex
                                             networks or Laplace expressions can be used for modeling dynamic effects.

                                                The model from Figure 8.18 is not complete. This has already been dis-
                                             cussed with the introduction of the two-port description for amplifiers. A
                                             complete model would also require current sources in parallel with the in-
                                             put, that are controlled by the power supply voltages and the common-mode
                                             voltage. Design data for these controlled sources, however, cannot be found
                                             in the data sheets, since the CMRR and the PSRR are only specified for
                                             voltage-driven inputs.

                                             8.3.4 Bias and offset quantities

                                             Modeling of the static nonlinear behavior (see Table 8.2 for parameters) can
                                             be done in various ways.

                                                In many macro models , the bias current has been modeled with the aid
                                             of active devices. The offset current and the offset voltage have often been
                                             modeled with the aid of an independent current source and an independent
                                             voltage source, respectively. Unfortunately, this is not the correct way to do
                                             it. This is because the mean value of both of the offset quantities of a large
                                             number of devices tends to be zero.

                                                The offset voltage source should be given statistical parameters for Monte
                                             Carlo analysis. Below the SPICE syntax for a voltage between node 1 and
                                             node 0 with a normal distribution with zero mean value and a standard
                                             deviation  = 10mV.

                                              1 MCexample
                                              2
                                              3 * file: MCexample.cir
                                              4 * Example of a Monte Carlo simulation in LTspice
                                              5 * vgauss :Voltage source with Gaussian distribution
                                              6 * positive node = 1, negative node = 0
                                              7 * vmean :Mean value
                                                                      8.3. MODELING OF THE OPERATIONAL AMPLIFIER 285

 8 * vsigma :Standard deviation
 9
10 .params vmean=0 vsigma=10m
11 vgauss 1 0 {vmean + gauss(vsigma)}
12 .op
13 .step param run 1 200 1 ;200 Monte Carlo runs
14 .save V(1)
15 .end

   Bias current sources can be realized in a similar way and placed between
each of the operational amplifier's input terminals and the ground.

8.3.5 Modeling of other effects

Modeling of voltage and current limitations and slew-rate is not always nec-
essary. Macro models that incorporate these effects can become very large
and may cause numerical problems during simulations. An alternative ap-
proach for verification of the influence of these nonlinear effects is to use
linear models exclusively:

1. Plot the derivative of the output voltage of the operational amplifier versus
   time and check if it exceeds the specification for the maximum slew rate

2. Plot the output voltage versus the output current of the operational am-
   plifier and check if it stays within the specified region. Do this by using
   the graphs of the output voltage versus output current of the data sheet.

3. Plot the common-mode input voltage versus time and check if it stays
   within the specified region.

8.3.6 Macro models                                                                3 Boyle, et al. Macromodeling of Integrated
                                                                                  Circuit Operational Amplifiers. IEEE
Macro models are behavioral models that are used for numeric simulation           Journal of solid-state circuits, 9(6), December
with SPICE-like simulators. Macro models for operational amplifiers were          1974
introduced in 1974 by Boyle, Cohn, Pederson and Solomon [Boyle1974]3.
Macro models are comprised of fewer nonlinear elements than transistor-           4 M. Alexander and D.F. Bowers. SPICE-
level models. This strongly facilitates fast computer simulations. The first      compatibe Op Amp Macro-Models. EDN,
macro models, however, only modeled a limited number of performance as-           February, March 1990
pects. Simulation results with these models may strongly deviate from the
real world behavior. Important improvements to these models have been
suggested by Alexander and Derek [AlexanderDerek1990]4.

   Almost all operational amplifier manufacturers nowadays provide macro
models for SPICE simulators. Unfortunately, the underlying equivalent cir-
cuit is not always given. Macro modeling with standardized models and with
clearly defined model parameters, comparable to modeling of semiconductor
devices, is not (yet) common practice. As a matter of fact, almost all opera-
tional amplifier manufacturers advice using the design information from the
data sheets and making use of breadboards for testing specific applications.

   It is strongly advised that designers who want to make use of macro mod-
els first evaluate whether the behavioral aspects of interest have been mod-
eled correctly. This can be done by simulating test circuits identical to those
given in the data sheets. Special attention has to be paid to the following
aspects:

1. Operational amplifiers do not have a specific ground terminal. However,
   if the macro model of an operational amplifier is formed according to
   Boyle, the return path for the output current is the ground node rather
   than the power supply terminals. In such cases simulations fail if the
   operational amplifier is operating at a relatively high voltage with respect
   to the ground. This is corrected in the model presented by Alexander and
   Bowers.
286 APPLICATION AND SPECIFICATION OF OPERATIONAL AMPLIFIERS

                                                      An easy check as to whether the model has an internal connection to the
                                                      ground is to sum all the currents flowing into the external nodes of the
                                                      model when it is supplied from grounded voltage sources. This sum
                                                      should, under all conditions, be zero; if not, some current is flowing to
                                                      the ground.

                                                  2. Most macro models have the offset voltage modeled with a fixed inde-
                                                      pendent voltage source. This may result in canceling of offset voltages in
                                                      circuits with multiple operational amplifiers. In practice, this will not oc-
                                                      cur, because offset voltages and currents of different devices do not match.

                                                  3. The output impedance of the operational amplifier (often referred to as the
                                                      "open-loop output impedance") is not always correctly modeled, neither is
                                                      it fully specified in the data sheet. This makes it difficult to predict the
                                                      dynamic behavior under various loads. Performance evaluation with the
                                                      aid of breadboards may be necessary.

                                                  4. Rail-to-rail input operational amplifiers have two input stages. Related
                                                      effects have not always been modeled in macro models.

                                                  5. A general rule for robust and first-time right design is not to depend on
                                                      device parameters that have not fully been specified. If, for example, the
                                                      output impedance is not specified, but it is critical in the application, it is
                                                      wise to look for a device that has it specified, or to build a test circuit and
                                                      verify its influence.

                                 8.4 Design of feedback configurations with Op-
                                        Amps

                                                +  Isource             -      +  Isource                                                       -
                                                                        +                                                        +              +
                                                            --+                                                                     --
                                                                        +                                                                       +
in out in - I I sink out Vout Iout in - I I sink out Vout Iout

A  B                                                                       C

Figure 8.19: Implementation of the nullor          In this book we do not discuss the transistor-level design of controllers. We
with an operational amplifier hinders           confine ourselves to the application of operational amplifiers as controllers.
current sensing at the output port of the       Implementation of controllers with operational amplifiers, puts serious con-
controller.                                     straints to the design of negative feedback amplifiers. This is because the
                                                return path for the output current differs for positive and negative values.
    A. The nullor is the ideal controller, the  This is illustrated in Figure 8.19. It shows that a grounded load cannot be
nullator sets a network condition and the       combined with a sense element for the load current.
norator provides a current that satisfies this
condition.                                         In this section we will discuss the design of negative feedback amplifier
                                                configurations of which the controllers can be implemented with operational
    B. The operational amplifier can be         amplifiers.
regarded as an implementation of the
nullor. However, for positive values of         8.4.1 Single-loop passive feedback configurations
the output current the return path is the
positive power supply, while for negative       Figure 8.20 shows the basic single-loop negative feedback amplifiers in which
values of the output current the return path    the nullor has been replaced with an operational amplifier. Figure 8.20A
is the negative power supply.                   shows the passive-feedback voltage amplifier. This configuration is often
                                                explicitly referred to as noninverting voltage amplifier configuration. Figure
    C. The common power supply terminal         8.20B shows the (inverting) transimpedance amplifier. Figure 8.20C shows
is usually taken as ground. This makes it
impossible to have both a grounded load
and a grounded current sense element.
                                8.4. DESIGN OF FEEDBACK CONFIGURATIONS WITH OP-AMPS 287

the transadmittance amplifier. This configuration has a grounded source and
a floating load. This is the result of the fact that one of the output terminals
of the controller is grounded (see section 7.2.2). This is also the case in the
current amplifier from Figure 8.20D. In the following sections we will discuss
these single-loop feedback configurations in more detail.

      +                                                                           Figure 8.20: Basic single-loop negative
      -                                                                           feedback configurations with operational
                                                                                  amplifiers.

+                         +                  -
                                                                    +
-                         -
                                             +

                                                                 -

A                               B

   +                                      -

   -                                      +

+
-

C                               D

Noninverting voltage amplifier

The ideal gain of the voltage amplifier from Figure 8.20A is

                          V = Z1 + Z2 .                                (8.17)
                          Vs    Z1

The feedback network affects the noise behavior of the amplifier as if the
parallel connection of Z1 and Z2 is in series with the source impedance.
Low-noise design requires a low impedance for this parallel connection with
respect to the source impedance.

   The power efficiency of the amplifier is affected by the feedback network
as if the series connection of Z1 and Z2 is in parallel with the load impedance.
Low-power design requires a large impedance for this series connection with
respect to the load impedance. The conditions for low-noise and low power
design may conflict in low-gain situations.

Inverting transimpedance

The ideal gain of the transimpedance amplifier from Figure 8.20B is

                                V = -Z1.                               (8.18)
                                Is

   The feedback network affects the noise behavior of the amplifier as if Z1
is in parallel with the source impedance. Low noise design requires a large

impedance for Z1. Independent design of the gain and the noise performance
can be done by cascading the circuit with a low-noise voltage attenuator.

   The power efficiency of the amplifier is affected by the feedback network

like Z1 is in parallel with the load impedance.
288 APPLICATION AND SPECIFICATION OF OPERATIONAL AMPLIFIERS

                                        +      Transadmittance amplifier
                                        -
                                               Figure 8.20C shows a transadmittance amplifier with grounded source and
                       -                       floating load. The feedback impedance Z1 affects the noise of the amplifier
                       +                       as if it is in series with the signal source. It affects the power efficiency as if
                                               it is in series with the load. A configuration for grounded source and load is
   +                                           drawn in Figure 8.21. The load current is now sensed in both power terminals
                                               of the amplifier.
   -                                    +
                                                  The transfer is set by Rsp and Rsn.A difference between the values of Rsp
                                        -      and Rsn results in strong offset and even order distortion. This is a result
                                               of the class AB output stage of the operational amplifier. The resistor in
Figure 8.21: Transadmittance amplifier with    the positive supply terminal carries the bias current plus the source current,
grounded source and load.                      while the resistor in the negative supply terminal carries the bias current plus
                                               the sink current. The resistors RBp and RBn provide the feedback voltage.
                       -                       In order to reduce their noise contributions, these resistors are shunted by
                                               capacitors. These capacitors also provide power-supply decoupling for the
        +              +  +                    amplifier and reduce the even order distortion. The power supply noise adds
                                               up to the total input noise.
       -                  -
A                                                 Although conceptually correct, this circuit is seldom used because of the
                                               drawbacks mentioned above.
                       -
                                               Current amplifier
   ++                  +
                                     +         Figure 8.20D shows a current amplifier with grounded source and floating
                                               load. The principle of current sensing in the power supply leads, as shown
   --                     -                    in Figure 8.21, can also be applied to the current amplifier. In that case the
                                               noninverting input of the operational amplifier is connected to ground, while
B                                              its inverting input is taken as the current input. The circuit has the same
                                               drawbacks as the transadmittance amplifier.
Figure 8.22: Basic configurations for con-
structing operational amplifier circuits with  8.4.2 Active feedback amplifier configurations
active feedback.
                                               As discussed before, active feedback can be exploited as a technique to con-
           -                                   struct amplifiers that cannot be obtained with passive feedback. Figure 8.22
           +                                   shows active feedback elements with an operational amplifier as controller.
                                               The circuit from Figure 8.22A is known as the inverting voltage amplifier. How-
      +                +                +      ever, a low-noise design of this amplifier would require a low value for Z2,
                       -                       which conflicts with a high input impedance. It would be better to call
      -                                 -      this circuit a brute-force voltage to current converter cascaded with a tran-
                       +                       simpedance amplifier. If the circuit is used as a voltage attenuator in the
      A                -                       feedback path of an active feedback amplifier, this conflict is resolved. Figure
                   -                           8.23A shows its application as such in an active-feedback inverting voltage
                                               amplifier of which a low noise addition can be combined with a high input
                    +                          impedance.

      +                                           A circuit that can be used to transfer a floating voltage into a grounded
      -                                        feedback voltage is depicted in Figure 8.22B. This circuit is known as the
                                               differential voltage amplifier, however, if it is applied as such, it has some serious
        B                                      drawbacks that are the result of the applied brute-force techniques:

Figure 8.23: Two examples of active feed-      1. Low-noise design conflicts with low-power design
back amplifiers with opamps:
                                               2. Low-noise design conflicts with a high input impedance at both input
  A: Low-noise inverting voltage amplifier        terminals
  B: Inverting transadmittance amplifier
with grounded load.                            3. Both input terminals have a different impedance to ground

                                               4. The common-mode rejection is limited by the tolerances of the feedback
                                                  impedances.
                                               8.4. DESIGN OF FEEDBACK CONFIGURATIONS WITH OP-AMPS 289

   The output voltage Vo of the circuit can be written as a function of the two
input voltages V1 and V2:

                      Vo = V1 Z1 Z3 + Z4 Z - V 1 + Z2 Z4 2 Z3 Z .4           (8.19)

For differential to single-ended voltage conversion with a gain Av and an

infinite CMRR we need

                       Vo = Av(V1 - V2).                                     (8.20)

This requires

                       Av = Z1 Z3 + Z4 Z = Z3 , 1 + Z2 Z4 Z4                 (8.21)

from which we obtain the design equation:

                       Av = Z1 = Z3 .                                        (8.22)
                               Z2 Z4

   Figure 8.23B shows application of this circuit in an inverting transadmit-
tance amplifier with grounded load. In the following example we will evalu-
ate ideal gain of this amplifier, as well as the contribution of the noise sources
of the active feedback element to the source-referred and the load-referred
noise.

Example 8.1                                                                                    +
                                                                                              -
   Figure 8.24 shows the concept of a voltage to current converter using active
feedback. The load current is sensed by Rs and converted into a floating voltage       Figure 8.24: Transadmittance amplifier with
IRs. This voltage is converted into a voltage Vo, which is referenced to the           active feedback.
ground. The difference between this voltage and the source voltage is nullified.

   The ideal gain Gi of this transconductance amplifier equals

                      Gi = I V = 1 (1 + A) R s ARs (1 + A) R + R .           (8.23)

   If (1 + A) R  R, the sensed current approximates the load current, and the
above expression can be simplified to

                       Gi = I V = 1 s ARs .                                  (8.24)

   Under the above conditions, the spectrum SVi of the source-referred voltage
noise can be obtained as

               SVi = (Sv + 8kTAR) 1 + A2 + (2AR)2 Si,                        (8.25)

where Sv and Si represent the spectrum of the equivalent input voltage noise and

the equivalent input current noise of the controller in the active feedback element,

respectively.

    The contribution of the active feedback element to the total output current noise

is  obtained   after  multiplication  of  SVi  with  G2.  This  yields

                                                       i

                                               1 + A2           R2
                      SIo = (Sv + 8kTAR) 2 2 + 2                        Si.  (8.26)
                                               A Rs             Rs

    From this expression we may derive the following design conclusions:

1. The noise contribution of the feedback network can be kept small by taking Rs as
   large as possible. This, however, conflicts with a high power efficiency.

2. For a low-noise performance we also require R as small as possible and A > 1.
   This conflicts with a high power efficiency and with a high accuracy. The latter
   one requires (1 + A) R  R.
                                                           291

9Introduction to amplifier biasing

9.1 Introduction                                      292

9.1.1 This chapter                                    293

9.2 Basic techniques                                  293

9.2.1 Basic biasing technique                         293

9.2.2 DC coupling and AC coupling                     294

9.2.3 Deriving bias quantities from the power supply  295

9.3 Evaluation of biasing errors                      298

9.3.1 Power supply and resistor tolerances            299

9.3.2 Controller bias imperfections                   305

9.3.3 Total biasing error                             307

9.3.4 Biasing design limits and budgets               308

9.4 Application of error reduction techniques         309

9.4.1 Negative feedback and auto-zero biasing         310

9.4.2 Modulation and demodulation techniques          312

9.5 Common-mode biasing                               313

9.5.1 AC coupling                                     313

9.5.2 DC-coupled floating port amplifiers             313
292 INTRODUCTION TO AMPLIFIER BIASING

                                 9.1 Introduction

                                                  In this chapter, we will give a brief introduction to the biasing of amplifiers
                                                  or amplifier stages. We will start with a definition of the term biasing:

                                                         Biasing is the application of a collection of techniques for fixing the elec-
                                                        trical operating conditions of electronic devices, and deriving the required
                                                        bias voltage and current sources from the power supply voltage(s).

                                                   In Chapter 2 we stated that the ideal behavior of an amplifier can be char-
                                                acterized by three curves:

                                                1. The v - i characteristic of the input port

                                                2. The v - i characteristic of the output port

                                                3. The input-output characteristic.

                                                   Since amplifiers are intended to behave in a linear, stationary and instan-
                                                taneous manner, these characteristics should all be straight lines that pass the
                                                origin (see Figure 2.10). These characteristics should not change over time.
                                                Conceptually, this is true, but in practice, we may need to add offset to these
                                                characteristics to shift them out of the origin.

Figure 9.1: Simple audio digitizing system.     -  Amplifier to be designed:
Only aspects relevant to amplifier biasing      +
are shown.                                         - Adapts microphone voltage range to that of ADC
                                                -  - Power supply voltages to be designed
                                                +
                                                                                                                  ADC

                                                                                                            ADC:

                                                Microphone:                                                 - grounded input
                                                                                                            - input voltage range 0...4V
                                                - one-sided connected to ground
A Probability Density Functions                 - open-circuit output voltage is related to sound pressure
                                                - no DC current allowed
                        Source voltage          - output voltage range -0.1V ... + 0.1V
                        Load voltage            - signal frequency components 20Hz ... 20kHz

                                        not on
                                        scale

-0.1 0 0.1             2                4          Let us, for example, consider the audio digitizer shown in Figure 9.1. The
                                                amplifier must adapt the microphone output voltage range to the input volt-
B Voltage amplification                         age range of the analog to digital converter (ADC). Let us assume the micro-
                                                phone is a electrodynamic type. An electrodynamic microphone comprises
                                4Vpp            a membrane that is connected to a voice coil. This voice coil is placed in a
                                                magnetic field, and any motion caused by a change in air pressure on the
0.2Vpp                                          membrane induces a voltage at the output of the voice coil. Such a micro-
                                                phone can also act as a telephone.
C voltage level shift
                                                   When driven from a signal voltage, the membrane causes a variation of
0                      2                        the air pressure, which can be experienced as sound. Similarly, a DC current
                                                through the voice coil brings the membrane out of its quiescent position.
Figure 9.2: The amplifier in the system         Such a DC bias for a dynamic microphone is undesirable.
from Figure 9.1 must provide voltage
amplification and level shift:                     Hence, the DC input bias current of the amplifier, as introduced in sections
                                                2.4.7 and 8.2.3, is not allowed to flow through the microphone. This can be
  A. The probability density functions of       achieved by using AC coupling between the microphone and the amplifier.
the source voltage and the load voltage         Alternatively, this bias current may be provided by a bias current source, as
                                                discussed in section 2.4.7.
  B. The 0.2Vpp source voltage needs to be
converted into a 4Vpp load voltage. This           Another important aspect of biasing is that the microphone produces a
requires voltage amplification.                 bipolar signal with an average value of zero, while the ADC can only accept
                                                input voltages between 0 to 4V. In the absence of a signal, the ADC input
  C. The mean value of the source voltage
equals zero, while that of the load should
be 2V. This requires a level shift function.
                                                                                       9.2. BASIC TECHNIQUES 293

voltage should equal its midrange value: 2V. Hence, aside from raising the
signal level from 0.2Vpp to 4Vpp, we need to change the zero-signal voltage
level from 0V to 2V. Such an addition of an offset voltage is often referred to
as application of a voltage level-shift , or simply a level shift.

   Figure 9.2 illustrates the combination of the signal amplification function
and the level shift function that both have to be performed by the amplifier.

9.1.1 This chapter                                                                     1 Such techniques are applied in so-called
                                                                                       chopper stabilized amplifiers.
The concept of DC coupling , AC coupling and the application of voltage
level shifts and bias current sources, as well as the selection of the power
supply voltages, will be discussed in section 9.2.

   Basic techniques, such as, AC coupling and application of level shifts do
not always provide sufficiently accurate biasing. Changes in the power sup-
ply voltages, temperature variations and device tolerances may unacceptably
affect the biasing of the amplifier and that of the source and the load. If the
variations in the operating voltages and currents are too large, error reduc-
tion techniques such as compensation, negative-feedback biasing, auto-zero
techniques and modulation techniques1 need to be applied to improve the
stability of the quiescent operating point. The application of error reduction
techniques for improvement of the stability of the biasing will be discussed
in section 9.4.

   A separate section will be devoted to common-mode biasing. In section
9.5, we will discuss techniques for fixing common-mode voltages and/or
currents in balanced amplifiers to their desired values.

9.2 Basic techniques

In this section, we will discuss basic biasing techniques. First, we will discuss
the concept of biasing with level shifts and bias current sources. Then, we
will discuss implementations with AC coupling.

9.2.1 Basic biasing technique                                                          +  +

The application of level shifts and bias currents has already been introduced          -  -
in section 2.4.7. In Figure 2.42, we shifted the quiescent operating point of
the amplifier from (VpQ, IpQ) to (0, 0) by placing a bias voltage source VpQ           Figure 9.3: Concept design of the amplifier
in series with the amplifier port and a bias current source IpQ in parallel            from Figure 9.1.
with the amplifier port. This method can be applied at the input port of the
amplifier and at the output port of the amplifier. In the following example,
we will design the biasing concept of the amplifier from Figure 9.1 using bias
current sources and voltage level shifts.

   Example 9.1

       Let us assume we have designed the amplifier from Figure 9.1 as a passive
   feedback voltage amplifier with a voltage gain of 20. Figure 9.3 shows the concept
   of this amplifier. The source quantity is the one that has the best reproducing
   relation with the primary information (sound pressure), and the impedance of this
   source is the small-signal source impedance. Here, the voltage source Vs and its
   source impedance Zs represent the microphone. The input impedance of the ADC
   is the load impedance Z of the amplifier. During the conceptual design of the
   amplifier, we do not consider the biasing and the power supplies. The amplifier is
   simply assumed to behave as a linear two-port that has the v - i characteristics
   of both ports passing through the origin. The ground node is the power supply
   reference node.
294 INTRODUCTION TO AMPLIFIER BIASING

                                             Figure 9.4 shows the amplifier in which the controller has been implemented
                                          with an operational amplifier and to which bias sources have been added.

Figure 9.4: Implementation of the controller                                                         +          +             +
with an operational amplifier and biasing
concept of the amplifier from Figure 9.3.                                                          -            -             -
                                                                                 +
                                                                              +  -
                                                                    -
                                                                                                     +

                                                                                    R2

                                                                                                   -

                                                                                 R1

                                          Source                                 Amplifier with power supplies  ADC bias      ADC input
                                          model                                  and bias current compensation  compensation  model

2 For the sake of simplicity, we assumed         We start the design of the biasing by choosing the power supply voltages of the
zero equivalent input offset voltage and     operational amplifier such that it can drive the load with ±2V signal excursion.
zero equivalent offset current for the       Figure 9.4 shows these power supply voltages VP and VN for the positive power
operational amplifier.                       supply and the negative power supply, respectively.

                                                 Then, the operating point of the source and the load will be modeled. The 2V
                                             bias voltage of the ADC and the bias current of the ADC have been modeled with
                                             VQ and IQ, respectively. The signal source should operate at zero bias, which
                                             requires no additional bias sources.

                                                 We then start with the design of the biasing of the amplifier. The output voltage
                                             range of the amplifier is adjusted to 0 · · · 4V by adding an output offset voltage
                                             VO = 2V to the output voltage of the amplifier. This is done by inserting a 2V
                                             voltage source between the output of the amplifier and the input of the ADC. The
                                             bias current of the ADC is compensated for by an equally large current source
                                             in parallel with the output port of the amplifier. The input bias currents IiQ
                                             of the operational amplifier have been compensated for by two current sources
                                             with a value IiQ. In this way, both the input port and the output port of the
                                             amplifier operate at zero bias: the v - i characteristics of both amplifier ports pass
                                             through the origin.2 Hence, at zero signal voltage, the source impedance, the load
                                             impedance, the amplifier input port, its feedback network and its output port all
                                             carry no current.

                                             Before we will find a practical implementation for the biasing concept from
                                          Figure 9.4, we will introduce the terms DC coupling and AC coupling.

                                          9.2.2 DC coupling and AC coupling

                                          DC coupling

                                          We speak of DC coupling between a source and a load if there is a nonzero
                                          DC transfer from the source to that load. If there exists only a nonzero trans-
                                          fer for frequencies that differ from zero, we speak of AC coupling.

                                             Figure 9.5A shows two disconnected networks. There is no transfer from
                                          the source current Is to the load voltage V. Figure 9.5B shows the two net-
                                          works connected through a resistive branch. However, there is still no transfer
                                          from the source to the load. Figure 9.5C shows the two networks connected
                                          through two resistive branches. Now there exists a DC coupling from the
                                          source to the load because there is a nonzero DC transfer from Is to V. Fig-
                                          ure 9.5D shows the two networks connected through one resistive and one
                                                                                        9.2. BASIC TECHNIQUES 295

capacitive branch. In this case, there exists a nonzero transfer only for fre-          A: No coupling
quencies that differ from zero, hence we have an AC coupling between the
source and the load.                                                                                    +

AC coupling                                                                             Network 1                     -

Two networks are AC coupled if there only exists a transfer from one network                            Network 2
to the other network for frequencies that differ from zero. Hence, a change in
the DC operating point of a network that has an AC coupling with another                B: No transfer
network, does not cause a change the of the DC operating point of this other
network. The following rules apply to AC coupling :                                                     +

1. AC coupling can be applied if signal components with very low frequen-               Network 1                     -
   cies are not of interest to the observer.
                                                                                                        Network 2
2. AC coupling between a source or a detector and an amplifier has to be ap-
   plied if bias currents or bias voltages of the amplifier ports are not allowed       C: DC transfer
   to appear at the source or at the load.
                                                                                                        +
3. AC coupling between two networks can be established by creating a high-
   pass transfer between the two networks.                                              Network 1                     -

4. If a nonzero DC transfer has to be established, but errors due to bias                               Network 2
   quantities are too large, the frequency range of the information needs to
   be changed such that DC transfer is no longer required. This principle of            D: AC transfer
   modulation and demodulation is applied in so-called chopper amplifiers.
                                                                                                        +
9.2.3 Deriving bias quantities from the power supply
                                                                                        Network 1                     -
There exist many different implementations of the biasing of the amplifier
from Figure 9.1. In the following example, we will design a biasing scheme                              Network 2
with DC coupling between the amplifier and the ADC and AC coupling be-
tween the signal source and the amplifier.                                              Figure 9.5: Coupling between networks:
                                                                                          A: Two disconnected networks
   Example 9.2                                                                            B: The two networks are connected, but

                                                                                        there exists no transfer between the two
                                                                                        networks

                                                                                          C: The two networks are connected and
                                                                                        there exists a nonzero DC transfer from the
                                                                                        left network to the one on the right

                                                                                          D: The two networks are connected, but
                                                                                        there exists only a nonzero AC transfer
                                                                                        between the two networks.

            -                                                                           Figure 9.6: Amplifier from Figure 9.4 with
            +                                                                           2V added to all nodal voltages.

V1 +        +                                         +
    -       -
            +                                         -
    +          R2
    -       -
            R1
 Source  -                                            ADC input
 model   +   V2                                       model
                         DC value of amplifier nodal
                         voltages increased with 2V

   In this example, we will implement the biasing of the amplifier from Figure 9.1      3 This is because accurate low-noise voltage
without the need for a level shift between the output of the amplifier and the ADC.     sources that are floating with respect to the
We will start with the elimination of the 2V voltage source between the output of       ground, are hard to realize.
the amplifier and the input of the ADC.3 To this end, we increase the DC level of
all the nodal voltages of the amplifier with 2V. Figure 9.6 shows the way in which
this is done. Please notice that at the quiescent operating point, all voltage sources
296 INTRODUCTION TO AMPLIFIER BIASING

                                                      except the power supply voltage sources do not carry DC current! This is because
                                                      all the required DC bias currents have been provided by DC current sources.

                                                          Since the frequency contents of the signal does not include DC, AC coupling
                                                      may be applied. With AC coupling, level shifts that do not carry DC currents
                                                      may be replaced with capacitors. These capacitors introduce impedances in series
                                                      with the signal path. These impedances must be small enough not to deteriorate
                                                      the signal-to-noise ratio and the power efficiency of the amplifier. This has to be
                                                      the case at all frequencies of interest.

                                                          Figure 9.7 shows the result of this AC coupling. The capacitors C1 and C2
                                                      can be considered as small batteries implementing V1 and V2 from Figure 9.6,
                                                      respectively. The DC voltage across these capacitors equals 2V.

Figure 9.7: Amplifier from Figure 9.6 with                      -
the level shifts V1 and V2 replaced with                        +
capacitors.

                                                         +

                                             C1          -                                   +

                                                            R2  +                            -

                                                                -

                                                +        R1
                                               -
                                                     C2
                                             Source
                                             model              Biased amplifier with opamp  ADC input

                                                                bias current compensation    port model

4 This can be seen as follows: The common-      In practice, the biasing scheme shown in Figure 9.7 will not provide a
mode input bias voltage error is the prod-   stable and well-defined biasing. This is because the bias currents of the op-
uct of the common-mode input resistance      erational amplifier are usually inaccurately known and strongly depend on
and the error in the common-mode bias        temperature. In addition, the input impedance of the voltage amplifier is
current. Operational amplifiers usually      very high. These two properties result in a very badly defined DC voltage
exhibit a very high input common-mode        at the input of the amplifier, and measures have to be taken to convert this
resistance, an inaccurately defined input    theoretically correct bias solution into a working one.4
bias current and a high relative input-
bias current drift. The product of their        For a complete design, we need to:
common-mode input resistance and the un-
predictable part of the bias current almost  1. Determine the power supply voltages
always exceeds the input common-mode
voltage range.                                  The minimum value of VP equals the positive peak value of the output
                                                voltage plus the maximum value of the voltage drop in the output stage
5 A negative headroom occurs if the voltage     of the operational amplifier. This voltage drop depends on the internal
drive or the current drive capabilities are     structure of the output stage of the operational amplifier, on the temper-
smaller than required.                          ature and on the current delivered by the amplifier. Figure 8.6 shows a
                                                plot of the output voltage and current drive capabilities of an operational
                                                amplifier.

                                                The positive voltage headroom is defined as the difference between this mini-
                                                mum required value of VP and the actual value of VP. The maximum value
                                                of VN is determined in a similar way, now accounting for the negative volt-
                                                age headroom. A large headroom is usually beneficial to the distortion, but
                                                it decreases the power efficiency of the amplifier.

                                             2. Evaluate biasing errors

                                                Power supply tolerances, device tolerances and both the input offset volt-
                                                age and the input offset current of the operational amplifier all introduce
                                                biasing errors. These errors may result in a reduced or even in a negative
                                                headroom.5 Section 9.3 is devoted to this topic.
                                                                                           9.2. BASIC TECHNIQUES 297

3. If necessary, consider the application of error reduction techniques for
   improvement of the accuracy and the stability of the biasing
       If a certain biasing scheme results in unacceptably large biasing errors,
   error reduction techniques may be used to improve the biasing accuracy
   and stability. Application of such techniques will be discussed in section
   9.4.

4. Verify the behavior with computer simulations and prototyping

   In the following example, we will show a complete bias solution and dis-
cuss the above topics qualitatively.

   Example 9.3

         R3             -                                                                  Figure 9.8: Amplifier from Figure 9.7 with
                        +                                                                  brute-force input biasing and without
                                                 -                                         input bias current and load bias current
                                                     +                                     compensation.

                    vp  -
                        +
             +

C1           -

         R4 vn

      +  R1 R2
     -
                        to vp or vn
Source
model    C2 R5

             Biased amplifier without   ADC input

             bias current compensation  port model

       Figure 9.8 shows a possible bias solution for the amplifier.
       In this example, we use an operational amplifier with a rail-to-rail output stage.
   The positive and the negative voltage headroom are assumed to be sufficiently
   large with VP = 4.5V and VN = -0.5V. In this solution, the common-mode
   input voltage of the amplifier should at least range from 1.9 · · · 2.1V, which is
   2.4V below the positive supply and 2.4V above the negative supply voltage.
       The resistors R3 and R4 fix the DC voltage at the noninverting input of the
   amplifier. This way of fixing the voltage at the noninverting input of the opera-
   tional amplifier is basically a brute-force technique. Care should be taken as to the
   possible deterioration of the signal-to-noise ratio and the power efficiency of the
   amplifier. In order to minimize both the noise contribution and its effect on the
   gain, the linearity and the power supply rejection of the amplifier, the resistance of
   the parallel connection of R3 and R4 should be as large as possible. However, for
   a small biasing error, this resistance should be small enough. The biasing errors
   resulting from the input bias current and the offset current of the amplifier are
   proportional to R3 R4.
       If an operational amplifier with the required common-mode input voltage range
   cannot be found, there are two options:

1. Increase the supply voltage such that the input common-mode voltage range of
   the operational amplifier satisfies the requirements.

2. Change the requirement for the common-mode input voltage range of the opamp.

   This can be achieved by changing the values of V1 and V2 in the circuit from
   Figure 9.6. It can be implemented by changing the ratio RR34 and by inserting a
   DC current into the inverting input of the operational amplifier. This DC current
   is the Norton equivalent of the voltage change in V2 in series with R1. A low-noise
   implementation of this current source can be made by inserting a resistor R5, as
298 INTRODUCTION TO AMPLIFIER BIASING

                                                      shown in Figure 9.8. If the common-mode input voltage must be below the DC
                                                      output voltage of the operational amplifier, R5 should be connected to the negative
                                                      supply, and otherwise to the positive supply voltage.

                                            AC decoupling

                                            AC decoupling means minimization of an AC transfer , while maintaining a
                                            DC transfer. It is the opposite of AC coupling ; it requires a low-pass filter
                                            action instead of a high-pass one. In example 9.3, the resistor R5 connects the
                                            signal path of the amplifier to the power supply voltage. The capacitor C2
                                            performs two functions:

                                            1. It acts as an AC coupling capacitor , because it establishes a high-pass
                                               character of the voltage amplifier

                                            2. It acts as an AC decoupling capacitor , because it establishes a low-pass
                                               character in the voltage transfer from the power supply to the output.

                                               In fact, the above can also be said for C1 in combination with R3 and
                                            R4. However, the effectiveness of the AC decoupling by C1 is limited by
                                            Zs. At signal frequencies of interest, C1 should act as a short with respect
                                            to Zs, and at those frequencies, the transfer from the power supply voltages
                                            to the noninverting input of the operational amplifier will only be small if
                                            |Zs|  R3 R4.

Figure 9.9: Amplifier from Figure 9.8 with           R3                              -
a larger PSRR due to improvement of the                                              +
power supply decoupling.                                                                                      -
                                                                                                                  +
                                                                                 vp
                                                                                     -
                                                                       +             +

                                                     R6

                                            C1                      -

                                                                       vn

                                                     R4

                                                  +  C3 R1           R2
                                                 -              C2
                                                                                      to vp or vn
                                            Source                     R5                          ADC input
                                            model                   Biased amplifier without       port model
                                                                    bias current compensation
                                                                    and with improved PSRR

                                               Figure 9.9 shows an arrangement for the amplifier with an improved PSRR

                                            in which extra power supply decoupling has been implemented with C3.
                                            The power supplies, together with R3, R4 and C3, constitute a low noise, low
                                            impedance voltage reference. The resistor R6 connects the noninverting input
                                            of the operational amplifier to this reference, while maintaining a high input

                                            impedance for the voltage amplifier, just as R3 and R4 did in the circuit from
                                            Figure 9.8.

                                            9.3 Evaluation of biasing errors

                                            After we have designed a conceptual solution for the biasing, we need to
                                            evaluate possible error sources and find budgets for them. We will do this
                                            step by step:
                                                                                        9.3. EVALUATION OF BIASING ERRORS 299

1. First, we will evaluate the influence of power supply errors and resistor
   tolerances. To this end, we will replace the operational amplifier with a
   nullor, just as we did with the evaluation of the ideal gain. In order to
   find design budgets for tolerances and temperature coefficients, analysis
   should be done symbolically. We will demonstrate the use of SLiCAP for
   this purpose.

2. Then, we will study the influence of errors due to bias currents and offset
   currents and voltages of the controller. For this, we will add bias and offset
   sources to the nullor. Temperature effects, such as bias current drift and
   offset voltage drift, can be added as well. As mentioned above, design
   budgets will be derived with the aid of symbolic analysis.

3. Numeric verification can be done with the aid of SPICE using Monte-
   Carlo analysis at different temperature settings.

9.3.1 Power supply and resistor tolerances

For investigation of the influence of supply voltage changes and resistor tol-
erances, we will simplify the schematic of the amplifier as follows:

1. Capacitors will be left out; if this breaks a DC loop, all elements in that         (1)
   loop can be left out as well
                                                                                 V1 +       R3 R6
2. All controllers will be replaced with nullors
                                                                                     -             (4) N1
   Figure 9.10 shows the simplified diagram. In this case, the load has also
been left out. This is done because, the controller having been replaced with              (2)
a nullor, the load has no effect on the biasing of the amplifier.
                                                                                 V2 + R4
Determination of the numerical values
                                                                                 -                                    (6)
In order to find initial numerical values for the power supply voltages and                     (5)
the resistors, we need to derive and solve the design equations of the circuit.       (3)
A symbolic expression for the voltage at the output of the amplifier can easily                            R2
be obtained with SLiCAP symbolic DC analysis. The netlist of this circuit is
shown below:                                                                     Figure 9.10: Simplified biasing scheme of
                                                                                 the amplifier from Figure 9.9 for evaluation
 1 VampBiasNullor                                                                of the influence of power supply and
 2 * file: VampBiasNullor.cir                                                    resistor tolerances.
 3 * SLiCAP netlist file
 4 V1 1 0 V dc={V_P}
 5 V2 0 3 V dc={V_N}
 6 R3 1 2 {R_a}
 7 R4 2 3 {R_b}
 8 R6 2 4 {R_c}
 9 R2 5 6 {19*R}
10 N1 6 0 4 5
11 .end

    The SLiCAP script for evaluation of the DC voltage V6 at node (6) is:

1 #!/usr/bin/env python3

2 # -*- coding: utf-8 -*-

3 # file: VampBiasNullor.py

4

5 from SLiCAP import *

6

7 fileName = 'VampBiasNullor.cir'

8 i1 = instruction()          # Creates an instance of an instruction object

9 i1.setCircuit(fileName) # Checks and defines the local circuit object, and

10                            # sets the index page to the project index page.

11 i1.setDetector('V_6')

12 i1.setSimType('symbolic')

13 i1.setGainType('vi')

14 i1.setDataType('dc')

15 result = i1.execute()
300 INTRODUCTION TO AMPLIFIER BIASING

                                                 16 DCvalue = result.dc
                                                 17 #
                                                 18 i1.setDataType('dcsolve')
                                                 19 result = i1.execute()
                                                 20 DCsolution = result.dcSolve
                                                 21 #
                                                 22 htmlPage('Netlist and circuit data')
                                                 23 netlist2html(fileName)
                                                 24 elementData2html(i1.circuit)
                                                 25 #
                                                 26 htmlPage('DC analysis')
                                                 27 text2html('The DC voltage $V_6$ is obtained as:')
                                                 28 eqn2html('V_6', DCvalue, units = 'V')

                                                 Running this script yields an expression for the detector voltage V6:

                                                 V6 = VP Rb - VN Ra Ra + R . b                                          (9.1)

                                                    This result could, of course, just as easily be obtained with hand calcula-

                                                 tions using the superposition theorem.

                                                    In order to assign numerical values to Ra and Rb, we need more design
                                                 equations. Numerical values for VP and VN follow from the requirement
                                                 for the load voltage range and budgets for the positive and the negative

                                                 headroom:

                                                 VP = Vmax + VH+,                                                       (9.2)

6 Please notice that this results in a negative  where Vmax is the maximum positive voltage to be delivered to the load, and
voltage at the power supply terminal of the      VH+ is the positive headroom required for proper operation of the opera-
operational amplifier.                           tional amplifier.

                                                    An acceptable value for VH+ requires some knowledge about available
                                                 components. Let us assume that, for example, a positive headroom VH+ =
                                                 0.25 · · · 0.5V leaves us a sufficiently large number of operational amplifiers

                                                 from various manufacturers.

                                                    Similar things can be said about VN. The minimum load voltage Vmin
                                                 should be zero, and with a negative headroom about equal to the positive
                                                 headroom, we can work with VP = 4.5V and VN = 0.5V.6

                                                    This leaves us with two variables and one equation, so at this stage of the

                                                 design, we can only determine the ratio of Ra and Rb:

                                                                                 Rb = Ra.                               (9.3)

                                                 The design equation for  can be derived from:

                                                 V6 = VPRa - VN Ra Ra + Ra .                                            (9.4)

                                                 The solution for  is found as:

                                                  = VN + V6 .                                                           (9.5)
                                                       VP - V6

                                                 With VN = 0.5, V6 = 2 and VP = 4.5, we obtain  = 1, and hence Ra = Rb

                                                 Influence of supply and resistor tolerances

                                                 For the investigation of the effects of device tolerances, designers have three
                                                 techniques at their disposal:

                                                 1. Worst-case analysis
                                                    This is a technique that accounts for maximum deviations in component
                                                    values, in which the sign of the deviation is chosen so as to maximize its ef-
                                                    fect. Worst-case analysis can be performed symbolically, and the direction
                                                    of the deviation can be obtained with the aid of sensitivity analysis.
                                                                            9.3. EVALUATION OF BIASING ERRORS 301

2. Symbolic statistical analysis

   This technique uses the probability density functions of component values.
   It requires knowledge of algebra for random variables, which is a rather
   specialized discipline.

3. Monte-Carlo analysis

   Monte-Carlo analysis is a numerical technique running a simulation mul-
   tiple times with different component values. At the beginning of each
   run, component values are randomly assigned according to pre-defined
   distribution functions and correlations.

   Worst-case analysis may give clear a-priori insight into the effect of device
tolerances, but it requires complex sensitivity analysis and may result in an
overkill of robustness of the design. At first glance, this may appear attractive,
but this overkill may seriously limit the feasibility of a design.

   Monte-Carlo analysis can only be performed after devices have been se-
lected, and it is therefore a verification technique, rather than a synthesis
tool.

   Symbolic statistical analysis would probably be the best way to go, but
the algebra of random variables is complex and does not lend itself to hand
calculations. Moreover, it is questionable whether such a complex technique
will provide results that can be interpreted by the designer and yield clear
design conclusions.

   SLiCAP incorporates a simplified symbolic statistical analysis technique
that, in many cases, gives clear design information with sufficient accuracy.
The technique is only available for DC analysis and can be applied for setting
up requirements for device tolerances , temperature drift and bias and offset
voltages and currents of operational amplifiers. The method is based on the
following principles:

1. In a linear network, the variance of a DC nodal voltage or a DC branch
   current can be obtained from linear superposition of the contributions of
   the variances of all of the independent sources in the network to that nodal
   voltage or branch current.

2. If tolerances of resistors are relatively small, errors due to these device
   tolerances can be converted into independent error current sources in par-
   allel with the corresponding resistors. The contributions of these sources
   to the variance of a DC nodal voltage or a DC branch current can then be
   accounted for as described above.

3. This technique is allowed as long as the transfers of the independent
   sources to the output of the system are not noticeably affected by changes
   in the resistor values. This is often the case, and this condition can be
   easily be verified through symbolic analysis.

    The conversion of the deviation of the resistance of a resistor from its

mean value into an independent current source in parallel with the resistor

proceeds as follows:

    Let us assume we need a resistor with a resistance of R []. The DC

voltage across this resistor in the application equals V [V], hence the DC
                                      V
current   through  it  equals  IR  =  R  [A].  Let  us  now  replace  this  resistor  with

another one that has a resistance R + R instead of R. If R  R, the voltage

across it will not significantly change. The current then changes from IR to
               V,
IR  +  I  =        where  the  error  current  I    is  defined  as:
             R+R

                                   I = V R + R - IR. (9.6)
302 INTRODUCTION TO AMPLIFIER BIASING

                                                  This can be written as:

                                                                                I = IR         R 1 - 1 .                                 (9.7)
                                                                                           1+ R

                                                  Since   R      1,   we   may  write:
                                                           R

                                                                                        R 1  1 - R , (9.8)R
                                                                                     1+ R

                                                  from which we obtain:
                                                                                      I = IR R (9.9)
                                                                                                      R

                                                  If  R       1  and  the  probability  density     function  of  R  is  symmetrical   around
                                                       R
                                              its mean value, the probability density function of I will have the same shape

                                              as that of R. Hence, if R has a Gaussian distribution, the distribution function

                                              of the current I will also be Gaussian and the relative standard deviation of

7 The relative standard deviation of a        I will equal that of R.7
random variable is the ratio of its standard
deviation to the mean value.                      Example 9.4

                                                      In this example, we will derive a symbolic expression for the standard devia-

                                                  tion of the voltage at the output of a resistive voltage divider, given the standard

                                                  deviation of the resistor values and of the driving voltage. To this end, consider

                  R1                              the circuit shown in Figure 9.11. The standard deviation of the voltage Vs is 1Vs,

            +                                     where 1 is the relative standard deviation of Vs, say, for example, 1%. The same
V1 -
                                                  holds for 2 and 3; these are the relative standard deviations of Ra and Rb, re-

                  R2      +                       spectively. In this example, we assume no correlation between the resistor values,

                          -                       nor between the voltage Vs and the resistor values.

                                                      The resistor tolerances can be transformed into error currents as described

                                                  above. According to expression (9.9), the standard deviation I1 of the current
                                                  of I1 can be obtained as:
Figure 9.11: Resistive divider with driving                                          I1 = 2 Vs Ra + R .b
voltage source. All element values have a                                                                                                (9.10)
Gaussian distribution function.

                                                      The standard deviation of the current I2 can be obtained in a similar way:

                                                                                     I2 = 3 Vs Ra + R .b                                 (9.11)
                                                      The results are shown in Figure 9.12A.

                      R1                      I1                                               R1             I1

               +                                                                     +

V1 - + V1 - +
                      R2                      I2                                               R2

                                                                 -                                                                  -

               A                                                                     B

Figure 9.12: Resistor tolerances translated           If we assume a symmetrical distribution function for the resistor values, the
into error current sources.
                                                  signs of the error currents are not important. Since no correlation exists, we
8 The variance is the squared value of the
standard deviation.                               may     calculate  the  variance8    2   of  the  output  voltage  Vout  as  the  sum  of  the

                                                                                     Vout
                                                  contributions of the individual sources. Each of those contributions equals the

                                                  product of the variance of the independent source and the square of its conversion

                                                  gain to Vout. The conversion gain of the error currents I1 and I2 to the output

                                                  voltage Vout equals the parallel connection R1 R2.
                                                                    9.3. EVALUATION OF BIASING ERRORS 303

   In this way, we may write:

2  22            Vs 2           Ra Rb      2     2   V2         Rb 2 .
              Ra + Rb          Ra + Rb                       Ra + Rb
Vout = 2 + 3                                  +   1    s                           (9.12)

   The standard deviation Vout of the output voltage Vout can thus be obtained
as:

   Vout = Vs Rb Ra + Rb           Ra       2
                               Ra + Rb
                                              2 + 2 + 2.                           (9.13)
                                                 23              1

   The relative standard deviation VVout out of the output voltage is found to be

              Vout =              Ra    2
              Vout             Ra + Rb
                                           2 + 2 + 2.                              (9.14)
                                           23             1

   We may check this result by considering a few special cases:

1. If Ra = 0, the relative tolerance equals that of the source. This is as expected,
   because in that case, the output voltage equals the source voltage!

2. With Rb  Ra and equal value for all tolerances ( = 1 = 2 = 3), the rela-
   tive tolerance approaches a maximum value of  3. This is considerably less than

   we would have obtained from a worst-case scenario. A worst-case approximation
   with + relative error for Vs and Rb, and a relative error of - for Ra, yields a
   relative error Vout for Vout of about 3.

   In the next example, we will demonstrate the application of SLiCAP for
the symbolic determination of the standard deviation of the voltage at the
output of the resistive divider.

   Example 9.5

       The SLiCAP netlist file of the circuit from Figure 9.11 is listed below:

 1 "Voltage divider"
 2 * File: vDivider.cir
 3 * SLiCAP netlist file
 4 V1 1 0 V dc={V_S} dcvar={(sigma_1*V_S)^2}
 5 R1 1 out r value={R_a} dcvar={(sigma_2*R_a)^2}
 6 R2 out 0 r value={R_b} dcvar={(sigma_3*R_b)^2}
 7 .end

   The variance of the supply voltage requires the use of the model 'V 'for the

voltage source. The mean value of a voltage source, or simply its DC voltage, can

be defined with the model parameter 'dc', and the variance of the voltage of this

source can be defined with the parameter 'dcvar'. The units of the variance are
[V2]. Here, it has been defined as the square of the product of the DC voltage and

the relative standard deviation 1.
   Statistical properties for a resistor can be defined by using the model 'r' and

the parameters 'value' for the mean resistance and 'dcvar' for the variance of the
resistance in [2]. The relative standard deviation of R1 and R2 are 2 and 3,
respectively.

   Below, the listing of the SLiCAP script.

 1 #!/usr/bin/env python3     # Creates an instance of an instruction object
 2 # -*- coding: utf-8 -*-    # Checks and defines the local circuit object and
 3 # File: vDivider.py        # sets the index page to the circuit index page
 4
 5 from SLiCAP import *
 6
 7 fileName = 'vDivider.cir'
 8 i1 = instruction()
 9 i1.setCircuit(fileName)
10
304 INTRODUCTION TO AMPLIFIER BIASING

                                                               11 #
                                                               12 htmlPage('Netlist and circuit data');
                                                               13 netlist2html(fileName);
                                                               14 elementData2html(i1.circuit);
                                                               15 #
                                                               16 htmlPage('DC variance analysis');
                                                               17 i1.setDetector('V_out')
                                                               18 i1.setSimType('symbolic')
                                                               19 i1.setGainType('vi')
                                                               20 i1.setDataType('dcvar')
                                                               21 result = i1.execute()
                                                               22 dcVar2html(result)

                                                        Lines 15 · · · 21 of the SLiCAP script define and execute the instruction for
                                                      symbolic evaluation of the variance of the detector voltage and display the results
                                                      on a separate html page.

Figure 9.13: SLiCAP analysis results.     The output html page is shown in Figure 9.13. It also shows the DC solution of
                                       the network. With the aid of this solution, SLiCAP translates the resistor toler-
                                       ances into error current sources, just as discussed above. The current sources that
                                                                                    9.3. EVALUATION OF BIASING ERRORS 305

model the errors of R1 and R2 have been named I_R1 and I_R2, respectively. Their
contributions to the detector-referred variance are listed in the section "Contri-
butions of individual variances" of the output page.

9.3.2 Controller bias imperfections                                               O_dcvar               Vo+  -       (3)  (4)
                                                                                                 (5) Ib
We will now investigate the influence of controller bias imperfections on the      (1)                               N1
biasing solution of the network. In fact, we want to investigate the way           Io
in which and to what extent the offset voltages, the bias currents and the         (2)
offset current of the controller affect the DC output voltage of the circuit
from Figure 9.9.                                                                             F1

   If we know this, we will be able to define budgets for these offset and bias        (COMMON)
quantities and add them to the search criteria for operational amplifiers that
may be used for implementation of the controller.                                 Figure 9.14: Operational amplifier modeled
                                                                                  as a nullor with added bias and offset
   In order to keep things as simple as possible, we need a model of a con-       sources.
troller that models these imperfections alone.
                                                                                                            X1
   Figure 9.14 shows such a possible model. It consists of a nullor which                                   O_dcVar
provides the infinite available power gain and sources that model the imper-
fections of interest. The voltage source V1 models the equivalent-input offset    R1
voltage. The mean value of this source is taken as zero and the standard
deviation vo [V]. Zero mean value for this source is a good starting point,                         (3)         (out)
because manufacturers want to create zero offset error, but due to device                        (4)
tolerances, there will remain a small error that can be positive or negative.
                                                                                                      R2
   The current source I2 models the offset current. For similar reasons as
those related to the offset voltage source, the mean value of this source is      Figure 9.15: Circuit for studying the in-
also zero. Its standard deviation is taken as io.                                 fluence of the bias imperfections of the
                                                                                  controller. It has been derived from the
   The two input bias currents that are required for the operation of the input   circuit from Figure 9.10. The power suppy
stage have been taken as equal. In this model, they are correlated. This          voltage has been set to zero. The value of
correlation is achieved by deriving them from one source: I1. This source         RB1 is: Ra Rb + Rc. The value of R2 is
has been given a mean value Ib and a standard deviation ib Ib. Correlation        19R. The nullor has been replaced with the
between the two input bias currents usually occurs in operational amplifiers      nullorWithBias sub circuit from Figure
with a BJT input stage. The input bias currents of the JFET MOS input stage is    9.14.
usually very low. The bias currents of a MOS operational amplifier is usually
dominated by leakage currents in the protection diodes. Correlation between
the two input bias currents in those types of operational amplifiers may be
considerably lower.

   Unfortunately, correct modeling of the input bias currents and offset cur-
rent requires manufacturing data that are not always provided to a level of
detail that would include these correlations.

   The SLiCAP netlist of the circuit from Figure 9.14 can be found in the
library file: SLiCAP.lib. It is shown below:

 1 .subckt ABCD 1 2 3 4 A={A} B={B} C={C} D={D}
 2 N1 1 5 3 7
 3 E1 7 8 1 2 {A}
 4 H1 8 4 6 5 {B}
 5 G1 3 4 1 2 {C}
 6 F1 3 4 2 6 {D}
 7 .ends

   We will study the influence of the bias imperfections of the controller using
the circuit from Figure 9.15. The biasing errors are a result of supply voltage
errors and errors in the resistive divider, as shown in the previous results
(Figure 9.13). This has been done to keep things simple through a step-
by-step approach. At a later stage, we will evaluate the total biasing error,
including these contributions.

   The SLiCAP netlist of this circuit is given below:

 1 VampBias
 2 * file: VampBias.cir
306 INTRODUCTION TO AMPLIFIER BIASING

                                       3 * SLiCAP netlist file
                                       4 R1 0 3 r value={R_B1} dcvar={(R_B1*sigma_r)^2}
                                       5 R2 out 4 r value={R_B2} dcvar={(R_B2*sigma_r)^2}
                                       6 X1 3 4 out 0 0 N_dcvar sib={I_b*sigma_Ib} sio={i_off} svo={v_off}
                                       7 + iib={I_b}
                                       8 .end

                                          The relative standard deviation of the resistor values have been set to r
                                       [-]. The absolute standard deviations of the offset voltage and of the offset

                                       current of the controller have been set to vo f f [V] and io f f [A], respectively.
                                       The bias current of the controller has been set to Ib [A] with a relative stan-
                                       dard deviation of Ib [-]. If desired, the temperature dependencies of these
                                       parameters can be added, but that has not been done at this stage.

                                          The SLiCAP script for evaluation of the biasing errors of this circuit is:

                                       1 #!/usr/bin/env python3

                                       2 # -*- coding: utf-8 -*-

                                       3 # File: VampBias.py

                                       4

                                       5 from SLiCAP import *

                                       6

                                       7 fileName = 'VampBias.cir'

                                       8 i1 = instruction()            # Creates an instance of an instruction object

                                       9 i1.setCircuit(fileName)       # Checks and defines the local circuit object and

                                       10                              # sets the index page to the circuit index page

                                       11 i1.setDetector('V_out')

                                       12 i1.setSimType('symbolic')

                                       13 i1.setGainType('vi')

                                       14

                                       15 # Obtain the DC detector voltage

                                       16 i1.setDataType('dc')

                                       17 detDC = i1.execute().dc

                                       18

                                       19 # Obtain the detector-referred variance

                                       20 i1.setDataType('dcvar')

                                       21 detVar = i1.execute().ovar

                                       22

                                       23 htmlPage('Biasing results')

                                       24 head2html('DC detector voltage')

                                       25 text2html("The DC detector voltage is:")

                                       26 eqn2html("V_out", detDC, units="V")

                                       27 head2html('Variance of the DC detector voltage')

                                       28 text2html("The variance of the DC detector voltage is:")

                                       29 eqn2html("(sigma_V_out)**2", detVar, units="V**2")

Figure 9.16: SLiCAP analysis results.     The contributions to the Detector-referred variance are shown in Figure

                                       9.16.

                                          The mean value of the DC output voltage Vout of the circuit is Ib (RB2 - RB1).
                                       It shows the effect of the bias current Ib on Vout. It is zero if RB2 = RB1 and the
                                       voltage drop across RB1 caused by the bias current equals the voltage drop
                                       across RB2.

                                          The contributions to the output variance are:
                                                                                    9.3. EVALUATION OF BIASING ERRORS 307

1. Ib2r RB12: this term represents an error voltage due to the combination of
   a current flow Ib through the resistor R1 and the variance of its resistance
   RB1.

2. Ib2r RB22: this term represents an error voltage due to the combination of
   a current flow Ib through the resistor R2 and the variance of its resistance
   RB2.

3. Ib2Ib(RB1 - RB2)2: this term shows the contribution of the variance of the
   bias current to the variance of Vout. Similar to the influence of the bias
   current on the mean DC voltage Vout, this influence can be made zero if
   RB2 = RB1.

4.  i2   f  (RB1  +  RB2)2:  the offset current of the controller flows through the

     of

    series connection of R6 and R2. For many operational amplifiers, the order

    of magnitude of the offset current equals that of the bias current. This

    limits the effect of the biasing error compensation found in the DC output

    voltage Vout.

5.  v2 :    the variance of the equivalent-input offset voltage of the controller

      of f

    directly adds to that of Vout. This is because the circuit acts as a unity-gain

    voltage follower for any voltage in series with the input of the controller.

9.3.3 Total biasing error

                                        (1)       R6                   X1            Figure 9.17: Circuit for evaluation of the
                                                                       O_dcVar       total biasing error of the voltage amplifier
                                              R3                 (3)                 from Figure 9.9. It is equal to the circuit
                                                             (4)             (out)   from Figure 9.10 in which the nullor has
                        +                                                            been replaced with the nullor with bias
                                                                   R2                sources from Figure 9.14.
                                    (2)

            V1 - R4

   In the previous sections, we have evaluated two contributions to the bi-          9 All resistors have the same relative stan-
asing error of the voltage amplifier. We investigated errors resulting from          dard deviation r. But the resistance errors
supply voltage tolerances and resistor tolerances, as well as errors resulting       are uncorrelated.
from biasing imperfections of the controller. We will now evaluate the total
biasing error resulting from both contributions. Figure 9.17 shows the circuit
for evaluation of the total biasing error. In this circuit, the relative standard
deviation of the resistors is r and that of the supply voltage equals v.9

   The netlist of this circuit is shown below.

 1 VampBiasTotal
 2 * file: VampBiasTotal.cir
 3 * SLiCAP netlist file
 4 V1 1 0 V dc={V_S} dcvar={(sigma_v*V_S)^2}
 5 R3 1 2 r value={R_a} dcvar={(R_a*sigma_r)^2}
 6 R4 2 0 r value={R_b} dcvar={(R_b*sigma_r)^2}
 7 R6 2 3 r value={R_c} dcvar={(R_c*sigma_r)^2}
 8 R2 out 4 r value={19*R} dcvar={(19*R*sigma_r)^2}
 9 X 4 3 out 0 O_dcvar
10 + sib={I_b*sigma_Ib}
11 + sio={i_off}
12 + svo={v_off}
13 + iib={I_b}
14 .param R_b={R_a}
15 .end
308 INTRODUCTION TO AMPLIFIER BIASING

9.3.4 Biasing design limits and budgets

We will now demonstrate the way in which show-stopper values for the dif-
ferent contributers for the output variance can be determined. We will do
this for a simplified circuit.

1. The DC solution of the network from Figure 9.11 does not significantly
   change as a result of the offset and bias sources to the controller if Ib RRaa+RRbb 

                     Ra Rb

   Ib Rc, or Ra+Rb  Rc.

2. From the DC analysis, we concluded that we required Ra = Rb

   With the above assumtions the expression for the detector-referred vari-
ance becomes:

                                       V2  V2        22      22
    2                                  2s  2s  2  2
    Vout = r + v + vo f f + io f f (38R) + r 2 (19R) Ib .                      (9.15)
                                       8   4

    The script for doing this is:

1 #!/usr/bin/env python3

2 # -*- coding: utf-8 -*-

3 # File: VampBiasTotal.py

4

5 from SLiCAP import *

6

7 fileName = 'VampBiasTotal.cir'

8 i1 = instruction()                           # Creates an instance of an instruction object

9 i1.setCircuit(fileName)                      # Checks and defines the local circuit object and

10                                             # sets the index page to the circuit index page

11 i1.setDetector('V_out')

12 i1.setSimType('symbolic')

13 i1.setGainType('vi')

14

15 # Obtain the DC detector voltage

16 i1.setDataType('dc')

17 detDC = i1.execute().dc

18

19 # define the symbols in the python environment

20 R_a, R_b, R, R_c, alpha = sp.symbols('R_a, R_b, R, R_c, alpha')

21

22 detDC = detDC.subs({R_b:R_a, R_c:19*R-R_a/2})

23

24 # Assume R_a << R:

25 # Take R_a=alpha*R and evaluate lim (alpha --> 0)
26 detDC = detDC.subs(R_a, alpha*R)

27 detDC = sp.limit(detDC, alpha, 0)

28

29 i1.setDataType('dcvar')

30 detVar = i1.execute().ovar

31

32 # Use R_b=R_a and R_c = 19*R- R_a//R_b
33 detVar = detVar.subs({R_b:R_a, R_c:19*R-R_a/2})
34 # Assume R_a << R:

35 # Take R_a=alpha*R and evaluate lim (alpha --> 0)
36 detVar = detVar.subs(R_a, alpha*R)

37 detVar = sp.limit(detVar, alpha, 0)

38

39 # Make the report

40 htmlPage('Biasing results')

41 head2html("Simplifications")

42 text2html("We will simplify the expressions for the DC voltage and the " +

43     " detector-referred variance using the following assumptions:" +

44     "<ol><li>$R_c=19R-\\frac{R_aR_b}{R_a+R_b}$</li>" +

45     "<li>$R_a=R_b$</li>" +

46     "<li>$R_a\\ll R$</li></ol>")

47 head2html('DC detector voltage')

48 text2html("The DC detector voltage is:")

49 eqn2html("V_out", detDC, units="V")

50 head2html('Detector referred variance')

51 text2html("The variance of the DC detector voltage is:")

52 eqn2html("(sigma_V_out)**2", detVar, units="V**2")

    The results are shown in Figure 9.18. They comply with those from 9.15.
                                                   9.4. APPLICATION OF ERROR REDUCTION TECHNIQUES 309

                                                                                          Figure 9.18: SLiCAP analysis results.

     Now that we have the means to find symbolic expressions for the contri-

butions of resistor tolerances, power supply tolerances and controller biasing

errors to the variance of the output voltage, we are able to set up design limits

for such types of error sources.

     The general way to find a design limit for one specific parameter that con-

tributes to a certain error, is to assign the complete budget for this error for

this contribution. For example, if the standard deviation of Vout is allowed

to be 100mV, the design limit for the standard deviation v of power supply

voltage of the voltage amplifier is 200mV. This directly follows from the sec-

ond term of (9.15). A design limit for the resistor tolerances can be found in a

similar way. If we ignore the contribution of the bias current Ib, only the first

term in (9.15) describes a contribution to Vout due to the resistor tolerance
                                                                  0.12     2 25 ,
r .  With  a  power  supply  voltage  of  5V,  we  then  obtain:        =          which
                                                                             r8
yields a maximum value for the resistor tolerances: r = 5.7%. A design limit

for vo f f can be found in a similar way. The definition of design limit for io f f

depends on the selected value for R. This selection will primarily be based

on the noise performance of the amplifier. The design limit for Ib strongly

interacts with the selection of R and r.

     A good starting point for deriving budgets for multiple parameters that

together affect one performance aspect, is to assume equal error contributions

of all parameters. If, for some reason, such a budget appears to be too tight

for one parameter, it can be relieved at the cost of a tighter budget for another

one. Design limits, however, can never be relaxed. Non-compliance with

a design limit means a show-stopper10 for the design and requires another                 10 Action, condition, event, or problem
                                                                                          that is serious enough to halt an activity,
design concept.                                                                           program, or process until it is resolved
                                                                                          (http://www.businessdictionary.com).

9.4 Application of error reduction techniques

In the previous sections, we have studied basic amplifier biasing techniques.
We found means to define the voltage levels and provide bias currents, and
we evaluated errors resulting from device tolerances and imperfections. If
310 INTRODUCTION TO AMPLIFIER BIASING

                                                  the biasing errors are too large, we have to apply so-called error reduction
                                                  techniques to reduce them. This section is devoted to the application of such
                                                  techniques. We will study them at a conceptual level only.

                                                      One error reduction technique that is often applied during biasing is com-
                                                  pensation. As a matter of fact, adding level shifts and bias current sources to
                                                  the design is a form of additive compensation. It has already been discussed
                                                  in the previous sections and is considered as a basic biasing technique.

                                                      If remaining errors are too large, we need more powerful error reduc-
                                                  tion techniques to reduce them. In section 9.4.1, we will introduce negative-
                                                  feedback biasing. We have already applied negative feedback for the design
                                                  of amplifier concepts. In situations in which errors due to biasing can be
                                                  distinguished from signal excursions, negative feedback biasing may offer
                                                  further improvement.

                                             9.4.1 Negative feedback and auto-zero biasing

                                             Similar to the design of negative feedback amplifier configurations, the con-
                                             ceptual design of negative feedback biasing starts with measurement of the
                                             bias quantity to be fixed. In the amplifier from Figure 9.1 this is the DC oper-
                                             ating voltage at the input of the ADC. In order to obtain maximum and equal
                                             positive and negative digital signal excursions at its output, the DC input
                                             voltage of the ADC should be set to 2V. During our study of biasing errors
                                             in section 9.3, we found all kinds of error sources that contribute to an er-
                                             ror in this DC voltage. The idea behind negative-feedback biasing is that we
                                             measure this deviation from the desired operating point and apply a control
                                             signal to the amplifier to correct it. However, the output signal of the ampli-
                                             fier itself also causes such deviations, and those should not be compensated
                                             for! Hence, negative feedback biasing can only be applied if a distinction
                                             can be made between deviations caused by the signal and deviations caused
                                             by operating point changes. Such distinctions can be made in the frequency
                                             domain or in the time domain.

                                             Negative-feedback biasing

Figure 9.19:                                                                   X1        (out)                 C1  X1
    A. Concept of negative feedback biasing                                                      R1
                                             (2) (3)                               R3                              R2 R3
applied to the amplifier from Figure 9.9                                                            +                                        R5
    B. Implementation of the circuit with                 C1
                                                                                                V1                 C2 C3
an integrating transimpedance amplifier as                      (4)
controller.                                                                                         -
                                             R1
                                                                                                               R4
                                                     (1)           R2
                                                 +
                                                          (5)
                                             V1
                                                                   C2
                                                 -

                                                          G1

                                                                                   -                               O1

                                                                                                                                                            +
                                                                                   +

                                                                                                                                                   -
                                                                                         (6)                                 +

                                                                                         +                             V2

                                                                                   V2

                                                                                   -                                                                           -

                                             A                                                  B

                                                Changes in the DC operating point are caused by supply changes, device
                                             tolerances, biasing errors and temperature changes. These changes are usu-
                                                               9.4. APPLICATION OF ERROR REDUCTION TECHNIQUES 311

ally slow and have only frequency components at very low frequencies. If
those frequencies do not occur in the signal, a distinction between biasing
and signal components can be made in the frequency domain.

   Figure 9.19 shows a possible concept of negative feedback biasing for the
voltage amplifier from Figure 9.19A.

   The integrating transadmittance amplifier G1 is the bias loop controller. It
acts as a first-order low-pass filter with an infinite DC gain. Hence, for DC,
it can be replaced with a nullor. As a consequence, the DC output voltage of
the amplifier will equal Vre f . Since both the input impedance and the output
impedance are infinite, the source-to-load transfer, the noise and the power
efficiency will not be affected by the bias control loop. This, of course, is
under the assumption that the integrator gain gB has been properly designed.
In section 11.4.4, we will study the design of the high-pass cut-off frequency
and in Chapter 12, we will discuss the design of the high-pass response and
see the way in which the stability of negative feedback biasing can be assured.
In the following example, we will derive symbolic expressions for the DC
output voltage and the voltage transfer from the source to the output.

   Example 9.6

       The netlist of the amplifier from Figure 9.19A is shown below:

 1 VampFeedbackBiasTotal
 2 * file: VampFeedbackBiasTotal.cir
 3 * SLiCAP netlist file
 4 V1 1 0 V value = {V_s}
 5 V2 6 0 V value = 0 dc={V_ref}
 6 R1 1 2 {R_s}
 7 R2 4 5 r value={R} dcvar={(R*sigma_r)^2}
 8 R3 out 4 r value={19*R} dcvar={(19*R*sigma_r)^2}
 9 C1 2 3 {C_a}
10 C2 5 0 {C_b}
11 X1 3 4 out 0 O_dcvar ; amplifier controller
12 + sib={I_b*sigma_Ib}
13 + sio={i_off}
14 + svo={v_off}
15 + iib={I_b}
16 G1 3 0 out 6 {g_B/s} ; bias loop controller
17 .end

       Below, the SLiCAP script for evaluation of the DC output voltage, the source-
    to-load transfer and the high-frequency approximation of the source-to-load trans-
    fer.

                                                                             Figure 9.20: SLiCAP analysis results.

1 #!/usr/bin/env python3

2 # -*- coding: utf-8 -*-

3 # File VampFeedbackBiasTotal.py

4

5 from SLiCAP import *

6

7 fileName = 'VampFeedbackBiasTotal'

8 i1 = instruction()               # Creates instance of instruction object
312 INTRODUCTION TO AMPLIFIER BIASING

9 i1.setCircuit(fileName + '.cir') # Checks, defines the local circuit object,

10                                     # and sets the index page to the circuit

11                                     # index page

12 i1.setSimType('symbolic')

13 i1.setGainType('vi')

14 i1.setDataType('dc')

15 i1.setSource('V1')

16 i1.setDetector('V_out')

17 result = i1.execute()

18

19 htmlPage('Feedback biasing')

20 text2html('The DC output voltage $V_{outDC}$ is:')

21 eqn2html('V_outDC', result.dc)

22

23 # Laplace transfer function with feedback biasing

24

25 i1.setGainType('gain')

26 i1.setDataType('laplace')

27 result = i1.execute()

28 text2html('The voltage transfer $A_v$ from source to load is:')

29 eqn2html('A_v', normalizeRational(result.laplace))

30 hf = sp.limit(result.laplace, ini.Laplace, 'oo')

31 text2html('For high frequencies this can be written as:')

32 eqn2html('A_v', hf)

    The html page with the results is shown in Figure 9.20.
    The results comply with our expectations:

1. The DC output voltage equals that of the reference voltage source.
2. The transfer has three poles and three zeros.
3. The high-frequency transfer equals the ideal gain of 20.

   Figure 9.19B shows a possible implementation of this concept. The transad-

mittance gain gB is defined by the gain of the transimpedance integrator and
the values of R4 and R5:

                                       gB = 1 .                                  (9.16)
                                              RB RiCi

Auto-zero biasing

If, during a short time interval, the load signal is not of interest, this time
interval may be used to correct biasing errors with a feedback control signal.
The corrected biasing should be maintained during the time of interest of the
signal, which requires a memory element. If the load signal is not allowed to
change due to this auto-zero process, a second memory element is required
for storing the signal and passing it to the load during the auto-zero time in-
terval. This principle is applied in so-called auto-zero operational amplifiers.

9.4.2 Modulation and demodulation techniques

Compensation, negative feedback and auto-zero techniques do not affect the
way in which the information is embedded in the signal: they adapt the
circuit to the signal. Another approach for reducing the amount of signal
processing errors is to do the opposite: adapt the signal to the circuit. As a
matter of fact, digitization can be seen as such a technique. By reducing the
number of signal levels to two, the signal is made insensitive to nonlineari-
ties that occur in the circuit. Modulation and demodulation techniques also
belong to this class of error reduction techniques. With these techniques, the
frequency range of a signal can be changed, and this may be an interesting
option for the reduction of biasing errors. If frequency components of the sig-
nal are in the same range as those of temperature variations, changes in the
                                                                                                     9.5. COMMON-MODE BIASING 313

quiescent operating point of an amplifier due to temperature variations can-
not be distinguished from signal excursions. Bringing the frequency range of
the signal outside the frequency range of temperature changes and of other
possible disturbances will then increase the signal-to-noise ratio. After the
modulated signal has been amplified to a level at which temperature varia-
tions can be neglected, it can be demodulated to its original frequency band.
This principle is applied in so-called chopper-stabilized amplifiers.

9.5 Common-mode biasing

If an amplifier shows natural two-port behavior, the common-mode port volt-
ages need to be defined. This is because the floating ports of a natural two-
port have an infinite common-mode impedance, and any common-mode cur-
rent caused by external noise sources or temperature variations may drive the
common-mode port voltage outside its desired operating range. In practice,
this operating range will be limited by a power supply voltage or by physical
breakdown voltages of circuit components in the amplifier.

9.5.1 AC coupling

Figure 9.21 shows a concept with a common-mode port impedance of zero
for both ports. The input common-mode voltage has been set to ground level
and the output common-mode level has been set to Vcm with respect to the
ground.

    +  +                                                                                      Figure 9.21: Balanced transformer coupled
                                                                                              amplifier with zero input common-mode
in  --                                                                             out        impedance and output common-mode
                                                                                              impedance, zero input common-mode
                                                                                           -  voltage and its output common-mode
                                                                                              voltage set tos Vcm.
                                                                                   -
   Alternatively, one may consider the use of brute-force techniques as they       +
have been demonstrated for the biasing of the input port of the operational
amplifier (see section 9.2.3).

9.5.2 DC-coupled floating port amplifiers                                                     Figure 9.22: Brute-force common-mode
                                                                                              biasing of the input port and the output
There are four techniques for defining DC common-mode voltages of floating                    port of a natural two-port.
ports:

1. Brute force methods

                                                                           natural
                                                                           two-port

                         -
                                                                +
+

We speak of brute force techniques if the common-mode voltages are fixed
by simply connecting the port terminals to a voltage source by means of
an impedance that allows for DC transfer. Figure 9.22 shows the principle
with resistors. The common-mode input resistance of this circuit equals Rci
314 INTRODUCTION TO AMPLIFIER BIASING

11 The driving point impedance of a port is     and the common-mode output resistance Rco. The common-mode input
the in-circuit measured impedance at that       voltage and the common-mode output voltage have been set to Vcmi and
port.                                           Vcmo, respectively. Brute force fixing of the common-mode input voltage
                                                of a floating port affects the differential-mode impedance of that port. In
                                                order to keep the possible adverse effects on the signal processing quality
                                                as small as possible, the sum of the two brute force impedances should be
                                                much larger than the differential driving point impedance.11

                                             2. Feed forward techniques
                                                    Feed forward techniques make use of the existing nonzero common-

                                                mode transfer of an amplifier or an amplifier stage.

                                             3. Figure 9.23 combines brute force common-mode biasing of the input port
                                                of a two-port with feed forward biasing of its output port. An example of
                                                a feed forward biasing of the output port of a balanced transresistance am-
                                                plifier has been shown in Figure 9.24. The common-mode output voltage
                                                of this circuit is fixed by both Icm and Vcmi:

                                                                                Vocm = Vcmi + Icm R f .  (9.17)

Figure 9.23: Feed forward common-mode                                           two-port
biasing of the output port of a two-port
with a finite, nonzero common-mode           -                                  with finite
transfer.

                   -
                                                                             +  nonzero
+
                                                                                common-mode

                                                                                transfer

Figure 9.24: Feed forward common-mode        4. Local common-mode feedback
biasing of the output port of a balanced            Local common-mode feedback is a technique in which the common-
transresistance amplifier.
                                                mode voltage or current of a port is measured, compared with a reference,
Figure 9.25: Principle of common-mode           and controlled by adding a common-mode current or voltage at the same
biasing of a floating port with the aid of      port. This is shown in Figure 9.25.
local feedback.
                                                    The common-mode input impedance of this circuit equals 1/Gcm while
                                                its differential-mode impedance is infinity. Figure 9.26 shows the concept
                                                with two transimpedance amplifiers.

                                                                                     +

                                                                                -

                +                            5. Over-all common-mode feedback
              -                                     With over-all common-mode feedback, a common-mode output quan-

Figure 9.26: Concept with two nullors           tity is measured and controlled by a common-mode input quantity. This is
for implementation of the feed-forward          only possible if the two-port has a nonzero common-mode transfer from
common-mode biasing from Figure 9.25.           the controlling quantity to the controlled quantity.

                                                    Figure 9.27 shows an arrangement in which the common-mode output
                                                voltage of a two-port is controlled by its common-mode input current.
                                                These techniques will be discussed in more detail in the volume about
                                                transistor-level design.
                              Two-port      9.5. COMMON-MODE BIASING 315
                              with nonzero
                              common-mode          Figure 9.27: Common-mode biasing of
                              transfer             a floating port with the aid of over-all
                                                   common-mode feedback.
+
                                                       The common-mode output voltage is
-                                                  measured, compared with a set point, and
                                                   contolled by inserting a common-mode
                        2                          input current. The two-port needs to have a
                        -                          nonzero common-mode transresistance.

-+
+
                                                                         317

10 Modeling of negative feedback cir-

cuits

10.1 Introduction                                                   318

10.1.1 Two-step design approach                                     318

10.1.2 This chapter                                                 319

10.2 Black's feedback model                                         319

10.2.1 Model description                                            319

10.2.2 Application of the model                                     320

10.2.3 Conclusions                                                  323

10.3 Asymptotic gain model                                          324

10.3.1 Superposition model                                          324

10.3.2 Asymptotic gain model                                        326

10.3.3 Selection of the loop gain reference                         327

10.3.4 Hand calculations of the loop gain                           334

10.3.5 Impedance model                                              338

10.3.6 Port impedance of single-loop feedback amplifiers            341

10.3.7 Port impedance of multi-loop feedback amplifiers             343

10.3.8 Application of asymptotic gain model in balanced amplifiers  344

10.3.9 Asymptotic gain model and network analysis                   345

10.3.10 Conclusions                                                 348
318 MODELING OF NEGATIVE FEEDBACK CIRCUITS

                                 10.1 Introduction

                                                  In Chapter 7, we showed that low-noise and power-efficient amplifiers can
                                                  be realized with the aid of negative feedback. When applying negative feed-
                                                  back, the input impedance, the output impedance and the source-to-load
                                                  transfer of an amplifier obtain their required value with the aid of feedback
                                                  networks around high-gain loop amplifiers or controllers. If we use nullors as
                                                  ideal controllers, the transfer characteristics of the amplifier are completely
                                                  determined by the feedback networks. In fact, when designing this so-called
                                                  feedback configuration, we perform the first design step in amplifier design.
                                                  The result of this step is a conceptual design in which primary performance
                                                  aspects such as the ideal gain, the port impedances and the port isolation
                                                  configuration of the amplifier have been designed.

                                                      In the second design step, we would like to design the controllers without
                                                  changing anything that has been designed during the first step.

                                        10.1.1 Two-step design approach

                                                  If the design of a controller can be done without changing the amplifier con-
                                                  cept, we have a straightforward two-step design approach with no iterative
                                                  loops. Such a design approach requires decomposition of the allowed in-
                                                  formation processing errors in two independent contributions that can be
                                                  designed during the two subsequent steps:

                                                  1. Error contributions due to imperfections of the feedback networks

                                                      These error contributions have been discussed in Chapter 7. Since the
                                                      feedback network determines the ideal gain of the negative feedback am-
                                                      plifier, tolerances of devices in the feedback network result in tolerances
                                                      of the ideal gain. We have also seen that application of passive devices in
                                                      the feedback network may result in an increase of noise and a decrease in
                                                      power efficiency. It will also be clear that nonlinear and/or dynamic be-
                                                      havior of feedback elements results in a nonlinear and/or dynamic ideal
                                                      transfer of the negative feedback amplifier. Sometimes, such effects are in-
                                                      tended. In logarithmic amplifiers, for example, the output quantity inten-
                                                      tionally changes logarithmically with the input quantity. Similarly, active
                                                      filters exhibit an intended dynamic behavior.

                                                  2. Error contributions due to imperfect implementation of the controller(s)

                                                      The transfer of a negative feedback amplifier only equals its ideal gain if
                                                      all of the controllers are nullors. In practice, this will never be the case. As
                                                      a matter of fact, it doesn't have to be the case. In general, small deviations
                                                      from the ideal transfer of the negative feedback amplifier can be allowed.
                                                      Hence, a part of the total error budget can be reserved for error contribu-
                                                      tions resulting from imperfect behavior of the controller. In order to assign
                                                      such error budgets, or to judge whether given error budgets are realistic,
                                                      we need to know the way in which and to what extent the performance
                                                      aspects of the controller affect those of the negative feedback amplifier. We
                                                      have already studied the influence of controller noise and are able to assign
                                                      budgets for the equivalent-input noise voltage and noise current source of
                                                      the controller. We have not yet studied the influence of gain and band-
                                                      width limitations of the controller, nor do we have a clear understanding
                                                      of the way in which the nonlinearity that occurs in the controller manifests
                                                      itself in the transfer of the negative feedback amplifier.

                                                      At this stage, we would like to have a modeling technique at our disposal
                                                  that clearly relates all kinds of behavioral aspects of the controller to relevant
                                                  behavioral aspects of the negative feedback amplifier. However, not every
                                                  model that provides this insight is useful. We need to have a model that
                                                                                                10.2. BLACK'S FEEDBACK MODEL 319

supports our two-step design approach. Hence, it should split error con-
tributions into two parts: changes in the ideal gain due to imperfections of
the feedback network and deviations from this (changed) ideal gain due to
controller imperfections.

10.1.2 This chapter                                                                 1 Harold Black (1898-1996).

In this chapter, we will discuss various techniques for modeling of feedback
systems and circuits. Some techniques will only briefly be discussed, while
a model that supports the two-step design method will be discussed in more
detail.

   A model that is widely used for analysis of negative feedback systems is
the feedback model by Black.1 Black's feedback model is very useful during
system-level design with building blocks that have unilateral transfer and
that show no interaction. These conditions are usually not satisfied in elec-
tronic circuits. As a matter of fact, satisfaction of these conditions would put
impractical constraints on the design of application-specific negative feed-
back amplifiers: they would introduce requirements that adversely affects
the feasibility of the design. Black's feedback model will be discussed in
section 10.2.

   One feedback model that supports the two-step design approach is the
asymptotic gain model. It will be presented in section 10.3. This model is
based upon the superposition model, which models the behavior of circuits
that exploit negative feedback as accurately as network theory.

   A feedback model that is very suited for measurements and simulations of
complete feedback circuits has been described by Middlebrook's generalized
feedback theorem. It is suited for analysis rather than for synthesis. It will not
be discussed in this book.

   In this book we will use the asymptotic gain model to relate the perfor-
mance aspects of the controller to those of the negative-feedback amplifier.
This will be done in Chapter 11.

10.2 Black's feedback model                                                         2 Harold S. Black. Stabilized feed-back
                                                                                    amplifiers. Electrical Engineering, 53(1):114-
In 1927, Black built the first negative-feedback amplifier [Black1934]2. He         120, January 1934
applied negative feedback to obtain linear and stable-gain repeater amplifiers
for long-distance telephone systems. Black's patent was awarded in 1937             3 H.S. Black. Wave Translation System,
[Black1932]3. The theoretical understanding of the high-frequency stability         March 1932
of negative feedback amplifiers was developed by Black in cooperation with
Nyquist [Nyquist1932]4 and Bode [Bode1945]5.                                        4 H. Nyquist. Regeneration theory. Bell
                                                                                    System Technical Journal, 11:126-147, 1932
   The use of Black's feedback model for negative feedback systems is wide-         5 H.W. Bode. Network Analysis and Feedback
spread. The model is shown in Figure 10.1. The model uses three basic               Amplifier Design. Van Nostrand, New York,
building blocks: a feedback network, a subtracter and a loop amplifier or           1945
controller.

10.2.1 Model description                                                                    +
                                                                                                  -
We will now derive the input-output relation of a negative feedback system
according to Black's feedback model.                                                Figure 10.1: Black's feedback model.

   Let Ei be the input signal and Eo be the output signal of a feedback system
that consists of a feedback element with a transfer k, a controller with transfer
H and a subtracter, as depicted in Figure 10.1. From Chapter 7, we know that
the transfer k of the feedback element has been designed as the reciprocal
gain of the desired input-to-output transfer of the feedback system. The
output signal of the feedback element should be an accurate copy of the
input signal of the system. Hence, the input signal of the controller, also
320 MODELING OF NEGATIVE FEEDBACK CIRCUITS

called the error signal , should approach zero. The error signal  is the

difference between the output signal of the feedback network and the input
signal Ei. According to the block diagram from Figure 10.1 the error signal
should satisfy two equations:

                                             = Ei - kEo,       (10.1)
                                             = 1 Eo.           (10.2)

                                                 H

     Hence, we may write:

                                            1H Eo = Ei - kEo,  (10.3)

or:                                         Eo 1H + k = Ei,

                                                               (10.4)

from which we obtain the expression for the input-output relation of the
feedback system:

                                            Eo = H .           (10.5)
                                            Ei 1 + Hk

   If we consider H the gain of an amplifier, then we may say that negative
feedback reduces the gain by a factor (1 + Hk). The product of the gain of
the controller and that of the feedback network is called the loop gain Hk. It
is the gain enclosed in the loop that consists of the controller, the feedback
element and the subtracter.

   From a design point of view, we better consider H as the gain of a con-
troller, that has to minimize the error between the Ei and the signal at the
output of the feedback network. If the controller gain is infinite, the loop
gain is infinite and the input-to-output transfer becomes the reciprocal trans-
fer of the feedback network: the ideal gain of the negative feedback amplifier.
This complies with the results from Chapter 7:

                                            lim Eo = 1 .       (10.6)
                                            H Ei          k

     Hence, a design-friendly notation that explicitly writes (10.5) as the prod-

uct of the intended gain, and a factor that represents the effect of a limited

controller gain, is:

                                            Eo = 1 Hk .        (10.7)
                                            Ei k 1 + Hk

10.2.2 Application of the model

Expression 10.5 describes the transfer from the input to the output of the
system, rather than the transfer from the signal source to the load. This is a
consequence of the modeling technique. Currents and voltages cannot easily
be distinguished in these kinds of block diagrams.

   The model also supposes ideal subtraction of the feedback signal from the
input signal and no interaction between unilateral building blocks.

   For a negative feedback voltage amplifier, for example, these conditions
imply that the controller should have an infinite CMRR, infinite differential-
mode and common-mode input impedances and zero output impedance.
These, indeed, are prerequisites for voltage operational amplifiers, but they
seriously complicate their design, because no electronic components with
such properties exist.

   In the following examples, we will show the application of Black's feed-
                                                                        10.2. BLACK'S FEEDBACK MODEL 321

back model for electronic circuits.                                                              (1)         (2)  (3)

   Example 10.1 .                                                                         V1 +        R1 + E1 +               +
                                                                                              -              --
       Figure 10.2 shows a passive-feedback voltage amplifier in which the controller                                R2
    has been modeled as a simple opamp: a voltage-controlled voltage source with
    voltage gain Av. The SLiCAP netlist of this circuit is:                                                                  -

 1 "Voltage amplifier with VCVS controller"                                                            (4)
 2 * file: vAmpBlack.cir                                                                              R4 R3
 3 * SLiCAP circuit file
 4 V1 1 0 {V_s}                                                                           Figure 10.2: Passive feedback voltage
 5 R1 1 2 {R_s}                                                                           amplifier with a voltage-controlled voltage
 6 R2 3 0 {R_ell}                                                                         source as controller.
 7 E1 3 0 2 4 {A_v}
 8 R3 3 4 {R_a}
 9 R4 4 0 {R_b}
10 .end

       The following script can be used to obtain a symbolic expression for the transfer
    from V1 to the voltage across R2:

1 #!/usr/bin/env python3

2 # -*- coding: utf-8 -*-

3 # File: vAmpBlack.py

4

5 from SLiCAP import *

6

7 fileName = 'vAmpBlack'

8 prj = initProject(fileName) # Creates the SLiCAP libraries and the

9                                 # project HTML index page

10 i1 = instruction()             # Creates an instance of an instruction object

11 i1.setCircuit(fileName+'.cir') # Checks and defines the local circuit object,

12                                # and sets the index page to the project index

13 i1.setSource('V1')

14 i1.setDetector('V_3')

15 i1.setSimType('symbolic')

16 i1.setGainType('gain')

17 i1.setDataType('laplace')

18 result = i1.execute()

19

20 htmlPage('Voltage amplifier with VCVS controller')

21 text2html('The gain of the system is obtained as:')

22 V_ell, V_s = sp.symbols('V_ell, V_s')

23 eqn2html(V_ell/V_s, result.laplace)

    The html page with the result of this run is shown in Figure 10.3.

                                                                                          Figure 10.3: SLiCAP simulation results for
                                                                                          the negative feedback voltage amplifier
                                                                                          with VCVS controller.

    The result can be written as

                                                        
                        V = Ra + Rb Av RaR+bR  b  .
                        Vs    Rb          1 + Av Rb                     (10.8)

                                          Ra +Rb

    In this notation, we clearly see that the loop gain L can be written as the

    product of the voltage gain of the controller and the voltage gain of the feedback

    network:                  L = Av Rb Ra + R .b

                                                                        (10.9)

       The ideal gain is the gain of the amplifier in which the controller is replaced
    with a nullor. It equals the reciprocal value of the gain of the feedback network.

   The above example shows the application of Black's feedback model for a
simple situation. In this particular case, it appears as if the model supports
322 MODELING OF NEGATIVE FEEDBACK CIRCUITS

                                             a two-step design approach: the source-to-load transfer can be written as the

                                             product of the ideal gain RaR+Rb b , and the servo function S, which is uniquely
                                             defined by the loop gain:

                                             S= L .     (10.10)
                                                   1+L

6 Middlebrook uses the term "discrepancy        This servo function is a measure for the error between the ideal gain, and
factor".                                     the actual gain in which the controller a high-gain amplifier, rather than a
                                             nullor.6

                                                It appears as if the model of Black supports a two-step design approach:
                                                The first step is the design of the ideal transfer using a nullor as controller,
                                             while the second step comprises the design of a controller that provides a
                                             sufficiently large loop gain.
                                                However, the above is only true because the controller in this voltage am-
                                             plifier is an ideal voltage-controlled voltage source: it has an infinite input
                                             impedance and zero output impedance. In this case, this has the following
                                             consequences:

                                             1. The current through the source resistor R1 equals zero, thus the input
                                                voltage of the amplifier equals the source voltage.

                                             2. Current through the feedback network and current through load impedance
                                                do not affect the output voltage of the controller.

                                             3. There is no direct transfer from the source to the load through the feedback
                                                network.

(1)      (2) F1  (3)                            In fact, for negative-feedback voltage amplifiers, one would like to use an
                                             ideal voltage-controlled voltage source as controller. This would make the
V1 + R1                      +               loop gain independent from the source and load impedance. However, from
                                             a design point of view it is not at all necessary. The design goal is to design
-                   R2                       servo function transfer close to unity.

                            -                   This makes Black's feedback model not the best model for the design of
                                             negative feedback amplifiers. It does not support the two-step design ap-
      (4)                                    proach.
     R4 R3
                                                We will elucidate this in the next example in which we select a current-
Figure 10.4: Passive feedback voltage        controlled current source instead of a voltage-controlled voltage source as
amplifier with a current-controlled current  controller in the voltage amplifier.
source as controller.
                                                Example 10.2

                                                    Figure 10.4 shows the passive feedback voltage amplifier from Figure 10.2 but
                                                 with the controller replaced with a current-controlled current source. The SLiCAP
                                                 netlist file for this model is:

                                              1 "Voltage amplifier with CCCS controller"
                                              2 * file: vAmpBlackF.cir
                                              3 * SLiCAP circuit file
                                              4 V1 1 0 {V_s}
                                              5 R1 1 2 {R_s}
                                              6 R2 3 0 {R_ell}
                                              7 F1 0 3 2 4 {A_i} ;The SLiCAP syntax for a CCCS differs from SPICE syntax
                                              8 R3 3 4 {R_a}
                                              9 R4 4 0 {R_b}
                                             10 .end

                                                   The following script can be used to obtain a symbolic expression for the transfer
                                               from V1 to the voltage across R2:

                                             1 #!/usr/bin/env python3
                                             2 # -*- coding: utf-8 -*-
                                             3 # File: vAmpBlackF.py
                                             4
                                             5 from SLiCAP import *
                                             6
                                             7 fileName = 'vAmpBlackF'
                                                                          10.2. BLACK'S FEEDBACK MODEL 323

8 prj = initProject(fileName) # Creates the SLiCAP libraries and the

9                             # project HTML index page

10 i1 = instruction()         # Creates an instance of an instruction object

11 i1.setCircuit(fileName+'.cir') # Checks and defines the local circuit object,

12                            # and sets the index page to the project index

13 i1.setSource('V1')

14 i1.setDetector('V_3')

15 i1.setSimType('symbolic')

16 i1.setGainType('gain')

17 i1.setDataType('laplace')

18 result = i1.execute()

19

20 htmlPage('Voltage amplifier with CCCS controller')

21 text2html('The gain of the system is obtained as:')

22 V_ell, V_s = sp.symbols('V_ell, V_s')

23 eqn2html(V_ell/V_s, result.laplace)

    The result of the newly generated html page is shown in Figure 10.5.

                                                                                      Figure 10.5: SLiCAP simulation results for
                                                                                      the negative feedback voltage amplifier
                                                                                      with CCCS controller.

       It is clear that the transfer now depends on the source impedance, the load    7 The output quantity of the controller is
   impedance and the loop gain, while the loop gain cannot simply be obtained as the  current, while the load quantity is voltage.
   product of the gain of the controller and the transfer of the feedback network.

   The above example shows that changing the controller type does not only
change the expression of the source-to-load transfer, but also complicates the
interpretation of the results that are obtained with Black's feedback model.

   In fact, there are three causes for the modification of the source-to-load
transfer when we change the controller in the negative feedback voltage am-
plifier from a VCVS to a CCCS:

1. With the CCCS, the source current is no longer zero, hence the input volt-
   age of the circuit does not equal the source voltage.

2. With the CCCS, the load voltage is not uniquely defined by the output
   quantity of the controller.7

3. With the CCCS, there exist two current paths from the source to the load
   with a nonzero transfer: one through the controller and one direct transfer
   from the source to the load through the feedback network. The latter one
   is not accounted for in Black's feedback model, which assumes unidirec-
   tional transfer only.

   In general, any practical controller circuit:

1. will have nonzero finite port impedances

2. will have bidirectional transfer

3. does not show natural two-port behavior (see Chapter 18.6.1 for two-port
   conditions and natural two-port behavior).

10.2.3 Conclusions

At this stage, we may conclude that Black's feedback model is very well
suited to system level analysis with building blocks that show no interaction
and have unilateral behavior, but it is not very suited to the design and the
analysis of negative feedback amplifiers.

   For the analysis of feedback circuits to match those obtained with network
analysis, we need a model that does not pose additional requirements to
324 MODELING OF NEGATIVE FEEDBACK CIRCUITS

                                                  circuit parts that can be identified as controller or as feedback network. In
                                                  the next section, we will show that the asymptotic gain model satisfies such
                                                  requirements while also supporting the two-step design method in the best
                                                  possible way.

                                                10.3 Asymptotic gain model

                                                In this section, we will discuss the asymptotic gain model. With this model,
                                                the source-to-load transfer of a feedback amplifier can be written in a way
                                                that supports the two-step design method, while it provides exactly the same
                                                results as network theory. The asymptotic gain model will be derived from
                                                the superposition model.

8 Please note that we will use the symbol       10.3.1 Superposition model
A for one of the two-port's transmission
parameters and for the reference variable in    The superposition model gives a formal approach to the analysis of negative
a negative feedback amplifier. The meaning      feedback amplifiers. The model is based upon the application of the super-
will become clear from the context in           position theorem that holds for linear networks. In order to apply the super-
which A will be used.                           position theorem, the feedback amplifier is modeled as a network that has
                                                at least one controlled source Ec that is controlled by a controlling quantity
                                                Ei. The reference variable A, as shown in Figure 10.6, describes the rela-
                                                tion between an arbitrarily selected controlled quantity Ec and its controlling
                                                quantity Ei : Ec = AEi.8

source quantity  arbitrarily selected                                                             load quantity
(v or i)         controlled source                                                                (v or i)

+                                                                 +  +                     ++
                                                                     -
                                             +
                                                                     sensed load quantity
-                                                                 -                        -

   copy source

   quantity                                     controller input

Figure 10.6: The superposition model is            Figure 10.6 shows a simplified schematic representation of an electrical
based upon the representation of a linear
network with one arbitrarily selected           network according to the superposition model. The source quantity Es, the
controlled source.                              load quantity E, the controlled quantity Ec and the controlling quantity Ei
                                                can be a current or a voltage.
9 This is a formal way to assign a value to
Ec without knowing Ei.                             In the superposition model, we will mathematically break the loop that

                                                exists from the input of the controlled source to its output by replacing the
                                                controlled source Ec with an independent source Ec, as shown in Figure 10.7.9

                                                   With the aid of the superposition theorem, each current and voltage of

                                                the feedback amplifier can now be written as a linear combination of the

                                                two independent sources in the circuit: the current or voltage of the signal

                                                source (the source quantity Es) and the current or voltage of the independent
                                                source Ec. In this way, we write both the load quantity E and the controlling
                                                quantity Ei as a linear combination of the two sources Es and Ec:

                                                                     E =                   Es Ec .               (10.11)
                                                                     Ei   

                                                This is the superposition model and its model parameters are defined as:

                                                ·  = EEs E : Direct transfer from the source to the load; c=0
                                                                                                 10.3. ASYMPTOTIC GAIN MODEL 325
·  = EEc E : Transfer from Ec to the load; s=0
·  = EEsi E : Transfer from the source to the driving quantity E c=0 i;
·  = EEci E : Transfer from Ec to E s=0 i; a nonzero value of  indicates

   the existence of feedback.

source quantity                  arbitrarily selected                                    load quantity
(v or i)                         controlled source                                       (v or i)

+                                                        +  +                     ++
                                                            -
                                    +
                                                            sensed load quantity
-                                                        -                        -

                       copy source

                       quantity        controller input

The feedback factor  is thus defined as                                           Figure 10.7: The superposition model. The
                                                                                  gain of an arbitrarily selected controlled
                       = 1             Ei .                 (10.12)               source is defined as 'reference variable'
                                       Ec Es=0                                    A, and the controlled source (diamond) is
                                                                                  replaced by the independent source (circle)
                                                                                  Ec .

Please note that all parameters depend on the selection of the loop gain

reference variable A:               A = Ec
                                           Ei
                                                            (10.13)

   At a later stage we show that the loop gain reference A can be chosen in
such a way that - equals the transfer of the feedback network. In such cases
this feedback model provides useful design information.

Source-to-load transfer

We will now derive an expression for the transfer from source-to-load A f of
a feedback amplifier. The model equations are:

                       E = Es + Ec,                         (10.14)
                       Ei = Es + Ec,                        (10.15)
                       Ec = AEi.                            (10.16)

Substitution of (10.16) in (10.14) and in (10.15) yields:

                       E = Es + AEi,                        (10.17)
                       Ei = Es +  AEi.                      (10.18)

   We now solve Ei from (10.18) and substitute the result in (10.17). We
obtain:

                       Ei =  1 -  A Es.                     (10.19)

Substitution of this result in (10.17) yields:

                       E = Es  + A 1 -  A .                 (10.20)
326 MODELING OF NEGATIVE FEEDBACK CIRCUITS

                                                  We can now express the source-to-load transfer in terms of the parameters
                                               of the superposition model:

                                                                           A f = E E =  - 1 -L s  1 - L ,                         (10.21)

                                               where L = A is called the loop gain with respect to the reference variable
                                               A. Negative feedback gives a negative value for L. The factor 1 - L is called
                                               the return difference with respect to the reference variable A. Expression 10.21
                                               gives an accurate description of the transfer from source-to-load for any se-
                                               lection of the reference variable. A different selection of the reference variable
                                               A, however, yields different values for the other model parameters  and L.

                                                  The superposition model does not support the two-step design approach
                                               as described in the introduction: if we have no circuit, we cannot select a
                                               reference variable and we do not know about ,  and . The asymptotic gain
                                               model that will be described in the next section is suited for this purpose.

                                               10.3.2 Asymptotic gain model

                                               When the loop gain L approaches infinity, the source-to-load transfer obtains
                                               its so-called asymptotic gain value A f :

                                                                           A f  = lim E =  - 1 .                                  (10.22)
                                                                                 L- Es                    

                                               With the aid of (10.22), we are able to express the source-to-load transfer

                                               E   from  (10.21)  in  the  asymptotic  gain   A f ,  the  loop  gain      L  and  the  direct
                                               Es
                                               transfer :

                                                                      A f = E E =  -L +  1 - 1 -L s 1 - L 1 - L  1 - L ,          (10.23)

                                                                           A f = A f  -L 1 - L +  1 - L                           (10.24)

                                                  This expression resembles the expression obtained by Black's model. Be-
                                               fore we draw any further conclusions, we will first study the influence of the
                                               direct transfer .

                                               Influence of the direct transfer

10 This will be discussed later.               In most practical situations, the direct transfer can be neglected. This can be
                                               seen as follows. Assume the intended gain of the amplifier equals the ideal
11 If not, it is likely that no amplification  gain Ai. Also assume the loop gain reference variable A will be selected in
was required!                                  such a way that the asymptotic gain equals the ideal gain.10 We may then
                                               write (10.24) in the form

                                                                           A f = Ai -L 1 - L  1- 1  .                             (10.25)
                                                                                                   L Ai

                                                  The direct transfer  is usually much smaller than the ideal transfer Ai, so
                                               in most practical situations, we have11

                                                                                         1.                                       (10.26)
                                                                                       Ai

                                                  In addition, for an accurate match between the actual source-to-load trans-
                                               fer and the ideal transfer of the amplifier, we need |L|  1, which justifies
                                                                    10.3. ASYMPTOTIC GAIN MODEL 327

the conclusion:

                                        1   1.                      (10.27)
                                         L Ai
So, with proper selection of the reference variable, we may write:

                 A f = Ai -L 1 - L .                                (10.28)

   Hence, if the asymptotic gain equals the ideal gain, the source-to-load
transfer of a negative feedback amplifier can be written as the product of the
ideal gain and the servo function S:

                 S = -L .                                           (10.29)
                       1-L

This servo function is uniquely defined by the loop gain.
   Now, we have our two-step design approach: first, we design the ideal

gain, and second, we design the controller such that the errors with respect
to this ideal gain are sufficiently small.

Comparison with Black's model

Expression (10.28) has the same appearance as (10.5), but it is more arrurate
and it does not require the assumptions of Black's feedback model.

   However, only if the reference variable has been selected such that the
ideal gain Ai equals the asymptotic gain A f , the loop gain L is the only
measure for the correspondence between the ideal gain and the gain. If so,
the asymptotic gain model supports the desired two-step design approach.

   Please notice that the servo function according to the asymptotic gain
model (10.29) has -L in the numerator and in the denominator, while the
servo function according to Black's feedback model (10.10) has +L in the nu-
merator and the denominator. This is because the asymptotic gain model
does not include a subtracter. In the asymptotic gain model, a negative value
of the loop gain indicates negative feedback, while in Black's feedback model,
a positive value of the loop gain indicated negative feedback.

10.3.3 Selection of the loop gain reference                                          12 In balanced amplifiers, or in amplifiers
                                                                                     with a split signal path, selection of the
The two-step approach requires proper selection of the loop gain reference           reference variable in one of the signal paths
variable A.                                                                          results in an ideal gain that equals the
                                                                                     asymptotic gain, but also in a large direct
   First of all, this reference variable needs to be selected such that the asymp-   transfer. As a result the servo function will
totic gain A f  equals the ideal gain Ai. Hence, the condition L   for the           not be a measure for the difference between
selected reference variable should be equal by replacing the controller with a       the gain and the ideal gain.
nullor. In other words, when the loop gain approaches infinity, the voltage
across the input terminals of the controller and the current through the input
port of the controller should both become zero:

    The asymptotic gain A f  of a direct feedback amplifier equals its ideal gain
   if the reference variable A is selected such that both the input voltage and the
   input current of the controller approach zero if A  .

   Secondly, the reference variable should be selected such that the contribu-
tion of the direct transfer  to the gain A f should be minimized. This can
usually easily be achieved over the frequency range of interest. Outside this
range, at relatively high frequencies, the contribution of the direct transfer
may become dominant.12

   If the above criteria have been met, expression (10.28) describes the source-
to-load transfer and the design of the amplifier can be performed in two
subsequent steps:
328 MODELING OF NEGATIVE FEEDBACK CIRCUITS

                                               1. The design of the ideal gain, as discussed in Chapter 7

                                               2. The design of a controller that provides a sufficiently large loop gain over
                                                  the operating range of interest.

                                                  In the following examples, we will show that the source-to-load relation
                                               of a feedback amplifier is always accurately described by (10.24), while it is
                                               only accurately described by (10.28) if the loop gain reference variable A has
                                               been properly selected.

                                                  Example 10.3

                                                      Figure 10.8A shows a negative feedback voltage amplifier built with a current
                                                  feedback operational amplifier as the controller. A simplified small-signal model of
                                                  this operational amplifier is shown in Figure 10.8B.

Figure 10.8:

Left: Voltage amplifier with passive                                        +
                                                  +
direct negative feedback.                                                                   inP                                            out

Right: Strongly simplified small-signal                         -                       +        +                   +

model of the current feedback operational         -                                                                  -

amplifier that is used as active part for the                                           - inN -
                                                                                                 B
voltage amplifier.

                                               A

                                                  The ideal source-to-load voltage transfer Av of this amplifier is obtained by
                                               replacing the controller with a nullor, as shown in Figure 10.9; we obtain:

                                                                                    Av = V = Ra + Rb                               (10.30)
                                                                                        Vs       Ra

              (2) N1 (4)                          Figure 10.10 shows the small-signal equivalent model of the complete ampli-
                                               fier. We will evaluate the asymptotic gain, the direct transfer, the loop gain and
R1 +                                           the source-to-load transfer of this amplifier with the aid of the asymptotic gain
                    R3     R2                  feedback model. We will do this for two different selections of the loop gain ref-
                                               erence variable A. First, we will select the gain gm of the voltage-controlled
                                            -  current source as the loop gain reference, and then we will select the gain Ar of
                                               the current-controlled voltage source.
(1)
                                                  The SLiCAP netlist for the circuit from Figure 10.10 is:
    +                          (3)
                    R4
V1

    -

Figure 10.9: Circuit for evaluation of the      1 cfbVamp
ideal gain of the voltage amplifier from
Figure 10.8A.                                   2 * file: cfbVamp.cir
                                                3 * SLiCAP circuit file
                                                4 V1 1 0 {V_s}
                                                5 R1 1 2 {R_s}
                                                6 R2 4 0 {R_ell}
                                                7 R3 4 5 {R_a}
                                                8 R4 5 0 {R_b}
                                                9 G1 3 5 2 5 {g_m}
                                               10 H1 4 0 0 3 H value={A_r}

                                               11 .end

Figure 10.10: Small signal equivalent model                 R1                      G1           H1
of the voltage amplifier from Figure 10.8.
                                                     (1)                       (2)          (3)                 (4)

                                                         +             +                         +                              +
                                                            R4 -
                                                     V1                                                     R3       R2
                                                                      (5)
                                                         -                                       -                            -
                                                                               10.3. ASYMPTOTIC GAIN MODEL 329

    The first part of the script calculates the gain:

1 #!/usr/bin/env python3

2 # -*- coding: utf-8 -*-

3 # File: cfbVamp.py

4

5 from SLiCAP import *

6

7 fileName = 'cfbVamp'

8 prj = initProject(fileName) # Creates the SLiCAP libraries and the

9                                # project HTML index page

10 i1 = instruction()            # Creates an instance of an instruction object

11 i1.setCircuit(fileName+'.cir') # Checks and defines the local circuit object,

12                               # and sets the index page to the project index

13 i1.setSource('V1')

14 i1.setDetector('V_4')

15 i1.setSimType('symbolic')

16 i1.setGainType('gain')

17 i1.setDataType('laplace')

18 result = i1.execute()

19

20 gain = result.laplace

       The second part of the script calculates the parameters of the asymptotic gain
    model with the voltage-controlled current source G1 selected as the loop gain ref-
    erence and generates an html page displaying the results:

22 V_ell, V_s, A_f               = sp.symbols('V_ell, V_s, A_f')

23 L_G1, rho_G1, S_G1, A_infty_G1 = sp.symbols('L_G1, rho_G1, S_G1, A_oo_G1')

24 L_H1, rho_H1, S_H1, A_infty_H1 = sp.symbols('L_H1, rho_H1, S_H1, A_oo_H1')

25

26 # Calculations with H1 as loop gain reference

27

28 i1.setLGref('G1')

29 i1.setGainType('asymptotic')

30 result = i1.execute()

31 AG1 = result.laplace

32

33 i1.setGainType('loopgain')

34 result = i1.execute()

35 LG1 = result.laplace

36

37 i1.setGainType('servo')

38 result = i1.execute()

39 SG1 = result.laplace

40

41 i1.setGainType('direct')

42 result = i1.execute()

43 DG1 = result.laplace

44

45 htmlPage('Asymptotic-gain model G1 ref')

46 text2html('The gain of the circuit is obtained as:')

47 eqn2html(V_ell/V_s, gain)

48

49 text2html('The asymptotic-gain $A_{\\infty_G1}$ is found as:')

50 eqn2html(A_infty_G1, AG1)

51

52 text2html('The loop gain $L_{G1}$ is found as:')

53 eqn2html(L_G1, LG1)

54

55 text2html('The servo function $S_{G1}$ is found as:')

56 eqn2html(S_G1, SG1)

57

58 text2html('The direct transfer $\\rho_{G1}$ is found as:')

59 eqn2html(rho_G1, DG1)

60

61 text2html('The gain $A_f$ calculated from $A_{\\infty_{G1}}$, $S_{G1}$ ' +

62  'and $\\rho_{G1}$ is obtained as:')

63 eqn2html(A_f, sp.simplify(AG1*SG1 + DG1/(1-LG1)))

       Figure 10.11 shows the results of the gain calculation directly from the MNA
    matrix and the results according to the asymptotic gain model with the voltage-
    controlled current source G1 selected as the loop gain reference.

       The results clearly show that the asymptotic gain does not equal the ideal gain,
    but the gain calculated according to the asymptotic gain model is the same as the
    one calculated directly from network analysis. This can be understood if we study
330 MODELING OF NEGATIVE FEEDBACK CIRCUITS

                                                      the circuit from Figure 10.10 in more detail. The asymptotic gain is calculated for
                                                      the case in which gm approaches infinity. If this is the case, the controlled source
                                                      G1 can deliver any current while its controlling voltage equals zero. Hence, in this
                                                      case, the input voltage of the controller equals zero. However, since the controlled
                                                      source H1 has a finite gain, it requires a nonzero input current for any nonzero
                                                      output voltage. This input current flows in the inverting input of the controller,
                                                      thus the controller does not act as a nullor, and as a consequence, the asymptotic
                                                      gain differs from the ideal gain.

Figure 10.11: SLiCAP simulation results          The third part of the script calculates the parameters of the asymptotic gain
of the voltage amplifier with current-        model with the current-controlled voltage source H1 selected as the loop gain ref-
feedback operational amplifier. The           erence and generates an html page displaying the results:
voltage-controlled current source G1
has been selected as loop gain reference  65 # Calculations with H1 as loop gain reference
variable.                                 66
                                          67 i1.setLGref('H1')
                                          68 i1.setGainType('asymptotic')
                                          69 result = i1.execute()
                                          70 AH1 = result.laplace
                                          71
                                          72 i1.setGainType('loopgain')
                                          73 result = i1.execute()
                                          74 LH1 = result.laplace
                                          75
                                          76 i1.setGainType('servo')
                                          77 result = i1.execute()
                                          78 SH1 = result.laplace
                                          79
                                          80 i1.setGainType('direct')
                                          81 result = i1.execute()
                                          82 DH1 = result.laplace
                                          83
                                          84 htmlPage('Asymptotic-gain model H1 ref')
                                          85 text2html('The gain of the circuit is obtained as:')
                                          86 eqn2html(V_ell/V_s, gain)
                                                                     10.3. ASYMPTOTIC GAIN MODEL 331

87

88 text2html('The asymptotic-gain $A_{\\infty_{H1}}$ is found as:')

89 eqn2html(A_infty_H1, AH1)

90

91 text2html('The loop gain $L_{H1}$ is found as:')

92 eqn2html(L_H1, LH1)

93

94 text2html('The servo function $S_{H1}$ is found as:')

95 eqn2html(S_H1, SH1)

96

97 text2html('The direct transfer $\\rho_{H1}$ is found as:')

98 eqn2html(rho_H1, DH1)

99

100 text2html('The gain $A_f$ calculated from $A_{\\infty_G1}$, $S_{G1}$ and ' +

101  '$\\rho_{G1}$ is obtained as:')

102 eqn2html(A_f, sp.simplify(AH1*SH1 + DH1/(1-LH1)))

       Figure 10.12 shows the results of the gain calculation directly from the MNA      Figure 10.12: SLiCAP simulation results
   matrix and the results according to the asymptotic gain model with the current-       of the voltage amplifier with a current-
   controlled voltage source H1 selected as the loop gain reference. In this case, the   feedback operational amplifier. The
   reference variable has been selected properly: the asymptotic gain equals the ideal   voltage-controlled current source H1 has
   gain. Since we also have no direct transfer ( = 0), the servo function completely     been selected as the loop gain reference
   describes the non ideal behavior of the controller. Hence, the design of this ampli-  variable.
   fier can be performed in two subsequent steps: the design of the ideal gain and the
   design of the controller.

   In the following example, we will use a more elaborate model for the
operational amplifier and illustrate the use of the asymptotic gain model in
more detail.

   Example 10.4

       Figure 10.13 shows the circuit of the passive feedback voltage amplifier with a
   current feedback operational amplifier as the controller.
332 MODELING OF NEGATIVE FEEDBACK CIRCUITS

                                                    The SLiCAP netlist of this circuit has been listed below. SLiCAP has a built-
                                                 in model for a current feedback operational amplifier. Please see the SLiCAP help
                                                 file for detailed information on this model.

                                             1 cfbVampExtended

                                             2 * file: cfbVampExtended.cir

                                             3 * SLiCAP circuit file
                                             4 V1 1 0 {V_s}

                O1                           5 R1 1 2 {R_s}

    (2)                                      6 O1 2 4 3 0 mycfb

                +          (3)               7 R2 3 0 {R_ell}

                                +            8 R3 3 4 {R_a}

R1              -                            9 R4 4 0 {R_b}

                    R3 R2                    10 * Model definition for the operational amplifier 'mycfb'
                                             11 .model mycfb OC cp={C_i} gp={1/R_i} cpn={C_d} gpn={1/R_d} gm={g_m}
           (1)                      -
                                             12 +               zt={R_t/(1+s*tau)} zo={R_o/(1+s*tau)}
    +                        (4)
                    R4                       13 * parameter values for numeric simulation
V1                                           14 .param C_i=5p R_i=1M g_m=20m R_t=1M R_o=2k tau=50u R_a=2k R_b=500 R_s=100

    -

                                             15 +            R_ell=500 V_s=1 C_d=2p R_d=10k

                      .param                 16 .end
                      + C_i=5p
.model mycfb OC       + R_i=1M                      SLiCAP expands this netlist to the circuit depicted in Figure 10.13. The
+ cp={C_i}            + C_d=2p                   element H_O1 is a current-controlled voltage source with series impedance. It has
+ gp={1/R_i}          + R_d=10k                  two associated values: the first one for the transimpedance factor and the second
+ cpn={C_d}           + g_m=20m                  one for the output impedance. The data of all circuit elements after expansion of
+ gpn={1/R_d}         + R_t=1M                   the netlist can be displayed by SLiCAP. The result is shown in Figure 10.14.
+ gm={g_m}            + R_o=2k                   The script below shows how this should be done:
+ zt={R_t/(1+s*tau)}  + tau=50u
+ zo={R_o/(1+s*tau)}  + R_a=2k               1 #!/usr/bin/env python2
                      + R_b=500
                      + R_s=50
                      + R_ell=500

Figure 10.13: Voltage amplifier with a       2 # -*- coding: utf-8 -*-
current feedback operational amplifier as
controller.                                  3 """

                                             4 Created on Thu Jul 2 14:59:59 2020

                                             5

                                             6 @author: anton

                                             7 """

                                             8 from SLiCAP import *

                                             9

                                             10 fileName = 'cfbVampExtended'

                                             11 prj = initProject(fileName) # Creates the SLiCAP libraries and the

                                             12                               # project HTML index page

                                             13 i1 = instruction()            # Creates an instance of an instruction object

                                             14 i1.setCircuit(fileName+'.cir') # Checks and defines the local circuit object,

                                             15                               # and sets the index page to the project index

                                             16 htmlPage('Circuit data')

                                             17 elementData2html(i1.circuit)

Figure 10.14: Netlist of the amplifier from
Figure 10.13, expanded by SLiCAP.

                                                    The second part of the script shows how to combine the magnitude characteris-
                                                 tics and the phase of the transfers of the asymptotic gain model in one magnitude
                                                 and one phase plot. Figure 10.15 shows the Bode plots generated by this script.
                                                 The part of the script for generating the Bode plots is shown below:
                                                                                10.3. ASYMPTOTIC GAIN MODEL 333

19 i1.setSource('V1')
20 i1.setDetector('V_3')
21 i1.setLGref('H_O1')

22 i1.setSimType('numeric')

23 i1.setDataType('laplace')

24 i1.setGainType('gain')

25 G = i1.execute()

26 i1.setGainType('asymptotic')

27 A = i1.execute()

28 i1.setGainType('loopgain')

29 L = i1.execute()

30 i1.setGainType('servo')

31 S = i1.execute()

32 i1.setGainType('direct')

33 D = i1.execute()

34 figdBmag = plotSweep('cfbVampdBmag.svg', 'dB magnitude plots asymptotic-' +

35                   'gain model', [G,A,L,S,D], 1e4, 1e9, 200,

36                   funcType = 'dBmag', show=True)

37 figPhase = plotSweep('cfbVampPhase.svg', 'Phase plots asymptotic-gain model',

38                   [G,A,L,S,D], 1e4, 1e9, 200, funcType = 'phase', show=True

                              )

39 htmlPage('Bode plots')

40 fig2html(figdBmag, 800)

41 fig2html(figPhase, 800)

                                                                                  Figure 10.15: Bode plots of the transfers
                                                                                  according to the asymptotic gain model of
                                                                                  the voltage amplifier from Figure 10.13.
334 MODELING OF NEGATIVE FEEDBACK CIRCUITS

                                                  Mismatch between ideal gain and asymptotic gain

                                                  In the above example, the asymptotic gain approximates the ideal gain over
                                                  a wide frequency range. At low frequencies, the nonzero resistance of the
                                                  source and the nonzero conductance between the noninverting controller in-
                                                  put and the ground cause a small error: together, they constitute a voltage
                                                  divider. At high frequencies, the asymptotic gain drops due to the nonzero
                                                  values of the source resistance and the input capacitance of the controller.
                                                  In general, a finite impedance between an input terminal of the controller
                                                  and the ground will cause inaccuracy and nonlinearity in the transfer of am-
                                                  plifiers that have their controller inputs floating with respect to the ground.
                                                  Such impedances can almost never be avoided and should be kept as large
                                                  as possible because their influence cannot be reduced by increasing the loop
                                                  gain (see direct voltage comparison in Figure 7.7).

                                                      Below the part of the script for evaluation of the asymptotic gain.

                                                               43 htmlPage('Symbolic asymptotic-gain')
                                                               44 i1.setSimType('symbolic')
                                                               45 i1.setGainType('asymptotic')
                                                               46 result = i1.execute()
                                                               47 A = result.laplace
                                                               48 text2html('The asymptotic-gain is found as:')
                                                               49 eqn2html('A_f_oo', A)

                                                      The html page generated by this script has been shown in Figure 10.16.

Figure 10.16: Results of the symbolic
evaluation of the asymptotic gain of the
circuit from Figure 10.13

                                              This result can be written as:

                                              Af =  Ra + Rb                      Ri           1 RiRs ,  (10.31)
                                                       Rb                     Rs + Ri  1 + sCi Rs+Ri

                                              which clearly shows the influence of Ri and Ci on the asymptotic gain.

                                              Two-step design approach

                                              The servo function approximates unity at frequencies at which the magnitude
                                              of the loop gain is much larger than unity, while it approximates the loop gain
                                              at frequencies for which the magnitude of the loop gain is much smaller than
                                              unity. In the above example, the magnitude of the direct transfer is much
                                              smaller than that of the asymptotic gain. Hence, a two-step design approach
                                              steps, seems to be possible.

13 R.D. Middlebrook. Low-Entropy Ex-          10.3.4 Hand calculations of the loop gain
pressions: The Key to Design-Oriented
Analysis. Frontiers in Education Conference,  Although symbolic analysis programs such as SLiCAP provide an easy way
pages 399-403, 1991                           to derive expressions for the different transfer functions of the asymptotic
                                              gain model, they do not always present these expressions in a design-friendly
                                              way. In other words, it is not always easy to derive design conclusions from
                                              them. In the following examples, we will perform hand calculations based
                                              upon the calculation of current division factors. This method is known as
                                              design-oriented analysis, resulting in so-called low-entropy expressions, as de-
                                              scribed by R.D. Middlebrook.[Middlebrook1991]13
                                     10.3. ASYMPTOTIC GAIN MODEL 335

Ideal gain and asymptotic gain                                                                       Figure 10.17:
In the following example, we will evaluate the ideal gain and the asymptotic                             Left: Voltage amplifier with a nullor as
gain of a passive feedback voltage amplifier.
                                                                                                     the controller for evaluation of the ideal
   Example 10.5                                                                                      gain.

                                                                                                  +      Right: Voltage amplifier with an op-
                                                                                      -              erational amplifier for evaluation of the
                                                                                                     asymptotic-gain, the loop gain and the
+     +             +             +                                                                  direct transfer.

-     -             -             -

   Figure 10.17 shows two amplifier circuits: one with a nullor as the controller
and another with an operational amplifier.

   We will evaluate the ideal transfer from the configuration with the nullor. Since
both the input voltage and the input current of the nullor equal zero, we find:

      V = R1 + R2 .                  (10.32)                                                         +  ++
      Vs        R2

   The asymptotic gain will be evaluated from the configuration with the opera-                      -  --
tional amplifier. The small-signal model of the operational amplifier that is used
for the controller is shown in Figure 10.18. It is a single-pole operational ampli-                  Figure 10.18: Simple small-signal model of
fier with a gain-bandwidth product of GB [Hz], a DC voltage gain A0, an input                        the single-pole operational amplifier.
resistance Ri and an output resistance Ro.

   The small-signal model of the voltage amplifier with the operational amplifier is
shown in Figure 10.19. We will determine the asymptotic gain, the loop gain and
the direct transfer. To this end, we need to select the loop gain reference variable
A. A proper selection is one in which the controller behaves as a nullor if A  .

                                                                                                     Figure 10.19: Small-signal equivalent circuit
                                                                                                     of the passive feedback voltage amplifier.

                ++
                --

   +                           +

   -                           -

   This is the case if we select the voltage transfer of the operational amplifier14                 14 The voltage-controlled voltage source.
as the loop gain reference variable:
                                                                                                     15 The current through the input port of the
      A=        A0                   (10.33)                                                         active part flows through Ri only.

                    A0
                1 + s 2GB

   If the voltage gain of this voltage-controlled voltage source approaches infinity,

the voltage across the input port of the controller approaches zero for any finite

output voltage. Under this condition the current through the input port also ap-
proaches zero.15 Hence, the asymptotic gain equals the ideal gain of the amplifier:

      A f  = V  = R1 + R2 .          (10.34)
         Vs A              R2
336 MODELING OF NEGATIVE FEEDBACK CIRCUITS
                                                  Loop gain
                                                  In the following example, we will determine the loop gain of the amplifier.

                                                Example 10.6

Figure 10.20: Small-signal equivalent cir-                                                                              +-
                                                                                                       +
cuits for calculation of the loop gain. The

voltage gain of the operational amplifier

has been selected as the loop gain refer-                        ++                +

ence.

Left: Amplifier circuit in which the                             --                -

controlled source has been replaced with

an independent source.

Right: The circuit redrawn to easy hand         +                              +

calculations of the loop gain.

                                                -                              -

                                                For the evaluation of the loop gain, we need to replace the controlled source of

                                                the reference variable by an independent source Vc. The controlling voltage is the

                                                dependent variable Vi. According to its definition, the loop gain L = A should

                                                be obtained as:              L = A Vi .
                                                                                      Vc Vs=0
                                                                                                                         (10.35)

                                                   Figure 10.20 shows the equivalent circuits for the above steps. The circuit on

                                                the left shows the small-signal model with the controlled source replaced with an

                                                independent source and the controlling voltage Vi. To simplify the hand calcula-
                                                tions, the circuit has been redrawn on the right side.

Figure 10.21: Simplified small-signal                                                             -
equivalent circuit for calculation of the loop
gain.

                                                   A method, that is very well suited for the analysis of so-called ladder networks

                                                is based upon current division analysis: the voltage across Ri is the product of the
                                                current through Ri and the resistance Ri. The current IRi that flows through Ri
                                                can easily be obtained from network inspection. Figure 10.21 shows the modified

                                                network in which the series connection of Vc and Ro has been replaced with its
                                                Norton equivalent. With the aid of this schematic, we write:

                                                                 Vi = -IR1 R2 R R 2 + Ri + Rs i,          (10.36)
                                                                                                          (10.37)
                                                                 IR1 =  Vc         R                ,     (10.38)

                                                                                     

                                                                        Ro R + R1 + (R2 (R1 + Rs))

                                                                 R   =  (Ro  R) ,

                                                                   

                                                where the short notation (Ra Rb) represents the equivalent resistance of the par-
                                                allel connection of Ra and Rb:

                                                                        (Ra Rb) = RaRb Ra + R ,b          (10.39)
                                                                      10.3. ASYMPTOTIC GAIN MODEL 337

from which we obtain:

Vi = Vc (Ro R) -R2Ri Ro (Ro R . ) + R1 + (R2 (Ri + Rs)) R2 + R1 + Rs  (10.40)

   For design purposes, it is often convenient to leave the short notations for
parallel connections. From this, we find

 = Vi = R R2                                                          -Ri .
         Vc Vs=0 Ro R (Ro R) + R1 + (R2            (Ri + Rs)) R2 + Ri + Rs

   The loop gain L = A is now found as:                                       (10.41)

L = -A0 1 + s A 1 R 0 Ro + R (Ro               R2                       Ri .
                                  R) + R1 + (R2    (Ri + Rs)) R2 + Ri + Rs
                         2GB
                                                                            (10.42)

The five terms of the loop gain expression (10.42) give the following design

information:

1. The first term -A0 shows the contribution of the DC voltage gain of the opera-
   tional amplifier to the loop gain.

2. The second term  1        represents a unity gain low-pass transfer due to the pole

                      A0
                    1+s 2GB
of the operational amplifier.

3. The third term RoR+R represents the DC attenuation due to the finite value of
   the load resistance R and the nonzero value of the output resistance Ro of the
   operational amplifier.

4. The fourth term (Ro R)+R1+R(2R2 (Ri+Rs)) represents the DC attenuation in the
   loop gain caused by the feedback network. Note that this attenuation also depends
   on Ro, Ri, Rs and R. For ideal drive conditions of the feedback network: Ro = 0,
   Ri = , Rs = 0 and R = , this term simplifies to R R1+2R2 , which is the
   reciprocal value of the ideal gain of the voltage amplifier.

5. The fifth term R2+RRii+Rs shows the DC attenuation in the loop gain caused by the
   nonzero input resistance Ri of the operational amplifier.

   Writing the loop gain as a product of static and dynamic transfers as above
is very helpful for finding ways to implement frequency compensation. We will
show this at a later stage.

Direct transfer

In the following example, we will derive the direct transfer  of this passive
feedback voltage amplifier. It has been defined as the source-to-load transfer
with the reference variable set to zero.

Example 10.7

   Figure 10.22 shows the equivalent circuits for evaluation of the direct transfer.

The circuit on the left side is the small-signal equivalent circuit with the reference

variable set to zero. The circuit on the right has the components rearranged to
facilitate hand calculations. It clearly shows zero direct transfer if Ri =  or if
Ro = 0. With the aid of the current division method, we obtain:

 = R2                             (Ro R) .                            (10.43)
                    Rs + Ri + R2 R2 (Rs + Ri) + R1 + (Ro R)
338 MODELING OF NEGATIVE FEEDBACK CIRCUITS

Figure 10.22: Small-signal equivalent                                                +                                    +
circuit for calculation of the direct transfer,
with the voltage gain of the operational                                             -                                    -
amplifier selected as loop gain reference
variable.

                                                 +                                +

                                                 -                                -

                                                 10.3.5 Impedance model

                                                 With the asymptotic gain model, we have a negative feedback model that
                                                 relates one design parameter (the loop gain L) to the error of the source-to-
                                                 load transfer of the feedback amplifier with respect to its ideal gain. This
                                                 error includes:

                                                 1. Imperfect sensing of the load source quantity due to a non-ideal input
                                                    impedance of the amplifier

                                                 2. Imperfect driving of the load due to a non-ideal output impedance of the
                                                    amplifier

                                                 3. Imperfect input-to-output transfer due to a lack of controller gain.

16 Immittance: impedance or admittance.             In many cases, we are only interested in the total error of the source-to-load
                                                 transfer and it is not necessary to resolve this error in the above contributions.
17 Under the ideal sense and comparison          However, if accurate termination of the source and/or the load is required,
conditions shown in Figure 10.23 A and B,        we need to know the values obtained for the input and/or output impedance
the shunt feedback is non-existent.              of the amplifier. We will show that the asymptotic gain model can also be
                                                 used for this purpose.

                                                    Figure 10.23 shows the setup for the determination of the port immittance16
                                                 of a feedback amplifier. We will show that the immittance of the amplifier's
                                                 input or output port can be expressed in its asymptotic value and two func-
                                                 tions that express the influence of the finite loop gain for two different termi-
                                                 nation conditions:

                                                 1. The port is shorted, L = Lsc

                                                 This is the case if we determine the input admittance Yx f of the port by

                                                 driving it from a voltage source Vx while measuring the port current Ix,

                                                 as shown in Figure 10.23A for the input port of the amplifier and Figure

                                                 10.23C for its output port

                                                                                  Yx f = Ix Vx .                          (10.44)

                                                 Any shunt feedback to or from this port will become maximally ineffective

                                                 while series feedback is maximally effective and the loop gain obtained is
                                                 Lsc.17

                                                 2. The amplifier port is left open, L = Lo

                                                 This is the case if we determine the input impedance Zx f of the port by

                                                 driving it from a current source Ix while measuring the port voltage Vx,

                                                 as shown in Figure 10.23C for the input port of the amplifier and Figure

                                                 10.23D for its output port

                                                                                  Zx f = Vx Ix .                          (10.45)
                                                                               10.3. ASYMPTOTIC GAIN MODEL 339

                                                    Shunt feedback                      Figure 10.23: Measurement of the port
                                                    at amplifier
                                                    output port                         immitances of a negative feedback ampli-

                                                    +                                   fier with ideal output sensing and input

                                                           controller                   comparison conditions:
                                                           output
         controller   Shunt feedback                       port                             A: Measurement of the input admit-
         input        at amplifier                                                      tance Yx = IVxx . The input shunt feedback
         port         input port                                                        is ineffective. The feedback current Icomp

                                                                                        cannot change the input voltage or current

   +                                                                                    of the controller, because it flows only in

                   +                                                    +               Vx .

   -               -                       -                            -                   B: Measurement of the output admit-
                                      B                                                 tance Yx = IVxx . The output shunt feedback
      Series feedback                                         Series feedback           is ineffective. The feedback voltage Vsense
                                                              at amplifier
A     at amplifier                                            output port               cannot be changed by the controller, be-

      input port                                                                        cause it equals Vx.

                                                                                              C: Measurement of the input impedance
                                                                                                 Vx
                                                    Shunt feedback                      Zx    =  Ix  .  The  input  series  feedback  is
                                                    at amplifier
                                                    output port                         ineffective. The feedback voltage Vcomp

                                                                                        cannot change the input voltage or current

                                                                                        of the controller, because the driving

      + controller                                  +                                   impedance at the opposite terminal of the
                                                          controller +
           input      Shunt feedback                                                    controller input is infinity.
           port       at amplifier                         output
                      input port                           port                             D: Measurement of the output
                                                                                        impedance Zx = VI xx . The output se-
                   -                                                                    ries feedback is ineffective. The feedback
                   +
                                                                                        current Isense cannot be changed by the

      -                                    -                  -                         controller, because it equals Ix.
                                      D
      Series feedback                                         Series feedback
                                                              at amplifier
C     at amplifier                                            output port

      input port

   Any series feedback to or from this port will become maximally ineffective           18 Under the ideal sense and comparison
   while shunt feedback is maximally effective and we obtain a loop gain                conditions shown in Figure 10.23 C and D,
   Lo .18                                                                               the series feedback is non existent.

   We will now demonstrate the use of the superposition model and asymp-
totic gain model for evaluation of the port impedance of port x (input or
output). For measurement of the port impedance, we drive the port with a
current Ix and measure the response voltage Vx across the port.

   For the current drive condition from Figure 10.23B, we apply the superpo-
sition model with the following substitutions:

                   Es = Ix,         current flow in the port                   (10.46)
                   E = Vx,          voltage across the port                    (10.47)
                   E E = Z s x f ,
                                      port impedance                           (10.48)

The model equations of the superposition model now become

                      Vx =                          Ix Ec .                    (10.49)
                      Ei             o

The direct transfer  is now defined as the port impedance when Ec has

been set to zero:                    = Vx .
                                           Ix Ec=0

   The parameter o is defined as the transfer from the controlled quantity
Ec to the controlling quantity Ei at Ix = 0; in words, when the port has been
340 MODELING OF NEGATIVE FEEDBACK CIRCUITS

left open

                                            o = Ei .                     (10.50)
                                                       Ec Ix=0

We now have the following set of equations:

                                            Vx = Ix + Ec,                (10.51)
                                            Ei =  Ix + oEc,              (10.52)
                                            Ec = AEi.                    (10.53)

Substitution of (10.53) in (10.51) and in (10.52) yields

                                            Vx = Ix + AEi,               (10.54)
                                            Ei =  Ix + o AEi.            (10.55)

We now solve Ei from (10.55) and obtain                                  (10.56)
                                   Ei =  Ix 1 - o A .

We substitute this result in (10.54), which yields:

                                            Vx = Ix  +  A 1 - o A .      (10.57)

   We now obtain an expression for Zx f in terms of the parameters of the
superposition model:

                                            Zx f =  1 +  A 1  1 - o A .  (10.58)

We will now define a term sc as

                                            sc = Ei                      (10.59)
                                                        Ec Vx=0

We can obtain this factor sc from (10.54) and (10.58) for Vx = 0:

                                             0 = Ix + Ec,                (10.60)
                                            Ei =  Ix + oEc.              (10.61)

We then eliminate Ix:

                                            Ix = - Ec ,                  (10.62)
                                                                         (10.63)

                                            Ei = Ec o -  .
                                                                    

From (10.63) we obtain:

                                            Ei = sc = o -  .             (10.64)
                                            Ec Vx=0                   

From which we obtain                                 sc = o - 1 .
                                                                    
                                                                         (10.65)

The direct transfer  is the port impedance with the loop gain reference

set to zero. It is found as:                         = 1 .
                                                          o - sc
                                                                         (10.66)
                                                                  10.3. ASYMPTOTIC GAIN MODEL 341

We may then rewrite (10.58) as:

                           Zx f =  1 - sc A 1 - o A .             (10.67)

If we substitute Ao = Lo and Asc = Lsc we obtain:

                             Zx f =  1 - Lsc 1 - Lo .             (10.68)

   In the following sections, we will discuss this result for both single-loop
feedback amplifiers and multiple-loop feedback amplifiers.

10.3.6 Port impedance of single-loop feedback amplifiers

In single-loop feedback amplifiers, we have either parallel feedback or series
feedback at a port. In a case of solely parallel feedback, the ideal value of the
port impedance is zero. In case of solely series feedback at a port, the ideal
value of the port impedance is infinite. We have already concluded this in
Chapter 7. These conclusions can also be derived from (10.68).

Parallel feedback at a port

In a case of parallel feedback, the loop gain will be zero if we short the port.
Hence, we have Lsc = 0, and the port impedance can be written as

                                    Zx f =  1 1 - Lo .            (10.69)
The asymptotic value of the port impedance then equals zero:

                             Z f  = lim Zx f ,                    (10.70)

                                         A

from which we obtain

                      Zf  = lim  1 = 0.                           (10.71)
                               -Lo 1 - Lo

   This is, of course, as expected: both forms of parallel feedback, voltage
sensing at the output port and current comparison at the input port, were
used to create zero port impedance.

Series feedback at a port

In a case of series feedback, the loop gain will be zero if we leave the port
open. Hence, we have Lo = 0, and the port impedance can be written as

                             Zx f =  (1 - Lsc) .                  (10.72)

The asymptotic value of the port impedance then equals infinity:

                      Z f  = lim  (1 - Lsc) = .                   (10.73)

                                  - Lsc 

   This is also as expected: both forms of series feedback, current sensing at
the output port and voltage comparison at the input port, were used to create
an infinite port impedance.

Determination of the output impedance of an operational amplifier

In the following example, we will evaluate the output impedance of a nega-
tive feedback voltage amplifier. As stated earlier, the asymptotic gain model
342 MODELING OF NEGATIVE FEEDBACK CIRCUITS

19 The output impedance of the operational      accurately describes the source-to-load transfer of negative feedback ampli-
amplifier is often referred to as the open      fiers, including error contributions resulting from the non-ideal input and
loop output impedance.                          output impedance of the amplifier. For this reason, there is no need to eval-
                                                uate the port impedances of single-loop negative feedback amplifiers. The
                                                ideal port impedances of these amplifiers equal either zero or infinite. How-
                                                ever, many data sheets of operational amplifiers specify the so-called 'closed
                                                loop' output impedance. This 'closed loop' output impedance is a property of
                                                a negative feedback amplifier equipped with the operational amplifier, rather
                                                than a property of the operational amplifier itself. The following example
                                                shows the way in which the output impedance of the operational amplifier
                                                itself19 relates to the output impedance of the negative feedback amplifier.

                                                   Example 10.8

                                                       Let us consider the unity gain voltage amplifier from Figure 10.24A. It com-
                                                   prises an operational amplifier the model of which is shown in Figure 10.24B. For
                                                   the sake of simplicity, the impedance of the signal source has been taken as zero.
                                                   In practice, it would, of course, be useless to cascade an ideal voltage source with
                                                   a voltage follower!

Figure 10.24:                                                  +                            +     ++
    A: Unity gain negative feedback voltage                    -                           -      --
                                                                                      B
amplifier                                                                       +
    B: Small-signal equivalent model of the                                   -

voltage follower from (A).

                                                         +

                                                        -
                                                A

                                                   The circuit for the determination of the output impedance is shown in Figure
                                                10.25A. A current is driven into the output port and the voltage across the output
                                                port is measured. The output impedance Zf is defined as

                                                                                   Z f = Vo Io .                          (10.74)

Figure 10.25:                                               +
    A: Circuit for determination of the
                                                            -                                     ++
output impedance of the voltage follower.
    B: Small-signal equivalent circuit of (A).

                                                                                              --
                                                               +

                                                               -                                                          +

                                                                                                                          -

                                                A                                  B

                                                   Figure 10.25B shows the model for evaluation of the output impedance with

                                                the aid of the negative feedback model. The voltage gain Av of the operational
                                                amplifier will be selected as the loop gain reference:

                                                               A = A A0 .                                                 (10.75)
                                                                     1+s 0

                                                                                2GB

                                                   The controlled source will be replaced with an independent source Vc.
                                                                                           10.3. ASYMPTOTIC GAIN MODEL 343

                                                                                                    Figure 10.26:
                                                                                                        A: Circuit for determination of .
                                                                                                        B: Circuit for determination of o.

                                                                         +              +

                                               +                         -              -

                                               -

A                                                         B

   Figure 10.26A shows the circuit for evaluation of  and Figure 10.26B shows
the circuit for evaluation of o:

                      = Vo , o = Vi .                                                      (10.76)
                              Io Vc=0                         Vc Io=0

Please notice that the output impedance of the amplifier is defined with no load

connected; the output port is left open.

The direct transfer  can easily be found from network inspection of the circuit

from Figure 10.26A:

                            = Cc Ro .                                                      (10.77)
                                1 + sRo(Cd + 2 )

The loop gain Lo is found from the circuit from Figure 10.26B:

   Lo = Ao =                                   A0             -1                           (10.78)
                                                                       Cc .
                                                   A0
                                     1 + s 2GB 1 + sRo(Cd + 2 )

The output impedance Zf can now be obtained with the aid of (10.69) as

                                                     Ro
                                            1+sRo (Cd+ C2c ) .
                     Zf =     1+                  1           A0                           (10.79)

                                                          Cc     A0
                                        1+sRo(Cd+ 2 ) 1+s
                                                              2GB

With A0  1, this expression can be simplified to

Z f = Ro A0                                 1 + s A0                                    .  (10.80)
           1+s
                                                     2GB

                     R  o  (  1  Cc  +  Cd  )          1      2   Ro  (  1  Cc  +Cd  )
                              2                + 2GB          + s 2GB    2
                                 A0

   From this expression, we see that the low frequency value of the output impedance
of the voltage follower is A0 times smaller than the output resistance of the oper-
ational amplifier. The output impedance has a zero at the pole of the voltage gain
of the amplifier. In most cases, this zero will be dominant. At higher frequen-
cies, we find two poles. Hence, at frequencies above the frequency of the zero, the
output impedance of the voltage follower will be inductive, while at the highest
frequencies, it will be capacitive. This can be seen by letting s approach infinity:

                        Zf = 1 .                                                           (10.81)
                             s s 1 Cc + Cd

                                                 2

10.3.7 Port impedance of multi-loop feedback amplifiers

In this section, we will show that the port impedance of a multi-loop feedback
amplifier can be expressed in its asymptotic-value and the product of two
servo functions. These two servo functions are defined by the loop gain in
344 MODELING OF NEGATIVE FEEDBACK CIRCUITS

the situation in which the port is shorted, and in the situation in which the
port is left open. If the loop gain reference has been properly selected, the
asymptotic value of the port impedance is equal to its ideal value, just as we
found for the source-to-load transfer.

   The asymptotic value of the port impedance is defined as the value of the
port impedance (10.67) for A  :

                                            Z f  = lim Zx f =  sc .              (10.82)
                                            A               o

From this expression, we obtain:

                                             = Z f  o sc .                       (10.83)

After we substitute (10.83) in (10.67) we obtain an expression for the port

impedance in terms of its asymptotic value Zf  and two servo functions.

These servo functions describe the influence of the finite loop gains Lo and

Lsc:                                        Zx f = Z f  Lo 1 - Lsc 1 - Lo Lsc .

                                                                                 (10.84)

Just as in the case of the source-to-load transfer, if the reference variable is
selected properly, the asymptotic value of the port impedance is equal to the
ideal value of the port impedance. The ideal value is obtained assuming
nullor properties for the controller.

   Expression 10.84 shows that idealized single loop negative feedback am-
plifiers have either zero or infinite port impedances. The realization of accu-
rate finite nonzero port impedances requires the application of two feedback
loops, one establishing series feedback and another establishing shunt feed-
back at that port.

10.3.8 Application of asymptotic gain model in balanced
           amplifiers

In section 7.7, we have discussed the design of balanced amplifiers. We ob-
tained balanced amplifiers through anti-series connection of unbalanced am-
plifiers. We have seen that the differential-mode transmission-1 parameters
of balanced amplifiers show a simple relationship with the transmission-1
matrix parameters of their unbalanced version. The design and analysis of
the differential mode behavior of a balanced amplifier is therefore usually
performed by designing their unbalanced version and then connecting two
of those unbalanced amplifiers anti-series. Cross-coupling of feedback net-
works can be used to change the sign of the a (differential-mode) transmission
parameter of a balanced amplifier with multiple feedback loops (see section
7.7.5).

   We have seen that in truly balanced amplifiers, the common-mode to
differential-mode conversion and the differential-mode to common-mode con-
version are both zero (see section 7.7.3 for decomposition of balanced circuits
into common-mode and differential-mode equivalent circuits.). In such cases
we speak of orthogonality between common-mode and differential-mode
quantities.

   Although the information processing is governed by the differential-mode
behavior, the common-mode behavior of balanced negative feedback ampli-
fiers also needs to have our interest. Even in the absence of common-mode to
differential-mode conversion, the common-mode signal excursions should be
within the linear operating range of the devices and common-mode stability
must be ensured. If not, the quality of the differential-mode transfer will be
adversely affected by common-mode signals.
                                                                                                 10.3. ASYMPTOTIC GAIN MODEL 345

   The asymptotic gain model can be for the design of both the common-
mode behavior and the differential-mode behavior of balanced amplifiers. To
this end, we need to decompose the balanced amplifier into a differential-
mode and a common-mode equivalent circuit, as described in section 7.7.5.
The differential-mode behavior can then be design using the differential-
mode equivalent circuit and the common-mode behavior can be designed
with the aid of the common-mode equivalent circuit, both under applica-
tion of the asymptotic gain model. In this way we find differential-mode
and common-mode values for the asymptotic gain, the loop gain, the servo
function and the direct transfer. It should be clear that the differential-mode
ideal gain and the common-mode ideal gain are obtained after replacing the
controller in their respective equivalent circuits with a nullor.

10.3.9 Asymptotic gain model and network analysis                                    +                                      +

In this section we will discuss the way in which the ideal gain, the asymptotic      -                                      -
gain, the loop gain, the servo function, the direct transfer and the gain can
be calculated from the network equations, that are obtained from modified         Figure 10.27: Passive-feedback tran-
nodal analysis. We will illustrate this using an example of a transimpedance      simpedance amplifier with a voltage-
amplifier that uses a voltage-controlled current source as a controller. The      controlled current source as controller.
small-signal equivalent circuit of this amplifier is shown in Figure 10.27.

Ideal gain                                                                        +     +

The ideal gain of a feedback amplifier is obtained as the source-to-load trans-   -     -
fer of the circuit in which the controller has been replaced with a nullor. This
will be demonstrated in the following example.                                    Figure 10.28: Passive-feedback tran-
                                                                                  simpedance amplifier from Figure 10.27
Example 10.9                                                                      in which the controller has been replaced
                                                                                  with a nullor.
   Figure 10.28 shows the transimpedance amplifier from Figure 10.27, in which
the controller has been replaced with a nullor.

   The MNA matrix equation of the circuit is:

                Is 0 0 T = M Vi V IN T ,                                (10.85)

where                            Zs + Z f11        - Zf1      0
            M =                                               1  .
                       gm - Z - Zf   1      1   1Z + Z f  1   0         (10.86)
                                                                        (10.87)
                                     1                0

The    source-to-load  transfer  V   can    be  obtained  as
                                 Is

                                    V = C1,2 ,
                                    Is det M

where C2,1 is an element of the cofactor matrix of M (see Chapter 18).
   In this way we obtain

                       (-1)1+2 det          gm - 1 - 1 1

                                                      Z Z f

            V =                                    1          0     ,   (10.88)
                                                                        (10.89)
            Is                              det M

            VI = -Z s f .
346 MODELING OF NEGATIVE FEEDBACK CIRCUITS

                                             Asymptotic-gain

                                             The asymptotic gain of a feedback amplifier is obtained as the source-to-load
                                             transfer of the circuit in which the loop gain reference has been replaced with
                                             a nullor.

                                                 Example 10.10

                                                    For calculating the asymptotic gain of the circuit from Figure 10.27, we need
                                                 to replace the selected reference variable with a nullor. In this simple circuit,
                                                 the voltage-controlled current source is the controller and the loop gain reference
                                                 variable. Hence, replacement of the reference variable with a nullor yields the
                                                 circuit from Figure 10.28 and the asymptotic gain A f  equals the ideal gain:

                                                                    Af = -Zf .          (10.90)

                                             Loop gain

20 H.W. Bode. Network Analysis and Feedback  In 1945, Bode [Bode1945]20 published 'Network Analysis and Feedback Am-
Amplifier Design. Van Nostrand, New York,    plifier Design'. In this fundamental work, Bode stated that a useful distinc-
1945                                         tion between a forward transfer and a feedback transfer as it was made in
                                             Black's feedback model, cannot be made in real physical circuits. This is
21 The term (1 + Hk) in 10.5.                because in such circuits, parasitic feedback paths almost always exist. There-
                                             fore, in practice, the loop gain as the product of the forward gain H, and the
                                             feedback factor k, is not always a measure for the quality improvement of the
                                             signal transfer.21

                                                For this reason Bode introduced the terms return difference and return ra-
                                             tio that have a meaning for a specific selection of a controlled source. The
                                             relation between the return difference F and the return ratio T is

                                                                    F = (1 + T) .       (10.91)

                                                 The asymptotic gain model is based upon the work of Bode. The loop gain

                                             as defined in the asymptotic gain model can be obtained from the return ratio

                                             as

                                                                       L = -T.          (10.92)

                                                Bode showed, that for a given selection of the reference variable, the return
                                             difference can be calculated as

                                                                    F = det M0 det M ,  (10.93)

                                             where M is the MNA matrix of the network and M0 is obtained from M,
                                             after replacing the gain of the selected reference variable with zero.

                                                 Example 10.11

                                                    Let us now calculate the loop gain for the circuit from Figure 10.27. We will
                                                 first calculate the return difference F with gm as reference. The MNA matrix
                                                 equation of the network can be formulated as

                                                                    Is0 = M Vi V ,      (10.94)
                                                                                        (10.95)
                                                 where              Zs + Z f11  -1

                                                                M=                 Zf
                                                                            11 1 .
                                                                    gm - Zf Z + Zf
                                                                  10.3. ASYMPTOTIC GAIN MODEL 347

The matrix M0 is obtained after substitution of gm = 0 in M:

                    1Zs + Z f 1  - Zf1

              0M=          1     1 1.                             (10.96)
                                                                  (10.97)
                       - Zf      Z + Z f

With the aid of (10.93) the return difference can be obtained as

                 F = 1 + gmZsZ .
                            Z f + Zs + Z

   The loop gain L, as it has been defined in the asymptotic gain model, can
be obtained from the return difference as

                    L = 1 - F.                                    (10.98)

Example 10.12

   Let us now calculate the loop gain with gm as reference variable for the circuit
from Figure 10.27. After substitution of (10.97) in (10.98), we obtain

                 L = - gmZsZ .                                    (10.99)
                         Z f + Zs + Z

Servo function                                                    (10.100)
The servo function can be obtained from the return difference as

                                          S = 1- F.
                                                     F

Example 10.13

   We will evaluate the servo function for the circuit from Figure 10.27 using gm
as loop gain reference. After substitution of (10.93) in (10.100), we obtain

which yields          S = det M0 - 1,                             (10.101)
                             det M                                (10.102)

              S = -Zs gmZ .
                    Z f + Zs + Z + Zs gmZ

Direct transfer

The direct transfer is defined as the source-to-load transfer with the gain of
the loop gain reference set to zero. Hence, it can be calculated from the matrix
M0.

   Example 10.14

       The direct source-to-load transfer for the circuit from Figure 10.27, with gm
   selected as loop gain reference variable can be obtained as

                 V               (-1)3 - 1
                                        Zf
              =           =             0,                        (10.103)
                 Is gm=0         det M                            (10.104)

which yields

                   = ZsZ .
                       Z f + Zs + Z
348 MODELING OF NEGATIVE FEEDBACK CIRCUITS

Gain

An important property of the asymptotic-gain model is that the source-to-
load transfer can be calculated from the asymptotic gain, the loop gain and
the direct transfer, or directly from the matrix M. Both calculation methods
yield the same result.

   Example 10.15

                                            V (-1)3 gm - Z1f
                                                =                                 ,  (10.105)
                                            Is          1Zs + Z f1  - Zf1

                                                   det          11          1
                                                        gm - Zf Z + Zf

which yields

                                                V  =    -ZsZ Z f gm - 1        .     (10.106)

                                                Is Z f + Zs + Z + Zs gmZ

This expression could also have been obtained through application of the asymp-

totic gain model:

                                                   VI = A s f S +  1 - L .           (10.107)

after substitution of (10.90), (10.102), (10.104) and (10.99) into (10.107), we also
obtain (10.106).

10.3.10 Conclusions

We have seen that the asymptotic gain model is very well suited for a two-
step design of negative feedback amplifiers. The only important condition is
that the loop gain reference variable is chosen properly.

   The ideal gain as it has been fixed with the feedback elements, matches
the asymptotic gain, if the controller behaves as a nullor when the controlled
source that has been selected as the loop gain reference variable is replaced
with a nullor.

   This will not be the case if:

1. The reference variable is selected in a local feedback loop in the controller.

   With operational amplifiers as controllers, this situation can almost always
   be avoided.

2. Parasitic impedances at one or more port terminals:

   · Introduce an attenuation in the coupling between the source and the
       amplifier, and/or the amplifier and the load

   · Introduce an attenuation in the feedback network(s).

   In such cases, the asymptotic gain model can still be applied. Those
   impedances can easily be extracted from the controller and assume to be
   part of the feedback network, the source or the load. In doing so, the ideal
   gain is modified and the asymptotic gain will equal this modified ideal
   gain.
                                                                349

11 Amplifier performance and controller

requirements

11.1 Introduction                                          350

11.1.1 This chapter                                        350

11.2 Accuracy design considerations                        351

11.2.1 Static inaccuracy of the servo function             351

11.2.2 Design conclusion                                   352

11.3 Nonlinearity design consideration                     352

11.3.1 Loop gain differential gain error                   352

11.3.2 Design conclusion                                   353

11.4 Bandwidth design considerations                       353

11.4.1 Midband frequency range and bandwidth               354

11.4.2 All-pole loop gain functions                        354

11.4.3 Low-pass cut-off and loop gain-poles product        355

11.4.4 High-pass cut-off and DC loop gain                  364

11.4.5 Low-pass cut-off with poles and zeros               369

11.4.6 High-pass cut-off with poles and zeros              370

11.4.7 Procedure for determination of the servo bandwidth  370

11.4.8 Design conclusions                                  372

11.5 Stability of negative feedback amplifiers             372

11.5.1 Routh-Hurwitz criterion                             373

11.5.2 Nyquist criterion                                   374

11.5.3 Root locus analysis                                 376

11.5.4 Non-observable and non-controllable states          380

11.5.5 Design conclusions                                  381
350 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

1 If the loop gain reference variable has  11.1 Introduction
been selected properly and if the direct
transfer can be neglected.                 Negative feedback is an error reduction technique that uses the available
                                           power gain of a controller for quality improvement of the transfer of the
                                           feedback amplifier. With a high-gain controller, the bandwidth, the linearity
                                           and the accuracy of a negative feedback amplifier are primarily defined by
                                           the feedback network(s). In the following sections, we will discuss to what
                                           extent performance limitations of the controller affect those of the negative
                                           feedback amplifier. This knowledge will help us in setting up the perfor-
                                           mance requirements for the controller.

                                              We have already seen that the controller adds noise to the signal. For
                                           given noise sources of the controller, the smallest noise contribution can be
                                           achieved with nonenergic feedback. With other implementations of feedback,
                                           the feedback network enlarges this contribution and possibly adds noise it-
                                           self. This deterioration of the noise behavior can be kept small by placing
                                           only relatively small impedances in series with the signal path and/or small
                                           admittances in parallel with the signal path. These small impedances and
                                           admittances can have a large effect on the port impedances of the feedback
                                           amplifier (see section 10.3.5). Hence, when compared with the use of brute-
                                           force techniques, we are able to design the port impedances, the transfer and
                                           the signal-to-noise ratio of a feedback amplifier almost independently. We
                                           will see that this is also true for other performance aspects, such as the static
                                           accuracy, the nonlinearity and the bandwidth of feedback amplifiers.

                                              With the aid of the asymptotic gain model, the source-to-load transfer of
                                           a feedback amplifier can be approximated by the product of its ideal transfer
                                           and the servo function.1 With a nullor as controller the servo function equals
                                           unity and the source-to-load transfer equals the ideal transfer. A practical
                                           controller cannot behave as a nullor; it will have a finite available power
                                           gain and suffer from speed and power limitations. Therefore, in practice, the
                                           servo function will only approximate unity over a limited operating range
                                           of the controller. Since the servo function is completely determined by the
                                           loop gain, designing the servo function means designing the loop gain. The
                                           elements that contribute to the loop gain are:

                                           1. The controller

                                           2. The feedback network

                                           3. The source and the load impedance

                                              The source and the load impedances are part of the application specifica-
                                           tion of the amplifier. The feedback network has been designed on grounds
                                           of the desired transfer, its noise contribution and its effect on the power effi-
                                           ciency. Design or selection of the controller is what remains. This starts with
                                           setting up its performance requirements. The specification of the controller
                                           requirements in relation to the performance of the amplifier is the main topic
                                           of this chapter.

                                           11.1.1 This chapter

                                           In the following sections, we will study the influence of the following perfor-
                                           mance limitations:

                                           1. Finite static loop gain
                                              A finite static (DC) loop gain can be caused by:

                                              (a) A finite static gain of the controller
                                              (b) One or more zeros in the loop gain at s = 0
                                                                                11.2. ACCURACY DESIGN CONSIDERATIONS 351

   (c) One or more zeros at s = 0 in the impedance or in the admittance of
       the source and/or the load

   The effect on the static accuracy of the feedback amplifier will be discussed
   in section 11.2.

2. Nonlinear loop gain
   Nonlinearity of the loop gain can be caused by:

   (a) Nonlinear transfer of the controller
   (b) Nonlinearity in the transfer of the feedback network
   (c) Nonlinear behavior of the source or the load

   The relation between nonlinear behavior of the loop gain and that of the
   feedback amplifier will be discussed in section 11.3.

3. Bandwidth limitation of the loop gain
   Bandwidth limitation of the loop gain can be caused by:

   (a) Bandwidth limitation of the controller gain
   (b) Bandwidth limitation in the transfer of the feedback network
   (c) Dynamic character of the source and/or the load

   The relation between the dynamic behavior of the loop gain and that of
   the feedback amplifier will be discussed in section 11.4.

11.2 Accuracy design considerations

The static inaccuracy of a system is defined in section 17.5.2. The static inac-
curacy of a negative feedback amplifier is determined by the static inaccuracy
of the ideal gain and by that of the servo function. The static inaccuracy of
the ideal gain is determined by the inaccuracy of the static transfer of the
feedback network. The static inaccuracy of the servo function is determined
by the value of the DC loop gain.

11.2.1 Static inaccuracy of the servo function

The static inaccuracy DC introduced by the servo function is its difference

from unity at DC:

                   DC = SDC - 1,                           (11.1)

where SDC is the value of the servo function at zero frequency. With the aid
of the DC loop gain LDC, we may write

                   DC = -LDC 1 - L - 1 = - 1 . DC 1 - LDC  (11.2)

For |LDC|  1, this can be approximated by

                   DC  1 .                                 (11.3)
                            LDC

   Hence, for a static inaccuracy of -1%, we need a DC loop gain of about
-100. Negative feedback will result in a one-sided static inaccuracy, in other
words, the servo function will always be less than unity. The error can be
made symmetrical by compensating 50% of the error budget in the ideal
gain.
352 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                        11.2.2 Design conclusion

                                                  In general, we may say that a high accuracy requires a large loop gain:

                                                                In order to obtain the static inaccuracy of a feedback amplifier within specifi-
                                                            cations, the controller must provide a sufficiently large DC loop gain.

11.3 Nonlinearity design consideration

Negative feedback is capable of reducing errors due to the nonlinear behavior
of the controller. The nonlinearity of the controller causes nonlinearity of the
loop gain and of the servo function. Let us assume the asymptotic gain is
linear and equals the ideal gain. The nonlinearity of the gain of the feedback
amplifier is then fully determined by the nonlinearity of the loop gain.

11.3.1 Loop gain differential gain error

Let y,L be the differential gain error of the loop gain Ly at a load signal ex-

cursion y from the quiescent operating point. The loop gain in the quiescent

operating point equals LQ. The differential gain of the loop gain is defined

as                          y,L = Ly - LQ .

                            LQ                                (11.4)

    The differential gain y,Af of the source-to-load transfer is defined as

                            y,A f = A f ,y - A f ,Q A f ,Q    (11.5)

in which A f ,y is the gain of the source-to-load transfer at a load signal excur-
sion from the quiescent operating point of y:

                            A f ,y = A f  -Ly 1 - Ly ,        (11.6)

and A f ,Q is the source-to-load transfer in the quiescent operating point Q:

                            A f ,Q = A f  -LQ 1 - L . Q       (11.7)

    Substitution of (11.6) and (11.7) in (11.5) yields

    y,A f =                 A f  1-Ly -Ly - A f  1-LQ -LQ     (11.8)
                            -LQ .
                            A f  1-LQ

    This can be written as

                            y,A f = Ly - LQ 1 L . Q 1 - Ly    (11.9)

    With the aid of (11.4), we may write this as              (11.10)
                                        y,A f = y,L 1 - Ly .

   Hence, the differential gain of a negative feedback amplifier at a load sig-
nal excursion y from the quiescent operating point equals that of the con-
troller at the load operating point y, divided by the return difference at that
operating point.
                        11.4. BANDWIDTH DESIGN CONSIDERATIONS 353

   If the differential gain of the loop gain at a load signal excursion y from
the quiescent operating point is small, we may also write this as:

y,A f = y,L .           (11.11)
          1 - LQ

   Hence, the differential gain of a negative feedback amplifier can be re-
duced by increasing the loop gain in such a way that the differential gain
error of the loop gain is not increased.

11.3.2 Design conclusion

    The contribution of the controller to the nonlinearity of the amplifier can be min-
    imized by minimizing its contribution to the differential error-to-gain ratio of the
    loop gain.

   For this reason, we will use the contribution of the controller to the differ-
ential error-to-gain ratio of the loop gain, as a figure of merit for a controller
and for any amplification stage in it.

11.4 Bandwidth design considerations

In this section, we will study the dynamic behavior of negative feedback
amplifiers and see the way in which the dynamic behavior of the controller
contributes to that of the feedback amplifier. To do so, the negative feedback
amplifier will be modeled as a linear time-invariant dynamic system.

   With the aid of the asymptotic gain model, the source-to-load transfer of a
negative feedback amplifier can be written as

A f (s) = A f (s)S(s),  (11.12)

in which s is the Laplace variable.
   With proper selection of the loop gain reference variable, the asymptotic

gain A f (s) equals the ideal gain of the amplifier. During the conceptual
design of the amplifier, any desired filter characteristic can be given to the
ideal gain. This is done by designing feedback networks that establish the
required dynamic behavior. Hence, at first glance, it seems difficult to give a
definition of the bandwidth of a negative feedback amplifier, because it can
have many intended filter characteristics. However, with the aid of the servo
function S(s), we are able to decouple the desired filter characteristics from
bandwidth limitations caused by controller imperfections. These limitations
are described by the servo function:

1. A high loop gain over the frequency range of interest results in a servo
   function whose magnitude approaches unity at these frequencies.

2. A lack of loop gain at high frequencies and/or at low frequencies mani-
   fests itself in a high-frequency and/or low-frequency roll-off of the servo
   function.

   Hence, the bandwidth of an approximate unity-gain servo function can be
used as a figure of merit for the dynamic performance of a negative feedback
amplifier. A servo function with a large bandwidth implies that the transfer
of the negative feedback amplifier approximates its ideal transfer over a large
frequency range.
354 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                        11.4.1 Midband frequency range and bandwidth

                                                  If we want to achieve a small error over the frequency range of interest, we
                                                  need a large loop gain at these frequencies. The frequency range over which
                                                  the loop gain is much larger than unity will be referred to as the midband
                                                  frequency range. The loop gain at these frequencies will be referred to as
                                                  the midband loop gain LMB. In this frequency range, the midband inaccuracy
                                                equals MB = L 1MB ; this follows from (11.3). Outside the midband frequency
                                                  range, the error with respect to the asymptotic gain increases due to a lack
                                                of loop gain: |L(j)| < 1, and the controller is no longer capable of reducing
                                                  errors. We will define the bandwidth of a negative feedback amplifier as
                                                  follows:

    The bandwidth of the negative feedback amplifier is defined as the distance
between the lowest frequency  and the highest frequency h at which the
servo function drops -3dB below its midband frequency value. Otherwise, the

bandwidth of a negative feedback amplifier is the -3dB bandwidth of the servo

function.

   With this definition, we have decoupled the intended filter characteristic of

the amplifier from the bandwidth limitation caused by controller limitations.
If |L(j)|  1, the bandwidth of a negative feedback amplifier defines the

frequency range over which the gain of the feedback amplifier approaches its

ideal gain.
   In cases in which L(s) has no zeros, the midband frequency loop gain LMB

equals the DC value of the loop gain LDC, and the servo function Fs(s) has
a low-pass filter characteristic. We will first study the design considerations

for this case and later study situations in which there are zeros in the loop

gain.

11.4.2 All-pole loop gain functions

For all-pole loop gain functions that have no poles at s = 0, L(s) can be

expressed in its DC value LDC and its poles. A loop gain function with n
poles pi can then be written as

L(s) = n LDC .                                                       (11.13)
           1 - psi

            i=1

With the aid of (10.29), the servo function can then be obtained as

S(s) = n           -LDC .                                            (11.14)
                 1 - psi - LDC

            i=1

   We will write this expression as the product of a DC term and a unity-gain
dynamic transfer:

S(s) = -LDC      1                             .                     (11.15)

1 - LDC 1 + ... + (-1) (1-L ) n pn   sn

                                     DC i=1 i

   The DC term describes the static inaccuracy with respect to the asymptotic
gain. The static inaccuracy has already been discussed in section 11.2. The
unity-gain dynamic transfer function has our interest and particularly the
                                                                              11.4. BANDWIDTH DESIGN CONSIDERATIONS 355

highest coefficient of s of the denominator. This term describes the roll-off
at the highest frequencies. From (11.15), we see that this coefficient equals
the reciprocal value of the product of the poles and the DC return difference
(1 - LDC). With -LDC  1, it approximates the product of the DC loop gain
and the poles. In the following section, we will derive a relation between this
so-called loop gain-poles product and the bandwidth of the servo function.

11.4.3 Low-pass cut-off and loop gain-poles product

The aim of the design of the high-frequency behavior is to let the servo func-
tion S(s) approximate unity over as wide a frequency range as possible and
have a smooth transition to roll-off at high frequencies, while all poles of S(s)
have a negative real part. Hence, we will assume that a Maximum Flat Mag-
nitude (MFM) or Butterworth filter characteristic has to be established for the
servo function.

MFM response

The bandwidth n of a system with an n - th order MFM characteristic shows
a very simple relation to the n system poles p1 · · · pn:

                                       n          (11.16)

                       n = n  |pi|.

                                     i=1

   The poles of MFM systems can be found by taking the n poles with a
negative real part from the 2n poles spaced equally over a circle centered at
the origin of the complex plane. The pole positions of first, second and third
order Butterworth filters are shown in Figure 11.1.

                                                                                   Figure 11.1: Pole positions of first, second
                                                                                   and third order Butterworth filters.

The unity-gain MFM transfers of the first-order, second-order and third-

order are:             H1(s) = 1 1 + s/n ,

                                                  (11.17)

              H2(s) =  1 ,                        (11.18)
                         1 + s 2/n + s2/n2

              H3(s) =  1                    3 3.  (11.19)

                        22
                       1 + 2s/n + 2s /n + s /n

   In order to achieve an MFM characteristic for the servo function, the poles
of S(s) have to be manipulated into Butterworth positions. We will assume
that the poles of S(s) can be divided into two groups:

1. Dominant poles

   The dominant poles are the poles that can be manoeuvred into Butterworth
   positions; they will determine the bandwidth of the servo function.
356 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                             2. Non-dominant poles

                                                The non-dominant poles are assumed to have no significant influence on
                                                the high-frequency behavior, since their frequency is far beyond the -3dB
                                                cut-off frequency of the servo function.

                                                Hence, according to equations (11.15) and (11.16), the bandwidth n of a
                                             negative feedback amplifier with an n - th order MFM characteristic can be

                                             obtained as:

                                                           n = n                     n  (11.20)

                                                                  (1 - LDC)  pi .

                                                                                   i=1

                                                With |LDC|  1, we see that the bandwidth of a negative feedback am-
                                             plifier is determined by the product of the DC loop gain and the dominant
                                             poles of the loop gain. Since this is larger than the bandwidth of the loop
                                             gain itself, we see that negative feedback is capable of reducing the errors as
                                             a result of the speed limitations introduced by the controller.

                                                In order to establish an MFM characteristic, the servo function must be an
                                             all-pole function, and the dominant poles of the servo function, have to be
                                             manipulated into the desired filter positions. Before discussing frequency com-
                                             pensation techniques for manipulating these poles into Butterworth positions,
                                             we will introduce techniques for separating the high-frequency poles of L(s)
                                             into dominant and non-dominant poles.

                                             Other filter types

                                             The design method for high frequency behavior is also valid for other filter
                                             characteristics, e.g. Gaussian or Chebyshev filters. For filters with a Gaussian
                                             response, such as Bessel Filters, n is smaller, and for filters with an MFM
                                             response. For a Chebyshev response, n is larger than that obtained from
                                             11.16. In all cases, however, the loop gain-poles product can be taken as a
                                             design parameter for the bandwidth of a negative feedback amplifier.

2 The frequency p of a pole p is defined as  Dominant poles
its magnitude: p = Re(p)2 + Im(p)2.
                                             We will now present a way to determine whether poles are dominant or non-
3 The pole with the lowest frequency.        dominant. Figure 11.2 shows an example of the asymptotes of the magnitude
                                             characteristics of the asymptotic gain A f (), the source-to-load transfer
                                             A f (), the loop gain L() and the servo function S() of a negative feedback
                                             amplifier. The intended frequency characteristic of the amplifier's source-to-
                                             load transfer is that of A f (). In this figure, the loop gain L() has been
                                             given three poles, p1, p2 and p3, of which the corresponding frequencies are
                                             denoted as p1, p2 and p3, respectively.2 The high-frequency MFM -3dB
                                             frequency h of the negative feedback amplifier is the frequency at which
                                             the asymptote of the magnitude characteristic of the servo function intersects
                                             with its DC value. This frequency equals 2. This figure clearly shows the
                                             second order low-pass character of the magnitude characteristic. Obviously,
                                             the third pole does not belong to the dominant group.

                                                This can be seen as follows. If only p1 was assumed dominant, the servo
                                             function would have had a bandwidth of 1. This assumption would have
                                             been wrong, because p2 < 1. If all three poles were to have been assumed
                                             dominant, the servo bandwidth would have been 3. This assumption would
                                             also have been wrong, because at 3, the servo function has already dropped
                                             below its DC value.

                                                The procedure for finding the order of the system (the number of dominant
                                             poles) is thus as follows:

                                             1. Rank the high-frequency poles of L(s) with increasing frequency: start
                                                with the most dominant pole3 and end with the pole with the highest
                                                                  11.4. BANDWIDTH DESIGN CONSIDERATIONS 357

                                                                                                      Figure 11.2: Example of the frequency
                                                                                                      characteristics of the asymptotic gain, the
                                                                                                      loop gain and servo function of a negative
                                                                                                      feedback amplifier.

magnitude logarithmic scale

                             frequency [rad/s] logarithmic scale

   frequency; here, |p1| < |p2| < |p3|.

2. Calculate the -3 dB frequency for increasing order of the system: for the
   amplifier from this example, we find

                             1 = |(1 - LDC) p1| ,                 (11.21)
                             2 = |(1 - LDC) p1 p2|,               (11.22)

                             3 = 3 |(1 - LDC) p1 p2 p3|.          (11.23)

3. The order n is the number for which n has the smallest value.

   Alternatively, we may say that a pole is dominant if its frequency is below
the frequency of intersection of its corresponding asymptote of the magni-
tude characteristic of the loop gain, and unity (see Figure 11.2).

Design conclusion

We are now able to relate the bandwidth of a negative feedback amplifier
to properties of the controller and formulate design requirements for the
controller.

    In order to obtain the desired low-pass cut-off frequency of a negative feedback
    amplifier, the controller should raise the product of the loop gain and the domi-
    nant poles to a sufficiently large value.

   Although the asymptotic description provides a method for finding the
requirements for the controller's contribution to the loop gain-poles product,
the magnitude characteristic of the servo function can deviate considerably
from the asymptotic values. We have already seen that an MFM character-
istic requires the poles of the servo function to be in Butterworth positions.
Usually, the dominant poles of the servo function will not have their desired
358 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                                  positions and frequency compensation techniques have to be applied to bring
                                                  these poles into their desired positions. Independent design of the bandwidth
                                                  and the frequency response requires that application of frequency compen-
                                                  sation techniques does not affect the product of the loop gain and the poles.
                                                  Such techniques will be discussed in Chapter 12. Before we discuss these
                                                  techniques, we need to study the influence of zeros in the loop gain on the
                                                  bandwidth of the servo function. This will be done in the following sections.

                                                      We will conclude this section with two examples in which we will derive
                                                  requirements for the properties of an operational amplifier that determine
                                                  the bandwidth of a transimpedance amplifier in which it has been used as a
                                                  controller. In the first example, we will derive the design equations manually.
                                                  In the second example, we will use numeric values and demonstrate the use
                                                  of SLiCAP.

                                                Example 11.1

                                                   In this example, we will derive requirements for the gain-bandwidth product
                                                of an operational amplifier that will be used as a controller in a transimpedance
                                                amplifier. The transimpedance amplifier is shown in Figure 11.3A. It converts the
                                                current of a capacitive source into a voltage across a resistive load. The small-
                                                signal equivalent model of the single-pole operational amplifier is shown in Figure
                                                11.3B. The complete small-signal model of the circuit is depicted in Figure.11.4.

Figure 11.3:                                       -                                +
    A: Transimpedance amplifier that
                                                                          +            ++
converts the current from a capacitive             +
source into a voltage across a resistive load.

    B: Model of the operational amplifier
used in (A).

                                                                        -              --

                                                                                    -

                                                A                                   B

                                                   With the aid of the asymptotic gain model, we are able to find a relation between

                                                the bandwidth of the transimpedance amplifier and properties of the operational

                                                amplifier. To do so, we select the voltage gain Av of the operational amplifier as

                                                the loop gain reference. With this selection, the asymptotic gain equals the ideal

                                                gain of the amplifier:

                                                                        Af = -Rf .         (11.24)

                                                   The error with respect to this ideal transfer is now completely determined by
                                                the servo function, while, in its turn, the servo function is completely defined by
                                                the loop gain.

Figure 11.4: Small-signal model of the                                       -+ +
transimpedance amplifier from Figure 11.3
with the operational amplifier model from
Figure 11.3B.

                                                                             +-        -
                                                              11.4. BANDWIDTH DESIGN CONSIDERATIONS 359

An expression for the loop gain can be found from network inspection:

L = - A A0 R 1                                             +      +  Cc  .  (11.25)
        1 + s 2G0 B R + Ro 1 + s (Ro R) + R f                        2
                                                       Cs     Cd

The DC loop gain LDC equals                                                 (11.26)
                             LDC = -A0 R R .  + Ro

The two poles of the loop gain are found to be

     p1 = - 2GB [rad/s]              +         +    Cc     [rad/s].         (11.27)
                 A0                                 2                       (11.28)

     p2 = - 1                    Cs     Cd
                (Ro R) + R f

   If both poles are dominant, the amplifier can be realized with a second order

MFM response with bandwidth B that can be obtained from the product of the
DC loop gain and the poles:

B =  2 GB R                   1                               [rad/s].      (11.29)

     R + Ro (Ro R) + R f         Cs  +  Cd          +  Cc
                                                       2

   From (11.29), we can derive a relation between the circuit parameters and the
achievable bandwidth Bf (in [Hz]) of the transimpedance amplifier:

GB R 1                                               2B2f [Hz].             (11.30)
R + Ro (Ro R) + R f       +          +  Cc
                     Cs          Cd     2

   The unknown parameters in this equation are GB, Ro, Cd and Cc. The other
parameters Cs, R f and R, as well as the required bandwidth Bf , follow from the
specification of the amplifier.

   The maximum contribution that the operational amplifier can deliver to the

loop gain-poles product of the transimpedance amplifier is GB. This occurs if

             Cd + Cc2  Cs,                                                  (11.31)
                    Ro  R,
                                                                            (11.32)
                    Ro  R f .                                               (11.33)

   If these conditions are met, the relation between the achievable bandwidth Bf
and the gain-bandwidth product GB of the operational amplifier simplifies to

             Bf =       GB [Hz],                                            (11.34)
                     2R f Cs

and we find a design limit for the gain-bandwidth product of the amplifier:

             GB  2R f CsB2f [Hz].                                           (11.35)

   GB = 2R f CsB2f is a lower limit for the gain-bandwidth product. Any device       4 Action, condition, event, or problem
with a smaller value would be a show-stopper.4                                       that is serious enough to halt an activity,
                                                                                     program, or process until it is resolved
   Until now, we have assumed that both poles are dominant. This is not neces-       (http://www.businessdictionary.com).
sarily true. If we require a small bandwidth, e.g., smaller than the frequency of
p2, this pole may be kept away from the dominant pole. The expression for the
360 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                           loop gain then changes to:

                                                                     L = - 1 + s A A0 R 0 R .  + Ro                    (11.36)
                                                                                                                       (11.37)
                                                                                                   2GB

                                           The lower limit for GB then follows from
                                                                          GB > R + Ro Bf .
                                                                                       R

                                              However, this first order approximation is only valid if the second pole is not
                                           dominant thus,

                                               Bf  1                                     +              +  Cc  ,       (11.38)
                                                       2 (Ro R) + R f                                      2
                                                                                     Cs     Cd

                                           and if the gain-bandwidth product is sufficiently small

                                               GB  R + Ro 1                                 +           +  Cc     .    (11.39)
                                                           R 2 (Ro R) + R f                                2
                                                                                        Cs     Cd

                                              In the next example, we will use numeric values and demonstrate the use
                                           of SLiCAP for determination of controller properties that contribute to the
                                           low-pass cut-off of the amplifier.

                                              Example 11.2
                                                  We will start with the definition of the target specifications of the transimpedance

                                              amplifier from the previous example. We will consider its dynamic behavior only.
                                              The target specifications that are relevant for the dynamic behavior are:

                                           1. Source capacitance: 5pF

                                           2. Load resistance: 2k

                                           3. Transimpedance gain: 100k

                                           4. Signal frequency range: 500kHz

                                                  The circuit for the generation of the netlist is depicted in Figure 11.5.

Figure 11.5: Circuit diagram of the tran-                                    R1
simpedance amplifier for evaluation with
SLiCAP.

                                                                           (1)                              (2)

                                                                                    -+                              +

                                           I1  C1  C2                  C3                                  R3

                                                                           +-                                      -

                                                                           E1
                                                                           model EZ

                                                  The SLiCAP netlist:

                                            1 transimpedance
                                            2 * file: transimpedance.cir
                                            3 * SLiCAP circuit file
                                            4 I1 0 1 {I_s}
                                            5 C1 1 0 {C_s}
                                            6 C2 1 0 {C_d}
                                            7 C3 1 0 {C_c/2}
                                            8 R1 1 2 {R_f}
                                            9 R2 2 0 {R_ell}
                                           10 E1 2 0 0 1 EZ value={A_0/(1+s*A_0/2/pi/G_B)} zs={R_o}
                                    11.4. BANDWIDTH DESIGN CONSIDERATIONS 361

11 .param C_s=5p R_f=100k R_ell=2k
12 .end

       Below is the part of the listing of the script file that performs the checking of
    the circuit and the definition of the simulation variables, such as the simulation
    type, the gain type, the data type, the source, the load and the loop gain reference.
    The simulation type has been set to numeric, so all parameter values defined
    with the .param statement in the circuit file will be substituted into the element
    expressions.

 1 #!/usr/bin/env python3
 2 # -*- coding: utf-8 -*-
 3 # file: transimpedance.py
 4
 5 from SLiCAP import *
 6
 7 fileName = 'transimpedance'
 8 prj = initProject(fileName)
 9 i1 = instruction()
10 i1.setCircuit(fileName + '.cir')
11 htmlPage('Example controller GB product requirements')
12 i1.setSimType('numeric')
13 i1.setDataType('laplace')
14 i1.setSource('I1')
15 i1.setDetector('V_2')

       Lines 16-19 of the script evaluate the loop gain. The function coeffsTransfer

    in line 21 returns the coefficients of the numerator and the denominator of its

    argument: a Laplace rational function. From these coefficients we will calculate

    the loop gain-poles product. This script is intended to work with an all-pole
    loop gain that has a finite nonzero DC value. Hence, the coefficient of s0 in the

    denominator should not be zero and the numerator should only have a nonzero
    coefficient for s0. This is checked in line 21-27. Line 29-31 print DC loop gain on

    the html page. The loop gain-poles product is calculated in line 35, and displayed

    on the html page (line 37 -40):

16
17 i1.setLGref('E1')
18 i1.setGainType('loopgain')
19 result = i1.execute()
20 #
21 gain, numerCoeffs, denomCoeffs = coeffsTransfer(result.laplace)
22 if len(numerCoeffs) > 1:
23 text2html('Zeros found, GB determination method not valid.')
24 else:
25 text2html('Found the nonzero DC loop gain.')
26 if denomCoeffs[0] == 0:
27 text2html('Found poles in the origin, GB determination method not valid.')
28 #
29 LP = sp.symbols('LP')
30 text2html('The DC loop gain equals:')
31 eqn2html('L_DC', gain)
32
33 if len(denomCoeffs) == 1:
34 text2html('No poles found, GB determination method not valid.')
35 LPproduct = -gain/denomCoeffs[-1]
36
37 text2html('The loop gain-poles product is found as:')
38 eqn2html(LP, LPproduct)
39 order = len(denomCoeffs) - 1
40 text2html('The order of the LP product is: ' + str(order))

   This LP product is evaluated as the ratio of the coefficient of s0 of the numerator     5 All poles are assumed dominant.
and the highest order coefficient of s of the denominator. The order of the loop gain
is found as the number of coefficients of the denominator minus one.5

   With the expression for the LP product and the requirement for the bandwidth,
we are able to derive requirements for the unknown variables.

   We will now calculate a show-stopper value for the gain-bandwidth product
GB of the operational amplifier. The lowest possible gain-bandwidth product is
found if all other contributions to the bandwidth limitation of the amplifier are set
362 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                                    to zero. This is the case if Ro = 0, Cd = 0, and Cc = 0.

                                                               42 B_f = 500e3
                                                               43 R_o, C_d, C_c, G_B, GB_min, A_0 = sp.symbols('R_o, C_d, C_c, G_B, GB_min, A_0'

                                                                                          )

                                                               44
                                                               45 GB_minAll = sp.solve(LPproduct -(B_f*2*sp.pi)**order, G_B)[0]
                                                               46 text2html('The required bandwidth = ' + str(B_f/1000) + 'kHz')
                                                               47 text2html('With this value, the show stopper value of the gain-bandwidth

                                                                                          product $G_B$ is:')

                                                               48 GB_minNum = GB_minAll.subs([(R_o, 0), (C_d, 0), (C_c, 0)])
                                                               49 eqn2html('GB_min', GB_minNum/1e6, units="MHz")

                                                          This minimum requirement for the GB product is calculated in lines 42-49 of
                                                      the script. It consists of two parts. In line 45 we find a symbolic expression for GB
                                                      as a function of the other parameters of the operational amplifier and the required
                                                      bandwidth from solving:

                                                                                                                                              n

                                                                                     LPn - 2Bf = 0.

                                                        In line 48 we subsitute Ro = 0, Cd = 0, and Cc = 0 in this expression. This
                                                      yields the lower limit GBmin of GB.

                                                          Figure 11.6 shows the html page generated by this script.

Figure 11.6: Result of the execution of the     We will now select an operational amplifier based on the results of the
SLiCAP script.                               previous example. Operational amplifiers with zero input capacitance are
                                             not available, so we need to select one with a larger GB product than the
                                             show-stopper value. As far as its dynamic performance is concerned, the
                                             OPA627 looks promising. It has a differential-mode input capacitance of 8pF,
                                             a common-mode input capacitance of 7pF, an output resistance of about 55
                                             and a gain-bandwidth product of 16MHz. Its magnitude and phase plot
                                             show a somewhat more complicated behavior than a simple first-order roll-
                                             off, but we will ignore this because the extra phase shift above 10MHz may
                                             not be at all relevant if the servo bandwidth turns out to be much less.

                                                In the next example, we will verify the design with the OPA627 device with
                                             SLiCAP.

                                                Example 11.3

                                                    The script for the device selection and the verification are listed below. Lines 51-
                                                63 perform the substitution of the parameters of the OPA627, and the calculation
                                                of the bandwidth that can be achieved with this device. The results are displayed
                                                on the html page; see Figure 11.7.
11.4. BANDWIDTH DESIGN CONSIDERATIONS 363

51 htmlPage('Device selection and verification')
52 i1.defPar('A_0', '1M')
53 i1.defPar('C_d', '8p')
54 i1.defPar('C_c', '7p')
55 i1.defPar('R_o', 55)
56 i1.defPar('G_B', '16M')
57 i1.defPar('I_s', 1)
58 params2html(i1.circuit)
59
60 Bf = 1/(2*sp.pi)*LPproduct**(1/order)
61 BfOPA627 = sp.N(Bf.subs([(R_o, 55), (C_d, 8e-12), (C_c, 7e-12), (G_B,16e6), (

                A_0, 1e6)]), 4)

62 text2html('The achievable low-pass cut-off frequency $f_h$ with the OPA627 in

                [MHz] is:')

63 eqn2html('f_h', BfOPA627*1e-6)

       Lines 64-77 create the Bode plots for all transfer functions of the asymptotic

    gain model. These plots are shown in Figure 11.8.

                                                                                         Figure 11.7: Result of the execution of the
                                                                                         SLiCAP script.

60 htmlPage('Bode plots')
61 L = i1.execute()
62 i1.setGainType('asymptotic')
63 A = i1.execute()
64 i1.setGainType('servo')
65 S = i1.execute()
66 i1.setGainType('direct')
67 D = i1.execute()
68 i1.setGainType('gain')
69 G = i1.execute()
70 figMag = plotSweep('TrimpMag', 'Magnitude characteristics', [L, A, S, D, G],

                10e3, 10e6, 200, funcType = 'mag', show = True)

71 fig2html(figMag, 800)
72 figPhase = plotSweep('TrimpPhase', 'Phase characteristics', [L, A, S, D, G],

                10e3, 10e6, 200, funcType = 'phase', show = True)

73 fig2html(figPhase, 800)

       The plots clearly show the low-pass cut-off at the predicted frequency. However,
    the magnitude characteristic of the gain shows significant peaking and is far from
    maximally flat. This was not yet our aim. Before we corcern ourselves about
    the frequency stability and the filter type of the response, we need to establish a
    sufficiently large bandwidth!

   In the previous examples, we have demonstrated the way in which the gain
bandwidth requirements for the controller can be derived from the specifi-
cation of the transimpedance amplifier. Initial target values can be derived
with SLiCAP, and after a device has been selected, the performance can be
verified. In this case, this has been done with the aid of Bode plots.

   The next step in the design of the amplifier is the design of the frequency
stability and the filter response type. These topics will be discussed in Chap-
ter 12. However, before dealing with these topics, we need to study the way
364 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS
                                                  in which the above results can be applied if we do not have all-pole loop gain
                                                functions, or if we have poles at s = 0, which would yield an infinite DC loop
                                                  gain.

Figure 11.8: Result of the execution of the
SLiCAP script.

                                                      In section 11.4.4, we will study the high-pass cut-off that arises if we have
                                                  DC blocking elements in the loop of a feedback amplifier. In section 11.4.5, we
                                                  will formulate the general case for relating the low-pass cut-off of the servo
                                                  function to the loop gain with poles and zeros. In section 11.4.6, we will
                                                  do this for the high-pass cut-off. In section 11.4.7, we combine the methods
                                                  found in sections 11.4.5 and 11.4.6 and derive a clear procedure for relating
                                                  the low-pass and the high-pass cut-off of the servo function to the properties
                                                  of the loop gain function. The algorithm developed in this section has been
                                                  implemented in SLiCAP.

                                        11.4.4 High-pass cut-off and DC loop gain

                                                  In the previous section, we studied the relation between the low-pass cut-off
                                                  frequency of a negative feedback amplifier and the DC value and the poles of
                                                  the loop gain. We have seen that, due to a lack of loop gain at high frequen-
                                                  cies, the servo function drops below unity. This causes a low-pass behavior
                                                  with respect to the desired ideal gain of the amplifier. In this section, we will
                                                                              11.4. BANDWIDTH DESIGN CONSIDERATIONS 365

study the influence of a lack of loop gain below certain frequencies. Such
effects may be caused by capacitive branches in series with the signal path
or inductive branches in parallel with the signal path in the loop equivalent
circuit. If the loop gain drops below unity for decreasing frequencies, the
servo function obtains a high-pass character.

DC blocking elements in the loop

DC blocking elements in the loop cause a loss of loop gain at low frequencies.
DC blocking elements are capacitors in series with the signal path or induc-
tors in parallel with the signal path, they introduce zeros at zero frequency in
the loop gain. In order to study their effect, we assume a loop gain function
with q DC blocking elements in the loop and no other dynamic elements. In
such cases the loop transfer can be written as:

               bq sq                           (11.40)
L(s) = q

           1 - psi

            i=1

   The factor bq can be written as the product of a DC term which is the

product of the DC gain ADC provided by the controller, a DC attenuation
factor DC due to resistive networks in the loop transfer, and a product of q
time constants introduced by the q DC blocking elements in the loop:

                          q                    (11.41)

bq = ADCDC  i

                       i=1

   As stated earlier, all other elements that introduce low-pass transfer (speed
limitations) have been ignored.

                                                                                  Figure 11.9: High-pass character of the
                                                                                  servo function due to 3 DC blocking
                                                                                  elements in the loop transfer circuit.

frequency [rad/s] logarithmic scale            magnitude logarithmic scale

   The loop gain now has q zeros in the origin and q poles. The order of
the high-pass cut-off equals the number of zeros minus the number of poles
below the frequency of intersection of the asymptote of the magnitude char-
acteristic of the loop gain and unity. If the frequency of the pole is in a
frequency range where the loop gain is smaller than unity, it reduces this or-
der. We will call such a pole dominant because it affects the high-pass cut-off.
This is illustrated in Figure 11.9.

   With r dominant poles, the loop gain at the frequency of intersection ap-
poximates:

L(s) = r                          bq sq     .  (11.42)

                                   1 - psi

                                  i=1
366 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                              In the vicinity of the frequency of intersection, this can be approximated

                                              by its asymptote:

                                                                                                       r                        (11.43)

                                                                             L(s) = bqsq-r  -pi.

                                                                                        i=1

                                              The servo function is then obtained as

                                                                                            r
                                                                                 -bqsq-r  -pi
                                                                                        r i=1 .
                                                                     S(s) =      1 - (-1)r bqsq-r  pi                           (11.44)

                                                                                               i=1

                                              This function has the structure of a unity-gain high-pass filter of order

                                              q - r. If all poles are in MFM positions, it has a -3dB cut-off frequency min

                                              that can be found as:

                                                                             min = q-r      1.                                  (11.45)

                                                                                              r

                                                                                        bq  pi

                                                                                            i=1

                                                 If we substitute (11.41) in this equation, we see that the low-frequency cut-
                                              off can be brought to an arbitrarily low value by increasing the DC gain of
                                              the controller:

                                                                 min = q-r                1                r.                   (11.46)
                                                                                                           pi
                                                                                 ADCDC   q
                                                                                                          i=1
                                                                                         i

                                                                                        i=1

                                              Design conclusion
                                              From (11.46), we may conclude:

                                                 A high-pass cut-off frequency min of the servo function, caused by DC block-
                                              ing elements in the loop transfer, can be kept below its specified value if the

                                              controller provides a sufficiently large DC gain.

                                                 The design of the high-pass cut-off frequency, will be elucidated in the
                                              example below.

                                                 Example 11.4

                                                     In this example, we will design the high-pass cut-off frequency of a current
                                                 integrator. Integration of electrical current is often required in charge detection or
                                                 charge control amplifiers. In this example, we will only focus on one performance
                                                 aspect: high-pass cut-off due to a lack of loop gain at low frequencies.

Figure 11.10: Charge amplifier:                                          C1                                            C1

     A: The amplifier concept for a

grounded resistive current source and a

grounded resistive load                                              N1                                       (1)          (2)

     B: The amplifier in which the ideal                                         +                                 -+ +

controller has been replaced with a voltage-  I1  R1                         R2         I1                R1       E1      R2

controlled voltage source with DC gain                                           -                                 +-           -

A0.                                           A                                         B

                                                 High-pass behavior results in droop or tilt in the step response (see section
                                              2.4.6). Such droop or tilt may pose requirements to the high-pass cut-off frequency
                                              of charge amplifiers.

                                                 Figure 11.10A shows the concept of the charge amplifier under study. It con-
                                              verts the charge of a grounded source into a voltage for a grounded load. The
                                                     11.4. BANDWIDTH DESIGN CONSIDERATIONS 367

source is resistive and has a source resistance Rs. The load is also resistive and
has a resistance R. Figure 11.10B shows the circuit in which the ideal controller
(a nullor) has been replaced with a voltage-controlled voltage source with a DC
gain A0. Since we are only studying the high-pass cut-off, low-pass behavior of
the controller has not been modeled.

   We will assume the following requirements for the charge amplifier:

1. The peak value of the charge delivered by the source is 10pC. This peak charge
   should evoke a peak load voltage of 2V.
   From this, we can calculate the value of the integration capacitance: Ci = 5pF.

2. The source resistance is 50k and the load resistance is 2k.

3. The high-pass cut-off frequency f of this circuit should be below 1kHz.

       Below the SLiCAP netlist of the circuit from Figure 11.10B.

 1 simpleQamp
 2 * file: simpleQamp.cir
 3 * SLiCAP circuit file
 4 I1 0 1 {I_s}
 5 R1 1 0 {R_s}
 6 C1 1 2 {C_i}
 7 R2 2 0 {R_ell}
 8 E1 2 0 0 1 {A_0}
 9 .param C_i=5p R_s=50k R_ell=2k
10 .end

       The design task that we will try to fulfill in this example is: find a minimum
    value for the DC gain of the controller to meet the requirement for f.

       A simple and straightforward way to do this is to calculate the servo function.
    This function describes the behavior of the transfer with respect to the ideal behav-
    ior. The script below (lines 1 to 20) prints the expression for the servo function
    with A0 as variable to the output html page.

 1 #!/usr/bin/env python3
 2 # -*- coding: utf-8 -*-
 3 # file: simpleQamp.py
 4
 5 from SLiCAP import *
 6
 7 fileName = 'simpleQamp'
 8 prj = initProject(fileName)
 9 i1 = instruction()
10 i1.setCircuit(fileName + '.cir')
11 htmlPage('High-pass cut-off design')
12 i1.setSource('I1')
13 i1.setDetector('V_2')
14 i1.setLGref('E1')
15 i1.setSimType('numeric')
16 i1.setGainType('servo')
17 i1.setDataType('laplace')
18 result = i1.execute()
19 exprGain = result.laplace
20 eqn2html('S', exprGain);

   The next part of the script (lines 22-30), calculates the minimum requirement

for A0. This script only works if there are no low-pass effects modeled! It calcu-
lates the high-pass cut-off frequency min from the first coefficient a0 and the last
coefficient aq of the denominator polynomial of the servo function:

                min q = a0 aq .                                     (11.47)

It then solves  min q - (2 f)q = 0.

                                                                    (11.48)

The output of this script is shown in Figure 11.11.
368 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

Figure 11.11: Result of the execution of the
SLiCAP script.

21 gain, numerCoeffs, denomCoeffs = coeffsTransfer(exprGain)

22 order     = len(denomCoeffs) - 1

23 omegaLow  = denomCoeffs[0]/denomCoeffs[-1]

24 f_l       = 1e3

25 A0min     = sp.solve(omegaLow - (2*sp.pi*f_l)**(1/order))[0]

26 A_min = sp.Symbol('A_min')

27 text2html('In order to meet the requirement for $f_{\\ell}$ we need a minimum

        value $A_{\\min}$ for the DC gain $A_0$ of the controller:');

28 eqn2html(A_min, A0min);

29 i1.defPar('A_0', A0min);

       The Bode plots are shown in Figure 11.12. They are generated in lines 32-46.

30 L = i1.execute()
31 i1.setGainType('asymptotic')
32 A = i1.execute()
33 i1.setGainType('direct')
34 D = i1.execute()
35 i1.setGainType('gain')
36 G = i1.execute()
37 figMag = plotSweep('magQamp', 'Magnitude characteristics', [A, L, S, D, G],

                10, 10e6, 200, funcType='mag', show=True)

38 fig2html(figMag, 800)
39 figPhase = plotSweep('phaseQamp', 'Magnitude characteristics', [A, L, S, D, G

                ], 10, 10e6, 200, funcType='phase', show=True)

40 fig2html(figPhase, 800);

   The plots of the asymptotic gain clearly show the integrating character of the
   charge amplifier. The plots of the loop gain show a lack of loop gain at low fre-
   quencies. This is due to the high-pass filter in the loop formed by the integration
   capacitor and the source resistance. The gain of the integrator closely matches the
   asymptotic gain at frequencies above 1kHz. The loop gain reaches its maximum of
   635.6 above the frequency of the pole caused by the integration capacitor and the
   source resistance.

   The analysis performed in the example above, requires all low-pass effects
not to have been modeled. This can be done by using different circuit mod-
els during the design of the high-pass transfer and of the low-pass transfer.
In amplifier design, such an approach is usually possible because the fre-
quency regions of high-pass and low-pass transfer are well separated. Only
when designing narrow-band active filters would this way of working not be
possible.
                                  11.4. BANDWIDTH DESIGN CONSIDERATIONS 369

                                                                      Figure 11.12: Result of the execution of the
                                                                      SLiCAP script.

11.4.5 Low-pass cut-off with poles and zeros

In section 11.4.3, we have studied the low-pass cut-off frequency of the servo

function for all-pole loop gain transfers with a finite DC loop gain. In this,

we will derive a general expression for the low-pass cut-off frequency h of
the servo function. To this end, we assume a loop gain with k poles at s = 0
and  zeros at s = 0, and a total number of poles and zeros of n and m,

respectively. The loop gain function can then be written as

m           1- s

bs j=+1            zj

L(s) = k n                     ,              (11.49)
aks  1 - s

                           pi
i=k+1

in which b and ak are the trailing coefficients of s of the numerator polyno-   6 The coefficients of the lowest order of the
mial and of the denominator polynomial of the loop gain, respectively.6         Laplace variable s.

   We obtain a low-pass character of the loop gain if the number of poles
exceeds the number of zeros, thus if n > m in expression 11.49. If so, the
magnitude characteristic has a falling slope at the highest frequencies and
370 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                                              the loop gain may be approximated by its asymptote as:                       (11.50)
                                                                                                                                           (11.51)
                                                                                                        L = n-m Cn-m ,
                                                              where the coefficient Cn-m can be written as

                                                                                                                                        n

                                                                                                      pi

                                                                                                  Cn-m = ak m b i=k+1 .

                                                                                                      zj

                                                                                                                                  j=+1

                                                              The low-pass cut-off of the servo function occurs at approximately unity loop
                                                              gain. Hence, with the aid of (11.50), we obtain:

                                                              n-m  Cn-m.                                                                   (11.52)

                                                                 With the aid of (11.51), we obtain the value of the low-pass cut-off fre-

                                                              quency h for a feedback circuit of which the loop gain has m dominant
                                                              zeros and n dominant poles, with n > m. Dominant poles and zeros are

                                                              those that have a frequency smaller than h, as discussed in section 11.4.3

input Laplace rational function:                              h  n-m          n                                                            (11.53)
  determine poles and zeros:
                                                                          pi

                                                                      ak m b i=k+1 .

                                                                          zj

                                                                          j=+1

determine corner frequencies and                              11.4.6 High-pass cut-off with poles and zeros
orders above corner frequencies:
- rising slope: negative order                                At low frequencies, zeros may cause the loop gain to drop below its midband
- falling slope: positive order                               value. In such cases the servo function obtains a high-pass character with a
                                                              high-pass cut-off at . This cut-off frequency can be found in a similar way
   Initialize 'false' return values:                          as the low-pass cut-off frequency h. We now only account for the p zeros
                                                              and the q poles with frequencies smaller than  and use the asymptotic
                                  Y                           approximation according to (11.50) with p > q. In this way we obtain:
                       N
                                                                              p
                                                                p-q                                                                        (11.54)
                                                                          pi

                                                                      ak q b i=k+1 .

                                                                          zj

                                                                          j=+1

                                                           Y  11.4.7 Procedure for determination of the servo band-
                                    N                                    width

                                                           Y  With the results of the theory from sections 11.4.5 and 11.4.6, we are able
                                    N                         to design a procedure for the determination of the bandwidth of the servo
                                                              function with an arbitrary number of poles and zeros. The outline of the
                             Y                                method is:
                                    N
                                                              1. From the rational expression of the loop gain, determine the ratio of the
                                  END                            trailing coefficients of the numerator polynomial and the denominator
                                                                 polynomial: bak .
Figure 11.13: Simplified flow chart for the
determination of the servo bandwidth from                     2. Determine the m zeros (the solutions of the numerator polynomial) and
the asymptotic magnitude characteristic of                       the n poles (the solutions of the denominator polynomial).
the loop gain.
                         11.4. BANDWIDTH DESIGN CONSIDERATIONS 371

3. Find the corner frequencies and the order of the loop gain function for
   frequencies above each corner. This can be done as follows:

(a) Calculate the m + n corner frequencies; these are the absolute values
   of the poles and the zeros.

(b) Assign order = +1 to a pole frequency and order = -1 to a zero
   frequency

(c) Rank the frequencies and their corresponding orders in ascending or-
   der of frequencies.

(d) Make a new list with unique frequencies i and corresponding orders
   oi. These orders are the sum of the orders of the original corner frequen-
   cies that had the same value. Hence, two poles with the same frequency
   result in one corner frequency with order +2. A pole-zero pair results
   in one corner frequency with order 0, etc.

(e) Replace the order of the corner frequencies with the order of the loop
   gain function. The order of the loop gain function above a corner fre-
   quency is the sum of the orders of all corner frequencies up to that
   corner frequency. Hence, if we first have a pole, then another pole and
   then a zero, we have the orders: 1, 2, 1.

4. Determine the coefficients Ci (see (11.51)) of the asymptotes for each cor-
   ner frequency. This is done as follows:

   (a) At the first corner frequency, we have C1 = bak . If the first corner fre-
       quency is not zero, we have to multiply this by the first corner frequency
       1.

   (b) At following corner frequencies i, we have Ci = Ci-1 × i(oi-oi-1).

5. Determine the cut-off frequencies  and h.
   To this end, we evaluate the intersection points  of the asymptotes of
   the loop gain function and unity for each corner frequency, starting at
   the lowest frequency and proceeding with increasing frequencies. These
   intersection points are obtained as

                 1       (11.55)

i = Cioi ,

in which oi is the order at the corner frequency i. This intersection point
can be a valid cut-off frequency if its value is larger than that of the cor-
responding corner frequency. It is assigned to the high-pass cut-off 
if the order at the corresponding corner frequency is negative and to the
low-pass cut-off frequency h if it is positive:

 = i if oi > 0  i > i;   (11.56)
h = i if oi < 0  i > i.  (11.57)

   Each time a new valid cut-off frequency is found, the old value will be
   overwritten, resulting in correct values of  and h of the servo function.

   This function has been implemented in SLiCAP.
   The function findServoBandwidth returns:

· The high-pass cut-off frequency  and the order at this cut-off frequency

· The low-pass cut-off frequency h of the servo function and the order at
   this frequency

· The maximum asymptotic value of the loop gain and the first frequency of
   occurrence.
372 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                        11.4.8 Design conclusions

                                                  In the preceding sections, we have studied the relationship between the achiev-
                                                  able bandwidth of the feedback amplifier and the gain and pole-zero pattern
                                                  of the loop gain function. We have seen that the gain and the pole-zero pat-
                                                  tern of the loop gain function is governed by the dynamic behavior of the
                                                  source, the load, the feedback network and the controller. At this stage, the
                                                  design of the controller has our interest, and we found that the controller
                                                  must contribute to the loop gain-poles product such that it provides a suf-
                                                  ficiently high low-pass cut-off. If the loop gain drops below unity at low
                                                  frequencies, the DC loop gain can be used to achieve a sufficiently low high-
                                                  pass cut-off.

                                                      In many cases, we are interested in a smooth step response and a smooth
                                                  magnitude and phase response of the amplifier. Such responses can be es-
                                                  tablished with all-pole transfers. Since zeros in the loop gain transfer appear
                                                  in the servo function, zeros should be avoided in the frequency range of in-
                                                  terest. Hence, in many situations, the controller should contribute an all-pole
                                                  characteristic to the loop gain. Zeros in the loop gain arise from inevitable
                                                  influences of the source, the load and the feedback networks.

7 In the late 1870s Maxwell remarked (in a      11.5 Stability of negative feedback amplifiers
published paper) that determining stability
from the coefficients of the characteristic     In the previous sections, we studied the design of the low-pass and high-
polynomial (without factoring) was, unfor-      pass cut-off frequencies of the servo function. We have not yet investigated
tunately, apparently an insoluble problem.      whether the feedback amplifier is stable. A system is called stable if all sys-
After reading this, Routh worked diligently     tem poles have a negative real part. If there are single poles with a real part
for three years to develop the Routh test.      equal to zero, the system is called marginally stable. Since it is our intention
He presented it with the opening remarks,       is to build stable amplifiers (not oscillators), the ideal transfer of an amplifier
"It has recently come to my attention that      will have all its poles in the left half plane. With the loop gain reference se-
my good friend James Clerck Maxwell has         lected properly, the stability with respect to the ideal gain is thus governed by
difficulty with a rather trivial problem. ..."  the servo function. Hence, in order to investigate the stability of a feedback
                                                amplifier, we need to investigate whether the servo function has all its poles
8 John G. Truxal. Introductory System           in the left half plane.
Engineering. McGraw-Hill, Tokyo, 1972
                                                   There are several ways to do this, and they will be discussed briefly in the
9 Richard C. Dorf and Robert H. Bishop.         following sections. For further study on these topics, the reader is referred to
Modern Control Systems. Addison-Wesley          control theory, for which references will be given.
Publishing Company, Inc., USA, 1995.
ISBN: 0-201-84559-8                             1. Routh-Hurwitz criterion
10 H. Nyquist. Regeneration theory. Bell
System Technical Journal, 11:126-147, 1932         The quote7 taken from Truxal [Truxal1972]8 introduces the Routh test,
                                                   which will be presented in section 11.5.1. The Routh test states that the
11 Assuming that the loop gain itself has no       number of solutions of a polynomial with a positive real part equals the
poles in the right half plane.                     number of sign changes in the first column of the Routh array. A brief and
                                                   clear description of the method is also given by Dorf [Dorf1995]9.
12 The encirclement of the point -1 is based
upon the application of Black's feedback        2. Nyquist criterion
model. With the asympotic-gain model, it               The Nyquist [Nyquist1932]10 criterion states that the number of poles
is +1 in the polar plot of the loop gain.
13 Walter R." "Evans. Graphical Analysis of        in the right half plane of a feedback system is equal to the number of
Control Systems. Trans. AIEE, 67(1):547-           clockwise encirclements around the point -1 in the polar plot of the loop
551, January 1948                                  gain. 11 This criterion can also be used for systems that incorporate delay
                                                   lines. The Nyquist theorem will be discussed in section 11.5.2. For a
                                                   detailed treatment of this criterion, the reader is referred to literature on
                                                   control theory.12

                                                3. Root locus analysis
                                                       The root locus technique was introduced by Evans [Evans1948]13. It is

                                                   a graphical method for finding the poles of the servo functions based on
                                                   the poles and the zeros of the loop transfer function. It will briefly be
                                                   discussed in section 11.5.3.
                                                                 11.5. STABILITY OF NEGATIVE FEEDBACK AMPLIFIERS 373

11.5.1 Routh-Hurwitz criterion

The Routh-Hurwitz stability criterion is a mathematical test that is a neces-
sary and sufficient condition for the stability of a linear time-invariant system.
The Routh test was proposed in 1876 by the English mathematician Edward
John Routh. The German mathematician Adolf Hurwitz independently pro-
posed an equivalent procedure in 1895, but the Routh test is more efficient.

   The Routh test takes the coefficients of the characteristic polynomial of a
system as input to determine the Routh array. The number of sign changes
in the first column of the Routh array is equal to the number of solutions of
the characteristic polynomial that have a positive real part. The procedure is
extensively discussed in the references to control theory. In this section, we
will only briefly describe the procedure.

   The Routh test has been implemented in SLiCAP.

The procedure
The Routh array is determined as follows:

1. The polynomial D(s) under test is                                                             (11.58)
                      ansn + an-1sn-1 + an-2sn-2 + · · · + a1s + a0.

2. The coefficients of this polynomial are arranged in the first two rows of

the Routh array. The number of rows of this array equals n + 1, and the
                                            n                                        n+1
number  of  columns  is  m,  with  m  =     2  if  n  is  odd  and  m             =    2  if  n  is  even,

n being the order of the polynomial

            sn  an an-2 an-4 · · 
            sn-1  an-1
                                      an-3         an-5   ·    ·
                                                                   
                     ·       c3,1     c2,2            ·   ·    c3,m
                                                                     
                     ·       c4,1     c5,1            ·   ·    c4,m                              (11.59)
                                                                     .
                                         ·                           
                                                      · · ·
                     · ·

                                                                     
                     · ·                 ·            · · ·

            s0               cn,1 cn,1                · · cn,m

The remaining coefficients ci,j are obtained as follows:                                         (11.60)
                        ci,j = - 1 c det ci-2,j ci-2,j+1 . i-1,j ci-1,j ci-1,j+1

3. The number of solutions of the polynomial that have a positive real part                                 14 Richard C. Dorf and Robert H. Bishop.
                                                                                                            Modern Control Systems. Addison-Wesley
   equals the number of sign changes in the first column of the Routh array.                                Publishing Company, Inc., USA, 1995.
   There are two special cases; see Dorf [Dorf1995]14 for details:                                          ISBN: 0-201-84559-8

(a) If the entry in the first column of a row becomes 0 while other entries
   are nonzero, the first entry will be replaced with . This allows the array
   to be completed. After completion of the array, we let  approach zero
   to check for stability

(b) If a complete row of zeros is detected, the auxiliary polynomial of the
   above row is differentiated and its coefficients are used as entries. The
   auxiliary polynomial Pi of the i - th row is

                                       m                                                         (11.61)

                             P = R sn+3-i-2j.

                              i  i,j

                                     j=1

A row of zeros indicates instability or marginal instability.
374 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                                      In the following example, we will investigate the stability of the tran-
                                                  simpedance amplifier from example 11.3 with the aid of the Routh array.

                                                  Example 11.5

                                                               79 htmlPage('Routh array')
                                                               80 i1.setGainType('gain')
                                                               81 i1.setDataType('denom')
                                                               82 denomLaplace = i1.execute().denom
                                                               83 text2html('The characteristic equation of the gain is:')
                                                               84 eqn2html('charPoly', denomLaplace)
                                                               85 text2html('The Routh array of this poly is:')
                                                               86 eqn2html('RA', routh(denomLaplace))

                                                          The html page with the Routh array RA is shown in Figure 11.14. It shows
                                                      that the transimpedance amplifier is stable: all numbers in the first column of the
                                                      array are positive.

Figure 11.14: Result of the execution of the
SLiCAP-MATLAB script.

                                            Design application of the Routh array

                                            Because it can be evaluated symbolically, the Routh array can be used as a
                                            design tool.

15 H. Nyquist. Regeneration theory. Bell    11.5.2 Nyquist criterion
System Technical Journal, 11:126-147, 1932
                                            The Routh array provides a clear method for the determination of the stability
                                            of a feedback system, but it requires the transfer of a system to be written as
                                            a rational function of the Laplace variable s. This is not possible for systems
                                            that include delay elements. The Laplace transfer of a delay  is exp(-s),
                                            which cannot be written as a rational function. The Nyquist stability criterion
                                            (see: [Nyquist1932]15) is applicable for all types of loop gain functions. The
                                            Nyquist stability criterion states that

                                            n = p - q,  (11.62)

                                               if the loop gain -L(s) is plotted as a contour in the complex L plane:
                                            Re{-L(s)} versus Im{-L(s)}, with s = j varying along the contour from 0
                                            to j and from -j to 0, where:

                                            1. n is the number of clockwise encirclements of the point (-1, 0) in the
                                               complex L plane by the contour

                                            2. p is the number of poles of the servo function S(s) = 1-L(s) -L(s) inside the
                                               right half of the s plane

                                            3. q is the number of poles of the loop gain L(s) inside the right half of the s
                                               plane
              11.5. STABILITY OF NEGATIVE FEEDBACK AMPLIFIERS 375

   Please notice that we use -L throughout this section about the Nyquist
criterion. This is because the Nyquist criterion has been derived with Black's
feedback model. That model includes a -1 transfer in the loop that is not
included in the asymptotic gain model.

   In almost all cases, the loop gain itself will be a stable transfer and the
Nyquist stability criterion simplifies to n = p. Nyquist stability analysis
is a graphical technique. The contour plot is usually only constructed for
positive values of j. For negative values, the contour can be completed with
a complex conjugated curve. Respective examples of so-called Nyquist plots
for an unstable and a stable system are shown in Figure 11.15.

                                                                                    Figure 11.15: Examples of Nyquist plots:
                                                                                        A: Instable feedback system: clockwise

                                                                                    encirclement of (-1,0).
                                                                                        B: Stable feedback system: counterclock-

                                                                                    wise encirclement of (-1,0).

   -1     -1

A      B

Gain and phase margin

It is common practice to use the gain margin and the phase margin as mea-
sures for the margin in the loop gain function before instability of the servo
function occurs. Figure 11.16 illustrates the definition of these terms:

· The gain margin is the magnitude of 1 + L if the loop gain (-L) has a             gain
   phase shift of 180 degrees.                                                      margin

· The phase margin is the difference between 180 degrees and the phase                     -1
   shift of the loop gain at a frequency where the magnitude of the loop gain
   equals unity.

   However, single-frequency gain and phase margin descriptions do not                       phase
completely characterize the dynamic behavior of feedback systems. First of                   margin
all, such a description is incomplete for higher order systems. Secondly, we
are interested in the stability of the gain (source-to-load transfer) and the loop  Figure 11.16: Definition of the gain and the
gain only has a well defined relationship with the gain if the asymptotic gain      phase margin in the Nyquist plot.
equals the ideal gain.16                                                            16 At this point, it should be clear that a
                                                                                    system is stable if and only if all roots of
   In the following example, we will demonstrate the use of SLiCAP for              the charactersitic equation have a negative
making Nyquist plots.                                                               real part, and that the filter characteristic is
                                                                                    defined by the complete pole-zero pattern
   Example 11.6                                                                     of the source-to-load transfer.

       Lines 113 to 119 of the transimpedance.m script generate the Nyquist plot
    of the transimpedance amplifier and display it on the html page. This page is
    shown in Figure 11.17. The Nyquist plot in SLiCAP only works with data type
    LAPLACE and gain type LOOPGAIN. It shows a polar plot of -L.

88 htmlPage('Nyquist plot')
89 i1.setGainType('loopgain')
90 i1.setDataType('laplace')
91 result = i1.execute()
92 result.laplace = -result.laplace
93 figNyquist = plotSweep('Nyquist', 'Nyquist plot: polar plot of $-L$', result,

                1e6, 10e6, 100, axisType='polar', funcType='mag', show=True)

94 fig2html(figNyquist, 800)
376 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                                          Figure 11.17 clearly shows the very small phase margin of the uncompensated
                                                      transimpedance amplifier. This corresponds with the peaking in the magnitude
                                                      characteristic of the servo function, as shown in Figure 11.8.

Figure 11.17: SLiCAP simulation results.

17 Walter R." "Evans. Graphical Analysis of  11.5.3 Root locus analysis
Control Systems. Trans. AIEE, 67(1):547-
551, January 1948                            The root locus method is a graphical method for determining the poles of the
18 Walter R." "Evans. Control Systems        servo function. It was introduced by Evans in 1948 [Evans1948]17 [Evans1950]18
Synthesis by Root Locus Method. Trans.       and is also often used in control engineering practice. The root locus shows
AIEE, 69(1):66-69, January 1950              how the poles of a system move around in the complex plane as a parameter
                                             is varied. In negative feedback systems, the DC loop gain is used as a vari-
                                             able for the root locus. For electronic amplifiers, varying the DC loop gain
                                             might be interesting for analytical purposes, but we will see that it is not the
                                             best method for maneuvering poles into their desired positions. However, the
                                             root locus technique is very useful for finding the poles of the servo function
                                             from the poles and zeros of the loop gain and the DC value of the loop gain,
                                             and it can be helpful in understanding frequency compensation, which will
                                             be discussed in Chapter 12.

                                                In this section, we will briefly discuss the rules for drawing the root locus
                                             plots. For complete proofs of the rules, the reader is referred to literature on
                                             control theory.

                                                A general expression of a loop transfer function with poles and zero has
                                             been given in (11.49). The general expression for the servo function S(s) can
                                             thus be obtained as

                                                                            m  1- s

                                                               -bs                    z
                                                                         j=+1 j
                                             S(s) =                                              .  (11.63)
                                                            n                        m
                                                     aksk  1 - i=k+1 psi - bs  1 - j=+1 zsj

                                             The poles of the servo function are the solutions of the denominator:

                                                        n   1- s                 m       1- s ,     (11.64)
                                                               pi                        zj
                                             aksk                  - bs 

                                                     i=k+1                     j=+1
                                                            11.5. STABILITY OF NEGATIVE FEEDBACK AMPLIFIERS 377

which can be written as

                      n                  s         b  m              s
                 k
                 s  1- - s  1- .                                                          (11.65)
                                      pi           ak j=+1           zj
                    i=k+1

   If  = 0 and k = 0, the gain factor bak equals the DC loop gain LDC. From
(11.65), we can easily see that the poles of the servo function depend on:

1. The n poles pi of the loop gain

2. The m zeros zj of the loop gain

3. The gain factor bak , or the DC loop gain LDC if both  and k are zero.

   The root locus is the path in the complex plane as it is traced by the poles
when the gain factor bak is varied. The construction rules for the root loci are
given without proof:

1. The number of branches of the root locus is equal to the number of poles.

2. Poles are either real or complex conjugates. As a consequence, the root
   locus is symmetrical with respect to the real axis.

3. The root locus starts ( bak = 0) in the poles of L(s).

4. The root locus ends ( bak = ) on the zeros of L(s); if the number of zeros
   m is smaller than the number of poles n, n - m zeros are supposed to be
   at infinity.

5. Parts of the real axis left to an odd number of poles and zeros are part of
   the root locus.

6. If there are n poles and m zeros, n - m branches go to infinity, the angle
   with the positive real axis of the asymptotes of these branches is given by

                          i = 2i + 1 n - m , i = 0, 1, 2, ...                             (11.66)

7. These asymptotes intersect the real axis ( - axis) at:  =                     n   pk -im=1  zi  .
                                                                                     n-m
                                                                              k=1

8. If a branch of the real axis lies between two poles or two zeros, the point
   where the poles leave or arrive at the real axis are called the break away
   points. The value of s at these break away points follows from

                                            d L(s) = 0.                                   (11.67)
                                            ds

9. The tangents to the loci at the break away points are equally spaced over
                                            ±,                                ±,
2.  Two  poles   break    away        at           three  poles  at      and         four  poles             (1)         (2)
                                                2                                 3
                                  3                                                                             +              +
break  away  at  ±  4  ,  and  ±   4  ,  etc.                                                             +           +
                                                                                                               -              -
10. Each point of the root locus satisfies the condition:                                             V1           E1

                                                                                                          -           -

|L(s)| = 1 and arg (L(s)) = k2; k = 0, ±1, ±2, ...

   Below, we will show how to generate root-locus plots with SLiCAP.                                  Figure 11.18: Circuit for drawing root locus
   The circuit that we will use for drawing the root locus plots is shown in                          plots with SLiCAP.
Figure 11.18. It is a unity-gain voltage follower with a voltage-controlled
voltage source as the controller. This controlled source will be selected as
the loop gain reference, hence the loop gain equals the gain of the controller.
With each root locus plot, we will plot the poles and the zeros of the loop
378 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

Figure 11.19: SLiCAP root-locus plot.  gain and the poles of the servo function while stepping the DC loop gain or,
                                       if there are any poles or zeros in the origin, the gain factor bak .

                                          The SLiCAP netlist of the circuit from Figure 11.18 with a single-pole
                                       transfer is listed below. The transfer of the voltage-controlled voltage source
                                       E1 will be changed for the other root locus plots depicted in Figure 11.19 to
                                       11.26

                                          The script RL1_0.py plots the root locus of the single-pole circuit. Similar
                                       scripts have been used to generate the root locus plots from Figure 11.20 to
                                       11.26. Lines 1-19 of the scripts check the circuit and define the source, the
                                       load and the loop gain reference.

                                        1 RL1_0
                                        2 * file: RL1_0.cir
                                        3 V1 1 0 0
                                        4 E1 2 0 1 2 {A_0/(1-s/2/pi/p_1)}
                                        5 .param A_0=100 p_1=-10
                                        6 .end

Figure 11.20: SLiCAP root-locus plot.   1 #!/usr/bin/env python3
Figure 11.21: SLiCAP root-locus plot.   2 # -*- coding: utf-8 -*-
                                        3 """
                                        4 Created on Thu Mar 18 12:11:37 2021
                                        5
                                        6 @author: anton
                                        7 """
                                        8 from SLiCAP import *
                                        9
                                       10 fileName = 'RL1_0'
                                       11 #prj = initProject(fileName)
                                       12 i1 = instruction()
                                       13 i1.setCircuit(fileName + '.cir')
                                       14 htmlPage('Root locus plot: ', fileName)
                                       15 i1.setSource('V1')
                                       16 i1.setDetector('V_2')
                                       17 i1.setLGref('E1')
                                       18 i1.setSimType('numeric')
                                       19 i1.setGainType('loopgain')

                                          Lines 20 and 21 evaluate the poles and the zeros of the loop gain.

                                       20 i1.setDataType('pz')
                                       21 pzL = i1.execute()

                                          Lines 22 to 30 evaluate the poles of the servo function.

                                       22 i1.setGainType('servo')
                                       23 i1.setDataType('poles')
                                       24 i1.stepOn()
                                       25 i1.setStepVar('A_0')
                                       26 i1.setStepStart(1)
                                       27 i1.setStepStop(100)
                                       28 i1.setStepMethod('lin')
                                       29 i1.setStepNum(100)
                                       30 plsS = i1.execute()

                                          Lines 31 and 32 generate the root locus plot and place it on the html page.

                                       31 figPZ = plotPZ(fileName, fileName, [plsS, pzL], xscale='k', xmin=-2, xmax=0,

                                                       ymin=-1, ymax=1, show=True)

                                       32 fig2html(figPZ, 500)

                                          The root-locus plot generated by this script is shown in Figure 11.19. The
                                       loop gain of the circuit is:

                                       L(s) = s A0 ,                                                          (11.68)
                                                1 - 2p1

                                       with p1 = -10 Hz. The root-locus has one branch (rule 1), it starts at p1, (rule
                                       3) and it ends at - (rule 4). The part of the real axis, left from p1, belongs
                                                                    11.5. STABILITY OF NEGATIVE FEEDBACK AMPLIFIERS 379

to the root locus (rule 5), and there is one asymptote with an angle of 180

degrees (rule 6). The root-locus in Figure 11.19 is drawn for A0 = 0 · · · 100.

Figure 11.20 shows the root locus if a zero is located right from the pole:

z1 = -10Hz, p1 = -100Hz. The root locus starts on the pole and ends

on the zero, while the part of the real axis between the pole and the zero

belongs to the root locus (rule 5). The root-locus in Figure 11.20 is drawn for

A0 = 0 · · · 3.

Figure 11.21 shows the root locus if a zero is located left from the pole:

p1 = -10Hz, z1 = -100Hz.

The root locus starts on the pole and ends on the zero, while the part of

the real axis between the pole and the zero belongs to the root locus (rule 5).

The root-locus in Figure 11.21 is drawn for A0 = 0 · · · 100.

Figure 11.22 shows the root locus for a loop gain with two real negative

poles: p1 = -10Hz, p2 = -40Hz. The poles of the servo function move
                                                                    3
along  two  asymptotes            with   an     angle  of   2  and   2  towards  infinity(rule  6).

The asymptotes intersect with the real axis at -25Hz (rule 7) and the poles

leave the real axis at -25Hz (rule 8). The expression for the loop gain L(s)

with two poles is                                                                                    Figure 11.22: SLiCAP root-locus plot.
                                                                                                     Figure 11.23: SLiCAP root-locus plot.
                               L(s) =                    A0 .                    (11.69)
                                                1- s 1- s
                                                   2 p1           2 p2

The    derivative    d   L  (  s  )  is  obtained  as
                     ds

                 d L(s) = 2 2 -A0 (2s - 2 p1 - 2 p2) .                           (11.70)
                 ds
                                         42 p1 p2 1 - s             1- s
                                                            2 p1           2 p2

The    solution  of  d   L  (  s  )  =   0  is
                     ds

                                         s = p1 + p2 = -25Hz.                    (11.71)
                                     2          2

Figure 11.22 shows the root-locus from A0 = 0 · · · 100.

Figure 11.23 shows the root locus for a loop gain with two real negative

poles: p1 = -10Hz, p2 = -40Hz and one zero, left from the poles: z1 =
-100. One of the poles moves to the zero and the other to infinity along an

asymptote that has an angle of  with respect to the positive real axis. The

part of the real axis between the poles and the part of the real axis left from

the zero belongs to the root locus. The frequency at which the poles leave

and arrive at the real axis can be found according to rule 8. The loop gain

L(s) with two poles and one zero can be written as

                               A L(s) = 0 1 - 2sz1 .                             (11.72)
                                                1- s 1- s
                                                   2 p1           2 p2

The    derivative    d   L  (  s  )  is  obtained  as
                     ds

d   L(s) =  2A0 p1 p2 s2 - 4z1s - 42 p1 p2 + 42 p1z1 + 42 p2z1                   . (11.73)

ds                                       z1 (s - 2p1) (s - 2p2)2        2

The arrival points are found as the solutions of

                            s 2 - z1 s - p1 p2 + p1z1 + p2z1 = 0,                (11.74)
                         2               
                                                                                 (11.75)
from which we obtain                                                             (11.76)

                               s1,2 = z1 ± (p2 - z1) (p1 - z1),
                               2                       

                                     = -100 ± 10 55 Hz.
380 AMPLIFIER PERFORMANCE AND CONTROLLER REQUIREMENTS

                                                Hence, the poles leave the axis at -25.84Hz and arrive at -174.2Hz. It

                                             can be shown that when they leave the real axis, the poles move along a

                                             circular path around the zero. The center of that circle is z1 and the radius
                                                (p2 - z1) (p1 - z1).
                                                Figure 11.24 shows an example of a root locus of a third order system.

                                             This loop gain function L(s) of this system has one pole in the origin and

                                             two complex conjugated poles:

                                                              L(s) = s (20 × 1032 + 200s + s2 A0 ) .                                (11.77)

                                             Figure 11.24 shows the root locus with A0 stepping from zero to 2.5 × 108.

                                             According to rule 4, the poles move to infinity along three asymptotes. The
                                                                                                               ,         2
Figure 11.24: SLiCAP root-locus plot.        angles  of  the  asymptotes  with  the  positive    x  axis  are       and   3  (rule  6).  The
Figure 11.25: SLiCAP root-locus plot.                                                                          3
                                             pole in the origin moves along the x axis (rule 5). The asymptotes intersect

                                             the real axis at -33.33Hz (rule 7).

                                             Figure 11.25 shows the root locus of this system after one zero at -75Hz

                                             has been added to L(s):

                                                              L(s) =                 A0  1+ s                  2.                   (11.78)

                                                                                                150

                                                                                     32
                                                                          s (20 × 10  + 200s + s )

                                                The number of asymptotes now reduces to two, and the intersection point
                                             of the asymptotes and the real axis is found at -12.5Hz. The pole in the
                                             origin moves towards the zero.

                                                Figure 11.26 shows the root locus of this system after another real zero at
                                             -100Hz has been added to L(s):

                                                              L(s) =            A0   1+ s           1+ s                            (11.79)
                                                                                                         200 2 .
                                                                                            150

                                                                                     32
                                                                          s (20 × 10  + 200s + s )

                                                The number of asymptotes now reduces to one: two poles will end on the
                                             zero and another will move towards infinity. The part of the real axis between
                                             the two zeros does not belong to the root locus.

Figure 11.26: SLiCAP root-locus plot.        11.5.4 Non-observable and non-controllable states

19 The characteristic equation of a network  Unstable behavior cannot always be detected though determination of a time
is the determinant of the MNA matrix.        domain response. The only way to ensure detection of instability is to solve
20 Independent capacitor voltages and        the characteristic equation of a network.19 The solutions of this equation
independent inductor currents are the state  are the solutions of the homogeneous differential equation of the network
variables of electrical networks.            and yield all the poles of the network, including those associated with non-
                                             observable or non-controllable state variables.20

                                                Determination of instability with the aid of a time domain simulation does
                                             not disclose instability if, for the given excitations and responses, the state
                                             variables associated with poles in the right half plane are not controllable or
                                             not observable.

                                                We will elucidate the terms 'observable' and 'controllable' below.

+      R1                +                   Non-controllable state variable

input  1k                output                      A non-controllable state variable of a network is one that cannot be changed
                                                 by excitation(s) applied to the input(s) of a network.
-          R2        C1  -
                                                Consider, for example, the network from Figure 11.27. It shows a passive
           100 1u                            network with an input port and an output port. The output voltage of the
                                             network is the capacitor voltage, which is the only state variable of the net-
       R3                                    work. Although this voltage can be observed at the output port, it cannot be
       2k R4

                200

Figure 11.27: Passive two-port network
with a non controllable state.
                                                                 11.5. STABILITY OF NEGATIVE FEEDBACK AMPLIFIERS 381

controlled by a current or by a voltage applied to the input port. In other
words, the transfer from a current or voltage applied to the input port to the
voltage across the capacitor is zero. Hence, in this network, the state variable
is not controllable.

   If we determine the poles and the zeros of the transfer parameters of this
network, we would find one pole and one zero with equal frequencies. The
pole is associated with the independent capacitor voltage. Because it cannot
be controlled, it is canceled by a zero.

Non-observable state variable                                                        +         R1          +
                                                                                               1k
        A non-observable state variable of a network is one that cannot be observed  input         R2
    at the output(s) of the network.                                                        C1     100
                                                                                     -      1u
   Let us now consider the network from Figure 11.28. It shows a passive                                    output
network with an input port and an output port. There exists a nonzero trans-                   R3
fer from a voltage or from a current applied to the input port to the voltage                  2k  R4
across the capacitor. Hence, the voltage across the capacitor is controllable.
However, the transfer from the capacitor voltage to the voltage or current in                      200 -
the output is zero. So, in this network, the state variable is not observable
and called a non-observable state.                                                   Figure 11.28: Passive two-port network
                                                                                     with a non observable state.
   If we were to determine the poles and the zeros of the transfer parameters
of this network, we would find one pole and one zero with equal frequencies.
The pole is associated with the independent capacitor voltage. Because it
cannot be observed, it is canceled by a zero.

11.5.5 Design conclusions                                                            21 Rule 6 shows that asymptotes move into
                                                                                     the right half plane if the loop gain has
At this stage, the design of adequate high-pass and low-pass cut-off frequen-        more than two poles.
cies of negative feedback amplifiers had our interest. The DC gain of the
controller can be used as a design parameter for high-pass cut-off frequency,
while the gain-poles product can be used as a design parameter for the low-
pass cut-off frequency.

   The Nyquist stability analysis and the root locus technique show that neg-
ative feedback may yield unstable behavior. The root locus technique in par-
ticular indicates that feedback circuits with a loop gain with more than two
poles may become unstable.21 It also shows that the number of asymptotes
can be decreased by inserting zeros into the loop. This changes the coeffi-
cients of the denominator of the servo function. The Routh array method
could be used to investigate the conditions under which stability is achieved.
In Chapter 12, we will discuss frequency compensation techniques that can
be applied to achieve the desired frequency response of the amplifier with-
out affecting the high-pass and low-pass cut-off frequencies that have been
designed at this stage.
                                                              383

12 Frequency compensation

12.1 Introduction                                        385

12.1.1 Filter design approach                            386

12.1.2 Compensation techniques                           388

12.1.3 Compensation strategies                           389

12.1.4 This chapter                                      389

12.2 Phantom zero compensation                           390

12.2.1 The phantom zero concept                          390

12.2.2 Second order compensation                         391

12.2.3 Third order compensation                          397

12.2.4 Implementation of phantom zeros                   405

12.2.5 Phantom zeros in the feedback network             406

12.2.6 Phantom zeros at source and load                  412

12.2.7 Active phantom zeros                              420

12.2.8 Interaction with other performance aspects        421

12.2.9 Bandwidth limitation with phantom zeros           422

12.3 Pole-splitting                                      424

12.3.1 Pole-splitting in operational amplifier circuits  425

12.3.2 Miller effect                                     426

12.3.3 Interaction with other performance aspects        427

12.4 Pole-zero canceling                                 427

12.4.1 Insertion of impedances into the signal path      428

12.4.2 Interaction with other performance aspects        431

12.5 Resistive broadbanding                              432

12.5.1 Insertion of resistors into the signal path       432

12.5.2 Interaction with other performance aspects        432

12.6 Phase margin design                                 432

12.6.1 Lag and lead compensators                         433

12.6.2 Interaction with other performance aspects        437

12.7 Reduction of the servo bandwidth                    437

12.7.1 Excessive pole-splitting                          437

12.7.2 Pole frequency reduction                          437

12.7.3 DC loop gain reduction                            438
384 FREQUENCY COMPENSATION

                            12.7.4 Interaction with other performance aspects          438

12.8 Feedback biasing frequency compensation                                           438

                            12.8.1 Negative feedback biasing concepts                  438

                            12.8.2 Dynamic behavior with feedback biasing              439

12.9 Nested control                                                                    443

                            12.9.1 PID controllers with local feedback amplifiers      443

                            12.9.2 Increasing bandwidth without adding dominant poles  446

                            12.9.3 Interaction with other performance aspects          446

12.10 Compensation for open and shorted ports                                          447

                            12.10.1 Compensation of shorted ports                      447

                            12.10.2 Compensation of open ports                         448

12.11 Influence of non dominant poles                                                  448

                            12.11.1 Bandwidth limitation with phantom zeros            448
                                                                                    12.1. INTRODUCTION 385

12.1 Introduction

In the previous chapter, we discussed the design of the bandwidth of a neg-
ative feedback amplifier. We have studied effects that contribute to high-pass
cut-off and effects that contribute to low-pass cut-off. We have seen that speed
limitations cause low-pass cut-off. Low-pass cut-off should occur above the
frequency range of interest, and we found design criteria to achieve this. We
have also seen that DC blocking elements in the loop or, more generally, the
use of AC coupling techniques may result in high-pass cut-off. High-pass
cut-off should occur below the frequency range of interest, and we have also
found ways to achieve this.

   However, until now, the actual character of the roll-off behavior has not
yet been studied. We have found ways to determine the stability of the am-
plifier, but we have not yet defined the means to achieve stable behavior,
nor have we studied ways to design a specific roll-off character. This will be
the subject of this chapter. In order to deal with this topic in a structured
way, we will assume that the high-frequency cut-off and the low-frequency
cut-off can be designed independently. In other words, the pole-zero pat-
tern that determines the high-pass behavior can be designed independently
from the pole-zero pattern that determines the low-pass behavior, and vice
versa. Since in this book, we confine ourselves to the design of wide-band
amplifiers, this will be the case.

   In practice, this means that capacitors and inductors that play a role in the
low-frequency cut-off can be considered as short circuits and open circuits at
high-frequency cut-off, respectively. Similarly, capacitors and inductors that
determine the high-frequency roll-off can be considered as open circuits and
short circuits during the low-frequency roll-off, respectively.

   The design of the desired cut-off characteristic is usually referred to as fre-
quency compensation. The use of this term implies that after we have designed
the bandwidth, the pole zero pattern of the transfer is usually not as desired
and should somehow be corrected. This is usually the case, and frequency
compensation is a collective term for application of such corrections:

    Frequency compensation comprises a collection of techniques that can be used
    to correct pole-zero patterns in such a way as to obtain a desired frequency
    response or time response.

   Frequency compensation techniques can be applied to obtain different
types of responses. Examples of such responses are:

· Maximally flat magnitude (MFM) response

· No overshoot in step response

· Maximally flat group delay

   In this chapter, we will focus on establishing an MFM response, but the
techniques discussed can also be applied for obtaining other types of re-
sponses. Only the extent to which such techniques will be or can be ap-
plied, as well as the related design equations, will differ for other types of
responses.

   We will first study frequency compensation techniques that do not affect
the designed bandwidth. This ensures that the design of the frequency re-
sponse of a negative feedback amplifier can be performed in two subsequent
steps:

1. The design of an adequate bandwidth

2. The design of a desired pole-zero patterns
386 FREQUENCY COMPENSATION

                                                      Only in cases in which the amplifier's bandwidth exceeds the required
                                                  bandwidth may frequency compensation result in bandwidth reduction. How-
                                                  ever, in order to obtain the largest possible performance-to-cost ratio, we will
                                                  show that a limitation of the bandwidth of the ideal gain and maximization
                                                  of the bandwidth of the servo function is the best strategy in such cases.

                                                      Frequency compensation should also not result in an unacceptable degra-
                                                  dation of other performance aspects, such as, among others

                                                  · Signal-to-noise ratio

                                                  · Distortion and overdrive recovery

                                                  · Accuracy

                                              12.1.1 Filter design approach

                                              Before we will discuss frequency compensation techniques, we will formulate

                                              the goal of frequency compensation in a mathematical way. This facilitates

                                              the development of strategies and procedures for frequency compensation.
                                                 In the previous chapters, we have seen that the source-load transfer A f (s)

                                              of a negative feedback amplifier can be approximated by the product of its
                                              ideal transfer Ai(s) and the servo function 1-L(s) -L(s) :

                                                                A f (s) = Ai(s) -L(s) 1 - L(s) .                           (12.1)

1 In that case, the asymptotic gain equals       This is the case if the loop gain reference variable has been selected such
the ideal gain and the loop gain is a mea-    that the controller becomes a nullor for |L|   and the influence of the
sure for the difference between the ideal     direct transfer  is negligible.1 From now on, we will assume this to be the
gain and the gain.
                                              case.
2 See example 7.11.4: the design of a cur-
rent integrator.                              Low-pass cut-off

3 At a later stage, we will see that poles    We will assume that the desired filter characteristic of the amplifier has been
with a frequency above h can also be          designed in the ideal transfer Ai(s).2 The bandwidth over which the source-
dominant. A proper definition of a domi-      load transfer A f (s) approaches the ideal transfer is determined by the band-
nant pole is "a pole that contributes to the  width of the servo function. During the design of the low-pass cut-off we
bandwidth".
                                              will assume that there exists a midband frequency range where the loop gain

                                              equals LMB, with |LMB|  1, at higher frequencies, but below the low-pass
                                              cut-off frequency h, the loop gain has n dominant poles and no zeros.3 For
                                              studying the low-pass cut-off the loop gain may then be written as an n - th

                                              order all-pole low-pass filter :

                                                                L(s) = n LMB .                                             (12.2)

                                                                        1 - psi

                                                                            i=1

                                                 Figure 12.1 shows two asymptotes of the magnitude characteristic of the
                                              loop gain, as well as the asymptotes of the magnitude characteristic of the
                                              servo function for this situation. The two asymptotes of the loop gain are:

                                              1. The asymptote at midband frequencies

                                              2. The asymptote at the low-pass cut-off frequency h

                                              With the aid of (11.15), A f (s) can be written as:                          (12.3)
                                                             A f (s) = Ai(s) 1 - LMB 1 + a1s + a2s2 + · · · ansn -LMB 1 ,
              magnitude (log scale)                                            (log scale)                                        12.1. INTRODUCTION 387

                                                                                                                           Figure 12.1: Asymptotes of the magnitude
                                                                                                                           characteristics of the loop gain and the
                                                                                                                           servo function for a loop gain with a
                                                                                                                           midband value of LMB and n dominant
                                                                                                                           poles above midband frequencies.

where                                                 n 1 .

                                                an =  (1 - LMB) i=1 pi                                             (12.4)

In case of an MFM characteristic , the low-pass cut-off frequency h can be

obtained as:                                          h = |an|- n1 .

                                                                                                                   (12.5)

   The goal of high-frequency compensation is to give the coefficients a1 · · · an-1
the values that correspond to those of an n - th order low-pass filter with the

desired characteristic and with a cut-off frequency close to h.

High-pass cut-off                                                                           magnitude (log scale)          Figure 12.2: Asymptotes of the magnitude
                                                                                                                           characteristics of the loop gain and the
                                   (log scale)                                                                             servo function for a loop gain with a
                                                                                                                           midband value of LMB and n dominant
                                                                                                                           poles below midband frequencies.

   Figure 12.2 illustrates a high-pass cut-off. For this type of transfer, we will                                         4 At a later stage, we will see that poles
                                                                                                                           with a frequency below  can also be
assume that a midband frequency range can be defined where the value of                                                    dominant. Again, a proper definition of a
the loop gain equals LMB, with |LMB|  1 , at lower frequencies, but above                                                  dominant pole is "a pole that contributes to
the high-pass cut-off frequency , the loop gain has k dominant poles pj,                                                   the bandwidth".
where k equals the number of zeros below .4 For studying high-pass cut-
off the loop gain may then be approximated by a k - th order high-pass filter

and may be written as

                                                                        k                                          (12.6)

                                                             - psj

                                                L(s) = LMB j=1 .

                                                                      k

                                                            1 - psj

                                                                    j=1

The source-load transfer A f (s) can then be written in the form

              A f (s) = Ai(s) -LMB                                             bksk ,2      k                      (12.7)
                                                1 - LMB 1 + b1s + b2s + · · · bks                                  (12.8)

where                                                 bk = k 1 - LMB . j=1 pj
388 FREQUENCY COMPENSATION

                            In case of an MFM characteristic , the high-pass cut-off frequency  can

be obtained as                                                            -1

                                                            = |bk| k .                    (12.9)

   The goal of low-frequency compensation is to give the coefficients b1 · · · bk-1
the values that correspond to those of an k - th order high-pass filter with

the desired characteristic and with a cut-off frequency close to .

Design conclusion
We may draw the following conclusions:

· If, below certain frequencies, the loop gain drops below unity, the servo
   function will obtain a high-pass character.

· If, above certain frequencies, the loop gain drops below unity, the servo
   function will obtain a low-pass character.

· If both situations occur, the servo function will have a band-pass character.
   If the low-pass cut-off and high-pass cut-off are well separated, the source-
   load transfer can be written as a product of four terms:

                            A f (s) = Ai(s)   -LMB                   bk sk                          1
                            in which:        1 - LMB    1 + b1s + b2s2 + · · · bksk  1 + a1s + a2s2 + · · · ansn ,

                                                                                                             (12.10)

                            - Ai(s) is the ideal transfer, which has been designed using nullors as

                            controllers.

                            - The term 1--LLMB MB is a measure for the accuracy at midband frequencies.

                            - The term 1+b1s+b2s2+···bksn bksn describes the high-pass roll-off with respect
                               to the ideal transfer. The MFM high-pass cut-off frequency  is found

                            as       -1   in which  bk  =  1-LMB   with  pj   being a pole that contributes to

                                |bk| k ,                      k
                                                           j=1 pj

                            high-pass cut-off , and LMB the midband frequency loop gain.

                            - The term 1+a1s+a 12s2+···ansn describes the low-pass roll-off with respect
                            to the ideal transfer. The MFM low-pass cut-off frequency h is found
                                   -1
                                                                   1
                                      n
                            as |an| , in which an = (1-L ) n p with pi being a pole that con-
                                                           MB i=1 j
                            tributes to the low-pass cut-off and LMB the midband frequency loop

                            gain.

12.1.2 Compensation techniques

There are different ways to adjust the coefficients ai, (i < n)and bj, (j < k) to
their desired values. Separate sections will be devoted to each of the tech-
niques listed below.

1. The most powerful frequency compensation technique is the insertion of
   so-called phantom zeros.

2. Another technique is to change the positions of two (dominant) poles of
   the loop gain in such a way that their product remains the same, while
   their sum changes. In this way, the bandwidth of the servo function is
   preserved, but lower order coefficients of s in the denominator of the
   servo function can be modified. This technique is often referred to as
   pole-splitting.

3. Instead of splitting two poles by changing their interaction, poles can also
   be split with the aid of pole-zero canceling techniques.
                                                                                  12.1. INTRODUCTION 389

4. An alternative to changing the sum of two poles, is to trade midband loop
   gain with the frequency of a dominant pole such that the product of the
   midband loop gain and the dominant poles is not affected. This technique
   is known as resistive broadbanding.

12.1.3 Compensation strategies

We have seen that the product of the midband loop gain and the dominant
poles determine the bandwidth of the servo function. We have also seen
that a large value of the loop gain is also beneficial to a high accuracy and a
high linearity of the source-load transfer. Hence, there may exist situations in
which severe requirements for the linearity or the accuracy result in a servo
bandwidth that is far more than that required. In such cases, we may reduce
the bandwidth while performing frequency compensation.

   In general, there are three different strategies for frequency compensation:

1. Maintain the designed bandwidth of the source-load transfer. This is a
   useful strategy if the requirement for the midband loop gain that follows
   from the bandwidth design prevails over the one that follows from lin-
   earity or accuracy design considerations and the bandwidth has been de-
   signed to its desired value.

2. Exchange the bandwidth of the ideal transfer with the bandwidth of the
   servo function. This is a useful strategy if the requirement for the mid-
   band loop gain that follows from linearity and/or accuracy requirements
   dominates over the one obtained from bandwidth design considerations
   and if the bandwidth obtained in this way is more than required. This is
   the most powerful method of bandwidth reduction. However, we will see
   that a complicating side effect is that non-dominant poles of the loop gain
   before compensation may have become dominant after compensation.

3. Reduce the bandwidth of the servo function through reduction of the loop
   gain poles product. This may be a useful strategy if the bandwidth is larger
   than required while there exist too many non-dominant poles in the loop
   gain such that the previous method could not be implemented.

12.1.4 This chapter                                                               5 John M. Miller. Dependence of the input
                                                                                  impedance of a three-electrode vacuum
Phantom zero compensation will be discussed in section 12.2. We will intro-       tube upon the load in the plate circuit.
duce the concept of phantom zeros, calculate their values for second and third    Scientific Papers of the Bureau of Standards,
order systems and present implementation methods. We will also present a          15(351):367-385, 1920
technique for bandwidth reduction with the aid of phantom zeros and dis-
cuss the influence of non-dominant poles.

   Pole-splitting by means of capacitive negative feedback across a gain stage
will be discussed in section 12.3. This technique is often referred to as Miller
compensation [Miller1920]5.

   Pole-splitting by means of pole-zero canceling will be presented in section
12.4.

   Resistive broadbanding is a brute-force technique for exchanging a pole
frequency with the midband loop gain, while maintaining the product of the
midband loop gain and the dominant poles. It will be discussed in section
12.5.

   Phase margin and amplitude margin are properties of the loop gain that
are often used as a measure for the stability of a negative feedback amplifier.
Although the method is not advocated here, frequency compensation driven
by phase margin improvement will be illustrated in section 12.6.

   Reduction of the servo bandwidth can be useful for reducing the number
of dominant poles. It can be achieved either by reducing the midband loop
390 FREQUENCY COMPENSATION

                                                  gain, lowering the frequency of one or more poles or adding one dominant
                                                  pole. It will be discussed in section 12.7.

                                                      In section 12.9, we will discuss the design of the controller using cascaded
                                                  feedback amplifiers. In control theory this is known as nested loop control.
                                                  This technique should be applied if the controller should have a well-defined
                                                  dynamic behavior, such as in analog PID controllers.

                                                      In section 12.8, we will discuss the frequency compensation of circuits that
                                                  use negative feedback biasing. This is often referred to as low-frequency
                                                  compensation.

                                                      Large variations in the drive and termination impedance of an amplifier
                                                  may require special measures to ensure stability. Such variations may be part
                                                  of the character of the signal source or the load, but they may also be a result
                                                  of a shorted or a disconnected amplifier port. In section 12.10 we will discuss
                                                  techniques for dealing with these impedance variations.

                                                      Non-dominant poles are poles that do not contribute to the bandwidth
                                                  of the servo function. The frequency of these poles exceeds the unity-gain
                                                  frequency of the loop gain. Although they cannot be included in the design of
                                                  the bandwidth of the servo function, they may cause severe deviations from
                                                  the MFM characteristic designed considering dominant poles alone. Their
                                                  influence and measures for its reduction will be discussed in section 12.11.

12.2 Phantom zero compensation

The root locus method , presented in section 11.5.3, showed us that while
increasing the loop gain, the poles of the servo function may obtain a very
large imaginary part or even move into the right half plane. The method
also showed that poles tend to move towards zeros. Hence, insertion of left
half-plane zeros in the loop may be beneficial to the stability. However, zeros
inserted into the loop transfer function are also zeros in the source load trans-
fer. This directly follows from the expression for the servo function in which
the loop transfer function appears in the numerator. Since an MFM roll-off
requires the realization of an all-pole function, it appears as if frequency com-
pensation by insertion of zeros in the loop is not an option. However, there
is a way out of this using phantom zeros.

12.2.1 The phantom zero concept

A phantom zero owes its name to the fact that it is not visible in the source-load

transfer. A phantom zero can have a beneficial effect on the stability, while

it does not appear in the source-load transfer. The concept of the phantom

zero can be understood from the expression for the gain A f (s) of a negative

feedback amplifier:

                     A f (s) = A f (s) -L(s) 1 - L(s) .               (12.11)

A phantom zero is a zero in the loop gain L(s) that coincides with a pole in the
asymptotic gain A f (s).

   Such a zero does not appear as a zero in the source-load transfer, but it

changes the numerator 1 - L(s) of the servo function. Let us, for example,

insert a phantom zero z1 into L(s) and modify expression (12.11) accordingly.
Hence, we need to add a zero z1 into the loop gain and a pole z1 into the
asymptotic gain A f (s). Expression (12.11) then changes to

A f (s) = A f (s) -L(s) (1 - s/z1) (1 - s/z , 1) 1 - L(s) (1 - s/z1)  (12.12)
                                                                         12.2. PHANTOM ZERO COMPENSATION 391

which can be simplified to:

A f (s) = A f (s) -L(s) 1 - L(s) (1 - s/z . 1)                           (12.13)

   This clearly shows that the phantom zero only changes the denominator
(and thus the poles) of the servo function. It does not change the numerator
of A f (s).

   In the following sections, we will study the conditions for phantom zero
compensation of feedback amplifiers with a loop gain with two and three
poles. SLiCAP examples will be given with simplified circuits of voltage
amplifiers in which both the controller and the feedback network have been
modeled with the aid of voltage-controlled voltage sources. At a later stage,
we will discuss the compensation of amplifiers with passive feedback net-
works with the aid of phantom zeros.

12.2.2 Second order compensation

The dynamic part F2(s) of the servo function with a second-order MFM char-
acteristic will have the form

F2(s) =                                    1 2 2,                        (12.14)
                                   1 + s 2/h + s /h

in which h is the -3 dB low-pass cut-off frequency.

Loop gain with two poles

Let us consider a loop gain L(s) with two dominant poles p1 and p2 above
midband frequencies, and a midband loop gain LMB. The loop gain L(s) can
then be written as:

L(s) =                                       LMB .                       (12.15)
                                   (1 - s/p1) (1 - s/p2)

With the aid of (10.29) and (12.15), the second order servo function S2(s) can
be obtained as

S2(s) = 1 - LMB 1 - s p1+p2 + s2 1 -LMB 1 .                              (12.16)

                                          (1-LMB)p1 p2     (1-LMB)p1 p2

After equating the coefficients of (12.14) and (12.16), we find that a second

order MFM characteristic is obtained if

                                                                         (12.17)
                             p1 + p2 = - 2h,

in which the low-pass cut-off frequency h equals

                             2     =  (1  -  LMB)  p1 p2.                (12.18)

                                h

   In the following example, we use SLiCAP to study the root locus of a                  (2)       E1       (3)
second-order voltage follower that has an MFM response without compensa-               R1
tion.                                                                                         ++       R2 +
                                                                                         (1)  --               -
   Example 12.1
                                                                                      V1 +
       Figure 12.3 shows a second order feedback system with poles p1 and p2 and          -
   DC loop gain LDC.

       The SLiCAP netlist of the circuit, including the definitions of the values of
   the poles and the DC controller gain, is shown below:

1 " Root Locus 2nd order voltage follower"                                            Figure 12.3: Voltage follower with MFM
2 * File: RLvFollower-2.cir                                                           response.
392 FREQUENCY COMPENSATION

                                              3 * SLiCAP netlist file
                                              4 V1 1 0 {V_s}
                                              5 R1 1 2 {R_s}
                                              6 E1 3 0 2 3 {A_0/(1-s/p_1)/(1-s/p_2)}
                                              7 R2 3 0 {R_ell}

                                              8 * For pole-zero analysis all parameters must have a numeric value
                                              9 .param A_0=1M
                                             10 + p_1={-2*pi/sqrt(2)}
                                             11 + p_2={-2*pi*1M*sqrt(2)}
                                             12 + R_ell=1 R_s=1 V_s=1

                                             13 .end

                                                Because of the unity-gain feedback, the DC loop gain equals the controller gain:
                                                LDC = -106. The loop gain has a dominant pole at - 1 Hz and a second pole at
                                                                                                         2

                                                -106 2Hz.

                                                The low-pass cut-off frequency can be calculated with the aid of (12.18). We

                                                obtain: fh = 1MHz. The sum of the poles is determined by p2, and condition

                                                (12.17) has been satisfied. The voltage follower should have an MFM characteris-

                                                tic without compensation.

                                                The script for plotting the root locus is listed below.

                                             1 #!/usr/bin/env python3

                                             2 # -*- coding: utf-8 -*-
                                             3 # File: RLvFollower_2.py

                                             4

                                             5 from SLiCAP import *
                                             6
                                             7 fileName = 'RLvFollower_2'

                                             8 prj = initProject(fileName)

                                             9 i1 = instruction()

                                             10 i1.setCircuit(fileName + '.cir')

                                             11 i1.setSource('V1')            # Signal source is V1
                                             12 i1.setDetector('V_3')         # Voltage detector at node (3)

                                             13 i1.setLGref('E1')             # Loop gain reference variable = E1

                                             14 i1.setGainType('servo')       # Source to load transfer

                                             15 i1.setSimType('numeric')      # Numeric simulation

                                             16 i1.setDataType('poles')       # Calculate the poles
                                             17 i1.setStepVar('A_0')          # Step the DC controller gain for RL plot

                                             18 i1.setStepMethod('lin')

                                             19 i1.setStepStart(0)

                                             20 i1.setStepStop('1M')

                                             21 i1.setStepNum(100)

                                             22 i1.stepOn()

                                             23 RL = i1.execute()

                                             24 i1.stepOff()

                                             25 i1.setGainType('gain')

                                             26 polesGain = i1.execute()

                                             27 i1.setGainType('loopgain')

                                             28 polesLoopGain = i1.execute()

                                             29 plots = [RL, polesLoopGain, polesGain]

                                             30 htmlPage('Root locus')
                                             31 fig_PZ = plotPZ('RL_' + fileName, fileName, plots, xmin=-2, xmax=0, ymin=-1,

                                                ymax=1, xscale='M', yscale='M', show=True)

                                             32 fig2html(fig_PZ, 600)

Figure 12.4: Root locus plot of the voltage         The root locus plot is shown in Figure 12.4. The root loci start at the poles
follower with MFM response.                      of the loop gain. The endpoints for A0 = 106 are the pole positions of the servo
                                                 function. Since there are no poles or zeros present in the asymptotic gain, the
                                                 poles of the gain equal those of the servo function. The poles of the loop gain, as
                                                 well as the DC value of the loop gain, have been designed such that the system has
                                                 an MFM response. The poles of the gain are in Butterworth positions (see Figure
                                                 11.1).

                                                    Lines 33-36 of the script displays the DC value and the poles and zeros of the
                                                 gain in the Python command window. Lines 37-47 print the phase margin and
                                                 the frequency at which the magnitude of loop gain equals unity.

                                             37 # Calculate the phase margin
                                             38 i1.setDataType('laplace')
                                             39 i1.setGainType('loopgain')
                                             40 L = i1.execute()
                                             41 loopGain = L.laplace
                                             42 pmResults = phaseMargin(loopGain)
                                                                12.2. PHANTOM ZERO COMPENSATION 393

43
44 uF = pmResults[1]
45 pM = pmResults[0]
46
47 print('Loop gain: phase margin = {:3.2f}deg at f = {:8.2e}Hz'.format(pM, uF))

    The results are shown below.

1 DC value of gain: 1.00e+0

2

3 Poles of gain:

4

5 n Real part [Hz] Imag part [Hz] Frequency [Hz]         Q [-]

6 -- -------------- -------------- -------------- --------

70  -7.07e+5                 -7.07e+5  1.00e+6 7.07e-1

81  -7.07e+5                 7.07e+5   1.00e+6 7.07e-1

9

10 Found no zeros.

11

12 Loop gain: phase margin = 65.53deg at f = 6.44e+05Hz

       Lines 49-61 generate the Bode plots of the asymptotic gain, the loop gain, the
    servo function and the gain of this voltage follower. The dB magnitude plots of
    these transfer functions are shown in Figure 12.5.

                                                                                       Figure 12.5: SLiCAP simulation result.

49 # Generate Bode plots
50 htmlPage('Bode plots');
51 i1.setGainType('servo');
394 FREQUENCY COMPENSATION

                                                               52 S = i1.execute();
                                                               53 i1.setGainType('gain');
                                                               54 G = i1.execute();
                                                               55 i1.setGainType('asymptotic');
                                                               56 A = i1.execute();
                                                               57 plots = [A, L, S, G];
                                                               58 BodeMag = plotSweep('dBmag_' + fileName, fileName, plots, 1e4, 1e8, 200,

                                                                                          funcType='dBmag', show=True)

                                                               59 BodePhas = plotSweep('Phase_' + fileName, fileName, plots, 1e4, 1e8, 200,

                                                                                          funcType='phase', show=True)

                                                               60 fig2html(BodeMag, 800)
                                                               61 fig2html(BodePhas,800)

                                                          Since the asymptotic gain equals unity, and the direct transfer equals zero,
                                                      the gain equals the servo function. The curve for the servo function has become
                                                      invisible, because it has been overwritten by the gain curve.

                                                          The magnitude characteristic of the gain shows a second order MFM low-pass
                                                    behavior with a -3dB frequency at 1MHz. The loop gain equals 0dB at 640kHz.
                                                      Please notice that negative feedback requires a negative midband frequency value
                                                      of the loop gain. For this reason the phase plot of the loop gain starts at 180
                                                      degrees! The phase margin is 66 degrees.

                                         Loop gain with two poles and one phantom zero

                                         The sum of the poles of the servo function can be changed by adding one

                                         zero to the loop gain. In doing so, the expression for the loop gain (12.15)

                                         changes to

                                                       L(s) = LMB 1 - s/z (1 - s/p . 1) (1 - s/p2)  (12.19)

                                            Let pa and pb be the poles of the servo function, thus allowing their sum
                                         to be found from the coefficient of s in the denominator of the servo function.

                                         Substitution of (12.19) in (10.29) shows that the sum of the poles of the servo

                                         function has been changed by the zero:

                                                       pa + pb = p1 + p2 - p1 p2 z LMB.             (12.20)

                                         With the aid of (12.14), it follows that an MFM characteristic is obtained if

                                                       - (p1 + p2) + p1 p2 LMB = 2h.                (12.21)
                                                                            z

                                         With -LMB > 1, a second order MFM characteristic can be established if

                                                       z = -                2h            .         (12.22)

                                                                            2h + p1 + p2

                                         Hence, a second order feedback system can be given an MFM characteristic

             E1                          with one negative phantom zero if

   (2)  ++                (3)                                                                       (12.23)
 R1     --                                             - (p1 + p2) < 2h,
                     R2 +
   (1)   (4)                 -           where h = |(1 - LMB) p1 p2|.
                 E2
V1 +                                     Example 12.2
    -
        --                                  Figure 12.6 shows a voltage amplifier with a controller with two poles and one
        ++                               zero in the transfer of the feedback network. Since the ideal gain of this circuit is
                                         the reciprocal value of the transfer of the feedback network, this zero establishes a
Figure 12.6: Voltage follower with MFM   pole in the ideal gain. The transfer of the feedback network is also part of the loop
response and phantom-zero compensation.  gain. Thus, the zero in the feedback circuit is also a zero of the loop gain. Hence,
                                         it is a phantom zero, and it is not observable in the gain of the amplifier. With E1
                                         the as loop gain reference variable, we are able to evaluate the asymptotic gain and
                                         the loop gain.
                                                                      12.2. PHANTOM ZERO COMPENSATION 395

   The asymptotic gain A f  equals                                       (12.24)
                                                                         (12.25)
                                A f  = 1 A(1 - s/z . 1)                  (12.26)
   The loop gain L(s) equals

                          L(s) = -A0 A(1 - s/z1) .
                                    (1 - s/p1)(1 - s/p2)

   Let us assume the following numerical values:

                                    p1 = -1 Hz,
                                    p2 = -100 Hz,
                                   A0 = 106 [-],
                                     A = 1 [-].

                                             100
   The achievable second order bandwidth B2 equals

                            1 · 100 · 1 · 106 = 1000 [Hz].               (12.27)
                                      100

      The sum of the poles satisfies (12.23), so according to (12.22), MFM compen-
   sation can be achieved with a phantom zero which needs to be located at

                                    106
                       z=-                 = -761.49 [Hz].               (12.28)
                             1000 2 - 101

   The netlist of this circuit is:

 1 "Root Locus 2nd order voltage amplifier"

 2 * File: RLvAmp-2.cir
 3 * SLiCAP netlist file
 4 V1 1 0 {V_s}
 5 R1 1 2 {R_s}
 6 E1 3 0 2 4 {A_0/(1-s/p_1)/(1-s/p_2)}
 7 E2 4 0 3 0 {A*(1-s/z_1)}
 8 R2 3 0 {R_ell}

 9 * For pole-zero analysis all parameters must have a numeric value
10 .param A_0 = 1M A = 10m
11 + p_1 = {-2*pi}
12 + p_2 = {-2*pi*100}
13 + z_1 = {-2*pi*761.49}
14 + R_ell = 1 R_s=1 V_s=1

15 .end

   The script for plotting the root locus is:

1 #!/usr/bin/env python3

2 # -*- coding: utf-8 -*-
3 # File: RLvAmp_2.py

4

5 from SLiCAP import *

6

7 fileName = 'RLvAmp_2'

8 prj = initProject(fileName)

9 i1 = instruction()

10 i1.setCircuit(fileName + '.cir')

11 i1.setSource('V1')               # Signal source is V1

12 i1.setDetector('V_3')            # Voltage detector at node (3)

13 i1.setLGref('E1')                # Loop gain reference variable = E1

14 i1.setGainType('servo')          # Source to load transfer

15 i1.setSimType('numeric')         # Numeric simulation

16 i1.setDataType('poles')          # Calculate the poles

17 i1.setStepVar('A_0')             # Step the DC controller gain for RL plot

18 i1.setStepMethod('lin')

19 i1.setStepStart(0)

20 i1.setStepStop('1M')

21 i1.setStepNum(100)

22 i1.stepOn()
396 FREQUENCY COMPENSATION

                                             23 RL = i1.execute()
                                             24 i1.stepOff()
                                             25 i1.setGainType('gain')
                                             26 polesGain = i1.execute()
                                             27 i1.setGainType('loopgain')
                                             28 polesLoopGain = i1.execute()
                                             29 i1.setDataType('zeros')
                                             30 zerosLoopGain = i1.execute()
                                             31 plots = [RL, zerosLoopGain, polesLoopGain, polesGain]
                                             32 htmlPage('Root locus')
                                             33 fig_PZ = plotPZ('RL_' + fileName, fileName, plots, xmin=-2, xmax=0, ymin=-1,

                                                             ymax=1, xscale='k', yscale='k', show=True)

                                             34 fig2html(fig_PZ, 600)

Figure 12.7: Root locus plot of the voltage         The root locus plot is shown in Figure 12.7. The root loci start at the poles
amplifier with MFM response.                     of the loop gain. The endpoints for A0 = 106 are the pole positions of the servo
                                                 function. The zero in the loop gain coincides with the pole in the asymptotic gain.
                                                 Its effect on the root locus can clearly be observed.

                                                    Lines 35-38 of the above script display the DC value, the poles, and the zeros of
                                                 the gain in the Python command window. Lines 39-49 print the phase margin
                                                 and the frequency at which the magnitude of the loop gain equals unity.

                                             39 # Calculate the phase margin
                                             40 i1.setDataType('laplace')
                                             41 i1.setGainType('loopgain')
                                             42 L = i1.execute()
                                             43 loopGain = L.laplace
                                             44 pmResults = phaseMargin(loopGain)
                                             45
                                             46 uF = pmResults[1]
                                             47 pM = pmResults[0]
                                             48
                                             49 print('Loop gain: phase margin = {:3.2f}deg at f = {:8.2e}Hz'.format(pM, uF))

                                                    The results are shown in the Python command window. According to our ex-
                                                 pectations, the two poles are in MFM positions and the low-pass cut-off frequency
                                                 is found at 1kHz.

                                             1 DC value of gain: 1.00e+2

                                             2

                                             3 Poles of gain:

                                             4

                                             5 n Real part [Hz] Imag part [Hz] Frequency [Hz]         Q [-]

                                             6 -- -------------- -------------- -------------- --------

                                             70  -7.07e+2        -7.07e+2          1.00e+3 7.07e-1

                                             81  -7.07e+2                 7.07e+2  1.00e+3 7.07e-1

                                             9

                                             10 Found no zeros.

                                             11

                                             12 Loop gain: phase margin = 66.61deg at f = 1.47e+03Hz

                                                    Lines 51-63 create the Bode plots of the asymptotic gain, the loop gain, the
                                                 servo function, and the gain of this voltage follower:

                                             51 # Generate Bode plots
                                             52 htmlPage('Bode plots');
                                             53 i1.setGainType('servo');
                                             54 S = i1.execute();
                                             55 i1.setGainType('gain');
                                             56 G = i1.execute();
                                             57 i1.setGainType('asymptotic');
                                             58 A = i1.execute();
                                             59 plots = [A, L, S, G];
                                             60 BodeMag = plotSweep('dBmag_' + fileName, fileName, plots, 1, 1e4, 200,

                                                             funcType='dBmag', show=True)

                                             61 BodePhas = plotSweep('Phase_' + fileName, fileName, plots, 1, 1e4, 200,

                                                             funcType='phase', show=True)

                                             62 fig2html(BodeMag, 800)
                                             63 fig2html(BodePhas,800)

                                                    The dB magnitude plots and phase of these transfer functions is shown in
                                                 Figure 12.8. The phantom zero can clearly be observed as a zero in the loop
                                                 gain and a pole in the asymptotic gain. Its influence in the servo function can
                                                     12.2. PHANTOM ZERO COMPENSATION 397

also be observed by an increase of the magnitude around 1kHz. The gain has
an all-pole MFM characteristic. Please notice that negative feedback requires a
negative midband frequency value of the loop gain. For this reason, the phase
plot of the loop gain starts at 180 degrees! The plot clearly shows the influence
of the phantom zero on the phase margin. The phantom zero shifts the unity-
gain frequency of the loop gain upwards and increases the phase margin. The
MFM-compensated amplifier has a phase margin of 67 degrees.

                                                                                   Figure 12.8: SLiCAP simulation result.

12.2.3 Third order compensation

The dynamic part of a third order MFM servo function S3(s) has the form:

S3(s) =  1                       3 3,                (12.29)

          22
         1 + 2s/h + 2s /h + s /h

in which h is the -3 dB low-pass cut-off frequency.
398 FREQUENCY COMPENSATION

                                              Loop gain with three poles

                                              We will consider an all-pole loop gain with three poles p1, p2, and p3:

                                                  L(s) = LMB 1 (1 - s/p . 1) (1 - s/p2) (1 - s/p3)                     (12.30)

                                                 After substitution of (12.30) in (10.29), we obtain the expression for the
                                              servo function as

                                              S3(s) = 1 - LMB 1 - s p1 p2+p1 p3+p2 p3 + s2 p1+p2+p3 - s3 1 -LMB 1
                                                            (1-LMB)p1 p2 p3                   (1-LMB)p1 p2 p3   (1-LMB)p1 p2 p3
                                                                                                                       (12.31)

                                              With the aid of (12.29), we find that all the poles are in MFM positions if:

                                                            p1 p2         +  p1 p3  +  p2 p3  =  22                    (12.32)
                                                                                                                       (12.33)
                                                                                                      h

                                                                                              and

                                                                             p1 + p2 + p3 = -2h.

                                              in which h = 3 |(1 - LMB) p1 p2 p3|.

                                              Example 12.3

                                                  A third order feedback system with poles p1, p2 and p3 obtains an MFM re-

                                              sponse without compensation if the conditions from (12.32) and (12.33) are sat-

                                              isfied. If we add the condition that the poles of the loop gain should not have a

             E1                               positive real part, we find only one valid solution. It has one pole in the origin

   (2)  ++            (3)                     p1 = 0 and two complex poles p2,3 = -n ± jn. The loop gain can be written
 R1     --
                 R2 +                         as                                       -3
   (1)                   -
                                                            L(s) = 2                     h 2.                          (12.34)
V1 +                                                                         s s + 2sh + 2h
    -
                                                 This will be demonstrated for the voltage follower from Figure 12.9. The volt-
                                              age follower described in the SLiCAP netlist below has been given an MFM
                                              bandwidth of 1MHz:

Figure 12.9: Voltage follower with third-      1 " Root Locus 3nd order voltage follower"
order MFM response.
                                               2 * File: RLvFollower-3.cir
                                               3 * SLiCAP netlist file
                                               4 V1 1 0 {V_s}
                                               5 R1 1 2 {R_s}
                                               6 E1 3 0 2 3 {8*pi^3*f_h^2*A_0/s/(s^2+s*4*pi*f_h+8*pi^2*f_h^2)}
                                               7 R2 3 0 {R_ell}

                                               8 * For pole-zero analysis all parameters must have a numeric value
                                               9 .param f_h = 1M R_ell=1 R_s=1 V_s=1 A_0=1M

                                              10 .end

Figure 12.10: Root locus plot of the voltage     The script RLvFollower_3.py for plotting the root locus is similar to RLvFollower_2.py.
follower with MFM response.                   It only uses the circuit from Figure 12.9 instead of that from Figure 12.5.

                                                 The root locus plot is shown in Figure 12.10. The root loci start at the poles
                                              of the loop gain. The endpoints for A0 = 106 are the pole positions of the servo
                                              function. Since there are no poles or zeros present in the asymptotic gain, the
                                              poles of the gain equal those of the servo function. The poles of the loop gain, as
                                              well as the loop gain poles product have been designed such that the system has a
                                              3-rd order MFM response. The poles of the gain are in Butterworth positions (see
                                              Figure 11.1).

                                                 Below is the output generated by RLvFollower_3.py as it is displayed in the
                                              Python command window. This confirms our expectations.

                                              1 DC value of gain: 1.00e+0                                Q [-]
                                              2
                                              3 Poles of gain:
                                              4
                                              5 n Real part [Hz] Imag part [Hz] Frequency [Hz]
                                                            12.2. PHANTOM ZERO COMPENSATION 399

6 -- -------------- -------------- -------------- --------

70  -5.00e+5        -8.66e+5  1.00e+6 1.00e+0

81  -5.00e+5        8.66e+5   1.00e+6 1.00e+0

92  -1.00e+6        0.00e+00  1.00e+6

10

11 Found no zeros.

12

13 Loop gain: phase margin = 60.49deg at f = 4.96e+05Hz

       The dB magnitude plots and the phase plots of the transfer functions of the
    asymptotic gain model are shown in Figure 12.11. Since the asymptotic gain
    equals unity, and the direct transfer equals zero, the gain equals the servo func-
    tion. The curve for the servo function has become invisible, because it has been
    overwritten by the gain curve. Please notice that negative feedback requires a neg-
    ative midband frequency value of the loop gain. For this reason the phase plot of
    the loop gain with a pole in the origin starts at 90 degrees! The phase margin of
    the loop gain is 60deg and the unity-gain frequency of the loop gain is 500kHz.

                                                                                         Figure 12.11: SLiCAP simulation result.

Loop gain with three poles and one phantom zero

We will now investigate the conditions under which a third-order system can
be compensated with one phantom zero. A loop transfer function with one
400 FREQUENCY COMPENSATION

                                              zero z1 and three poles p1, p2, and p3 can be written as

                                                           L(s) = LMB 1 - s/z1 (1 - s/p . 1) (1 - s/p2) (1 - s/p3)  (12.35)

                                                 After substitution of (12.35) in (10.29), it can be seen that the coefficient of
                                              s2 in the denominator depends on z1. A third-order MFM response for the

                                              servo function now requires the following two conditions to be satisfied:

                                                                                    p1 + p2 + p3 = -2h,             (12.36)
                                                                                                                    (12.37)
                                                           p1 p2 + p1 p3 + p2 p3 -  LMB p1 p2 p3       = 2h.2

                                                                                           z1

                                              Assuming -LMB > 1, a third-order MFM characteristic can be accom-

                                              plished if:

                                                           z1 =                     3h 2.                           (12.38)

                                                                 p1 p2 + p1 p3 + p2 p3 - 2h

                                                 From this, we see that a third-order system can be given an MFM charac-
                                              teristic with one negative real phantom zero if

                                                           p1 p2  +  p1 p3  +       p2 p3  <   22                   (12.39)
                                                                                                                    (12.40)
                                                                                                    h

                                                                                           and if

                                                                     p1 + p2 + p3 = -2h

   (2)  E1                  (3)               in which h = 3 |(1 - LMB) p1 p2 p3|.
 R1
         ++            R2 +                      Example 12.4
   (1)   --                    -
                                                     Figure 12.12 shows the circuit of a third-order voltage amplifier that has been
V1 +       (4)                                   compensated with one phantom zero. The circuit is equivalent to the one from
    -              E2                            Figure 12.6, only the expressions for the voltage-controlled voltage sources have
                                                 been changed. The pole positions have been chosen to comply with (12.39) and
                                                 (12.40):

        --                                                 p1 = -10 Hz, p2 = -590 Hz, p3 = -1400 Hz.                (12.41)
        ++                                    The DC loop gain LDC equals

Figure 12.12: Circuit of a voltage amplifier                     LDC = -A0 A = -120,                                (12.42)
with three poles and one phantom zero.

                                              from which we obtain an MFM bandwidth fh:                             (12.43)
                                                                      fh = 3 121 · 10 · 590 · 1400 = 1000.

                                              The sum of the poles equals -2000, which is -2 fh. This satisfies (12.40). The sum
                                              of the products of two poles is less than two times the squared bandwidth. This
                                              satisfies condition (12.39). The amplifier can thus obtain an MFM characteristic
                                              by inserting one negative real phantom zero. The position of the zero follows from
                                              (12.38):

                                              z1 =                109                                               (12.44)
                                                                                            6 = -866.48Hz.
                                                           10 · 590 + 10 · 1400 + 590 · 1400 - 2 · 10

                                              The netlist of this circuit is shown below:

                                              1 "Root Locus 3nd order voltage amplifier, one zero"
                                              2 * File: RLvAmp-3_1.cir

                                              3 * SLiCAP netlist file
                                              4 V1 1 0 {V_s}
                                              5 R1 1 2 {R_s}
                                              6 E1 3 0 2 4 {A_0/(1-s/p_1)/(1-s/p_2)/(1-s/p_3)}
                                              7 E2 4 0 3 0 {A*(1-s/z_1)}
                                              8 R2 3 0 {R_ell}
                                                                          12.2. PHANTOM ZERO COMPENSATION 401

 9 * For pole-zero analysis all parameters must have a numeric value
10 .param A_0 = 12k A = 10m
11 + p_1 = {-2*pi*10}
12 + p_2 = {-2*pi*590}
13 + p_3 = {-2*pi*1400}
14 + z_1 = {-2*pi*866.48}
15 + R_ell = 1 R_s=1 V_s=1

16 .end

       The script RLvAmp_3_1.py is similar to RLvAmp_2.py. It plots the root locus,
    but uses the circuit from Figure 12.12 instead of that from Figure 12.6.

       The root locus plot generated by this script is shown in Figure 12.13. It clearly
    shows a third-order response with the poles in MFM positions. The phantom zero
    in the loop gain is not observable in the gain, because it coincides with a pole in
    the asymptotic gain.

       Below is the output generated by the script RLvAmp_3_1.py as it is displayed
    in the Python command window. It confirms our expectations.

1 Poles of gain:

2

3 n Real part [Hz] Imag part [Hz] Frequency [Hz]         Q [-]

4 -- -------------- -------------- -------------- --------                                Figure 12.13: Root locus plot of the voltage
                                                                                          amplifier with third order MFM response,
50  -4.95e+2       -8.63e+2               9.95e+2 1.00e+0                                 compensated with one phantom-zero.

61  -4.95e+2       8.63e+2                9.95e+2 1.00e+0

72  -1.01e+3       0.00e+00               1.01e+3

8

9 Found no zeros.

10

11 Loop gain: phase margin = 49.24deg at f = 8.29e+02Hz

       The phase margin of this MFM-compensated third-order amplifier is 49 de-
    grees.

       The dB magnitude plots and the phase plots of the transfer functions of the
    asymptotic gain model are shown in Figure 12.14. Please notice that negative
    feedback requires a negative midband frequency value of the loop gain. For this
    reason, the phase plot of the loop gain starts at 180 degrees!

Loop gain with three poles and two phantom zeros

A loop transfer function with three poles p1, p2, and p3 and two zeros z1 and
z2 can be written as

    L(s) = LMB (1 - s/z1) (1 - s/z2) (1 - s/p . 1) (1 - s/p2) (1 - s/p3)  (12.45)

   From this expression, we can calculate the frequency-dependent part of
the servo function. We then obtain expressions for the first order and the
second order coefficients of s of the denominator of the servo function. We
may then conclude that the poles will be in MFM positions if

    p1 p2 + p1 p3 + p2 p3 - LMB p1 p2 p3  1+1            = 2h2,           (12.46)
                                          z1 z2                           (12.47)

                   p1 + p2 + p3 - p1 p2 p3 LMB z = -2 1z2 h.

   From (12.46) and (12.46), we obtain values for the product and the sum of
the phantom zeros:

                                           3                              (12.48)
                      z1z2 = h p , 1 + p2 + p3 + 2h                       (12.49)
                   z p 1 + z2 = 1 p2 + p1 p3 + p2 p3 - 2h2 .

                                    p1 + p2 + p3 + 2h

    With two phantom zeros that have a negative real part, a third order MFM
402 FREQUENCY COMPENSATION                                                                                     (12.50)
                                                                                                               (12.51)
                                                  transfer can be realized if
                                                                                 p1 p2 + p1 p3 + p2 p3 < 2h2,
                                                                                    - (p1 + p2 + p3) < 2h,

                                                in which h = 3 |(1 - LMB) p1 p2 p3|.

Figure 12.14: SLiCAP simulation result.

                                              The phantom zeros can then be calculated from 12.46 and 12.47 using

        E1                                                  z1,2 = 1 (z1 + z2) ± 1  (z1 + z2)2 - 4z1z2.        (12.52)
                                                            2  2
   (2)   ++                 (3)
 R1      --                                      In the following example, we will demonstrate the compensation of a third
                       R2 +                   order system with two phantom zeros.
   (1)     (4)                 -
                   E2
V1 +                                          Example 12.5
    -
        --                                       Figure 12.15 shows the circuit of a third order voltage amplifier that has been
        ++                                    compensated with two phantom zeros. The circuit is equivalent to the one from
                                              Figure 12.6, only the expressions for the voltage-controlled voltage sources have
Figure 12.15: Circuit of a voltage amplifier  been changed. The pole positions have been chosen to comply with (12.50) and
with three poles and two phantom zeros.       (12.51):

                                              p1 = -20 Hz, p2 = -50 Hz, p3 = -1250 Hz.                         (12.53)
                                                                      12.2. PHANTOM ZERO COMPENSATION 403

    The DC loop gain LDC equals:

                            LDC = -A0 A = -799,                       (12.54)

    from which we obtain an MFM bandwidth fh:                         (12.55)
                           fh = 3 800 · 20 · 50 · 1250 = 1000 Hz.

       The sum of the poles equals -1320Hz, which satisfies (12.40). The sum of the
    products of two poles equals 88.5 × 103, which satisfies condition (12.39). The

    amplifier can thus be given an MFM characteristic by inserting two phantom

    zeros that have a negative real part. The product of the zeros follows from (12.48):

                    z1z2 =   10003            = 1. 47 × 106 Hz2.      (12.56)

                            -1320 + 2 · 1000

    The sum of the zeros follows from (12.49):

    z1 + z2 =               88.5 × 103 - 2 · 10002  = -2811 Hz.       (12.57)

                             -1320 + 2 · 1000

    With the aid of (12.52), we obtain

                                       z1 = -695 Hz,                  (12.58)
                                                                      (12.59)
                                       z2 = -2116 Hz.

       The netlist of this circuit is shown below.

 1 "Root Locus 3nd order voltage amplifier, two zeros"
 2 * File: RLvAmp-3_2.cir
 3 * SLiCAP netlist file
 4 V1 1 0 {V_s}
 5 R1 1 2 {R_s}
 6 E1 3 0 2 4 {A_0/(1-s/p_1)/(1-s/p_2)/(1-s/p_3)}
 7 E2 4 0 3 0 {A*(1-s/z_1)*(1-s/z_2)}
 8 R2 3 0 {R_ell}
 9 * For pole-zero analysis all parameters must have a numeric value
10 .param A_0 = 1M A = 799u
11 + p_1 = {-2*pi*20}
12 + p_2 = {-2*pi*50}
13 + p_3 = {-2*pi*1250}
14 + z_1 = {-2*pi*(695)}
15 + z_2 = {-2*pi*(2116)}
16 + R_ell = 1 R_s=1 V_s=1
17 .end

       The script RLvAmp_3_2.py for plotting the root locus is similar to RLvAmp_2.py.
    It only uses the circuit from Figure 12.15 rather than that from Figure 12.12.

       The root locus plot generated by this script is shown in Figure 12.16. It clearly
    shows a third order response with the poles in MFM positions. The phantom zeros
    in the loop gain are not observable in the gain, because they coincide with poles in
    the asymptotic gain.

       Below is the output generated by the scrip as it is displayed in the Python
    command window.

1 DC value of gain: 1.25e+3

2

3 Poles of gain:

4

5 n Real part [Hz] Imag part [Hz] Frequency [Hz]         Q [-]

6 -- -------------- -------------- -------------- --------                                Figure 12.16: Root locus plot of the voltage
                                                                                          amplifier with third order MFM response,
70  -4.99e+2                -8.66e+2          9.99e+2 1.00e+0                             compensated with two complex phantom-
                                                                                          zeros.
81  -4.99e+2                 8.66e+2          9.99e+2 1.00e+0

92  -1.00e+3                0.00e+00          1.00e+3

10

11 Found no zeros.

12

13 Loop gain: phase margin = 47.98deg at f = 1.13e+03Hz
404 FREQUENCY COMPENSATION

                                                          The bandwidth, as well as the response type, are as expected.
                                                          The dB magnitude plots of the transfer functions of the asymptotic gain model
                                                      are shown in Figure 12.17. Please notice that negative feedback requires a negative
                                                      midband frequency value of the loop gain. For this reason, the phase plot of the
                                                      loop gain starts at 180 degrees!

Figure 12.17: SLiCAP simulation result.

In the following example, we will demonstrate the frequency compensa-

tion in the case in which the loop gain has three poles in the origin. This

may be of practical interest for systems that have the poles of the loop gain

relatively close to the origin. The example shows that MFM compensation of

such systems requires two complexconjugated phantom zeros with a quality
factor  of  1  2  and  a  frequency  of  1  2 fh, where fh is the -3dB MFM cut-off
            2                            2
frequency in Hz.

Example 12.6

   Let us now consider a loop gain L(s) with three poles in the origin. This loop
transfer function can be written as

                                     L(s) = a3s3 1 ,  (12.60)

in which a3 < 0 (negative feedback). The expression for the servo function is then
                                                       12.2. PHANTOM ZERO COMPENSATION 405

obtained as  -L(s) 1 - L(s) = 1 - a3s3 1 .

                                                       (12.61)

The MFM low-pass cut-off frequency h is then found as

             h = 3 1a . 3                              (12.62)

   Both the sum of the poles and the sum of the products of two poles are zero.
Hence, conditions (12.50) and (12.51) have been met and an MFM low-pass cut-
off of the servo function can be established with two phantom zeros. With the aid
of (12.50), (12.51) and (12.52), we find:

             z1, z2 = 12 h ± 12 jh.                    (12.63)

12.2.4 Implementation of phantom zeros

In the previous sections, we have studied the conditions under which second
and third order systems can be compensated with the aid of phantom zeros.
We also found means to determine their values. Although for higher order
systems, the procedure is similar, we will confine ourselves to second order
and third order systems. We will discuss the design of the frequency response
of higher order amplifiers at a later stage.

   The examples of amplifiers compensated with phantom zeros, that we
discussed in the previous sections, were primarily intended to illustrate the
concept of phantom zero compensation. The presented implementations of
phantom zeros in the transfer of the controlled sources in the feedback path
were conceptually correct, but far from practical. These zeros would result
in an infinite gain of those controlled sources for j  , which is non-
physical.

   In this section, we will discuss the implementation of phantom zeros in
practical circuits. We will study the way in which phantom zeros can be
realized and investigate possible side effects that may limit their effectiveness.

Phantom zero locations

By definition, phantom zeros are zeros in the loop gain that coincide with
poles in the asymptotic gain. If we have selected the loop gain reference
variable properly, the asymptotic gain equals the ideal gain. The ideal gain
has been defined as the source-load transfer of the feedback amplifier in
which the controllers have been replaced with nullors. From this, we obtain
an important design conclusion:

    Poles in the asymptotic gain can only be established in circuitry around the nul-
    lor(s). Hence, the internal circuitry of the controller is not a place to search for
    implementation of phantom zeros!

   The circuitry around the nullor comprises:

· The feedback network

   A pole in the asymptotic gain can be realized by inserting a zero into the
   transfer of the feedback network. This has already been illustrated in the
   examples in the previous section.

· The signal source
406 FREQUENCY COMPENSATION

                                                      Insertion of a pole into the signal transfer from the signal source to the
                                                      input of the amplifier causes a pole in the asymptotic gain. By doing so,
                                                      we insert a low-pass filter between the signal source and the input of the
                                                      amplifier.

                                                  · The load
                                                      Similarly as above, insertion of a pole into the transfer from the output of
                                                      the amplifier to the load also causes a pole in the asymptotic gain.

                                                  Phantom zero effectiveness

                                                  After we have realized the poles in the asymptotic gain, we need to inves-
                                                  tigate whether they also appear as effective zeros in the loop gain. We will
                                                  call a phantom zero effective if it does what it should do: bring the dominant
                                                  poles of the servo function into their desired positions. The effectiveness of
                                                  phantom zeros may strongly be reduced if:

                                                  · The insertion of the phantom zero changes the original pole positions such
                                                      that the bandwidth is reduced.

                                                  · The insertion of a phantom zero introduces a new dominant pole.

                                                      We will see that the insertion of phantom zeros is never free of such side
                                                  effects, but in many cases, these effects may be kept within acceptable limits.

6 Such a branch can be considered as          12.2.5 Phantom zeros in the feedback network
one that performs voltage-to-current
conversion.                                   Zeros in the feedback network can be established as described in Chapter
                                              18.5.3. The basic techniques are:
7 Such a branch can be considered as
one that performs current-to-voltage          1. Change the feedback network in such a way that its transfer becomes zero
conversion.                                      at the (complex) frequency of the zero. In passive feedback networks, such
                                                 as voltage attenuators, current attenuators, current-to-voltage conversion
8 A network branch or a sub network is           impedances and voltage-to-current conversion admittances, this works as
in series with the signal path if, when          follows:
replaced with an open circuit, the signal
transfer becomes zero.                           (a) Create zero admittance (an open circuit) at the (complex) frequency
                                                     of the zero in a branch of the feedback network that appears in series
  A network or a sub network is in parallel          with the signal path. This is done by placing an admittance in parallel
with the signal path if, when replaced with          with this branch whose value at the (complex) frequency of the zero is
a short circuit, the signal transfer becomes         opposite to the value of the admittance of the original branch.6
zero.
                                                 (b) Create zero impedance (a short) at the (complex) frequency of the zero
                                                     in a branch of the feedback network that appears in parallel with the
                                                     signal path. This is done by placing an impedance in series with that
                                                     branch whose value at the (complex) frequency of the zero is opposite
                                                     to the value of the impedance of the original branch.7

                                              2. Add a second feedback path that cancels the transfer of the original one
                                                 at the (complex) frequency of the zero.

                                                 In the following example, we will demonstrate the first method.

                                                 Example 12.7

                                                     Figure 12.18A shows a passive voltage attenuator that has been used as a
                                                 feedback network in the voltage amplifier from Figure 12.18B. The resistor R1
                                                 appears in series with the signal path, while R2 appears in parallel with the signal
                                                 path.8 Now, let us assume that a phantom zero at the complex frequency s = z1
                                                 has to be implemented. As described above, we then need to create a zero in the
                                                 transfer of the feedback network at this frequency. We have two possibilities:
                                                     12.2. PHANTOM ZERO COMPENSATION 407

1. Place an admittance Yp(s) in parallel with R1 that cancels the admittance of R1 at           R1

s = z1. After doing so, the admittance Ytot(s) of the modified branch is obtained

as  Ytot(s) = Yp(s) + 1 .                                                                    +      R2 +
                                                                                                             -
                   Ra                                (12.64)                                -

This function has a unique negative real solution if Yp(s) is capacitive. With a       A
capacitance Cphz, we have Yp(s) = sCphz and obtain
                                                                                                +       +

    Ytot(s) = sCphz + 1Ra .                          (12.65)                                                           R1
                                                                                                --

Hence, we have created a negative real zero z1, that is the solution of Ytot(s) = 0:      + R2 +

    z1 = - 1 .                                                                            -                                -
             RaCphz
                                                     (12.66)                           B

Figure 12.19 shows the modified voltage attenuator.                                    Figure 12.18: A. Resistive voltage attenua-
                                                                                       tor
2. Place an impedance Zse(s) in series with R2 that cancels the resistance of R2 at
                                                                                         B. Application of the resistive voltage
s = z1. After doing so, the impedance Ztot(s) of the modified branch is obtained       attenuator in a passive feedback voltage
                                                                                       amplifier.

as                                                                                                  C1

    Ztot(s) = Zse(s) + Rb.                           (12.67)

This function has a unique negative real solution if Zse(s) is inductive. With an                   R1
inductance Lphz, we have Zse(s) = sLphz and obtain

    Ztot(s) = sLphz + Rb.                            (12.68)                                    + R2 +

Hence, we have created a negative real zero z1 that is the solution of Ztot(s) = 0:             -               -

    z1 = - Rb .                                      (12.69)                           Figure 12.19: Resistive voltage attenuator
             Lphz                                                                      with added zero in the series branch.

                                                                                                    R1

Figure 12.20 shows the modified voltage attenuator.

   The example above gives a formal approach to the design of zeros in the                      + R2 +
transfer of the feedback network. We have not yet studied any side effects of
such implementations, nor have we discussed the effectiveness of the phan-                          L1
tom zeros. This will be done at a later stage. At this stage, we may draw the
following conclusions for implementation of zeros in the transfer of feedback                   -               -
networks:
                                                                                       Figure 12.20: Resistive voltage attenuator
1. Branches in series with the signal path should be changed in such a way             with added zero in the parallel branch.
   that the order of s in the admittance is increased and zero admittance is
   achieved at the (complex) frequency of the phantom zero:                                     series          with
                                                                                                branch          zero(s)
   (a) If a series branch behaves resistively at the frequency of the phantom                   admittance
       zero, a capacitive branch placed in parallel will cause a negative real
       zero in the transfer of the feedback network (see Figure 12.21A).                     A

   (b) If a series branch behaves inductively at the frequency of the phantom                 B
       zero, a resistive branch placed in parallel will cause a zero and a ca-
       pacitive branch placed in parallel will cause two (complex) zeros in the               C
       transfer of the feedback network (see Figure 12.21B).
                                                                                       Figure 12.21: Implementation of zeros in
   (c) If a series branch behaves capacitively at the frequency of the phantom         series branch admittances.
       zero, then there is no means for creating a zero in this branch (see Figure
       12.21C).

2. Branches in parallel with the signal path should be changed in such a way
   that the order of s in the impedance is increased and zero impedance is
   achieved at the (complex) frequency of the phantom zero:
408 FREQUENCY COMPENSATION

Figure 12.22: Implementation of zeros in
parallel branch impedances.

                                            A                   B                   C

                                            parallel   with     parallel   with     parallel   no
                                            branch     real     branch     complex  branch     zeros
                                            impedance  zero     impedance  zeros    impedance  possible

                                               (a) If a parallel branch behaves resistively at the frequency of the phantom
                                                   zero, an inductive branch placed in series will cause a negative real zero
                                                   in the transfer of the feedback network (see Figure 12.22A).

                                               (b) If a parallel branch behaves capacitively at the frequency of the phan-
                                                   tom zero, a resistive branch placed in series will cause a negative real
                                                   zero and an inductive branch placed in series will cause two (complex)
                                                   zeros in the transfer of the feedback network (see Figure 12.22B).

                                               (c) If a parallel branch behaves inductively at the frequency of the phan-
                                                   tom zero, then there is no means for creating a zero in this branch (see
                                                   Figure 12.22C).

                                               In Figure 12.23, the above method has been applied for implementing
                                            phantom zeros in the elementary single-loop resistive feedback amplifiers.
                                            The zeros in the transfers of the feedback networks cause poles in the asymp-
                                            totic gain and zeros in the loop gain.

Figure 12.23: Realization of phantom                   +     +                      +     -
zeros in the feedback network of the basic
single-loop resistive feedback amplifier               --                           -     +
configurations.
                                                  +                +             +
    A. Two phantom zeros in the voltage          -
amplifier                                   A                      -             -

    B. One phantom zero in the transcon-
ductance amplifier

    C. One phantom zero in the transresis-
tance amplifier

    D. Two phantom zeros in the current
amplifier

                                                                              B

                                                                                       +  +

                                                                                       --

                                                       +- +

                                                       -     +     -

                                            C                              D
                                                       12.2. PHANTOM ZERO COMPENSATION 409

Effectiveness of phantom zeros in the feedback network

A phantom zero in the feedback network is effective , if the branch of the
feedback network in which the zero will be implemented causes a significant
attenuation in the loop gain at the frequency of the zero. The zero will then
increase the loop gain by reducing this attenuation for frequencies above
the frequency of the zero, while it causes loop gain to become zero at the
(complex) frequency of the zero. This will be elucidated with the aid of
Figure 12.24.

Source     Controller     Load   asymptotes of the magnitude characteristic                                 Figure 12.24: Left: small-signal diagram
                                 of the voltage transfer of the feedback network                            of a passive-feedback voltage amplifier
   +       ++                 +                                                                             showing the signal source, the load, the
  -       --                                                                                                feedback network and the controller. A
                              -                                                                             phantom zero has been implemented in the
        Feedback network                                                                                    series branch of the feedback network.

                                 log                   frequency [Hz]                                           Right: the magnitude characteristic
                                 scale                 log scale                                            of the transfer of the feedback network.
                                                                                                            The phantom zero establishes an increase
                                                                                                            of the loop gain for frequencies above fz
                                                                                                            and below fp. In this frequency range, it
                                                                                                            changes the order of the transfer from 0 to
                                                                                                            -1 (first order differentiating) and is called
                                                                                                            effective.

   Figure 12.24 shows the small-signal diagram of a passive-feedback volt-                                  Figure 12.25: Circuit diagram of the tran-
age amplifier as well as the magnitude characteristic of the transfer of the                                simpedance amplifier from example 7.11.3
feedback network. If we select the gain Av of the voltage-controlled volt-                                  with phantom zero compensation.
age source as the loop gain reference variable, the loop gain is proportional
to the voltage transfer of the feedback network. This transfer has one zero
z = - R 1aCb , and one pole p = - RRaaR+RbCbc . This figure shows that a nonzero
value of Cc reduces the loop gain attenuation caused by the resistive volt-
age divider. The frequency range over which the phantom zero is effective
increases with the attenuation of the voltage divider: ffzp = RaR+bRb .

   In the following example, we will apply the above methods for frequency
compensation of the transimpedance amplifier from example 11.3.

   Example 12.8

       Figure 12.25 shows the small-signal equivalent diagram of the transimpedance
   amplifier from example 11.3 with phantom zero compensation. The implementa-
   tion of the phantom zero is as discussed in Figure 12.21A. Other implementations
   will be discussed later.

                                                                                                        C4

                                                                                          R1

                              (1)           (2)

                                       -+           +

I1      C1  C2            C3               R2

                                 +-                -

                                 E1
                                 model EZ

      Below is the SLiCAP netlist of the circuit in which the initial value of the
  compensation capacitance Cphz has been set to zero:

1 transimpedanceCompensated
2 * file: transimpedanceCompensated.cir
3 * SLiCAP circuit file
410 FREQUENCY COMPENSATION

 4 I1 0 1 0
 5 C1 1 0 {C_s}
 6 C2 1 0 {C_d}
 7 C3 1 0 {C_c/2}
 8 C4 1 2 {C_phz}
 9 C5 2 0 {C_ell}
10 R1 1 2 {R_f}
11 R2 2 0 {R_ell}
12 E1 2 0 0 1 EZ value={A_0/(1+s/2/pi/16)} zo={R_o}
13 .param C_d=8p C_c=7p A_0=1M R_o=55 G_B=16M
14 .param C_s=5p R_f=100k R_ell=2k C_ell=0 C_phz=0

15 .end

       Lines 1 to 20 of the SLiCAP script calculate the DC value of the loop gain, as
    well as the poles and zeros:

 1 #!/usr/bin/env python3
 2 # -*- coding: utf-8 -*-
 3 # File: transimpedanceCompensated.py
 4
 5 from SLiCAP import *
 6
 7 fileName = 'transimpedanceCompensated'
 8 prj = initProject(fileName)
 9 i1 = instruction()
10 i1.setCircuit(fileName + '.cir')
11 htmlPage('Phantom zero compensation')
12 i1.setSource('I1')
13 i1.setDetector('V_2')
14 i1.setLGref('E1')
15 i1.setSimType('numeric')
16 i1.setGainType('loopgain')
17 i1.setDataType('pz')
18 result = i1.execute()
19 # Display the DC value and poles and zeros of the loop gain
20 listPZ(result)

                               The results below will be shown in the Python command window (instruc-
                            tion in line 20):

1 DC value of loopgain: -9.73e+5

2

3 Poles of loopgain:

4

5 n Real part [Hz] Imag part [Hz] Frequency [Hz]         Q [-]

6 -- -------------- -------------- -------------- --------

70                          -1.60e+1  0.00e+00  1.60e+1

81                          -9.64e+4  0.00e+00  9.64e+4

9

10 Found no zeros.

       This data will be used to calculate the value of the compensation capacitance.

    Expression (12.22) is used to calculate Cphz. Lines 21 to 34 perform this calcula-
    tion and display the value of Cphz in the Python command window:

21 polesLG = result.poles
22 # Extract data for compensation
23 p_1 = polesLG[0]/2/sp.pi
24 p_2 = polesLG[1]/2/sp.pi
25 L_0 = result.DCvalue
26 # Calculate achievable bandwidth
27 Bw = sp.sqrt(sp.Abs((1-L_0)*p_1*p_2))
28 R_f = i1.getParValue('R_f')
29 # Calculate compensation capacitance
30 C_phz = sp.N((sp.sqrt(2)*Bw+p_1+p_2)/R_f/Bw**2/2/sp.pi)
31 # Pass the value to the circuit
32 i1.defPar('C_phz', C_phz)
33 # Print the value of C_phz
34 print('C_phz = {:9.2e}F\n'.format(C_phz))

       The output shows:

12 C_phz = 1.73e-12F

                            Lines 35-37 of the script display the data of the loop gain after compensation:
                                                                       12.2. PHANTOM ZERO COMPENSATION 411

35 # Display the DC value and poles and zeros of the loop gain
36 LGpz = i1.execute()
37 listPZ(LGpz)

       The output shows a third pole and one zero added to the loop gain. The zero
    is the intended phantom zero and the third pole arises because the compensation
    capacitor adds one independent capacitor voltage to the network.

14 DC value of loopgain: -9.73e+5

15

16 Poles of loopgain:

17

18 n Real part [Hz] Imag part [Hz] Frequency [Hz]          Q [-]

19 -- -------------- -------------- -------------- --------

20 0  -1.60e+1         0.00e+00                  1.60e+1

21 1  -8.72e+4         0.00e+00                  8.72e+4

22 2  -1.89e+9         0.00e+00                  1.89e+9

23

24 Zeros of loopgain:

25

26 n Real part [Hz] Imag part [Hz] Frequency [Hz]          Q [-]

27 -- -------------- -------------- -------------- --------

28 0  -9.17e+5         0.00e+00                  9.17e+5

       The location of the third pole can be found from network inspection.9 It can     9 Please study section 18.5.3 if you are not
                                                                                        familiar with the estimation of poles in
    be calculated from the time constant constituted by Ro in parallel with the series  networks.
    connection of Cphz and the parallel connection of Cs, Cd and Cc/2:

      p3  -            Cphz    +   Cs  +  Cd  +  1 Cc     = -1.85GHz.  (12.70)

                                                 2

                       2 Ro Cphz   Cs   +  Cd  +  1 Cc

                                                  2

       Lines 38-41 of the script display the properties of the gain in the Python
    command window:

44 # Display the DC value and poles and zeros of the gain
45 i1.setGainType('gain')
46 Gpz = i1.execute()
47 listPZ(Gpz)

      The result shows three poles and two zeros:

30 DC value of gain: -1.00e+5

31

32 Poles of gain:

33

34 n Real part [Hz] Imag part [Hz] Frequency [Hz]          Q [-]

35 -- -------------- -------------- -------------- --------

36 0  -7.84e+5         -8.63e+5                  1.17e+6 7.43e-1

37 1  -7.84e+5                 8.63e+5           1.17e+6 7.43e-1

38 2  -1.89e+9         0.00e+00                  1.89e+9

39

40 Zeros of gain:

41

42 n Real part [Hz] Imag part [Hz] Frequency [Hz]          Q [-]

43 -- -------------- -------------- -------------- --------

44 0  1.63e+8          0.00e+00                  1.63e+8

45 1  -1.64e+8         0.00e+00                  1.64e+8

       The three poles are as expected: two dominant poles in approximate MFM po-
   sitions and the third non-dominant pole. The two zeros are caused by the nonzero
   direct transfer. This can be seen from the magnitude plots of the transfer func-
   tions of the asymptotic gain model (see Figure 12.26). At high frequencies the
   gain curve becomes equal to that of the direct transfer. This transition causes the
   two zeros in the gain: the order decreases from 2 to 0.

   In the above example, we demonstrated the compensation of the tran-
simpedance amplifier with the aid of a phantom zero in the feedback net-
work. This phantom zero is very effective: it introduces a new pole which
is not at all dominant. This is because before compensation, the feedback
412 FREQUENCY COMPENSATION
                                                  resistor introduced a large attenuation in the loop gain at the frequency of
                                                  the phantom zero.

Figure 12.26: Magnitude and phase plots
of the transfer functions of the asymptotic
gain model for the transimpedance ampli-
fier with phantom zero compensation.

                                        12.2.6 Phantom zeros at source and load

                                                  A pole in the asymptotic gain can also be established by inserting a low-
                                                  pass transfer between the source and the input of the amplifier or between
                                                  the output of the amplifier and the load. The source impedance or the load
                                                  impedance can be included in this low-pass filter. An effective phantom zero
                                                  is then established if this filter also establishes a zero in the loop gain without
                                                  causing a significant change of the loop gain poles product.
                                                  Phantom zeros at source or load with shunt feedback
                                                  In the case of parallel feedback at an amplifier port, hence with voltage sens-
                                                  ing at the output port or with current comparison at the input port (see Figure
                                                  12.27), a phantom zero can be implemented by inserting an impedance Zse in
                                                  series with the source or load.

                                                      The character of Zse depends on the behavior of the source or load impedance
                                                  at the frequency of the phantom zero:
                  active part   active part          12.2. PHANTOM ZERO COMPENSATION 413
                  of amplifier  of amplifier
                                                                             Figure 12.27: Implementation of phantom
                  +         +   +                 +                          zeros for shunt feedback
                                                                +
                  --            --                             -

                  +         +   +                 +

                  --            --

A phantom-zero    feedback      B feedback           phantom-zero
                  network                            at load
       at source                         network

1. If, at that frequency, the source or load impedance character is inductive,
   there is no possible implementation for Zse

2. If, at that frequency, the source or load impedance character is resistive,
   Zse must be inductive

3. If, at that frequency, the source or load impedance character is capacitive,
   Zse must be resistive. Two real or complex conjugated phantom zeros can
   be implemented by having both an inductive and a resistive part for Zse.

   The pole in the asymptotic gain causes an effective phantom zero if, at
the frequency of this pole, the source impedance or load impedance causes
a significant attenuation in the loop gain. In such cases, the insertion of Zse
reduces this attenuation for frequencies above the frequency of this pole. The
phantom zero frequency is the complex frequency at which Zse + Zs = 0 or
Zse + Z = 0. In fact, at this frequency, the series connection of Zse and Zs
or the series connection of Zse and Z introduces a short in parallel with the
signal path of the loop gain.

Phantom zeros at source or load with series feedback

In the case of series feedback at the amplifier port, hence with current sens-
ing at the output port or voltage comparison at the input port (as shown in
Figure 12.28), the phantom zero can be implemented with an impedance Yp
in parallel with the source or load.

                  active part   active part                                      Figure 12.28: Phantom zero implementa-
                  of amplifier  of amplifier                                     tion at series feedback.

                  +         +   +                 +

                  --            --

+

                  +         +   +                 +

-

                  --            --

A phantom-zero    feedback      B feedback           phantom-zero
                  network                            at load
       at source                         network

   The character of Yp depends on the behavior of the source or load impedance
at the frequency where the phantom zero must be effective:

1. If, at that frequency, the source or load impedance character is capacitive,
   there is no possible implementation for Yp

2. If, at that frequency, the source or load impedance character is resistive,
   Yp must be capacitive
414 FREQUENCY COMPENSATION

                                                  3. If, at that frequency, the source or load impedance character is inductive,
                                                      Yp must be resistive. Two real or complex conjugated phantom zeros can
                                                      be implemented by having both an inductive and a capacitive part for Yp.

                                                      The pole in the asymptotic gain causes an effective phantom zero if, at
                                                  the frequency of this pole, the source impedance or load impedance causes
                                                  a significant attenuation in the loop gain. In such cases, the insertion of Yp
                                                  reduces this attenuation for frequencies above the frequency of this pole. The
                                                phantom zero frequency is the complex frequency at which Yp + 1/Zs = 0
                                                or Yp + 1/Z = 0. In fact, at this frequency, the parallel connection of Yp and
                                                  Zs or the series connection of Yp and Z introduces an open circuit in series
                                                  with the signal path of the loop gain.

                                            Effectiveness of phantom zeros at source or load

                                            Creation of a zero in the loop with the aid of passive networks implies that
                                            an attenuation in the loop gain is reduced for frequencies above that of the
                                            zero. This has already been elucidated in Figure 12.24.

                                               Hence, if the zero is realized by inserting a resistive element, it will shift
                                            an existing pole of the loop gain towards a higher frequency at which the
                                            reduction of the attenuation, as it was caused by the zero, stops.

                                               If the zero is realized through insertion of an inductive or capacitive el-
                                            ement, a pole may be added to the loop transfer function at a frequency at
                                            which the reduction of the attenuation, as it was caused by the zero, stops.

                                               If the new pole is too close to the phantom zero, the phantom zero is called
                                            ineffective.

                                               In the following example, we will try to compensate the transimpedance
                                            amplifier from example 11.3 with the aid of a phantom zero at the source.
                                            We will show that this phantom zero implementation is less effective than
                                            the one from the previous example.

                                               Example 12.9

                                                   Figure 12.29 shows the small-signal equivalent diagram of the transimpedance
                                               amplifier from example 11.3 with phantom zero compensation at the source. The
                                               phantom zero has been implemented according to the concept from Figure 12.27A.
                                               Since the source is capacitive, a resistor has been inserted between the source and
                                               the input of the transimpedance amplifier.

Figure 12.29: Circuit diagram of the tran-                                R1
simpedance amplifier from example 7.11.3
with phantom zero compensation at the                    R2
source.
                                                    (1)          (3)                 (2)

                                                                          -+                 +

                                            I1  C1           C2       C3            R2

                                                                          +-                -

                                                                          E1
                                                                          model EZ

                                                  Below is the SLiCAP netlist of the circuit in which the initial value of the
                                              compensation capacitance Cphz has been set to zero:

                                            1 transimpedanceCompensatedSource
                                            2 * file: transimpedanceCompensatedSource.cir
                                            3 * SLiCAP circuit file
                                            4 I1 0 1 0
                                            5 C1 1 0 {C_s}
                                            6 C2 3 0 {C_d}
                                            7 C3 3 0 {C_c/2}
                                            8 R1 3 2 {R_f}
                                                            12.2. PHANTOM ZERO COMPENSATION 415

 9 R2 2 0 {R_ell}
10 R3 1 3 r value={R_phz}
11 E1 2 0 0 3 EZ value={A_0/(1+s*A_0/2/pi/G_B)} zo={R_o}
12 .param C_s=5p R_f=100k R_ell=2k C_d=8p C_c=7p A_0=1M R_o=55 G_B=16M R_phz=0

13 .end

       Lines 1-20 of the script below list the poles and zeros of the transfer in the

    Python command window.

 1 #!/usr/bin/env python3
 2 # -*- coding: utf-8 -*-
 3 # File: transimpedanceCompensatedSource.py
 4
 5 from SLiCAP import *
 6
 7 fileName = 'transimpedanceCompensatedSource'
 8 prj = initProject(fileName)
 9 i1 = instruction()
10 i1.setCircuit(fileName + '.cir')
11 htmlPage('Phantom zero compensation')
12 i1.setSource('I1')
13 i1.setDetector('V_2')
14 i1.setLGref('E1')
15 i1.setSimType('numeric')
16 i1.setGainType('loopgain')
17 i1.setDataType('pz')
18 result = i1.execute()
19 # Display the DC value and poles and zeros of the loop gain
20 listPZ(result)

       Expression (12.22) is used to calculate Rphz. Lines 21 to 34 perform this
    calculation and display the value of Rphz in the Python command window:

21 polesLG = result.poles
22 # Extract data for compensation
23 p_1 = polesLG[0]/2/sp.pi
24 p_2 = polesLG[1]/2/sp.pi
25 L_0 = result.DCvalue
26 # Calculate achievable bandwidth
27 Bw = sp.sqrt(sp.Abs((1-L_0)*p_1*p_2))
28 C_s = i1.getParValue('C_s')
29 # Calculate compensation resistance
30 R_phz = sp.N((sp.sqrt(2)*Bw+p_1+p_2)/C_s/Bw**2/2/sp.pi)
31 # Pass the value to the circuit
32 i1.defPar('R_phz', R_phz)
33 # Print the value of R_phz
34 print('R_phz = {:9.2e} Ohm\n'.format(R_phz))

    The output shows:

1 DC value of loopgain: -9.73e+5

2

3 Poles of loopgain:

4

5 n Real part [Hz] Imag part [Hz] Frequency [Hz]  Q [-]

6 -- -------------- -------------- -------------- --------

70  -1.60e+1            0.00e+00  1.60e+1

81  -9.64e+4            0.00e+00  9.64e+4

9

10 Found no zeros.

11

12 R_phz = 3.47e+4 Ohm

       Lines 35-37 of the script display the data of the loop gain after compensation:

35 # Display the DC value and poles and zeros of the loop gain
36 LGpz = i1.execute()
37 listPZ(LGpz)

       The output shows a third pole and one zero added to the loop gain. The zero
    is the intended phantom zero and the third pole arises because the compensation
    resistor adds one independent capacitor voltage to the network. It removes the
    loop of the two capacitors from the circuit.

14 DC value of loopgain: -9.73e+5
416 FREQUENCY COMPENSATION

                                               15

                                               16 Poles of loopgain:

                                               17

                                               18 n Real part [Hz] Imag part [Hz] Frequency [Hz]     Q [-]

                                               19 -- -------------- -------------- -------------- --------

                                               20 0  -1.60e+1         0.00e+00              1.60e+1

                                               21 1  -9.32e+4         0.00e+00              9.32e+4

                                               22 2  -1.36e+6         0.00e+00              1.36e+6

                                               23

                                               24 Zeros of loopgain:

                                               25

                                               26 n Real part [Hz] Imag part [Hz] Frequency [Hz]     Q [-]

                                               27 -- -------------- -------------- -------------- --------

                                               28 0  -9.17e+5         0.00e+00              9.17e+5

10 Please study section 18.5.3 if you are not         The location of the third pole can be found from network inspection.10 It can be
familiar with the estimation of poles in
networks.                                          calculated from the time constant constituted by Rphz in parallel with the series
                                                   connection of Cs and the parallel connection of Cd and Cc/2:

                                                     p3  -            Cs  +  Cd   +   1 Cc     = -1.32MHz.  (12.71)

                                                                                      2

                                                                      2 R phz Cs  Cd  +  1 Cc

                                                                                         2

                                                     This is a dominant pole that limits the effectiveness of the phantom zero.

Figure 12.30: Magnitude plots of the
transfer functions of the asymptotic gain
model for the transimpedance amplifier
with phantom zero compensation at the
source.

                                                     Lines 38-41 of the script display the properties of the gain in the python
                                                                  12.2. PHANTOM ZERO COMPENSATION 417

    command window:

38 # Display the DC value and poles and zeros of the gain
39 i1.setGainType('gain')
40 Gpz = i1.execute()
41 listPZ(Gpz)

      The result shows three poles and one zero:

30 DC value of gain: -1.00e+5

31

32 Poles of gain:

33

34 n Real part [Hz] Imag part [Hz] Frequency [Hz]          Q [-]

35 -- -------------- -------------- -------------- --------

36 0  -1.06e+6     0.00e+00             1.06e+6

37 1  -1.97e+5     -1.35e+6             1.36e+6 3.46e+0

38 2  -1.97e+5                 1.35e+6  1.36e+6 3.46e+0

39

40 Zeros of gain:

41

42 n Real part [Hz] Imag part [Hz] Frequency [Hz]          Q [-]

43 -- -------------- -------------- -------------- --------

44 0  2.91e+10     0.00e+00             2.91e+10

       The three poles are as expected: three dominant poles that are not in MFM                      +
   positions due to the ineffective compensation. The zero is caused by the nonzero     Reference
   direct transfer. This can be seen from the Bode plots of the transfer functions
   of the asymptotic gain model (see Figure 12.30). At very high frequencies (not       voltage -
   visible on the plot), the gain curve becomes equal to that of the direct transfer.
   This transition causes the zero in the gain: the order decreases from 3 to 2.        Analog +            ADC
                                                                                        input
   In the previous example, we demonstrated the compensation of the tran-               voltage -                       Digital
simpedance amplifier with the aid of a phantom zero at the source. In this                                              output
case, this compensation is not very effective: the implementation of the phan-
tom zero introduces a new dominant pole. MFM compensation with Cphz in                  Figure 12.31: ADC with single-ended signal
parallel with R f as discussed in the previous example turns out to be far              input and single-ended external reference
more effective.                                                                         input.

   In the following example, we will demonstrate the frequency compensa-                -                +
tion of a low-noise voltage reference that can be used as reference for an AD           +                -
converter.
                                                                                        Analog +            ADC
   Many AD converters with an unbuffered reference input draw a high-                   input
frequency switching current from their reference. In order to maintain a low-           voltage -                       Digital
ripple reference voltage under these conditions, a decoupling capacitor needs                                           output
to be placed between the reference voltage input of the ADC and ground.
                                                                                        Figure 12.32: Reference voltage with noise
   Example 12.10                                                                        filter and unity-gain buffer.

       In this example, we will study the frequency compensation of a voltage driver
   of a capacitive load. This driver is intended to drive the reference input of an AD
   converter with unbuffered reference input that has been decoupled with a large
   capacitance Cre f . This situation is illustrated in Figure 12.31.

       We will assume that a DC reference for the ADC with the correct DC voltage
   is available, but the associated noise voltage of this reference is too large. The
   noise performance can then be improved by placing a low-pass filter cascaded with
   a unity-gain voltage buffer between the voltage reference and the ADC reference
   input. This is shown in Figure 12.32. In this example, we will only focus on the
   frequency compensation of the voltage buffer, and particularly on phantom zero
   compensation. We will simply assume Cre f = 10µF, Cf = 1µF, R f = 15k and
   a voltage buffer that has been designed with an AD8610 operational amplifier. This
   operational amplifier has a resistive output impedance.

       SLiCAP has two models for this operational amplifier in the SLiCAP.lib file:

 7 .model AD8610 OV
 8 + cd = 15p ; differential-mode input capacitance
 9 + cc = 8p ; common-mode input capacitance
418 FREQUENCY COMPENSATION

                                                               10 + av = {300k*(1-s/2/pi/120M)/(1+s*300k/2/pi/20M)/(1+s/2/pi/120M)} ; voltage

                                                                                          gain

                                                               11 + zo = 20 ; output impedance
                                                               12
                                                               13 .model AD8610_A0 OV
                                                               14 + cd = 15p ; differential-mode input capacitance
                                                               15 + cc = 8p ; common-mode input capacitance
                                                               16 + av = {A_0*(1-s/2/pi/120M)/(1+s*300k/2/pi/20M)/(1+s/2/pi/120M)} ; voltage

                                                                                          gain

                                                               17 + zo = 20 ; output impedance

                                                          The model AD8610_A0 can be used for sweeping the DC gain A0 of this opamp
                                                      to generate root-locus plots. The model AD8610 does not contain symbolic param-
                                                      eters. Figure 12.33 shows the complete small-signal circuit of the buffer.

Figure 12.33: Small-signal equivalent circuit
of the voltage reference circuit.

                                                        +                        ++

                                                        -                        --

11 The voltage gain Av of the operational            The gain of the AD8610 has been modeled with the aid of an expression for Av.
amplifier has been selected as loop gain          It comprises a DC gain A0 = 300 × 103, two poles and one zero. The output
reference variable.                               impedance Zo equals 20.

                                                     The poles and zeros of the loop gain are listed below.11

                                              1 Poles of loopgain:

                                              2

                                              3 n Real part [Hz] Imag part [Hz] Frequency [Hz]       Q [-]

                                              4 -- -------------- -------------- -------------- --------

                                              50        -1.06e+1       0.00e+00             1.06e+1

                                              61        -6.67e+1       0.00e+00             6.67e+1

                                              72        -7.96e+2       0.00e+00             7.96e+2

                                              83        -1.20e+8       0.00e+00             1.20e+8

12 The poles are obtained with the data type         The loop gain has four poles: two in Av and two from independent capacitor
set to 'poles'.                                   voltages.12 The pole positions can be estimated with the aid of the time constant
                                                  matrix, as explained in Chapter 18.5.3.

                                                    # time constant / transfer value [Hz]

                                                    p1 2-11 , 1  C f R f         -10.61
                                                    p2 pole in Av
                                                         -1                      -66
                                                    p3        3        Cre f Zo  -796
                                                        23 ,                     -120 · 106
                                                    p4 pole in Av

13 The zeros are obtained with the data type        The estimated values match those obtained from the SLiCAP calculations.
set to 'zeros'.                                     The loop gain has two zeros:13

                                              10 Zeros of loopgain:

                                              11

                                              12 n Real part [Hz] Imag part [Hz] Frequency [Hz]      Q [-]

                                              13 -- -------------- -------------- -------------- --------

                                              14 0      -1.06e+1       0.00e+00             1.06e+1

                                              15 1      1.20e+8        0.00e+00             1.20e+8

                                                    The zeros can be estimated as follows:

                                                    # time constant network / transfer value [Hz]

                                                    z1 zero in Av                           120 · 106
                                                    z2 2-12 , 2  C f R f                    -10.61
                                                                                              12.2. PHANTOM ZERO COMPENSATION 419

       The estimated values comply with those obtained by SLiCAP.

       Within the displayed accuracy, z2 cancels p1. With the SLiCAP data type set
    to 'pz', p1 and z2 are no longer shown, but the DC loop gain will be shown:

17 DC value of loopgain: -3.00e+5

18

19 Poles of loopgain:

20

21 n Real part [Hz] Imag part [Hz] Frequency [Hz]   Q [-]

22 -- -------------- -------------- -------------- --------

23 0   -6.67e+1        0.00e+00    6.67e+1

24 1   -7.96e+2        0.00e+00    7.96e+2

25 2   -1.20e+8        0.00e+00    1.20e+8

26

27 Zeros of loopgain:

28

29 n Real part [Hz] Imag part [Hz] Frequency [Hz]   Q [-]

30 -- -------------- -------------- -------------- --------

31 0   1.20e+8         0.00e+00    1.20e+8

       The servo bandwidth can be calculated from p1 and p2 and the DC value of the
    loop gain. It can also be obtained from SLiCAP using the findServoBandwidth()
    function. Both methods show that a second order MFM low-pass cut-off of the
    servo function can be obtained at f = 125.5kHz.

       The poles of the gain are in the left half plane, but the quality factor is very
    high and frequency compensation is required.

33 Poles of gain:

34

35 n Real part [Hz] Imag part [Hz] Frequency [Hz]   Q [-]

36 -- -------------- -------------- -------------- --------

37 0   -1.06e+1        0.00e+00    1.06e+1

38 1   -2.99e+2        -1.26e+5    1.26e+5 2.11e+2

39 2   -2.99e+2        1.26e+5     1.26e+5 2.11e+2

40 3   -1.20e+8        0.00e+00    1.20e+8

       Since the two dominant poles are relatively close to the origin, the frequency
    z of the phantom zero can be approximated as:

                       z = -2 f 1 2.                                                          (12.72)
                                       2

       A negative real phantom zero can be implemented at the load. To this end,
    we need to insert a resistor between the output of the amplifier and the load. Its
    resistance Rphz should equal

                   Rphz = 1   1                     = 0.18.                                   (12.73)
                       -zCre f     2 fCre f

       Figure 12.34A shows the compensated driver.

                          +                                                                            Figure 12.34:
                                                                                           +               A: compensated voltage reference

                       --                                                                              circuit
                                                                                                           B: modified compensation; the ESR of
                                  +
       +                                                                                               Cre f is used for compensation. The zero is
                                                                                                       not longer a phantom zero: it also appears
                               -                                                                       in the gain.
       -

    A                              B

      The dominant poles of the compensated amplifier are in MFM positions while
  the non-dominant poles all have negative real values. Please notice that the in-
  sertion of the phantom zero resistor created a new independent capacitor voltage,
  and thus a new pole:

1 DC value of gain: 1.00e+0
420 FREQUENCY COMPENSATION

                                              2

                                              3 Poles of gain:

                                              4

                                              5 n Real part [Hz] Imag part [Hz] Frequency [Hz]                       Q [-]

                                              6 -- -------------- -------------- -------------- --------

                                              70             -1.06e+1             0.00e+00          1.06e+1

                                              81             -8.98e+4             -8.81e+4          1.26e+5 7.01e-1

                                              92             -8.98e+4             8.81e+4           1.26e+5 7.01e-1

                                              10 3           -1.20e+8             0.00e+00          1.20e+8

                                              11 4           -4.70e+10            0.00e+00          4.70e+10

                                              12

                                              13 Zeros of gain:

                                              14

                                              15 n Real part [Hz] Imag part [Hz] Frequency [Hz]                      Q [-]

                                              16 -- -------------- -------------- -------------- --------

                                              17 0           -8.84e+4             0.00e+00          8.84e+4

                                              18 1           4.16e+7              -6.74e+7          7.92e+7 9.53e-1

                                              19 2           4.16e+7              6.74e+7           7.92e+7 9.53e-1

                                              20 3           -2.03e+8             0.00e+00          2.03e+8

14 ESR = Equivalent Series Resistance.               If the ADC reference takes a DC current from this buffer, the phantom zero

                                                  resistor shown in Figure 12.34A may introduce a DC inaccuracy.

                                                     This DC error will not occur if the reference output is taken directly at the

                                                  output of the operational amplifier, as it is shown in Figure 12.34B. In this cir-

                                                  cuit, the resistance Rphz introduces a zero in the loop gain that is no longer a
                                                  phantom zero. Hence, it also appears in the transfer from Vre f to the output volt-
                                                  age. In many cases, this minor penalty on the noise transfer is justified by the

                                                  improvement of the DC transfer. As a matter of fact, in this way, Rphz can often
                                                  be implemented using the ESR of the reference capacitor.14 Figure 12.35 shows

                                                  the pole positions of the servo function as a function of Rphz. Please notice that
                                                  the pole at -10.61Hz is canceled by a zero. The zeros have not been shown in this

                                                  plot.

Figure 12.35: Pole positions of the servo     12.2.7 Active phantom zeros
function as a function of Rphz.
                                              Until now, we have studied implementation methods for phantom zeros
Figure 12.36:                                 based on modifications of existing passive attenuators in the loop transfer.
    A: Negative feedback first order differ-  However, the most straightforward implementation of phantom zeros, based
                                              on the concepts discussed in sections 12.2.1 through 12.2.3, uses differentia-
entiator concept.                             tors in the feedback networks. Unfortunately, due to the fundamental limi-
    B: implementation with an operational     tation of speed, practical implementations of differentiators also add poles,
                                              thereby reducing the effectiveness of the frequency compensation. Only in
amplifier.                                    cases in which these poles can be kept away from the dominant group might
                                              active phantom zero compensation be feasible. In this section, we will study
                                              frequency compensation with the aid of active phantom zeros. We will con-
                                              fine ourselves solely to compensation with a first order active differentiator.

                                                     +                     +                                                   +

                                                     -                     -                                      +         +  -
                                                                                                    +

                                                                                                                 -
                                                                                                    -

                                                                                                                            -

                                                  A                                         B

                                                  Figure 12.36A shows the concept of a first order voltage differentiator cir-
                                                                                                                 -1.
                                              cuit.     The  circuit  has  unity  DC  gain  and  a  zero:  z  =         An  implementation
                                                                                                                    RC
                                              with the aid of an operational amplifier is shown in Figure 12.36B.

                                                  In the following example, we will apply this circuit for frequency compen-
                                                      12.2. PHANTOM ZERO COMPENSATION 421

sation of the ADC reference circuit from example 12.10.

   Example 12.11

       The circuit from Figure 12.34A has a phantom zero realized with a resistor
   Rphz between the output of the amplifier and the load. A disadvantage of this im-
   plementation is the increase of the low-frequency output resistance of the reference
   buffer to Rphz. This reduces the DC accuracy of the reference under nonzero DC
   load conditions. One possible solution to this is to use the arrangement shown in
   Figure 12.34B. This solution, however, has its high-frequency output impedance
   increased to Rphz. A solution that has both a low DC output resistance and a
   low high-frequency output impedance can be obtained with active phantom zero
   compensation.

                                                                                         Figure 12.37: Magnitude plots of the
                                                                                         output impedance for three different
                                                                                         compensation methods:

                                                                                             Red: Passive compensation according to
                                                                                         Figure 12.34A

                                                                                             Blue: Passive phantom zero compensa-
                                                                                         tion according to Figure 12.34B

                                                                                             Green: Active phantom zero compensa-
                                                                                         tion according to Figure 12.38.

Figure 12.38 shows the circuit of the reference buffer with active phantom zero                                 -           AD8610
                                                                                                                    +
compensation. The feedback network of this circuit consists of the differentia-                                      +
                                                                                         -                           -
tor with unity DC gain from Figure 12.36B. Rphz in Figure 12.38 implements +             +
a phantom zero in the differentiator. Figure 12.37 shows the magnitude char-                                                     AD8610

acteristic of the output impedances of the three reference buffers. The following        -

values have been used for the circuit from Figure 12.38: Rd = 1k, Cd = 2.7nF,

Rphz = 82.

12.2.8 Interaction with other performance aspects

The realization of passive phantom zeros requires insertion of impedances in             Figure 12.38: ADC reference buffer with
series or in parallel with the signal path. The general design rule was to avoid         active phantom zero compensation.
this, which may lead to the conclusion that passive phantom zeros may seri-
ously deteriorate other performance aspects, such as the noise performance,
the power efficiency and the linearity. Moreover, insertion of impedances into
the signal path may also result in a reduction of the product of the midband
loop gain and the dominant poles. Fortunately, implementation of phantom
zeros seldom causes significant deterioration of performance aspects. This
can be understood as follows:

1. Phantom zeros are usually located at the edge of the transmission band

of the amplifier. We have seen that second order systems and third or-

der systems that have all poles in the origin require the magnitude of the
frequency  of  their  phantom  zeros  at  1  2n. Below this frequency, the
                                          2
impedance inserted into the signal path for the realization of the phantom

zeros plays no role compared to existing impedances.
422 FREQUENCY COMPENSATION

15 IMFDR = InterModulation-Free Dynamic  2. If phantom zeros are implemented at the source, they constitute a low-
Range.                                      pass filter between the signal source and the amplifier. Such a low-pass
                                            filter is generally beneficial to the IMFDR since it suppresses out-of-band
                                            interference signals.15

                                         3. Phantom zeros increase the loop gain above the frequency of the zero.
                                            This reduces the nonlinearity of the amplifier at those frequencies.

                                         12.2.9 Bandwidth limitation with phantom zeros

                                         In the previous sections, we discussed the frequency compensation of ampli-
                                         fiers with the aid of phantom zeros. With phantom zero compensation, we
                                         are able to obtain a well-defined frequency response of a feedback amplifier
                                         without paying a significant penalty on other performance aspects.

                                            We will now discuss the application of phantom zeros for limitation of the
                                         bandwidth of the source-load transfer. Such bandwidth limitation may be
                                         desired if the bandwidth of the servo function is much larger than required.
                                         This can be the case if a low distortion drives the specification for a high
                                         value of the midband loop gain.

                                            Bandwidth limitation with phantom zeros occurs in negative feedback am-
                                         plifiers with phantom zeros if the loop gain at the frequency of the phantom
                                         zeros is much larger than unity.

                                         The method

                                         A phantom zero is a pole in the asymptotic gain that coincides with a zero
                                         in the loop gain. As a consequence, a phantom zero cannot be observed in
                                         the source-load transfer. However, the root locus technique shows us that if,
                                         at the frequency of the zero, the magnitude of the loop gain is much larger
                                         than unity, one of the poles of the servo function will move towards it. This
                                         pole is visible in the source-load transfer and limits the bandwidth of the
                                         source-load transfer to a frequency that approximates that of the zero.

                                            We will elucidate this with the aid of an example in which we will limit
                                         the bandwidth of the transimpedance amplifier from example 12.8 with the
                                         aid of a phantom zero to 200kHz.

                                            Example 12.12

                                                In example 12.8, we demonstrated the compensation of a transimpedance am-
                                            plifier with the aid of a phantom zero. The phantom zero has been implemented
                                            with the aid of a capacitance Cphz in parallel with the feedback resistor (see Figure
                                            12.25). We will now use Cphz to limit the bandwidth B of the transimpedance
                                            amplifier to 200kHz. To do so, we need to increase its value to 2B1Rf = 7.96pF.

                                                The results of the pole-zero analysis of the transfer functions of the asymptotic
                                            gain model are shown below:

                                         47 === Bandwidth limitation to 200kHz ===

                                         48 DC value of asymptotic: -1.00e+5

                                         49

                                         50 Poles of asymptotic:

                                         51

                                         52 n Real part [Hz] Imag part [Hz] Frequency [Hz]   Q [-]

                                         53 -- -------------- -------------- -------------- --------

                                         54 0  -2.00e+5           0.00e+00          2.00e+5

                                         55

                                         56 Found no zeros.

                                         57

                                         58 DC value of loopgain: -9.73e+5

                                         59

                                         60 Poles of loopgain:

                                         61

                                         62 n Real part [Hz] Imag part [Hz] Frequency [Hz]   Q [-]

                                         63 -- -------------- -------------- -------------- --------

                                         64 0  -1.60e+1           0.00e+00          1.60e+1
                                                              12.2. PHANTOM ZERO COMPENSATION 423

65 1   -6.51e+4        0.00e+00  6.51e+4

66 2   -5.54e+8        0.00e+00  5.54e+8

67

68 Zeros of loopgain:

69

70 n Real part [Hz] Imag part [Hz] Frequency [Hz]   Q [-]

71 -- -------------- -------------- -------------- --------

72 0   -2.00e+5        0.00e+00  2.00e+5

73

74 DC value of servo: 1.00e+0

75

76 Poles of servo:

77

78 n Real part [Hz] Imag part [Hz] Frequency [Hz]   Q [-]

79 -- -------------- -------------- -------------- --------

80 0   -2.06e+5        0.00e+00  2.06e+5

81 1   -4.97e+6        0.00e+00  4.97e+6

82 2   -5.49e+8        0.00e+00  5.49e+8

83

84 Zeros of servo:

85

86 n Real part [Hz] Imag part [Hz] Frequency [Hz]   Q [-]

87 -- -------------- -------------- -------------- --------

88 0   -2.00e+5        0.00e+00  2.00e+5

89

90 DC value of gain: -1.00e+5

91

92 Poles of gain:

93

94 n Real part [Hz] Imag part [Hz] Frequency [Hz]   Q [-]

95 -- -------------- -------------- -------------- --------

96 0   -2.06e+5        0.00e+00  2.06e+5

97 1   -4.97e+6        0.00e+00  4.97e+6

98 2   -5.49e+8        0.00e+00  5.49e+8

99

100 Zeros of gain:

101

102 n Real part [Hz] Imag part [Hz] Frequency [Hz]  Q [-]

103 -- -------------- -------------- -------------- --------

104 0  7.62e+7         0.00e+00  7.62e+7

105 1  -7.64e+7        0.00e+00  7.64e+7

       Lines 48-56 show the data of the asymptotic gain. As expected, the asymptotic      Figure 12.39: Root locus of the tran-
   gain has a DC value of 105, a pole at -200kHz, and no zeros.                           simpedance amplifier with phantom
                                                                                          zero bandwidth limitation.
       The results for the loop gain are listed in lines 58-72. The loop gain has a zero
   at -200kHz; this is the phantom zero, and three poles, of which p1 and p2 are
   dominant.

       Lines 74-88 show the results for the servo function. The servo function has the
   zero of the loop gain and three poles that can be obtained from the poles of the loop
   gain using the root locus method. The frequency of p1 approximately equals the
   frequency of the zero in the loop gain. The root locus (see Figure 12.39) shows
   it approaches the zero from the left side. Since the frequency of p1 approximately
   equals that of z1, the servo function can be approximated as a first order low-pass
   function with a -3dB frequency of 4.9706MHz. This is about five times larger
   than that of the transimpedance amplifier from example 12.8.

       Lines 90 to 105 list the data of the gain. The phantom zero at -200kHz is not
   visible and the dominant pole equals p1 of the servo function. This pole limits the
   bandwidth of the transimpedance amplifier.

       The magnitude characteristics of the transfer functions of the asymptotic gain
   model of the compensated amplifier are shown in Figure 12.40. Comparing them
   with those from Figure 12.26, clearly shows the reduced bandwidth of the gain
   is reduced, and the increased bandwidth of the servo. This is the result of the
   insertion of a zero in the loop gain at a frequency at which the magnitude of the
   loop gain is much larger than unity.

   This example shows that bandwidth limitation with a phantom zero is a
powerful method. Above the frequency of the phantom zero the loop gain
increases, which is beneficial to the linearity. If the reduction of the weak
nonlinearity (intermodulation distortion) is of utmost importance, one might
424 FREQUENCY COMPENSATION
                                                  consider bandwidth limitation with a phantom zero at the source. It reduces
                                                  the influence of out-of-band interference on the intermodulation distortion in
                                                  two ways:
                                                  1. The pole in the asymptotic gain reduces the amplitude of high-frequency
                                                      interference
                                                  2. The zero in the loop gain reduces the high-frequency intermodulation
                                                      distortion.
                                                      A disadvantage of limiting the bandwidth with a phantom zero is the
                                                  increased influence of non-dominant poles. This is an inevitable result of the
                                                  increase of the loop gain above the frequency of the phantom zero. If this
                                                  results in unacceptable peaking or instability, frequency compensation with
                                                  additional phantom zeros may be required.

Figure 12.40: Bode plots of the transfer
functions of the asymptotic gain model
of the transimpedance amplifier with
phantom zero bandwidth limitation.

                                 12.3 Pole-splitting

                                                  If phantom zero compensation is not possible, frequency compensation may
                                                  also be accomplished by changing the initial positions of the poles of the
                                                                                             12.3. POLE-SPLITTING 425

loop gain. A compensation technique based on this principle is the appli-
cation of local capacitive feedback around one or more gain stages in the
controller. With this technique, the distance between two poles can be in-
creased while their product remains virtually unaffected. This technique is
called pole-splitting. Pole-splitting reduces the controller gain in the frequency
range between the two poles. In fact, it trades controller gain with local loop
gain in the gain stages enclosed in the capacitive feedback loop. Reduction
of the controller gain may adversely affect the nonlinearity of the feedback
amplifier. Since phantom zero compensation increases the controller gain,
it is preferred over pole-splitting. Pole-splitting should only be applied if
phantom zero compensation is not feasible.

12.3.1 Pole-splitting in operational amplifier circuits

Figure 12.41A shows a gain stage that is part of a controller. This gain stage
consists of a single-pole operational amplifier driven from an RC network.

         (1)    (2)              (3)                (1)  (2)                    (3)          Figure 12.41:
                                                                                                 A: Controller gain stage with a single-
    +                   +   -           +      +                 +           -       +
                                                                                             pole operational amplifier
    -                  -                       -                -                                B: Gain stage with pole-splitting.

                            +           -                                    +       -

    A                                          B

    The two poles of this circuit can be estimated from network inspection:
             1              -1.
p1  =           and  p2  =       These  poles  are  the  solutions  of  the  characteristic
       - RaCa                  

equation.16 The characteristic equation can be calculated symbolically by                    16 The determinant of the MNA matrix.

SLiCAP. The netlist file of the circuit from Figure 12.41A has is below:

 1 "Pole splitting with opamps"

 2 * file: poleSplitOpamp.cir
 3 * SLiCAP netlist file
 4 V1 1 0 0
 5 R1 1 2 {R_a}
 6 C1 2 0 {C_a}
 7 E1 0 3 2 0 {A_0/(1+s*tau)}
 8 C2 2 3 {C_c}
 9 .param C_c=0

10 .end

   The script for calculating the poles (with Cc = 0) is:

 1 #!/usr/bin/env python3
 2 # -*- coding: utf-8 -*-
 3 # File: poleSplitOpAmp.py
 4
 5 from SLiCAP import *
 6
 7 fileName = 'poleSplitOpamp'
 8 prj = initProject(fileName)
 9 i1 = instruction()
10 i1.setCircuit(fileName + '.cir')
11 i1.setSimType('numeric') # This substitutes C_c=0 in the element expressions
12 i1.setDataType('poles')
13 i1.setGainType('gain')
14 i1.setDetector('V_3')
15 poles = i1.execute().poles
16 print("Poles:",poles)

  The result is shown in the Python console window:

1 Poles: [-1/tau, -1/(C_a*R_a)]

    This corresponds with the estimation above.
426 FREQUENCY COMPENSATION

                                                  After adding Cc to the circuit as shown in Figure 12.41B, the characteristic
                                               equation of the network changes to:

                                               1 + s (Ra (Ca + Cc (1 + A0)) + ) + Ra (Ca + Cc) s2 = 0.                 (12.74)

                                               Insertion of Cc did not change the order of the characteristic equation. This

                                               is because C2 (with capacitance Cc) is part of a loop of capacitors and voltage

                                               sources. Hence, it does not introduce a new independent capacitor voltage.
                                                                                                                            1
                                               Expression  (12.74)  shows  if  Cc    Ca  the  product  of  the  poles  (Ca +Cc )  does

                                               not change with Ca. However, if Cc (1 + A0)  Ca + , the magnitude of the

                                               sum of the poles increases considerably with Cc. This means that one of the

                                               poles must shift to a higher frequency while the other one moves to a lower

                                               frequency. This will be illustrated with a numeric example.

Figure 12.42: Pole-splitting in the gain       Example 12.13
stage from Figure 12.41. The pole with the
highest frequency moves away from the             We will plot the pole positions of the circuit from Figure 12.41B as a function
origin while increasing Cc                     of Cc. In this numerical example, we use: Ca = 100pF, Ra = 10k,  = 1ms
                                               and A0 = 105. Figure 12.42 shows the pole positions as a function of Cc. It
                                               can clearly be seen that the pole with the highest frequency moves to a higher
                                               frequency.

                                                  Figure 12.44 shows the low-frequency pole moving towards the origin for in-
                                               creasing Cc.

                                                  Pole-splitting can also clearly be observed in the voltage transfer of the network.
                                               Figure 12.43 shows the magnitude plots of the voltage transfer with Cc stepping
                                               from 0 · · · 2pF. At very high frequencies, all curves approach the same asymptote.
                                               This indicates that the product of the poles is not affected by Cc.

Figure 12.43: Pole splitting in the circuit
from Figure 12.41B.

Figure 12.44: Pole splitting in the gain          Undesired pole-splitting may occur due to parasitic capacitances that es-
stage from Figure 12.41. The pole with the     tablish negative feedback around gain stages in a feedback amplifier. As a
lowest frequency moves towards the origin      consequence, poles that move towards higher frequencies may no longer be-
while increasing Cc.                           long to the dominant group. This results in reduction of the achievable MFM
                                               bandwidth of the amplifier.

17 John M. Miller. Dependence of the input     12.3.2 Miller effect
impedance of a three-electrode vacuum
tube upon the load in the plate circuit.       The earliest description of pole-splitting in amplifier stages dates from 1920.[Miller1920]17
Scientific Papers of the Bureau of Standards,  In the honour of its discoverer, this phenomenon is often referred to as the
15(351):367-385, 1920                          Miller effect.
      12.4. POLE-ZERO CANCELING 427

   Figure 12.45 shows the small-signal equivalent circuit of a current-driven

basic amplification stage driving an RC load (R C). In a case of vacuum

tubes and MOS transistors, the resistance ri is extremely large and is usually
left out of the model. If the reverse capacitance cr equals zero, the poles
of the transimpedance gain can easily be found from network inspection:
p1 = - r1ici and p2 = - R 1C .

                                                                                   Figure 12.45: Pole-splitting in a basic
                                                                                   amplifier stage caused by the reverse
                                                                                   transfer capacitance cr.

+  +

-  -

   If cr  ci and cr  C, the reverse capacitance does not affect the product        18 A similar circuit is analysed in example
of the poles. If, in addition, gmR  1 and gmRcr  ci, the sum of the poles          18.3.

increases considerably with cr and pole-splitting occurs. This can be seen by
solving the characteristic equation of the circuit.18

12.3.3 Interaction with other performance aspects

We have seen that pole-splitting reduces the controller gain in the frequency
range between the split poles. This may increase the nonlinearity of the feed-
back amplifier. This may be of particular interest if an amplifier stage with a
current-limiting character drives a stage in which pole-splitting has been im-
plemented. This is because an amplifier stage in which pole splitting has been
implemented by means of parallel capacitive feedback obtains an integrating
transimpedance character. If such a stage is driven from a current-limiting
stage, the rate of change of the output voltage is limited to the quotient of the
drive current and the feedback capacitance. In fact, pole-splitting by means
of local capacitive feedback is the common cause of the voltage slew rate
limitation as it occurs in operational amplifiers.

   The deterioration of the signal-to-noise ratio and of the power efficiency
that is associated with this technique can usually be neglected. This is be-
cause the feedback capacitance that provides the pole splitting is usually
small with respect to existing capacitances in the amplifier stage.

12.4 Pole-zero canceling

Another pole-splitting technique that can be used to change initial pole po-
sitions of the loop gain is pole-zero canceling. With this technique, a zero
is inserted into the loop gain that coincides with a pole in the loop gain.
However, we have seen that passive zeros can only be inserted into existing
attenuators in the loop. In well-designed amplifiers, the source impedance,
the load impedance and the feedback network are the only places where
impedances in series or in parallel with the signal path cause attenuation of
the loop gain. This is because in well-designed amplifiers, we have not in-
serted impedances in parallel or in series with the signal path, unless this was
inevitable. The source impedance, the load impedance and the impedances
of passive feedback elements are such inevitable impedances, and in sections
12.2.5 and 12.2.6 we have seen that we can use these impedances for the cre-
ation of phantom zeros.
428 FREQUENCY COMPENSATION

                                        12.4.1 Insertion of impedances into the signal path

                                                  According to the above, the insertion of zeros that are not phantom zeros
                                                  requires the insertion of an extra attenuator into the loop. This should be
                                                  accomplished through insertion of an impedance in series or in parallel with
                                                  the signal path. For this reason, the penalty on other performance aspects,
                                                  such as, noise performance, power efficiency and linearity is much larger
                                                  than with pole-splitting by means of negative feedback or with phantom zero
                                                  compensation.

                                                      In the following example, we will demonstrate this technique.

                                                  Example 12.14

                                                          Let us consider the network depicted in Figure 12.46A. It shows two cascaded
                                                      single-pole gain stages that are assumed to be part of a controller. The first stage
                                                    has a pole p1 = -1Mrad/s and the second stage has a pole p2 = -100krad/s.
                                                      The aim of pole-splitting is to move the most dominant pole to a lower frequency
                                                      while moving the pole with the highest frequency to a higher frequency. In this
                                                    example, we will change the sum of the poles from -1100krad/s to 14Mrad/s,
                                                      while maintaining their product at 100Grad2/s2.

Figure 12.46: Pole-splitting by means of                                                                                                   +
pole-zero canceling
                                                                                                                         10k       70
    A: Two cascaded gain stages of a con-
troller B: With added pole-zero canceling              10k      ++          10k                               10k  + + 1n
network.
                                           +                                           +          +
                                                                             1n -
                                             - 100p - -                                             - 100p - -                     14n -
                                           A                                                      B

                                           We will move the most dominant pole to a lower frequency by placing a ca-

                                           pacitance C3 in parallel with C2. We can then place a zero on p1 by inserting a
                                                                                                                         -1.
                                           resistor         R3  in  series  with  C3.  The  zero  will  be  located  at            Figure  12.46B
                                                                                                                            R3 C3
                                           shows the modified circuit. The second gain stage now has two poles and one zero.

                                           If the poles are well separated (C3  C2) and (R2  R3), their frequencies can
                                           be estimated as discussed in section 18.5.3: p2  - (R2+1R3)C3 and p3  - R31C2 .
                                           The zero in the second stage cancels p1 of the first stage, so the sum of the new

                                           poles of the two cascaded stages equals p2 + p3. Hence, we obtain the following

                                           design equations:

                                                                                   1 + 1 = 14 × 106,                                       (12.75)
                                                                            (R2 + R3) C3 R3C2                                              (12.76)

                                                                                                 R3C3 = 10-6,

                                           where C2 = 1nF and R2 = 10k. Numeric solution yields: C3  14nF,
                                           R3  70. With these values, the product of the poles is slightly degraded to
                                           95.2Grad2/s2. This is because the symbolic expressions for p2 and p3 are not

                                           accurate.

                                              In the following example, we will demonstrate this technique for the com-
                                           pensation of the transimpedance amplifier from example 11.3. We will show
                                           that this technique is inferior with respect to the phantom zero compensation
                                           discussed in example 11.3.

                                           Example 12.15

                                              Figure 12.47 shows the small-signal equivalent circuit of the uncompensated
                                           transimpedance amplifier from example 11.3. In that example, we already deter-
                                           mined the values of the dominant poles and the DC loop gain. We found two
                                           dominant poles: p1 = -16Hz and p2 = -96.4kHz. The DC loop gain was
                                           obtained as -973 · 103.
                          R1                      12.4. POLE-ZERO CANCELING 429

                                                        Figure 12.47: Small-signal diagram of the
                                                        uncompensated transimpedance amplifier
                                                        from example 7.11.3.

        (1)                            (2)

                                  -+           +

I1  C1  C2       C3                   R2

                          +-                  -

                          E1
                          model EZ

   With these values, the achievable MFM bandwidth amounts to 1.225MHz.
This largely exceeds the absolute value of the sum of the poles, thus MFM com-
pensation is required. Unfortunately, the poles cannot be split by moving the
dominant pole closer to the origin and the other one further away from the origin.
The dominant pole is a pole of the voltage gain of the operational amplifier and its
value cannot be altered. We can move p2 to a higher frequency by placing a resis-
tor in parallel with the input of the operational amplifier. This technique is known
as resistive broadbanding and will be discussed in section 12.5. In order to shift
p2 to - 2 × 1.225MHz, we need to place a resistance Rz = 5.896k in parallel
with the input of the operational amplifier. If we want to apply pole-splitting and
maintain an MFM characteristic, we need to create a zero at -16Hz, which can
be achieved by placing a capacitance Cz = 1.69µF in series with this resistor. In
fact, we now created a new dominant pole at -0.89Hz. Figure 12.48 shows the
modified circuit.

                     (1)              (2)                                              Figure 12.48: Small-signal diagram of the
                                                                                       transimpedance amplifier from example
            R3 R1                                                                      7.11.3 with pole-splitting by means of
                                                                                       pole-zero canceling.

            (3)           -+                   +

I1 C1 C4 C2 C3                        R2

                          +-                  -

                          E1
                          model EZ

       Below is the SLiCAP netlist of the circuit:

 1 transimpedancePZcancel
 2 * file: transimpedancePZcancel.cir
 3 * SLiCAP circuit file
 4 I1 0 1 0
 5 C1 1 0 {C_s}
 6 C2 1 0 {C_d}
 7 C3 1 0 {C_c/2}
 8 C4 3 0 {C_z}
 9 R1 1 2 {R_f}
10 R2 2 0 {R_ell}
11 R3 1 3 {R_z}
12 E1 2 0 0 1 EZ value={A_0/(1+s/2/pi/16)} zo={R_o}
13 .param C_s=5p R_f=100k R_ell=2k C_d=8p C_c=7p A_0=1M
14 + R_o=55 C_z={1/R_z/2/pi/16} R_z=5.896k
15 .end

       The value of the capacitance Cz has been defined symbolically. During numeric
    analysis, it will be calculated with a high accuracy such that the zero exactly
    cancels the pole at -16Hz.

       Below is the SLiCAP script for analysis of the locations of the poles and the
    zeros. For determination of the poles, the data type has been set to 'poles', and
430 FREQUENCY COMPENSATION

    for determination of the zeros the data type has been set to 'zeros'. Combined

    pole-zero analysis is performed with the data type set to 'PZ'. With this analysis

    type, poles and zeros that coincide will not be displayed.

 1 #!/usr/bin/env python3
 2 # -*- coding: utf-8 -*-
 3 # File: transimpedancePZcancel.py
 4
 5 from SLiCAP import *
 6
 7 fileName = 'transimpedancePZcancel'
 8 prj = initProject(fileName)
 9 i1 = instruction()
10 i1.setCircuit(fileName + '.cir')
11 i1.setSource('I1');
12 i1.setDetector('V_2')
13 i1.setLGref('E1')
14 i1.setSimType('numeric')
15 i1.setGainType('loopgain')
16 i1.stepOff()
17 # Display poles
18 i1.setDataType('poles')
19 result = i1.execute()
20 listPZ(result)
21
22 # Display zeros
23 i1.setDataType('zeros')
24 listPZ(i1.execute())
25
26 # Display, poles, zeros and DC gain
27 i1.setDataType('pz')
28 listPZ(i1.execute())
29
30 # Calculate the phase margin
31 i1.setDataType('laplace')
32 i1.setGainType('loopgain')
33
34 L = i1.execute()
35 loopGain = L.laplace
36 pmResults = phaseMargin(loopGain)
37
38 uF = pmResults[1]
39 pM = pmResults[0]
40
41 print('Loop gain: phase margin = {:3.2f}deg at f = {:8.2e}Hz\n'.format(pM, uF)

                )

42
43 # Show the poles, zeros and DC value of the gain
44 i1.setDataType('pz')
45 i1.setGainType('gain')
46 listPZ(i1.execute())

                            The results of this script will be displayed in the Python console window:

1 Poles of loopgain:

2

3 n Real part [Hz] Imag part [Hz] Frequency [Hz]         Q [-]

4 -- -------------- -------------- -------------- --------

50                          -8.90e-1  0.00e+00  8.90e-1

61                          -1.60e+1  0.00e+00  1.60e+1

72                          -1.73e+6  0.00e+00  1.73e+6

8

9 Zeros of loopgain:

10

11 n Real part [Hz] Imag part [Hz] Frequency [Hz]        Q [-]

12 -- -------------- -------------- -------------- --------

13 0                        -1.60e+1  0.00e+00  1.60e+1

14

15 DC value of loopgain: -9.73e+5

16

17 Poles of loopgain:

18

19 n Real part [Hz] Imag part [Hz] Frequency [Hz]        Q [-]

20 -- -------------- -------------- -------------- --------

21 0                        -8.90e-1  0.00e+00  8.90e-1

22 1                        -1.73e+6  0.00e+00  1.73e+6

23

24 Found no zeros.

25
                                                                12.4. POLE-ZERO CANCELING 431

26 Loop gain: phase margin = 65.52deg at f = 7.89e+05Hz

27

28 DC value of gain: -1.00e+5

29

30 Poles of gain:

31

32 n Real part [Hz] Imag part [Hz] Frequency [Hz]        Q [-]

33 -- -------------- -------------- -------------- --------

34 0  -8.66e+5     -8.67e+5             1.23e+6 7.07e-1

35 1  -8.66e+5                 8.67e+5  1.23e+6 7.07e-1

36

37 Zeros of gain:

38

39 n Real part [Hz] Imag part [Hz] Frequency [Hz]        Q [-]

40 -- -------------- -------------- -------------- --------

41 0  2.91e+10     0.00e+00             2.91e+10

       The results show exact canceling of the pole of the operational amplifier, while
    the product of the poles is maintained. This yields an MFM characteristic of the
    gain.

12.4.2 Interaction with other performance aspects

Although pole-splitting with the aid of pole-zero canceling can successfully
be applied for high-frequency compensation, the penalty on other perfor-
mance aspects can be relatively high. This can easily be seen from example
12.15. There, we achieved the MFM characteristic by placing an RC series
network in parallel with the input of the operational amplifier. This network
causes an attenuation of the loop gain for frequencies between 0.89Hz and
1.22MHz. This frequency range covers almost the whole operating frequency
range of the amplifier, which has the following consequences:

1. The resistor R3 adds noise and increases the contribution of the equiva-
   lent input voltage noise source of the operational amplifier for frequencies
   between 16Hz and 1.22MHz. This causes a serious deterioration of the
   signal-to-noise ratio.

2. The capacitor C3 increases the contribution of the equivalent input voltage
   noise source of the operational amplifier for frequencies between 0.89Hz
   and 16Hz. This causes a serious deterioration of the signal-to-noise ratio.

3. The reduction of the loop gain over almost the whole frequency range of
   the amplifier increases the nonlinearity of the amplifier.

4. The overdrive recovery time of the amplifier is enlarged due to charge
   storage on C3.

   This can be seen as follows. A (too) large source current may cause voltage
   clipping at the output of the amplifier. In such an event, the input voltage
   of the controller will not longer be zero and charge will be stored on C3.
   The amplifier can only return to its normal state after this charge has been
   removed. In the absence of an input signal, this time is determined by
   the pole frequency set by C3. With phantom zero compensation, this pole
   frequency was about 96kHz. With pole-zero canceling this pole frequency
   is about 0.89Hz. Hence, in the transimpedance amplifier discussed above,
   overdrive recovery will take about 76 times longer with pole-zero canceling
   when compared to phantom zero compensation.

   If this technique is applied in a part of the circuit that carries a large signal
level, there may be a severe penalty on the energy storage and the power
efficiency of the feedback amplifier. In general, reduction of the loop gain
in a certain frequency range will result in a degraded performance of the
feedback amplifier in that frequency range.
432 FREQUENCY COMPENSATION

                                                  possible improvements

                                                  The negative effects described above can be reduced if we accept zeros in the
                                                  transmission band of the amplifier. In other words if we accept deviation
                                                  from the all-pole MFM characteristic. If our design goal is to guarantee sta-
                                                  bility and accept a certain amount of overshoot and tilt in the step response,
                                                  we may follow a different compensation strategy. This is often done when
                                                  using the phase margin as a measure for stability. In section 12.6 we will pay
                                                  attention to this design approach.

                                          12.5 Resistive broadbanding

                                          Resistive broadbanding is a technique that can be applied to increase the
                                          frequency of a pole associated with an independent capacitor voltage or an
                                          independent inductor current, while maintaining the contribution of this sub-
                                          network to the gain-pole product.

                                          12.5.1 Insertion of resistors into the signal path

Figure 12.49: Resistive broadbanding                            log
    A. Circuit with single-pole voltage                         scale

transfer: H(j) = VVoi                        +  +  +  +
    B. Rb in parallel with C implements
                                             -  -  -  -
resistive broadbanding                                       C
    C. Magnitude characteristics of the   A        B                   log scale

voltage transfers from circuits A and B.

                                             Resistive broadbanding can be done by inserting a resistor in parallel with
                                          a capacitor or in series with an inductor. Figure 12.49 illustrates the first
                                          method. We have already illustrated the method for compensation of the
                                          transimpedance amplifier in example 12.15. There, resistive broadbanding
                                          was implemented by placing a resistor in parallel with the input of the oper-
                                          ational amplifier.

                                          12.5.2 Interaction with other performance aspects

                                          Resistive broadbanding can be regarded as a brute force method for exchang-
                                          ing controller gain with controller bandwidth. If it is done at the input of the
                                          controller, the noise penalty, as well as the penalty on the DC error and the
                                          temperature drift thereof, can be large. If it is done at stages that carry a large
                                          signal level, e.g., at the output of the controller, the penalty on the power ef-
                                          ficiency may be large. In general, reduction of the midband loop gain by
                                          means of resistive broadbanding will result in a degraded performance of
                                          the feedback amplifier.

                                          12.6 Phase margin design

                                          Phase margin and gain margin are parameters of the loop gain that are of-
                                          ten used as a measure for the stability of negative feedback amplifiers (see
                                          section 11.5.2). In this book, the design of the dynamic response of a nega-
                                          tive feedback amplifier has been based on manipulation of the solutions of
                                          the characteristic equation of the source-load transfer of an amplifier. This is
                                          the only mathematically proper approach. The solutions of the characteristic
                                          equation are all the poles, including those associated with non-observable or
                                                                                                      12.6. PHASE MARGIN DESIGN 433

not-controllable states. Despite its popularity, the design of the frequency re-
sponse of a source-load transfer driven by the gain margin and phase margin
of the loop gain is not advocated. In general, there does not exist a unique
correspondence between the dynamic properties of the source-load transfer
and the gain and phase margin of the loop gain. However, for the sake of
completeness, we will demonstrate the method.

12.6.1 Lag and lead compensators

The phase margin compensation method makes use of lag compensators and                                                                   +
of lead compensators. Both types of compensator add a pole and a zero to the                           +
loop gain. In a lag compensator, the frequency of the pole is below that of the                      -
zero. The dominant pole causes phase lag and the zero reduces this phase lag.
A lead compensator has the frequency of the pole above that of the zero. The                                                       -
dominant zero introduces phase lead and the pole reduces it. Figure 12.50
shows an example of a lag compensation network, and Figure 12.51 shows                   Figure 12.50: Example of a lag compensa-
an example of a lead compensation network. Phantom zero implementations                  tion network. The frequency of the zero
use lead networks, while pole-zero canceling is realized with lag networks.              in the voltage transfer is above that of the
                                                                                         pole.
   The compensation strategy is to provide enough phase margin to ensure
stability of the circuit. In the following example, we will demonstrate the                                                               +
design of a lag compensator for the transimpedance amplifier, thereby using                          +
the phase margin design approach.                                                                   -

Example 12.16                                                                                                                       -

   In example 12.15, we discussed pole-zero canceling, and our objective was to          Figure 12.51: Example of a lead compen-
achieve an MFM characteristic. In Figure 12.48, the feedback resistance R f and          sation network. The frequency of the zero
the pole-zero canceling network that consists of the series connection of Rz and         in the voltage transfer is below that of the
Cz can be regarded as a lag compensator (see Figure 12.50). After compensation           pole.
with Rz and Cz, we found a rather large degradation of the signal-to-noise ratio,
an increased overdrive recovery and possibly an increased nonlinearity.

   If we look at this compensation problem from the perspective of improvement of
the phase margin, not caring much about the MFM requirement, we may obtain
different values for Cz and Rz and the degradation of other performance aspects
may be less. The resistance Rz cannot be changed much. This is because at high
frequencies where Cz acts as a short with respect to Rz, this resistance, together
with the total capacitance at the input of the operational amplifier, determines the
frequency of the pole with the highest frequency. In order to approximate an MFM
response, the frequency of this pole should be at about 2 times the bandwidth of
the amplifier. However, if we do no longer aim accurate pole-zero canceling, the
capacitance Cz can be taken much smaller. The frequency of the new pole will then
be above that of the pole of the operational amplifier, while the frequency of the zero
no longer coincides with the pole of the operational amplifier. Its frequency will be
above that of the new pole. The loop gain will then have three poles and one zero:

p1 = -16 Hz,                             (12.77)
                                         (12.78)
p2  - 1 Hz,                              (12.79)
2R f          Cs  +  Cz  +  Cd  +  1 Cc  (12.80)

                                   2

p3  - 1 Hz,
2Rz           Cs  +  Cd  +  1 Cc

                            2

z1 = - 1 Hz.
         2R f zCz

   Below the script for determination of the DC value, the poles, and the zeros of
the gain and the loop gain with Cz = 200pF, as well as the phase margin of the
loop gain.
434 FREQUENCY COMPENSATION

50 print('=== Modified compensation C_z = 200p. ===\n')
51 i1.defPar('C_z', '200p')
52
53 # Show the poles, zeros and DC value of the gain
54 listPZ(i1.execute())
55
56 i1.setGainType('loopgain')
57 # Show the poles, zeros and DC value of the gain
58 listPZ(i1.execute())
59 # Show the phase margin of the loop gain
60 i1.setDataType('laplace')
61 L = i1.execute()
62 loopGain = L.laplace
63 pmResults = phaseMargin(loopGain)
64
65 uF = pmResults[1]
66 pM = pmResults[0]
67
68 print('Loop gain: phase margin = {:3.2f}deg at f = {:8.2e}Hz\n'.format(pM, uF)

                )

                            The output is:

43 === Modified compensation C_z = 200p. ===

44

45 DC value of gain: -1.00e+5

46

47 Poles of gain:

48

49 n Real part [Hz] Imag part [Hz] Frequency [Hz]               Q [-]

50 -- -------------- -------------- -------------- --------

51 0                        -1.64e+5        0.00e+00  1.64e+5

52 1                        -8.52e+5        -7.14e+5  1.11e+6 6.52e-1

53 2                        -8.52e+5        7.14e+5   1.11e+6 6.52e-1

54

55 Zeros of gain:

56

57 n Real part [Hz] Imag part [Hz] Frequency [Hz]               Q [-]

58 -- -------------- -------------- -------------- --------

59 0                        -1.35e+5        0.00e+00  1.35e+5

60 1                        2.91e+10        0.00e+00  2.91e+10

61

62 DC value of loopgain: -9.73e+5

63

64 Poles of loopgain:

65

66 n Real part [Hz] Imag part [Hz] Frequency [Hz]               Q [-]

67 -- -------------- -------------- -------------- --------

68 0                        -1.60e+1        0.00e+00  1.60e+1

69 1                        -6.99e+3        0.00e+00  6.99e+3

70 2                        -1.86e+6        0.00e+00  1.86e+6

71

72 Zeros of loopgain:

73

74 n Real part [Hz] Imag part [Hz] Frequency [Hz]               Q [-]

75 -- -------------- -------------- -------------- --------

76 0                        -1.35e+5        0.00e+00  1.35e+5

77

78 Loop gain: phase margin = 58.25deg at f = 7.59e+05Hz

                               The gain has three poles and two zeros. The positive zero is a result of the
                            direct transfer. The zero at -135kHz is the zero of the loop gain. At the frequency
                            of this zero, the magnitude of the loop gain exceeds unity. Hence, in the root
                            locus, one of the poles of the loop gain will move towards this zero. Because the
                            loop gain is finite this pole does not reach the zero, and a pole-zero pair remains
                            in the gain. This is illustrated in the root locus plots from Figure 12.53 and
                            12.55. At the available loop gain, the pole that moves towards the zero reaches
                            -100.69kHz. This can be seen in the listing of the poles and the zeros of the gain
                            with Cz = 200pF.

                               The phase margin after compensation is 49 degrees, which almost equals the
                            phase margin of the circuit with pole-zero canceling (52 degrees). Figure 12.52
                            shows the phase margin as a function of the compensation capacitance Cz. It shows
                            that increasing Cz above 200pF does not result in a significant improvement of
                                                                                                      12.6. PHASE MARGIN DESIGN 435

    the phase margin. The script below shows how to display the phase margin and
    the poles and zeros of the loop gain and how to plot this phase margin against Cz.

70 # Plot the phase margin versus C_z
71 i1.setStepVar('C_z')
72 i1.setStepStart(0)
73 i1.setStepStop('200p')
74 i1.setStepNum(100)
75 i1.setStepMethod('lin')
76 i1.stepOn()
77
78 result = i1.execute()
79
80 PM = [i1.stepList, phaseMargin(result.laplace)[0]] # x, y trace data
81 htmlPage('Phase margin')
82 plotData = {'PhaseMargin vs C_z': PM}
83 figPM = plot('PM', 'Phase margin versus $C_z$', 'lin', plotData, xName = '$' +

                 sp.latex(i1.stepVar) + '$', xScale = 'p', xUnits = 'F', yName = 'Phase
                margin', yUnits = 'deg', show = True)

84 fig2html(figPM, 800)

                                                                                                                                      Figure 12.52: Phase margin as a function of
                                                                                                                                      the compensation capacitance Cz.

                                                                                                                                      Figure 12.53: Root locus plot of the tran-
                                                                                                                                      simpedance amplifier with lag compensa-
                                                                                                                                      Ftiiognu.re 12.54: Step response of the tran-
                                                                                                                                      simpedance amplifier with lag compen-
                                                                                                                                      sation as a function of the compensation
                                                                                                                                      capacitance Cz.

                                                                                                                                          Please note that this figure shows the
                                                                                                                                      unit step response which has a step size of
                                                                                                                                      1A. The output voltage of this linear circuit
                                                                                                                                      with a tranfer of about 105 will thus be
                                                                                                                                      105V!

       The effect of such a pole-zero pair in the transfer of the amplifier can clearly
    be observed in the step response of the amplifier and in the magnitude and phase
    characteristics of its transfer. The unit step response shown in Figure 12.54 shows
436 FREQUENCY COMPENSATION

Figure 12.55: Detail of the root locus plot  sequential settling to two different levels. First, the output voltage appears to
of the transimpedance amplifier with lag     settle at about -103kV, and after some time final settling to -100kV takes place.
compensation.
                                                If the first settling is much faster than the second, the ratio between these two
                                             levels approximates the ratio of the frequency of the pole and that of the zero. The
                                             settling time to the first level is determined by the poles with the highest frequency.
                                             The settling time to the final value is determined by the pole at -164kHz. Gen-
                                             erally, it may be concluded that a pole-zero pair in the transmission band of the
                                             amplifier causes droop or tilt in its step response.

                                                A similar effect can be observed in the magnitude characteristic. The magni-
                                             tude characteristic in Figure 12.56 shows the effect of the pole-zero pair. Since
                                             the frequency of the zero is below that of the pole, the gain increases in the region
                                             between the frequency of the zero and that of the pole. Again, the relative increase
                                             equals the ratio of the frequency of the pole and the frequency of the zero. Aside
                                             from this effect, the curve deviates from an MFM response due to insufficient com-
                                             pensation. If, after optimization, the zero is not canceled by a pole, the response
                                             will deviate from an MFM response.

Figure 12.56: Magnitude characteristic and
phase of the transfer of the transimpedance
amplifier with lag compensation as a
function of the compensation capacitance
Cz .
                                                                            12.7. REDUCTION OF THE SERVO BANDWIDTH 437

12.6.2 Interaction with other performance aspects

Although the phase margin design approach with lag or lead networks may
result in stable behavior, the most powerful method for frequency compen-
sation is the application of phantom zeros.

12.7 Reduction of the servo bandwidth

We have seen that a large loop gain is beneficial to almost all performance
aspects of a feedback amplifier. The only performance degradations that
cannot be cured by a large loop gain are:

1. The addition of noise at the input of the controller and in the feedback
   network.

2. The addition of DC offset at the input of the controller and associated
   temperature effects.

3. Energy storage and power losses that occur in (parasitic) impedances in
   series and/or in parallel with the load, the source or elements of the feed-
   back network.

There may be situations in which the loop gain needs to be very large,

yielding servo bandwidth that is much larger than required. If the order

of the servo function exceeds two or three, frequency compensation while

maintaining the bandwidth may become difficult or even impossible.

Consider, for example, an audio power amplifier that needs to drive elec-

trodynamic loudspeakers. Such an amplifier needs to have a large power

gain, a very low distortion at low frequencies, and a very low output impedance,

but a rather modest frequency range. The requirements for the low distortion log
combined with the large power gain and the low output impedance, often re- scale

sult in a feedback amplifier with a very large loop gain. As a result, the servo

bandwidth may be much larger than required and the number of dominant                    log scale
poles may be too large to deal with during frequency compensation.

In the above situations, it may be a useful approach to limit the number

of dominant poles without limiting the low-frequency loop gain. This can          Figure 12.57: Bandwidth reduction by
be achieved with the aid of pole-splitting techniques or by using brute force     means of excessive pole-splitting. The poles

methods.                                                                          p1 and p3 have been split. After splitting,
                                                                                  p3 not longer belongs to the dominant
                                                                                  group and the servo bandwidth is reduced.

12.7.1 Excessive pole-splitting

In sections 12.3 and 12.4, we have introduced two pole splitting techniques

that can be applied for increasing the sum of two dominant poles of the loop

gain, without changing their product. If two dominant poles after splitting

are still dominant poles of the loop gain, the bandwidth of the servo function

will be preserved. The splitting of the poles can also be performed in such a

way that one of the poles is moved out of the dominant group. If so, the order

of the servo function is decreased by one and the bandwidth of the servo

function will be reduced. Such a reduction of the bandwidth may be desired

in the situation described above. Figure 12.57 shows the intended effect on

the magnitude characteristics of the loop gain and the servo function.            log

                                                                                  scale

12.7.2 Pole frequency reduction                                                                                                           log scale

Instead of splitting one of the poles out of the dominant group, the band-        Figure 12.58: Bandwidth reduction by
width can also be reduced by moving a pole of the dominant group closer           moving a dominant pole closer to the
to the origin or by adding a dominant pole. This can be achieved by insert-       origin. The poles p1 is moved closer to
ing a capacitance in parallel with the signal path. Figure 12.58 illustrates the  the origin. As a result p3 does not longer
                                                                                  belong to the dominant group.
438 FREQUENCY COMPENSATION

log                                   reduction of the bandwidth of the servo function by moving the most dom-
scale                                 inant pole closer to the origin. In cases in which the most dominant pole
                                      is associated with an independent capacitor voltage, this can be achieved by
       log scale                      placing a capacitor in parallel with the existing capacitor.

Figure 12.59: Bandwidth reduction by     Figure 12.59 illustrates the effect of the addition of a new dominant pole.
addition of a dominant pole.          This can be achieved by insertion of a capacitor in parallel with the signal
                                      path in a resistive network with a nonzero resistance.
log
scale                                 12.7.3 DC loop gain reduction

       log scale                      In section 11.5.4, we studied a balanced voltage amplifier that exhibited a
                                      common-mode loop gain much larger than the differential-mode loop gain.
Figure 12.60: Bandwidth reduction by  Since the common-mode DC performance is usually of less interest than the
means of DC loop gain reduction .     differential-mode DC performance the common-mode frequency compensa-
                                      tion may be accomplished by reduction of the common-mode DC loop gain.
                                      The effect of this compensation method is illustrated in Figure 12.60.

                                      12.7.4 Interaction with other performance aspects

                                      Reduction of the loop gain in some frequency range generally causes deteri-
                                      oration of accuracy and linearity in this frequency range. If the reduction of
                                      the loop gain is achieved by brute force insertion of impedances in series or
                                      in parallel with the signal path, it may result in degradation of the signal-to-
                                      noise ratio and/or an increase of power losses and/or energy storage. The
                                      latter may result in an increase of the overdrive recovery error.

                                      12.8 Feedback biasing frequency compensa-
                                              tion

                                      Until now, we have only paid attention to the design of the low-pass roll-off
                                      characteristic of the transfer of negative feedback amplifiers. Any transfer
                                      of a physical system will show a low-pass behavior due to the fundamental
                                      limitation of speed.

                                         Amplifiers that exhibit AC coupling, may also show a high-pass character
                                      at low frequencies. AC coupling may be the result of the design of the de-
                                      sired transfer function or of the biasing. In the negative-feedback integrator,
                                      discussed in section 11.4.4, AC coupling and the high-pass character of the
                                      servo function were a result of the design of the integration operation. In
                                      the voltage amplifier discussed in section 9.3, the high-pass character of the
                                      transfer was implemented during biasing.

                                         In this section, we will discuss the design of the high-pass characteristic
                                      when using negative feedback biasing.

                                      12.8.1 Negative feedback biasing concepts

                                      Negative feedback biasing, as it was introduced in section 9.3, can only be
                                      applied if DC signal components are not of interest. In that case DC bias
                                      quantities can be separated from the signal. A DC control loop that keeps the
                                      bias quantities in their desired range can then be added to the amplifier with-
                                      out affecting the transmission coefficients of the amplifier in the frequency
                                      range of interest.

                                         Figure 12.61 shows two arrangements in which a bias loop controls the DC
                                      operating voltage of the output port of a negative feedback amplifier. Figure
                                      12.61A shows a circuit concept in which the bias controller is modeled as a
                                      voltage-controlled current source. Figure 12.61B shows a circuit concept in
                                                               12.8. FEEDBACK BIASING FREQUENCY COMPENSATION 439

which the bias controller is modeled as a voltage-controlled voltage source.
Similar arrangements can be designed to control the DC operating current of
the output port.

signal                                DC coupled     + power                   signal                       DC coupled     + power
source                                negative                                 source                       negative
                                      feedback                supply                                        feedback                supply
    +                                 amplifier                                    +                        amplifier
    -                                                - voltage                     -                                       - voltage
                                      +           +                                                         +           +
                                                              source                                                                source
                                      --                                                                    --
                                                                         load                                                                  load
                     Bias                                                                           Bias
                     controller                                         +                           controller                                +

        +                                                            -                 +                                                   -

                                                  +                                                         ++

                  Amplifier -                     -                                       Amplifier -       --

                        input port                + Amplifier                                 input port                + Amplifier
                        bias voltage                                                          bias voltage
                        reference                          output port                        reference                          output port

A                                                 - bias voltage               B                                        - bias voltage

                                                           reference                                                             reference

   In the circuit from Figure 12.61A, the bias circuit controls the DC operat-                              Figure 12.61: Feedback biasing concepts
ing voltage of the output port by adding a DC current to the input of the                                       A. Negative feedback biasing concept
negative feedback amplifier. This feedback biasing scheme can be applied
if the negative feedback amplifier has a nonzero DC transimpedance factor.                                  with VCCS bias controller
AC coupling at the source or the load is not always necessary. It has to be                                     B. Negative feedback biasing concept
applied if no DC current is allowed to flow through the source or the load
and if the DC source impedance or the DC load impedance equals zero.                                        with VCVS bias controller

   In the circuit from Figure 12.61B, the bias circuit controls the DC operating
voltage of the output port by adding a DC voltage to its input. This feed-
back biasing scheme can be applied if the negative feedback amplifier has a
nonzero DC voltage gain factor. AC coupling at the source or the load is not
always necessary. However, it has to be applied if no DC current is allowed
to flow through the source or the load and if the DC load impedance equals
zero. If the source has been AC coupled to the amplifier, a nonzero DC by-
pass has to be created for setting the DC voltage at the noninverting input
of the feedback amplifier. In the circuit from Figure 12.61B, Zp performs this
task.

12.8.2 Dynamic behavior with feedback biasing

In the frequency range of interest, the values of the transmission parameters
of the amplifier should not be affected by the biasing. Hence, at those fre-
quencies, the coupling capacitors should behave as short circuits and the gain
in the bias control loop should approximate zero. In the concept from Figure
12.61A, the transmission parameter C can be affected by the bias loop, while
in the concept from Figure 12.61A, the transmission parameter A could be
changed. Aside from affecting the transmission parameters of the amplifier,
too small values of the coupling capacitors also deteriorate the signal-to-noise
ratio and the power efficiency.

   The poles introduced by the coupling capacitors, as well as the dynamic
behavior of the controller, should be designed such that a stable MFM high-
pass character will be obtained. The general approach to the design of feed-
back biasing circuitry is as follows:

1. Use the idealized model for the negative feedback amplifier.

   This is allowed if the low-pass cut-off and the high-pass cut-off of the
440 FREQUENCY COMPENSATION

                                            amplifier are well separated.

                                            2. If necessary, apply AC coupling of the source and the load and define the
                                               lower limits of the coupling capacitors on grounds of:

19 Including the frequency compensation of     (a) Their influence in the noise behavior
the biasing.                                   (b) The high-pass cut-off frequency
                                               (c) The deterioration of the power efficiency of the amplifier
     +5V
                                            3. Design the desired transfer characteristic of the bias controller.19
      -                                            This is done by evaluating the source-load transfer of the amplifier, in-

+5V  +                                         cluding its bias loop, and equating the coefficients of s of this transfer with
                           +                   those of the desired high-pass characteristic.

          -5V                                  We will demonstrate this for the design of the biasing of the charge inte-
                                            grator from example 11.4.
                        -
                                               Example 12.17
+- +
                                                   In example 11.4, we discussed the design of the high-pass behavior of a current
-    -+                                        integrator. We derived a requirement for the DC gain of the controller such that
                                               the high-pass cut-off of the integrator was below 1kHz. However, we did not
+         +                                    finalize the design and did not focus on the biasing. The design of the biasing will
                                               be discussed in this example. We will use the following additional requirements
-         -                                    for the biasing of the integrator:

                 -5V                        1. A bias current of maximally ±1µA is allowed to flow through the source.

Figure 12.62: Current integrator from       2. A DC current of maximally +2.5mA is allowed to flow through the load.
example 11.4 with negative feedback
biasing according to Figure 12.61B.         3. The DC voltage at the output of the amplifier should be 2.5 ± 0.01V.

20 Low-frequency behavior is the behavior   4. A power supply of ±5V is available.
below midband frequencies as described in
section 12.1.1.                                    Figure 12.62 shows the current integrator in which an operational amplifier
                                               has been used for the controller and feedback biasing according to Figure 12.61B
                                               has been applied. The aim of the biasing circuit is to keep the quiescent DC output
                                               voltage within specifications.

                                                   During the design of the biasing, the transfer of the reference voltage VR to the
                                               DC output voltage is of interest. The ideal value of this transfer should be unity.
                                               We will use the asymptotic gain model to evaluate the dynamic behavior of this
                                               biasing circuit and determine the requirements for the controller. To this end, we
                                               select Av of the controller as the reference variable and evaluate the asymptotic
                                               gain, the loop gain and the servo function. With Av as the loop gain reference
                                               variable, the asymptotic gain equals unity. Hence, it equals the ideal gain and the
                                               servo function will describe the deviation from this ideal transfer.

                                                   In order to find an expression for the servo function, we will determine the loop
                                               gain LB(s) of the biasing loop. For the evaluation of the loop gain, we will ap-
                                               proximate the dynamic behavior of the integrator by its low-frequency behavior.20
                                               By doing so, we obtain

                                                                   LB(s) = -Av(s) A0 1 + sA . 0RsCi   (12.81)
                                            We can now evaluate the servo function of the bias loop:

                                            -LB(s) =                       Av(s)A0 .                  (12.82)
                                            1 - LB(s) 1 + sA0RsCi + Av(s)A0

                                               The biasing accuracy will be completely determined by the DC properties of the
                                            bias controller if it approximates nullor behavior. For this reason, we will design
                                            the bias controller as an ideal integrator:

                                                                           Av(s) = 1 .                (12.83)
                                                                                       s
12.8. FEEDBACK BIASING FREQUENCY COMPENSATION 441

With this controller, the servo function becomes:

                       -LB(s) =  2 1 .                        (12.84)
                      1 - LB(s) 1 + s A0 + s RsCi
For a second order cut-off at 1kHz, we need

 = 421061 R = 0.1s. sCi                                       (12.85)

   The loop gain has one pole in the origin (s = 0) and one pole very close to the                      +
origin (s = - 2A01RsCi Hz). A smooth MFM high-pass cut-off can be achieved
with phantom zero compensation. With the two poles of the loop gain in the                   +5V
origin, this zero should be located at: z = - 1000 Hz.
                                                                                             -          -
                                                                           2
                                                                                             +

In the next example, we will verify the results with SLiCAP.                                    -5V
                                                                                             +5V
Example 12.18                                                                           +5V

   Figure 12.63 shows the circuit of the biased charge amplifier. The phantom           +
zero for frequency compensation of the biasing has been implemented with Cc.
The OPA627 has been selected as the operational amplifier for implementation of         --
both controllers. The SLiCAP netlist of the small-signal equivalent circuit is
listed below:                                                                           +            +

                                                                                                        +

                                                                                                                        -
                                                                                        -
                                                                                                                             -5V
 1 QampBias                                                                                              -5V

 2 * file: QampBias.cir                                                                 Figure 12.63: Current integrator from
 3 * SLiCAP circuit file                                                                Figure 12.62 with negative feedback biasing
 4 I1 0 1 0                                                                             with phantom zero compensation
 5 R1 1 0 {R_s}
 6 R2 2 0 {R_ell}
 7 R3 2 4 {R_B}
 8 C1 1 2 {C_i}
 9 C2 2 4 {C_c}
10 C3 3 4 {C_B}

11 O1 3 1 2 0 OPA627

12 O2 0 4 3 0 OPA627
13 .param R_s=50k R_ell=2k C_i=5p R_B=1M C_B=100n C_c=0

14 .end

       With RB = 1M and CB = 100nF, we have  = 0.1s, and with Cc = 220pF,
    we have the value of the phantom zero as defined in the previous example. The

    SLiCAP script for plotting the magnitude characteristics of the uncompensated

    and compensated circuit, as well as for plotting the pole positions while stepping

    Cc, is listed below:

 1 #!/usr/bin/env python3
 2 # -*- coding: utf-8 -*-
 3 # File: QampBias.py
 4
 5 from SLiCAP import *
 6
 7 fileName='QampBias'
 8 prj = initProject(fileName)
 9 i1 = instruction()
10 i1.setCircuit(fileName+ '.cir')
11 htmlPage('Circuit data')
12 netlist2html(fileName+ '.cir')
13 i1.setSource('I1')
14 i1.setDetector('V_2')
15 i1.setSimType('numeric')
16 i1.setGainType('gain')
17 i1.setDataType('laplace')
18 GainUncomp = i1.execute()
19 GainUncomp.label = 'uncomp.' # Assign a plot label to this result
20 i1.defPar('C_c','220p')
21 GainComp = i1.execute()
22 GainComp.label = 'phz comp.' # Assign a plot label to this result
23 htmlPage("Bode plots charge amplifier with feedback biasing")
24 dBmag = plotSweep('dBmagQamp', 'Charge amplifier with feedback biasing', [

                GainUncomp, GainComp], 100, 10e6, 500, funcType='dBmag', show=True)
442 FREQUENCY COMPENSATION

                                               25 phase = plotSweep('phaseQamp', 'Charge amplifier with feedback biasing', [

                                                               GainUncomp, GainComp], 100, 10e6, 500, funcType='phase', show=True)

                                               26 fig2html(dBmag, 800)
                                               27 fig2html(phase, 800)
                                               28 i1.setDataType('poles')
                                               29 i1.stepOn()
                                               30 i1.setStepVar('C_c')
                                               31 i1.setStepStart(0)
                                               32 i1.setStepStop('500p')
                                               33 i1.setStepNum(20)
                                               34 i1.setStepMethod('lin')
                                               35 pzPlot = plotPZ('RLqAmp', 'Biased charge amplifier', i1.execute(), xmin=-3,

                                                               xmax=0, ymin=-1.5, ymax=1.5, xscale='k', yscale='k', show=True)

                                                  The Bode plots are shown in Figure 12.64. They clearly show a second order
                                               high-pass character of the integrator with a high-pass cut-off frequency of 1kHz.
                                               This is exactly as designed. The uncompensated amplifier shows a large peaking
                                               in the vicinity of the high-pass cut-off frequency.

Figure 12.64: Magnitude plots of the
uncompensated and the compensated
charge amplifier with negative feedback
biasing.

Figure 12.65: Poles of the gain of the charge     Figure 12.65 shows that the two poles of the uncompensated amplifier, that
                                               determine the high-pass behavior are almost located on the imaginary axis. This
amplifier as a function of Cc (25pF per        confirms the peaking in the magnitude characteristic and is according to the cal-
step).                                         culations from the previous example. Figure 12.65 also shows that phantom zero
                                               compensation with 225pF brings the poles into MFM positions. The magnitude
                                               characteristic of the compensated amplifier shows a smooth transition from a dif-
                                                                                  12.9. NESTED CONTROL 443

ferentiator below 1kHz to an integrator above 1kHz.

12.9 Nested control

Until now, we have used the following strategy for the design of negative
feedback amplifiers:

1. Design the ideal gain of the amplifier using a nullor as controller

2. Relate the controller requirements to those of the amplifier

3. Select an operational amplifier that meets the controller requirements

4. Perform frequency compensation of the low-pass cut-off

5. Apply biasing

6. If negative feedback biasing is applied, perform frequency compensation
   of the high-pass roll-off

   This is a useful strategy for amplifiers comprising only one controller.21     21 These amplifiers only exhibit over-all
However, there may be situations in which it is preferable to build a con-        feedback.
troller with cascaded local feedback amplifier stages. Each of these amplifier
stages has its transfer accurately fixed by means of negative feedback, which
gives the controller an accurately fixed gain and pole-zero pattern. In control
theory, this is often referred to as nested control loops.

12.9.1 PID controllers with local feedback amplifiers                             +                    +
                                                                                  -
We will illustrate the application and design of controllers with local feedback  DAC - M
amplifier stages with the design of a motor driver. Figure 12.66 shows the        +
application of the motor driver. The motor driver has to drive a voice coil       -
motor with a current that is accurately related to the output voltage of a
digital-to-analog converter (DAC). One of the motor terminals is connected
to ground. The following requirements apply:

1. The motor driver should be capable of driving multiple types of motors.               Transconductance
   The dynamic response of the motor driver should not depend on the prop-               amplifier
   erties of the motor. The small-signal impedance of the voice-coil motors
   can be represented by a series LR connection. The inductance Lm and the        Figure 12.66: Half-bridge motor current
   resistance Rm of the voice coil differ for each motor.                         driver, dirven from a voltage output DAC.

2. Digital settings may be applied to adjust the gain and the dynamic re-
   sponse for each motor type.

3. A single-pole high-efficiency power voltage amplifier with a voltage gain

Av(s)  =   A0  is  available  and  should  be  used  for  driving  the  motor.
          1+s

Over-all feedback architecture

According to the design method discussed in Chapter 7, we could design a
single-controller active feedback current driver as shown in Figure 12.67.

   In this amplifier structure, a sense resistor with a value Rs has been used
to convert the motor current into a (floating) voltage. A differential volt-
age converts this voltage into a single-ended one that can be compared with
the single-ended DAC output voltage. The gain of this differential amplifier
equals Ad. A nullator sets the zero condition for this comparison, while a
norator provides the dependent motor current for satisfying this condition.
444 FREQUENCY COMPENSATION

Figure 12.67: Conceptual design of the        DAC
motor driver amplifier.

                                                              M

22 The gain of a controlled source that     At a first glance, this seems to be a perfect solution. The ideal transconduc---
implements the nullor has been taken as  tance gain of the motor driver equals Ad/Rs. The bandwidth can be designed++
the loop gain reference.                 by inserting a zero into the gain of the differential amplifier. This establishes
                                         bandwidth limitation with the aid of an active phantom zero. These tech---
Figure 12.68: Conceptual design of the   niques have been discussed in sections 12.2.9 and 12.2.7, respectively.++
motor driver amplifier.
                                            The above design approach can also be used if the single-pole high-efficiency
                                         power amplifier is applied as the final stage in the controller. Figure 12.68
                                         shows the concept in which the impedance Rm + sLm represents the small-
                                         signal motor impedance. If the nullor were to be implemented with a single-
                                         pole operational amplifier and an active phantom zero in the differential
                                         voltage amplifier, the gain would show three poles while the servo function
                                         would be second order.22 One extra phantom zero will be required to give
                                         the servo function an MFM characteristic.

                                         DAC       ++
                                                   --

                                         Nested control

                                         The design approach sketched above cannot always be applied. This is be-
                                         cause active phantom zero compensation and bandwidth limitation with the
                                         aid of phantom zeros are two techniques that increase the effect of non-
                                         dominant poles. Particularly if the load impedance varies over a wide range,
                                         it may become difficult to establish robust control in this way.

                                            A more robust control can be obtained by designing a controller with an
                                         accurate and programmable dynamic performance. This can be done as fol-
                                         lows:

                                         1. The static error of the transfer will be zero if the controller has an integrat-
                                            ing character at low frequencies.

                                         2. The bandwidth of the system will not depend on the load impedance if
                                            the product of the loop gain and the dominant poles does not depend on
                                            the motor impedance.
                                                                                                       12.9. NESTED CONTROL 445

3. The pole due to the motor inductance can be compensated for in the con-
   troller. This can be done by creating a programmable zero in the transfer
   of the controller.

4. The low-frequency loop gain variation due to Rm can be compensated for
   by making the controller gain programmable.

    When designed in this way, the controller gain Ac(s) becomes

                   Ac(s) = A Rs + Rm                 s Lm + 1 .                            (12.86)
                               s Rs                   Rs + Rm

    With this controller gain, we obtain a loop gain L(s):23                                           23 The gain of a controlled source that
                                                                                                       implements the nullor has been taken as
                                     L(s) = A A0 s 1 + s Ad.                               (12.87)     loop gain reference.

   If the pole of the voltage amplifier is dominant, the bandwidth B of the                            Figure 12.69: Conceptual design of the
transfer can be obtained as                                                                            motor driver amplifier.

                                B= 1            AA0 Ad [Hz].                               (12.88)
                                      2            

   This yields a design equation for the integrator gain. The poles of the
servo function can be brought into MFM positions with the aid of a phantom
zero in Ad.

          DAC

                                                     ++
                                                     --

                                                --
                                                ++

    Figure 12.69 shows a more detailed concept of an inverting motor driver

with nested control. The integrator gain is fixed with the aid of Ci. The zero
at s = - Rz1Ci should coincide with the pole caused by the motor impedance.
For this reason, Rz has been made adjustable. The controller gain can be

adjusted with the aid of the relative potentiometer setting x. A phantom zero
                1
at  s  =           brings  the  two  poles  of  the  servo  function  into  MFM            positions.
          - RcCc
    In terms of classical control theory, the part of the circuit that consists of

the differential voltage amplifier with gain Ad and the nullor with Rc, Cc,

Ci and Rz can be regarded as a PID-controller. The Proportional action has

been implemented with Rc and Rz, the Integration action with Ci, and the
Differentiation action with Cc. The controller gain Ac = VVod can be obtained as

          Ac = Vo V = -A d d (1 + sCi Rz) (1 + sCcRc) Rb + xRa A0 sC . i Rc Rb + Ra 1 + s  (12.89)

   The gain of the amplifier can be changed by changing the value of Ri or of
the DAC reference voltage Vre f .
446 FREQUENCY COMPENSATION

                                                      The transfer of the controller gain has been fixed accurately with the
                                                  aid of local feedback amplifiers. The frequency of the zero that should
                                                  cancel the pole of the load can be adjusted by making Rz programmable
                                                  using a digitally controlled potentiometer. The controller gain can be ad-
                                                  justed with another digitally controlled potentiometer. Aside from the de-
                                                  sign equations that follow from the required transfer, the controller gain and
                                                  the motor impedance, budgets should be defined for the influence of non-
                                                  dominant poles. Non-dominant poles may be introduced by the nonzero
                                                  output impedances the nonzero input capacitances of the amplifiers. The cir-
                                                  cuit should be dimensioned such that the influence of non-dominant poles is
                                                  kept within acceptable limits.

                                        12.9.2 Increasing bandwidth without adding dominant poles

                                                  Sometimes, it is not possible to find operational amplifiers that combine a
                                                  sufficiently large gain bandwidth product with other performance aspects
                                                  that are relevant for the controller. There are two approaches to solving this
                                                  problem:

                                                  1. Split the over-all feedback amplifier into several cascaded over-all feed-
                                                      back amplifiers. This generally results in more design flexibility.

                                                  2. Use several cascaded amplifiers within the over-all feedback loop. In order
                                                      to limit the number of dominant poles in this loop, apply local feedback
                                                      or pole-splitting techniques in one or more of these amplifier stages.

Figure 12.70: Dual stage transimpedance                              +     -
amplifiers:                                    --
                                               +                           +  +
    A: A feedback transimpedance am-
plifier cascaded with a feedback voltage                                      -
amplifier

    B: An over-all feedback transimpedance
amplifier with a two-stage controller.

                                            A                           B

                                               Figure 12.70 illustrates the two design approaches. If both circuits exhibit
                                            equal over-all transimpedance gain, equal second stage voltage amplifiers
                                            and equal first stage operational amplifiers, the noise performance of the
                                            circuit from Figure 12.70B will be better than that of the circuit from Figure
                                            12.70A.

                                               If, in the circuit from Figure 12.70B, the bandwidth of the voltage amplifier
                                            is much larger than that of the servo function of the over-all loop, the voltage
                                            gain of this amplifier will contribute to the loop gain poles product of the
                                            over-all loop without adding dominant poles.

                                            12.9.3 Interaction with other performance aspects

                                            The application of over-all feedback with a single controller and phantom
                                            zero frequency compensation usually results in the best possible performance.
                                            However, if there are many dominant poles, this design approach may result
                                            in a too complex dynamic behavior. In those situations, nested loop control
                                            may be a useful design approach. With nested loop control, the impedances
                                            inserted into the signal path of the local feedback stages usually have a larger
                                            impact on other design aspects than the feedback impedances in the over-all
                                            design would have. Special care should be taken inserting integrators within
                                            an over-all feedback loop. Clipping of one of the other stages in the loop
                                                   12.10. COMPENSATION FOR OPEN AND SHORTED PORTS 447

may result in so-called integrator windup, which may seriously degrade the

overdrive recovery behavior.24                                                          24 Integrator windup is a term used in

                                                                                        control theory to indicate the charge

                                                                                        accumulated in the integrator during

                                                                                        overdrive.

12.10 Compensation for open and shorted ports

The source impedance and/or the load impedance of an amplifier may be
subjected to large changes. Those changes may be the result of varying op-
erating conditions or due to defects. Shorted or interrupted connections at
the amplifier ports are common defects that have to be considered during de-
sign. Such defects may result in a considerable change in the loop gain and
cause instability. Unstable behavior and oscillations may cause permanent
damage to the amplifier due to increased power losses. In practice, a shorted
port will never be terminated with zero impedance and a disconnected port
will never be terminated with an infinite impedance. During these fault situa-
tions unpredictable parasitic impedances will determine the port termination
impedance.

   According to the definition of stability, the amplifier will be stable for all
possible port terminations if, for all these terminations, the poles are located
in the left half of the complex plane. Frequency compensation techniques that
have been discussed in this chapter can be applied to achieve this. However,
performing root-locus analysis and frequency compensation for an unlim-
ited number of port terminations is not doable. It is far better to perform
these analyses and apply frequency compensation techniques only for nor-
mal operating conditions. Additional corrective measures can be taken to
ensure stability under fault conditions. In this section, we will discuss such
measures.

12.10.1 Compensation of shorted ports

In a case of a shorted port or a port terminated with a relatively low impedance,

it is useful to study the real part of the port impedance of the amplifier:25           25 A relatively low termination impedance

                                                                                        has a magnitude smaller than that of the

                                                                                        typical termination impedance.

    An amplifier is stable for all port termination impedances if the real part of the
port impedance is positive for all frequencies.

Hence, in order to check the stability for relatively low termination impedances,

we need to study the real part of the output impedance. The test benches for

determination of the input and output impedances have been defined in sec-

tion 2.3.3.

If, in some frequency range, the real part of the port impedance is neg-

ative, stable short circuit behavior can be ensured by placing a correction

impedance in series with the port. This series impedance should establish a

positive real part of the corrected port impedance at all frequencies.

If no positive feedback has been applied at DC, the DC output resistance

will usually be positive. Correction of a possible negative real part of the port       Figure 12.71: Network that can be be
impedance at higher frequencies can then be achieved by inserting a parallel            inserted between the output port and the
LR network in series with the amplifier port. This is shown in Figure 12.71.            load or between the input port and the
The real part of the admittance of this network is positive and has a high-pass         source to protect for short circuit instability.

character:                              RL22 2

                          Re (Zse) = R             2.                         (12.90)
                                        1 + LR2 2

Hence,  it  can  provide  effective  compensation  for  frequencies  above    =  R.

                                                                                 L
448 FREQUENCY COMPENSATION

26 A relatively high termination impedance       12.10.2 Compensation of open ports
has a magnitude larger than that of the
typical termination impedance.                   In a case we leave the port of the amplifier open or terminate it with a rel-
                                                 atively high impedance,26 it is easier to consider the real part of the port
                                                 admittance of the amplifier:

                                                     An amplifier is stable for all port termination admittances if the real part of the
                                                 port admittance is positive for all frequencies.

                                                 If, in some frequency range, this real part is negative, we can ensure open

                                                 circuit stability by placing a correction admittance in parallel with the port.

                                                 This parallel admittance should establish a positive real part of the corrected

                                                 port admittance at all frequencies.

                                                 If no positive feedback has been applied at DC, the DC output conductance

Figure 12.72: Network that can be be             will usually be positive. Correction of a possible negative real part of the port
inserted between the output port and the
load or between the input port and the           admittance at higher frequencies can then be achieved by placing a series RC
source to protect for open circuit instability.
                                                 network in parallel with the amplifier port. This is shown in Figure 12.72.

                                                 The real part of the admittance of this network is positive and has a high-

                                                 pass character:

                                                                                 1 2R2C2  (12.91)
                                                                  Re Yp = 2 2 2 .

                                                                                R R C +1

                                                    Hence, it can provide effective compensation for frequencies above  =
                                                 1.

                                                 RC

                                                 12.11 Influence of non dominant poles

                                                 Non-dominant poles are poles that do not contribute to the bandwidth of the
                                                 servo function. They do not significantly change the dynamic response of the
                                                 amplifier if their frequency is much larger than the bandwidth of the servo
                                                 function. If not, extra measures have to be taken to reduce their influence.
                                                 All high-frequency compensation techniques discussed in this chapter can be
                                                 applied for this purpose.

                                                 12.11.1 Bandwidth limitation with phantom zeros

                                                 Although bandwidth limitation with the aid of phantom zeros is a powerful
                                                 technique, care has to be taken while applying it. The increase of the loop
                                                 gain and of the servo bandwidth established by the phantom zero may turn
                                                 non-dominant poles (before compensation) into dominant ones. This may
                                                 pose limits to the application of this technique.
                                                      449

13 Local feedback stages

13.1 Introduction                                450

13.1.1 Local feedback amplifier stages           450

13.1.2 This chapter                              450

13.2 Direct feedback stages                      451

13.2.1 Nonenergic feedback stages                451

13.2.2 Common Drain Stage                        452

13.2.3 Common Gate Stage                         458

13.2.4 Passive feedback stages                   461

13.3 Application of balancing                    462

13.3.1 Local feedback with balanced CS stage     462

13.3.2 Balanced local feedback amplifier stages  462

13.4 Indirect feedback stages                    463

13.4.1 Current mirror                            463

13.4.2 Voltage mirror                            463
450 LOCAL FEEDBACK STAGES

               Nullor                      13.1 Introduction

           in              out             In Chapter 5, we have learned that a properly biased CS stage can provide
                                           a large available power gain. We studied the noise behavior, the dynamic
        NMOS CS stage                      behavior and the nonlinear behavior of this basic amplifier stage.

        +              +                      We have seen that the noise addition of the stage can be minimized through
                                           optimization of the device geometry and the operating current.
        in out
                                              After studying the small-signal dynamic behavior of the stage driven from
        -              -                   and loaded with an R C network, we found that if the parasitic feedback
                                           capacitance cdg is much smaller than the total input capacitance and the total
        PMOS CS stage                      output capacitance, the product of the poles equals the product of the eigen-
                                           frequencies of both RC networks, while, if the stage has a high low-frequency
        +              +                   voltage gain, the parasitic feedback capacitance largely influences the sum of
                                           the poles.
        in out
                                              The nonlinear behavior of the CS stage is governed by the voltage depen-
        -              -                   dency of the active capacitance, the current dependency of the transconduc-
                                           tance factor and the voltage dependency of the output impedance.
Complementary parallel CS stage
                                              Aside from these performance limitations, the CS stage does not show
    +                           +          natural two-port behavior because the input port and the output port share
                                           one terminal.
    in                          out
                                              In Chapter 6, we introduced balancing techniques such as complementary-
    -                           -          parallel connection and anti-series connection of CS stages. Application of
                                           these techniques yields odd transfer functions with a reduced sensitivity for
Figure 13.1: Three-terminal nullor and CS  even order effects, such as, threshold voltage mismatch and drift. In addi-
stage approximations.                      tion, anti-series connected CS stages provide improved port isolation, while
                                           complementary-parallel connections provide a current drive capability that
                   Nullor                  exceeds its quiescent operating current. We found that application of bal-
                                           ancing techniques does not result in a significant change of the small-signal
               in          out             dynamic behavior, the gain accuracy, the odd nonlinearity and the noise be-
                                           havior.
           anti-series CS stages
                                           13.1.1 Local feedback amplifier stages

                                           Negative feedback is considered a much more powerful error reduction tech-
                                           nique than compensation. Negative feedback uses a controller to minimize
                                           the error between actual transfer and the desired transfer of an amplifiers.
                                           Through application of negative feedback, the dependency of the source-to-
                                           load transfer from the controller properties can theoretically be reduced to
                                           zero. This will be the case if the controller is a natural two-port with an in-
                                           finite available power gain. The nullor is the network concept of the ideal
                                           controller.

                                              In this chapter, we will study the design of so-called local feedback am-
                                           plifier stages. These stages are negative feedback amplifiers of which the
                                           controller is implemented with a single transistor CS stage, or its balanced
                                           version. Figure 13.1 shows the implementation of a nullor with NMOS or
                                           PMOS CS stages or with a complementary-parallel CS stage. Figure 13.2
                                           shows the implementation of the nullor with anti-series connected NMOS or
                                           PMOS CS stages. In both figures, the transistors are assumed to be biased;
                                           their bias sources have been omitted.

                   -                 -

+ out + out                                13.1.2 This chapter

in                     in                  In this chapter, we will discuss design and the behavior of local feedback
                                           amplifier stages. Local feedback amplifier stages can be applied as single-
-                      -                   stage amplifiers or as amplifier stages in multiple-stage feedback amplifiers.

                   +                 +

Figure 13.2: Nullor and approximations
with anti-series CS stages.
                                                                                                  13.2. DIRECT FEEDBACK STAGES 451

Prerequisite knowledge
The design of negative feedback amplifiers using operational amplifiers as
controllers has been described in Chapter 7 to Chapter 12.

1. The synthesis of feedback amplifier configurations
2. The modeling of feedback circuits
3. The relation between the controller performance and the amplifier perfor-

   mance
4. Frequency compensation techniques

   The reader is assumed to have a clear understanding of these topics.

This chapter
In section 13.2, we will discuss direct feedback stages. In section 13.4, we will
discuss feedback stages that use indirect feedback techniques. Section 13.3
will be devoted to the design of amplifier stages using both balancing and
feedback.

13.2 Direct feedback stages

In feedback amplifiers, the values of the nonzero transmission parameters
are established with feedback networks. Direct feedback is a technique in
which the input quantity of the feedback network is sensed at the load, and
the output quantity of the feedback network is compared with the source
quantity. This in contrary with indirect feedback or model-based feedback,
in which comparison or sensing is performed with a copy of the source or
the load signal, respectively.

   Feedback networks may comprise nonenergic network elements, passive
network elements or amplifiers (active elements).

13.2.1 Nonenergic feedback stages

                                                                                 Figure 13.3: Inverting nonenergic feedback

                                                                                 voltage amplifier:

                                                                                 Left: Concept with ideal controller

+  +  +                            +                                             Right: Controller implemented with

                                                                                 (biased) CS stage.

-  -  -                            -

   Nonenergic feedback stages use feedback network elements that have no         1 In this figure, the bias sources have been
energy storage and no dissipation. Such feedback elements do not adversely       omitted.
affect the noise performance and the power efficiency of the feedback ampli-
fier. Ideal transformers, gyrators, open circuits and short circuits are nonen-
ergic feedback elements.

   Figure 13.3 shows an example of a nonenergic feedback inverting voltage
amplifier. The bias sources in this figure have been omitted. In practice,
transformer feedback can only be applied over a limited frequency band.

   Figure 13.4 shows the concept of the nonenergic feedback voltage follower
and its implementation with a CS stage controller. This stage is known as the
common-drain stage or shortly the CD stage, because the drain is the common
terminal for the input port and the output port.1 Hence, the CD stage can be
considered a feedback version of the CS stage.
452 LOCAL FEEDBACK STAGES

Figure 13.4: Nonenergic feedback voltage

follower:

A. Concept with ideal controller                +

B. Controller implemented with (biased)

CS stage.                                       -        +

                                                   ++

                                                         -

                                                   -        -

                                             A        B

                                                In section 13.2.2, we will study the noise behavior and the small-signal
                                             dynamic behavior of the CD stage. We will see that the behavior of this
                                             stage can be related to that of the CS stage, simply by considering the error
                                             reduction capabilities of negative feedback.

Figure 13.5: Noninverting nonenergic
feedback current amplifier:

    Left: Concept with ideal controller
    Right: Controller implemented with
(biased) CS stage.

Figure 13.6: Nonenergic feedback current        Figure 13.5 shows an example of an inverting, nonenergic feedback current
follower:                                    amplifier, using transformer feedback. The bias sources in this figure have
                                             been omitted.
  Upper: Concept with ideal controller
  Lower: Controller implemented with CS         Figure 13.6 shows the concept of the nonenergic feedback current follower
stage.                                       and its implementation with a CS stage controller. This stage is known as
                                             the common-gate stage or shortly the CG stage, because the gate is the common
2 The bias sources in this figure have been  terminal for the input port and the output port.2 Hence, the CG stage can be
                                             considered a feedback version of the CS stage.
omitted.
                                                In section 13.2.3 we will study the noise behavior and the small-signal
                                             dynamic behavior of the CG stage. We will see that the behavior of this
                                             stage can be related to that of the CS stage, simply by considering the error
                                             reduction capabilities of negative feedback.

                                             13.2.2 Common Drain Stage

                                             The common drain stage, CD stage, or source follower is a nonenergic feed-
                                             back voltage follower. It exhibits parallel (voltage) sensing at the load and
                                             series (voltage) comparison at the source. The feedback network consists
                                             of a short circuit between the load and the inverting input of the controller
                                             and an open circuit between the inverting input of the controller and the
                                             ground. This feedback structure establishes A = 1 without affecting the
                                             other transmission parameters. The ideal voltage follower thus has zero out-
                                             put impedance and infinite input impedance.

                                                In this section, we will discuss the noise behavior and the small-signal
                                             dynamic behavior of the CD stage.

                                             Noise behavior

                                             Because the CD stage is a nonenergic feedback stage, its equivalent input
                                             noise sources equal those of its controller. The controller in the CD stage
                                             is a CS stage and the optimization of its noise behavior for capacitive and
                                             resistive source has been discussed in section 5.4. The conclusions for the
                                                                                                  13.2. DIRECT FEEDBACK STAGES 453

design of the noise performance of the CS stage are also valid for the CD
stage.

Small-signal dynamic behavior                                                                +
                                                                                                                                       +
The small-signal transfer from the source to the load can be analyzed in
different ways. A straightforward method is to model the stage with its                    -
small-signal equivalent network and use network analysis techniques to find                                                     -
the source-to-load transfer. Since the network is rather simple, one would be
able to derive design conclusions from this expression.                           Figure 13.7: Signal diagram (bias circuitry
                                                                                  not drawn) of a CD stage driven from a
   However, if we consider the CD stage a feedback version of the CS stage,       resistive source and loaded with an R C
the application of the feedback model provides much more design informa-          network.
tion. Evaluation of the asymptotic gain, the loop gain and the direct transfer
will provide clear design information for obtaining the desired transfer.         Figure 13.8: Small signal diagram of the
                                                                                  CD stage from Figure 13.7.
   We will study the small-signal dynamic behavior of a CD stage which is
driven from a resistive source and loaded with R C, with the aid of the
asymptotic gain feedback model. The analysis for different source and load
types proceeds in a similar way.

   Figure 13.7 shows the signal diagram of the CD stage. The biasing circuitry
has been omitted in the figure. The NMOS transistor is assumed to be biased
in the forward saturated operating region.

   Figure 13.8 shows the small signal equivalent circuit of the CD stage from
Figure 13.7.

+  +  -

-  -  +

Selection of the loop gain reference variable

In order to obtain meaningful results from the feedback analysis, the loop
gain reference variable should be selected in such a way that the controller
obtains nullor properties if the reference variable approaches infinity. If we
select gm as the loop gain reference variable, this will be the case at zero
frequency. At frequencies that differ from zero, the current through the para-
sitic feedback capacitance cgd does not approach zero for any value of V with
gm  . This implies that the asymptotic gain will not equal the ideal volt-
age gain and, as a consequence, the loop gain will not completely describe
the deviation of the source-to-load transfer from the ideal transfer. This hin-
ders a two-step design approach in which we first design the ideal gain of
an amplifier, and then design the controller in such a way that brings the
accuracy and the linearity to their desired values over the frequency range of
interest.

Asymptotic gain and ideal gain

The asymptotic gain can easily be found from network inspection if the circuit
is redrawn as shown in Figure 13.9.

   The parasitic feedback capacitance is now placed outside the controller.
Together with the source resistance it establishes a first order low-pass filter
in front of the modified CD stage. If we now select gm as loop gain reference,
the modified controller behaves as a nullor. This can be seen as follows: if
gm approaches infinity, the voltage across cgs approaches zero. If the voltage
across cgs approaches zero, the current through it also approaches zero. Since
the voltage across cgs is the input voltage of the controller and the current
454 LOCAL FEEDBACK STAGES

Figure 13.9: Small signal diagram of the                                                 controller

CD stage from Figure 13.8 redrawn with                                                                                             -

the feedback capacitance cgd outside the            +                 +

controller. This easies the calculation of the                                                                                     +

asymptotic gain from network inspection.            -                 -

                                                through cgs is the input current of the controller, the controller behaves as a

                                                nullor for gm  . Hence, the asymptotic gain of the modified CD stage

                                                equals its ideal gain. The asymptotic gain of the complete CD stage is thus

                                                found as              A f  = V                  = 1 [-].

                                                                                   Vs A 1 + sRscgd                                    (13.1)

                                                   From this expression we may conclude that the influence of any signal de-

                                                pendancy of Rs and/or cgd on the source-to-load transfer will not be reduced
                                                by negative feedback.

                                                Evaluation of the loop gain

Figure 13.10: Small signal diagram of the                                                                           +
CD stage from Figure 13.8 redrawn for
evaluation of the loop gain. -

                                                    Figure 13.10 shows the circuit for evaluation of the loop gain L = A.

                                                According to the asymptotic-gain model, where, in this case,  is defined

                                                as                                 = Vi [].

(1)  (2)                                                                                                                              (13.2)

          +                                                                                Ic Vs=0
          -
                                                    Figure 13.11 shows the equivalent circuit for evaluation of the loop gain,
                                                                                                                           R
                                                drawn    in  a  more  convenient   way.    The  total   load  resistance       is  defined  as
                                                                                                                             

Figure 13.11: Alternative way of drawing                              1 = gmb + 1 + 1 [A/V].                                          (13.3)
the circuit from Figure 13.10.                                        R                    ro R

                                                    The  total  load  capacitance  C   is  defined      as

                                                                                     

                                                                                   C   =   C    +  csb  [F].                          (13.4)

                                                                                     

                                                DC loop gain

                                                The DC value of the loop gain LDC can be found from network inspection

                                                                                   LDC = -gmR [-].                                    (13.5)

                                                    It has its maximum value LDC max if R = :

                                                                      LDC max = - gm = -                      1                       (13.6)
                                                                                   gmb + go                        1 [-],
                                                                                                            n-1+ µ

3 Binkley, David M. Tradeoffs and Optimiza-     where n is the substrate factor and µ the low-frequency voltage gain fac-
tion in Analog CMOS Design. John Wiley &
Sons Inc., 1997. ISBN: 978-0-470-03136-0        tor. The substrate factor varies with the source-to-bulk voltage. For a 180nm

                                                NMOS devices the substrate factor varies between 1.15 and 1.35 (see Bink-
                                                ley[Binkley2008]3). The intrinsic voltage gain µ strongly depends on the
                                                                                                  13.2. DIRECT FEEDBACK STAGES 455

channel length and on the inversion coefficient.
   A high substrate factor, or body effect strongly limits the loop gain in the

CD stage. With n = 1.35 the maximum achievable DC loop gain is -2.86.
This limits the DC voltage gain of the follower to 0.74.

Poles and zeros

The loop gain also comprises two poles and one zero. The zero z is caused

by the parallel branch in series with the signal path formed by Rs Cgd, as
shown in Figure 13.11. We find

                              z = - 1 [rad/s].                                    (13.7)
                                      Rscgd

   This zero coincides with the pole in the asymptotic gain, which makes it a
phantom zero.

   The values of the two poles of the loop gain depend on the specific element
values. Their product and their sum can be found from symbolic analysis of
the loop gain.

   The MNA equation of the circuit from Figure 13.11 can be written as

                  R1 + R1s + s C + cgd                    1 - scgd     
                                                                              V1
     Ic  =                                             - Rs  . (13.8)

     0                 -1     - scgd              R1s + s cgs + cgd V2

                          Rs

    The loop gain L with reference variable gm is defined as

                              L = gm -V2 [-].                                     (13.9)
                                         Ic

    After solving the equations (application of Cramer's rule) we obtain

L=-                                   R gm 1 + sRscgd                                          [-].

         1+s  Rs  cgd + cgs   + R          C   +  cgs  +  s2   R   Rs  cgdcgs + C cgd + C cgs

                                                                 

                                                                                  (13.10)

    Let us now study the small-signal dynamic behavior, for cases in which

the feedback capacitance is negligibly small:

                              cgd  cgs and cgd  C .                               (13.11)

    In that case, the product of the two poles p1 and p2 can be approximated

by

                           p1 p2 =   1 [rad2/s2].                                 (13.12)
                                     R RsCcgs

    The sum of the poles can then be approximated by

                                           1      C    +  cgs

                                                    
                       p1 + p2 = -   -  [rad/s].                                  (13.13)
                                      RC RsCcgs

Achievable bandwidth

If both poles are dominant, the bandwidth B of the voltage transfer of the CD
stage can be estimated from

                           B = (1 - LDC) p1 p2 [rad/s].                           (13.14)

    If the body effect causes the dominant limitation of the loop gain, we have
     - 1               R      1 gm(n-1) .                              2cgs gm , the maximum
LDC               and                      If we also use      fT  
             n-1         

achievable bandwidth of an RC loaded CD stage, driven from a resistive
456 LOCAL FEEDBACK STAGES

                           source, is approximately:

                                                      B   2n fT [Hz].   (13.15)
                                                                Rs C

                              Hence, if we need to drive a capacitance C from a source with an internal
                           resistance Rs, a CD stage placed between source and load will increase the
                           bandwidth of the voltage transfer if 2n fT RsC > 1.

                              Although the DC loop gain in the CD stage is relatively low, the poles of
                           the voltage transfer may become complex, and frequency compensation for
                           MFM behavior may be required. In such cases, phantom zero compensation
                           can be achieved through insertion of a capacitance in parallel with the input
                           of the CD stage.

                              In the following example we will demonstrate phantom zero compensa-
                           tion by placing a capacitance in parallel with the input of the CD stage.

                              Example 13.1

                                  Let us study the behavior of a CD stage with an NMOS transistor fabricated
                              in a standard CMOS18 process. The bulk of the NMOS is connected to the
                              ground (see Figure 13.7). The transistor has a length of 1µm, a width of 4µm
                              and operates in the forward saturation region at a drain current of 250µA. The
                              CD stage is driven from a resistive source with a source resistance of 15k, and
                              drives a capacitive load of 250fF. The netlist of this circuit is shown below.

                           1 CDcompM18

                           2 XU1 0 2 out 0 CMOS18N W={W} L={L} ID={ID}

                           3 V1 1 0 V value=0 dc=0 dcvar=0 noise=0
                           4 R1 2 1 {R_s}
                           5 C1 out 0 {C_ell}
                           6 C2 2 0 {C_phz}

                           7 .lib C18.lib

                           8 .end

                                  We will evaluate the DC value, the poles, and the zeros of the source-to-load

                               transfer. The SLiCAP script that performs this analysis has been shown below:

                            1 #!/usr/bin/env python3
                            2 # -*- coding: utf-8 -*-
                            3 # File CDstageCompensation.py
                            4
                            5 from SLiCAP import *
                            6 fileName = 'CDcompM18'
                            7 prj = initProject(fileName)
                            8
                            9 # Create the netlist if you didn't do it before
                           10 #makeNetlist(fileName + '.asc', fileName)
                           11
                           12 # Create an instruction object
                           13 i1 = instruction();
                           14
                           15 # Define the circuit
                           16 i1.setCircuit(fileName + '.cir')
                           17 #
                           18 i1.defPar('W', '4u')
                           19 i1.defPar('L', '1u')
                           20 i1.defPar('ID', '250u')
                           21 i1.defPar('R_s', '15k')
                           22 i1.defPar('C_ell', '250f')
                           23 i1.defPar('C_phz', 0)
                           24
                           25 # Display the circuit information on an HTML page
                           26 htmlPage('Ciruit data')
                           27 head2html('Schematic diagram')
                           28 img2html(fileName + '.svg', 500)
                           29 netlist2html(fileName + '.cir')
                           30 params2html(i1.circuit)
                           31
                           32 i1.setSimType('numeric')
                           33 i1.setSource('V1')
                           34 i1.setDetector('V_out')
                                                                13.2. DIRECT FEEDBACK STAGES 457

35
36 # List the DC value, the poles, and the zeros of the gain
37 i1.setDataType('pz')
38 i1.setGainType('gain')
39 gainData = i1.execute()
40 listPZ(gainData)

       The results of the pole-zero analysis are shown below. As a result of the sub-
    strate effect, the loop gain is very low and the low-frequency gain of the CD stage
    is only 0.69. The poles are complex, but close to MFM positions:

1 DC value of gain: 6.88e-1

2

3 Poles of gain:

4

5 n Real part [Hz] Imag part [Hz] Frequency [Hz]         Q [-]

6 -- -------------- -------------- -------------- --------

70    -3.66e+08    -3.89e+08  5.34e+08 7.29e-1

81    -3.66e+08    3.89e+08   5.34e+08 7.29e-1

9

10 Zeros of gain:

11

12 n Real part [Hz] Imag part [Hz] Frequency [Hz]        Q [-]

13 -- -------------- -------------- -------------- --------

14 0  -5.75e+09    0.00e+00   5.75e+09

       The poles can be brought into MFM positions by adding a phantom zero ca-
    pacitance Cphz in parallel with the input of the CD stage. It effectively increases
    cdg of the transistor.

42 i1.defPar('C_phz', '1.7f')
43 # List the DC value, the poles, and the zeros of the gain after compensation
44 i1.setDataType('pz')
45 i1.setGainType('gain')
46 gainData = i1.execute()
47 listPZ(gainData)

      With Cphz = 1.7fF the poles are in MFM positions:

1 DC value of gain: 6.88e-1

2

3 Poles of gain:

4

5 n Real part [Hz] Imag part [Hz] Frequency [Hz]         Q [-]

6 -- -------------- -------------- -------------- --------

70    -3.67e+08    -3.67e+08  5.19e+08 7.07e-1

81    -3.67e+08    3.67e+08   5.19e+08 7.07e-1

9

10 Zeros of gain:

11

12 n Real part [Hz] Imag part [Hz] Frequency [Hz]        Q [-]

13 -- -------------- -------------- -------------- --------

14 0  -5.75e+09    0.00e+00   5.75e+09

       The zero in the voltage transfer is due to the direct transfer . This transfer
   has a first order low-pass character. This can be seen from network inspection by
   taking gm = 0 in Figure 13.9. At very high frequencies, the transfer equals the
   direct transfer and the order of the high-frequency roll-off changes from two to
   one. This causes the zero at this transition frequency.

       Figure 13.12 shows the Bode plots of the transfers of the asymptotic-gain model
   after compensation. It clearly shows the low value of the loop gain, which is the
   result of the substrate effect, and the influence of the direct transfer as described
   above.

   The substrate effect of back-gate effect limits the loop gain in the CD stage.
Much larges values of the loop gain can be obtained, if the bulk of the MOS
transistor can be isolated from the substrate, and connected to the source.
This, however, may also increase the load capacitance of the stage with the
relatively large bulk-substrate capacitance. In such situations phantom zero
compensation as described above, may be required.
458 LOCAL FEEDBACK STAGES

Figure 13.12: Bode plots of the transfers of
the asymptotic-gain model, of the CD stage
from Figure 13.7

                                        13.2.3 Common Gate Stage

                                                  The common gate stage (CG-stage) is a nonenergic feedback stage with series
                                                  (current) sensing at the load and parallel (current) comparison at the source.
                                                  The feedback network consists of a short circuit between the inverting output
                                                  of the controller and the source, and an open circuit between the inverting
                                                  output of the controller and the ground. This feedback structure establishes
                                                D = 1, without affecting the other transmission parameters. The ideal current
                                                  follower thus has an infinite output impedance and zero input impedance.

                                                      In this section we will discuss the noise behavior and the small-signal
                                                  dynamic behavior of the CG stage.
                                                  Noise behavior
                                                  The CG stage is a nonenergic feedback stage. Hence, its equivalent input
                                                  noise sources equal those of the controller. The controller in the CG stage
                                                  is a CS stage and the optimization of its noise behavior for capacitive and
                                                  resistive source has been discussed in section 5.4. The conclusions for the
                                                  design of the noise performance of the CS stage are also valid for the CG
                                                  stage.
                                   13.2. DIRECT FEEDBACK STAGES 459

Small-signal dynamic behavior                                                           Figure 13.13: Signal diagram (bias circuitry
                                                                                        not drawn) of a CG stage driven from an
Similar as with the CD stage, the small-signal transfer from the source to              R C source and loaded with an R C
the load can be analyzed using network analysis techniques. However, if we              network.
consider the CG stage a feedback version of the CS stage, and we apply the
asymptotic gain model for performance analysis, we will obtain much more                Figure 13.14: Small signal equivalent circuit
design information.                                                                     of the CG stage from Figure 13.13.

   We will study the small-signal dynamic behavior of a CG stage driven
from a current source with an internal impedance that consists of Rs Cs, and
loaded with R C. The analysis for different source and load types proceeds
in a similar way.

   Figure 13.13 shows the signal diagram of the CG stage. The biasing cir-
cuitry has been omitted in the figure. The NMOS transistor is assumed to be
biased in the forward operating region.

   Figure 13.14 shows the small-signal equivalent circuit of the CD stage from
Figure 13.13.

                                -
                                +

Selection of the loop gain reference variable                                           Figure 13.15: Alternative way of drawing
                                                                                        the circuit from Figure 13.14. It clearly
In order to obtain meaningful results from the feedback analysis, the loop              shows the series feedback at the load (load
gain reference variable should be selected in such a way, that the controller           current sensing) and the parallel feedback
obtains nullor properties if the reference variable approaches infinity. If we          at the soure (source current comparison).
select gm as loop gain reference, this will be the case at zero frequency. How-
ever, the capacitance cgd + cdb appears in parallel with the load. Its influence
cannot be reduced by increasing the loop gain to infinity. This can be seen
by redrawing the circuit as depicted in Figure 13.15. This figure shows that
the capacitance cgd + cdb establishes an attenuator between the output of the
controller and the load.

                                                                            controller

                                                  -

                                                         +

Asymptotic gain and ideal gain

The asymptotic gain can be found from network inspection using the circuit
representation from Figure 13.15. The sum of the two transconductances is
selected as loop gain reference:

A = gm + gmb [-].                  (13.16)

If A   the controller behaves as a nullor and the asymptotic gain Ai
460 LOCAL FEEDBACK STAGES
                                                  is found as

                                                                             Ai = I = 1 + sRC [-].                                   (13.17)
                                                                                      Is A 1 + sR C + cgd + cdb

                                                            Evaluation of the loop gain

                                                            Figure 13.16 shows the equivalent circuit for evaluation of the loop gain.
                                                            According to the asymptotic gain model,  is defined as

                                                                              = Vi                    [A/V].                         (13.18)
                                                                                             Ic Is=0

                                                         +     In order to obtain compact expressions we use the representation from
                                                            Figure 13.17
                                                  -
                                                               The MNA equations in matrix form can be formulated as
Figure 13.16: Circuit for evaluation of the
loop gain of the CG stage from Figure                       - Ic             1 + 1 + sC               -1                V1 V2 .
13.15.                                                                       = R ro                      ro                          (13.19)

              (1)                                                        Ic  -1                1 + 1 + sCs
                                                                                         ro    Rs ro
                                                +
                                                            The loop gain L with reference variable gm + gmb is defined as
         (2) -
Figure 13.17: Compact representation of                                      L = (gm + gmb) -V2 [-].                                 (13.20)
the circuit for evaluation of the loop gain of                                                      Ic
the CG stage from Figure 13.15.
                                                            After solving the equations (application of Cramer's rule) we obtain

                                                            L = - Rsro (gm + gmb)                     1  +    sC    R                 [-].
                                                                      Rs + ro + R 1 + s
                                                                                                                  

                                                                                             Cs Rs(ro +R) C R(Rs+ro )   
                                                                                                                        2 CsC Rsro R
                                                                                              Rs+ro+R + Rs+ro+R         + s Rs+ro+R

                                                                                                                                     (13.21)

                                                            DC loop gain

                                                            The DC loop gain is found as

                                                                             LDC = - Rsro (gm + gmb) Rs + ro + R [-].                (13.22)

                                                               Under ideal drive and load conditions: Rs   and R  0, the DC loop
                                                            gain obtains its maximum value Lmax,which equals

                                                                             Lmax = -ro (gm + gmb) [-].                              (13.23)

                                                            This can be written as the product of the substrate factor and the voltage

                                                            gain factor

                                                                                             Lmax = -nµ [-].                         (13.24)

                                                               Under the given conditions, the current gain Ai of the CG stage equals
                                                            unity, even though the loop gain is not infinite. This is because under ideal
                                                            drive and load conditions, the direct transfer  equals unity. According to the

                                                            asymptotic gain model we obtain the source-to-load transfer as

                                                                             Ai = Ai -L 1 - L +  1 - L [-].                          (13.25)

                                                               Under ideal drive and load conditions we have  = 1, which yields Ai =
                                                            Ai = 1.
                                                                                                           13.2. DIRECT FEEDBACK STAGES 461

Poles and zeros

The poles and the zeros of the loop gain can be found from (13.21). This

expression shows that the loop gain has one zero and two poles. If R 

ro + Rs, one of the poles coincides with the zero and the loop gain has a first
                                                        ro +Rs
order  low-pass  character  with  a  pole  at  s  =             .  Hence,  it                       is  determined
                                                     - r R C
                                                        o ss
by the parallel connection of ro, Rs and Cs . The bandwidth B of the current

gain is then found from the first order loop gain poles product:

B = 1 + roRs (gm + gmb)                           ro + Rs          [rad/s].                                (13.26)

                 Rs + ro             ro Rs Cs + cgs + cgb + cbs

If the DC loop gain is much larger than unity, this may be simplified to

                 B = gm + gmb [rad/s].                                                                     (13.27)
                       Cs + cgs + cgb + cbs

   Hence, if the stage is driven from a high impedance (Cs + cbs  cgs), and
it is terminated with a low impedance (R  ro + Rs), the bandwidth equals
about T of the transistor.

   This makes this stage very well suited as a high-frequency buffer between

two CS stages. This application will be discussed at a later stage.

13.2.4 Passive feedback stages

The CD stage and CG stage are two nonenergic negative feedback stages that
have the CS stage as controller. We will now discuss single-transistor pas-
sive feedback stages. The synthesis of amplifiers exploiting passive feedback
has been discussed in Chapter 7. Passive feedback stages use feedback net-
works that consist of passive elements. Due to energy storage and/or power
dissipation, and due to noise generation or signal attenuation, the power ef-
ficiency and the noise performance of passive feedback amplifiers are not as
good as those of nonenergic feedback amplifiers.

   Figure 13.18 gives an overview of passive feedback amplifier stages that
have a CS stage as controller. The following stages are shown:

+                                                      -                                                            -
                                                                                                                    +
                 +                                          ++                                          +                                                 -+
                 -                                                                                                                                             +
-
                                                                                       -
                 -+                                  -                                                  -           -

                                                                                                 +

A                B                                   C                                                  D           E

                                                                                                                                     Figure 13.18: Passive feedback stages with

A The series stage is a single-stage voltage to current converter. The impedance a CS stage as controller.
   Z1 senses the output current and converts it into a voltage that is sub-
   tracted from the input voltage. It establishes parameter B of the stage. It
   degrades the noise performance of the CS stage as if it is placed in series
   with the source. The power efficiency and the energy storage are affected
   as if this impedance is placed in series with the load. Due to the series
   feedback, the output impedance and the input impedance are both larger
   than those of the CS stage.

B The shunt stage is a single-stage current to voltage converter. The impedance
   Z1 senses the output voltage and converts it into a current that is sub-
   tracted from the input voltage. It establishes parameter C of the stage. It
462 LOCAL FEEDBACK STAGES

                                                      degrades the noise performance of the CS stage as if it is placed in parallel
                                                      with the source. The power efficiency and the energy storage are affected
                                                      as if this impedance is placed in parallel with the load. Due to the parallel
                                                      feedback, the output impedance and the input impedance are both smaller
                                                      than those of the CS stage.

                                                  C The gyrator-like stage exhibits series feedback at the input and at the out-
                                                      put as well as parallel feedback at the input and at the output. The feed-
                                                      back networks intentionally establish nonzero parameters for B and C of
                                                      the stage. However, due to interaction of the sensing and comparison net-
                                                      works, all four transmission parameters of the stage are determined by the
                                                      feedback networks, although not independently.

                                                  D The transformer-like configuration has the parameters A and D inten-
                                                      tionally fixed to a nonzero value by means of negative feedback. In this
                                                    configuration we have A = 1.

                                                E This version of the transformer-like configuration has D = 1.

                                 13.3 Application of balancing

                                                  Application of balancing techniques can be twofold:

                                                  1. The controller of the negative feedback amplifier consists of a balanced
                                                      stage (anti-series or complementary-parallel CS-stage).
                                                      Some examples of these configurations will be discussed in section 13.3.1.

                                                  2. A negative feedback amplifier consists of two anti-series or complementary-
                                                      parallel connected local-feedback stages.
                                                      Some examples of these configurations will be discussed in section 13.3.2.

                                        13.3.1 Local feedback with balanced CS stage

       +                                                   +

       -                                          +        -

    +                                          +        +

    -                                             -
A
                                               -        -

                                            B        C

Figure 13.19: Passive feedback stages with     Balanced amplifier stages can be applied as controller in negative feedback
an anti-series CS stage as controller.      amplifiers. Anti-series connected CS stages can be used as four-terminal con-
                                            trollers and complementary-parallel stages can be used as push-pull stages
                                            with a high current drive capability. Figure 13.19 shows some examples of lo-
                                            cal feedback stages with an anti-series connected CS stage as controller. The
                                            application of complementary-parallel connected stages as controller does
                                            not give new configurations than those with a single CS stage as controller.

                                            13.3.2 Balanced local feedback amplifier stages

                                            Anti-series connection of three-terminal local feedback stages can be applied
                                            to obtain amplifiers with floating ports. Figure 13.20A shows two anti-series
                                            connected series stages.
                                                          13.4. INDIRECT FEEDBACK STAGES 463

Figure 13.20B shows two complementary-parallel connected CD stages.                     +     -
                                                                                               +
This combination results in a voltage follower with high current source and
                                                                                           -
sink capability.                                                                 +

                                                                                 A-

13.4 Indirect feedback stages                                                                    +

Indirect feedback stages use indirect sensing and/or indirect comparison             B-
techniques. In case of indirect sensing, a copy of the load voltage or the load
current is sensed and converted by the feedback network. This generally is       Figure 13.20: Balanced local feedback
less accurate than direct sensing.                                               stages

   In case of indirect comparison, a copy of the source voltage or current is      A: Anti-series connection of two series
compared with the output quantity of the feedback network. In this section       stages
we will give two examples of indirect feedback stages: the current mirror and
the voltage mirror.                                                                B: Complementary parallel connection of
                                                                                 two CD stages.

13.4.1 Current mirror

Figure 13.21A shows the concept of an inverting current amplifier using indi-
rect feedback. A copy of the load current is sensed, attenuated and compared
with the source current. The source-to-load transfer can be found as

                  I = - Zi + Z2      Z1 Z2                (13.28)
                  Is     Z2
                                 A Z1+Zz + B
                                                    .

                                   AZ + B

                      +      +

                       A,B,C,D

                      --

                      +      +

                       A,B,C,D

A                     --

                                                       B                             C

   The above expression clearly shows that the ideal current transfer (nullor    Figure 13.21: Inverting indirect feedback
as controller) depends on the load impedance if Z = ZZ1 1+ZZ2z .                 current amplifier.

   Figure 13.21B shows an implementation of this concept with two CS stages.         A: Concept of an inverting current
This circuit is known as the current mirror and usually drawn as shown in        amplifier using indirect current sensing.
Figure 13.21C.
                                                                                     B: Implementation with unity gain
13.4.2 Voltage mirror                                                            feedback, while using the two port with
                                                                                 feedback as controller.
Figure 13.22A shows the concept of an inverting voltage amplifier that uses
indirect voltage comparison. The load voltage is directly sensed and attenu-         C: The circuit redrawn known as the
ated. The attenuated version of the load voltage is indirectly compared with     current mirror.
the source voltage.

   Figure 13.22B shows the implementation with two CS stages known as the
voltage mirror.
464 LOCAL FEEDBACK STAGES

                                                     +

                                                     -

    +  +  +                                 +  +                                                     +
                                                            +
    -  A,B,C,D                              A,B,C,D
                                                                                               -
A      --                                   --              -

                                                        B

Figure 13.22: Inverting indirect feedback
current amplifier.

    A: Concept of an inverting voltage am-
plifier using indirect voltage comparison.

    B: Voltage mirror: an implementation
with unity gain feedback, while using the
two port with feedback as controller.
                                                                 465

14 Multi-stage Feedback Amplifiers

14.1 Introduction                                           466

14.1.1 Summary of previous chapters                         466

14.1.2 This chapter                                         471

14.2 Controller design considerations                       472

14.2.1 Design of the input stage                            473

14.2.2 Design of the output stage                           473

14.2.3 Design of the number of stages                       474

14.2.4 Interconnection of stages                            476

14.2.5 Interconnection of controller and feedback networks  480

14.2.6 Cascode stages                                       481

14.2.7 Application of local feedback stages                 482
466 MULTI-STAGE FEEDBACK AMPLIFIERS

                                 14.1 Introduction

                                                  In this chapter, we will discuss the design of multi-stage negative feedback
                                                  amplifiers. We will formulate considerations for the design of the various per-
                                                  formance aspects of such an amplifier, and present a step-by-step approach
                                                  for the design of high-performance negative feedback amplifiers.

                                         14.1.1 Summary of previous chapters

                                         The design approach presented in this chapter is based upon the theory dis-
                                         cussed in the preceding chapters. We will briefly summarize the conclusions
                                         of these chapters below.

1 Diferential-mode and common-mode port  Modeling and characterization of amplifiers
impedances.
                                         In Chapter 2, we started with an introduction to amplifiers. We have seen
                                         that an amplifier has to provide its load with an amplified copy of the source
                                         signal. The word 'amplified' in this context means that the available signal
                                         power at the amplifier's output exceeds that of the source.

                                            We continued with the classification and characterization of amplifiers. We
                                         have seen that amplifiers can be classified according to their source and load
                                         characteristics. The appropriate amplifier type for a specific source and load
                                         can be found by answering the following questions:

                                         1. What would be the ideal value of the amplifier's input impedance, or
                                            alternatively, which electrical quantity of the source (current or voltage)
                                            should be taken as input quantity for the amplifier?

                                         2. What would be the ideal value of the amplifier's output impedance, or,
                                            alternatively, which electrical quantity should be used to drive the load?

                                         3. What is the desired source-to-load transfer that needs to be established?

                                         4. Which ports (input, output and power port) should be isolated with re-
                                            spect to each other?

                                         5. Is unilateral behavior required?

                                            The answers to these questions together define the functional behavior of
                                         the amplifier. They give us the ideal values of the required port impedances1
                                         and of the transfer characteristics. We have seen that the functional behavior
                                         of an amplifier can be described with the aid of two-ports. The Transmission-
                                         1 matrix parameters A, B, C and D, in conjunction with the source and load
                                         impedances, provide high-level descriptions for the source-to-load transfer
                                         and the port impedances of the idealized amplifier.

                                            Practical amplifiers suffer from non-idealities. Like all information pro-
                                         cessing systems, imperfections in their behavior arise as a result of the phys-
                                         ical limitation of speed and power, the addition of noise and imperfections
                                         in the physical operating principle used for their implementation. These im-
                                         perfections limit the amount of information that can be processed by the
                                         amplifier. We have seen that application-specific error description methods
                                         should be used to reflect the effects of the information processing errors, as
                                         they will be observed in the application.

                                            Another error source in amplifiers is the imperfect port isolation. It intro-
                                         duces susceptibility to power supply noise and common-mode noise. We
                                         have seen that the regularly used description methods with the (voltage)
                                         CMRR, the (voltage) common-mode rejection factor and the (voltage) PSRR
                                         are far from complete. Application-specific test benches are required to com-
                                         plete such specifications.
                                                                                  14.1. INTRODUCTION 467

Amplification mechanism

In Chapter 3, we studied the amplification mechanism. We have seen that
the application of specific passive devices together with (active) bias sources,
provide the means for building electronic amplifiers. Because of their ampli-
fying capabilities, such passive devices are usually called active devices.

Device modeling

In order to understand the amplification mechanism and its physical limita-
tions, we briefly discussed the construction, the operation and the modeling
of active devices in Chapter 4. We have seen that properly biased bipolar
junction transistors (BJTs), junction field-effect transistors (JFET) and MOS-
FETs can provide a large available power gain.

   In that chapter, we also presented simplified device models for symbolic
analysis. Such models can be used for finding methods to affect specific
behavioral aspects of interest by design and setting up design equations.

CS stage

The common-source (CS) stage can be considered as the basic MOS amplifier
stage; its performance is discussed in Chapter 5. When properly biased, this
stage provides a large available power gain. The name of this stage refers to
the fact that the source is the common terminal for the input port and the
output port. Hence, port isolation with this stage is not possible.

   The drain-gate capacitance causes non-unilateral behavior and may seri-
ously limit the bandwidth of the stage or the stage's contribution to the loop
gain-poles product in a negative feedback amplifier. Such effects can be kept
small by shorting the stage, while taking the short circuit output current as
information carrying quantity.

   The noise addition by a CS stage can be minimized by optimizing both its
device geometry and its drain current. In high-frequency applications, the
device should operate in strong inversion and at a high cut-off frequency. At
low frequencies, the influence of flicker-noise may become dominant and a
longer channel and a lower operating current may be optimal.

   The nonlinearity of the CS stage strongly depends on the frequency, the
drive and termination conditions and the operating conditions.

   The accuracy of the source-to-load transfer is limited due to fabrication
tolerances. All performance aspects of the CS stage depend on temperature.

CE stage

The common-emitter or CE stage can be considered as the basic three-terminal
BJT amplifier stage. The name of this stage refers to the fact that the emitter
is the common terminal for the input port and the output port. Hence, port
isolation with this stage is not possible.

   The collector-base capacitance causes non-unilateral behavior and may se-
riously limit the bandwidth of the stage or the stage's contribution to the
loop gain-poles product in a negative feedback amplifier. Such effects can be
kept small by shorting the stage, while taking the short circuit output current
as information carrying quantity.

   The noise addition by a CE stage can be minimized by optimizing its de-
vice geometry and its collector current. Low-noise amplification with a CE
stage requires a transistor with a large DC current gain factor, a high cut-off
frequency and a small base resistance.

   The nonlinearity of the CE stage strongly depends on the frequency and
the drive and termination conditions of the stage. At low frequencies, the
parameters A and D can have a relatively low differential-gain, while the pa-
468 MULTI-STAGE FEEDBACK AMPLIFIERS

                                                  rameter B is inversely proportional to the collector current and the parameter
                                                  C is proportional to the collector current. At high frequencies, the nonlinear-
                                                ity is strongly dominated by the nonlinear Q - V relations of the junctions
                                                  and the voltage and current dependency of the transit time.

                                                      Even when accurately biased, the accuracy of the small-signal source-to-
                                                  load transfer of a CE stage is limited due to fabrication tolerances. Since most
                                                  device parameters depend on temperature, all performance aspects of the CE
                                                  stage will be temperature dependent. Hence, accurate amplification with a
                                                  single CE stage is then only possible with properly selected devices over a
                                                  small temperature range.

2 Orthogonal design.  Single-stage amplifiers

                      In many RF applications, the accuracy and the temperature stability of the
                      gain are not the dominant requirements. In such applications, automatic
                      gain control is often used to stabilize the gain. Usually, low-noise and low-
                      distortion operation over a limited frequency range, is then of primary inter-
                      est. In such applications, and at low signal levels, a single CE stage or CS
                      stage amplifier may perform well enough.

                         Straightforward design of the different performance aspects of the CE
                      stage or the CS stage is only possible if design parameters can be found
                      that more or less independently fix the different performance aspects.2 Usu-
                      ally, we only have a limited number of design parameters at our disposal to
                      fix all kinds of different performance aspects. The most important design
                      parameters are:

                      1. The device type and geometry

                      2. The operating current

                      3. The operating voltage

                         With these three parameters we are not able to design all the performance
                      aspects independently. An extra degree of freedom can be obtained through
                      application of impedance transformation techniques at the source and/or at
                      the load. Impedance transformation can be implemented with wide-band
                      transformers, resonant networks or transmission lines.

                         In many situations the demand for high-quality information processing
                      requires improvement of performance of the CE or CS stage. Such improve-
                      ments can be obtained through application of error reduction techniques.

                      Balanced amplifier stages

                      In Chapter 6, we discussed the application of balancing techniques and intro-
                      duced the anti-series stage or differential pair and the complementary-parallel
                      stage or push-pull stage.

                         Balancing is a compensation technique will limited error reduction capa-
                      bilities. With balancing techniques, we can improve the following perfor-
                      mance aspects:

                      1. Linearity

                         Ideally, the anti-series and the complementary-parallel connection of CE or
                         CS stages have odd transfer characteristics. Even terms such as the offset
                         and its associated temperature drift are compensated. Differential-mode
                         bias sources are replaced with common-mode bias sources.

                      2. Port isolation
                                                                                   14.1. INTRODUCTION 469

   With the aid of anti-series connection of CE or CS stages, we obtain so-
   called differential pairs that can be considered as basic four-terminal am-
   plifier stages. They have improved isolation between the input port and
   the output port.

3. Power efficiency

   With the aid of complementary-parallel connected CE or CS stages, we
   obtain push-pull stages. These stages can source and sink currents that
   exceed the quiescent operating current of its constituting CE or CS stages.

   The odd order nonlinearity, the dynamic behavior, the noise behavior, as
well as the accuracy and the temperature dependency of the transfer, how-
ever, cannot be improved with balancing.

Negative feedback amplifiers

A significant improvement of the quality of the amplifier's signal transfer can
be obtained through application of negative feedback. Negative feedback is
a powerful error reduction technique in which available gain of amplifying
devices is used for quality improvement of the source-to-load transfer. Each
transmission parameter of a negative feedback amplifier can be given an ac-
curate value with the aid of a feedback loop around a high-gain controller.
The task of this controller is to nullify the error between the actual source-to-
load transfer and the one determined by the feedback networks.

   Negative feedback has stronger error-reduction capabilities than balanc-
ing. The noise performance and the influence of input offset and bias sources,
and the load drive capability cannot be improved by negative feedback, they
at best equal those of the controller. The accuracy, the linearity and the band-
width are at best determined by the feedback networks. Such networks can
be realized with accurate passive components.

   The synthesis of negative feedback amplifier configurations is discussed
in Chapter 7. All unilateral and non-unilateral, isolated and non-isolated
amplifier types that have been defined in Chapter 2, can be realized with
the aid of negative feedback. The basic synthesis techniques for negative
feedback amplifiers are:

1. Sensing of the load quantity

2. Design of a feedback network that converts the sensing result into an ac-
   curate copy of the source quantity

3. Comparison of this copy with the source quantity

4. Nullification of the comparison result with the aid of a high-gain con-
   troller.

   If nonenergic feedback elements are used, the noise performance and the
power efficiency of the negative feedback amplifier equal those of its con-
troller. Practical use of nonenergic feedback is often limited to unity-gain
feedback. Amplifiers with a gain that differs from unity are often realized
with passive feedback.

   Passive feedback networks increase the contribution of the equivalent in-
put noise sources of the controller to the total noise. If those networks com-
prise resistive elements, they also contribute noise themselves.

   Passive feedback networks may also contribute to the energy storage or
dissipation of the amplifier. As a result, the power efficiency of the amplifier
will be less than that of its controller.

   Not all amplifier configurations can be realized with the aid of passive
feedback around a single controller. This is because feedback elements that
470 MULTI-STAGE FEEDBACK AMPLIFIERS

                                                  behave as natural two-ports cannot be constructed using exclusively pas-
                                                  sive elements. Configurations that cannot be realized with passive feedback
                                                  around a single controller, can be realized with balanced feedback, active
                                                  feedback or indirect feedback techniques.

                                                      The design of the feedback configuration is the first step in the design of
                                                  negative feedback amplifiers. In this step the controller is assumed to have
                                                  nullor properties, which means that it has an infinite available power gain
                                                  and that it behaves as a natural two-port. The gain of a negative feedback
                                                  amplifier with a nullor as controller is called the ideal gain.

                                                  Feedback modeling

                                                  The second step in the design of negative feedback amplifiers, is the design
                                                  of the controller. This step requires knowledge about the relation between
                                                  the performance aspects of the controller and those of the negative feedback
                                                  amplifier which it is part of. The asymptotic gain model provides this infor-
                                                  mation; it is presented in Chapter 10. If the loop gain reference variable is
                                                  chosen such that an infinite loop gain turns the controller into a nullor, the
                                                  design of negative feedback amplifiers can be performed in two steps:

                                                  1. Design of the feedback network with a nullor as controller

                                                  2. Design of the controller

                                                  Controller design

                                                  In Chapter 11, we related the performance aspects of the controller to those
                                                  of the negative feedback amplifier. We obtained the following design conclu-
                                                  sions:

                                                  1. If the loop gain reference variable has been selected properly, the servo
                                                      function is a measure for the deviation of the source-to-load transfer from
                                                      the ideal gain. The servo function is completely defined by the loop gain,
                                                      which comprises contributions of the controller, the source impedance, the
                                                      load impedance and the feedback networks. The ideal value of the servo
                                                      function is unity.

                                                  2. The relative inaccuracy of the servo function at midband frequencies is
                                                      determined by the mid-band loop gain.

                                                  3. The low-pass cut-off frequency of the servo function is determined by the
                                                      product of the dominant poles of the loop gain and the midband value of
                                                      the loop gain.

                                                  4. The differential gain of the servo function at midband frequencies, equals
                                                      the ratio of the differential gain of the loop gain and the value of the loop
                                                      gain at mid-band frequencies.

                                                  Frequency compensation

                                                  With a sufficiently large loop gain-poles product, the negative feedback am-
                                                  plifier can obtain its required bandwidth. However, this does not mean that
                                                  the error with respect to the ideal behavior of the amplifier is small. For
                                                  this to be the case, the servo function should have an all-pole transfer with
                                                  its poles in, or close to MFM positions. In most cases we will have to ap-
                                                  ply frequency compensation techniques to manipulate the poles into these
                                                  positions. These techniques have been discussed in Chapter 12. We have
                                                  seen that compensation with phantom zeros minimally affects other perfor-
                                                  mance aspects, such as noise and over drive recovery, while maintaining the
                                                  bandwidth of the servo function close to its designed value.
                                                                                  14.1. INTRODUCTION 471

Local feedback amplifier stages
The application of negative feedback around a single CE or CS stage results
in local feedback stages. These stages have been studied in Chapter 13. Com-
monly used nonenergic local feedback stages are the emitter follower, the
source follower, the CB stage and the CG stage. Single-loop, single-transistor,
passive feedback stages are the series stage and the shunt stage. Dual-loop,
single transistor feedback stages, as well as stages that exploit indirect feed-
back, such as the voltage mirror and the current mirror, have also been in-
troduced in Chapter 13. Balanced, local feedback stages are obtained after
applying balancing techniques to the basic feedback stages.

   The properties of feedback stages can easily be predicted by considering
the behavioral modifications that are a result of negative feedback:

1. Each feedback loop fixes one transmission parameter.

2. Parallel feedback at a port reduces the port impedance (ideally to zero).

3. Series feedback at a port increases the port impedance (ideally to infinity).

4. Both series and shunt feedback at a port establishes a finite non-zero port
   impedance primarily defined by the feedback networks.

   The properties of balanced feedback stages can easily be predicted by con-
sidering the behavioral modifications that are the result of balancing:

1. Balancing provides odd characteristics.

2. Differential-mode bias sources convert into common-mode bias sources.

3. Anti-series connection provides a four-terminal stage with a current lim-
   iting charachter.

4. Complementary-parallel connection provides push-pull stages with a volt-
   age limiting character. Those stages can source and sink currents that ex-
   ceed the stage's quiescent operating current.

14.1.2 This chapter

In this chapter, we will put all the knowledge obtained from the previous
chapters together, and define an approach for the design of multi-stage neg-
ative feedback amplifiers.

   In section 14.2, we will formulate basic considerations for the design of the
controller. The following topics that be discussed:

1. Design of the input stage

2. Design of the output stage

3. Design of the number of stages

4. Interconnection of stages

5. Interconnection of the feedback network and the controller

6. The use of cascode stages

7. Application of local feedback stages

   Chapter 15 is devoted to biasing of the stages in the controller.
472 MULTI-STAGE FEEDBACK AMPLIFIERS

                                 14.2 Controller design considerations

                                                  In this section, we will formulate the answers to the following design ques-
                                                  tions.

                                                  1. Which type of stage should be applied as input stage of the controller?

                                                      We have seen that the equivalent input noise sources of a negative feedback
                                                      amplifier, at best equal those of its controller. It will become clear that if
                                                      we select the proper type of input stage, the noise performance of the
                                                      controller will predominantly be defined by that of the first stage. Hence,
                                                      at an early stage of the design, the noise contributions of other stages can
                                                      be ignored. The design of the first stage of the controller will be discussed
                                                      in section 14.2.1.

                                                  2. Which type of stage should be applied as output stage of the controller?

                                                      We have seen that the voltage and current drive capability of a negative
                                                      feedback amplifier, at best equal those of its controller. If we select the
                                                      proper type of output stage, it will also be the dominant contributor to the
                                                      nonlinearity. Hence, at an early stage of the design, contributions to the
                                                      nonlinearity of other stages can be ignored. The design of the output stage
                                                      of the controller will be discussed in section 14.2.2.

                                                  3. How many stages are required in the controller?

                                                      A rough estimation of the required number of stages at an early stage of
                                                      the design is important. In practice, the use of more than two or three
                                                      stages in a multi-stage negative feedback amplifier complicates the design
                                                      of the frequency response and the stability. If more that two or three stages
                                                      are required, one may consider the use of cascaded negative feedback am-
                                                      plifiers for the amplifier or for the controller, as discussed in section 12.9.
                                                      The minimum number of stages that is required for the controller will be
                                                      discussed in section 14.2.3.

                                                  4. In which way should the stages be interconnected?

                                                      The non-unilateral behavior of the basic amplifier stages due to the collector-
                                                      base capacitance in BJTs or the drain-gate capacitance in field effect de-
                                                      vices, causes interactions between stages that complicate the dynamic be-
                                                      havior of interconnected stages. In addition, improper interconnection of
                                                      amplifier stages causes the gain to deviate from the ideal gain. Such a
                                                      deviation cannot be reduced by increasing the loop gain, and should be
                                                      avoided in high-accuracy amplifiers. The aspects of the interconnection of
                                                      the stages will be discussed in section 14.2.3.

                                                  5. In which way should the biasing of the controller be arranged?

                                                      During the design of the signal path, the stages are assumed to be biased
                                                      with four ideal sources. This has been discussed in Chapter 3. Although
                                                      this biasing method is very unpractical, it allows us to separate the design
                                                      of the signal path from the design of the biasing. As soon as we have a
                                                      feasible solution for the signal path of the amplifier, we need to convert
                                                      this theoretical biasing scheme into a practical one. This means that all
                                                      bias sources have to be derived from the available power supply sources
                                                      and that measures have to be taken to ensure proper bias conditions over
                                                      the required temperature range and for all device tolerances. In Chapter
                                                      15 we will pay attention to the biasing of the amplifier stages with sources
                                                      that can be derived from the power supplies. However, we will not discuss
                                                      the implementation of the bias sources themselves. This will be discussed
                                                      in a separate chapter in a future edition of this book.
                                                                             14.2. CONTROLLER DESIGN CONSIDERATIONS 473

14.2.1 Design of the input stage

The equivalent input noise sources of a negative feedback amplifier, at best
equal those of its controller. Hence, a low-noise amplifier requires a low-noise
controller. A low-noise controller requires a minimum number of amplifier
stages that contribute as little as possible to the source-referred noise.

Type of input stage

We have seen that if the first stage of the amplifier has nullor properties, noise
of the following stages does not contribute to total source-referred noise.
Hence, the preferred type of input stage for the controller is a stage that
does not have intentional feedback. Such stages have their transmission pa-
rameters (A, B, C and D) as small as possible. Hence, a CE or CS stage, or
one of their balanced versions is preferred as input stage.

   Local feedback stages have at least one of these transmission parameters
increased with respect to that of the CE or CS stage. Let us, for example
consider a CD stage as input stage of the controller. Such a stage has A = 1,
so the noise voltage of the second stage fully contributes to the input voltage
noise of the controller.

Application of local feedback stages

If, for some reason, CE stages or CS stages or one of their balanced versions
cannot be applied as input stage, one has to apply a local feedback stage. In
such situations, nonenergic local feedback stages are preferred over passive
feedback stages. This is because the feedback elements in passive feedback
stages increase the contribution of the equivalent input noise of sources of
their controller and, in cases those feedback elements have a real part, they
contribute noise themselves.

Conclusions

The order of preference for the input stage of the controller of a negative
feedback amplifier is:

1. CE or CS stage or one of their balanced versions

2. CB, CG, CC or CD stage or one of their balanced versions

3. Passive feedback stages or one of their balanced versions.

   The selection of the device type, its geometry and its operating conditions
is governed by the source impedance, the frequency range of interest and the
noise requirements. This has been discussed in Chapter 5 for the CS stage.
We have seen that these conclusions also hold for their balanced versions.

14.2.2 Design of the output stage                                                3 A stage has to contribute maximally to the
                                                                                 differential error to gain ratio.
The voltage and current drive capability of a negative feedback amplifier, at
best equal those of its controller. Hence, the drive capability of the output
stage is the most important performance aspect to be dealt with during its
design.

   In Chapter 11, we have seen that the differential gain error of the servo
function equals the quotient of the differential gain error of the loop gain
and the loop gain. A small differential gain error is thus obtained if the
smallest number of stages contribute as little as possible to the differential
gain error, and as much as possible to the loop gain.3 Since only stages
that have non-zero signal excursions contribute to the differential gain, their
474 MULTI-STAGE FEEDBACK AMPLIFIERS

                                                  number has to be minimized. This can be done by using an output stage that
                                                  has its Transmission-1 matrix parameters as small as possible.

                                                  Type of output stage
                                                  If the output stage has nullor properties, signal excursions in preceding
                                                  stages are zero and the output stage is the only contributor to the differ-
                                                  ential gain. From this we see that the preferred type of output stage is a CE
                                                  or CS stage or one of their balanced versions.

                                                  Application of local feedback stages
                                                  If, for some reason, CE or CS stages or one of their balanced versions cannot
                                                  be applied as output stage, one has to apply a local feedback stage. In such
                                                  situations, nonenergic local feedback stages are preferred over the passive
                                                  ones. This is because impedances in series or in parallel with the signal path
                                                  of the passive feedback stages usually increase the differential error to gain
                                                  ratio.

                                                  Conclusions
                                                  The order of preference for the output stage of the active part of a negative
                                                  feedback amplifier is:

                                                  1. CE or CS stage or one of their balanced versions

                                                  2. CB, CG, CC or CD stage or one of their balanced versions

                                                  3. Passive feedback stages or one of their balanced versions.

                                                      The selection of the device type, its geometry and its operating conditions
                                                  is governed by the current and voltage drive requirements of the output stage,
                                                  and by the power efficiency of the amplifier. A high-efficiency output stage
                                                  uses a complementary-parallel stage (push-pull stage).

4 Over the temperature range of interest  14.2.3 Design of the number of stages
and for all possible device tolerances.
                                          If the type of stage, the requirements for its geometry and operation con-
                                          ditions for the input stage overlap with the corresponding properties of the
                                          output stage, a single-stage controller might be an option. The requirements
                                          for the midband accuracy, the bandwidth and the differential gain error of the
                                          servo function then determine the number of stages to be used. If a single-
                                          stage solution satisfies all requirements, there is no need for a multi-stage
                                          controller.

                                             If the requirements of the first and the second stage do not overlap, at
                                          least two stages are required: an input stage and an output stage. A two-
                                          stage solution is then feasible if:

                                          1. The midband accuracy of the servo function is large enough.

                                          2. The bandwidth of the servo function is large enough.

                                          3. The differential gain error of the servo function is small enough.

                                             This includes the requirements that the current drive capability and the
                                             voltage drive capability of the first stage are large enough to drive the
                                             output stage.

                                             If at least one of the above requirements4 is not met, more stages are re-
                                          quired.
                                                                             14.2. CONTROLLER DESIGN CONSIDERATIONS 475

Type of intermediate stages

In order not to complicate the design of the dynamic performance of the
negative feedback amplifier, the number of dominant poles of the loop gain
should be kept as small as possible. Hence, we would like to realize a suf-
ficiently small inaccuracy, large bandwidth and low distortion, with a mini-
mum number of stages. This can be achieved by letting the stages contribute
as much as possible to the product of the loop gain and the poles, and as
little as possible to the differential error-to-gain ratio of the loop gain.

   The contribution of CE and CS stages and their balanced versions to the
mid-band value of the loop gain, depends very much on the drive and load
conditions of the stages. Generally this contribution is maximized if no
impedances are inserted in series or in parallel with the signal path.

   CE and CS stages and their balanced versions maximally contribute T
to the loop gain-poles product. This is the case if the stage is driven from a
current source and shorted at its output, while the short circuit output current
is passed to the next stage. If it is not shorted, and if the voltage gain of a
capacitively loaded stage is large, pole splitting may drive one of the poles of
the transfer out of the dominant group, which reduces the bandwidth of the
servo function.

   CE and CS stages and their balanced versions also contribute as little as
possible to the differential error to gain ratio of the loop gain. Balanced
stages mainly contribute to odd order distortion, while unbalanced stages
contribute to both even and odd distortion. Application of local feedback
stages causes a larger contribution to the differential error-to-gain ratio of
preceding stages, while passive feedback stages usually have a larger differ-
ential error-to-gain ratio than nonenergic feedback stages, or stages without
feedback.

Cascode stages

From the above, we may conclude that all amplifier stages preferably are          5 The transimpedance factor and the
CE or CS stages, or their balanced versions. The high-frequency behavior of       voltage gain factor of the cascode stage
cascaded CE or CS stages, however, is very complicated. The parasitic ca-         exceed those of its CS or CE stage.
pacitive feedback in these stages causes a strong interaction between them.
The interaction between stages can considerably be reduced by using unity
gain current amplifiers as buffer between cascaded CE or CS stages. These
stages effectively short the first stage, while passing the short circuit to the
next stage. The CB or CG stages can be used for this purpose. These unity-
gain current amplifier stages have a low input impedance and a high output
impedance for a wide range of drive and termination impedances. The cas-
cade connection of a CE or CS stage with a CB or CG stage is called a cascode
stage. The use of cascode stages strongly facilitates the design of the dynamic
behavior of a negative feedback amplifier.

   Another advantage of the cascode stage is its high output impedance. This
is a result of output the series feedback in the CG or CB stage. As a result,
the Transmission-1 matrix parameters A and C of the cascode stage are much
smaller than those of its CS stage.5 This makes a cascode stage a better
approximation of the nullor than its CS or CE stage both at low frequencies
and at high frequencies.

   Replacement of a CE or CS stage in a controller by a cascode stage usually
results in an increase of loop gain. This results in a larger bandwidth of the
servo function, a better (gain) accuracy and a lower distortion of the feedback
amplifier. Their application will be discussed in more detail in section 14.2.6.
476 MULTI-STAGE FEEDBACK AMPLIFIERS

                                                  Application of local feedback stages

                                                  If the midband accuracy or the differential gain of the servo function is out
                                                  of specifications, while the bandwidth of the servo function is large enough,
                                                  local feedback stages may be used to increase the loop gain without adding
                                                  another dominant pole.

                                                      As a result of local feedback, the bandwidth of a local feedback stage may
                                                  exceed that of the servo function. Hence, it do not introduce a dominant pole
                                                  in the loop gain of the outer loop of the feedback amplifier.

                                                  Conclusions

                                                  The order of preference for intermediate stages in the controller is:

                                                  1. CE or CS stages or their balanced versions; use cascode stages if pole
                                                      splitting brings one of the poles out of the dominant group, or if the low-
                                                      frequency inaccuracy or distortion needs to be reduced.

                                                  2. Nonenergic feedback stages or their balanced versions.

                                                  3. Passive feedback stages or their balanced versions.

                                                      The device type, its geometry and its operating conditions should be op-
                                                  timized for the performance aspect of the servo function that needs to be
                                                  improved through the application of this extra stage.

                                               14.2.4 Interconnection of stages

                                               The interconnection of the stages in the controller should be done in such a
                                               way that the controller behaves as a nullor if one of the stages behaves as such.
                                               This ensures that the performance of the feedback amplifier is predominantly
                                               fixed by its feedback network(s).

Figure 14.1: Preferred method for inter-       stage 1  stage 2  stage n
connecting stages in the controller: Both
terminals of the input port of each follow-    +  +     +  +     +  +
ing stage are connected to the output port
of its preceding stage.                        --       --       --

stage 1  stage 2                                  Figure 14.1 shows the way to achieve this: the input port of each following
                                               stage should be connected to the output port of its preceding stage. If one
+  +     +  +                                  stage of the controller behaves as a natural two-port, the common-mode port
                                               current through the controller is zero and common-mode port voltages do
--       --                                    not affect the differential-mode port quantities.

Figure 14.2: In cases where the input port        Generally, stages will not behave as natural two-ports and imperfect port
and/or the output port of the controller is    isolation will cause errors in the source-to-load transfer and limit the CMRR
/ are floating with respect to the ground,     and the PSRR of the amplifier. Such limitations can be kept small as possible
current paths from inside the controller to    by using balanced stages in the controller.
the ground should be avoided. Such paths
may increase the gain inaccuracy as a result      Figure 14.2 shows an example in which the controller has an internal
of an imperfect port isolation in the stages.  connection to the ground, while both ports are floating with respect to the
                                               ground. In integrated circuit amplifiers, such paths exist as a result of the
                                               coupling between the devices and the substrate. In general, intentional cre-
                                               ation of such paths should be avoided because such paths increase the effects
                                               of the imperfect port isolation of the individual stages of the controller on the
                                               CMRR and the PSSR of the amplifier.

                                                  Figure 14.3 shows five different options for a dual-stage four-terminal con-
                                               troller. All devices are drawn as generalized biased active three-terminal de-
                                               vices, as introduced in Chapter 3.5.1. We will discuss these configurations
                                               below.
                                                                             14.2. CONTROLLER DESIGN CONSIDERATIONS 477

A The circuit shown in Figure 14.3A represents a simple dual-device, dual-
   stage, four-terminal controller. The input port of the second stage is con-
   nected to the output port of the first stage. However, since both stages are
   three-terminal devices, the input voltage of the second stage equals the
   common-mode voltage across the two-port. Hence, the stage has a huge
   common-mode to differential mode conversion and does not at all approx-
   imate a natural two-port. Such a stage can only be applied in conjunction
   with an element that provides port isolation, such as a transformer.

B The circuit depicted in Figure 14.3B shows another simple dual-device,
   dual-stage, four-terminal controller. Because of its relative simplicity, it is
   a popular structure in simple dual-transistor feedback amplifiers. Figure
   14.4 shows the signal path of a negative feedback voltage amplifier that
   uses this controller.

+  +                             +  +                               +  +                       +  +                        +  +

-  -                             -  -                               -  -                       -  -                        -  -

      A                          B                                  C                          D                           E

No port isolation.               Simple two-transistor controller.  Two-stage controller with  Two-stage controller with   Fully balanced two-stage
Can only be used in combination                                     anti-series output stage.  anti-series input stage.    controller.
with a transformer connected to  Input current of the second                                   A push-pull stage can be
one of the ports.                                                                              used for the second stage.
                                 stage flows through the
                                 external network.

   The circuit in Figure 14.3B also forms the basic structure for so-called cur-                  Figure 14.3: Signal path of all NPN two-
   rent feedback operational amplifiers. A complementary-parallel connection of                   stage controllers.
   two controllers from Figure 14.6 is the basic architecture of such an opera-
   tional amplifier.                                                                                  A: Simple two-transistor, two-stage
                                                                                                  controller. This controller has no port
   The main disadvantage of this controller is that it does not obtain nullor                     isolation because the input voltage of the
   properties if only one of the stages is replaced with a nullor. This implies                   second stage equals the common-mode
   that, if the loop gain approaches infinity, the gain of an amplifier equipped                  voltage across the two-port.
   with such a controller does not equal its ideal gain. This makes the am-
   plifier more sensitive to device parameter tolerances than amplifiers with                         B: Simple, two-transistor, two-stage
   controllers with properly connected stages, as shown in Figure 14.3C to E.                     controller in which the return path for
   Please study Example 14.1 and Example 14.2 for a more in-depth treatment                       the current between the two stages has to
   of this topic.                                                                                 flow through the external network. This
                                                                                                  introduces deviations from the ideal gain
C The circuit from Figure 14.3C, shows a dual-stage controller with properly                      that cannot be reduced by increasing the
   interconnected stages. It uses a single-device input stage and an anti-series                  loop gain.
   output stage. The latter one provides the port isolation.
                                                                                                      C: Two-stage controller with properly
D The circuit from Figure 14.3D also shows a two-stage controller with prop-                      interconnected stages that uses a single-
   erly interconnected stages. It uses an anti-series input stage that provides                   transistor input stage and an anti-series
   the port isolation, cascaded with a single-device output stage. For high-                      output stage.
   efficiency operation, a complementary-parallel output stage can be used.
   The structure with a differential pair input stage and a complementary-                            D: Two-stage controller with properly
   parallel output stage is the basic structure used in voltage-feedback opera-                   interconnected stages that uses an anti-
   tional amplifiers.                                                                             series input stage and a single transistor, or
                                                                                                  complementary-parallel output stage.
E The controller circuit from Figure 14.3E consists of two cascaded anti-series
   stages.                                                                                            E: Two-stage controller with properly
                                                                                                  interconnected stages that consists of
                                                                                                  a cascade connection of two anti-series
                                                                                                  stages.

   In the following two examples we will demonstrate the effect of improper
interconnection of stages in the controller as done in Figure 14.3B.

   Example 14.1
478 MULTI-STAGE FEEDBACK AMPLIFIERS

                                                      Let us consider the voltage amplifier from Figure 14.4, constructed with two

                                                      MOS transistors as shown in Figure 14.5A. Figure 14.5B shows its small-signal

                                                      equivalent circuit for evaluation of the asymptotic gain with the transconductance

           +                                          of the second stage selected as loop gain reference. In this circuit all dynamic
         ouput
                                                      elements have been omitted.
          -
                                                      According to the asymptotic gain feedback model, the asymptotic gain Av

input -                                               should now be calculated as  Av = V .
      +                                                                                      Vs
                                                                                                                                 (14.1)

                                                      The network equations for the circuit can be found from network inspection:

                                                                                       Vs = Vi + V1,                             (14.2)
                                                                                                                                 (14.3)
Figure 14.4: Voltage amplifier that uses                                               gmVi = V1 (go + gmb) ,
passive feedback around the two-transistor,                                                                                      (14.4)
dual-stage controller from Figure 14.3B.                 V1 + V1 - AvVs = 0,
                                                         R2                        R1

                                                      where (14.2) follows from the loop of the voltages Vs, Vi and V1. Equation (14.3)
                                                      states that the sum of the currents that flow into node (2) equals zero, and (14.4)

                                                      states that the sum of the currents in node (1) equals zero.

                                                         The asymptotic gain Av is found as

                                                         Av = R2 + R1 gm R . 2 gm + go + gmb                                     (14.5)

                                                      Second stage transconductance +

                                                      selected as loop gain reference.

                +                                     Replaced with nullor for calculation

                                                      of the asymptotic gain.               -

                -                                                                                     (2)
                                                                                                                              +
   +                                                  +  +
  -
                                                      -  -                                                                 -
A                                                                                                     (1)

                                                                                            +

                                                                                                   -

                                                      B

Figure 14.5: NMOS passive feedback                           Hence, although one stage of the controller behaves as a nullor, the complete
voltage amplifier according to Figure 14.4.              controller does not behave as a nullor. This is a consequence of the non-ideal
                                                         interconnection of the two stages of the controller. The influence of the improper
    A: Signal path diagram.                              connection on the static inaccuracy of the source-to-load transfer can be kept small
    B: Small-signal equivalent circuit for               by using an input stage that has go+gmgmb as large as possible. This can be achieved
the analysis of the static (DC) asymptotic               by using a cascode stage for the first stage of the controller. The cascode stage will
gain in which the transconductance of the                be described later.
second stage has been selected as the loop
gain reference.                                          Figure 14.6 shows the structure of the signal path of the so-called current
                                                      feedback amplifier, which is derived from the structure from Figure 14.3B.
                                                  +
                                               ouput     In the following example we will elucidate a similar effect in a two-stage,
                                            -         two-transistor current amplifier with bipolar transistors.

        +                                                Example 14.2 Let us now consider the current amplifier, constructed with two
   input
                                                         bipolar transistors as shown in Figure 14.7A. Figure 14.7B shows the small-signal
       -                                                 equivalent circuit for evaluation of the asymptotic gain when the transconduc-
                                                         tance of the first stage has been selected as loop gain reference. In this circuit,
Figure 14.6: The so-called current-feedback              all dynamic elements have been omitted. For the sake of simplicity, the output
operational amplifier is contructed from a               resistance of the second stage transistor has been omitted as well.
complementary parallel connection of two
of these circuits.
                                              14.2. CONTROLLER DESIGN CONSIDERATIONS 479

   According to the asymptotic gain feedback model, the asymptotic gain Ai is

obtained as  Ai = IIs .

                                              (14.6)

   The network equations for the circuit can be found from network inspection:

                              V1 = -IsR1,     (14.7)
             (1 + AC) Ii + Is = V1 R ,2       (14.8)
                                              (14.9)
                          AC Ii = -Ai Is,

where (14.7) follows from the fact that the input voltage and the input current of

the nullor equal zero. As a result, the source current flows through R1. Equation
(14.8) states that the sum of the currents that flow into node (1) equals zero, and

(14.9) states that the sum of the currents in node (2) equals zero.

                                              First stage transconductance
                                              selected as loop gain reference.
                                              Replaced with nullor for calculation
                                              of the asymptotic gain.

                                                                                     (2)
                                              +

                                              -
                                                                                      (1)

                                                                                     +

A                                          B                                         -

   The asymptotic gain Ai is found as                                                Figure 14.7: Bipolar passive feedback
                                                                                     current amplifier with the controller
             Ai = R1 + R2 AC R . 2 1 + AC     (14.10)                                according to Figure 14.3B.

   Hence, similar as in the previous example, the complete controller does not           A: Signal path diagram.
behave as a nullor if one stages behaves as such. This is a consequence of the           B: Small-signal equivalent circuit for
non-ideal interconnection of the two stages of the controller. The influence of the  the analysis of the static (DC) asymptotic
improper connection on the static inaccuracy of the source-to-load transfer can be   gain in which the transconductance of the
kept small by using an output stage with a high DC current gain, such as a field     first stagehas been selected as the loop gain
effect device.                                                                       reference.

Interconnection of unbalanced stages and balanced stages

Let us now consider cases in which a balanced stage is cascaded with an
unbalanced one. Such a structure exists, for example, in the controller from
Figure 14.3D. In such a situation, the unbalanced stage will convert common-
mode output quantities of the differential stage into differential-mode quan-
tities. In practice, common-mode currents in the balanced stage may be a
result of the finite impedances of common-mode bias sources, and of para-
sitic coupling of the balanced stage with the power supply or the ground.

   Figure 14.8 illustrates the conversion of a common-mode current flowing
out of a balanced stage into a differential-mode current. For the sake of
simplicity, the unbalanced stage has been connected to the ground. However,
this is not necessary for common-mode to differential-mode conversion.

   Figure 14.8 shows that the input current of the unbalanced stage equals
the differential-mode output current of the balanced stage, plus half of its
common-mode output current. This common-mode to differential-mode con-
480 MULTI-STAGE FEEDBACK AMPLIFIERS                                             +

Figure 14.8: Common-mode to differential-                                    output
mode conversion in a cascade connection of
a balanced stage and an unbalanced stage.                                      -

                                                    balanced     unbalanced
                                                    stage        stage

                                             version causes a reduction of the CMRR. If the common-mode current is a
                                             result of an undesired coupling between the signal path and the power sup-
                                             ply, it also decreases the PSRR.

                                             noninverting
                                             current follower

                                                                                                                                                     +

   + balanced                                unbalanced + + -
      stage                                         output

   -

                                             stage  -         -

A              inverting                                      B

               current follower

Figure 14.9: Reduction of common-mode to        The common-mode to differential-mode conversion as described above,
differential-mode conversion in a cascade    can be prevented by subtracting the output currents of the differential stage
connection of a balanced stage and an un-    before feeding them to the unbalanced stage. This has been illustrated in
balanced stage with the aid of noninverting  Figure 14.9.
and inverting current followers.
                                                Figure 14.9A shows the concept of this common-mode compensation tech-
                                             nique. The current out of one output terminal of the balanced stage is di-
                                             rected to a noninverting unity-gain current amplifier, while the current out
                                             of the other output terminal is directed to an inverting unity-gain current
                                             amplifier. The output currents of both current amplifiers are added, and
                                             their sum is directed to the input of the unbalanced stage. In this way, the
                                             common-mode component has been removed from the input current of the
                                             unbalanced stage, which now equals twice the differential-mode output cur-
                                             rent of the preceding stage.

                                                The use of both an inverting and a noninverting current amplifier, each
                                             connected to one output of the differential stage, generally improves the bal-
                                             anced operating conditions for the differential stage.

                                                Figure 14.9B shows an implementation example in which a current mirror
                                             is used for the implementation of the inverting unity-gain current amplifier,
                                             while a CG stage or a CB stage implements the noninverting current ampli-
                                             fier.

                                             14.2.5 Interconnection of controller and feedback net-
                                                        works

                                             Let us now consider four-terminal controllers with an asymmetrical structure.
                                             Examples of such controllers have been shown in Figure 14.3B, Figure 14.3C
                                             and Figure 14.3D. If such a controller is connected to its external electrical
                                             environment, an alternative amplifier circuit can be obtained by swapping
                                                                         14.2. CONTROLLER DESIGN CONSIDERATIONS 481

the port terminals, both at the input port and at the output port. Figure 14.10
illustrates this for the voltage amplifier from Figure 14.4.

                                    outN                                           outP            Figure 14.10: Swapping of the pins at the
                                                                                                   input port and at the output port of an
                inP                                         inN                                    asymmetrical, four-terminal controller,
                                                                                                   yields an alternative amplifier circuit.
          Rs       inN                    outP   Rs            inP       R1        outN
                              R1                                                                       A. Voltage amplifier from Figure 14.4
             +                                      +                                              with pinnames at the input port and at the
         Vs                                  +  Vs                                     +           output port of the controller.

             -            R2 RL VL                  -               R2 RL VL                           B. Passive feedback voltage amplifier,
                                          -                                         -              obtained from swapping the pins at the
         A                                      B                                                  input port and at the output port of the
                                                                                                   controller.

   Although both amplifiers are two-stage noninverting voltage amplifiers,                         6 Controlling node of an active device: gate
their performance as well as their biasing will differ. Such differences may                       (FET), base (BJT) or grid (vacuum tube).
result in a strong preference for one of the two circuits. It it common prac-
tice to connect the controlling node6 of the input device of the controller
to the signal source, as it is done in Figure 14.10A. However, performance
evaluation and comparison of both solutions may, in specific situations, yield
another preference.

14.2.6 Cascode stages

We have seen that the CS or CE stage or one of its balanced versions are the

preferred controller stages. However, as a result of the parasitic feedback ca-

pacitance in those stages, cascaded stages strongly interact, which results in

a rather complex dynamic behavior. Moreover, pole splitting in these stages

may drive one or more poles of the loop gain out of the dominant group. If

so, more than the minimum number of stages might be needed to achieve a

sufficiently large bandwidth. Pole-splitting can be prevented by shorting the

stages and driving the following stage with the short-circuit current. By do-

ing so, each shorted stage has a simple R C input impedance that introduces
                   -1.
a  pole  at  s  =         In  this  way,  the   controller  needs   the  smallest  number  of
                      RC
stages for the required servo bandwidth. All poles are as close as possible to

the origin!

   Shorting of a CS or CE stage, while delivering the short-circuit current to

the following stage can be accomplished by cascading a stage with a unity-

gain current amplifier. Unity-gain current amplifiers can be implemented

with local feedback current followers, such as the CG stage or the CB stage.

The cascade connection of a CS or CE stage with a CG or CB stage is called a

cascode stage.7                                                                                    7 Also: the cascade connection of a common
                                                                                                   cathode stage and a common grid stage in
   Figure 14.11 shows the cascode stage with generalized biased three-terminal                     vacuum tube technology.

active devices. Figure 14.12A shows the small-signal equivalent circuit of the

stage from Figure 14.11. If BJTs are used we have gi = g = gm/AC, for                                 +      +
                                                                                                   input
field effect devices we have gi = 0. Figure 14.12B shows a simplified model                               output
                                                                                                      -     -
that, in most cases, models the behavior sufficiently accurate.

   In case of MOS transistors, the output resistance ro can be obtained as

                                    ro = ro1 (1 + gm2 ro2 ) .                             (14.11)  Figure 14.11: Cascode stage with general-
                                                                                                   ized 3-terminal biased active devices.
482 MULTI-STAGE FEEDBACK AMPLIFIERS

Figure 14.12: Small-signal models of the            +         +             -                                                  -
cascode stage.                                input           -             + output                                            +

    A. Small-signal model contructed with    A-                       +                output                           -
the generalized small-signal models from                             -                                                  +
Figure 4.52.                                        +                                                                                  -
                                              input                                                                                      +
    B. Simplified model of the cascode
stage. The interaction between the input     B-
and output circuits has been eliminated by
the current follower.

  +           +                                 Figure 14.13 shows the anti-series connection of two cascode stages. The
input     output                             small-signal equivalent circuit is shown in Figure 14.14. When compared
                                             with the anti-series stage, the anti-series cascode stage exhibits:
  -           -
                                             · A unilateral transfer
Figure 14.13: Anti-series connection of two
cascode stages from Figure 14.11.            · An improved port isolation at high frequencies

Figure 14.14: Small signal model of the      · No pole-splitting (Miller effect).
anti-series cascode stage.
                                                       +                 +

                                                       input                                                            output

                                                       -                 -

       +  -       +

       -  +       -

Figure 14.15: A passive-feedback tran-       14.2.7 Application of local feedback stages
simpedance amplifier of which the source
and the load are both connected to the       Until now, we have studied the application of the CS stage and the CE stage
ground, can be equipped with a three-        and their balanced versions as amplifier stages in the controller. We have also
terminal controller with an inverting        applied local feedback current followers as high-frequency buffers between
transfer.                                    cascaded CE or CS stages. From this we have seen that a CE or CS stage,
                                             cascaded with a CB or CG stage can be considered as a single amplifier stage
                                             (the cascode stage) with improved unilateral behavior.

                                                In this section, we will study the application of other local feedback stages
                                             in the controller.

                                             Dual-device three-terminal controllers

                                             Let us consider a passive-feedback transimpedance amplifier in which both
                                             the source and the load share one terminal with the ground. Such an am-
                                             plifier can be equipped with a three-terminal controller that has an inverting
                                             transfer (see Figure 14.15). Since two cascaded CE or CS stages provide an
                                             noninverting transfer, it is not possible to construct a dual-device controller
                                             with only CE or CS stages. So, if we need a two-stage controller we need at
                                             least one anti-series stage, hence, three devices.

                                                Let us investigate other options for dual-device controllers. A three-terminal
                                             dual device controller with an inverting transfer can be built with one invert-
                                             ing amplifier stage and one noninverting amplifier stage. The CE or CS stage
                                             is an inverting amplifier stage and the CB or CG stage and the CC or CD
   14.2. CONTROLLER DESIGN CONSIDERATIONS 483

stage can be applied as noninverting amplifier stages. Hence, we can con-                   +  -
struct four different dual-device controllers. Figure 14.16 shows the available
options, they will be discussed below.                                                      A- +

A Figure 14.16A shows a CE or CS type input stage and a CC or CD type                       +  -
   output stage. If the output impedance of the first stage is larger than the
   input impedance of the CC or CD stage, the latter one can be considered                  B- +
   to be current-driven. The loop gain in the output stage is then very low
   and it tends to behave as a noninverting CE or CS stage.                                 +  -

   Since the voltage gain factor of the output stage is unity, the voltage swing            C- +
   at the output of the first stage equals the output voltage. This makes it
   contribute to the distortion.                                                            +  -

B Figure 14.16B shows a CC or CD type input stage and a CE or CS type                       D- +
   output stage. In this solution, the first stage of the controller has a volt-
   age gain factor of unity. This implies that the contribution of the voltage              Figure 14.16: Options for three-terminal
   noise source of the second stage to the total equivalent input noise voltage             dual-device controllers.
   cannot be ignored.
                                                                                              A. A CE or CS stage cascaded with a CC
C Figure 14.16C shows a CB or CG stage type input stage and a CE or CS                      or CD stage.
   type output stage. In this configuration the contribution of the equiva-
   lent input current noise source of the second stage to the equivalent input                B. A CC or CD stage cascaded with a CE
   current noise of the controller cannot be ignored.                                       or CS stage.

D Figure 14.16D shows a CE or CS type input stage and a CB or CG type                         C. A CB or CG stage cascaded with a CE
   output stage. As discussed before, such a stage is often considered as a                 or CS stage.
   single stage. This is because the CB or CG stage does not increase the
   product of the dominant poles and the loop gain: their current gain is                     D. A CE or CS stage cascaded with a CG
   unity with a pole at T, which is almost always outside the dominant                      or CB stage.
   group.

CC-CB and CD-CG cascade connection                                                          Figure 14.17: Transimpedance amplifier
                                                                                            from Figure 14.15 with the controller from
Let us now investigate the application of the circuit from Figure 14.3C as two-             Figure 14.3C.
stage controller in the transimpedance amplifier from Figure 14.15. Figure
14.17 shows the complete signal path of a transimpedance amplifier with
this controller. This figure clearly shows that the anti-series input stage is
not perfectly balanced. One device of the differential stage has its input
grounded, while the other one has its output connected to the ground. Such
an arrangement can better be considered as the cascade connection of a CC
or CD stage and a CB or CG stage, or alternatively, as a cascade connection
of a voltage follower and a current follower.

                                                                                         +

-

   This combination of local feedback stages behaves as a non-inverting CE or
CS stage. The output resistance ro strongly depends on the driving resistance
of the stage. If the stage is driven from a current source, it equals the output
resistance of the cascode stage. If the stage is driven from a voltage source,
it equals the output resistance of the basic CE or CS stage. The small-signal
equivalent circuit of the stage is shown in Figure 14.18.

   The noise behavior of this stage differs from that of a truly balanced anti-
series stage. Since the first stage in the controller is a voltage follower, its
484 MULTI-STAGE FEEDBACK AMPLIFIERS

Figure 14.18: Small-signal model of cascade        +            +       +   +                            +
connection of the voltage follower and
the current follower. This stage can be            in           out     in                               out
regarded as a basic noninverting amplifier
stage. The element values refer to those of        -            -       -   -                            -
the single device. The output resistance ro
strongly depends on the driving resistance     transmission parameter A equals unity. This implies that the noise voltage
of the stage. If the stage is driven from      source of the current follower contributes as much to the total equivalent
a current source, it equals the output         input voltage as the voltage noise of the voltage follower. Other contributions
resistance of the cascode stage. If the stage  of the noise of the current follower to the equivalent input noise sources
is driven from a voltage source, it equals     can be ignored because the parameters B, C, and D of the first stage are
the output resistance of the basic CE or CS    not enlarged as a result of negative feedback. Figure 14.19 shows the noise
stage.                                         transformation for the cascade connection of the voltage follower and the
                                               current follower.

Figure 14.19: Noise transformations in a                        +    -                    +     -
cascade connection of a voltage follower
and a current follower.                                         -    +                    -     +

    A. Since the voltage follower and the          A
current follower are nonenergic feedback
stages, their equivalent input noise sources           -+ -+
equal those of their controller (a CE or CS
stage). B. Negative feedback in the voltage                                 +                -     +  -
follower establishes A = 1, while the other
transmission parameters equal those of the
controller (CE or CS stage).

                                                                            -                +     -  +

                                                   B

                                                   The contributions of BIn2 , DIn2 and CVn2 to the equivalent input noise

                                               sources can usually be ignored. If we assume equal spectral densities of

                                               the corresponding equivalent input noise sources of both stages, the spectral

                                               density Sv,tot of the total equivalent input voltage noise can be approximated

                                               by

                                                                            Sv,tot = 2Sv,                (14.12)

                                               where Sv = SV1 = SV2 is the spectrum of the equivalent input voltage noise
                                               of both stages.

                                                   The spectral density Si,tot of the total equivalent input current noise can be

                                               approximated as

                                                                            Si,tot = Si,                 (14.13)

8 Assuming equal devices and operating         where Si = SI1 = SI2 is the spectrum of the equivalent input current noise of
points for the truly balanced stage and the    both stages.
cascade connection of the voltage follower
and the current follower.                         If we compare this result with the one shown in Figure 6.29, we see that
                                               the spectrum of the total equivalent input voltage noise source equals that
                                               of a truly balanced stage, but the spectrum of the total equivalent input cur-
                                               rent noise source is twice that of a truly balanced stage.8 This implies that
                                               the unbalanced application of the anti-series stage has a slightly larger noise
                                               contribution.
                                                      485

15 Amplifier Biasing

15.1 Introduction                                486

15.1.1 A structured approach to biasing          486

15.1.2 Basic passive biasing elements            486

15.1.3 Outline of the biasing approach           488

15.1.4 Drawing conventions                       488

15.1.5 This chapter                              489

15.2 Setting up the initial biasing scheme       489

15.2.1 CE and CS stage biasing                   490

15.2.2 Biasing of local-feedback stages          491

15.2.3 Biasing of cascode stages                 495

15.2.4 Biasing of anti-series stages             496

15.2.5 Biasing of complementary-parallel stages  500
486 AMPLIFIER BIASING

                                               15.1 Introduction

                                               Until now, we have discussed the design of the amplifier's signal-path, thereby
                                               assuming that the desired operating conditions of the active devices were
                                               fixed with ideal current and voltage sources, as described in Chapter 3. In
                                               this chapter, we will discuss methods to minimize the number of bias sources,
                                               as well as the way in which the remaining bias sources can be derived from
                                               the power supplies. We will not yet discuss the design of the bias sources
                                               themselves.

                                               15.1.1 A structured approach to biasing

                                               A definition of biasing has been given in Chapter 9.

1 A network element is called passive if               Biasing is the process of fixing the electrical operating conditions of electronic
it dissipates power. This is the case if the       devices, and deriving the required bias voltage and current sources from the
real part of the sum of the products of all        power supply voltage(s).
its branch currents and branch voltages is
positive. A network element is called active      The biasing design problem can thus be formulated as follows:
if it delivers power to its external circuit.     Derive the input and output bias quantities of the amplifier stages from the power
This is the case if the real part of the sum   supply voltages in such a way that:
of products of all its branch currents and
branch voltages is negative.                   1. The amplifier stage is accurately biased in the desired operating point over the
                                                  whole temperature and power supply range.

                                               2. The amplifier stage is sufficiently isolated from the power supply.

                                               3. The degradation of the amplifiers's performance caused by the biasing, is accept-
                                                  able.

                                                  The biasing of amplifier stages and amplifiers is known to be difficult.
                                               First of all, this is because the design and the implementation of a feasible
                                               biasing concept, show a strong interaction with the design of all kinds of per-
                                               formance aspects of the amplifier. In particular, the number of feasible circuit
                                               topologies shows a strong interaction with the supply voltage. Secondly, bi-
                                               asing is a complex process because the bias elements themselves are passive
                                               elements each of which needs to be biased in a proper operating point as
                                               well.1

                                                  For these reasons, biasing circuits are often designed concurrently with the
                                               signal path. Possible design conflicts that result from interactions between the
                                               bias circuits and the signal path are usually resolved in design loops. Such a
                                               design approach may be suited to experienced designers, but it may be very
                                               confusing for novice designers and it does not lend itself to automation.

                                                  In this book, we will introduce a structured approach to biasing that clearly
                                               shows the interaction between the design of the signal path, the design of
                                               the biasing scheme and the implementation of bias sources. We will use a
                                               step-by-step approach in which we will explicitly motivate and describe the
                                               subsequent design steps. By doing so, this approach is believed to be suited
                                               to non-experienced designers and may also be used as a basis for algorithm-
                                               based design automation.

                                                  We will introduce techniques that can be used to minimize interactions
                                               between the design of the biasing circuits and the signal path, as well as
                                               techniques for optimization of the design of the signal path with respect to
                                               biasing.

                                               15.1.2 Basic passive biasing elements

                                               Since the power supply is the only active element in a circuit, biasing el-
                                               ements have to be realized with passive network elements that behave as
                                                                                     15.1. INTRODUCTION 487

voltage or current sources. Within the context of biasing, we will use the
following definitions for elements that behave as voltage or current sources:

1. A two-terminal network element has a voltage source character if, at fre-
   quencies of interest, the magnitude of its small-signal impedance is smaller
   than the ratio of the DC voltage across the element and the DC current
   through it.

2. A two-terminal network element has a current source character if, at fre-
   quencies of interest, the magnitude of its small-signal impedance is larger
   than the ratio of the DC voltage across the element and the DC current
   through it.

   With the above definitions, it will be clear that at nonzero frequencies,
inductors have a current source character and capacitors a voltage source
character. Hence, for biasing purposes capacitors can be inserted in series
with the signal path and inductors can be placed in parallel with the signal
path. This is called AC coupling.

Nonlinear resistors

Biasing elements that exhibit a voltage or current source character at all fre-

quencies, can be realized with nonlinear resistive elements, or shortly: non-

linear resistors. However, since the V - I characteristic of a passive nonlinear

resistive element passes through the origin, such an element can only exhibit

a voltage or a current source character over a limited operating range. In the

vicinity of (V, I) = (0, 0) any passive nonlinear resistor behaves as a linear

resistor:2                        V = dV ,                                           2 Assume no discontinuity in the V - I
                                  I dI                                               characteristic and its derivative at (V, I) =
                                                             (15.1)                  (0, 0).

where V and I are the voltage across the device and the current through the

device, respectively.

Figure 15.1A shows a V - I characteristic of a nonlinear resistor with a

current source character over a wide operating range. The lower limit of

the voltage across a nonlinear resistor, at which it exhibits a current source

character, is called the saturation voltage. The upper limit of this voltage is

called the breakdown voltage.

Figure 15.1B shows a V - I characteristic of a nonlinear resistor with a

voltage source character over a wide operating range. The lower limit of

the current through a nonlinear resistor, at which it exhibits a voltage source

character, is called the cut-off current. The upper limit of this current is called

the saturation current.

                                                                                     Figure 15.1: Nonlinear resistors that ex-

         I                                  V                                        hibit a current source or a voltage source

 +                                                                                   character over a limited operating range:
 -
                                                                                     A: Symbol and characteristic of a
A
            current                            voltage                               nonlinear resistor with a current source
            source                             source
            character             +            character                             character when Vsat < V < Vbr.

                               V                          I                          B: Symbol and characteristic of a non-

                                  -                                                  linear resistor with a voltaget source

                                                                                     character when Icut-off < I < Isat.

                                  B

   One of the difficult aspects of biasing is that the biasing elements them-
selves need to be biased in an operating point at which they deliver the
proper value of the bias quantity, while they maintain their current or voltage
source character for all signal values and power supply variations.
488 AMPLIFIER BIASING                   15.1.3 Outline of the biasing approach

3 The power dissipation in the biasing  The outline of the structured approach to the biasing of amplifier stages and
element is positive.                    amplifiers is sketched below:

                                        1. The signal path design with four bias sources per transistor, as discussed
                                           in Chapter 3, is the starting point for the design of the biasing. Theoreti-
                                           cally, all of these bias sources are capable of delivering power.

                                           In practice, only the power supply sources deliver power to the circuit, all
                                           other elements are passive elements that either dissipate power or store
                                           electrical energy. The latter ones are capable of delivering power over
                                           a limited time interval, but the time average of the power, delivered by
                                           those elements, equals zero.

                                        2. The power supply voltage sources will be added to the signal path dia-
                                           gram. One of the terminals of each power supply will be connected to the
                                           reference node (the ground) of the signal path.

                                        3. The bias currents need to be delivered by the power supply voltage(s).
                                           This is achieved by redirecting the bias current sources via the power sup-
                                           plies and the ground. In order to minimize the number of biasing ele-
                                           ments, parallel connections of bias current sources will be replaced with
                                           a single current source and series connections of voltage sources will be
                                           replaced with a single voltage source.

                                        4. Since the power supply source is the only active device in the circuit, all
                                           remaining bias sources need to be replaced with passive nonlinear resistors
                                           that exhibit a voltage or current source character. This requires that the
                                           branch current of each biasing element flows from the terminal with the
                                           most positive voltage to the one with the most negative voltage.3 In this
                                           design step, bias sources will be added to ensure such behavior.

                                        5. At a later stage, we will see that floating voltage sources are difficult to
                                           realize. For this reason, their number needs to be minimized. We will
                                           show that this can be done either by changing the operating voltages of
                                           the active devices, by replacing them with grounded voltage sources, or
                                           by generating alternative amplifier topologies that have similar signal per-
                                           formance, but different biasing requirements.

                                        6. Before judging the feasibility of biasing elements, we need to define their
                                           requirements.

                                        7. If one or more feasible bias solutions can be found, we will select the most
                                           promising solution and continue with step 8, else we will evaluate the
                                           application of error reduction techniques and go back to step 3.
                                               Error reduction techniques that can be applied are:

                                           · Compensation (temperature compensation, model-based biasing)

                                           · Error feed forward

                                           · Negative feedback (application of local, over-all, differential-mode and
                                               common-mode feedback techniques)

                                           · Sampling/switching (auto-zero biasing)

                                           · Modulation/demodulation (chopper stabilized biasing)

                                        8. Start the detailed design of the biasing elements.

                                        15.1.4 Drawing conventions

                                        In order to illustrate the process of biasing in a comprehensible way, we
                                        will use some circuit drawing conventions. Figure 15.2 shows the drawing
                                        conventions for some devices, as they will be used in this chapter:
                                                                         15.2. SETTING UP THE INITIAL BIASING SCHEME 489

· The positive direction of the current flow in a schematic is from top to
   bottom. Hence, p-type devices are drawn with their emitter or source up,
   while n-type devices are drawn with their collector or drain down. Devices
   that operate at a higher voltage level are drawn at a higher position in the
   circuit diagram than devices that operate at a lower voltage level.

                                                                                                                              Figure 15.2: Drawing conventions.
+

-

V-source I-source  NMOS PMOS NPN  PNP  NJFET PJFET

· Information flow in a schematic is from left to right. In feedback networks
   it may be from right to left.

· For the sake of simplicity, the substrate connection of bipolar devices is
   not drawn. When properly biased, the substrate voltage has only a minor
   influence on the performance aspects of the device.

· In IC technology the common bulk of equal NMOS devices is connected to
   the supply with their largest negative voltage in the circuit. The common
   bulk of equal PMOS devices is connected to the one with their largest
   positive voltage.

15.1.5 This chapter

The motivation for separating the design of the signal path and the biasing
has already been given in section 4.5.1. In this chapter, we will introduce a
step-by-step approach to the biasing of amplifier stages and amplifiers.

   In section 15.2, we will discuss the way in which the bias quantities of am-
plifier stages can be derived from one or more power supply voltage sources,
thereby using only passive nonlinear resistors (step 1 through 4 of the list in
section 15.1.3). We will demonstrate this technique for CE or CS stages, local
feedback stages and balanced stages.

   Other sections, such as the minimization of floating voltage sources, set-
ting up the requirements for biasing elements and improvement of the bias-
ing using error-reduction techniques still need to be added.

15.2 Setting up the initial biasing scheme

In this section, we will discuss the design of an initial biasing scheme of an
amplifier. The associated design steps are:

1. Set up the signal path design with four bias sources per transistor, as
   discussed in Chapter 3.

2. Add the power supply voltage sources to the signal path diagram.

3. Redirect the current sources via the supplies and the ground and minimize
   the number of bias sources.

4. If necessary, add bias currents through voltage sources in such a way that
   those voltage sources can be replaced with passive nonlinear resistors with
   a voltage source character.

5. If necessary, add (or change) supply voltages in such a way that the bias
   current sources can be replaced with passive nonlinear resistors with a
   current source character.
490 AMPLIFIER BIASING

                                                   We will demonstrate this for a single-transistor CE and CS stage amplifier
                                                in section 15.2.1, for local feedback stages in section 15.2.2, for cascode stages
                                                in section 15.2.3 for anti-series stages in section 15.2.4, for complementary
                                                parallel stages in section 15.2.5.

                                                15.2.1 CE and CS stage biasing

                                                In this section, we will demonstrate the biasing of a transimpedance amplifier
                                                with a single CE or CS stage.

                                                V2                                                V2

                  V1                                                                                                                        +-V1  -
                -                                                                                                              +-

               Z1 I2                         +
                    +
                                                    Z2 +                                                                                             Z2 +

       I1                                       I3     -               I1     Z1  I2              I3                                                 -

A                                                                   B

Figure 15.3: Starting points for the biasing       Figure 15.3A shows the signal diagram of the transimpedance amplifier
of a transimpedance amplifier with a CE         equipped with a single CE stage and its four bias sources. In this arrange-
stage or CS stage. Please note that Is and      ment, the bias voltage sources carry no current, while the voltages across
V represent the source signal and the load      these sources equal the operating point voltages. Figure 15.3B shows the
signal, respectively. Their values are zero in  signal diagram of the transimpedance amplifier equipped with a single CS
the quiescent operating point.                  stage with the four bias sources. In this arrangement, the bias voltage sources
                                                carry the quiescent operating currents, while the voltage across the bias cur-
    A. Biased CE stage with zero quiescent      rent sources equals zero. Both arrangements of bias sources can be converted
current through V1 and V1 and nonzero           into each other through application of the Blakesley[Blakesley1994]4 voltage
quiescent voltages across the current           shift theorem.
sources.
                                                   Figure 15.4 shows the initial biasing schemes of both circuits from Figure
    B. Biased CS stage with zero quiescent      15.3. Please note that the voltage sources V1 and V2 in both circuits cannot be
voltage across I2 and I3 and nonzero            replaced with passive nonlinear resistors. In Figure 15.3A the current through
quiescent currents through V1 and V2.           these sources is zero, while the voltage across them is nonzero. Hence, their
                                                V - I characteristic cannot pass through the origin. In Figure 15.3B the prod-
4 T. A. Blakesley. A New Electrical The-        uct of the branch voltage and the branch current is negative. Hence, by
orem. Proc. Phys. Soc. London, 13:65-67,        definition, these are active elements.
1994

           + I2        I3 + V3                  -                             +                                                                   + I3 V3
           -               -                                   -                             I2                                                   -
                                                                 +                                                                                -
              V1        V2 + Z2                                               -                                                                                       -
            -                          -                                                                                                                                 +
                                                                                              V1
                                                                                           -
                                                                                                                                               +
                                                                                                                                  +

                +
                       +                                                                          V2                                                 Z2 +

I1         Z1                                                          I1     Z1                                                                     -

A                                                                          B

Figure 15.4: Initial biasing schemes of the        In order to replace these voltage sources with passive elements, we need
transimpedance amplifiers from Figure           to add current through them in such a way that the power dissipation in the
15.3:                                           element is positive. If we do this for V2, we need a passive element with
                                                a current source character (I5), as shown in Figure 15.5. Since this element
    A. Initial biasing scheme of the CE stage   itself needs to be passive, it requires a nonzero voltage across it. This voltage
transimpedance amplifier.                       needs to be provided by the negative power supply source V4.

    B. Initial biasing scheme of the CS stage      The biasing of the transimpedance amplifier with the CS stage from Fig-
transimpedance amplifier.
                                                                         15.2. SETTING UP THE INITIAL BIASING SCHEME 491

ure 15.4B proceeds in a similar way. In order to replace the bias voltage
sources with passive devices, the current direction in these sources needs to
be changed. This can be accomplished by changing the initial biasing ar-
rangement from Figure 15.3B, to the one used in Figure 15.3A.

        + I2            ++    I3 + V3                                    -       Figure 15.5: Initial biasing schemes of the
        -                                -                                  +    transimpedance amplifiers from Figure
                                                                                 15.3A. All bias sources have now been
                    V1         V2 + Z2               -                           derived from the power supply voltages
                 -                                  -                    -       with the aid of passive nonlinear resistive
                                                                            +    elements.
                                    + I5 V4
I1  Z1                      ++     -                                       -
                                                                              +
        + I4
        -                                             -
                                                                           -
   The result for the CMOS version of the transimpedance amplifier is then    +
similar to that of the bipolar version; it is shown in Figure 15.6. Please note
that the bulk of the NMOS has now been connected to the most negative volt-
age in the circuit. Whether this is necessary or not, depends on the applied
integrated circuit technology.

        + I2                I3 + V3                                              Figure 15.6: Initial biasing schemes of the
        -                              -                                         transimpedance amplifiers from Figure
                                                                                 15.3B. All bias sources have now been
                    V1       V2 + Z2                                             derived from the power supply voltages
                 -                                -                              with the aid of passive nonlinear resistive
                                                                                 elements.
                                  + I5 V4
I1  Z1                           -

    + I4
    -

   At a later stage of the biasing, we will discuss means to reduce the number
of floating voltage sources. Now, we will continue with designing initial
biasing schemes for other kinds of stages.

15.2.2 Biasing of local-feedback stages

The biasing of local-feedback stages is performed similarly as the biasing of
CE or CS stages. The starting point is the biased N or P device with its four
bias sources. The feedback networks are added around the biased devices.
In this section, we will discuss the design of an initial biasing scheme for
local feedback stages with n-type devices. The biasing of stages with p-type
devices proceeds in a similar way, but the biasing elements have opposite
signs. We will use examples with BJT or MOS devices. The biasing procedure
is independent of the device type and technology. The implementation of the
biasing scheme, however, strongly depends on the technology and the device
type.
492 AMPLIFIER BIASING

                               V2                 Setting up the initial biasing scheme of CD and CC stages

                               I2                 Figure 15.7 shows an NPN CC stage with its source, load and bias sources.
                            +                     A similar circuit can be designed with a MOS transistor.
                            -
                                                     Similar as with the biasing of the CE and CS stage, the bias quantities have
                                                  to be derived from the power supply voltages with the aid of the nonlinear
                                                  resistive elements. This process is illustrated in Figure 15.8.

                                                     Figure 15.8A shows the result after adding the power supply voltage VP,
                                                  redirecting the current sources via the power supply and ground, and replac-
                                                  ing them with nonlinear resistors. In order to have a nonzero voltage drop
                                                  across I2, a negative supply voltage VN has to be added. After doing so, I2
                                                  can be replaced with a nonlinear resistor with a current source character. Fig-
                                                  ure 15.8B shows the addition of a current IV1 through V1, so that this voltage
                                                  source can be replaced with a nonlinear resistor.
      V1                                                                                                                           +-
   -
                                       +
         I1               +
+
-          +

Figure 15.7: CC stage with source, load and
bias sources.

                         + I1              +         +                                                                                     + I1         +         +
                                                                                                                                     V1 -
                                              V2        V3                                                                          -                      V2

                      V1 -                 -         -                                                                                  I3              -         -
                                                                                                                                                    I2
                      -

                                                  +                                                                                                            +

                   +                          +   -                    +                                                                                +      -

                -           I2                       -  V4           -                                                                                            -
                                                     +                                                                                                            +
A                                             -             B                                                                                           -

Figure 15.8: Biasing of the CC stage. Please         The biasing of an NMOS and a PMOS CD stage proceeds in a similar way;
note that Vs and V represent the signal           it is left as an exercise to the reader.
voltages. These voltages are zero in the
quiescent operating point.                        Setting up the initial biasing scheme of CG and CB stages

    A. Addition of the power supply               Figure 15.9 shows an NMOS CG stage with its source, load and bias sources.
voltage to the signal path from Figure            A similar circuit can be designed with bipolar transistor. The biasing of an
15.7, redirecting of the current sources via      NPN and PNP CB stage is left as an exercise to the reader.
the power supplies and the ground and
replacing them with passive nonlinear                Similar as with the biasing of the CE and CS stage, the bias quantities have
resistors.                                        to be derived from the power supply voltages with the aid of the nonlinear
                                                  resistive elements. This process is illustrated in Figure 15.10.
    B. Replacing V1 with a passive nonlin-
ear resistor, requires the addition of a bias        Figure 15.10A shows the result after adding the power supply voltages,
current IV1 through it.                           redirecting the current sources via the power supply voltage sources and
                                                  replacing them with nonlinear resistors. In order to have a nonzero voltage
   V1                                 +  -        drop across I2, a negative supply voltage VN has been added. Figure 15.8B
             +                                    shows the addition of a current IV1 through V1, so that this voltage source
-                                      V2         can be replaced with a nonlinear resistor. The biasing of an NMOS CD stage
                                                  proceeds similarly. This is left as an exercise to the reader.
                                  I2
   I1

Figure 15.9: CG stage with source, load and       Initial biasing of other three-terminal configurations
bias sources.
                                                  Until now, we have discussed the design of initial biasing schemes for some
                                                  basic amplifier stages of which the source and the load share one terminal.
                                                  By taking the initial bias scheme from Chapter 3 as starting point, both the
                                                  source and the load operate at (V, I) = (0, 0). Hence, the DC voltage across
                                                  the source and the load and the DC current through the source and the load
                                                  all equal zero. These conditions are not always required nor desired. In fact,
                                                  some signal sources like PIN diodes in optical receivers require a nonzero
                                                  DC bias voltage for high-speed operation, while a low-noise amplifiers for
                                                                         15.2. SETTING UP THE INITIAL BIASING SCHEME 493

radio applications may need to drive a mixer that requires a nonzero DC bias
current. A signal source or a load that needs, or is allowed to operate under
nonzero bias conditions can be modeled with the aid of a bias-free source or
load and bias sources, similar to the bias sources to two-terminal elements
in Chapter 3. A biasing example with added output offset can be found in
Chapter 9.

   I1                             I2               I1                                                         I2
                                           V2 V3
  V1                                                                                                                                                                 V3
-                                                                                                                                       V2
                                  --                 V1                                                                                                               -
                                                +  -                                                                                                                    +
                                  +
                                                                                                                                     +                                      -
                                                                                                       +                                                                       +
       +
                                                                                                                                                         --
                              I3                                                                          I3      I4                                                           +

A                                                                                                                                         V4

                                                   B

   Although the return path for the source signal and the load signal, in three                               Figure 15.10: Biasing of the CG stage.
terminal amplifiers, are the same, they do not always need to operate at the                                  Please note that Is and I represent the
same DC voltage with respect to the ground. If the source and the load                                        signal currents. These currents are zero in
share the signal return paths, but allow a DC offset between their common                                     the quiescent operating point.
terminal, a DC bias voltage can be added to the biasing scheme. At a later
stage of the design, the number of voltage sources can minimized.                                                 A. Addition of the power supply
                                                                                                              voltage to the signal path from Figure
   Example 15.1                                                                                               15.9, redirecting the current sources via
                                                                                                              the power supplies and the ground and
       In this example we will discuss the design of a series stage with an NPN                               replacingthem with passive nonlinear
   transistor, of which the load:                                                                             resistors.

1. is a nonlinear resistor,                                                                                       B. Replacing the bias voltage sources
                                                                                                              from Figure 15.10A with passive nonlinear
2. is electrically isolated from the source and the ground,                                                   resistors requires the addition of bias
                                                                                                              currents through them.
3. is allowed to operate at a nonzero common-mode voltage,
                                                                                                                                        -
4. must be biased with a current IQ,
                                                                                                                                            +
5. carries a voltage VQ at this bias current.
                                                                                                              Figure 15.11: Model of a nonlinear resistor
       Figure 15.11 shows a model of this load.                                                               biased at (V, I) = (VQ, IQ), and isolated
       The series stage will be driven from a voltage source with a source impedance                          from the ground.
   Zs, of which one terminal is connected to the ground. The source should operate
   at zero bias current and zero bias voltage.
       The series stage should provide a voltage-to-current transfer for signals of
   which the frequency components of interest include zero (DC).
       Figure 15.12 shows the circuit diagram of the biased series stage connected to
   its source and load.
       Figure 15.13 shows the biasing scheme after the power supply sources have
   been added, the bias current sources have been redirected via the power supplies
   and replaced with passive nonlinear resistors with a current source character. The
   negative power supply voltage source V3 is required for biasing I3. The bias
   voltage across I4 amounts VCE. It can be increased by connecting I4 to the
   negative supply as well.
       The bias current through V1 equals zero. In order to replace this voltage source
   with a passive nonlinear resistor, a bias current needs to be added. The biasing
494 AMPLIFIER BIASING                         scheme can be simplified by taking the operating current of the BJT equal to that
                                              of the load: IC = IQ. Changing the operating current or voltage of an amplifier
Figure 15.12: Biased series stage, driven     stage, a biasing element, the source, or the load is one of the techniques to simplify
from its source and loaded with the biased    the biasing scheme of an amplifier. We will give more examples of the application
load from Figure 15.11.                       of this technique at a later stage. The result of the above actions is shown in Figure
                                              15.14.

                                                                         -
                                                                                                       +      -
                                                                                                          -    +
                                                                   +
                                                                +                                          -

                                                 +          +

                                                 -                                                        +

Figure 15.13: Simplified biasing scheme for                +         I1     +          I2     +
the circuit from Figure 15.12.

                                                           -                -                 -
                                                            V1
                                                           -                       +

                                                                                                                           V2-+

                                              +               I3                   I4                        -

                                                                         +                    +

                                              -                          -                    -

                                                                                                             -       V3
                                                                                                             +

Figure 15.14: Biasing scheme for the circuit                                I1+            +
from Figure 15.13 for the case in which
IQ = IC.                                                      V1
                                                            -
                                                                  -                        -
                                                             +
                                                             - I3 +                    +

                                                                                -      -                          +

                                                       I2                                                         -
                                              +
                                              -

                                                                                                                  -
                                                                                                                  +

                                                 Although we confine ourselves in this chapter to the design of the initial
                                              biasing scheme of amplifiers, it may be helpful to show a possible final im-
                                              plementation of the biasing of the series stage from the preceding example.
                                              By doing so, it will become clear that separation of the design of the signal
                                              path and the biasing helps us with clearly defining requirements and design
                                              limits for biasing circuitry before designing them. This makes it possible to
                                                                     15.2. SETTING UP THE INITIAL BIASING SCHEME 495

estimate the feasibility of the biasing of an amplifier (stage) at an early stage
of the design.

   In the following we will show relatively simple implementation of the bi-
asing in which the biasing elements with a current source character will be
replaced with resistors and the biasing element with a voltage source charac-
ter will be replaced with a diode.

   Example 15.2

       Figure 15.15 shows a simple implementation of the biasing scheme from Fig-
   ure 15.14. In this implementation the nonlinear resistors with a current source
   character have been replaced with linear resistors and the nonlinear resistor with
   a voltage source character (V1) has been replaced with a diode. By doing so, the
   signal performance of the series stage from Figure 15.14 differs from that of the
   initial series stage from Figure 15.12:

                                                                                                                                                    +

1. The input impedance of the series stage is decreased, this reduces the transadmit- -
   tance of the stage.
                                                                 -                                                                                         R1                            V2
                                                                                    -
                                                                                                                                                       Q2      Q1
                                                                                                                                                                       -
                                                                                                                                                                                      +R2R3V3
                                                                                                                                                                       -
2. The spectral densities of the equivalent input noise sources of the stages are in-                                                                                                 +Figure 15.15: Possible final implementation
   creased.                                                                            of the series stage from Figure 15.12.

3. The nonzero conductance of R3 increases the transadmittance of the stage.

       Another disadvantages of this implementation is that the PSSR for both pos-
   itive and negative supply voltages is not as good as it would be using nonlinear
   resistors with a current source character.

   Although the biasing solution in presented in the preceding example seems
attractive because of its low complexity, the penalties on the signal behavior
may be too large. Hence, the design of the biasing elements should start with
setting up their performance specification. This will be discussed at a later
stage.

15.2.3 Biasing of cascode stages

In Chapter 14, we have introduced the cascode stage as a basic amplifier stage
that consists of two transistors. The reason for this is that, when applied in
negative feedback amplifiers, the CG or CB stage does not add a dominant
pole to the loop gain poles product. In this section we will study the biasing
of this cascode stage.

    V3                                                           V4                    Figure 15.16: Initial schematic of a biased
                                                                                       NMOS cascode stage.
                                                                +-
                                         +
       I3                                                        I4
                         +
+
 V1
- V2

I1         I2

   Figure 15.16 shows an NMOS cascode stage with its initial bias sources.
Each of the two transistors of the cascode stage is biased with the aid of four
bias sources. The voltages and currents provided by these sources should be
derived from the power supply voltage. Figure 15.17 shows two steps of this
biasing process.
496 AMPLIFIER BIASING

                                                                                                                             Figure 15.17A shows that the biasing scheme can be simplified by raising
                                                                                                                          the voltage level of Q2 with respect to the ground. This is done by shifting
                                                                                                                          the voltage source V2 through the device. It then appears in series with V3
                                                                                                                          and V4. The bias current sources have been redirected via the power supply
                                                                                                                          and replaced with nonlinear resistors with a current source character.

   I1         I2                          -   I3                                                                          V4          I1  I2  I3                    -     V4
                                          +                                                                                                                            +
      V1                                       -   V3                                                                                 V1          V3
                                                +                                                                                             -
   -                                                               -                                                                  -       +
                                                                       +                                                                                 -
+                                                                                                                        ++    +                          +                   +
in                                                                                                                                                                  -
-                    +                    V2                                                                              out  in I4                                   +I5    out
            +
                                                                                                                          -    -                                              -

                                                                                                                                              V2 V5

A                                                                                                                              B

Figure 15.17: Biasing of the NMOS cascode                                                                                    Figure 15.17B shows the result after bias currents have been added through
stage:                                                                                                                    the bias voltage sources. By doing so, these bias sources can be replaced with
                                                                                                                          passive nonlinear resistors. The negative supply source V5 is added to obtain
    A. Current sources replaced with biased                                                                               a positive voltage drop across the current source elements I4 and I5. As a
passive elements                                                                                                          matter of fact, the positive supply voltage VP, or the drain-to-source voltages
                                                                                                                          of the transistors may need to be adjusted to obtain sufficiently large bias
    B. Voltage sources replaced with biased                                                                               voltages for I1, I2 and I3.
passive elements
                                                                                                                             Changing the voltage level and the bias voltages of devices are techniques
          I1                              V1                                                                              that can be used for simplification of the biasing scheme. These techniques
                                          -                                                                               will be discussed at a later stage.
   +                                      +
   in                                          -                                                                             Another technique that can be applied for simplification of the biasing
   -                                            +                                                                         scheme is the use of complementary transistors. Figure 15.18 shows the so-
                                                                                                                          called folded cascode stage in which the CG stage transistor is the complemen-
                                       out-                                                                               tary type of the CS stage transistor. All the previously mentioned techniques
                                          +                                                                               have been used to simplify the biasing scheme that now requires current
                                                                                                                          source elements only. The application of complementary devices will also be
                                                                                                                          discussed at a later stage.

              I1                          V2

Figure 15.18: Biased folded cascode..                                                                                     15.2.4 Biasing of anti-series stages

                           Out  -                  +                                                                      In this section, we will discuss the biasing of the balanced anti-series stages.
                                                                                                                          In Chapter 6, we have seen that anti-series stages can be biased with common-
+                                                  -                                                                      mode current sources only (see Figure 6.31). Figure 15.19 shows the way in
                                                                                                                          which this is done for an NMOS anti-series stage. The bias current sources
    In                                                                                                                    have been replaced with using nonlinear resistors with a current source char-
                                                                                                                          acter. However, by doing so, the node voltages with respect to ground are
-                                                                                                                         undefined. In fact, in this biasing concept, the differential pair is floating
                                                                                                                          with respect to the ground.
Figure 15.19: NMOS anti-series stage
biased with with nonlinear resistors with                                                                                    In practice, we need to fix the common-mode voltages of the input port
a current source character. The common-                                                                                   and the output port with respect to ground in such a way, that under all
mode voltages are yet undefined.                                                                                          operating conditions, the biasing elements and the transistors are properly
                                                                                                                          biased. This can be accomplished in various ways. In Chapter 9, several
                                                                                                                          methods for common-mode biasing have been introduced. In order to grasp
                                                                                                                          the idea that these are the concepts behind the circuit implementations given
                                                                                                                          below, the reader is invited to study this chapter.
                                                                         15.2. SETTING UP THE INITIAL BIASING SCHEME 497

Source or load common-mode biasing

Source or load common-mode biasing is a technique in which the common-
mode voltage at the input port is defined by that of the source and/or the
common-mode voltage at the output port is defined by that of the load. Fig-
ure 15.20 shows an application of this technique for the case in which both
the source and the load have a common-mode connection, and the common-
mode voltages are fixed with the aid of nonlinear resistive elements.

                                                                                                                                     Figure 15.20: Differential-pair NMOS stage
                                                                                                                                     of which the common-mode voltages at the
                                                                                                                                     input port and the output port have been
                                                                                                                                     fixed by those of the source and the load,
                                                                                                                                     respectively.
                       -
         +--
   +                                                                                      +

+           +

-           -

                                                                                             +

This way of biasing requires a signal source or load that has a finite DC

resistance to a common-mode voltage. Such source and load configurations                     -

are not always available. In those cases the common-mode voltages have to

be defined by using different biasing techniques.

Brute force common-mode biasing                                                                                        +

Brute force common-mode biasing is a technique in which the common-mode                                             -
level at a port is defined by connecting the terminals of the port with resis-
tors to a common-mode reference voltage. Figure 15.21 shows the applica-                     Figure 15.21: Method for fixing the
tion of this technique for fixing the common-mode voltage and the common-                    common-mode voltage and the common-
mode resistance of a signal voltage source that is floating with respect to the              mode resistance of a floating source using
ground. The common-mode resistance of the source is reduced from infinity                    a brute force resistive connection to a
to Rcm. This way of biasing may deteriorate the signal performance of the                    common-mode voltage source.
stage:

1. The bias resistors generate noise and increase the noise contribution of the                 +
   equivalent input noise sources of the differential pair                                      -

2. The bias resistors attenuate the source signal and increase the influence of              Figure 15.22: Method for creating a
   the source impedance on the signal transfer of the differential pair.
                                                                                             common-mode resistance Rcm  =   1    tied
Local common-mode feedback                                                                                                  gm

Similar to the design of feedback amplifiers (see Chapter 7), the common-                    to a common-mode voltage Vcm, without
mode impedances, voltages or currents can be fixed to an accurate value
with the aid of negative feedback. Figure 15.22 shows the concept for fixing                 affecting the differential-mode impedance.
the common-mode impedance and bias voltage of a floating port.
                                                                                                                                  +
   The open-circuit common-mode voltage of this circuit equals Vcm and the                                                        -
common-mode impedance equals gcm 1 . The differential-mode impedance is
not affected by the common-mode feedback.                                                    Figure 15.23: Implementation of the con-
                                                                                             cept from Figure 15.22 with NMOS transis-
   Figure 15.23 gives an implementation of this principle with four equal                    tors and nonlinear resistors with a current
NMOS transistors. In the quiescent operating point the gate-source voltages                  source character.
of these devices all equal VGS, which is the common-mode voltage of the port.
As a result of the finite output resistance of the MOSFETs, the differential
input resistance of the port is limited to rds, which is the DC output resistance
of one transistor in its operating point. For a large differential input voltage
498 AMPLIFIER BIASING

                                              range and a large differential-mode input resistance, the devices should be
                                              as long as possible and operate in strong inversion. In the following example
                                              we will plot the DC characteristics of the common-mode biasing circuit from
                                              Figure 15.23.

                                                 Example 15.3

                                                     In this example we will evaluate the DC port characteristics of the circuit from
                                                 Figure 15.23. Figure 15.24 shows the test circuit and the DC characteristics.

               I_s

10uA                          10uA
          (1)          (2)

4x C18nmos W=220n L=1u

Figure 15.24:                                        The listing of the spice input file is shown below:
    Left: spice circuit for determination of
                                               1 RcmVcmNMOS
the DC characteristics from Figure 15.23.      2 * File: RcmVcmNMOS.cir
    Right: Node voltages, common-mode          3 * LTspice circuit file
                                               4 .include CMOS18TT.lib
and differential mode voltage as a function    5 M1 1 1 0 0 C18nmos W=220n L=1u
of the differential-mode input current.        6 M2 1 2 0 0 C18nmos W=220n L=1u
                                               7 M3 2 2 0 0 C18nmos W=220n L=1u
                                               8 M4 2 1 0 0 C18nmos W=220n L=1u
                                               9 I1 0 1 10u
                                              10 I2 0 2 10u
                                              11 I3 1 2 0
                                              12 .dc I3 -1u 1u 1n
                                              13 .end

                                                 Over a differential input voltage range of ±0.25V the differential input re-
                                              sistance is about 10M. Outside this range the input resistance drops and the
                                              differential-mode to common-mode conversion becomes significant.

Figure 15.25: Anti-series CS stage of         -
which the common-mode input voltage,                                                 -
the common-mode input resistance, the
common-mode output voltage and the                                                                            -
common-mode output resistance are fixed                                                                                +
according to the method from Figure 15.22.                                                          Out
                                              In
                                                                                           +
                                              +

                                              Figure 15.25 shows an arrangement in which this type of biasing has been
                                                                         15.2. SETTING UP THE INITIAL BIASING SCHEME 499

applied at both the input port and the output port of an anti-series CS stage.
At the output port, the common-mode voltage is referred to the power supply
voltage. It is controlled by four PMOS devices.

   It should be noted that this way of common-mode biasing may result in
a deterioration of the signal-to-noise ratio. Since the channel noise of the
four MOS devices is uncorrelated, it contributes to differential current noise.
This noise contribution can be kept low by making the bias currents of these
devices as low as possible. In fact, this bias current should be large enough
to maintain proper biasing for all values of the common-mode input current.

   Another disadvantage of the circuit is its contribution to the differential-
mode input capacitance of the biased port.

Feed forward common-mode biasing

Feed forward common-mode biasing is a technique in which the common-             in  out  in  out
mode voltage or current at the output port is fixed by means of fixing the
common-mode voltage or current at the input port, together with the common-      A        B
mode transfer of a balanced stage. This technique can be used to establish
a well-defined common-mode output voltage in anti-series connected stages        Figure 15.26: Anti-series connected stages
with DC parallel feedback at the output port:                                    with a well-defined common-mode trans-
                                                                                 fer:
1. The balanced common drain stage or the balanced common collector stage
                                                                                   A. The anti-series connection of grounded
2. The balanced shunt stage                                                      voltage follower stages has a common-
                                                                                 mode voltage gain of unity.
3. Anti-series connected multiple-loop passive feedback stages with parallel
   feedback at the output port.                                                    B. The floating anti-series connection of
                                                                                 shunt stages has a common-mode voltage
   Figure 15.26A shows the signal diagram of the balanced voltage follower,      gain of unity.
of which the common terminals of the stages (collectors or drains) have been
connected to the ground. Please note that this does not affect the balanced
operation if both the source and the load are truly balanced with respect to
the ground. Since this stage has a common-mode voltage gain of unity, the
common-mode voltage at the output port will be defined by that at the input
port.

   Figure 15.26B shows the signal diagram of a balanced shunt stage with
resistive feedback. In this circuit, the common terminal of the stages (the
emitters of sources) have been left floating with respect to the ground. In
this case, the common-mode voltage gain of the stage equals unity and the
common-mode voltage at the output port can be defined by that at the input
port. If the common terminal of the two stages is grounded the common-
mode transresistance equals the DC feedback resistance. In that case, the
common-mode output voltage can be fixed with the aid of a common-mode
input current.

Over-all common-mode feedback.

Over-all common-mode feedback uses the balanced stage to be biased as
part of the circuit that controls the common-mode voltage at one of its ports.
Figure 15.27 shows the application of overall-feedback for fixing the common-
mode voltage at the input port of an anti-series CS stage. The common-mode
voltage at the sources of the differential pair (M1, M2) is used to control the
input common-mode current generated by M3 and M4. The input common-
mode voltage is set to the sum of the gate-to-source voltages of (M1, M2) and
(M3, M4). These voltages are defined by the technology the geometry and the
drain currents of the MOS transistor.

   Figure 15.28 gives an arrangement in which the common-mode voltage at
the output of the differential pair is also fixed by using over-all common-
mode feedback. This voltage equals the sum of the gate-to-source voltages
500 AMPLIFIER BIASING

                                             of (M5, M6) and M7. The anti-series CD stage constructed with M5 and M6,
                                             detects the common-mode voltage at the output of the anti-series stage (M1,
                                             M2) and adds a voltage level shift to it. In order to keep the differential-mode
                                             to common-mode conversion low, the pair (M5, M6) should operate in strong
                                             inversion.

                                                It should be noted that common-mode feedback may result in common-
                                             mode instability and frequency compensation techniques may be required to
                                             ensure frequency stability of the common-mode loop(s). In general, the band-
                                             width of the common-mode loop should be kept as large as possible. Band-
                                             width reduction of the common-mode loop, combined with differential to
                                             common-mode conversion may result in operating point shift and reduction
                                             of overdrive recovery. The design of the frequency behavior of the common-
                                             mode behavior proceeds similar to that of the differential-mode behavior.

Figure 15.27: Anti-series CS stage of which                                                    -               Out
the common-mode input voltage is fixed                                                                                                                                -
using over-all common-mode feedback,                                                          +In                                                                               +
while the common-mode voltage of the
output port is fixed with the aid of local       +                                                 -
common-mode feedback.                        +                                                                                            -
                                                                                                                                                                   -
                                                                                                                                                                             +M1M2

                                                 M3                                                    M4

Figure 15.28: Anti-series CS stage of which     I4                                                  I1 M5           M6 I2
the common-mode input and output I3
voltages have been fixed using over-all      In                                                     Out+                               Out-
common-mode feedback.
                                                                                                   M1                               M2

                                             M3                                                    M4      I5       M7

                                             15.2.5 Biasing of complementary-parallel stages

                                             In this section, we will discuss the biasing of the balanced complementary
                                             parallel stages. In Chapter 6, we have seen that these stages can be biased
                                             with common-mode voltage sources only (see Figure 6.40).

                                                Figure 15.29 shows the biasing of the complementary parallel stage. Fig-
                                             ure 15.29A shows the initial biasing scheme from Figure 6.40. Figure 15.29B
                                             shows the biasing with two supply sources and nonlinear resistors with a
                                             voltage source or current source character. Because of its importance as class
                                             AB output stage in operational amplifiers, the biasing of the complementary
                                             parallel stage has been a subject of research and many solutions have been
                                             proposed. The most important aspects related to the design of the biasing of
                                             the complementary parallel stage are:
                    15.2. SETTING UP THE INITIAL BIASING SCHEME 501

                                                                                   Figure 15.29: Biasing of the complemantary

                    I1       +  V1                                                 parallel stage:

                          +                                                        A. Biasing scheme according to Figure
                     V3
          +                  -                                                     6.40
                         -
       +     V1                                                                    B. Biasing using nonlinear resistors
   V3                V4 +
          -              -                                                         with a current source and a voltage source
       -
             +      I2          + character.

+            -   +              -

       +

-  V4     +      -

       -     V2

          -                  +  V2

A                B           -

1. Accurately fixing of the quiescent current over a wide temperature range
   and supply voltage range.

   In order to make the quiescent (common-mode) current of the stage con-
   stant over a wide supply range and temperature range, the voltages of
   V3 and V4 should accurately track with the supply voltages and with the
   gate-to-source voltages of the MOS transistors.

2. Minimization of the cross-over distortion of the stage.

   If the complementary parallel stage operates in class AB mode, the transfer
   during the zone in which the two transistors contribute equally to the out-
   put current may strongly differ from the transfer in the regions in which
   either the P or the N device contributes to the output current. This behav-
   ior has already been illustrated in Figure 6.42. This change in gain during
   the take-over of the current causes so-called cross-over distortion. Minimiza-
   tion of this distortion requires optimization of the quiescent current of the
   complementary-parallel stage.

   In this section we will present three solutions for the biasing of the com-     5 This will be referred to as a split-signal
plementary parallel stage. All solutions use model-based biasing techniques.       output stage.

   First we will introduce a low-voltage solution in which the power supply                                M1 V1
defines the biasing current. Secondly, we will present a solution for a com-                                           -
plementary parallel stage that can be biased from a higher voltage and driven                                           +
from a single input signal. Subsequently we will present a solution for the
biasing of a class AB output stage in which the P device and the N device are                                    -
driven from separate signals.5 Examples of implementations will be given
for MOS technology only.                                                                                               -
                                                                                                                        +
   As stated earlier, the design of class AB output stages has been a topic of
intensive research. The reader is invited to study literature on this subject,
investigate the concepts behind circuit implementations and find alternative
implementations of those concepts.

Model-based biasing of the CMOS inverter                                                                      out
                                                                                         +
Figure 15.30 shows a CMOS complementary-parallel CS stage, of which the                             +
transistors are biased at zero drain-gate voltage. The quiescent current of the
stage is determined by the power supply voltages. Hence, for accurate bias-              in                                V2
ing at an operating point with minimized cross-over distortion, the supply
voltages should track with the quiescent gate-source voltages. This can be               -          M2
done with the aid of a low-drop voltage regulator as shown in Figure 15.31.
In the circuit shown in this figure, the total supply voltage VSGP + VGSN is       Figure 15.30: The CMOS inverter biased
                                                                                   with the supply sources.
502 AMPLIFIER BIASING

          I1        -   V1                   generated by letting the required bias current Ibias flow through the series
                    +                        connection of an NMOS and a PMOS with shorted gate-drain.
M1
                                             Model-based biasing with single input signal
                 +
                                             Figure 15.32A shows the concept of the common-mode biasing of a comple-
M2               -                           mentary parallel stage CMOS stage using biasing with two floating voltage
                                             sources (V1, V2). In order to make the quiescent current of this stage inde-
Figure 15.31: Supply voltage generation for  pendent of the temperature and insensitive for device tolerances, the voltages
accurate biasing of the CMOS inverter.       of these sources should track with the quiescent gate-to-source voltages of the
                                             MOS devices. This can be achieved using model-based biasing.

                                                In the CMOS implementation of this biasing concept, from Figure 15.32B
                                             this is done by generating the reference current with two complementary
                                             MOS devices (M3, M5), biased at zero drain-to-gate voltage. Their quiescent
                                             operating conditions are copied to (M4, M6). Hence, the voltages across the
                                             two resistors (R2, R3) equal VP-VSGP and VN - VGSN , respectively. If all
                                             N devices are equal, and all P devices are equal, the quiescent current of
                                             all complementary pair are equal. They do, however, depend on the power
                                             supply voltage.

             F1 + M1                                          M3 M4 M1
                                                                                                                                         V1
                 -                                    -   V1                                                                                                          -
                                                       +                                                                                                               +
                        +                                                     R2  C1
                    V1                          -                                                                                                               -

      I1     in         -                    out      -               R1  in          out                                                                             -
                                                       +                                                                                                               +
A         -             +                                                 - R3 C2
                                                                                                                                                             +
                                                                                                                              +

                                               +
                 +
                    V2

                        -                                 V2          M2                                                                                                  V2

             F1 +                                                 M5          M6 M2

                                         M2                   B
                      -

Figure 15.32: Model-based biasing of the     Low-voltage push-pull stage biasing
complemantary parallel stage:
                                             A similar biasing method can be used for biasing a complementary-parallel
    A. Biasing concept                       stage at low supply voltages. We speak of low-voltage design if the power
    B. Model-based CMOS implementation.      supply voltage can be as low as the sum of one gate-to-source or base-
                                             to-emitter voltage and one drain-to-source or collector-to-emitter saturation
6 A. Torralba, R. G. Carvajal, J. Ramirez-   voltage.
Angulo, J. Tombs, and T. Galan. Class ab
output stages for low voltage cmos opamps       A. Torralba, R. G. Carvajal, J. Ramirez-Angulo, J. Tombs and T. Galan [Tor-
with accurate quiescent current control      ralba2001]6, present a solution for low-voltage biasing of a complementary-
by means of dynamic biasing. In ICECS        parallel stage of which the concept is shown in Figure 15.33.
2001. 8th IEEE International Conference
on Electronics, Circuits and Systems (Cat.      In the right part of the circuit, the transistors M3 and M4, together with the
No.01EX483), volume 2, pages 967-970,        resistor R2 that implements a floating voltage source and the power supply
2001                                         source V1, constitute the biased complementary parallel stage. The voltage
                                             across R2 is generated by two controlled current sources of which the current
                                             is a copy of the output current of the controller in the bias control circuit. This
                                             bias control circuit is shown left from the dashed line. This circuit generates
                                             the current IN that will cause a voltage drop of VSGP + VGSN - VP across a
                                             resistor with a resistance R, where VSGP and VGSN are the diving voltages for
                                             letting the PMOS and the NMOS operate at a quiescent current Ibias. This is
                                             achieved as follows.

                                                The required bias current Ibias is generated by the reference current source
                                             I1. This current flows through the gate-drain shorted PMOS, while a copy of
                                                     15.2. SETTING UP THE INITIAL BIASING SCHEME 503

                               +         I3                +                 (7)      Figure 15.33: Low-voltage model-based
   I2                                        I4                    M3                 biasing of the complemantary parallel
                                     (1)                                              stage.
                                      R1                 -
          M1  -                      (3)

                                             (4)

                                             R2               (6)      -  V1
                                                                       +
            M2 (2)                              (5)
                                             + I5 M4
   +
                                 I1                      -

   -

it flows through the gate-drain shorted NMOS. In this way the two driving             7 D. M. Monticelli. A quad CMOS single-
voltages for the MOS transistors VSGP and VGSN are obtained.                          supply opamp with rail-to-rail output
                                                                                      swing. IEEE Journal of Solid-State Circuits,
   In order to create a voltage drop VSGP + VGSN - VP across a resistor, R1           21:1026-1034, December 1986
is tied to node (1) and a nullator is placed between node (2) and (3). The
norator draws a current IN through R1, which causes the required voltages
drop across it. In order not to affect the current trough M1, a copy of the
norator current is delivered by I3. In this way, the current IN causes the
required voltage drop VSGP + VGSN - VP across R1. The controlled current
sources I4 and I5 provide a copy of this current for biasing M3 and M4 at a
quiescent current Ibias.

   It should be noted that the location of the norator and the current-controlled
current source I3 can be interchanged. This also holds for I1 and I2.

Model-based biasing with split input signal

                                                                   M5

       +                                     +                                                                         +

   V3 I1 I3 V1                                                                    I1  I3                                  V1

       -                                     -                     M6                                                  -

                                      M2                                                                           M2
              M1                                                                           M1
                                                                   I5
              M3
                                      M4                                                   M3
                                                                                                                   M4

       +                                     +                                                                         +

   V4     I2                         I4          V2                M7             I2  I4                                  V2

       -                                     -                                                                         -

A                                                             B    M8

   Figure 15.34 shows a solution presented by Monticelli[Monticelli1986]7             Figure 15.34: Output stage with split signal
that uses a so-called split signal path. The circuit consists of two amplifier        path for source and sink output current,
halves, one providing the source output current and the other providing the           presented by Montichelli.
sink output current. The source and the sink current are added by connecting
the outputs of the source and the sink halves in parallel.

   Figure 15.34A shows the basic concept. The controlled current sources
(I1, I2) provide the signal current, while the bias voltages provided by V1
and V2 and the bias currents provided by I3 and I4 set the quiescent current
of the output complementary CS stages (M2, M4). A positive signal current
504 AMPLIFIER BIASING

                                            provided by I1 causes a sink output (signal) current, while a positive signal
                                            current provided by I2 causes a source output (signal) current. The signal
                                            currents from (I1, I2) are passed through the common-gate stages (M1, M3)
                                            to the output transistors (M2, M4), respectively.

                                               Figure 15.34B shows the implementation in which the current source ele-
                                            ment I5, together with M5 through M8 provide the model-based biasing volt-
                                            ages for the transistors in the signal path.

                                               As a result of the inclusion of the common-gate stages in the signal path,
                                            circuit is not a true complementary-parallel connection of CS stages. Figure
                                            15.35A shows the simplified signal diagram with generic biased devices and
                                            Figure 15.35B shows the small-signal equivalent circuit.

   I1                                              R1  G1  +                      Z1 +
                                                                                          -
             M1 M3 M2 Z1 + I1                                                  -
                                              -
                                                       -
                M4                             I2               G3 R3

                                                       +

A  I2                                       B

Figure 15.35: Signal diagram and small-        Figure 15.35A shows that if the two inputs are connected together, the
signal equivalent circuit of the push-pull  stage acts as complementary-parallel CS stage. For non-zero frequencies this
stage from Figure 15.34A.                   can be achieved by placing a capacitor across the two input terminals.

        M4, M2                                 In the quiescent operating point both the push and the pull stage con-
                                            tribute to the output current. If both stages have equal parameters, the con-
        M1, M3      Z1 +                    trolled current sources G1 and G3 generate equal but opposite currents and
                                            the resistors R1 and R3 carry no voltage. The stage then acts as a parallel
I1, I2                 -                    connection of two complementary CS stages.

Figure 15.36: Signal diagram of the push-      In cases in which the output source or sink current exceeds the quiescent
pull stage from Figure 15.34A for the       bias current, only the source or sink output transistor contributes to the out-
sink/source phase.                          put current.

                                               Figure 15.36 shows the signal diagram and the small-signal equivalent
                                            circuit for the sink or the source phase. During the sink phase M1 and M4 are
                                            active, while during the source phase M3 and M2 are active. The stage then
                                            acts as a cascade connection of a common-gate and a common-source stage.
                                                                                                                                                     505

II

Background knowledge
                                                  507

16 Signal Modeling (selected topics)

16.1 Introduction                            508

16.2 Deterministic signal modeling           508

16.2.1 Power signals and energy signals      509

16.2.2 Time-domain modeling of signals       510

16.2.3 Frequency-domain modeling of signals  511

16.2.4 Cosine transformation                 512

16.2.5 Fourier transform                     512

16.2.6 Complex frequency domain modeling     514

16.3 Random signal modeling                  515

16.3.1 Stationary and ergodic processes      516

16.3.2 Time average and ensemble average     516

16.3.3 Correlation function                  516

16.3.4 Autocorrelation function              517

16.3.5 Mean square value                     518

16.3.6 Wiener-Khintchine theorem             518

16.3.7 Power spectral density                518

16.4 Signals, data and information           518

16.4.1 Amount of data                        518

16.4.2 Bandwidth and minimum sample rate     519

16.4.3 Crest factor                          519

16.4.4 Data rate                             519

16.4.5 Information rate                      520

16.4.6 Relevant signal properties            520

16.4.7 Channel capacity                      520

16.4.8 Spectral efficiency                   521
508 SIGNAL MODELING (SELECTED TOPICS)

                                 16.1 Introduction

                                                  Signal modeling provides descriptions of signals that can be used for the eval-
                                                  uation of the performance of information processing systems. Signal mod-
                                                  eling can be done using statistical or deterministic description methods. A
                                                  deterministic model describes the signal as a time function, while random
                                                  signal modeling uses statistical description methods such as amplitude dis-
                                                  tribution functions, average values, etc. It should be noted that signals are
                                                  neither deterministic nor stochastic. It is up to the designer to decide whether
                                                  to use deterministic or stochastic description methods.

                                                      Deterministic signal modeling will be discussed in section 16.2 and ran-
                                                  dom signal modeling will be discussed in section 16.3.

                                              16.2 Deterministic signal modeling

                                              Deterministic signal modeling is based upon the resolution of signals into
                                              elementary or basic signals. This way of modeling is convenient because
                                              many information processing systems are intended to be linear and decom-
                                              position of arbitrary signals into elementary or basic signals facilitates the
                                              performance analysis of those systems using superposition. If an arbitrary
                                              signal can be written as a finite or infinite sum of basic signals that all have
                                              the same shape, the system response to an arbitrary signal can then easily
                                              be derived from the response to the basic signal. Basic signals that are often
                                              used for this purpose are:

                                              1. Unit impulse and unit step functions

1 For example, by measurement or analysis.    In section 16.2.2, we will discuss the resolution of signals into a continuum
                                              of time-shifted impulse functions or of step functions. These signals have
2 Energy signals have a finite nonzero        special interest for studying the performance of linear stationary dynamic
energy. Their average power over all time is  systems. If the response to a single impulse or step is known,1 the system
zero.                                         response to an arbitrary signal can easily be related to it. Step functions
                                              are often used as test signals for those systems. The popular square wave
                                              test signal can be constituted from two step functions. System analysis
                                              using impulses or step functions as test signals is also referred to as time
                                              domain analysis.

                                              2. Imaginary exponentials and sinusoidal signals
                                                     In section 16.2.3, we will discuss the resolution of signals into a discrete

                                                 series, or into a continuum of imaginary exponentials. Periodic signals
                                                 can be resolved into a discrete series of imaginary exponentials. Such
                                                 a resolution is described by the Fourier series, and by the sine or cosine
                                                 transform. Non-periodic signals can, under certain conditions, be resolved
                                                 into a continuum of imaginary exponential functions. The Fourier trans-
                                                 form describes such a resolution. The Fourier transform only applies for
                                                 signals that are absolute integrable. For a signal x(t), this means that the
                                                 integral of the absolute value of the signal over all time is finite:

                                                                                       (16.1)

                                                  |x(t)| dt < .

                                              -

                                              Practically, this means that the signal values only differ from zero over a
                                              limited time interval. Signals that meet this condition are called energy
                                              signals or pulse signals.2

                                                 Since exponential signals and sinusoidal signals retain their shape un-
                                              der differentiation and integration, they are often used for characterization
                                              of linear dynamic systems. Any deviation of the shape of the response
                                              from a sinusoid, indicates system nonlinearity. The amount of nonlin-
                                              earity of a system can thus be evaluated by measuring the distortion in
                                                                                    16.2. DETERMINISTIC SIGNAL MODELING 509

   the system's response to a sinusoidal signal. Sinusoidal test signals can be
   constructed from two complex conjugated imaginary exponentials. System
   analysis with the aid of imaginary exponentials is referred to as frequency
   domain analysis.

3. Complex exponentials
       In section 16.2.6, we will discuss the resolution of signals into a contin-

   uum of complex exponentials. This resolution is described by the Laplace
   transform. Application of the Laplace transform is not limited to energy
   signals; it can also be applied for signals that are not absolutely integrable.
   Theoretically, these signals may occur in unstable systems: systems that
   have an unbounded response to a bounded excitation.

   Above, we have introduced the concepts of power signals and energy sig-
nals. Before we continue with signal modeling, we will give the definitions of
power signals and energy signals.

16.2.1 Power signals and energy signals

The average power that can be extracted from a signal x(t) is proportional to

the mean square value x(t)2 of that signal. The mean square value is defined

as  x(t)2 = lim 1 T/2 {x(t)}2dt.

    T T -T/2                                                     (16.2)

A signal with a nonzero mean square value is called a power signal. If the
mean square value of a signal equals zero, it is called an energy signal. The
energy W{x(t)} of a signal x(t) is defined as

    W{x(t)} = lim  T/2  {x(t)}2dt.

    T -T/2                                                       (16.3)

The energy of a power signal is (theoretically) unlimited. In the real world,
all signals are energy signals, but signal modeling uses abstractions for which
it is useful to make a distinction between power signals and energy signals.

                                                                                 Figure 16.1: Three examples of pulse
                                                                                 signals with unit energy and unit width
                                                                                 ( = 1).

   Figure 16.1 shows some examples of energy signals with their energy nor-
malized to unity.

The unit gate pulse                                              (16.4)
The unit gate pulse signal x(t, ) is defined as:                 (16.5)

                                    x(t, ) = 1, |t| <  ,
                                                              2

                                    x(t, ) = 0, |t|   .
                                                              2
510 SIGNAL MODELING (SELECTED TOPICS)

The unit Gaussian pulse
A unit Gaussian pulse signal x(t, ) is defined as

                                                       1         -t2  (16.6)
                                       x(t, ) =           exp 2 .
                                                2            2

The unit sinc pulse
A unit sinc pulse signal x(t, ) is defined as

                                       x(t, ) = sin(t/) .             (16.7)
                                                        t

The unit impulse (t)

The unit impulse function can be obtained as lim0 of all three above pulse
signals. The area (strength) of the unit impulse function is unity

                                                                      (16.8)

                                                   (t) = 1,

                                               -

but the value at time instants other than t = 0 equals zero:

                                       (t) = 0 for t = 0.             (16.9)

16.2.2 Time-domain modeling of signals

In this section, we will discuss the resolution of arbitrary time functions x(t)
into unit impulse and unit step functions. We will see that an arbitrary time
function can be considered to be constituted from a linear superposition of
time delayed unit impulse- or unit step functions. As a consequence, the
behavior of linear systems can be written as a linear superposition of the
responses to these unit impulses or unit steps. This superposition, which is
known as the convolution integral, is often used for graphical determination
of the response of a linear system to an arbitrary input signal. Linear dynamic
systems can thus be characterized by their so-called unit impulse response
or unit step response. Step functions are often used as test signals for the
verification of the behavior of linear dynamic systems.

Resolution in unit impulse functions

A signal x(t) can be resolved into a continuum of time-shifted unit impulses.
We will do this for a signal that has nonzero values between t = 0 and t = T.
The signal value at time instant 0 <  < T is then obtained as the strength of
a unit impulse at t =  with the scalar x():

                                                       T              (16.10)

                                       x(t) = x()(t - )d.

                                                     0

Resolution in unit step functions

The resolution of a signal in unit step functions µ(t) can be found in a similar
way:

                                       x(t) =   T                     (16.11)

                                                  x()µ(t - )d,

                                               0

where x(t) = ddt {x(t)}.
                                                                        16.2. DETERMINISTIC SIGNAL MODELING 511

16.2.3 Frequency-domain modeling of signals

Periodic signals can be modeled as a linear superposition of undamped si-

nusoidal signals. These signals play an important role in the verification of

dynamic systems. This is due to the property that linear dynamic systems

with sinusoidal excitations give sinusoidal responses.

The Fourier series description is based upon the resolution of periodic sig-

nals into a series of imaginary exponentials. It can be shown that an arbitrary
                                             -T              T,
signal  x(t),  within  a  limited  interval         <  t  <      under  certain  conditions
                                                 2           2
may be resolved into a series of imaginary exponentials. It will be clear that

only if x(t) itself is periodic with period T does this decomposition hold for

all values of t. The set of complex amplitudes Xi of the imaginary exponen-

tials constituting this periodic signal x(t) is called the Fourier series for x(t) :

                                                       n=                        (16.12)

                       x(t) =  Xn exp(jn0t).

                                                     n=-

The complex amplitudes Xn are obtained as

                          Xn = 1 x T/2 (t) exp(-jn0t)dt.                         (16.13)
                                  T -T/2

Phasor representation                                                                        Figure 16.2: An imaginary exponential
                                                                                             Ai exp(it + i) represented by a rotating
A single exponential component can be depicted as a phasor (rotating ar-                     phasor.
row) by plotting the imaginary part along the y-axis and the real part along
the x-axis. This is shown in Figure 16.2. Any signal that can be resolved                    Figure 16.3: Two phasors constitute a real
into complex exponentials can be written as a superposition of phasors. Pha-                 sinusoidal signal.
sor representations of signals are often used for modulated signals. Figure
16.3 shows a real sinusoidal signal constructed from two complex conjugated
phasors.

   The complex amplitude Xn of an element of the Fourier series can be rep-
resented by a phasor with amplitude |Xn| and initial phase n rotating with
an angular speed n0.

   |Xn| and n are known as the discrete magnitude and phase spectrum of
the signal x(t), respectively.

Power spectrum, Parseval's theorem

The mean square value of a periodic signal x(t) can be obtained from the
complex amplitudes of the elementary sinusoids from which it is consti-
tuted. Parseval's theorem asserts that the mean square value of a periodic
signal equals the sum of the squares of the amplitudes of the harmonics that
compose that signal:

                                   n=                     n=
                       {x(t)}2 =  Xn.Xn =  |Xn|2.
                                                                                 (16.14)

                                   n=-                    n=-

   The graphical representation of |Xn|2 is called the power spectrum of the
periodic signal x(t).

AC and DC signals

The mean value, the time-average value, or the DC value of a signal x(t) over
a time interval T, is defined as

                          xDC = {x(t)} = 1 x T/2 (t)dt.                          (16.15)
                                                T -T/2
512 SIGNAL MODELING (SELECTED TOPICS)

   The AC signal is the signal that remains after subtraction of the DC value
from the original signal:

                                               xAC(t) = x(t) - xDC.           (16.16)

   The power of a signal can be written in terms of its DC value and the
power of the AC signal:

                                       {x(t)}2 = lim 1 T/2 {xAC(t) + xDC}2dt  (16.17)
                                                     T T -T/2

Since the average value of xAC(t) equals zero, we obtain

                                       {x(t)}2 = {xAC(t)}2 + x2DC.            (16.18)

The RMS (root mean square) value xrms of a signal x(t) is defined as

                                       xrms =     {x(t)}2 =       x2 + x2 .   (16.19)
                                                                  ACrms  DC

A signal with an RMS value xrms delivers the same power to a load as a signal
having a constant value of xDC = xrms.

16.2.4 Cosine transformation

A periodic signal can also be resolved in a series of cosine functions. This
resolution can be written as

                                                                              (16.20)

in which Cn =                          x(t) = xDC +  Cn cos(n0t - n).

                                                              n=1

                                       A2n + Bn2, and n = arctan ABnn with

                                       An = 2      T/2                        (16.21)
                                               T                              (16.22)
                                                        x(t) cos(n0t) dt,
                                       Bn = 2
                                               T  -T/2
                                                   T/2

                                                        x(t) sin(n0t) dt.

                                                  -T/2

This follows directly from the Fourier series description of a periodic signal.
With the aid of Parseval's theorem for periodic signals, the mean square value
of a periodic signal x(t) can thus be written as

                                                            2     1 n=
                                       {x(t)}2    =            +   Cn2.       (16.23)
                                                          xDC     2 n=0

16.2.5 Fourier transform

Non-periodic signals cannot be modeled by a discrete Fourier series. Under

certain conditions, however, these signals can be resolved into a continuum

of imaginary exponentials. An important condition is that the signals are

absolute integrable:

                                                        

                                                      |x(t)|dt < .            (16.24)

                                                  -

   For real-world pulse signals, the conditions are always satisfied. We can
then define an energy spectrum by letting the period T approaching infinity.
It is apparent that such a resolution will then have frequency components
at all frequencies, but the amplitudes of these components will all approach
zero. For this reason, we speak of a frequency density spectrum. The resolu-
tion of a signal into a continuum of imaginary exponentials is known as the
                                                                                        16.2. DETERMINISTIC SIGNAL MODELING 513

inverse Fourier transform:                                                                          (16.25)
            x(t) = F -1 {X(j)} = 1
                                             2                    X(j) exp(jt)d.

                                                              -

The complex amplitude function X(j) is known as the Fourier transform

of x(t):

                                                            

X(j) = x(t) exp(-jt)dt.                                                                             (16.26)

                 -

   The functions x(t) and X(j) form a so-called Fourier pair for which we
will use the short hand notation:

X(j) = F {x(t)} .                                                                                   (16.27)

Some frequently used Fourier pairs are listed in Table 16.1.

time description time function frequency function frequency description

impulse at t = 0  (t)                                                              1                   flat spectrum

impulse at t = t0                                              (t - t0)            exp (-jt0)          imaginary exponential
impulse sequence                                                                                       impulse sequence
real sinusoid                                                        (t  -  nT  )  2    - 2n           impulse pair
Gaussian pulse                                                                     T -              T  Gaussian pulse
                                                              -
unit gate pulse                                                                                        sinc function
                                                              cos (0t)              ( ± 0)

                                                              exp -at2                          -2
                                                                                      a exp 4a

                                                              G (t)                 /2 sin(/2)

Important properties of the Fourier transformation are shown in table 16.2. Table 16.1: Fourier pairs

property                                                      time function                            frequency function
linearity                                                     a x1 (t) +b x2 (t)
scaling                                                                                                a X1 (j) +b X2 (j)
                                                              x(at)                                    |a1| X aj
time shift
frequency shift                                               x (t - )                                 X (j) exp (-j)
duality
time derivative                                               x (t) exp (j0t)                          X (j - j)
frequency derivative
time integration                                              X (-t)                                   2x (j)

average power                                                  dn                                      (j)n X (j)
total energy
time-domain convolution                                       dtn {x (t)}                              dn
time domain multiplication                                    (-jt)n x (t)                             dn X (j)
time domain correlation
                                                                   - t x () d                          1     X  (  j    )  +    X     (0)     (    )
                                                                                                       j
                                                                            1 T/2                                          1
                                                              limT T -T/2 {x (t)} dt            2      limT 2T - |X (j)| d                            2

                                                              limT -T/2 T/2 {x (t)}2 dt                1                              2
                                                                                                       2 - |X (j)| d

                                                              x (t) h (t)                              X (j) H (j)

                                                              x (t) g(t)                                1    X  (  j    )    G  (  j     )
                                                                                                       2
                                                                             1 T/2                                                    (j)|2
                                                                                                       limT               1   |X
                                                              limT T -T/2 x (t) x (t + ) dt                             2T

                                                                                                                Table 16.2: Properties of the Fourier Trans-

                                                                                                                form

Energy density spectrum and Parseval's theorem

The energy of a pulse signal x(t) may as well be obtained from its frequency
domain description X(j). This relation is given by Parseval's theorem, given
in 16.28:

W {x (t)} = lim T/2 {x(t)}2dt = 1                                                                   (16.28)

                                                                               |X(j)|2d,
T -T/2                                                               2 -

where |X(j)|2 is called the energy density spectrum of x(t).

Fourier transform of periodic signals

The Fourier transform gives the spectral density of a signal. Since periodic
signals have a discrete amplitude spectrum, the density must be infinite at
multiples of the fundamental frequency. From this, we expect the Fourier
514 SIGNAL MODELING (SELECTED TOPICS)

                           transform of a periodic signal to be written as a series of frequency impulses
                           occurring at  = n0. Moreover, we expect the strength of the impulses to
                           be 2Xn. Without exact mathematical derivation, it follows that the Fourier
                           transform of a periodic signal can be written as

                           X(j) = F     n=                            n=                                                  (16.29)

                                         Xn exp(jn0t)            =  2Xn( - n0).

                                       n=-                           n=-

                           16.2.6 Complex frequency domain modeling

                           As discussed earlier, periodic signals and absolute integrable pulse signals
                           can be resolved into undamped sinusoids. Many theoretical signals have
                           no power limitation (unbounded signals) and are not absolutely integrable.
                           These signals can be decomposed into complex exponentials. The inverse
                           Laplace transform of X(s), denoted as L-1 {X(s)}, writes a time function
                           x(t) as a continuum of complex exponentials:

                                       x(t) = L-1 {X(s)} = 1                                       +j                     (16.30)

                                                                                                         X(s) exp(st)ds.
                                                         2j -j

                           The continuum of the complex coefficients X(s) is called the Laplace trans-

                           form of x(t):

                                                                                                 

                                       X(s) = L {x(t)} = x(t) exp(-st)dt.                                                 (16.31)

                                                                         -

                              The time function x(t) and its Laplace transform X(s) form a so-called
                           Laplace pair for which we will use the short hand notation:

                                                         X(s) = L {x(t)} .                                                (16.32)

                           Some often used Laplace pairs are given in Table 16.3.

Table 16.3: Laplace pairs  time description              time function frequency function

                           unit impulse at t = 0  (t)                                              1

                           unit step at t = t0           µ (t)                                     1
                                                                                                   s
                                                         tn-1
                           power function                                                          1
                                                         (n-1)!                                    sn

                           real exponential              exp (-at)                                  1
                           cosine function               cos (t)                                   s+a
                           sine function                 sin (t)
                                                                                                      s
                                                                                                   s2 +2

                                                                                                      
                                                                                                   s2 +2

                           The function X(s) from expression 16.31 is called the two-sided Laplace

                           transform of x(t). Most problems can be formulated in a manner that permits

                           all signals to be zero for t < 0. The Laplace transform then reduces to the

                           one-sided Laplace transform:

                                                                                                                          (16.33)

                                       L {x(t)} = x (t) exp(-st)dt.

                                                             0

                              For analysis of linear dynamic systems, the state of the system before t = 0
                           can be described by means of so-called initial conditions.

                              Some important properties of the Laplace transform are listed in Table
                           16.4.
                                                                     16.3. RANDOM SIGNAL MODELING 515

                property                    time function            Laplace transform

                linearity                   a {x1 (t)} +b {x2 (t)}   a {X1 (s)} +b {X2 (s)}
                scaling                     xt                       aX (as)
                time-domain shift                                    X (s) exp (-s)
                                                 a

                                            x (t - ) µ (t - )

                s-domain shift              x (t) exp (-at)          X (s + a)
                time derivative             dtd n-1 n-1 {x (t)}|t=0
                                                                     snX(s) - sn-1x(0) - ...
                s-domain derivative         tx (t)
                time-domain integration      - t x () d              ... - s dt 0 d n-1 n-1 {x (t)}|t=0
                time-domain convolution     x (t) h (t)              d
                                                                     ds  X  (s)

                                                                     1           1t
                                                                      s X (s) + s - x ()d|t=0

                                                                     X (s) H (s)

                time-domain multiplication  x (t) g(t)               X (s) G (s)
                initial value theorem
                                            x (0+) = lims sX (s)

                final value theorem         limt x (t) = lims0 sX (s)

                                                                                 Table 16.4: Properties of the Laplace trans-
                                                                                 form

16.3  Random signal modeling

Random processes are characterized by an ensemble of sample functions gen-
erated by the process. As an example of a random process consider the noise
generation in a resistor. Across the terminals of the resistor, a noise voltage
can be measured, recorded, and plotted versus time. We would like to have
expressions for the time average, the average power, the RMS value and the
power spectral density for this signal. This, however, is not possible, since
we do not have a time-domain description of a random signal. In many sit-
uations, we can obtain these quantities from a statistical description of the
random process using its so-called probability density function.

   To do so, we make different recordings for a large number of equal resis-
tors. These recordings are made over a limited time interval T. This so-called
ensemble of truncated sample signals xTi (t), corresponding to the sample
signals from the different resistors xi(t), can be defined as

                xTi (t) =  xi(t) 0  t  T .                           (16.34)
                             0 t < 0, t > T

   Now, we consider a specific time instant t1. The amplitudes of the trun-
cated sample functions at that time instant constitute a random variable

x1(t1). The possible values of this random variable are denoted as x1. We
are now able to set up an histogram by counting the number of samples of

x1(t1) that fall within a range between x1 and x1 + x1, for all successive
values of x1. This histogram is a discrete approximation of the probability
density function P(x, t1) of the random variable x at a time instant t = t1.
The probability that a random variable x(t) has a value between a and b, at

time instant t is then obtained as

                                                     b               (16.35)

                Pr (a  x  b, t) = P(x, t)dx.

                                                    a

By definition:              

                               P(x, t)dx = 1.                        (16.36)

                           -

Some examples of probability density functions are uniform and Gaus-

sian probability functions. Uniform probability functions have a probability

P(x, t) that does not depend on x. A Gaussian probability density function

is characterized by its mean value µ and its root mean square value  for

µ=0:

                                1    exp -  {x(t) - µ}2
                P(x, t) =                         2.                 (16.37)
                            2                  2
516 SIGNAL MODELING (SELECTED TOPICS)

                                        16.3.1 Stationary and ergodic processes

                                                  A random process is called stationary if its statistical properties do not change
                                                  with time. For stationary processes, the averages, the correlation functions
                                                  and the power spectral densities do not depend on time. It is important
                                                  to notice that, from the observer's point of view, a process can be called
                                                  stationary as long as its properties do not change appreciably over the time
                                                  of interest.

                                                      A process is called ergodic if it can fully be described by one sample func-
                                                  tion only. For ergodic processes, we may obtain the values for the random
                                                variable x(t) only from one truncated sample function xT(t). Ergodic pro-
                                                  cesses are always stationary. A stationary process, however, is not necessarily
                                                  ergodic. Knowledge about the random process that generates the information
                                                  is indispensable for setting up methods for extracting characteristic proper-
                                                  ties of the information from the process. This extraction is needed to find the
                                                  characteristic properties of the information-carrying signals and to formulate
                                                  the requirements for the information processing system. For the verification
                                                  of the behavior of an information processing system, relevant properties of
                                                  the deterministic test signals must be related to these characteristic properties
                                                  of the information source. For this purpose, we will introduce some charac-
                                                  teristic properties of signals, generated by random processes, and relate them
                                                  to properties of deterministic signals that are often used as test signals.

16.3.2 Time average and ensemble average

The ensemble average, or the expectation E{x(t)} of a random variable x(t)
at time instant t, is defined as the weighted sum of all values of the sample
functions at that time instant t, each weighted according to its probability:

                                          (16.38)

E{x(t)} = xP(x, t)dx.

                    -

   If we have n recordings or truncated sample functions xTi (t), we can esti-
mate the expectation at t = t1 from the average value of the n samples x1(t1) :

            1 i=n                         (16.39)

x1(t1) =  xi (t1).

            n i=1

   The time average xi(t) of the sample signal xi(t) is the average value of
the truncated recording xTi (t). It is obtained as

xi(t) = 1T 0 xTi T (t)dt.                 (16.40)

   If a process is stationary, the ensemble average does not depend on time.
If the random process is also ergodic, the ensemble average E{x1(t1)} of a
random variable x(t) equals the time average xi(t) of one recording xi(t).

16.3.3 Correlation function

We have seen that a random variable at time instant t = t1 can be described
by its probability density function P(x, t1). Now, let us assume that, in an-
other random process, a random variable y(t) at t = t2 is described by its
probability density function P(y, t2). The so-called joint probability density
function P(x, t1; y, t2) gives the probability that x(t1) has a value between x
and x + dx1, while y(t2) has a value between y and y + dy, which can be writ-
ten as P(x, t1; y, t2)dxdy. The correlation function tells us something about the
similarity between these two processes. It is defined as the expectation of the
                                                         16.3. RANDOM SIGNAL MODELING 517

product of the two random variables x(t1) and y(t2) at time instants t1 and
t2, respectively:

                                                         (16.41)

            E{x(t1)y(t2)} = - - xyP(x, t1; y, t2)dxdy.

If both processes are stationary, the correlation function only depends on

the time difference t2 - t1. If, in addition, the process is ergodic, we may

approximate the correlation using two truncated recordings xT(t) and yT(t).

For a time difference t2 - t1 = , we may then estimate the correlation func-

tion rxy() of two sample signals xT(t) and yT(t) generated by an ergodic

process as

            rxy() = 1 xT T (t)yT(t + )dt.                (16.42)
                        T0

   From this expression, we intuitively expect that the correlation function
can be interpreted as a measure for the joint power of x(t) and y(t). This
can be expressed by saying that two signals are correlated when they have a
nonzero joint power. As a consequence, the similarity between two signals
x(t) and y(t) can also be found from the average power of the sum of both
signals and the sum of the average powers of the two signals individually.
The average power of their sum is proportional to

            (x + y)2 = x2 + y2 + 2xy.                    (16.43)

   The third term in the expression can be written as 2rxy(0), and if it is zero,
the sum of the powers of x(t) and y(t) equals the power of the sum of both
signals. Two signals x(t) and y(t) are said to be uncorrelated or orthogonal
when rxy(0) = 0.

16.3.4 Autocorrelation function

Of particular importance is the so-called autocorrelation function. This func-
tion tells us something about the correspondence between the values of one
random variable, at two time instants. If the rate of change of a random
variable is large, the correspondence will rapidly drop with the difference
between the two time instants. The autocorrelation function is defined as the
expectation of the product of a random variable at one time instant and the
same random variable at a second time instant. It is written as:

                                  x2P(x, t1; x, t2)dx2.

            E{x(t1)x(t2)} =  - -                         (16.44)

For an ergodic process, the autocorrelation function rx() may be approx-

imated using one sample function of the process with its replica, shifted  in

time. It is an important characteristic for the correspondence between signal

values at time distance  and tells us something about the rate of change of

a signal:

            rx() = 1 xT T (t)xT(t + )dt.                 (16.45)
                       T0

   As an example, consider random noise n(t), which has been passed through
a low-pass filter. Since the output noise of the filter cannot change rapidly,
the similarity between values will be large for small values of . For increas-
ing values of , the similarity will become smaller, and finally, rx() will drop
to zero.
518 SIGNAL MODELING (SELECTED TOPICS)

                                             16.3.5 Mean square value

                                             The mean square value of a random variable x(t) is defined as the expectation
                                             of the squared value of the random variable that equals the value of the
                                             autocorrelation function for t1 = t2 :

                                                                                                      (16.46)

                                             E{x(t)}2 = x2P(x; t)dx.

                                                                   -

                                                If we are dealing with ergodic processes, the mean square value of a trun-
                                             cated sample function random xT(t) can be estimated from rx(0) as

                                             {x(t)}2 = rx(0) = 1 T{xT(t)}2dt.                         (16.47)
                                                                      T0

                                             16.3.6 Wiener-Khintchine theorem

                                             We have seen that the autocorrelation function rx() tells us something about
                                             the correspondence between signal values at two time instants. When rx()
                                             drops to zero for a very small value of , the signal x(t) changes rapidly and
                                             its bandwidth must be large. The relation between the frequency contents of
                                             a signal and its autocorrelation function is given by the Wiener-Khintchine
                                             theorem. This theorem asserts that for a stationary process, the power spec-
                                             tral density Sx() is the Fourier transform of the autocorrelation function:

                                                                               Sx() = F {rx()} ,      (16.48)
                                                                                rx() = F -1 {Sx()} .  (16.49)

                                             where F [{x(t)} is the Fourier Transform of x(t).

                                             16.3.7 Power spectral density

                                             The power spectral density S( f ) of a signal x(t) specifies the power or the

                                             mean square value of that signal per unit of bandwidth [Hz]. For electrical
                                             signals, S( f ) will have the dimension of W/Hz. The mean square value of
                                             a time-limited recording of a signal x(t), of which the frequency contents is
                                             limited between f1 and f2, and with a recording time T over which x(t) can
                                             be considered to be stationary, can be obtained both from the time-domain

                                             and the frequency-domain descriptions:

                                             {x(t)}2 = 1 T{x(t)}2dt = S f2 ( f )d f                   (16.50)
                                             T0                             f1

                                             16.4 Signals, data and information

                                             In this section, we will summarize description methods for the amount of
                                             data and information, present in signals.

                                             16.4.1 Amount of data

                                             The amount of data D that is received on the retrieval on a value between a
                                             and b of a random variable x at time instant t is defined as

                                             D = - log2 {Prob(a  x  b, t)} [bit].                     (16.51)

Figure 16.4: Example of a uniform distribu-     The probability of the occurrence of a signal value between a and b can
tion function.                               be calculated from the probability density function P(x, t) of the random
                                                          16.4. SIGNALS, DATA AND INFORMATION 519

variable x at time instant t:

                                                       b  (16.52)

              Prob(a  x  b, t) = P(x, t)dx [-].

                                                     a

Since the probability of obtaining a signal value is unity, we have, by defi-

nition:                        

                                   P(x, t)dx = 1 [-].     (16.53)

                               -

   An example of a uniform probability density function is shown in Figure
16.4. A uniform probability density function is characterized by its mean
value µ and its width w = xmax - xmin :

                  P(x, t) = 1 if |x - µ| < w ,            (16.54)
                                 w                     2  (16.55)
                  P(x, t) = 0 if |x - µ|  w .
                                               2

   The mean value or the expectation of a random variable is defined in sec-
tion 16.3.2.

   Figure 16.5 shows two examples of a Gaussian probability density func-
tion. A Gaussian probability density function is characterized by its mean
value µ and its standard deviation  :

                              1               (x - µ)2    (16.56)
              P(x, t) =             exp - 2 .
                                2              2

16.4.2 Bandwidth and minimum sample rate

The power spectral density of a signal, is a measure for the frequency contents   Figure 16.5: Examples of Gaussian distribu-
                                                                                  tion functions.
of a signal. It is defined in section 16.3.7. The bandwidth B of a signal is the  3 H. Nyquist. Certain topics in telegraph

width of the frequency range in which signal components can be found. The         transmission theory. Trans. Am. Inst. Elec.
minimum required sample rate S, also the Nyquist[Nyquist1928-2]3 rate, is
                                                                                  Eng., 47:617-644, 1928
two times the bandwidth of the signal:

                                 S  2B [1/s].             (16.57)

16.4.3 Crest factor

The crest factor C is defined as the ratio of the maximum absolute value and

the RMS value of a signal:

                                 C = |x|max .             (16.58)
                                        xRMS

16.4.4 Data rate

The data rate is the amount of data contained in a signal over a time span of

one second:       R = 2B log2 xpp n [bit/s], RMS

                                                          (16.59)

where nRMS is the RMS value of the noise associated with the signal over the
bandwidth of B [Hz].

   In the following example, we will evaluate the data rate of an analog signal

perturbed by noise.

Example 16.1

   Consider and analog signal perturbed by noise. The signal is contained in a
frequency band with a bandwidth B = 100kHz. The RMS value of the signal xpp
520 SIGNAL MODELING (SELECTED TOPICS)

                                            in this frequency band equals 2V. Random noise in the same frequency band is
                                            added to the signal. The RMS value nRMS of this noise is 0.3mV. The data rate R
                                            of this signal is found as

                                              R = 2B log2 xpp n = 2 × 105 log RMS 2 0.3 × 10-3 2 = 2.54 × 106bit/s. (16.60)

                                               In the next example, we will evaluate the data rate of a stereo digital audio
                                            signal.

                                               Example 16.2

                                                   The signal comprises the audio data of two channels. The update rate is 44ksps
                                               and the number of bits per sample is 16. The data rate R equals:

                                            R = 2 × 16 × 44 × 103 = 1.41 × 106bit/s.            (16.61)

                                            16.4.5 Information rate

                                            The information rate I [bits/s] is often much less than the data rate. Nowa-
                                            days, when using high quality audio compression techniques, the data rate
                                            of a stereo audio signal of 1.41Mbit/s can be reduced to 256kbit/s without
                                            noticeable errors. The data rate for speech can be much less. In general, the
                                            data rate can be reduced if:

                                            1. Not all data is relevant

                                            2. Data is redundant

                                            16.4.6 Relevant signal properties

                                            From the above, it seems important to know which signal properties (data)
                                            should be preserved for retrieval of the information. A few examples of
                                            signals with specific signal properties are:

                                            · FM and PM signals:

                                               - Information is embedded in the momentary frequency or in the mo-
                                                   mentary phase of the signal

                                            · Analog composite video signal:

                                               - Intensity information is embedded in the signal level
                                               - Color information is embedded in the phase of a carrier with respect to

                                                   reference burst during the black level.

4 Claude E. Shannon and Warren Weaver.      16.4.7 Channel capacity
The Mathematical Theory of Communication.
The University of Illinois Press, Ubana, 1  According to Shannon,[ShannonWeaver1963]4 the maximum amount of in-
edition, 1963. ISBN: 0-88179-205-5          formation that can be transported per second with an arbitrarily low number
                                            of errors over a linear channel with:

                                            · Channel bandwidth B

                                            · Added white Gaussian noise with power N

                                            · Maximum signal power level S.
                                               is limited by the so-called channel capacity C:

                                                                   C = B log2 1 + SN [bit/s].   (16.62)
                                                                                   16.4. SIGNALS, DATA AND INFORMATION 521

   This expression clearly shows the three fundamental physical limitations
to the amount of information that can be processed and that have been intro-
duces above:

· Noise limitation: any physical system adds noise
· Power limitation: the power of any physical signal is limited
· Speed limitation: the rate of change of any physical signal is limited

16.4.8 Spectral efficiency

The spectral efficiency E is a measure for the information rate I per unit of
bandwidth. It is defined as

E = I [(bit/s)/Hz].         (16.63)
      B
                                                              523

17 System Modeling (selected topics)

17.1 Introduction                                        524

17.2 Classification of systems                           524

17.3 Linear stationary instantaneous systems             525

17.4 Linear stationary dynamic systems                   525

17.4.1 Time domain analysis                              526

17.4.2 Frequency domain analysis                         526

17.4.3 Complex frequency domain analysis                 527

17.4.4 Time domain analysis using the Laplace transform  529

17.5 Fixed instantaneous nonlinear systems               530

17.5.1 Operating point, input and output offset          530

17.5.2 Small-signal gain and inaccuracy                  531

17.5.3 Nonlinearity                                      531

17.5.4 Differential gain                                 531

17.5.5 Harmonic distortion                               531

17.5.6 Intermodulation distortion                        532

17.6 Linear time-variant instantaneous systems           533

17.7 Modeling of nonlinear dynamic systems               533
524 SYSTEM MODELING (SELECTED TOPICS)

1 Stationary is also called static, fixed or  17.1 Introduction
time-invariant.
                                              The aim of system modeling is to provide description methods for the eval-
                                              uation of the performance of a system. These description methods should be
                                              as simple as possible, but adequate and sufficiently accurate for the investi-
                                              gation of a performance aspect of interest. Hence, different models may be
                                              used for the evaluation of different performance aspects.

                                                 Most real world systems can be considered to be time-variant, nonlinear
                                              dynamic and distributed, and such behavior can only be analyzed with com-
                                              plex models and computer-based numerical analysis. Because of their com-
                                              plexity, such models do not provide much design information. In fact, nu-
                                              merical analysis can only be performed on systems that have already been
                                              designed. Symbolic analysis techniques, however, can help us find design
                                              parameters that determine specific behavioral aspects of the system.

                                                 Most symbolic analysis techniques have a limited scope, and proper anal-
                                              ysis techniques have to be selected for the investigation of specific perfor-
                                              mance aspects. Analysis of the influence of the dynamic behavior of a system
                                              requires a modeling technique other than the analysis of its nonlinear behav-
                                              ior. For this reason, we will start this overview of system modeling with a
                                              classification of systems and assign appropriate modeling techniques to each
                                              class of systems. This will be done in section 17.2. In the sections following
                                              this classification, we will give a short summary of the most commonly used
                                              modeling and analysis techniques. We will discuss the modeling of lumped
                                              continuous-time analog systems only.

                                                 Many idealized systems, e.g. ideal amplifiers, are considered linear, in-
                                              stantaneous and stationary for signals of interest.1 Their ideal behavior will
                                              be described in section 17.3. We also need techniques for modeling their
                                              non-ideal behavior: their nonlinear behavior, their dynamic behavior and
                                              time-variant behavior. Modeling of dynamic stationary linear systems is dis-
                                              cussed in section 17.4. Modeling of nonlinear stationary and instantaneous
                                              systems will be discussed in section 17.5, and modeling of time-variant lin-
                                              ear instantaneous systems in section 17.6. Some notes will be made on the
                                              modeling of combinations of non-idealities, that occur in nonlinear dynamic
                                              systems. This will be done in section 17.7.

                                              17.2 Classification of systems

                                              Continuous time and discrete-time systems

                                              In a continuous time system, the inputs and the outputs are capable of chang-
                                              ing at any time instant. Otherwise, the input and output signal values are
                                              of interest at any time instant. In discrete time systems or sampled systems,
                                              the signal values are of interest at discrete time instants only. Between these
                                              instants, the signals need not be defined.

                                              Analog and digital systems

                                              In an analog system, both the input and output signals are capable of having
                                              any value in a limited interval. Otherwise any signal value in a limited inter-
                                              val is of interest. In quantized systems, or digital systems, only a countable
                                              number of signal values is used.

                                              Linear and nonlinear systems

                                              In a strictly mathematical way, a system is linear, if and only if both properties
                                              of homogeneity and additivity hold. Mathematically, this can be written as

                                              H{x1(t) + x2(t)} = H{x1(t)} + H{x2(t)},  (17.1)
                                                                 17.3. LINEAR STATIONARY INSTANTANEOUS SYSTEMS 525

where H is the system operator,  and  are two scalars, and x1(t) and x2(t)
are two excitations.

Instantaneous and dynamic systems

A system is called instantaneous if its responses, at any instant, only depend
on the excitations at the same instant (not on past and future values). A sys-
tem is called dynamic if a response at any time instant not only depends on
the present input, but also on at least one of the past values of an excitation.
A dynamic system is said to have a memory of length T if the output at time
t is completely determined by the input values in the interval (t - T, t).

Fixed and time-variant systems

A system is called fixed, time-invariant or stationary, if the system response
does not depend on the time of the application of the excitation, when the
system is assumed to be at rest prior to the application of the excitation. This
implies that H is not a function of time. This can be expressed as

if Y(t) = H{X(t)}, then Y(t - ) = H{X(t - )}, for all .  (17.2)

   Otherwise, a system is stationary if the system properties do not change
with time.

Stable and unstable systems

A system is said to be stable if and only if any bounded input signal, results
in a bounded output signal. A bounded time function x(t) is one that never
becomes infinite.

Causal systems

A causal system (physical or non-anticipatory system) is one whose responses
to any input does not depend on any future value of the excitations.

Lumped and distributed systems

A dynamic system is said to be lumped if its behavior is governed by a set
of ordinary differential (or difference) equations. Systems that require the
use of partial differential equations to describe their behavior are said to be
distributed. In this book, we will only deal with causal, analog, stationary,
continuous time, lumped systems.

17.3 Linear stationary instantaneous systems

The response y(t) of a linear stationary instantaneous system to an excitation
x(t) can be obtained through multiplication of x(t) by a scalar:

y(t) = g x(t),                                           (17.3)

where the scalar g is called the gain of the system.

17.4 Linear stationary dynamic systems

Linear, dynamic, time-invariant, lumped, continuous-time systems, can be
modeled with (a set of) ordinary linear differential equations with constant
526 SYSTEM MODELING (SELECTED TOPICS)

coefficients. If such a system has only one input and one output, the input-
output relation is given by a linear differential equation of the order n with
fixed coefficients. The general form of such a differential equation will be:

                                       i=n diy(t) k=m dkx(t)                     (17.4)

                                        ai i =  bk k ,
                                       i=0 dt  k=0 dt

where x(t) is the input signal or excitation, y(t) the output signal or response,
and ai and bk the time-independent (fixed) real coefficients. Due to the phys-
ical limitation of speed, we have n > m.

   The response of a linear dynamic system to an arbitrary input signal can
be found by solving the above differential equation. Direct solution of a dif-
ferential equation requires an exact time domain description of the excitation
x(t), as well as the definition of n initial conditions. Such descriptions are
not always available. However, since we are dealing with linear systems, the
response of the system to an arbitrary signal, may also be obtained as a linear
superposition of responses to elementary signals in which the arbitrary signal
can be resolved. To this end, signals are decomposed into series of unit im-
pulses (t), imaginary exponentials exp jt, or complex exponentials exp st,
where s =  + j. In this section, we will discuss modeling techniques, based
on such decompositions.

17.4.1 Time domain analysis

1. Solution with the aid of the unit impulse response h(t) = H{(t)}, or the
   unit step response a(t) = - t h()d.

   Since all time functions can be resolved into unit impulse or unit step
   functions, the response y(t) of a linear system to an arbitrary signal x(t)
   can be found as the sum of the responses to the unit impulse, or the unit
   step functions into which the signal is resolved. The operation for finding
   the time-domain response with the aid of resolution in unit impulses is
   called convolution:

                                                                              t  (17.5)
                                                                                 (17.6)
                                       y(t) = x(t)  h(t) = x()h(t - )d,

                                                                            0
                                                       t

                                       y(t) = x()a(t - )d = x(t)  a(t).

                                                     0

2. Analysis of the behavior using signals resolved in elementary exponen-
   tials.

   Since exponential functions retain their shape under the operation of dif-
   ferentiation and integration, differential equations can be transformed into
   algebraic equations if the excitation and response are written as expo-
   nential functions. The algebraic equation obtained in this way, can be
   solved analytically. For this reason, we often resolve signals in imaginary
   or complex exponentials, using the Fourier and Laplace transformation
   techniques, respectively. These techniques will be discussed below.

17.4.2 Frequency domain analysis

The resolution of an arbitrary time signal into imaginary exponentials is con-
venient both from the mathematical and practical point of view. Resolution of
signals into elementary imaginary exponentials, allows us to use frequency
domain descriptions for both information-carrying signals and test signals.
Linear amplifiers can be characterized with the aid of sinusoidal test signals,
and deviations from linear behavior can be observed as signal distortions at
the amplifier's load.
                                       17.4. LINEAR STATIONARY DYNAMIC SYSTEMS 527

   We will briefly demonstrate this technique for the differential equation
given in (17.4). To this end, we resolve x(t) and y(t) into elementary imagi-
nary exponentials. One element of the resolved excitation x(t) is then of the
form X(j) exp jt and the corresponding response is of the same shape and
can be written as Y(j) exp jt, in which X(j) and Y(j) are the complex

amplitudes of the imaginary exponentials exp jt at the input and the output,
respectively. The k - th derivative of an element of the resolved input signal
is obtained as (j)kX(j) exp jt and the i - th derivative of its correspond-
ing response as (j)iY(j) exp jt. All initial conditions are assumed to be

zero. Substituting these exponentials into the differential equation yields

i=n                k=m
 ai(j)iY(j) exp jt =  bk(j)kX(j) exp jt.
                                          (17.7)

i=0                k=0

   We now obtain the transfer function H(j) of the amplifier, which relates,
for a given frequency , the complex amplitude of the response Y(j) to that
of the excitation X(j):

     H(j) =  Y(j)     k=m    bk  (j)k

                   k=0
                   = i=n i .              (17.8)
             X(j) i=0 ai(j)

Transfer function

The transfer function H(j) of a linear fixed dynamic system is the Fourier
transform of the system's unit impulse response:

             H(j) = F {h(t)}.             (17.9)

   Information-carrying signals are often characterized by their power spec-
tral density S(), which is a statistical quantity defined as the average signal

power in [W/Hz] at a certain frequency, over a bandwidth of one Hz. If the
input signal x(t) of a system with a transfer function H(j), has a power
spectral density of Sx(), the power spectral density Sy() of the response
signal y(t) can be obtained as:

     Sy() = Sx() |H(j)|2 .                (17.10)

Bode plots

A graphical representation of the transfer function can be given by plotting
the magnitude |H(j)| and the argument arg{H(j)} of the transfer function
H(j) as a function of . These so-called Bode plots show the magnitude
20 log 10 |H(j)| in dB and the argument arg{H(j)} in degrees or radians,
both on a linear scale. The angular frequency  or the frequency f is usually
plotted on a logarithmic scale.

17.4.3 Complex frequency domain analysis

The system function H(s) is obtained in a similar way as the transfer function
H(j); it relates the complex amplitudes Y(s) of the complex exponentials of
the resolved output signal to those of the resolved input signal. H(s) is the
Laplace transform of the amplifier's unit impulse response:

             Y(s)  k=m b sk

                      k=0 k
     H(s) =        = i=n = L{h(t)}.       (17.11)
             X(s) i=0 aisi

   The Laplace transform is also defined for signals that have no power limi-
tation. These (theoretical) signals arise in linear(ized) unstable dynamic sys-
528 SYSTEM MODELING (SELECTED TOPICS)

                                          tems. We will show that the stability of linear(ized) dynamic systems can be
                                          investigated through evaluation of the system function.

                                             The numerator of the system function (see expression 17.11) is a polyno-
                                          mial of degree m. The m roots of the numerator are called the zeros of the
                                          system functions. The n roots of the denominator are called the poles of the
                                          system function. Any system function of a system that does not incorporate
                                          delay lines can be written in terms of these poles and zeros:

                                                                                 m
                                                                            bm k=1  (s - zk)
                                          H(s) = n                                                 ,               (17.12)
                                                                            an  (s - pi)
                                                                                 i=1

                                          where zk is a zero of H(s) and pi is a pole of H(s).
                                             If there are no poles or zeros at s = 0, this may also be written as

                                                                                 m    (1  -  s  )
                                                                                             z
                                          H(s) = n b0 k=1 . k
                                                                            a0                                     (17.13)

                                                                                  (1 - pi )  s

                                                                                 i=1

                                             The system function is completely described by means of its poles and
                                          zeros and the coefficients a0 and b0 or an and bm. The factor ba00 is the zero
                                          frequency transfer or the DC transfer of the system.

           = zero                         Pole-zero pattern
           = pole
                                          The graphical representation of the poles and zeros in the complex plane is
Figure 17.1: Example of a pole-zero pat-  referred to as the pole-zero pattern of H(s). A typical pole-zero pattern of a
tern.                                     system function is depicted in Figure 17.1.

Figure 17.2: Relation between pole-zero      Poles and zeros always appear as single real or pairs of complex conju-
pattern and Bode plots.                   gates; this is because the coefficients of the differential equations are real.

                                             Not all system functions can be represented by a pole-zero pattern. A
                                          system with a time delay  has a system function like: H(s) = exp (-s) ,
                                          which cannot be expressed in terms of poles and zeros.

                                          Pole-zero pattern and Bode plots

                                          The relation between the Bode plots and the pole-.zero pattern can be found
                                          by substituting s = j in the expression for the system function H(s). The
                                          magnitude of the transfer function |H(j)| can then be evaluated from

                                                                  k=m                                              (17.14)

                                          |H(j)| = bm k=0  |j - zk| .
                                                         an i=n
                                                              |j - pi|

                                                                   i=0

                                             The magnitude of the transfer function is thus proportional to the quotient

                                          of the product of the magnitudes of the terms of the numerator and the

                                          product of the magnitudes of the denominator. The magnitude of a single
                                          factor |j - zk| at an angular frequency 1 equals the distance between the
                                          location of the zero zk and the position j = j1 on the imaginary axis. The
                                          magnitude |j - pi| can be found in a similar way. This is shown in Figure
                                          17.2.

                                             The argument of the transfer function can be evaluated as:

                                          k=m                                                         i=n
                                          arg{H(j)} = arg bm - arg an +  arg(j - zk) -  arg(j - pi). (17.15)

                                                                            k=0                       i=0
                                                                            17.4. LINEAR STATIONARY DYNAMIC SYSTEMS 529

   The arguments of an and bm are either 0 or  rad, depending on their sign.
The argument of a single term (j - zk) at an angular frequency 1 is found
as the angle formed by the vector that connects the zero zk with the point
j = j1 on the imaginary axis and the positive real axis. This relation is
shown in Figure 17.2.

Minimum phase system

A system is called a minimum phase system if the inverse of H(s) is sta-
ble and causal. This implies that H(s) has no zeros in the right half plane.
The magnitude and the phase characteristic of a minimum phase system are
related by the Hilbert Transform:

arg {H (j)} = -HI {ln |H (j)|} ,                           (17.16)

in which the Hilbert transform operator HI is defined as:  (17.17)
                              HI {x (t)} = 1  x() d.
                                                 - t - 

In the frequency domain, this is equivalent to

HI {X (j)} = -j sgn  X (j) .                               (17.18)

   A minimum phase system has the smallest possible delay of all linear
time-invariant dynamic systems that have equal magnitude characteristics.

17.4.4 Time domain analysis using the Laplace trans-
           form

Time domain analysis, using signals resolved in elementary exponentials, is
performed with the aid of the Laplace transform. The procedure for the
determination of the time domain response to a known time function can be
presented as

       y(t) = L-1{Y(s)} = L-1{H(s)X(s)} = L-1[H(s)L{x(t)}]. (17.19)

   For determination of the Laplace transform of a time function, we use
tables of the Laplace pairs and the properties of the Laplace transform.

Stability

The system's unit impulse response h(t) can be found from the inverse Laplace
transform of its system function H(s). The unit impulse response of a system
with more poles than zeros can be written as a sum of exponentials with pkt
as its argument, in which pk is a pole of the system function. A general ex-
pression for the impulse response of a system with more poles than zeros is:

                                   n -1                    (17.20)

                      h(t) =   Ai,jtj exp pit

                                 i=1 j=0

in which  is the number of occurrences for the pole pi. The coefficients
Ai,j depend on the poles and the zeros. Expression 17.20 clearly shows that
the impulse response is bounded if all poles of the system function have a

negative real part. As a consequence, if all poles have a negative real part,

the response to any bounded signal is bounded and the system is stable.

Definition: A system is said to be stable, if the poles of its system function H(s)
are all located in the left half of the complex s-plane.
530 SYSTEM MODELING (SELECTED TOPICS)

                                             Total error at:  17.5 Fixed instantaneous nonlinear systems

Figure 17.3: Blue: ideal static instantaneous                 In this section, we will introduce the basic concepts for characterization of
linear input-output relation                                  nonlinear time-invariant instantaneous systems. Information processing sys-
                                                              tems are often intended to behave linearly. Deviations from this linear be-
  Red: realized static instantaneous nonlin-                  havior will be modeled in this section. There are many different description
ear input output relation.                                    methods for nonlinear behavior. Harmonic distortion , intermodulation ,
                                                              differential-gain , and gain compression are terms that are often used to ex-
                                                              press the perception of nonlinear effects. In general, description methods
                                                              that show the best correspondence to the observer's error perception must
                                                              be used. This perception strongly depends on the way in which the informa-
                                                              tion is embedded in the signal and how this information is interpreted by the
                                                              observer.

                                                                 A single-input single-output nonlinear instantaneous fixed system can be
                                                              characterized by a curve in its so-called input-output plane. Figure 17.3
                                                              shows an example of a static nonlinear instantaneous input-output relation,
                                                              with x and y representing the input and the output signal values, respectively.
                                                              One could measure such a curve through application of an input signal that
                                                              varies with time and plot the output signal values as a function of the input
                                                              signal values. Figure 17.3 also shows the intended ideal input-output relation
                                                              of this system.

                                                                 The total error shown in the figure is the difference between the intended
                                                              system output and the actual output. It depends on the value of the input
                                                              signal.

                                                                 This total error can be decomposed in a number of contributions. These
                                                              contributions are defined in the following sections.

Figure 17.4: Definition of the desired                        17.5.1 Operating point, input and output offset
operating point for linearization.
                                                              The static nonlinear curve from Figure 17.3 can mathematically be described
Figure 17.5: Modified source-load relation.
                                                              as
Figure 17.6: Definition of small-signal gain
and inaccuracy.                                                           y = y(x).                            (17.21)

                                                                 In order to specify the deviations from the ideal behavior, we have to select
                                                              our intended origin, also called the quiescent operating point Q. This is shown
                                                              in Figure 17.4.

                                                                 The curve is shifted to this new origin through application of the so-called
                                                              input and output offset quantities xo f f and yo f f , respectively. For a voltage
                                                              amplifier, xo f f and yo f f are the voltages of a voltage source in series with
                                                              the signal source and a voltage source in series with the load, respectively.
                                                              The quescent operating point Q can be selected on various grounds. At this
                                                              stage, we will not discuss this in detail, but just introduce the concept of an
                                                              operating point.

                                                                 After application of xo f f and yo f f , the operating point Q is the origin of
                                                              the modified source-to-load relation that is written as:

                                                                          y~ = yQ(x~)                          (17.22)

                                                                 In which x~ and y~ are the deviations of the input and output quantities

                                                              from the operating point Q. This is illustrated in Figure 17.5.
                                                                 The new function y~ = yQ(x~) is free of offset. It can be approximated by a

                                                              Taylor series expansion as

                                                                                 n=                            (17.23)
                                                                                                               (17.24)
                                                                          y~ =  gnnx~n,

                                                                                 n=1

                                                              with        1 dn{yQ(x~)}

                                                                    gn =  n! dx~  n            .

                                                                                         x~=0
                                 17.5. FIXED INSTANTANEOUS NONLINEAR SYSTEMS 531

17.5.2 Small-signal gain and inaccuracy

For small signals, the system can be linearized by approximating the input-
output relation by a straight line through the (new) origin. This is shown in
Figure 17.6. The tangent of the angle between this line and the x-axis is the
small-signal gain of the system. It is found as g1 from expression 17.24:

y~ = g1x~, with g1 = d{yQ(x~)} .                    (17.25)
                                dx~ x~=0

   The inaccuracy  of the linearized system is defined as the difference be-     Figure 17.7: Definition of the nonlinearity

tween the actual gain g1 and the required gain of the system, while the rel-
ative inaccuracy rel equals the quotient of the inaccuracy and the desired
gain.

17.5.3 Nonlinearity

For large signal excursions, the approximation by a straight line is not accu-
rate. The nonlinearity  is defined as the difference between the actual out-
put signal and the output signal that would be obtained from the linearized
system. Figure 17.7 shows  as a function of the relative input excursion:

         = yQ(x~) - g1x~.                           (17.26)

   The relative nonlinearity rel equals the ratio of the nonlinearity and the
ideal output value gx1 :

        rel = yQ(x~) - g1x~ .                       (17.27)                      Figure 17.8: Definition of the differential
                       g1 x~                                                     gain.

17.5.4 Differential gain

Due to nonlinearity, the gain changes with the operating point. At an arbi-

trary operating point, for example, at x~ = x1, the differential gain error  is
defined as the difference between the gain at x~ = x1 and the gain at x~ = 0,
divided by the gain at x~ = 0 :

(x~) =  dx~ x~=x d{yQ(x~)} - dx~ d{yQ(x~)}  x~=0 .  (17.28)

                                  1                                              Figure 17.9: Differential gain as a function
                                                                                 of the source signal deviation from the
                     d{yQ (x~ )}                                                 operating point.
                          dx~ x~=0
                                                                                 Figure 17.10: Determination of + and
17.5.5 Harmonic distortion                                                       - for harmonic and intermodulation
                                                                                 distortion.
We have seen that in linear fixed dynamic systems, sinusoidal signals retain
their shape. The nonlinearity of a system is therefore often characterized
by the amount of distortion of the response to a sinusoidal input signal.
The response of a fixed nonlinear instantaneous system to a sinusoidal input
signal is a periodic signal whose period equals the period of the sine wave.
The nonlinearity of the system generally introduces a change in the output
offset and in the harmonic contents. The total harmonic distortion THD is
defined as the relative RMS-value of all the harmonics in the output signal
that have a frequency larger than the fundamental frequency:

        THD = 1           n=                        (17.29)
                   d1
                           d2n,

                          n=2

where dn equals the amplitude of the n-th harmonic in the output signal.
532 SYSTEM MODELING (SELECTED TOPICS)

For weak nonlinear, instantaneous systems, the THD is related to the dif-

ferential gain. To illustrate this, we consider a nonlinear system with an

input-output relation as given by expression 17.23, and apply an input signal

x~(t) given by

                                                x~(t) = X cos t.            (17.30)

The output signal y~(t) is then obtained as

y~(t) = g1X cos t + g2X2 cos 2t + g3X3 cos 3t + ..... ,                     (17.31)

which can be approximated by

y~(t) = g1X cos t + g2 X2 cos 2t + g3 X3 cos 3t + ..... .                   (17.32)
                                             2      4

The relative amplitude d2 of the second harmonic is thus found as g2X/2g1.
The relative amplitude of the third harmonic d3 is found as g3X2/4g1.

   In order to find the relation between the THD and the differential gain , we

will write the differential gain as a function of g1.....gn. Since the differential
gain depends on the large signal excursion, we use approximations for the

differential gain at maximum and minimum signal excursion. The differen-
tial gain at the largest positive signal excursion (x~(t) = X) will be denoted as
+ and is obtained from the definition as

                                             + = 2g2X + 3g3X2 .             (17.33)
                                                             g1

   In a similar way, the differential gain at the largest negative signal excur-
sion (x(t) = -X), denoted by -, is found to be

                                             - = -2g2X + 3g3X2 .            (17.34)
                                                              g1

   With the aid of 17.33 and 17.34, we are able to calculate the second and
order third harmonic distortion from the differential gain values. We obtain

                                       d2 =  + - -  , and d3 =    + + -  ,  (17.35)

                                                8                 24

in which + and - are the differential gain errors at x~max and x~min, respec-
tively. This is shown in Figure 17.10.

17.5.6 Intermodulation distortion

Let us consider a situation in which the excitation of a fixed nonlinear in-

stantaneous system consists of two sinusoidal components with different fre-

quencies 1 and 2, but equal amplitudes. Due to the nonlinearity of the
system the output signal will have components at multiples of 1 and 2
(known as harmonic distortion) and at frequencies m1 ± n2 (m and n are
integers). The latter effect is called intermodulation distortion. The ampli-

tudes of the components at these frequencies will be denoted as Am1±n2 .
The second order intermodulation distortion I M2 is defined as the relative
RMS-value of the component of the output signal with m = 1 and n = 1,

when the components at 1 and 2 have equal amplitudes:

                                                I M2 = |A1±2 | .            (17.36)
                                                            A1,2

   The third order intermodulation distortion I M3 is defined as the relative
RMS-value of the component with m = 2 and n = 1 or m = 1 and n = 2,
                                                     17.6. LINEAR TIME-VARIANT INSTANTANEOUS SYSTEMS 533

when both the components at 1 and 2 have equal amplitudes:

                 I M3 = A1±22 = A21±2 .                               (17.37)
                                       A1,2             A1,2

   For weak nonlinear, instantaneous systems, the second and third order
intermodulation distortion are related to the differential gain. In order to
find this relation, we apply

                               x(t) = X{cos 1t + cos 2t}              (17.38)

to the input of the system. The second order term from the Taylor approxi-
mation of the output signal is then obtained as

Y2            =  g2X2{ 1       +  1  cos(21t   )  + cos(1t  + 2t ) +  (17.39)
                                  2                                   (17.40)
                            2          +    1  +  1  cos(22t  )},
                 cos(1t        - 2t )       2     2

which yields                      I M g 2 = 2 X = + - - .

                                       g1            4

In a similar way, we find

                                  I M 3g 3 = 3 X2 = + + - ,           (17.41)
                                       4g1           8

where + and - are the differential gain errors at x~max and x~min, respectively.
This is shown in Figure 17.10.

17.6 Linear time-variant instantaneous systems

The behavior of a linear time-variant instantaneous system can be modeled
with the aid of a time variant gain g(t):

                                     y(t) = g(t)x(t).                 (17.42)

   Sometimes it can be convenient to model a system differently for different
components of the input signal. Suppose a system shows strong instanta-
neous nonlinear behavior (for example a limiter). The system's response for
the large sinusoidal signal can then be calculated from its nonlinear instanta-
neous behavior. The large sinusoidal signal causes periodic small-signal gain
variations. The system response to a small signal or to noise may then be
analyzed using a linear time-variant approach: the small signal and the noise
are then multiplied by a gain function that is a function of the shape of the
large signal and the nonlinearity of the system.

17.7 Modeling of nonlinear dynamic systems

Dynamic nonlinear systems can be modeled with the aid of nonlinear differ-
ential equations. The solution of these equations can almost always only be
found through numerical methods. In this section, we will give some param-
eters that describe dynamic nonlinear effects. Aside from these parameters,
the following parameters from the previous paragraph also apply to dynamic
nonlinear systems:

1. Differential gain

   In dynamic nonlinear systems, the differential gain depends on frequency.
   Since the small-signal gain in dynamic systems is complex, the differential
534 SYSTEM MODELING (SELECTED TOPICS)

   gain is also complex with both magnitude and phase (differential gain and
   differential phase).

2. THD
   In dynamic nonlinear systems, the harmonic distortion becomes a function
   of the frequency and the relations between the differential gain and the
   second and third order harmonic distortions are no longer valid.

3. Intermodulation
   In dynamic nonlinear systems, the intermodulation distortion becomes a
   function of the frequency and the relations between the differential gain
   and the second and third order intermodulation distortions are no longer
   valid.

4. Gain compression
   In dynamic nonlinear systems the 1dB compression point becomes a func-
   tion of the frequency and the relation between the IP3 and the 1dB com-
   pression point is no longer valid.

5. Slew rate
   The limitation of the maximum rate of change of the output signal is called
   the slew rate limitation. Let y(t) be the system response to an input signal.
   The positive slew rate SR+ is defined as

                                       SR+ = dy(t) ; where dy(t)  0.     (17.43)
                                       dt max  dt

The negative slew rate SR- is defined as

                                       SR- = - dy(t) ; where dy(t) < 0.  (17.44)
                                       dt max  dt
                                                          535

18 Network Theory (selected topics)

18.1 Introduction                                    536

18.2 Nodal Analysis                                  536

18.2.1 The procedure                                 537

18.2.2 General form of the admittance matrix         540

18.2.3 Voltage-controlled current sources            541

18.2.4 Network transformations                       542

18.3 Modified Nodal Analysis                         543

18.3.1 The procedure                                 543

18.3.2 DC and AC network solutions                   547

18.3.3 MNA stamps                                    547

18.4 Implementation of transfer functions            552

18.4.1 Numerator and denominator substitution        553

18.4.2 Network expansion method                      553

18.4.3 Matrix stamps of expanded transfer functions  555

18.5 Determination of poles and zeros                556

18.5.1 Solving the characteristic equation           557

18.5.2 Eigenvalues of the time-constant matrix       557

18.5.3 Symbolic estimation of poles and zeros        563

18.6 Two-ports                                       571

18.6.1 Two-port conditions                           572

18.6.2 Two-port representations                      574

18.6.3 Two-port properties                           575
536 NETWORK THEORY (SELECTED TOPICS)

1 Parametric pole-zero plots.                  18.1 Introduction

2 Charles A. Desour Leo O. Chua and            Designers of analog electronic circuits often need to investigate or modify the
Ernest S. Kuh. Linear and Nonlinear Circuits.  small-signal static or dynamic behavior of circuits. Numerical circuit analysis
McGraw-Hill, Inc., Singapore, 1987. ISBN:      is often performed with the aid of CAD programs. Although the obtained
0-07-010898-6                                  numeric results can be accurate, they do not provide design information. This
                                               is because the underlying mechanisms are not shown. Symbolic analysis of
                                               simplified circuits often does give a lot more design information, but it also
                                               often requires unpopular and cumbersome hand calculations.

                                                  Nowadays, many symbolic analysis tools are available to help designers
                                               with symbolic calculations. Adequate use of these programs requires proper
                                               formulation of the problem, which is often in the form of a matrix equa-
                                               tion. One software tool for symbolic and numeric analysis of linear circuits
                                               is SLiCAP. It provides symbolic expressions for the circuit's signal transfer.
                                               Aside from its symbolic analysis capabilities, it can perform parametric nu-
                                               meric analysis and generate frequency domain, time domain and complex
                                               frequency domain plots.1

                                                  The theory behind the operation of SLiCAP is summarized in this chapter.
                                               It starts with a summary of Nodal Analysis in section 18.2. Nodal Analysis
                                               (NA) can be used to solve network equations for networks with only voltage-
                                               controlled elements. Networks that also include elements whose behavior
                                               can only be described in a current-controlled form, such as voltage sources,
                                               can be transformed into networks with only voltage-controlled elements, by
                                               using the Norton transformation and Blakesley's voltage shift theorem. Al-
                                               ternatively, the so-called Modified Nodal Analysis (MNA) can be used. MNA
                                               is implemented in SLiCAP and in most SPICE-like simulators. It will be dis-
                                               cussed in section 18.3. An overview of MNA matrix stamps for commonly
                                               used network elements, as well as for Laplace transfer functions, will be given
                                               in section 18.3.3.

                                                  For more information on these topics, the reader is referred to Desoer
                                               Chua and Kuh [Chua1987]2.

                                                  Circuit designers often need to determine and/or manipulate the complex
                                               frequencies of poles and zeros. Techniques for numeric and symbolic de-
                                               termination of pole and zero frequencies will be presented in section 18.5.
                                               Symbolic approximation of pole and zero frequencies will be added to future
                                               versions of SLiCAP.

                                                  In many engineering cases, it is convenient to model an electrical network
                                               as a two-port. In those cases, the port quantities (voltage and current) of one
                                               port are related to those of the other port and the electrical behavior of the
                                               two-port is described with the aid of a 2 × 2 matrix. The conditions under
                                               which four-terminal networks can be modeled as two-ports, as well as two-
                                               port representation methods and properties, will be discussed in section 18.6.
                                               Understanding of these conditions is important for correct application of the
                                               asymptotic gain feedback model discussed in Chapter 10.

                                               18.2 Nodal Analysis

                                               An electric network consists of interconnected network elements. The con-
                                               nections are called nodes and the connecting elements between nodes form
                                               the branches of a network. The graph of a network shows the branches as
                                               lines and the nodes as dots. Below are a few definitions that we will use
                                               throughout this text:

                                               1. A connected graph is a graph that has at least one path among the branches
                                                  that connects all the nodes.

                                               2. A sub-graph is a subset of branches with their corresponding nodes.
                                                                                                        18.2. NODAL ANALYSIS 537

3. A closed path of branches is called a loop.

4. A collection of branches that isolates a sub-graph when removed is called
   a cut set.

5. A tree is a collection of branches that connects all the nodes but has no
   loops.

Figure 18.1 illustrates the definitions of loops, cut sets and of the tree.

1                                          1                               1                            Figure 18.1: Graph of a network, showing
                                                                                                        loops, cut sets and a tree.

                2                                      2                                 2

43                           43                                          43
             5                            5                                           5

                          7                            7                                             7
6                            6                                             6

red: loop across 1,2,3       red: cut set isolating sub network 1,2,3,4  blue: tree of the network
blue: loop across 1,4        blue: cut set isolating sub network 2,3

   N+                                                     NODAL ANALYSIS
   I
N-     Sign convention: Positive current   Two-terminal element relations  Sum of currents
                                           in voltage controlled form:
       flows through branche from node                                     flowing from node
       with positive voltage to node with                                  equals zero:

       negative voltage                                                    charge conservation

   Nodal analysis provides the network's nodal voltages from the indepen-                                                                  Kirchhoff's current law:
dent currents flowing into the nodes. It is based upon the application of                                                                  The sum of the currents
Kirchhoff's current law (see Figure 18.2), which states that the sum of the                                                                that flow into a node,
electric currents that flow into a node equals zero.                                                                                       equals zero:

   Networks with only voltage-controlled elements (I = f (V)) can directly                              Figure 18.2: Kirchhoff's current law.
be solved with the nodal analysis method. A network element is said to be
voltage-controlled if its branch currents are uniquely defined by its branch
voltages. This is not the case for current-controlled elements such as volt-
age sources. These elements have their voltage unambiguously defined by
their current (V = f (I)). As we will see later, networks with both voltage-
controlled and current-controlled elements can be solved using modified
nodal analysis (MNA).

   In the next section, we will demonstrate the nodal analysis method for a
simple network comprising voltage-controlled elements only.

18.2.1 The procedure

The procedure for nodal analysis is as follows:

1. Set up the circuit diagram, select a reference node and number all remain-
   ing nodes.

2. Set up the nodal equations for all nodes except the reference node.
   This results in the following matrix equation:

                                           I = Y · V,                                    (18.1)

where I is the vector of independent currents that flow into a node, Y
is the admittance matrix that depends both on the graph and the element
relations of the network elements, and V is the vector of the nodal voltages
with respect to the voltage at the reference node. A network having n
nodes requires n - 1 nodal equations. The voltage of the reference node is
usually assigned zero (ground potential).
538 NETWORK THEORY (SELECTED TOPICS)

                                               3. Find the network solution (all nodal voltages and branch currents).
                                                  The nodal voltages are found from

                                                                           V = Y-1 · I.                                (18.2)

                                               The branch currents I(j, k) (j = k) are found from                      (18.3)
                                                                                I(j, k) = Vj - Vk Yj,k.

                                               The transimpedance from a current Ik flowing into node k to a voltage Vj

                                               at node j is found as:

                                                                           Vj I = Y k j,k -1,                          (18.4)

                                               in which Yj,k -1 is the coefficient j, k of the inverse of the admittance matrix
                                               Y-1. It can be obtained as

                                                                           Y-1 = Ck,j ,                                (18.5)
                                                                                 j,k det(Y)

                                               in which the cofactor Ck,j is a coefficient of the cofactor matrix C of Y. It is

                                               defined as the determinant of the minor matrix Yj,k, multiplied by (-1)j+k.
                                               The minor matrix Yj,k is the matrix Y with the j - th row and the k - th
                                               column left out. Hence, Ck,j is defined as

                                                                       Ckj = (-1)j+k det(Yj,k).                        (18.6)

        (p)    (m)

                                   +           4. If an independent current source is supplying a current Is into node p and
                                                  drawing a current from node q, the transfer Zt from that current source to
             Network                              the voltage between node m and node n is found as

               -

        (q)    (n)

A                                              Zt = Vm - Vn = Cp,m - Cq,m - Cp,n + Cq,n .                              (18.7)

                                                                       Is  det(Y)

        (p)    (m)

                                   +           This is illustrated in Figure 18.3. Figure 18.3A shows the circuit with Is
                                               flowing from node p to node q. This branch current can be redirected via
             Network
                                               the ground node as shown on Figure 18.3B. We now have contributions to
               -                               the differential voltage Vm - Vn. Each transfer is modeled by one term in
                                               (18.7):
        (q)    (n)

  B                                            (a) The transfer from Is flowing into node p, to the nodal voltage Vm
                                               (b) The transfer from Is flowing into node p, to the nodal voltage Vn
Figure 18.3: Current to voltage transfer in a  (c) The transfer from Is flowing from node q, to the nodal voltage Vm
network.                                       (d) The transfer from Is flowing from node q, to the nodal voltage Vn.

                                               5. The poles of the system described by Y, are obtained by solving the char-

   (0)                                         acteristic equation:

I1                        +                                                poles : det Y(s) = 0.                       (18.8)

        C1 R1  R2                              Example 18.1

                        -                         In this example, we will derive expressions for the transfer of the current source
                      (2)                      I1 to the voltage V of the circuit drawn in Figure 18.4. Please notice that the
                                               device identifiers (also called REFDES: reference designators) have been typeset
               C2                              with a fixed width font and the device values with a math font: (R1, Ra).

   (1)                                            The node at the top of the current source I1 has been selected as the reference
                                               node. The value of I1 is Is and the load voltage V is the voltage between node (0)
Figure 18.4: Circuit for demonstration of      and node (2), which equals -V2.
the nodal analysis method.
                                                                                  18.2. NODAL ANALYSIS 539

The nodal equations for nodes (1) and (2) are:

          node 1:  0 = Is + V1sCa + V1 1R + (V a 1 - V2) sCb;          (18.9)
          node 2:  0 = V2 1R + (V b 2 - V1) sCb.                      (18.10)

These equations can be written using matrix notation as:

       -Is = s (Ca + Cb) + R1a  -sCb                        V1 V2 ,   (18.11)

                                         1
       0           -sCb         sCb + Rb

or, alternatively

                   -Is 0 T = Y· V1 V2 T ,                             (18.12)

where         Y = s (Ca + Cb) + R1a -sCb1 .

                   -sCb                           sCb + Rb            (18.13)

   The current-to-voltage transfer can be obtained with the aid of (18.7) using   3 Row 0 and column 0 do not exist, because
p = 0, q = 1, m = 0 and n = 2, which yields3                                      node (0) is selected as the reference node.

                   Zt = C1,2 ,                                        (18.14)
                          det(Y)

where

                   C1,2 = (-1)3 det (-sCb) ,                          (18.15)
                   C1,2 = sCb,                                        (18.16)

and

       det(Y) = det s (Ca + Cb) + R1a -sCb1 ,                         (18.17)
                   -sCb         sCb + Rb                              (18.18)

          = 1 + s ((Ca + Cb) Ra + CbRb) + s2CaCbRaRb .
                                      Ra Rb

After substitution of (18.16) and (18.18) in (18.14), we obtain

          Zt = 1 + s ((Ca + Cb) Ra + CbRb) + s2 sCbRaRb C . aCbRaRb   (18.19)

   The transfer Zt has one zero at s = 0 (no DC transfer) and two poles that are
the solutions for s of (18.18).

   In the following example, we will demonstrate the use of SLiCAP for
setting-up the matrix equations for the circuit from Figure 18.4 and for eval-
uation of the transfer.

Example 18.2

The SLiCAP netlist for the circuit from Figure 18.4 is listed below:

 1 "NA-2"

 2 * file: NA-2.cir
 3 * SLiCAP netlist for nodal analysis
 4 I1 1 0 {I_s}
 5 C1 0 1 {C_a}
 6 R1 0 1 {R_a}
 7 R2 0 2 {R_b}
 8 C2 2 1 {C_b}
 9 .param R_a=100k R_b=1k C_a=100p C_b=10n I_s=1

10 .end
540 NETWORK THEORY (SELECTED TOPICS)

                                                          The SLiCAP script that displays the matrix equation on a html page is:

                                                                1 #!/usr/bin/env python3
                                                                2 # -*- coding: utf-8 -*-
                                                                3 # File: NA-2.py
                                                                4
                                                                5 from SLiCAP import *
                                                                6 prj = initProject('NA-2')
                                                                7 instr = instruction()
                                                                8 instr.setCircuit('NA-2.cir')
                                                                9 instr.setSimType('symbolic')
                                                               10 instr.setGainType('vi')
                                                               11 instr.setDataType('matrix')
                                                               12 result = instr.execute()
                                                               13 htmlPage("Example Nodal Analysis")
                                                               14 head2html('MNA equation')
                                                               15 matrices2html(result)

                                                          The current-to-voltage transfer from expression (18.19) can also be found with
                                                      SLiCAP. To this end, we need to define the source and the detector, set the gain
                                                      type to GAIN and set the required data type to LAPLACE. The lines 21 through 33
                                                      of the script show the way to do this:

                                                               16 instr.setSource('I1')
                                                               17 instr.setDetector(['V_0', 'V_2'])
                                                               18 instr.setGainType('gain')
                                                               19 instr.setDataType('laplace')
                                                               20 result = instr.execute()
                                                               21 head2html('Transimpedance')
                                                               22 eqn2html('Z_t', result.laplace)

                                                          The html page generated by this script is shown in Figure 18.5. The matrix
                                                      equations match those of (18.11) and the expression for the gain equals (18.19).

Figure 18.5: SLiCAP simulation results.

18.2.2 General form of the admittance matrix

The general form of the nodal equation (Kirchhoff's current law) for node k
is:

 ik = -  Yk,1v1 -  Yk,2v2 ... +  Yk,kvk ... -  Yk,n-1vn-1, (18.20)

where:

 Yk,j = sum of the admittances connected between node k and node j;

 Yk,k = sum of the admittances connected to node k;         (18.21)

 ik = sum of the independent currents flowing into node k.

In other words: a diagonal element Yk,k of the admittance matrix Y equals
                                                                                         18.2. NODAL ANALYSIS 541

the sum of the admittances of each network element connected to node k. So,
the first diagonal element is the sum of admittances connected to node 1, the
second diagonal element is the sum of admittances connected to node 2, and
so on.

   The off-diagonal elements Yk,j equal the sum of the negative admittances
of the network elements connected between node k and node j. Hence, an
admittance between nodes 1 and 2 appears in the admittance matrix Y at
locations (1, 1) and (2, 2) with a positive sign and at locations (1, 2) and (2, 1)
with a negative sign. This is shown in Figure 18.6.

   A network with passive elements alone, has a symmetrical admittance
matrix Yj,k = Yk,j.

18.2.3 Voltage-controlled current sources                                                Figure 18.6: A passive admittance and its
                                                                                         contributions to the admittance matrix for
Voltage-controlled current sources can easily be handled in nodal analysis.              a network having n nodes including the
A voltage-controlled current source Gx, with its current flowing from node               reference node.
into node m and which is controlled by the voltage between node p (positive)
and node q (negative) and a gain of g [A/V], adds, in the -th row, +g to                                         +
column p and -g to column q, and in the m-th row -g to column p and +g                                        -
to column q. This is illustrated in Figure 18.7.
                                                                                         Figure 18.7: Voltage-controlled current
   Example 18.3                                                                          source and the coefficients in the Y matrix
                                                                                         for a network having n nodes, including
       In this example, we will determine the poles and the zeros of the transimpedance  the reference node.
   of a current-driven and RC-loaded CE-stage. Figure 18.8 shows the small-signal
   equivalent circuit of a current-driven and RC-loaded CE-stage. The emitter ter-       Figure 18.8: Circuit for the determina-
   minal is taken as the reference node.                                                 tion of the input impedance, the tran-
                                                                                         simpedance and the current gain of the
       Nodal analysis yields the following matrix equation                               current-driven RC-loaded intrinsic CE-
                                                                                         stage
                              Is0 = Y· Vi V ,                            (18.22)

in which

          Y = s C + Cµ + r1 -sCµ 1 ,                                     (18.23)
                       gm - sCµ             R + s Cµ + C
                                            

          Rro
and R = R+ro .

                              +                                       +

                              -                                       -

The transimpedance of this stage is defined as

Zt = V = Y-1                                                                (18.24)
Is             2,1                                                       + r C + Cµ

=2                                      -Rr gm - sCµ                                     + 1.
   s r R CCµ + CµC + CC
                                        +s  r  gm  R Cµ  +  R   Cµ + C

                                                              

The zeros are the solutions for s from

                              gm - sCµ = 0.                              (18.25)

The poles of this circuit are the solutions for s from

    s2r R CCµ + CµC + CC +                                               (18.26)
                                                                         (18.27)
      +s  r  gm  R Cµ  +  R   Cµ + C        + r  C + Cµ         + 1.

                            
542 NETWORK THEORY (SELECTED TOPICS)

     +

     -                                         18.2.4 Network transformations

(A)              (B)                           Nodal Analysis can be applied to analyze networks comprising only elements
                                               of which their branch currents can be written as a function of their branch
Figure 18.9: Norton equivalent circuit         voltages. This is not the case for, e.g., voltage sources; their current is not
  A) Voltage source in series with an          defined by their voltage. With the aid of network transformations, we can
                                               replace voltage sources with current sources and find the network solution
impedance                                      with Nodal Analysis.
  B) Current source representation using
                                                  Any voltage source in series with an impedance can be replaced with a
Norton equivalent circuit.                     current source in parallel with that impedance (Norton equivalent circuit),
                                               thereby reducing the number of nodes by one. This is shown in Figure 18.9.
                           -           +
                                                  If a voltage source is connected to a multiple of branches, it must be
                                    -  +       "shifted through the node" before it can be replaced with a current source.
+                                              This shifting is known as the Blakesley Voltage Shift; it is shown in Figure
                                               18.10.
-
                                                  In the following example, we will evaluate the transfer of a negative feed-
     (A)              (B)                      back voltage follower with an operational amplifier and use the above trans-
                                               formation techniques.
Figure 18.10: Norton equivalent circuit
  A) A voltage source connected to a              Example 18.4

number of branches                                    Evaluation of the small-signal voltage transfer of a voltage follower realized
  B) Equivalent representation using the          with an operational amplifier.

Blakesly Voltage Shift Theorem.

Figure 18.11: Voltage follower and its                    +
small-signal model
                                                          -
    (A) Voltage follower with operational
amplifier and power supplies                   ++                      +          ++         +

    (B) Simplified small-signal model of (A).

                                                       -     +         -          --         -

          +                                    -             -

             -                                            +
     +
     -           ++                                       -
                 --
              +                                (A)                     (B)

          -                                       In this example, we use a simple operational amplifier model as shown in Figure
                                               18.12. This model includes the DC voltage gain Adm, the DC output resistance
(A)              (B)                           Ro and a first order low-pass cut-off. The complete circuit of the voltage follower
                                               with the operational amplifier and its small-signal equivalent circuit are shown in
Figure 18.12: Simple OpAmp model               Figure 18.11.
  A) Operational Amplifier with power
                                                  With the aid of Norton equivalent representation, the small-signal model from
supplies                                       Figure 18.11B can be further simplified to that of Figure 18.13.
  B) Simplified small-signal model of (A).
                                                  This circuit now has three nodes and its 2 × 2 admittance matrix can easily be
                                               found using Nodal Analysis:

                                                                Vs          V
                                                                Rs = Y· i ,
                                                                 0          V                (18.28)
                                                                                             (18.29)
                                               where:        1

                                                       Y=    Rs                0          .

                                                             Adm    1             Adm
                                                             - Ro(1+s) Ro + sC + Ro(1+s)
                                                           18.3. MODIFIED NODAL ANALYSIS 543

                                                                                                                      Figure 18.13: Norton equivalent circuit for
+ + + the small-signal model from Figure 18.11B.

-  -                                                    -

The source-to-load transfer can be obtained as:

   V = C1,2 1                                              (18.30)
   Vs det(Y) Rs                                            (18.31)

       = s + Adm + sRoC + s2 Adm R . oC + 1                (18.32)

Alternatively, this can be written as

   Vs V = 1 + Adm 1 + s +RoC + s2 RoC Adm 1 .
                                       1+Adm     1+Adm

18.3 Modified Nodal Analysis

The nodal analysis technique can only be applied for networks with ele-
ments of which the v - i relation can be described in voltage-controlled nota-
tion: i = f (v). We have seen that network transformation methods, such
as, Blakesley's voltage shift and Thévenin-Norton conversion, can be ap-
plied to convert current-controlled elements like voltage sources into voltage-
controlled equivalents. In this section, we will introduce the Modified Nodal
Analysis method. This technique allows both voltage-controlled and current-
controlled notations for network elements.

18.3.1 The procedure

Like Nodal Analysis, Modified Nodal Analysis is based upon the application
of Kirchhoff's current law (KCL). Current-controlled elements are included
by adding the unknown currents through these elements to the vector with
nodal voltages. Additional equations are found from the relations between
the nodal voltages to which these elements are connected. In this way the
voltages of independent voltage sources are added to the vector with nodal
currents. The procedure is as follows:

1. Set up the circuit diagram, select a reference node and number all remain-
   ing nodes as in Nodal Analysis.

2. Define the m unknown currents through the m branches with current-
   controlled notation.

3. Set-up the n - 1 nodal equations for a network having n nodes

4. Relate the m branch voltages of the elements with current-controlled no-
   tation to the nodal voltages, in this way we obtain a square matrix with
544 NETWORK THEORY (SELECTED TOPICS)

n - 1 + m rows and columns, and a matrix equation of the form

                                                                                                   I = M· Vn ,                                                                                             (18.33)
                                                                                                   V      Iv

in which:

                                                                                       I = vector with independent current and voltage sources;
                                                                                       V

                                                                                       Vn = vector with n - 1 unknown nodal voltages and m unknown
                                                                                       Iv

                                                                                       currents through the m current-controlled branches;

                                                                                       M=  YC      = matrix that consists of 4 sub matrices:
                                                                                           BD

                                                                                       Y = (n - 1) × (n - 1) admittance matrix as with NA;
                                                                                       B = m × (n - 1) incidence matrix with topology information

                                                                                         of the current-controlled branches;
                                                                                       C = (n - 1) × m incidence matrix with topology information,

                                                                                          = BT for networks that have only independent voltage sources;
                                                                                       D = m × m matrix containing zeros only for independent sources.

Figure 18.14: Contributions of an indepen-                                                 Independent
dent voltage source to the MNA matrix                                                         Current Vector
and the vectors for a network having n                                                                                                                                                  Nodal
nodes, including the reference node. All not shown positions outside the admittance +                                                                                                      Voltage Vector
matrix have zeros. -                                                                                  Admittance Matrix
                                                                                                      From Nodal Analysis

5. The B matrix is an m × (n - 1) incidence matrix with only 0, 1 and -1

elements. Each location in the matrix corresponds to a branch (row) or

node (column). If the positive terminal of the i - th voltage source is

connected to node , then Bi. = 1. If the negative terminal of the i - th

voltage source is connected to node m, then Bi,m = -1. If the network

has only independent voltage sources, all other elements of the B matrix

are zero and the C matrix is the transposed version of the B matrix. This

is illustrated in Figure 18.14. The network equation added by the voltage

source is:

                                                                                                      V = V - Vm                                                                                           (18.34)

Since +Iv flows from node , it is added to the  - th nodal equation.
Similarly, -1 is added to the m - th equation.

6. Find the network solution (all nodal voltage and all branch currents). All
   the nodal voltages and unknown branch currents are obtained from

                                                                                               Vn = Y C -1 I .                                                                                             (18.35)
                                                                                               Iv     BD                 V

The branch currents through voltage-controlled elements Ij,k (j = k, j < n
and k < n) are found from

                                                                                                   Ij,k = Vj - Vk Yj,k.                                                                                    (18.36)
                                                                                              18.3. MODIFIED NODAL ANALYSIS 545

   Before we will discuss the coefficients of the B and C matrix for all kinds
of network elements, we will apply the above in an example of MNA for a
network with some voltage sources.

Example 18.5                                                                          +         +

   Figure 18.15 shows a resistive network with two voltage sources. We will           -         -
derive an expression for the voltage across R3 with the aid of modified nodal
analysis. We will start with the selection of the reference node and numbering        Figure 18.15: Circuit for the demonstration
of the remaining nodes. Figure 18.16 shows the network for netlist generation.        of modified nodal analysis.
The device identifiers (also called REFDES: reference designators) have been typeset
with a fixed width font and the device values with a math font: (R1: R1). The         (1)  (2)  (3)
common terminal of the two voltage sources has been selected as the reference
node. The unknown currents through the voltage sources V1 and V2 are IA and           +         +
IB, respectively. This is shown in Figure 18.16. We are now able to set up the
MNA matrix equation:                                                                  -         -

                                                                                           (0)

0 0 0 VA VB T = M· V1 V2 V3 IA IB T ,                                   (18.37)       Figure 18.16: Circuit from Figure18.15 with
                                                                        (18.38)       numbered nodes.
                                                                        (18.39)
in which         1                  -1                  1 0

                           R1             R1       0    0  0  
                                                              
                 1             1+1+1                 1
                  - R1                                  0 1  .
          M =  0               R1 R2 R3          - R2
                                                               
                 1                  -1              1   0 0
                                                   R2
                       0                  R2            00
                                                   0
                                      0            1
                                      0

The nodal voltage V2 can be found as

          V2 = VAC4,2 + VBC5,2 = R2R3VA + R1R3VB R . 1R2 + R1R3 + R2R3

   It will be clear that the results of the above example could just as well have

been obtained in other ways. With the aid of Norton equivalent circuits, we

can eliminate two nodes and obtain quick results.

   In the above example, we found V2 by linear superposition of the voltages
caused by the two independent voltage sources VA and VB, and by using
the transfers from both independent voltage sources to the output voltage.

Alternatively, V2 could be found with the aid of Cramer's rule.
   Let us consider a linear system described by the following matrix equation:

                               I = M · V,                               (18.40)

where I is the vector of nodal currents and branch voltages and V is the
vector with nodal voltages and branch currents, Cramer's rule states that the
solution of Vi can be found from

                               Vi =  det M    ,                         (18.41)

                                     det M

in which M is the matrix M in which the i - th column has been replaced
with the vector I.

Example 18.6
   We will now find V2 from the previous example with the aid of Cramer's rule.

To do so we obtain the matrix M by substituting the 2nd column of M with the
546 NETWORK THEORY (SELECTED TOPICS)

                                          vector 0 0 0 VA VB T. This yields

                                          1                                                 
                                            R1 0 0 1 0
                                            -  1                                  -1
                                                                               0  R2  0  0  
                                                                                            
                                            R1
                                          M =  0 0 1 0 1 .                                    (18.42)
                                                                                              (18.43)
                                                                                  R2        
                                           1 VA 0 0 0 

                                            0 VB 1 0 0

                                          Application of Cramer's rule yields

                                          V det M R 2 = = 2R3VA + R1R3VB .
                                                 det M R1R2 + R1R3 + R2R3

                                             In the next example, we will determine the MNA matrix equation, as well
                                          as the voltage V2 at node (2) with the aid of SLiCAP.

                                             Example 18.7

                                                 Below is the listing of the SLiCAP netlist file for the circuit from Figure 18.16:

                                           1 NA_7
                                           2 * file: NA_7.cir
                                           3 * SLiCAP netlist for nodal analysis
                                           4 V1 1 0 {V_A}
                                           5 R1 1 2 {R_1}
                                           6 R2 2 3 {R_2}
                                           7 R3 2 0 {R_3}
                                           8 V2 3 0 {V_B}
                                           9 .end

                                             The html output page with the SLiCAP matrix equations and the voltage V2
                                          is shown in Figure 18.17.

Figure 18.17: SLiCAP simulation results.

                                                 The SLiCAP script that displays the matrix equation on this html page is:

                                           1 #!/usr/bin/env python3
                                           2 # -*- coding: utf-8 -*-
                                           3 # File: NA-2.py
                                           4
                                           5 from SLiCAP import *
                                           6 prj = initProject('NA-7')
                                           7 instr = instruction()
                                           8 instr.setCircuit('NA-7.cir')
                                           9 instr.setSimType('symbolic')
                                          10 instr.setGainType('vi')
                                                                                               18.3. MODIFIED NODAL ANALYSIS 547

11 instr.setDataType('matrix')
12 result = instr.execute()
13 htmlPage("Example Modified Nodal Analysis")
14 head2html('MNA equation')
15 matrices2html(result)

       Evaluation of the voltage V2 at node (2) requires the definition of the source and
    the detector. The data type needs to be set to LAPLACE. The script below shows the
    way in which this has been done:

16 instr.setDetector('V_2')
17 instr.setDataType('laplace')
18 result = instr.execute()
19 head2html('Output voltage')
20 text2html("The voltage $V_2$ at node (2) is obtained as:")
21 eqn2html('V_2', sp.simplify(result.laplace))

       The matrix equations in Figure 18.17 match those of (18.38) and the expression
    for the voltage V2 equals (18.43).

18.3.2 DC and AC network solutions

The DC solution of a network is defined as the solution of a network for
s = 0, thus the solution of the simplified equation:

           I = G · V.                                           (18.44)

   The DC network described by (18.44) can be obtained from the original
network by:

1. Removing all capacitors (replacing them with open circuits)

2. Replacing all inductors with short circuits

3. Substitution of s = 0 in the Laplace expressions of the transfer of con-
   trolled sources.

A network has a unique DC solution if the matrix G can be inverted, which

requires:

           det(G) = 0                                           (18.45)

   It is common practice to use the term 'AC solution' of a network instead of
'small-signal solution'. In linear networks, the AC solution of a network equals
the solution of the complete network, including all capacitors, inductors and
complex transfers.

18.3.3 MNA stamps

A netlist of a circuit can be converted into an MNA matrix equation with
the aid of 'MNA stamps'. The MNA stamp of an admittance and a voltage-
controlled current source have been shown in Figure 18.6 and in Figure 18.7,
respectively. In this section, we will discuss some MNA stamps of two fre-
quently used network elements: the voltage-controlled voltage source and
the nullor.

Voltage-controlled voltage sources

Figure 18.18 shows the MNA stamp for a voltage-controlled voltage source
Ex with voltage gain Av, connected between node (1) and (2) and controlled
by the voltage between node (3) and (4). The unknown current IEx through
the voltage source is added to the vector with the nodal voltages. The last
row of the matrix stamp shows the relation between the branch voltages and
the nodal voltages: V1 - V2 = Av (V3 - V4).
548 NETWORK THEORY (SELECTED TOPICS)

Figure 18.18: Voltage-controlled voltage       E_x 1 2 3 4 A_v
source with voltage gain Av, spice syntax,
symbol, device equation and MNA stamp.         (3) +      + (1)
                                               (4) -      - (2)

     (1)     (2)       (3)  (4)                Example 18.8

   +         ++                   +               Let us now solve the problem from example C.18.4 with the aid of MNA.
                                 -                Figure 18.19 shows the circuit with its nodes and the currents through the
  -                                            voltage sources. The MNA equation for this circuit is

(0)          --                                0 0 0 0 Vs 0 T = M· V1 V2 V3 V4 Is Io T , (18.46)

                                               in which:

                                                          1          - Rs1  0       0      10            

                                                                 Rs
                                                           -1        1
                                                           Rs        Rs     0       0      0          0  
                                                                                                         
                                                                            1       1
Figure 18.19: Small-signal equivalent circuit              0 0 Ro - Ro 0 1                               
from example18.4, prepared for MNA.
                                                          M=                - Ro11
                                                          0          0            Ro + sC  0             
                                                                                                      0
                                                                                                         
                                                          1          0      0       0      0 0

                                                                 0 - Adm 1          Adm    00
                                                                                    1+s
                                                                             1+s

                                               The transfer from the source voltage Vs to the load voltage V = V4 is found from

                                                                     V = C5,4 ,                            (18.47)
                                                                     Vs det (M)

                                               where C5,4 is the element on the fifth row and the fourth column of the cofactor
                                               matrix C of M. We obtain

     nullor                                               V V = s s + Adm + sRoC + s2 Adm R , oC + 1       (18.48)

(3)          (1)

                                               which, of course, is equal to the result from example 18.4, expression 18.30.

(4)               (2)                          The Nullor
nullator     norrator
                                               Evaluation of the performance of idealized negative-feedback circuits is an
Figure 18.20: The nullor, its symbol, device   almost daily practice for designers of analog circuits. Such circuits comprise
equations and MNA stamp.                       a high-gain amplifying device: the controller and one or more feedback loops.
                                               The network abstraction of an ideal controller is a nullor. A nullor consists of
                                               two network elements: a nullator and a norator. The nullator sets a network
                                               condition, while the norator adds an independent variable such that this con-
                                               dition can be satisfied. Figure 18.20 shows the symbol and the MNA stamp
                                               of a nullor.

                                                  The nullator and norator of the nullor only communicate through the ex-
                                               ternal circuit: there exists no relationship between the input port quantities
                                               and the output port quantities. A network comprising n nullators only has
                                               a valid solution if it also has n norators of which the port variables together
                                               create the zero drive conditions for the n nullators. If more nullors appear
                                               in one circuit, one can arbitrarily combine nullators and norators in pairs to
                                               form nullors without changing the operation of the circuit.

                                                  Many simulators do not have the nullor implemented as a standard com-
                                                                        3  18.3. MODIFIED NODAL ANALYSIS 549

                                                ++                                       Figure 18.21: The nullor and an implemen-
                                                                                         tations with unity-gain voltage-controlled
                                                                                         voltage sources.

1          3                          1         --           4

                                         ++

2          4                          2- -

ponent. Figure 18.21 shows an implementation of a nullor with two unity-
gain voltage-controlled voltage sources.

   Below is the definition of a nullor sub-circuit for LTspice according to the
model from Figure 18.21.

 1 * file: nullor.cir
 2 * LTspice nullor subcircuit
 3 .subckt nullor 3 4 1 2
 4 E1 3 4 3 5 1
 5 E2 5 4 1 2 1
 6 .ends nullor

   In the following example, we will evaluate the gain of a negative feedback                 (1)  (2)
voltage amplifier that has a nullor as controller.
                                                                                         +
   Example 18.9
                                                                                         -         (3)  (4)
       The circuit from Figure 18.22 shows the concept of a passive feedback voltage
   amplifier. We will evaluate the voltage gain from source to load using MNA. The       (0)                  +
   MNA matrix equation can be found as                                                                       -

0 0 0 0 Vs 0 T = M· V1 V2 V3 V4 Is Io T ,                                  (18.49)
                                                                           (18.50)
in which the matrix M is defined as:                                       (18.51)       Figure 18.22: Negative-feedback voltage
                                                                                         amplifier with a nullor.

1  Zs - Zs    1     0                    0 10              

 -1 1               0                    0      0       0  
 Zs Zs                                                     
                 1                    1  1
        0     0 Z1 + Z2 - Z1  0 0  ,                       
M=
0             0     -1                   1 + 1 0 -1 
                    Z1                   Z Z1
                    0                                      
1 0                                      0 0 0

   01               -1                   0 00

from which the source-to-load transfer can be found as

              V = C5,4 = Z1 + Z2 .
              Vs det(M)                     Z2

   In the following example, we will evaluate the gain of a unity-gain second
order active low-pass filter.

   Example 18.10
       Figure 18.23 shows the circuit of the two-pole unity-gain active low-pass filter

   with a nullor as controller. We will derive an expression for the transfer function
   T(s) = Vout .

                    Vs

       To this end, we set up the MNA matrix equation of the circuit and obtain:

       0 0 0 0 Vs 0 T = M· V1 V2 V3 Vout Is Io T , (18.52)

   in which Is is the unknown current through the signal voltage source and Io the
550 NETWORK THEORY (SELECTED TOPICS)

Figure 18.23: Second order active low-pass
filter with voltage follower.

                                                       (1)  (2)              (3)           (4)

                                                 +                                            +

                                                -                                            -

                                              (0)

                                            current delivered by the nullor. The matrix M is obtained as:

                                            1            -1        0 0 1 0
                                              R1
                                              -  1             R1         1       -sC1
                                                                                        0                  0  
                                                    1 + 1 + sC1     - R2                                      
                                             R1
                                                    R1 R2          1
                                            M =  0                 R2 + sC2 0 0 0  .                          
                                                         -1
                                            0                      0              sC1   0 1                       (18.53)
                                                               R2                              
                                                                   0              0 0 0
                                            1            -sC1
                                                            0
                                              0                    1              -1 0 0
                                                            0

                                               The transfer function T(s) that describes the transfer from Vs to Vout can be
                                            found as

                                            T(s) = Vout V = C5,4 = s det(M) 1 + sC2 (R1 + R2) + s2 1 C . 1C2R1R2  (18.54)

                                            Overview of MNA stamps

                                            Figure 18.24 gives an overview of the matrix stamps of two-terminal network
                                            elements. All elements are considered to be floating with respect to the refer-
                                            ence node. Hence, the dimension of their MNA stamp is the sum of the num-
                                            ber terminals and the number of dependent currents of the current-controlled
                                            elements. Figure 18.24G shows a compact matrix stamp for a voltage source
                                            in series with an impedance. It assumes that the impedance Z can be written
                                            as a Laplace rational function: Z = Dz(s) Nz(s) . Both the numerator Nz(s) and the
                                            denominator Dz(s) are polynomials of the Laplace variable s. This way of im-
                                            plementing Laplace rational expressions will be discussed in section 18.4.1.
                                            This also applies to the matrix stamps of controlled sources. These will be
                                            shown in section 18.4.1.

                                               Figure 18.25 shows the matrix stamps of the nullor (A), the gyrator (B),
                                            two coupled inductors (C) and the ideal transformer (D).
                                 (1)    18.3. MODIFIED NODAL ANALYSIS 551
                        Rx
                                                      Figure 18.24: MNA stamps of two-terminal
A                            (2)                      network elements:

                                 (1)                       A: Resistor; cannot have zero resistance
                        Rx                                 B: Resistor; can have zero resistance
                                                           C: Capacitor
B                            (2)                           D: Inductor
                                                           E: Independent current source
                                 (1)                       F: Independent voltage source
                        Cx                                 G: Independent voltage source with
                                                      series impedance; compact matrix stamp.
C                            (2)
                                                      Figure 18.25: MNA stamps of:
                               (1)                         A: Nullor
                        Lx                                 B: Gyrator
                                                           C: Coupled inductors
D                            (2)                           D: Ideal transformer

                                   (1)
                        Ix

E                            (2)

                         + (1)

                        Vx

F - (2)

                                  (1)

            +

        Vx

G                    -

                        (2)

   (3)                  (1)

   (4)                  (2)

A       Nx

   (3)                  (1)

   (4)                  (2)

B Wx

   Kx

   (3)                  (1)

   (4)                  (2)

C L1

                 L2

   (3)                  (1)

   (4)                  (2)

D
552 NETWORK THEORY (SELECTED TOPICS)

                                           18.4 Implementation of transfer functions

                                           During the design of electronic circuits, it is sometimes convenient to have
                                           high-level models of dynamic systems at one's disposal. Many SPICE-like
                                           simulators have the possibility of using Laplace building blocks for this pur-
                                           pose. The general form of a transfer function H(s) that can be modeled with
                                           these blocks is that of an univariate rational function of the Laplace variable
                                           s:

                                                             H(s) =  N(s)     m  bj  sj

                                                                           j=0
                                                                           =n            .  (18.55)
                                                                     D(s) i=0 aisi

                                              Like SPICE, SLiCAP accepts transfer functions that can be written as a
                                           quotient of two univariate polynomials of the Laplace variable s with the
                                           order of the denominator D(s) equal to or larger than the order of the nu-
                                           merator N(s) (n  m). In order to allow such descriptions, they need to be
                                           incorporated into the circuit's MNA matrix. In this section, we will discuss
                                           two methods for doing this:

                                           1. Direct insertion of s-polynomials for numerator and denominator in the
                                              MNA matrix. This will be discussed in section 18.4.1.

                                           2. Conversion of H(s) into an equivalent network. This will be discussed in
                                              section 18.4.2.

Figure 18.26: MNA stamps of controlled     (3) +      + (1)
sources of which the transfer can be en-
tered as a Laplace rational function.      (4) -      - (2)

    A: Voltage-controlled voltage source;         Ex
VCVS
                                           A
    B: Current-controlled current source;
CCCS                                       (3)        (1)

    C: Voltage-controlled current source;  (4)        (2)
VCCS, compact matrix stamp. The gain
must be a constant and not a Laplace              Fx
rational.
                                           B
    D: Voltage-controlled current source;
VCCS.

    E: Current-controlled voltage source;
CCVS.

                                           (3) + (1)

                                           (4) - (2)
                                           C Gx

                                           (3) + (1)

                                           (4) - (2)

                                                        Gx

                                           D

                                           (3) + (1)

                                           (4) - (2)

                                                        Hx

                                           E
                                                   18.4. IMPLEMENTATION OF TRANSFER FUNCTIONS 553

18.4.1 Numerator and denominator substitution                                        4 By keeping sn : n > 0 symbolically in the
                                                                                     expression.
In order to determine the poles and the zeros of a network, both the cofactors       5 Determination of the cofactors and the
and the determinant of the MNA matrix need to be obtained as polynomials             determinant of a matrix through expansion
of the Laplace variable s. For accurate results, all the determinants should         of minors, is known as being accurate but
then be evaluated through symbolic4 expansion of minors.5                            slow. For an n×n matrix with nonzero
                                                                                     numeric coefficients, it requires n! multipli-
   Figure 18.26A, B, D and E show the MNA matrix stamps for the con-                 cations!
trolled sources of which the transfer can be written as a Laplace rational
function. Figure 18.26C shows a compact stamp for the voltage-controlled
current source with instantaneous transfer.

18.4.2 Network expansion method

With the aid of the network expansion method, we will be able to write the
MNA matrix M in the form of:

                                  M = G + sC.                          (18.56)

The poles (and zeros) of a transfer can now be found by solving the

so-called generalized eigenvalue problem; for the poles: det (G + sC) = 0,
                                                                       -1
which gives rank(M) nonzero solutions.     Each pole (or zero) si  =     i  cor-

responds to an eigenvalue i of the time-constant matrix T = G-1C. Since

the time-constant matrix T can only be defined if det(G) = 0, the network

described by M must have a unique DC solution.

The method for finding poles and zeros with the aid of the time-constant

matrix is presented in section 18.5. In this section, we will focus solely on the

network expansion method.

The basis of this technique is to write higher order differential equations

as a set of first order differential equations. To illustrate this, let us assume a

system of order k:

                        Y(s) b0 + b1s + b2s2 + · · · + bksk
        H(s) =               =                 2 k.                    (18.57)
                        X(s) a0 + a1s + a2s + · · · + aks

   We may describe this transfer with k first order differential equations. To

this end, we introduce k state variables: Q1 · · · Qk with Qi = sQi-1, with
i = 1 · · · k, and write

                     Y(s) = b0 + b1Q1 + b2Q2 + · · · + bkQk,           (18.58)
                     X(s) = ao + a1Q1 + a2Q2 + · · · + akQk,           (18.59)
                                                                       (18.60)
                       Q1 = s,                                         (18.61)
                       Q2 = sQ1,
                                                                       (18.62)
                            ..                                         (18.63)
                            .,
                       Qk = sQk-1.

In matrix form, this set of equations appears as

 X(s)   0 a0 a1 a2 · · · ak-1 ak   Y(s) 

  0     1               -b0  -b1  -b2  ···     -bk-1  -bk          1        
                                                                            
 0   0 s -1 0 · · · 0                                 0            Q1
                                                                            
                        0    s -1 · · ·        0      0            Q2       
  0    =  0
                                                                             .
  ..                ..  ..    ..   .. . .      ..     ..           ..

                                           ..                               
                                                                            
 .  . .                      .    .                     .  . 

 0   0 0 0 0 · · · -1 0   Qk-1 

  0                 0 0 0 0 · · · s -1                             Qk

                                                                       (18.64)
554 NETWORK THEORY (SELECTED TOPICS)

                                               Such a matrix stamp can easily be added to the network's MNA matrix.
                                            If X(s) and Y(s) are available as input and output variables, we can assign
                                            either voltage or currents to them.

                                               In some cases, it is convenient to represent the system with an equiva-
                                            lent network and assign the state variables to capacitor voltages or inductor
                                            currents.

                                               As we have seen with nodal analysis, the most compact network descrip-
                                            tion is obtained with voltage-controlled elements. Such a matrix description
                                            has the form

                                                                    I = Y · V,                                       (18.65)

                                            in which I is the vector with nodal currents that flow and branch voltages,
                                            Y the admittance matrix and V the vector with nodal voltages and branch
                                            currents. Hence, a network that is compatible with Nodal Analysis, requires
                                            the state variables to be voltages across k capacitors:

                                                             Q0 · · · Qk = V0 · · · Vk.                              (18.66)

                                               Such a network is shown in Figure 18.27. The k capacitors are driven

                                            from voltage-controlled current sources, whose gain is set by the coefficients
                                            a0 · · · ak and b0 · · · bk. The current-driven capacitors act as integrator ele-
                                            ments. In order to find the circuit and its matrix stamp, we need to convert
                                            the expression for H(s) (18.55) into the integral form. This is achieved by
                                            dividing both the numerator and denominator of H(s) (18.57) by sk. This

                                            yields:

                                            H(s) =  b0 V +s     s b1          s  b2   Vk-2  +  ·  ·  ·  +  bk V0  .  (18.67)
                                                    a            a             a
                                                     kk           k-1 Vk-1 +     k-2

                                                      o  Vk  +    1V      +     2V          +  ·  ·  ·  +  ak V0

                                                     sk         sk-1 k-1      sk-2 k-2

                                            For a system order of k, the circuit has k + 2 nodes: one node for the output,

                                            one node for the dummy variable Vo, and k nodes for the state variables. The
                                            circuit shown in Figure 18.27 has been designed from the equations

                                            Iout = sk b0 Vk + sk-1 b1 Vk-1 + sk-2 b2 Vk-2 + · · · + bkV0,            (18.68)
                                            Iin = k a0 Vk + k-1 a1 Vk-1 + k-2 a2 Vk-2 + · · · + akV0,                (18.69)
                                            s                s                s                                      (18.70)

                                            Vi = 1s Vi-1.

Figure 18.27: Integrator-based circuit for
implementation of transfer functions that
can be written as a quotient of polyno-
mials, using current-driven capacitors as
integrators and its MNA matrix stamp.
                                                               18.4. IMPLEMENTATION OF TRANSFER FUNCTIONS 555

18.4.3 Matrix stamps of expanded transfer functions

We will give the matrix stamps for controlled sources whose transfer can be                6 The capacitor voltages.

described by a quotient of two polynomials in s. The descriptions are based

upon equivalent networks with integrators, in which voltage-controlled cur-
rent sources drive the capacitors that carry the state variables.6

VCVS                                                                                        (3) + + (1)

Below is the SLiCAP syntax of the voltage-controlled voltage source from                    (4) - - (2)
Figure 18.28:
                                                                                           Figure 18.28: Voltage-controlled voltage
    E_x 1 2 3 4 (b_0+b_1*s+...+b_k*s^k)/(a_0+a_1*s+...+a_k*s^k)                            source with Laplace transfer function.
                                                                                           7 Modified Nodal Analysis
   Its MNA7 matrix stamp8 and the vector V is                                              8 With C = 1 and g = 1

 0 0 0 0 1 0 0 · · · 0 0   V1 

 0 0 0 0 -1 0                         0      ··· 0        0           V2     
                                                                             
                                                                      V3
                                      0      ··· 0        0                  
0 0 0 0 0 0                                                                  

                                      0      ··· 0        0           V4     
0 0 0 0 0 0                                                                  

                              bk      bk-1 · · ·    b1    b0          IEx    
 -1 1 0 0 0                                                                  
                                                          a0  ,       V0Ex    . (18.71)
 0 0 -1 1 0                   ak      ak-1 · · ·    a1                       

 0 0 0 0 0 -1                         s      ··· 0        0           V1Ex   
                                                                             

  ..      ..      ..  ..  ..      ..  ..     ..      ..    ..         ..
                                                                             
                                                 .        .             .    
                                                               
. . . . . . .                                       .                        
                                                               
 0 0 0 0 0 0 0 · · · s 0   Vk-1Ex 
  0 0 0 0 0 0 0 · · · -1 s                                            VkEx

                                                                                           (3)  (1)

CCCS                                                                                       (4)  (2)

Below is the SLiCAP syntax of the current-controlled current source from                   Figure 18.29: Current-controlled current
Figure 18.29:                                                                              source with Laplace transfer function.

    F_x 1 2 3 4 (b_0+b_1*s+...+b_k*s^k)/(a_0+a_1*s+...+a_k*s^k)                            9 With C = 1 and g = 1

   Its MNA matrix stamp9 and the vector V is

   0 0 0 0 0 bk bk-1 · · · b1 b0   V1 
                                                                            V2
  0 0 0               0   0   -bk     -bk-1  ···     -b1       -b0                
                                                                                  
                                                                            V3
  0 0 0 0 0 1                         0      ··· 0             0                  
                                                                                  
                                                                            V4
   0 0 0 0 0 -1                                                     
                                                                        

                                      0      ··· 0             0                  
                                                                                  
                                                                      
                                                                            IFxi
   0 0 1 -1 0 0                       0      ··· 0             0                  
                                                                                  
                                                                     ,      V0Fx  .
  0 0 0               0   1   ak      ak-1 · · · a1            a0                 
  
   0 0 0 0 0 -1                       s      ··· 0             0            V1Fx
  
                                                                                  
                                                                                  

      ..      ..  ..  ..  ..  ..       ..        . . ..         ..           ..

                                                    ..                      .     
                                                                                  
  . . . . . .                         .                        .
                                                                                  
                                                                    
                                                                        
                                                                    
  0 0 0 0 0 0                         0 · · · s 0    Vk-1Fx 

      000 0 0 0                       0 · · · -1 s                          VkFx

                                                                                  (18.72)

VCCS                                                                                        (3) + (1)

Below is the SLiCAP syntax of the voltage-controlled current source from                    (4) - (2)
Figure 18.30:                                                                              Figure 18.30: Voltage-controlled current
                                                                                           source with Laplace transfer function.
    G_x 1 2 3 4 (b_0+b_1*s+...+b_k*s^k)/(a_0+a_1*s+...+a_k*s^k)                            10 With C = 1 and g = 1

   Its MNA matrix stamp10 and the vector V is
556 NETWORK THEORY (SELECTED TOPICS)

                                           0 0 0 0 bk bk-1 · · · b1 b0   V1 
                                                                                                                              V2
                                          0 0 0                0       -bk     -bk-1        ···  -b1        -b0                    
                                                                                                                                   
                                                                                                                              V3
                                          0 0 0 0 0                            0            ··· 0            0
                                                                                                                                   
                                                                                                                              V4   
                                          0 0 0 0 0
                                                                               0            ··· 0            0                     
                                                                                                                                   
                                                                                                                            V0Gx
                                                                                                                          

                                           0 0 1 -1                    ak      ak-1         · · · ak-1       ak             V1Gx   
                                                                                                                       ,            . (18.73)
                                           0 0 0 0 -1                          s            ··· 0            0
                                                                                                                                   
                                                                                                                                   
                                                                                                                          
                                            ..      ..  ..     ..      ..          ..       . . ..           ..                ..

                                                                                            ..                                .    
                                                                                                                                   
                                          . . . . .                                  .                         .      
                                                                                                                                   
                                                                                                                          
                                                                               0 ··· s                                
                                          0 0 0 0 0                                                          0    Vk-1Gx 

                                            0 0 0 0 0 0 · · · -1 s VkGx

 (3) + (1)                                CCVS

 (4) - (2)                                Below is the SLiCAP syntax of the current-controlled voltage source from
Figure 18.31: Current-controlled voltage  Figure 18.31:
source with Laplace transfer function.
11 With C = 1 and g = 1                       H_x 1 2 3 4 (b_0+b_1*s+...+b_k*s^k)/(a_0+a_1*s+...+a_k*s^k)

                                             Its matrix stamp11 and the vector V is

                                           0 0 0 0 0 1 0 0 · · · 0 0   V1 

                                           0 0 0 0 0 -1 0                                        0      ··· 0           0          V2    
                                                                                                                                         
                                                                                                                                   V3
                                                                                                 0      ··· 0           0                
                                          0 00 0 1 0 0                                                                                   

                                                                                                 0      ··· 0           0          V4    
                                           0 0 0 0 -1 0 0                                                                                

                                                                                                 0      ··· 0           0          IHxi  
                                           0 0 1 -1 0 0 0                                                                                

                                                                           0   0        bk       bk-1 · · ·       b1    b0  ,      IHxo  
                                           -1 1 0 0                                                                                      .
                                                                                                                                   V0Hx
                                           0 0 0 0 -1 0                                 ak       ak-1 · · ·       a1    a0               
                                                                                                                                         
                                                                                                                            
                                          0 00 0                           0   0 -1              s      ··· 0           0          V1Hx  
                                                                                                                                         

                                                ..      .. ..      ..      ..  ..       ..       ..     ..        ..    ..         ..

                                                                                                                                         
                                                                                                                                         
                                          . . . . . . . .                                                   . . .  . 
                                           0 0 0 0 0 0 0 0 · · · s 0   Vk-1Hx 
                                                0 0 0 0 0 0 0 0 · · · -1 s VkHx
                                                                                                                                         (18.74)

                                          18.5 Determination of poles and zeros

                                          Knowledge of poles and zeros is indispensable for the analysis and design
                                          of the stability of amplifiers. A network of which the solutions of s of its
                                          characteristic equation are located in the left half of the complex plane is
                                          stable. Instability cannot always be observed at the circuits's output. In a
                                          case of non-observable instability, zeros with the same frequency as the right
                                          half plane poles cover up instability. Hence, observation of a stable time-
                                          domain response of a circuit does not guarantee the circuit's stability.

                                             In order to get a clear picture of both observable and non-observable insta-
                                          bility, only the solutions of the characteristic equations should be evaluated.
                                          These solutions are the poles of the network.

                                             We will discuss three ways for the determination of the poles:

                                          1. Direct solution of the characteristic equation; this will be discussed in
                                             section 18.5.1.

                                          2. Determination of the eigenvalues of the time-constant matrix; this will be
                                             discussed in section 18.5.2.

                                          3. Direct estimation from a network; this will be discussed in section 18.5.3.
                                                               18.5. DETERMINATION OF POLES AND ZEROS 557

18.5.1 Solving the characteristic equation

Consider a network of which the MNA equations are given as

                                  I = M·V                                       (18.75)

in which I is the vector with nodal currents and branch voltages, M the MNA
matrix, and V the vector with nodal voltages and branch currents. The poles
of the network can be found by solving the equation

                                  det(M) = 0.                                   (18.76)

    The zeros are found by solving

                                  det(M) = 0,                                   (18.77)

in which Mis obtained from M and I, after application of Cramer's rule.12                12 See section 18.3 for theory on this topic.
   In practice, calculation of the determinant of a matrix using Gaussian elim-
                                                                                         13 Leo O. Chua and Pen-Min Lin. Computer
ination may generate extra poles due to rounding effects. For accurate de-               aided analysis of electronic circuits. Prentice-
termination of the poles and the zeros, powers of the Laplace variable sn                Hall, Inc., USA, 1975. ISBN: 0-13-165415-2
(n > 0) should be kept symbolically in the matrix elements and the deter-
minant should be evaluated through expansion of minors. In order to keep
M or M as small as possible, transfer functions can be implemented as dis-
cussed in section 18.4.1. Symbolic expansion of minors, however, is a time-
consuming process and can be used for small circuits only. This method has
been implemented in the current version of SLiCAP.

   Another way is to calculate the poles and zeros from a state equation rep-
resentation of the network. Formulation of the state equations for a network
with passive elements and controlled sources, however, is complex, and the
procedure for it differs considerably from setting up the MNA matrix. The
reader is referred to Chua [Chua1975]13 for more information on setting up
the state equations of a network.

   Alternatively, poles can be found as the eigenvalues of the so-called time-
constant matrix, which can be derived from the MNA matrix. This will be
discussed in section 18.5.2.

18.5.2 Eigenvalues of the time-constant matrix                                           14 In differential form.

Consider the network equations written as a set of first order differential              15 The number of solutions that are found
equations.14 The matrix M then has the form:                                             in this way, is equal to the dimension of
                                                                                         M. However, the number of nonzero eigen-
                                  M = G + sC.                                   (18.78)  values equals the number of independent
                                                                                         states, which is the sum of the number
    The poles are obtained by solving the equation:                                      of independent capacitor voltages and
                                                                                         independent inductor currents.
                                  det(G + sC) = 0.                              (18.79)  16 A circuit has only finite non zero eigen-
                                                                                         values if the number of poles equals the
    This method for determination of the poles, solves the so-called general-            sum of the number of capacitors plus the
                                                                                         number of inductors and there are no cut
ized eigenvalue problem as stated in (18.79). This equation can be written in            sets of capacitors (and current sources) or
                                                                                         loops of inductors (and voltage sources).
the form

                                  det (I + sT) = 0.                             (18.80)

in which T = G-1C. Notice that det (I + sT) = 0 can be written in the form
                                                                          -1
of  the  generalized  eigenvalue  problem:  det  (A-I)  =  0,  with    =        Hence,
                                                                             s
if i is an eigenvalue of T, the complex frequency of the corresponding pole
pi is s = - 1i .
    However, in most cases the number of eigenvalues of T exceeds the num-

ber of independent state variables.15 Thus, evaluated in this way, the n poles

found from the eigenvalues of T are the k system poles plus n - k poles at

infinity, or after numeric solution, at very high frequencies.

    For systems with only finite nonzero eigenvalues16, the modified nodal
558 NETWORK THEORY (SELECTED TOPICS)

                                             equations can be transformed into the state equations, using the transforma-

17 Stephen B. Haley. The Generalized         tion technique described by Haley [Haley1988]17. The time constant matrix
Eigenproblem: Pole-Zero Computation.
Proceedings of the IEEE, 76(2):103-120,      can then be written as
February 1988
                                                                                 T = R · C,                   (18.81)
18 V is the vector with dependent variables
                                             in which C is a diagonal matrix, having Cii = Ci (i = 1 · · · p) for a circuit with
                                             p capacitors, and Cp+j,p+j = -Lj (j = 1 · · · q) for a circuit having q inductors:

                                                                    C1 · · · 0        0 ···           0

                                                                     ...    ...  ...  ..         ...   ...  
                                                                                      .                     

                                                              0             · · · Cp 0 · · ·                  (18.82)
                                                                                                      0       (18.83)
                                                        C=                  · · · 0 -L1 · · ·         0  .
                                                              0

                                                                       ..   ...  ..   ..         ...   ..   
                                                                                 .    .
                                                                         .                            .     
                                                                                                            

                                                                     0 ··· 0 0 ···                    -Lq

                                             The resistance matrix R is obtained as

                                                                                 I T · G-1 · I,

                                             where I is the incidence matrix. This matrix holds the positions of the ele-
                                             ments of C in C. Its number of rows i equals that of G and its number of
                                             columns j equals the sum of the number of capacitors and the number of
                                             inductors. The elements of I can be obtained as follows:

                                             · Iij = 1

                                             - if the positive terminal of a capacitor at Cjj is connected to node i.
                                             - or if Vi is the current through an inductor at Cjj.18

                                             · Iij = -1 if the negative terminal of a capacitor at Cjj is connected to node
                                                i.

                                             · Otherwise, Iij = 0

                                                Example 18.11 shows the application of the incidence matrix.
                                                The time-constant matrix can only be defined if, G-1 exists. This means
                                             that the circuit needs to have a unique DC solution.

                                             Structure and meaning of the resistance matrix R

                                             If we have a network with p capacitors and q inductors, the network can
                                             be drawn as a p + q port network in which a capacitor Ci : i = 1 · · · p is
                                             connected to its port i, and an inductor Lj : j = 1 · · · q is connected to its port
                                             p + j, as shown in Figure 18.32A.

                                                The resistance matrix can be found from the (p + j)2 DC transfers that
                                             exist in this p + q port. To find these transfers, we replace all capacitors Ci
                                             with independent current sources Ii, and all inductors Lj with independent
                                             voltage sources Vp+j, as shown in Figure 18.32B. Then, the voltage Vi across
                                             the independent current source Ii at port i, and the current Ip+j through
                                             the independent voltage source Vp+j at port p + j, can be found from the
                                             following matrix equation:

                                               V1 · · · Vp Ip+1 · · · Ip+q T = R· I1 · · · Ip Vp+1 · · · Vp+q T ,
                                                                                                                                           (18.84)

                                             in which R is the resistance matrix.
                                                The resistance matrix R can be decomposed into four sub-matrices:

                                                                            R = r µ  g .                      (18.85)
                                                                   18.5. DETERMINATION OF POLES AND ZEROS 559

Expression (18.85) shows this decomposition in:

1. A p × p transresistance matrix r

2. A q × q transconductance matrix g

3. A p × q voltage transfer matrix µ

4. A p × q current transfer matrix 

The resistance matrix R thus has the form:

             r11 · · · r1p µ11 · · ·                          µ1q 
              ..                             ..     .. . . .   .. 
                .      ...                   ..                .
            

                                                              µpq  
                rp1 · · · rpp µp1 · · ·
                                                                     (18.86)
R =                                                                

      
             11 · · · 1p g11 · · ·                            gq1  
                                             ..     .. . .         
                ..     ..                                     .
                  . .. . .                                    .. 
            

              q1 · · · qp g1q · · ·                           gqq

p ports with capacitors                                            p ports with current sources
                                  -
                                                                                                 -
                                     port p                                                      port p
                                                                                                                                       +
                                                 +
                                   +
          +
                                                                                                   -port p+1port p+1
            -                                                                       Resistive
            Resistive                            -                                  p+q port
                                                                                                                                      -+ network
                                                                                                                                                       +p+q portport 1
                                                                     -
+ network
                                                                              port p+q
    port 1
-

port p+q

                                    q ports with inductors                                                  q ports with voltage sources+
(A)                                                                  (B)

   The physical meaning of the elements of R is as follows:                           Figure 18.32: Interpretation of the resis-
                                                                                      tance matrix
1. A diagonal element rii, with i = 1 · · · p, represents the port resistance at
   port i.                                                                                (A) The complete network is drawn
                                                                                      as a resistive multi-port network with
   If an independent current source Ii is replaced with the capacitor Ci, and         capacitors and inductors connected to the
   all other independent sources have been set to zero, rii is the resistance         ports.
   that will dissipate the energy stored in Ci.
                                                                                          (B) The capacitors are replaced with
2. A diagonal element gjj, with j = 1 · · · q, represents the port conductance        independent current sources, and the in-
   of port p + j.                                                                     ductors with independent voltage sources.

   If an independent voltage source Vp+j is replaced with the inductor Lj, and            The resistance matrix describes the
   all other independent sources have been set to zero, gjj is the conductance        relation between the independent sources
   that will dissipate the energy stored in Lj.                                       and the dependent port variables.

3. An off-diagonal element ri,k, with i = 1 · · · p, k = 1 · · · p and i = k, repre-
   sents the transresistance from port k to port i.

   A nonzero coefficient ri,k implies charge exchange between Ci and Ck in
   the original network.
560 NETWORK THEORY (SELECTED TOPICS)

                                                4. An off-diagonal element gj,, with j = 1 · · · q,  = 1 · · · q and j = , repre-
                                                    sents the transconductance from port p +  to port p + j.

                                                      A nonzero coefficient gj, implies flux exchange between inductor Lj and
                                                      L in the original network.

                                             5. An off-diagonal element µi,j, with i = 1 · · · p and j = 1 · · · q, represents the
                                                voltage transfer from port p + j to port i.

                                                A nonzero coefficient µi,j, indicates the exchange of energy storage be-
                                                tween Lj and Ci in the original network.

                1                            6. An off-diagonal element i,j, with i = 1 · · · q and j = 1 · · · p, represents the
                2                               current transfer from port i to port p + j.
                3
                                                A nonzero coefficient i,j, indicates the exchange of energy storage be-
Figure 18.33: Example of a passive circuit      tween Ci and Lj in the original network.
for pole-zero calculation.
                                             Example 18.11
Figure 18.34: Construction of the incidence
matrix:                                         We will evaluate the poles of the circuit from Figure 18.33, with the aid of the
                                             time-constant matrix. The MNA equations for this circuit are:
  C1 is connected between node 3 and node
0                                                     0 0 0 0 T = (G + sC) · V1 V2 V3 IL1 T ,        (18.87)
                                             in which
  C2 is connected between node 1 and node
0                                                 1 1        1
                                                      R1 + R2 - R1 0 0                             
  The current through L3 is the dependent
variable at the fourth row of the MNA              -1        1 0 1
equation.                                         G=    R1   R1                                      (18.88)

                                                  0          0 0 -1 

                                                        0    1 -1 0

                                             and        C2 0 0 0                                 

                                                  C =  0  0  00    0  0  .                           (18.89)
                                                             0 C1

                                                        0 0 0 -L1

                                                We find rank C is 3, which is equal to the number of reactive elements. Hence,
                                             there are no zero eigenvalues, and three finite eigenvalues. All capacitor voltages
                                             and inductor currents can be taken as state variables.

                                                We will define the diagonal matrix C as:

                                                           C1 0 0     

                                                  C =  0 C2 0  .                                     (18.90)

                                                             0 0 -L1

                                                Please notice the minus sign for L; it corresponds with the definition of the
                                             positive directions of the port variables as shown in Figure 18.32B.

                                                The incidence matrix I can be obtained from the netlist as illustrated in Figure
                                             18.34. For the given circuit we obtain

                                                                                  0 1 0              (18.91)
                                                                          I =  1 0 0   0 0 0  .

                                                                                      001

                                             Note that C can be obtained from I and C as:

                                                        C = ICIT.                                    (18.92)
                                                               18.5. DETERMINATION OF POLES AND ZEROS 561

With the aid of (18.83), we find the resistance matrix R as

                                 T  1 1            -1 0        0 -1  0 1
                      0      10      R1 + R2       R1                             0
R = I TG-1I =  01                                                                 0  0  ,
                             0 0   -1              1     0     1    ·  1 0  0 0   1
                          0       ·  R1            R1                    00
                             0 0  0
   which yields              01                    00          -1 

                                     0             1 -1        0

                                                                    (18.93)

                                                   -1               (18.94)
                                       R1 + R2 R2   0 .
                                                    0
                             R =  R2 R2
                                          -1 0

   The time-constant matrix of the circuit from Figure 18.33 is according to its
definition from 18.81, obtained as

                 R1 + R2 R2 -1                     C1 0 0      

T =RC=  R2 R2 0  ·  0 C2 0  ,                                       (18.95)

                             -1 0 0                0 0 -L1

which yields:

                                         C2 R2                      (18.96)
                           C1 (R1 + R2)  C2 R2         L1
                                                       0 ,
                 T =  C1R2                 0
                                -C1                    0

with i being an eigenvalue of T. The poles pi are found from these eigenvalue:

                                 pi = - 1 .i                        (18.97)

Let us now substitute the numeric element values for the elements from Figure
18.33 and evaluate the pole frequencies:

R1 = 10, R2 = 100, L1 = 10-6, C1 = 10-10, C2 = 10-8.                (18.98)

We then have                         1.0 × 10-6    1.0 × 10-6 
                                     1.0 × 10-6
                 1.1 × 10-8                              0     ,    (18.99)
          T =  1.0 × 10-8                  0
                                                         0
                    -1.0 × 10-10

and the eigenvalues of T are obtained as                            (18.100)
                                                                    (18.101)
                     1 = 1.01 × 10-6,                               (18.102)
                     2 = 4.955 4 × 10-10 + 9. 938 0 × 10-9 j,
                     3 = 4.955 4 × 10-10 - 9. 938 0 × 10-9 j.

Hence, the poles of the circuit are

               p1 = - 1 = -9.901 × 105,                             (18.103)
                         1                                          (18.104)
                                                                    (18.105)
               p2 = - 1 = -5.005 × 106 + 1.004 × 108j,
                         2

               p3 = - 1 = -5.005 × 106 - 1.004 × 108j.
                         3

   From this example, we see that the poles can easily be found from the
eigenvalues of the time-constant matrix T. A similar procedure can be fol-
lowed for zeros. The time-constant matrix is then derived from R and C
which are obtained from R and C after application of Cramer's rule.

   In the next example, we will demonstrate the determination of the resis-
562 NETWORK THEORY (SELECTED TOPICS)                                                                                                        +                     -
                                                tance matrix R by network inspection.                                                       -                     +
                                                  Example 18.12
                                                                                                                                            -
Figure 18.35: Setting up the R-matrix by                                                                                                    +
network inspection.
                                                                                                                                        Network for evaluation
                                                                                                       3                                of the resistance matrix

                                                                                                              2

                                                                                                       1

                                                                                                                   Original network as
                                                                                                                   multi-port network

   Figure 18.35 shows the circuit from Figure 18.33 redrawn as a multi-port

network. The left side of the figure shows the original circuit with the capacitors

and the inductor connected to a resistive multi-port. Capacitor C1 is connected to
port 1, capacitor C2 to port 2 and inductor L1 to port 3.

   The right side of the figure shows the same network with the capacitors replaced

with current sources and the inductor with a voltage source. The resistor matrix
R holds the relations between the dependent and independent port variables:

                                                                                                                                         
V1                          R11 R12 R13                                                                                                       I1

 V2  =  R21 R22 R23  ·  I2  .                                                                                                                                        (18.106)

I3                          R31 R32 R33                                                                                                       V3

The coefficients Rij are found from network inspection:

                   R11 =  V1 = R1 + R2,                                                                                                                              (18.107)
                   R12 =  I1 I2=0,V3=0                                                                                                                               (18.108)
                   R13 =  V2 = R2,                                                                                                                                   (18.109)
                   R21 =  I1 I1=0,V3=0                                                                                                                               (18.110)
                   R22 =  V1 = 1,                                                                                                                                    (18.111)
                   R23 =  V3 I1=0,I2=0                                                                                                                               (18.112)
                   R31 =  V1 = R2,                                                                                                                                   (18.113)
                          I2 I1=0,V3=0
                          V2 = R2,
                          I2 I1=0,V3=0
                          V2 = 0,
                          V3 I1=0,I2=0
                          I3 = 1,
                          I1 I2=0,V3=0

                   R32 =    I3 = 0,                                                                                                                                  (18.114)
                   R33 =    I2 I1=0,V3=0                                                                                                                             (18.115)
                            I3 = 0.
                            V3 I1=0,I2=0                                                                                                                             (18.116)

Hence, we obtain:

                            R1 + R2 R2 1                                                                                                    

                   R =  R2 R2 0  .

                            1                                                                                                           00
                                     18.5. DETERMINATION OF POLES AND ZEROS 563

This result corresponds to (18.94).

   As stated earlier, loops of capacitors and/or capacitors with voltage sources,  19 Poles at infinity.

and cut sets of inductors and/or inductors with current sources, result in         20 Stephen B. Haley. The Generalized
eigenvalues with zero value.19 Due to numerical rounding effects, these            Eigenproblem: Pole-Zero Computation.
                                                                                   Proceedings of the IEEE, 76(2):103-120,
poles will appear at finite frequencies rather than at infinity. However, in       February 1988

most cases, these frequencies will be outside the frequency range of interest,

and can easily be separated from the desired ones, and ignored. Accord-
ing to Haley [Haley1988]20, the method is robust if the number of capacitor

loops and inductor cut sets is relatively low with respect to the number of

capacitors and inductors.

18.5.3 Symbolic estimation of poles and zeros

During the design of the frequency response of electronic circuits, designers
often need to manipulate poles and zeros into their desired positions. To
do so, the designer needs to know which network elements determine the
positions of specific poles and zeros. One method for this is to perform a
numeric sensitivity analysis. If the value of a specific pole or zero depends
on a component value, then the value of that pole or zero can be changed
with that component. This requires analyses of the influence of the values of
all the components that constitute the elements of the time-constant matrix.
This approach may be used for computer analysis, but it is not suited for
quick hand estimations.

   In this section, we will demonstrate the way in which poles and zeros of
a network can be estimated. Limitations of the presented technique will also
be shown.

Number of poles

The number of poles of a network equals the sum of the number of indepen-
dent capacitor voltages and the number of independent inductor currents.

1. The number of independent capacitor voltages equals the number of ca-           21 Coupling factor k = 1.
   pacitors minus the number of loops of capacitors or loops of capacitors
   and voltage sources.

2. The number of independent inductor currents equals the number of in-
   ductors minus the number of cut sets of inductors or cut sets of inductors
   and current sources.

3. In networks with controlled sources, there is no straightforward way to
   determine the number of poles:

   The presence of feedback across controlled sources may effectively add or
   remove loops of controlled voltage sources and capacitors, or cut sets of
   controlled current sources and inductors. If there are no feedback loops
   involving controlled sources, then these sources can be treated as indepen-
   dent sources.

4. In networks with ideally coupled inductors21:
       The number of independent inductor currents is reduced by the number

   of unity coupling factors;
       The number of independent capacitor voltages is reduced by one for

   each capacitor driven from voltage-driven, ideally coupled inductors.

Some situations sketched above will be elucidated in the next example.
564 NETWORK THEORY (SELECTED TOPICS)

   (1)  (2)                                    Example 18.13

+                                                 Figure 18.36A shows a circuit with two coupled inductors.
                                                  One of the coupled inductors is driven by an ideal voltage source, while the
-                                              other is connected to a capacitor C.
                                                  If k = 1, the number of independent inductor currents is 1, and there exists a
Figure 18.36: Two coupled inductors,           loop of a controlled voltage source and a capacitor. This can be seen from the equiv-
driven from a voltage source and termi-        alent circuit shown in Figure 18.36B. Having k = 1, the inductance 1 - k2 Lp
nated with a capacitor. If k < 1, the circuit  in series with the voltage source Vs becomes zero. As a consequence,. the current
has three poles. If k = 1, the number of       feedback  cannot affect the driving impedance for C, which makes C driven from
poles reduces to one.                          a voltage source.
                                                  This can also be seen by evaluating the determinant  of the MNA matrix.
                                               The MNA matrix equations for this circuit is

                                                0  0 0 1 1                                 
                                                                                    0        V1

                                                0   0 sC 0       0                  1       V2 

                                                                                           
                                                 Vs  =  1  0  0    0                0     ·  IVs  .  (18.117)
                                                                 -sLp                             
                                                                                    -sk LpLs   ILp 
                                                0  1 0 0

                                                 0      0 1 0 -sk LpLs              -sLs     ILs

                                                 The determinant  can be found as:

                                                               = s3CLpLs k2 - 1 - Lps.               (18.118)

                                                  Hence, the order of the circuit is 3 for k < 1 and 1 for k = 1.
                                                  This example also shows the effect of a controlled source on the number of
                                               independent capacitor voltages. Although Figure 18.36B shows a loop of a con-
                                               trolled voltage source and the capacitor C, this loop does not reduce the number
                                               of independent capacitor voltages if k < 1. This is due to the current feedback
                                               with the current-controlled current source. This feedback creates a nonzero drive
                                               impedance for C. Hence, due to this feedback, the voltage across C is an indepen-
                                               dent capacitor voltage.

     Independent cut sets of                   Number of zero-frequency poles
     capacitor(s) and current source(s)
                                               The number of poles at zero frequency equals the number of independent cut
        +                                      sets of capacitors and independent cut sets of capacitors and current sources,
       -                                       plus the number of independent loops of inductors and independent loops
     Independent loops of inductor(s)          of inductors and voltage sources.
     and voltage source(s)
Figure 18.37: Circuit that has two in-            The number of independent loops of certain types of elements is equal to
dependent capacitor voltages and two           the minimum number of branches with these elements, which needs to be
independent inductor currents. Hence it        removed to break all the loops.
has four poles. Since it has one loop of
inductors and voltage sources and one cut         The number of independent cut sets of certain types of elements is equal
set of capacitors and current sources, two     to the minimum number of branches that have to be added to connect all the
of the four poles have zero frequency.         sub-networks, that were disconnected from each other, after all branches that
                                               were part of a cut set were removed.

                                                  Example 18.14

                                                      The circuit depicted in Figure 18.37 has two capacitors and two inductors. All
                                                  capacitor voltages and inductor currents are independent., so the circuit has four
                                                  poles. There exists one cut set of capacitors and current sources and one loop of
                                                  inductors and voltage sources. Hence, two of the four poles have zero frequency.

                                                  Note that feedback loops that include controlled sources may also affect
                                               the number of zero-frequency poles.
                                    18.5. DETERMINATION OF POLES AND ZEROS 565

Estimation of pole positions for circuits without feedback

Now that we know the total number of poles and the number of zero-frequency
poles, we will discuss a method for finding symbolic expressions for the fi-
nite nonzero poles of a network. In order to provide design information,
these expressions must be easy to interpret, in other words, they must be
relatively simple. Simple expressions are obtained if there is no charge ex-
change between capacitors, flux exchange between inductors and charge and
flux exchange between capacitors and inductors. For circuits with controlled
sources, an extra requirement is the absence of negative feedback. In these
cases, the time-constant matrix comprises only diagonal elements that are the
eigenvalues of the matrix.

Example 18.15
   We will estimate the poles of the circuit shown in Figure 18.38.

                                                                                     Figure 18.38: Example of a circuit with no
                                                                                     charge exchange between capacitors.

+               ++

-               --

   The unilateral transfer of the controlled sources prevents charge exchange be-
tween the capacitors. As a consequence, the time-constant matrix T of this circuit
comprises nonzero diagonal elements only:

       R1C1            0          0                                  (18.119)
T = 0           (R2 + R3) C2      0 .

             0         0       R4 R5

                              R4+R5 C3

   This time-constant matrix is the product of the resistance matrix R and the
capacitance matrix C. The resistance matrix can easily be found from network
inspection, as discussed in section 18.5.2.

   The poles of the circuit are the negative reciprocal values of the diagonal ele-
ments of T :

   p1 = - 1 [rad/s],                                                 (18.120)
             R1C1                                                    (18.121)
                                                                     (18.122)
   p2 = - 1 (R [rad/s], 2 + R3) C2
   p3 = - R4 + R5 [rad/s].

             R4 R5 C3

   If the exchange of charge, flux or charge and flux is limited between pairs
of components, the situation becomes more difficult, but it many cases, use-
ful symbolic approximations for the poles can still be found. This will be
illustrated with the aid of the circuit from Figure 18.39.

   The circuit from Figure 18.39A has two capacitors whose voltages are in-
dependent. Hence, the circuit has two poles. Since there exists one cut set of
capacitors, one of the poles has zero frequency.

   The second pole can be found as follows:

1. Replace the largest capacitor with a short and find the second pole from
   the time constant R1C2 as shown in Figure 18.39B1. In this case, this is
   sufficiently accurate if C1  C2.

2. Replace the two capacitors by their series connection and find the second
   pole from the time constant R1 CC1 1+CC22 as shown in Figure 18.39B2.
566 NETWORK THEORY (SELECTED TOPICS)                                       cut set of  B

Figure 18.39: Circuit with two poles. Since                                capacitors
there exists a cut set of capacitors, it has
one zero-frequency pole.                                                               C

                                                                     A

                                             Since the circuit has no DC solution, the time-constant matrix is not de-
                                          fined and cannot be of any help for finding the poles.

                                          First order approximation for finite nonzero poles

                                          For symbolic analysis of the poles of a network that has a DC solution, we use
                                          a procedure based on the evaluation and interpretation of the time-constant
                                          matrix, as illustrated in Figure 18.32. Consider hereto the network of Figure
                                          18.40A.

                        A                                               B                 C

Figure 18.40: Circuit with two poles and  The procedure applied to this network is as follows:
interaction between capacitor voltages.

                                          1. Find the largest time constant in the circuit, by evaluating the DC port
                                             resistances for the capacitors and the DC port conductances for the induc-
                                             tors. The dominant pole is determined by this time constant.

                                             For the given circuit, the DC port resistance for C1 is R1 + R2. The DC
                                             port resistance for C2 is R2. The largest time constant of the circuit is
                                             C1 (R1 + R2); the dominant pole p1 is thus found from the equivalent cir-
                                             cuit shown Figure 18.40A:

                                                                           p1 = - 1 C [rad/s]. 1 (R1 + R2)  (18.123)

                                          2. Now, short the port with the capacitor that caused the largest time con-
                                             stant.

                                             This is justified because, at frequencies above the frequency of the domi-
                                             nant pole, the capacitor impedance is lower than the DC port impedance.
                                             Thus, above the frequency of the dominant pole, the capacitor that deter-
                                             mines the dominant pole acts as a short for its driving resistance.

                                          3. Similarly, if an inductor was connected to this port, leave the port open.

                                          4. Now find the largest time constant of the modified circuit.

                                             With C1 shorted, we obtain the circuit according to Figure 18.40C, and thus
                                             obtain the second pole p2 as

                                                                                       p2 = - R1 + R2 .     (18.124)
                                                                                                 C2 R1 R2
                                                                              18.5. DETERMINATION OF POLES AND ZEROS 567

   The above presented method only gives exact results if there is no ex-
change of charge and/or flux between capacitors and/or inductors.

Second order approximation for finite nonzero poles

For second order systems, a more accurate solution is obtained by using all                 22 Stephen B. Haley and Paul J. Hurst. Pole
                                                                                            and Zero Estimation in Linear Circuits.
elements of the circuit's time-constant matrix. According to Haley and Hurst                IEEE Transactions on Circuits and Systems,
                                                                                            36(6):838-845, June 1989
[Haley1989]22, the sum of the eigenvalues of the time-constant matrix equals                23 The trace of a matrix is the sum of the
                                                                                            diagonal elements of a matrix.
its first order trace T1, and the sum of the mutual products of the eigenvalues             24 The second-order trace of a matrix is the
                                   T .23,24                                                 sum of the determinants of all 2 × 2 sub-
equals  its  second  order  trace            For  a  second  order  system  this  yields    matrices, that can be formed by intersecting
                                     2                                                      any two rows of a matrix with the same
                                                                                            two columns.
                                   1 + 1 = -T1,                                   (18.125)
                                   p1 p2                                          (18.126)  25 Alternatively, the time-constant matrix
                                                                                            can be found from network inspection.
                                         1 = T2.
                                       p1 p2                                                26 : in parallel with.

   We will demonstrate this for the circuit from Figure 18.40A. For this circuit,
we have

G=              1           , C = C1 0 0 C2 , I = 1 0 -1 1 .                      (18.127)

                R1 0

                         1

                0 R2

Hence, according to its definition, the time-constant matrix is found as25

        T = I T · G-1 · I · C = C1 (R1 + R2) -C2R2 -C1R2 C2R2 .                   (18.128)

From the first order trace, we find the sum of the eigenvalues:

                            1 + 2 = C1 (R1 + R2) + C2R2.                          (18.129)

From the second order trace, we find the product of the eigenvalues:

                     12 = C1C2 (R1 + R2) R2 - C1C2R22,                            (18.130)
                           = C1C2R1R2.                                            (18.131)

   If the two poles are well separated: p1  p2, the sum of the eigenvalues is
dominated by the largest. We then obtain the dominant pole p1 as

                     p1 = - 1 = - 1 . 1 C1 (R1 + R2) + C2R2                       (18.132)

With R1  R2, this can be simplified to

                            p1 = - 1 (C . 1 + C2) R2                              (18.133)

The non-dominant pole is then found from the product p1 p2 and the dom-

inant pole p1:       p2 = p1 p2 = - C1 (R1 + R2) + C2R2 .

                            p1                    C1 C2 R1 R2                     (18.134)

   An overview of the numeric and symbolic results is given in Table 18.1.
The most accurate numeric values are those found from the eigenvalues of
the time-constant matrix.

   The first order approximation for this circuit has an inaccuracy of about
10%. However, it provides symbolic results that can be interpreted clearly:

· The dominant pole is predominantly caused by26: C1 (R1 + R2).
· The non-dominant pole is predominantly caused by: C2 R1 R2.

Such simple expressions are useful during design.
568 NETWORK THEORY (SELECTED TOPICS)

                                                 The second order approach still gives relatively simple expressions, but,
                                              compared to the first order approximation, the poles cannot be calculated
                                              from parallel connections of a an equivalent resistor and capacitor. The accu-
                                              racy of the second order approximation, however, is much better.

                                                 Exact symbolic expressions for the eigenvalues of the time-constant ma-
                                              trix can be found for first, second and third order networks. However, the
                                              complexity of those expressions often decreases their usefulness for deriving
                                              design conclusions. For this reason, exact symbolic expressions for the poles
                                              are not listed in Table 18.1.

   Eigenvalues(T) First order approximation Second order approximation

   numeric                                    symbolic numeric               symbolic                numeric

   p1 -873 × 103                              -1                 -954 × 103  - 1 C1(R1+R2)+C2 R2     -870 × 103
   p2 -230 × 106                                                 -210 × 106                          -230 × 106
                                                 C1 ( R1 + R2 )                 C1(R1+R2)+C2 R2
                                                  R1 + R2
                                                                             - C1C2 R1 R2
                                              - C2 R1 R2

Table 18.1: Poles of the circuit from Figure  LCR resonators
18.40A in [rad/s], according to different
calculation methods.

                                              In passive circuits and in circuits with controlled sources that are not part of a
                                              feedback loop, only interaction between capacitors and inductors may result
                                              in complex pole pairs. If so, one speaks of resonance. Figure 18.41 shows
                                              four passive second order LCR networks in which resonance may occur. The
                                              general representation of the characteristic equation  of these networks is

                                                                             2 0                  2
                                                                              = s + s + 0,                       (18.135)
                                                                                       Q

                                              in which 0 is the resonance frequency and Q the quality factor. This factor
                                              is a measure for the losses that occur during exchange of energy between the

                                              capacitor and the inductor:

                                                                 Q = 2 Energy stored in the resonator .          (18.136)
                                                                                Energy losses per cycle

A                 B                                              C                        D

Figure 18.41: Second-order LCR networks.      Expression (18.135) can alternatively be written as

                                                                              = s2 - s (p1 + p2) - p1 p2.

                                                 The poles p1 and p2 of these second order LCR resonators can thus be
                                              found from their product and their sum:

                                                                                p1 p2 = 02,                      (18.137)
                                                                             p1 + p2 = - 0 .                     (18.138)

                                                                                              Q

                                                 Table 18.2 gives the product and the sum of the poles, as well as the reso-
                                              nance frequency and the quality factor for the networks from Figure.18.41.
                                                  18.5. DETERMINATION OF POLES AND ZEROS 569

               Figure 18.41A Figure 18.41B Figure 18.41C                               Figure 18.41D

      p1 p2     1            1                   1 Rp+Rs                                1 Rp
               LC           LC                  LC Rp                                  LC Rp+Rs

      p1 + p2  - Rs         - Rp1C              - 1 - Rs                               - 1 C(Rp+Rs) - Rp Rs L(Rp+Rs)

                   L                               RpC L

   2  0        1                1                 1;  Rp      Rs                          1;  Rp      Rs
               LC              LC
                                                  LC                                      LC

      Q        1 L = Qs     Rp     C  =  Qp      1 1 1 ; Rp  Rs  1 1 1 ; Rp  Rs
               s                   L              Qs + Qp                                 Qs + Qp
               RC

Estimation of pole positions for circuits with feedback                                Table 18.2: Product of the poles, sum of
                                                                                       the poles, resonance frequency and quality
Feedback in circuits that comprise controlled sources can have a significant           factor for the circuits from Figure 18.41
influence on the position of the poles. In section 11.4 we will discuss a graph-
ical method for determination of the poles in a feedback circuit.

Estimation of zeros

We have seen that determination of the poles of a network, does not require
the definition of a source-to-load transfer. As a matter of fact, the poles of
the network are found from the solution of the set of homogeneous differen-
tial equations that describe the network. For determination of the poles, all
independent sources have been set to zero: all current sources become open
circuits and voltage sources short circuits.

   This differs for the determination of the zeros: this requires the definition
of a source and a detector. Zeros appear at the complex frequencies for which
the transfer from the source to the detector equals zero. The physical causes
for zero transfer can be:

1. At some complex frequency, there exists an open circuit in series with the
   signal path.

      Example 18.16

   +               +        +                +             +                           +              +               +

   -               -        -                -             -                           -              -               -

A                        B                            C                                            D

(a) Let us consider the transfer from Vs to V for the circuit from Figure 18.42A.      Figure 18.42: At some complex frequency,
   If, at some complex frequency, the current through R1 is cancelled by an op-        an open circuit in series with the signal
   posite current through C1, no signal transfer is possible through the parallel      path causes a zero.
   connection of R1 and C1. This occurs if both branches have opposite conduc-
   tance: sC1 = - R11 , hence at a complex frequency s = - R 11C1 . This is the
   frequency of a zero.

(b) For the circuit from Figure 18.42B, this situation occurs if sL11 = - R11 , or if
   s = - RL11 .
570 NETWORK THEORY (SELECTED TOPICS)

                                                    (c) For the circuit from Figure 18.42C, no transfer is possible for s = 0. A
                                                          capacitor in series with the signal path causes a zero-frequency zero.

                                                      (d) The circuit from Figure 18.42D has a parallel resonance circuit in series with
                                                       the signal path. Here, signal transfer becomes zero if R11 + sL11 + sC1 = 0.
                                                          This results in two zeros, z1 and z2. They can be found from their product,
                                                       z1z2 = L 11C1 and their sum, z1 + z2 = -R1C1. The two zeros are complex
                                                          conjugated if the quality factor of the parallel resonator exceeds 0.5.

                                                  2. At some complex frequency, there exists a short in parallel with the signal
                                                      path.
                                                     Example 18.17

                                                                  +

       +                                        +

    +                        +                                 +
    -                     -
       -                                              +  +     -
A                      B
                                                -     -  -        -

                                                   C        D

Figure 18.43: At some complex frequency, a      (a) Let us now consider the transfer from Vs to V for the circuit from Figure
short circuit in parallel with the signal path     18.43A. If, at some complex frequency, the series connection of R2 and C1
causes a zero.                                     becomes a short; V will then be zero. This occurs if sC11 = -R2. Hence, a zero
                                                   is thus found at s = - R 12C1

                                                (b) Similarly, the circuit from Figure 18.43B has a zero at s = - RL21 .
                                                (c) The circuit from Figure 18.43C has a zero-frequency zero, caused by the in-

                                                   ductor in parallel with the signal path.

                                                (d) The circuit from Figure 18.43D has a series resonance circuit in parallel with
                                                   the signal path. Here, signal transfer becomes zero if R2 + sC11 + sL1 = 0.
                                                   This results in two zeros, z1 and z2. They can be found from their product,
                                                   z1z2 = L 11C1 and their sum, z1 + z2 = - RL12 . The two zeros are complex
                                                   conjugated if the quality factor of the series resonator exceeds 0.5.

                                                3. At some complex frequency, multi-path source-load transfers cancel each
                                                   other out.

                                                      Example 18.18

                                                       Figure 18.44 shows a dual-path input-output transfer. Both paths have their
                                                       frequency-dependent transfer modeled by a ratio of two polynomials of the
                                                       Laplace variable s. The two transfers cancel each other out if D1(s) N1(s) = - D2(s) N2(s) .
                                                       The zeros are the solutions for s of this equation.

                                                4. If a pole of a network cannot be observed in a specific transfer, then a zero
                                                   cancels out that pole.

                                                      Example 18.19
                                                                                               18.6. TWO-PORTS 571

                                                                                  Figure 18.44: Zeros due to multiple trans-
                                                                                  mission paths.

input                              output

Consider the circuit from Figure 18.45. Let us estimate the poles and zeros of                                                            (1)
the transfer from I1 to V1. The poles of the circuit can easily be found from
network inspection. The circuit has one independent inductor current and one      Figure 18.45: Circuit for estimating poles
independent capacitor voltage. Hence, it has two poles. There exists no loop      and zeros of the transfer VI11 .
of inductors (or of inductors and voltage sources) and no cut sets of capacitors
(or capacitors and current sources). So, we have no poles in the origin.

With the aid of the time-constant method we find two time-constants 1 =
R1C1 and 2 = RL2 , and since there is no exchange of energy between the
inductor and the capacitor, we have two real poles: p1 = - 11 and p2 = - 12 .

At zero frequency, L1 shorts the output so we have a zero z1 = 0.

Let us now consider the transfer for I1 to V1. The current I1 flows through the
parallel connection of L and R2 and circuit analysis yields

             V1 =  sL                      (18.139)
                       L.
             I1 1 + s R2

From this expression, we clearly see one pole and the zero in the origin. The

pole caused by C is not observable in this transfer. So, the transfer from I1
to V1 has two poles and two zeros. One of the zeros cancels out one of the
poles and makes it non-observable in the transfer function (18.139). A proper

expression for the transfer would be

       V1 =     sL(1 + sR1C) .             (18.140)
       I1    1 + s RL2 (1 + sR1C)

18.6 Two-ports

In many engineering situations, it is convenient to model an electrical net-
work as a two-port. In those cases, the port quantities (voltage and current)
of one port are related to the port quantities of the other port, and the elec-
trical behavior of the two-port is described with the aid of a 2 × 2 matrix.

   As is shown in the nodal analysis, a four-terminal network requires at
least a 3 × 3 matrix description, thus a two-port description can only be com-
plete under additional constraints. These constraints are called the two-port
constraints. They require that the current that flows into one port terminal
equals the current flowing out of the corresponding port terminal, and a
voltage placed between one of the input port terminals and one of the output
port terminals does not cause a change in the port voltages and currents.

   The two-port constraints are always valid if both ports are terminated with
one-ports, or if the four-terminal network is a natural two-port. Ideal trans-
formers and gyrators, as well as the controlled sources are examples of nat-
572 NETWORK THEORY (SELECTED TOPICS)

                                                  ural two-ports. A formal derivation of the two-port conditions will be given
                                                  in section 18.6.1.

                                                      With input and output port voltages and currents as port variables, there
                                                  are six different combinations of dependent and independent port variables,
                                                  resulting in six different two-port models. The choice of an appropriate two-
                                                  port model strongly depends on the effect one wishes to study. In section
                                                  18.6.2, we will present the different representation methods. Finally, im-
                                                  portant classes of two-ports and their characteristic properties are listed in
                                                  section 18.6.3.

27 The two-port conditions are the condi-      18.6.1 Two-port conditions
tions that should apply to a four-terminal
network, such that its two-port equations      We will now formally derive the two-port conditions.27 To this end, we will
correctly describe its behavior, for any       set up the Y parameter representation of the four terminal network from
external network.                              Figure 18.46A. We will then define the differential-mode and common-mode
                                               port quantities and relate them to the nodal voltages and currents. This is
                                               illustrated in Figure 18.46B. Since the two-port model only describes rela-
                                               tions between the differential-mode quantities, we then find the conditions
                                               under which the two-port model correctly describes the behavior of the four-
                                               terminal network.

(1) + + (3)                                                                      (1) (3)
                                                                                                               +    +
             (2)
                         --

                                                                                                           (2) - -

(A)                                                                              (B)

Figure 18.46: Two four-terminal network        The four terminal network can be characterized by its Y parameters:
representations:
                                                                                                                
    (A) Four-terminal network with nodal                                  I1          Y11 Y12 Y13                   V1
voltages and currents.
                                                                      I2  =  Y21 Y22 Y23  ·  V2  ,                                 (18.141)
    (B) Nodal voltages and currents decom-
posed into common-mode and differential-                                  I3          Y31 Y32 Y33                   V3
mode quantities. The differential-mode
quantities are the two-port variables.         denoted in short as

28 This is not essential: two-port conditions                                             I = Y · V.                               (18.142)
for a floating output port are similar to
those for a floating input port.               In order to describe it as a two-port, we need to select the port variables.

                                               Since here the output port is connected to the ground28, we select Vo = V3

                                               and Io = I3. Nodes 1 and 2 constitute the input port. The input port vari-

                                               ables become the differential-mode port voltage and the differential-mode
                                                                                                  1
                                               port current, Vi      =  V1 - V2  and      Ii  =   2  ( I1  -  I2),  respectively.  The common-

                                               mode input port voltage and the common-mode input port current are de-
                                                                  1
                                               fined  as:  Vc  =  2  (V1  + V2)  and  Ic  =   I1  +  I2,   respectively.  These    definitions  are

                                               illustrated in Figure 18.46B.

                                               The differential-mode port and common-mode currents can be expressed

                                               in the nodal currents with the aid of a base transformation matrix A:

                                                                                                     
                                                                                     Ii                  I1

                                                                                  Ic  = A·  I2  ,                                  (18.143)

                                                                                      Io                   I3
                                                                                                  18.6. TWO-PORTS 573

where:                              1 1 
                                        2 -2 0
                                                                                    (18.144)
                              A =  1 1 0 .
                                         001

    Equation (18.142) can now be written in the form:

                                                                                    (18.145)
                                      Ii

                                   Ic  = A · Y · V.

                                      Io

   Similarly, we may obtain the nodal voltages from the differential-mode
port voltages from the nodal voltages as

                                                                                    (18.146)
                                                   Vi

                                  V = AT ·  Vc  .
                                                   Vo

    Substitution of this result in (18.145) yields the modified network equation:

                                                     
                              Ii                         Vi
                  Ic  = A · Y · AT  Vc  .
                                                                                    (18.147)

                              Io                         Vo

    Since matrix multiplication is associative, we may write

                                               
                                  Ii                 Vi
                         Ic  = Y ·  Vic  ,
                                                                                    (18.148)

                                  Io                 Vo

where:                                Y = A · Y · AT.

                                                                                    (18.149)

    In this way we obtain Y as

           41 Y11 - 41 Y12 - 41 Y21 + 14 Y22  21 Y11 + 21 Y12 - 12 Y21 - 21 Y22  1       1
Y =        21 Y11 - 21 Y12 + 21 Y21 - 12 Y22     Y11 + Y12 + Y21 + Y22            2 Y13 - 2 Y23
                                                        Y31 + Y32                   Y13 + Y23  .
                    21 Y31 - 21 Y32
                                                                                    Y33

    The coefficients of Y have the following meaning:                               (18.150)

1.  Y :    Differential-mode  input   admittance.

      1,1

2.  Y :    Common-mode  input         voltage  into  differential-mode  input       current

      1,2
    conversion.

3.  Y :    Differential-mode  reverse  transadmittance.

      1,3

4.  Y :    Differential-mode input voltage into common-mode input current

      2,1
    conversion.

5.  Y :    Common-mode  input         admittance.

      2,2

6.  Y :    Differential-mode output voltage into common-mode input current

      2,3
    conversion.

7.  Y :    Differential-mode  transadmittance.

      3,1

8.  Y :    Differential-mode output voltage into common-mode input current

      3,2
    conversion.

9.  Y :    Differential-mode  output   admittance.

      3,3
574 NETWORK THEORY (SELECTED TOPICS)

                                             Equation ( 18.150) can be reduced to a two-port equation, if the port

                                             voltages Vi, Vc and Vo do not cause any common-mode current Ic, and if

                                             the common-mode voltage Vc across the two-port does not affect the port
                                                                                                               Y ,    Y ,    Y ,    Y
                                             currents    Ii  and  Io .  These  conditions  are  satisfied  if                              and
                                                                                                                 1,2    2,1    2,2    2,3
                                             Y
                                                    are  zero.
                                               3,2
                                             This yields the following set of equations:

                                                                        1 Y11 + 1 Y12 - 1 Y21 - 1 Y22 = 0                           (18.151)
                                                                        2      2           2    2
                                                                                                                                    (18.152)
                                                                        1 Y11 - 1 Y12 + 1 Y21 - 1 Y22 = 0                           (18.153)
                                                                        2      2           2    2                                   (18.154)
                                                                                                                                    (18.155)
                                                                               Y11 + Y12 + Y21 + Y22 = 0

                                                                                                Y13 + Y23 = 0

                                                                                                Y31 + Y32 = 0

                                             The solution of this set of equations is:

                                             Y11 = Y22, Y12 = Y21, Y21 = -Y22, Y13 = -Y23 and Y31 = -Y32. (18.156)

Figure 18.47: Four terminal element that

satisfies the two-port conditions for arbi-

trary port connections. Such a circuit is                    +                                                        +

referred to as a natural two-port.

                                                             -                                                        -

                                                Four-terminal networks that satisfy these conditions are called natural two-
                                             ports. Figure 18.47 shows such a network. When it is modeled as a four-
                                             terminal network according to Figure 18.46A, it satisfies the above conditions:

                                                                        Yi = Y11 = Y22 = -Y12 = -Y21,                               (18.157)
                                                                        Yo = Y33,                                                   (18.158)
                                                                        Yr = -Y13 = Y23,                                            (18.159)
                                                                        Yf = Y31 = -Y32.                                            (18.160)

                                             18.6.2 Two-port representations

                                             Linear four-terminal elements are often modeled as two-ports, one pair of
                                             terminals is considered as input port, while the other pair is considered as
                                             output port. Two-ports are then represented by matrices having only four
                                             coefficients. To do so, we select two independent variables from the four port
                                             quantities. In this way we obtain six different representation methods:

                                             1. Z-matrix, or current-controlled representation:                                     (18.161)
                                                                                     Vi Vo = Z· IiIo .

                                             2. Y-matrix, or voltage-controlled representation:                                     (18.162)
                                                                                     IiIo = Y· Vi Vo .

                                             3. Hybrid-1 matrix, or current-controlled input and voltage-controlled out-
                                                                                  18.6. TWO-PORTS 575

put representation:

                      ViIo = H· Ii Vo .                 (18.163)

4. Hybrid-2 matrix, or voltage-controlled input and current-controlled out-

put representation:

                      Ii Vo = H · ViIo .                (18.164)

5. Transmission-1 matrix, or anti causal representation (the positive direction
   of the output current is opposite):

                      ViIi = T· Vo -Io .                (18.165)

6. Transmission-2 matrix representation (the positive direction of the output
   current is opposite):

                      Vo Io = T · Vi -Ii .              (18.166)

   Although these six representation methods are fully equivalent, in a par-
ticular situation, one specific representation can give more insight and reduce
calculations considerably. If, for example, two-ports are connected in parallel,
the Y parameters of the combination are easily found by adding the individ-
ual Y matrices. If, in another situation, the inputs are connected in series and
the outputs are connected in parallel, the hybrid 1 representation is conve-
nient. In situations in which two-ports are cascaded, the transmission-1 ma-
trix representation is convenient: the transmission-1 matrix of the cascaded
two-ports is the product of the transmission-1 matrices of the individual two-
ports.

   For design purposes, we will often use the anti-causal transmission-1 ma-
trix representation (T representation). It will be shown that this representa-
tion is very convenient for deriving design strategies for amplifiers. As we
have seen, nodal analysis uses the admittance Y representation.

   Table 18.3 gives the relations between the two-port parameters of the six
representations.

18.6.3 Two-port properties

Linear two-ports

A two-port is linear if both the properties of superposition and homogeneity
hold:

1. The response to two excitations is equal to the sum of the responses to the
   individual excitations.

2. The response to an enlarged excitation is equal to the equally enlarged
   response to the excitation.

   This means that a two-port is linear if it consists of linear elements only
and apart from the excitations, it has no independent sources.

Reciprocal two-ports

A reciprocal two-port is a two-port from which the input port and the output

port can be interchanged without affecting the network solution. This is the

case if

         z12 = z21, y12 = y21, det(T) = 1, h12 = -h21.  (18.167)
576 NETWORK THEORY (SELECTED TOPICS)

        Z                                  Y                T                     T                       H                      H

Z z11 z12              y22                       y12     t11 T               t        1        H             h21       h - h1        h
          z21 z22      Y                                 t21 t21                     t
                        y21                   - Y         1 t22               22                                                      12
                                                         t21 t21                      21
                     - Y                        y11      t22 T               t                 h22           h22       h  11        H  11
                                                Y        t12 t12                     t         - h21 1
                                                          1 t11               21               h22 h22                    21           
                                                         t12 t12                      11                               h            h
                                                                             T                                            11         11
                                                                                     t
                                                                               
                                                                                      21
                                                                             t
                                                                                         1
                                                                              21
                                                                                     - t
   z22     z12                                                            t11                  1 - h12                    H          h 12
   Z - Z             y11 y12                                                               12
Y                    y21 y22                                              t12                  h11           h11          h  22      h 22
                                                                                       t                                     h
   z21     z11                                                             T                   h21           H
   - Z Z                                                                                 22                                   12       1
                                                                          -                    h11           h11       - h h
                                                                                       t
                                                                             t12                                              22       22
                                                                                         12
   z11 Z             - y21 y22                     1     t11 t12             t                 - h21 H       - hh1121     h h
   z21 z21           - y21 Y                             t21 t22                     t         - h22
T  1 z22                                      - y21                           22                                  1         11 12
                                              - y21 y11                               12          h21
   z21 z21                                                                   T                               - h21        h h
                                                                             t       T
                                                                                     t                                      21 22
                                                                              21
                                                                                      11
                                                                             T
                                                                                     T
                                                                               
                                                                                       

   z22 Z             - y12 y11                     1     t22 t12                                               h11     -  H          h
                     - y12 Y                             T T                 t t                  1            h12            
                                              - y12      t21 t11                                 h12                              - 22
T  z12 z12                                    - y12 y22  T T                  11 12                          - h12 H      h12
   1 z11                                                                                       - hh22 12                  h          h
   z12 z12                                                                   t t                                       - 11
                                                                                                                          h  12         12
                                                                              21 22
                                                                                                                                     1
   Z       z12       1 - y12                             t12  T              t       1         h11 h12                    h         h
                                                                                               h21 h22
                                                                              12                                           22         12
                                                                             t       t
H  z22     z22       y11                      y11        t22  t22             11      11                                  H       h
   z21 1             y21                      Y          - t22 1 t22 t21      T t                                         h
   - z22 z22                                                              -  21                                                     12
                     y11                      y11                             t t                                          21
                                                                                11   11                                           H
                                                                                                                          H       h

                                                                                                                                    11

                                                                                                                                  H

                                                                                                                                     

    z11 1 - z11 z12  Y                        y12        t11 t21 - t11 T  t21            1       h22            h12       h h
                                                                                                 H
H                    y22                      y22                         t22        - t                     - H            11 12
                     - y21 1                                                                      h21
   z21     Z                                             1    t12         -T               22                  h11        h h
                                                                                               - H             H
   z11     z11                             y22 y22       t11  t11                      t                                    21 22
                                                                             t12
                                                                                         12

                                                                                       t

                                                                                         22

Table 18.3: Two-port transformations: all        Any linear two-port without controlled sources is reciprocal.
matrices in the same row are equal.              An amplifier generally needs to have a large gain from input to output
                                              and a negligible gain from output to input. Hence, in amplifier design, one
    X = x11 x22 - x12 x21                     tries to minimize the reciprocity.

                                              Unilateral two-ports

                                              Unilateral behavior means that any change of the port termination at one
                                              port cannot be noticed at the other port. The input impedance of a unilateral
                                              two-port does not depend on the load impedance, and vice versa. This is
                                              often a desirable property of amplifiers: unilateral amplifiers have no reverse
                                              transfer. A unilateral two-port has

                                                                                        det (T) = 0.                                        (18.168)

                                              Nonenergic two-ports

                                              A two-port is called nonenergic if it has no energy storage and no power
                                              dissipation. A nonenergic two-port has:

                                                                                      |det (T)| = 1.                                        (18.169)

                                              Examples of nonenergic two-ports are ideal transformers and gyrators.
                                              577

19 Noise in electronic systems

19.1 Introduction                        578

19.1.1 Thermal noise                     578

19.1.2 Shot noise                        578

19.1.3 Excess noise                      579

19.1.4 Noise temperature                 580

19.2 Noise-modeling in two-ports         580

19.3 Noise performance characterization  581

19.3.1 Signal-to-noise ratio             581

19.3.2 Dynamic range                     581

19.3.3 Noise figure                      582

19.3.4 Equivalent noise bandwidth        582
578 NOISE IN ELECTRONIC SYSTEMS

                                 19.1 Introduction

                                                  In any physical information-processing system, noise is added to the signals.
                                                  Noise is a collective noun for all undesired current and voltage fluctuations
                                                  in a circuit. Hence, DC offset voltages and currents including their tempera-
                                                  ture fluctuations, as well as uncertainty of device parameters including their
                                                  temperature dependency and ageing effects, can be regarded as noise. All of
                                                  these effects have in common that they increase the uncertainty that the cir-
                                                  cuit's current and voltage variations arise from information-carrying signals
                                                  only. In this way, all these effects limit the amount of information that can be
                                                  processed by the circuit.

                                                      In this section, we will introduce the main physical mechanisms for noise
                                                  generation and introduce noise-modeling techniques for amplifiers.

1 J.B. Johnson. Thermal agitation of elec-     19.1.1 Thermal noise
tricity in conductors. Phys. Rev., 32:97-109,
1928                                           The noise caused by the thermal movement of electrons in conductive ele-
2 H. Nyquist. Thermal agitation of electrical  ments is called thermal noise or Johnson noise. In 1928, J.B. Johnson [John-
charge in conductors. Phys. Rev., 32:110-      son1928]1 experimentally found that thermal noise variance was proportional
113, 1928                                      to the absolute temperature. His colleague at the AT&T Bell labs, H. Nyquist
                                               [Nyquist1928-1]2 explained this. At constant temperature, the generation of
                                               thermal noise is a stationary and ergodic process.

                                                  The thermal noise in resistors can be modeled by a noise voltage source
                                               Vn in series with a noise-free resistor or a noise current source In in parallel
                                               with a noise-free resistor (see Figure 19.1).

Figure 19.1: Models for noisy resistors (A     +

and B) and for a noise-free resistor (C).

                                               -                                        +

                                                  noise-free         noise-free         -

                                                  resistor           conductor

                                               A                  B                        C

                                                  These thermal noise sources have a Gaussian amplitude distribution den-
                                               sity function and a uniform or white power spectral density up to very high
                                               frequencies. The power spectral densities of Vn and In of a resistor with value
                                               R are given by:

                                                                  SVn = 4kTR  [V2/Hz],        (19.1)
                                                                  SIn = 4kTG  [A2/Hz],        (19.2)

                                               where T represents the absolute temperature in K, and k the Boltzmann con-
                                               stant: k = 1.38 · 10-23 in J/K.

                                               19.1.2 Shot noise

                                               Variations in the transport of charge carriers across a potential barrier is the

                                               cause of so-called shot noise. Currents through PN junctions have an associ-

                                               ated shot noise current. Shot noise current sources have a Gaussian distribu-

                                               tion density function and a uniform spectral density, as long as the junction

                                               transit time is small with respect to the reciprocal value of the frequency. The

                                               spectral density of a shot noise current associated with a DC junction current

                                               IJ is given by

                                                                  SIn = 2qIJ [A2/Hz],         (19.3)
                                                                                               19.1. INTRODUCTION 579

where q equals the electrical charge of the charge carrier: q = 1.6 · 10-19 C.

19.1.3 Excess noise

Fluctuations in conduction mechanisms give rise to so-called excess noise.
Excess noise is found in resistors, in electrolytic capacitors and in semicon-
ductor devices. The amplitude distribution function of excess noise sources is
Gaussian, and the spectral density is inversely proportional to the frequency.

   In resistors, the spectral density is usually modeled as proportional to the
squared voltage VR across the resistor:

                                         V2       [V2/Hz],                          (19.4)
                              SVn = K Rf

where K is a material constant.

Excess noise in resistors is usually specified in µV/V/decade: the ratio of

the RMS noise voltage vn in µV and the DC voltage VR, over a frequency
                                                                                    v2
range  of  one  decade.  The  constant  K    can  then  be  found  by     equating       with
                                                                                      n

the integral of the voltage noise spectral density over one decade:

                         10 f KV2                           [V2],                   (19.5)
                         R f  d = v2n × 10-12

from which we obtain

                         K= 2    v2n         × 10  -12      [-].                    (19.6)

                              VR ln 10

   The excess noise figure N is often specified in dB. In such cases, 1 µV/V/decade
is referred to as 0 dB. The material constant K can be derived from N as

                              K = 10 1N0 × 10-12 [-].                               (19.7)
                                          ln 10

   The 1/ f corner frequency f is the frequency at which the spectral density
of the excess noise equals that of the thermal noise:

                                 KVR2 = 4kTR.                                       (19.8)
                                   f

It follows that

                         f KV  = R2 = K PR              [Hz],                       (19.9)
                               4kTR 4kT
                                                                                                 3 Excess noise in resistors is sometimes
in which PR is the power dissipated in the resistor.3                                            called current noise.

Example 19.1

We will evaluate K and f for a low-noise metal film SMD 0402 resistor of

100 with a specified excess noise of 0.03µV/V, operating at a DC voltage of

1.5V and at a temperature T = 300K.

                                                            0.032 ×10-12            -16
With the aid of expression 19.6, we obtain K = ln 10 = 3.91 × 10 .
The power dissipation in the resistor PR equals 1.52/100 = 22.5mW. With the
                                                            0.0225×3.91×10-16

aid of expression 19.9, we obtain f = 4×1.38×10-23×300 = 531Hz.

   In semiconductors, excess noise is caused by energy traps in the depletion
layer of PN junctions or in the oxide of MOS structures. For PN junctions, it
is modeled with a noise current source In in parallel with the junction. The
580 NOISE IN ELECTRONIC SYSTEMS

                                               spectral density SIn of In is                                       [A2/Hz],                       (19.10)
                                                                                           KI

                                                                                                             J

                                                                                 SIn = f

                                               in which K and  are material constants and IJ is the DC current through the
                                               junction.

                                               19.1.4 Noise temperature

                                               The noise power of a source is sometimes defined with the aid its noise tem-
                                               perature. The noise temperature Tn is defined as

                                                                         Tn = P ,                                                                 (19.11)
                                                                                kB

4 The noise power dissipated in a load         in which P [W] is the available noise power4, B [Hz] is the total bandwidth
of which the impedance is the complex          over which the noise power is measured, and k [J/K] is the Boltzmann con-
conjugated of that of the noise source.        stant.

                                               19.2 Noise-modeling in two-ports

                                               From the four port variables (see Chapter 18.6), two can be selected as inde-
                                               pendent variables. This results in six equivalent noise models for two-ports.
                                               They are shown in Figure 19.2.

Figure 19.2: Six ways to model a noisy two-

port. The positive directions for the signs       -  +                                                                              -          +
                                                                         -                                                               +
of the port voltages (Vi, V0) and of the port  +           +     ++                                             ++              +                 +
                                                                                                                              -
currents (Ii, Io) have been indicated by

means of pus and minus signs and arrows        -           -     --                                             --              -                 -

at the port terminals, respectively.

                                               A                                                                B

                                                  -  +           +

                                               +        +     +          ++                                                  +        +              +

                                               -        -     -          --                                                  -        -              -

                                               C                                                                D

                                                  -  +

                                               +        +     +          ++                                                  +        +              +

                                               -        -     -          --                                                  -        -              -

                                               E                                                                F

                                                  In the example below, we will demonstrate the transformation of the noise
                                               representation according to Figure 19.2A into the representation from Figure
                                               19.2C.

                                                  Example 19.2

                                                      The two-port equations for the model according to Figure 19.2A are

                                                              Vi + VniA = A B                                                Vo Io .              (19.12)
                                                              Ii + IniA                                         CD

                                               We eliminate IniA from the input current vector by subtracting it from the current
                                                                    19.3. NOISE PERFORMANCE CHARACTERIZATION 581

equation (row 2):

                                Ii = CVo - IniA + DIo.                                      (19.13)

We  then  define  the  new  output  voltage   of   the  noisy  two-port  as  Vo  -    IniA  1  ,  and
                                                                                            C
write expression 19.13 as

                            Ii = C Vo - IniA 1C + DIo.                                      (19.14)

We then substitute this new output voltage into the voltage equation (row 1). This
changes the voltage equation to

                 Vi + VniA = A Vo - IniA 1C + AC IniA + BIo.                                (19.15)

After  bringing   the  voltage  A  Ini  from  the  right  side  of  (19.15)  to  the  left  side  of
                                C
this equation, we obtain the corrected input voltage:

                 Vi + VniA - AC IniA = A Vo - IniA 1C + BIo.                                (19.16)

Equations (19.14) and (19.16) are the new two-port equations:

       Vi + VniA - CA IniA = A B                            Vo - IniA C1 ,                  (19.17)
                  Ii                    CD                        Io

from which we find the equivalent noise voltage sources according to the represen-
tation in Figure 19.2C:

                                VniC = VniA - AC IniA ,                                     (19.18)
                                VnoC = -IniA 1C .                                           (19.19)

Note: if VniA and IniA are uncorrelated, then VniC and VnoC are partially corre-
lated.

19.3 Noise performance characterization

In this section, we will describe some quantities that are used for the descrip-
tion of the noise behavior of information processing systems.

19.3.1 Signal-to-noise ratio

The signal-to-noise ratio SNR, of a signal perturbed by noise is defined as
the ratio of the signal power and the noise power , and is often interpreted
as a quality measure for the signal:

                            SNR = Psignal [-],                                              (19.20)
                                       Pnoise                                               (19.21)

                       (SNR)dB = 10 log10          Psignal      [dB].
                                                   Pnoise

19.3.2 Dynamic range

A quality measure for amplifiers that is closely related to the channel capacity
is the dynamic range D of an amplifier. It is defined as the ratio of the
582 NOISE IN ELECTRONIC SYSTEMS

maximum signal power Psignal,max at which the retrieval of the information is
still possible, and the noise power Pnoise,min in absence of a signal:

                                 D = 10 log10  Psignal,max  [dB].                         (19.22)
                                               Pnoise,min

   The maximum power Psignal,max that is used in this definition differs for
each application. The Intermodulation-Free Dynamic Range I MFDR of a
low-noise RF amplifier is based on the output power level where the power of
the intermodulation components equals that of the noise. In audio amplifiers,
the dynamic range is measured at an output power for a given percentage of
total harmonic distortion.

19.3.3 Noise figure

The noise figure NF [dB] or F [-] of an amplifier tells us something about
the deterioration of the signal-to-noise ratio by the amplifier. NF and F are
defined as:

                    NF = 10 log F,                                                        (19.23)
                       F = S/N at the input of the amplifier .                            (19.24)
                              S/N at the output of the amplifier

The noise figure is usually defined at a temperature of 290K.

19.3.4 Equivalent noise bandwidth

The equivalent noise bandwidth Bn of a system with a transfer function
H(j) is defined as the bandwidth of a brickwall filter with a pass band
gain equal to the maximum magnitude of H(j), that would produce the
same output noise power as H(j):

                                 Bn = 1  H(j) 2 d [Hz].                                   (19.25)
                                        2 0 Hmax

Example 19.3

   We will evaluate the noise bandwidth of a first order low-pass filter of which
the transfer H(j) can be written as

                                 H(j) = H0 .                                              (19.26)
                                             1 + j

                                 The maximum value of |H(j)| is H0, from which we obtain

                                 Bn = 1  1 2 d                                            (19.27)
                                        2 0 1 + j
                                                                                          (19.28)
                                     = 1  2 2 1 d                                         (19.29)
                                        2 0 1 +  

                                     =1
                                        4

                                     = 2 B-3dB.

   Hence, the noise bandwidth of a first order low-pass filter is /2 times larger
than its -3dB bandwidth in Hz.
                                                                                                                                                     583

Bibliography

[AlexanderDerek1990] M. Alexander and D.F. Bowers. SPICE-compatibe Op
                 Amp Macro-Models. EDN, February, March 1990.

[Altshuller1999] Altshuller. The Innovation Algorithm, TRIZ, systematic inno-
                 vation and technical creativity, Translated by Lev Shulyak and Steven
                 Rodman. Technical Innovation Center, Inc., USA, 1999. ISBN:
                 0-9640740-4-4.

[BSIM3-1995] Cheng, Y. et al. BSIM3 Version 3.0 Manual. University of Cali-
                 fornia/Berkeley, Electronics Research Laboratory, 1995.

[BSIM4-2017] Chetan Kumar Dabhi, Shivendra Singh Parihar, Harshit
                 Agrawal, Navid Paydavosi, Tanvir Hasan Morshed, Darsen D.
                 Lu, Wenwei(Morgan)Yang, Mohan V. Dunga, Xuemei (Jane) Xi,
                 Jin He, Weidong Liu, Kanyu, M. Cao, Xiaodong Jin, Jeff J. Ou,
                 Mansun Chan, Yogesh Singh Chauhan, Ali M. Niknejad, Chen-
                 ming Hu. BSIM4 4.8.1 MOSFET Model. University of Californi-
                 a/Berkeley, 2017.

[Binkley2008] Binkley, David M. Tradeoffs and Optimization in Analog CMOS
                 Design. John Wiley & Sons Inc., 1997. ISBN: 978-0-470-03136-0.

[Black1932] H.S. Black. Wave Translation System, March 1932.

[Black1934] Harold S. Black. Stabilized feed-back amplifiers. Electrical Engi-
                 neering, 53(1):114-120, January 1934.

[Blakesley1994] T. A. Blakesley. A New Electrical Theorem. Proc. Phys. Soc.
                 London, 13:65-67, 1994.

[BlanchardEA1998] Benjamin S. Blanchard and Wolter J. Fabrycky. Systems
                 engineering and analysis. Prentice-Hall, Inc, New York, 1981.
                 ISBN: 013-135047-1.

[Bode1945] H.W. Bode. Network Analysis and Feedback Amplifier Design. Van
                 Nostrand, New York, 1945.

[Boyle1974] Boyle, et al. Macromodeling of Integrated Circuit Operational
                 Amplifiers. IEEE Journal of solid-state circuits, 9(6), December
                 1974.

[Chen1991] W.K. Chen. Active Network Analysis. World Scientific Publishing
                 Co. Pte. Ltd., Singapore, 1991. ISBN: 9971-50-912-1.

[Chua1975] Leo O. Chua and Pen-Min Lin. Computer aided analysis of elec-
                 tronic circuits. Prentice-Hall, Inc., USA, 1975. ISBN: 0-13-165415-
                 2.

[Chua1987] Charles A. Desour Leo O. Chua and Ernest S. Kuh. Linear and
                 Nonlinear Circuits. McGraw-Hill, Inc., Singapore, 1987. ISBN:
                 0-07-010898-6.

[Cross1989] Nigel Cross. Engineering Design Methods, Strategies for Product
                 Design. John Wiley & Sons Ltd., England, 1989. ISBN: 0-471-
                 94228-6.
584 BIBLIOGRAPHY

                  [DaceyRoss1952] G.C. "Dacey and I.M." Ross. Unipolar "Field-Effect" Tran-
                                   sistor. Proc. of the I.R.E, pages 970-979, August 1953.

                   [Dorf1995] Richard C. Dorf and Robert H. Bishop. Modern Control Systems.
                                   Addison-Wesley Publishing Company, Inc., USA, 1995. ISBN:
                                   0-201-84559-8.

                  [Early1952] J.M. Early. Effects of space-charge layer widening in junction
                                   transistors. Proceedings IRE, 40:1401-1406, 1952.

                  [EbersMoll1954] J.J. Ebers and J.L Moll. Large-signal behavior of junction
                                   transistors. Proceedings of the IRE, 42(12):1761-1772, 1954.

                  [EnzVittoz2006] Christian C. Enz, and Eric A. Vittoz. Charge-based MOS Tran-
                                   sistor Modeling. John Wiley & Sons Inc., 2006. ISBN: 978-0-470-
                                   85541-6.

                  [Evans1948] Walter R." "Evans. Graphical Analysis of Control Systems. Trans.
                                   AIEE, 67(1):547-551, January 1948.

                  [Evans1950] Walter R." "Evans. Control Systems Synthesis by Root Locus
                                   Method. Trans. AIEE, 69(1):66-69, January 1950.

                  [Forest1907] L. De Forest. Wireless Telegraphy, Januari 1907.

                   [Foty1997] Daniel P. Foty. MOSFET modeling with SPICE: principles and prac-
                                   tice. Prentice-Hall, Inc., USA, 1997. ISBN: 0-13-227935-5.

                   [Friis1944] H.T. Friis. Noise Figures of Radio Receivers. Proceedings of the
                                   IRE, 32:419-422, February 1944.

                  [GummelPoon1970] H. K. Gummel and H. C. Poon. An integral charge con-
                                   trol model of bipolar transistors. Bell Syst. Tech. J., 49(5):827-852,
                                   May-June 1970.

                  [HSPICE1993] HSPICE User's Manual. Campbell, California, 1993.

                  [Haley1988] Stephen B. Haley. The Generalized Eigenproblem: Pole-Zero
                                   Computation. Proceedings of the IEEE, 76(2):103-120, February
                                   1988.

                  [Haley1989] Stephen B. Haley and Paul J. Hurst. Pole and Zero Estima-
                                   tion in Linear Circuits. IEEE Transactions on Circuits and Systems,
                                   36(6):838-845, June 1989.

                  [Johnson1928] J.B. Johnson. Thermal agitation of electricity in conductors.
                                   Phys. Rev., 32:97-109, 1928.

                  [KahngDawon1960] Kahng and Dawon. Electric Field Controlled Semicon-
                                   ductor Device, May 1960.

                   [Kirk1962] C. T. Kirk. A theory of transistor cut-off frequency ( ft) falloff at
                                   high current densities. IEEE Trans. Electron Devices, ED-9(2):164-
                                   174, February 1962.

                  [KossiakoffEA2003] Alexander Kossiakoff and William N. Sweet. Systems
                                   engineering principles and practice. John Wiley and Sons, Inc., New
                                   Jersey, 2003. ISBN: 0-471-23443-5.

                  [Lilienfeld1925] Julius Edgar Lilienfeld. Method and apparatus for control-
                                   ling electric currents, October 1925.

                       [MOS9] D. Velghe, R. Klaassen and F. Klaassen. MOS Model 9, 1994.
                                   Unclassified Report NL-UR 003/94.
                                                                                                                                                     585

[McDermottEA1996] Robin E. McDermott, Raymond J. Mikulak, Michael R.
                 Beauregard. The basics of FMEA. Productivity Inc., Portland,
                 USA, 1996. ISBN: 0-527-76320-9.

[Meyer1971] J. Meyer. MOS models and circuit simulation. RCA Review,
                 32:42-63, 1971.

[Middlebrook1975] R.D. Middlebrook. Measurement of loop gain in feed-
                 back systems. Int. J. Electronics, 38:485-512, April 2001.

[Middlebrook1991] R.D. Middlebrook. Low-Entropy Expressions: The Key
                 to Design-Oriented Analysis. Frontiers in Education Conference,
                 pages 399-403, 1991.

[Miller1920] John M. Miller. Dependence of the input impedance of a three-
                 electrode vacuum tube upon the load in the plate circuit. Scien-
                 tific Papers of the Bureau of Standards, 15(351):367-385, 1920.

[Monticelli1986] D. M. Monticelli. A quad CMOS single-supply opamp with
                 rail-to-rail output swing. IEEE Journal of Solid-State Circuits,
                 21:1026-1034, December 1986.

[Nagel-M382] Laurence W. Nagel and D.O. Pederson. Technical Report
                 UCB/ERL M382, EECS Department, University of California,
                 Berkeley, April 1973.

[Nagel-M520] Laurence W. Nagel. SPICE2: A Computer Program to Simulate
                 Semiconductor Circuits. PhD thesis, EECS Department, University
                 of California, Berkeley, 1975.

[Nordholt1983] Ernst H. Nordholt. Design of High-Performance Negative Feed-
                 back Amplifiers. Delft Academic Press / VSSD, 1 edition, 1983-
                 2006. ISBN: 9789040712470.

[Nyquist1928-1] H. Nyquist. Thermal agitation of electrical charge in con-
                 ductors. Phys. Rev., 32:110-113, 1928.

[Nyquist1928-2] H. Nyquist. Certain topics in telegraph transmission theory.
                 Trans. Am. Inst. Elec. Eng., 47:617-644, 1928.

[Nyquist1932] H. Nyquist. Regeneration theory. Bell System Technical Journal,
                 11:126-147, 1932.

[Papoulis1965] Athanasios Papoulis. Probability Random Variables and Stochas-
                 tic Processes. McGraw-Hill, New York, 1965.

[Quarles-M89/42] Thomas L. Quarles. Analysis of Performance and Conver-
                 gence Issues for Circuit Simulation. PhD thesis, EECS Department,
                 University of California, Berkeley, 1989.

[Rosenstark1974] Solomon Rosenstark. A Simplified Method of Feedback
                 Amplifier Analysis. Transactions on education, E-17(4):192-198,
                 November 1974.

[SPICE1988] P. Antognetti and G. Massobrio. Semiconductor Device Modeling
                 with SPICE. McGraw-Hill, 1988.

[ShannonWeaver1963] Claude E. Shannon and Warren Weaver. The Mathe-
                 matical Theory of Communication. The University of Illinois Press,
                 Ubana, 1 edition, 1963. ISBN: 0-88179-205-5.

[SheuEtAll1987] B. Sheu, D. Scharfetter, P. Ko, and M. Jeng. BSIM: Berkely
                 Short Channel IGFET Model for MOS Transistors. IEEE Journal
                 of Solid State Circuits, SC-22:558-566, 1987.
[ShichmanHodges1968] H. Shichman and D. Hodges. Modeling and simu-
                 lation of insulated-gate field-effect transistor switching circuits.
                 IEEE J. Solid-State Circuits, 3(3):285-289, September 1968.

[Shockley1952] William Shockley. Circuit element utilizing semiconductive
                 material, June 1948.

[ShockleyFET1952] W. Shockley. A Unipolar "Field-Effect" Transistor. Proc.
                 of the I.R.E, pages 1365-1376, November 1952.

[Terninko1998] Terninko et al. Systematic Innovation, An introduction to TRIZ.
                 CRC Press LLC, USA, 1998.

[Torralba2001] A. Torralba, R. G. Carvajal, J. Ramirez-Angulo, J. Tombs, and
                 T. Galan. Class ab output stages for low voltage cmos opamps
                 with accurate quiescent current control by means of dynamic
                 biasing. In ICECS 2001. 8th IEEE International Conference on Elec-
                 tronics, Circuits and Systems (Cat. No.01EX483), volume 2, pages
                 967-970, 2001.

[Truxal1972] John G. Truxal. Introductory System Engineering. McGraw-Hill,
                 Tokyo, 1972.

[VBIC1996]  Colin C. McAndrew, Jerold A. Seitchik, Derek F. Bowers, Mark
            Dunn, Mark Foisy, Ian Getreu, Marc McSwain, Shahrir Moinian,
            James Parjer, David J. Roulston, Michael Schroeter, Paul van Wi-
            jnen, Lawrence F. Wagner. VBIC95, The Vertical Bipolar Inter-
            Company Model. IEEE Journal of solid-state circuits, 31(10):1476-
            1483, October 1996.

[Verhoeven2003] C.J.M. Verhoeven, A. van Staveren, G.L.E. Monna, M.H.L.
                 Kouwenhoven and E. Yildiz. Structured Electronic Design. Kluwer
                 Academic Publishers, Boston - Dordrecht - London, 2003. ISBN:
                 1-4020-7590-1.

[Wanlass-Sah1963] F. "Wanlass and C." Sah. Nanowatt logic using field-effect
                 metal-oxide semiconductor triodes. 1963 IEEE International Solid-
                 State Circuits Conference. Digest of Technical Papers, VI:32-33, 1963.

[Ward1998] D. Ward and R. Dutton. A Charge-Oriented Model for MOS
                 Transistor Capacitances. IEEE Solid-state Circuits, sc-13(5):703-
                 708, October 1978.

[spiceEKV2.6] Matthias Bucher, Christoff Lallement, Christian Enz, Fabien
                 Théodoloz and François Krummenacher. The EPFL-EKV MOS-
                 FET Model Equations for Simulation. Technical report, Electron-
                 ics Laboratory, Swiss Federal Institute of Technology (EPFL),
                 Lausanne, Switzerland, July 1998.
Index

AC                                                worst-case -, 300                               - point shift, 74
   - analysis, 99, 114, 122, 133, 134          anti-parallel                                      - sources, 86, 89, 91, 93-96
   - behavior, 71, 72                                                                             - voltage, 292, 294, 295
   - coupling, 292-296, 298, 385, 438-440         - connection, 208, 209, 213-216, 224            - voltage source, 72, 293, 490, 491, 496
   - decoupling, 298                           anti-series                                        common-mode - voltage, 73
   - signal, 512                                                                                  controller - imperfection, 305
   - solution, 547                                - connection, 208-213, 218-220, 223,            dependent - source, 86, 91
                                                        224, 228, 236, 259-261, 264-266,          independent - source, 91
active                                                  268                                    biased
   - feedback, 233, 234, 236, 240, 244, 245,                                                      - amplifying device, 35, 36, 38
         257, 258, 267                            - stage, 218, 221, 225, 490, 496, 500        biasing, 86, 89, 91, 92, 94-96, 292-299,
   - phantom zero, 420, 421, 444               approach
                                                                                                     305, 307, 309, 310, 313, 486-493, 495-
actuator, 2, 10, 12, 35, 39, 40                   structured design -, 10, 18                        498, 500-504
addition, 35, 38, 43                              two-step design -, 318, 319, 322, 326,          - error, 89, 93
                                                                                                  - errors, 296, 297, 305, 306, 309, 310, 312
   noise -, 82                                          327, 334                                  common-mode -, 293, 496-499, 502
additivity, 524                                asymptotic                                         initial - scheme, 489-492, 494, 500
admittance                                                                                        negative feedback -, 310, 311, 390, 438,
                                                  - gain, 470, 478, 479
   - matrix, 537, 538, 540-542, 544, 554          - gain model, 319, 324, 326, 327, 329-                443
ageing, 38, 77                                                                                    total - error, 305, 307
all-pole                                                332, 334, 338, 339, 341, 345-348       BiCMOS, 98, 123
                                               auto-zero, 293, 312                             big-data, 17
   - loop gain, 354, 361, 364, 369                                                             BJT, 98, 100, 104, 106, 111, 112, 114, 131,
amplification, 35                                 - operational amplifier, 273
                                               autocorrelation                                       147
   - mechanism, 35, 44, 86, 95                                                                 Black's
amplifier                                         - function, 517, 518
                                               available                                          - feedback model, 319-323, 327, 346
   auto-zero operational -, 273                                                                Blakesley, 59, 536, 542, 543
   current -, 287, 288                            - power, 35, 48, 49, 65                      block
   current-feedback operational -, 273,           - power gain, 35, 36, 48-51, 77, 79, 86,
                                                                                                  Laplace building -, 552
         281                                            90, 92, 93, 96                         blocking
                                               average
   differential voltage -, 288                                                                    DC - element, 364-366
   error -, 234, 235, 240, 241                    ensemble -, 516                              Bode, 319, 332, 346
   fully-differential operational -, 273, 274     time -, 515, 516
   negative feedback -, 233, 234, 240-242,                                                        - plots, 70, 527, 528
                                               balanced                                        Boltzmann
         244, 258                                 - feedback, 233, 234, 240, 244, 245
   operational -, 272-280, 282, 285, 286,         - two-port, 216                                 - constant, 578, 580
                                                                                               bounded, 525, 529
         288                                   balancing, 206, 208, 216, 218, 220, 224,        branch
                                                     228, 260
   switching -, 67                                                                                - current, 537, 538, 542, 544, 545, 554,
   transadmittance -, 287, 288                 bandwidth                                                557
   transimpedance -, 286-288                      - limitation, 351, 353, 354, 361
   voltage-feedback operational -, 272,           - reduction, 386, 389                           - voltage, 537, 542, 543, 545, 547, 554,
                                                  full-power -, 76                                      557
         273, 278, 279, 477                       noise -, 582
amplifiers                                        servo -, 356, 362, 389, 419, 437, 448        branche, 536, 542-544, 564, 569
                                                  small-signal -, 38                           broadbanding
   cascaded -, 38, 77, 79, 80
amplifying                                     base                                               resistive -, 389, 429, 432
                                                  ideal - current, 101-103, 108, 113           BSIM
   - device, 35                                   non-ideal - current, 102, 103, 108, 113
   biased - device, 35, 36, 38                                                                    - model, 125
amplitude                                      basic                                           building
   - margin, 389                                  - design process, 3, 7
analog, 524, 525                                  - function, 13-15                               Laplace - block, 552
   - electronics, 2, 3, 10, 17, 18                                                             bulk
analysis                                       behavior
   AC -, 99, 114, 122, 133, 134                   AC -, 71, 72                                    - resistance, 166
   DC -, 99                                       DC -, 71
   modified nodal -, 536, 537, 543, 545           dynamic -, 351, 353, 360, 372, 375           canceling
   nodal -, 536, 537, 541-543, 554, 571, 575      small-signal dynamic -, 69, 70, 72, 82          pole-zero -, 388, 389, 427, 431, 433, 434
   noise -, 245, 252
   symbolic statistical -, 301                 bias                                            capacitance
   transient -, 99                                - current, 67, 73, 276, 279, 281, 284, 285,     Meyer - model, 136
                                                        288, 292-297, 299, 305, 306, 309          voltage-dependent junction -, 101, 117
                                                  - current source, 72, 292, 293, 310, 488-
                                                        490, 493, 496
   Ward-Dutton - model, 136                      - rejection ratio, 54, 78, 79              cost
capacitive                                       - voltage, 42, 43, 54, 56                     - factor, 6, 8, 9, 16-18, 22
                                              common-source, 160                               operating - factor, 82
   - current source, 200, 201, 203            comparison
   - voltage source, 195, 196, 200               current -, 236, 239, 242, 256              cost factor, 37, 80, 81
capacity                                         parallel -, 236, 241, 256                  coupling
   channel -, 520                                voltage -, 236-238, 242, 256, 270
cascaded                                      compensation                                     AC -, 292-296, 298, 385, 438-440
   - amplifiers, 38, 77, 79, 80                  frequency -, 385-390, 404, 409, 417,          DC -, 293-295
cascode                                                                                     Cramer, 545, 546, 557, 561
   - stage, 471, 475, 476, 478, 481-483                419, 420, 422, 424, 431, 437, 438,   creativity, 3
   folded -, 496                                       441, 443, 446-448                    crest
causal, 525, 529                              complementary                                    - factor, 519
CD                                               - element, 86                              criterion
   - stage, 451-453, 455-457, 459, 461, 463,  complementary-parallel                           Nyquist stability -, 374, 375
                                                 - connection, 206, 209, 213-217, 224,      critical
         492, 500                                      226, 228                                - inversion coefficient, 185, 189, 196,
CG                                               - stage, 218, 226, 227, 501, 502
                                              complementary-series                                   201
   - stage, 452, 458-461, 492, 496               - connection, 209, 213, 215-217
change                                        complexity, 2, 27                             CS
                                              composition                                      - stage, 160, 161, 163, 165-167, 170-
   supply voltage -, 299                         physical -, 13, 15                                  173, 177-189, 194, 196, 197, 200-
channel                                       compression                                            204, 467-469, 471, 473-476, 482,
                                                 gain -, 53, 74-76, 530, 534                         483, 489-492, 496, 499, 501, 503,
   - capacity, 520                            conceptual                                             504
   - length modulation, 124, 139, 140, 142       - design, 24
character                                     condition                                        intrinsic - stage, 160-166, 170, 172, 176,
   current source -, 487-490, 492, 493, 495,     environmental -, 8, 11, 18, 37, 80-83               184, 185
                                                 operating -, 37, 73, 82
         496, 500                             conditions                                    current
   voltage source -, 487, 489, 495               two-port -, 572                               - amplifier, 287, 288
characteristic                                configuration                                    - comparison, 236, 239, 242, 256
   - equation, 538, 556, 568                     gyrator-like -, 47                            - follower, 452, 458
   filter -, 353-356                             single-loop -, 244                            - gain, 163, 168, 170, 177, 178, 184, 194,
characteristics                                  transformer-like -, 47                              200, 203
   engineering -, 9                           connected                                        - gain factor, 44, 50, 167, 170
circuit                                          - graph, 536                                  - limiting mechanism, 171
   - design, 16                               connection                                       - mirror, 463
   common-mode equivalent -, 264, 265,           anti-parallel -, 208, 209, 213-216, 224       - source character, 487-490, 492, 493,
                                                 anti-series -, 208-213, 218-220, 223,               495, 496, 500
         268                                           224, 228, 236, 259-261, 264-266,        bias -, 67, 73, 276, 279, 281, 284, 285,
                                                       268                                           288, 292-297, 299, 305, 306, 309
   differential-mode equivalent -, 261,                                                        bias - source, 72, 292, 293, 310, 488-490,
         264, 268                                complementary-parallel -, 206, 209,                 493, 496
                                                       213-217, 224, 226, 228                  branch -, 537, 538, 542, 544, 545, 554,
class A, 67                                                                                          557
class AB, 67, 68, 272, 273, 288                  complementary-series -, 209, 213, 215-
class B, 67, 68                                        217                                     capacitive - source, 200, 201, 203
class C, 67                                                                                    common-mode -, 43, 54
class D, 67                                   constant                                         cut-off -, 487
class E, 67                                      Boltzmann -, 578, 580                         DC - gain, 108, 109
class F, 68                                                                                    differential-mode -, 43
class G, 68                                   continuous                                       differential-mode port -, 572
class H, 68                                      - time, 524, 525                              diffusion -, 100
clipping, 73, 74, 76, 82                                                                       drain -, 163, 173, 176, 190
CMOS, 98, 123-126, 140, 146, 148, 151,        contribution                                     forward -, 102, 141
                                                 noise -, 172, 173, 184-186, 194, 204          gate -, 163
      152, 154                                                                                 ideal base -, 101-103, 108, 113
CMRR, 54-56, 78, 82, 278, 284, 289            control                                          input - feedback, 236
coefficient                                      nested -, 443, 445                            load - sensing, 236, 256
                                                                                               nodal -, 543, 545, 554, 557, 572
   critical inversion -, 185, 189, 196, 201   controller, 233, 234, 238-241, 243, 252,         noise -, 578, 579
   inversion -, 126, 137-141, 143, 176, 186,        318-324, 327, 328, 330, 331, 334, 335,     non-ideal base -, 102, 103, 108, 113
                                                    338, 344-346, 348, 350-354, 356-358,       offset -, 273, 279, 281, 284
         187, 189, 197                              360, 363, 365-367, 372, 377, 381           output - feedback, 236
   reverse inversion -, 138, 146                                                               quiescent operating -, 490
cofactor, 538, 548, 553                          - bias imperfection, 305                      reverse -, 102, 138-140, 146
common-drain                                     - requirements, 350                           saturation -, 102, 116, 120, 127, 487
   - stage, 451                                  dual-stage four-terminal -, 476               small-signal - gain, 108, 109
common-mode, 238, 259, 261-269                   low-noise -, 473                              technology -, 137, 138, 140
   - bias voltage, 73                         convolution, 526                                 transport -, 102, 103
   - biasing, 293, 496-499, 502               corrective                                    current-controlled, 87-90
   - current, 43, 54                             - feedback, 241                               - element, 537, 543, 550
   - equivalent circuit, 264, 265, 268        correlation
   - feedback, 488, 497, 499                     - function, 516-518
   - impedance, 43
   - input voltage, 273, 276, 284, 285
   - instability, 500
   - notation, 543                              development                                       - effect, 101, 108, 124
   - representation, 574                           market -, 4                                 Ebers-Moll
current-feedback                                   product -, 4, 6
   - operational amplifier, 273, 281               technology -, 4                                - model, 101
cut                                                                                            effect
   - set, 537, 563-565, 571                     deviation
cut-off                                            standard -, 519                                Early -, 101, 108, 124
   - current, 487                                                                                 Kirk -, 103
   - frequency, 106, 109-111, 113, 118, 120,    device                                            Miller -, 178, 179, 183
                                                   - tolerance, 293, 296, 300, 301, 305, 309,  effective
         130, 131, 144, 146, 168, 170, 186,              310                                      - phantom zero, 412-414
         189                                       amplifying -, 35                               - zero, 406
   - region, 116, 117, 121, 127, 132, 136          biased amplifying -, 35, 36, 38             effects
   high-pass -, 364-367, 370-372, 381, 385,                                                       small geometry -, 124
         387, 388, 439-441                      DIBL, 125, 164-166                             efficiency
   high-pass - frequency, 387, 388, 440,        differential                                      power -, 51, 53, 65-67, 232-234, 240,
         442
   low-pass -, 357, 360, 363, 364, 369-372,        - equation, 553, 557, 569                            241, 243, 244, 255, 257
         381, 385, 386, 388, 405, 419, 439,        - error-to-gain ratio, 353, 475                spectral -, 521
         443                                       - gain, 71, 74-76, 80, 532, 533                transconductance -, 142, 143
   low-pass - frequency, 386-388, 391,             - gain error, 352, 353, 531-533             eigenvalue
         392, 396, 397, 405                        - pair, 218, 223                               generalized - problem, 553, 557
                                                   - phase, 75, 76, 534                        eigenvalues, 556, 557, 560, 561, 563, 565,
data                                               - voltage amplifier, 288
   - rate, 519, 520                             differential-mode, 238, 259, 261-269, 572,           567, 568
   design -, 10                                                                                EKV
                                                      573
DC                                                 - current, 43                                  - model, 126, 150, 154
   - analysis, 99                                  - equivalent circuit, 261, 264, 268            - noise model, 173, 189
   - behavior, 71                                  - impedance, 43                             electric
   - blocking element, 364-366                     - port current, 572                            - motor, 39
   - coupling, 293-295                             - port voltage, 572, 573                    electrical
   - current gain, 108, 109                        - voltage, 43, 54, 56                          - input quantity, 37, 40
   - gain, 280                                  diffusion                                         - output quantity, 39
   - solution, 547, 553, 558, 566                  - current, 100                              electronic
                                                digital, 524                                      - information processing, 2, 3, 13, 16
decomposition                                   diode                                          electronics, 2
   functional -, 9, 13-15, 17                      PIN -, 39                                      analog -, 2, 3, 10, 17, 18
                                                direct                                            structured - design, 3, 13, 14, 17, 21
decoupling                                         - feedback, 233, 234, 237, 239, 240, 245,   element
   AC -, 298                                                                                      complementary -, 86
                                                         269, 270                                 current-controlled -, 537, 543, 550
delay, 70                                          - feedback stage, 451, 463                     DC blocking -, 364-366
   group -, 70                                     - transfer, 322-324, 326-328, 331, 334,        nonlinear resistive -, 93
                                                                                                  two-terminal network -, 550
density                                                  335, 337, 339, 340, 343, 345, 347,       two-terminal resistive -, 88
   energy - spectrum, 513                                348                                      voltage-controlled -, 536, 537, 544, 554
   joint probability -, 516                     discrete                                       elements
   power spectral -, 515, 518, 519, 527            - time, 524                                    network -, 536, 537, 541, 543, 545, 547,
   probability - function, 515, 516, 518,       distortion
         519                                       harmonic -, 53, 71, 74, 75, 530-532, 534             548, 550, 563
                                                   intermodulation -, 53, 71, 74-76, 532-      energy
dependent                                                534
   - bias source, 86, 91                        distributed, 524, 525                             - density spectrum, 513
                                                distribution, 43, 77                              - signal, 508, 509
depletion                                       documents                                         - storage, 51, 65, 66, 69, 77
   - layer, 101, 103, 115, 124                     design -, 3                                 engineering
                                                dominant                                          - characteristics, 9
design                                             - pole, 355-357, 359, 365, 370, 386, 387,      systems -, 3, 13
   - data, 10                                            389-392, 406, 411, 416, 417, 419,     ensemble
   - documents, 3                                        421, 423, 424, 428, 429, 433, 437,       - average, 516
   - process, 2-6, 9, 10, 16-18, 22, 28                  438, 444, 446, 448, 566, 567          environment, 2, 7, 10, 11, 23
   - project, 5, 6                              drain                                          environmental
   - risk, 6                                       - current, 163, 173, 176, 190                  - condition, 8, 11, 18, 37, 80-83
   basic - process, 3, 7                        drift                                          equation
   circuit -, 16                                   - field, 100                                   characteristic -, 538, 556, 568
   conceptual -, 24                             dual-loop, 242, 256, 258, 267                     differential -, 553, 557, 569
   noise -, 187, 204                            dual-stage                                        state -, 557, 558
   physical -, 16, 17                              - four-terminal controller, 476             equivalent
   structured - approach, 10, 18                dynamic, 524-527, 529, 531, 533                   - input noise, 56-58, 61, 64
   structured electronics -, 3, 13, 14, 17, 21     - behavior, 351, 353, 360, 372, 375            common-mode - circuit, 264, 265, 268
   two-step - approach, 318, 319, 322, 326,        small-signal - behavior, 69, 70, 72, 82        differential-mode - circuit, 261, 264,
         327, 334
                                                Early                                                   268
determinant, 538, 553, 557, 564
deterministic                                                                                  ergodic

   - signal modeling, 508
   - process, 516-518, 578                        nonenergic -, 233, 236, 239-244              information processing -, 2, 35
error                                             nonenergic - stage, 451, 452, 458            probability density -, 515, 516, 518, 519
                                                  output current -, 236                        servo -, 322, 327, 331, 334, 343-345,
   - amplifier, 234, 235, 240, 241                output parallel -, 236
   - reduction technique, 13, 23, 25, 28,         output series -, 236, 256                          347, 350-358, 364, 366, 367, 369-
                                                  output shunt -, 236                                372, 374-379, 381
         293, 297, 310, 312                       output voltage -, 236                        transfer -, 527, 528
   biasing -, 89, 93                              parallel -, 341                              weighting -, 57
   differential gain -, 352, 353, 531-533         passive -, 233, 234, 236, 240, 241, 243-  functional
   information processing -, 2, 12, 22                                                         - decomposition, 9, 13-15, 17
   static -, 444                                        245, 247, 252, 255-258, 264, 266,
   total biasing -, 305, 307                            267, 269                            gain
error-to-gain                                     series -, 338, 339, 341, 344                 - compression, 53, 74-76, 530, 534
   differential - ratio, 353, 475              field                                           - margin, 375
errors                                            drift -, 100                                 - poles product, 389, 398, 412, 446
   biasing -, 296, 297, 305, 306, 309, 310,    figure                                          all-pole loop -, 354, 361, 364, 369
                                                  - of merit, 6, 9, 16, 22                     asymptotic -, 470, 478, 479
         312                                      excess noise -, 579                          asymptotic - model, 319, 324, 326, 327,
excess                                            noise -, 37, 57, 79, 582                           329-332, 334, 338, 339, 341, 345-
                                               figure of merit, 37                                   348
   - noise, 579                                filter                                          available power -, 35, 36, 48-51, 77, 79,
   - noise figure, 579                            - characteristic, 353-356                          86, 90, 92, 93, 96
excitation, 12, 525-527, 532                      high-pass -, 387, 388                        current -, 163, 168, 170, 177, 178, 184,
                                                  low-pass -, 386, 387, 406, 412, 417, 422           194, 200, 203
factor                                         Fin FET, 123                                    current - factor, 44, 50, 167, 170
   cost -, 6, 8, 9, 16-18, 22                  fixed, 525-527, 530-532                         DC -, 280
   crest -, 519                                flicker                                         DC current -, 108, 109
   current gain -, 44, 50, 167, 170               - noise, 105, 145, 146, 173                  differential -, 71, 74-76, 80, 532, 533
   feedback -, 325, 346                        floating, 37, 41, 42, 54, 56, 64, 73, 81        differential - error, 352, 353, 531-533
   junction grading -, 104                        - ports, 313                                 ideal -, 318, 320-322, 326-331, 334, 335,
   operating cost -, 82                           - voltage source, 488, 489, 491, 502               337, 338, 345, 346, 348, 470, 472,
   quality -, 568, 570                         folded                                                477
   rejection -, 56, 78, 79                        - cascode, 496                               loop -, 320-323, 326-328, 334-339, 341,
   transadmittance -, 44, 166, 167, 170        follower                                              343-348
   transconductance -, 117, 128, 137, 139         current -, 452, 458                          loop - reference, 325-331, 335, 340, 342,
   transimpedance -, 44, 167, 168, 170            voltage -, 451, 452, 463                           344, 346-348
   voltage gain -, 44, 49, 50, 166             FOM, 37                                         midband loop -, 354
                                               forward                                         power -, 50, 86
feed forward, 488, 499                            - current, 102, 141                          small-signal current -, 108, 109
feedback                                          - mode, 116, 122                             voltage - factor, 44, 49, 50, 166
                                                  - operation, 151
   - factor, 325, 346                             - transfer, 346                           gain-bandwidth
   - model, 319, 325, 328, 338, 342            four-terminal                                   - product, 280
   - network, 318-325, 337, 344, 350, 351,        dual-stage - controller, 476
                                               Fourier                                      gain-poles
         353, 372                                 - transform, 508, 513, 518, 527              loop - product, 355-357, 359, 361, 372,
   - transfer, 346                             frequencies                                           467, 470, 475
   active -, 233, 234, 236, 240, 244, 245,        midband -, 386, 388, 391
                                               frequency                                    gate
         257, 258, 267                            - compensation, 385-390, 404, 409, 417,      - current, 163
   balanced -, 233, 234, 240, 244, 245                  419, 420, 422, 424, 431, 437, 438,     - series resistance, 184
   Black's - model, 319-323, 327, 346                   441, 443, 446-448
   common-mode -, 488, 497, 499                   cut-off -, 106, 109-111, 113, 118, 120,   Gaussian
   corrective -, 241                                    130, 131, 144, 146, 168, 170, 186,     unit - pulse, 510
   direct -, 233, 234, 237, 239, 240, 245,
                                                        189                                 generalized
         269, 270                                                                              - eigenvalue problem, 553, 557
   direct - stage, 451, 463                       high-pass cut-off -, 387, 388, 440, 442
   indirect -, 234, 237, 239, 240, 245, 269,      low-pass cut-off -, 386-388, 391, 392,    generalized feedback theorem, 319
                                                                                            geometry
         270                                            396, 397, 405
   indirect - stage, 463                          midband - range, 354                         small - effects, 124
   input current -, 236                        Friis, 79                                    grading
   input parallel -, 236                       full-power
   input series -, 236                            - bandwidth, 76                              junction - factor, 104
   input shunt -, 236                          fully-differential                           graph, 536, 537, 569
   input voltage -, 236                           - operational amplifier, 273, 274
   local - stage, 462, 471, 473-476, 482, 483  function                                        connected -, 536
   model-based -, 233, 239, 269                   autocorrelation -, 517, 518               ground
   multi-loop -, 343                              basic -, 13-15
   multi-stage negative -, 466, 471, 472          correlation -, 516-518                       - node, 41
   negative -, 318-320, 322-324, 326-328,                                                   group

         338, 341, 342, 344, 348                                                               - delay, 70
   negative - amplifier, 233, 234, 240-242,                                                 Gummel

         244, 258                                                                              - plot, 106, 108
   negative - biasing, 310, 311, 390, 438,                                                  Gummel-Poon

         443                                                                                   - model, 101, 102, 104-106, 111-113
                                                                                            gyrator, 24, 44, 51
gyrator-like                                        - port, 35, 38-40, 42, 44, 49-51, 54, 56,      channel - modulation, 124, 139, 140,
   - configuration, 47                                    57, 61, 63-65, 72, 77, 81                      142

harmonic                                            - series feedback, 236                      level 1 MOSFET model, 126
   - distortion, 53, 71, 74, 75, 530-532, 534       - shunt feedback, 236                       level shift, 293, 295, 296, 310
                                                    - voltage feedback, 236                     life-cycle
headroom, 296, 297, 300                             common-mode - voltage, 273, 276, 284,
hierarchy, 5                                                                                       - process, 80, 83
high injection, 101, 103, 108                             285                                   limitation
high-frequency                                      electrical - quantity, 37, 40
                                                    equivalent - noise, 56-58, 61, 64              bandwidth -, 351, 353, 354, 361
   - roll-off, 385                               instability                                       performance -, 23, 24
high-pass                                           common-mode -, 500                             physical -, 36, 38, 52
                                                 instantaneous, 524, 525, 530-533                  power -, 53
   - cut-off, 364-367, 370-372, 381, 385,        intercept                                         slew rate -, 170, 171
         387, 388, 439-441                          intermodulation - point, 75                    speed -, 53
                                                 Interference, 11                                  technological -, 36-38, 53
   - cut-off frequency, 387, 388, 440, 442       interference, 37, 38, 82                       limiting, 73
   - filter, 387, 388                               out-of-band -, 422, 424                        current - mechanism, 171
Hilbert                                          intermediate                                      voltage - mechanism, 170
   - transform, 529                                 - stage, 476                                line
histogram, 515                                   intermodulation                                   transmission -, 40
homogeneity, 524                                    - distortion, 53, 71, 74-76, 532-534        linear, 524-527, 529-533
humidity, 37, 82                                    - intercept point, 75                          - region, 116, 117, 121, 122, 127, 132,
hysteresis, 75, 77                               Interpretation, 11
                                                 intrinsic                                               136, 140, 142-145, 151, 164, 165,
ideal                                               - CS stage, 160-166, 170, 172, 176, 184,             171
   - base current, 101-103, 108, 113                                                               - superposition, 510, 511
   - gain, 318, 320-322, 326-331, 334, 335,               185                                   load
         337, 338, 345, 346, 348, 470, 472,      invention, 2-4                                    - current sensing, 236, 256
         477                                     inversion                                         - signal, 36, 38, 76, 82, 236, 239
                                                                                                   - voltage sensing, 236, 256
impedance                                           - coefficient, 126, 137-141, 143, 176,      local
   common-mode -, 43                                      186, 187, 189, 197                       - feedback stage, 462, 471, 473-476,
   differential-mode -, 43                                                                               482, 483
   input -, 39, 40, 46, 47, 51, 54, 56, 63, 81,     critical - coefficient, 185, 189, 196, 201  loop, 537, 548, 563, 564, 568, 571
         166, 168, 170, 171, 182, 183               moderate -, 138                                - gain, 320-323, 326-328, 334-339, 341,
   output -, 39, 40, 44, 46, 47, 51, 79, 81,        reverse - coefficient, 138, 146                      343-348
         166, 168-170, 275, 277, 279-282,           strong -, 124-126, 137, 138, 140, 142,         - gain reference, 325-331, 335, 340, 342,
         286                                                                                             344, 346-348
   port -, 40, 43, 46-48, 51, 70, 82                      145, 148, 151, 176, 186-188, 194,        - gain-poles product, 355-357, 359, 361,
                                                          197, 200, 203, 204                             372, 467, 470, 475
imperfection                                        weak -, 124, 125, 137, 138, 142, 145, 148,     all-pole - gain, 354, 361, 364, 369
   controller bias -, 305                                 151                                      midband - gain, 354
                                                 IP3, 76                                        losses
impulse                                          isolation                                         power -, 51, 65-68
   unit -, 508, 510                                 port -, 43, 53-55, 78, 82, 466-468, 476,       quiescent -, 65
   unit - response, 69, 70, 526, 527, 529                 477, 482                              low-frequency
                                                    source-to-load -, 53                           - roll-off, 385
inaccuracy, 531                                                                                 low-noise
   static -, 351, 352, 354                       JFET, 98, 100, 115, 117-122, 124, 131             - controller, 473
                                                 Johnson                                        low-pass
incidence                                                                                          - cut-off, 357, 360, 363, 364, 369-372,
   - matrix, 544, 558, 560                          - noise, 578                                         381, 385, 386, 388, 405, 419, 439,
                                                 joint                                                   443
independent                                                                                        - cut-off frequency, 386-388, 391, 392,
   - bias source, 91                                - power, 517                                         396, 397, 405
                                                    - probability density, 516                     - filter, 386, 387, 406, 412, 417, 422
indirect                                         junction                                       lumped, 524, 525
   - feedback, 234, 237, 239, 240, 245, 269,        - grading factor, 104
         270                                        voltage-dependent - capacitance, 101,       macro model, 274, 278, 284, 285
   - feedback stage, 463                                                                        magnitude, 61, 63, 70, 74, 76, 79
                                                          117                                   management
information, 2, 3, 10-14, 16, 28
   - processing error, 2, 12, 22                 KCL, 543                                          risk -, 3, 6
   - processing function, 2, 35                  Kirk                                           margin
   - processing system, 2, 10, 13, 14, 16
   - processing task, 2                             - effect, 103                                  amplitude -, 389
   - rate, 520                                                                                     gain -, 375
   electronic - processing, 2, 3, 13, 16         lag compensator, 433                              phase -, 375, 376, 389, 392, 394, 396,
   operating point -, 99, 111                    Laplace
                                                                                                         397, 399, 401, 432-434, 437
initial                                             - building block, 552                       market
   - biasing scheme, 489-492, 494, 500              - transform, 509, 514, 526, 527, 529
                                                 layer                                             - development, 4
input                                               depletion -, 101, 103, 115, 124
   - current feedback, 236                       lead compensator, 433
   - impedance, 39, 40, 46, 47, 51, 54, 56,      length
         63, 81, 166, 168, 170, 171, 182, 183
   - noise source, 172, 173
   - parallel feedback, 236
materialization, 5, 13, 15, 16                   Meyer capacitance -, 136                        - analysis, 245, 252
matrix                                           noise -, 105, 112, 114, 118, 121, 122, 129,     - bandwidth, 582
                                                                                                 - contribution, 172, 173, 184-186, 194,
   - stamp, 536, 547, 550, 553-556                     132, 133, 172, 173, 176, 185, 195
   admittance -, 537, 538, 540-542, 544,         superposition -, 319, 324, 326, 339, 340              204
                                                 two-port -, 572                                 - current, 578, 579
         554                                     Ward-Dutton capacitance -, 136                  - design, 187, 204
                                              model-based                                        - figure, 37, 57, 79, 582
   incidence -, 544, 558, 560                    - feedback, 233, 239, 269                       - model, 105, 112, 114, 118, 121, 122,
   minor -, 538                               modeling
   resistance -, 558, 559, 561, 565              deterministic signal -, 508                           129, 132, 133, 172, 173, 176, 185,
   time-constant -, 553, 556-558, 560, 561,      random signal -, 508                                  195
                                                 system -, 524                                   - optimization process, 185
         563, 565-568                         moderate                                           - power, 580-582
   transmission-1 - parameters, 92, 160,         - inversion, 138                                - source, 578, 579
                                              modified                                           - temperature, 580
         166                                     - nodal analysis, 536, 537, 543, 545            - transformation, 61
                                              modulation                                         - voltage, 578, 579, 581
   transmission-1 - representation, 44,          channel length -, 124, 139, 140, 142            EKV - model, 173, 189
         575                                  MOS, 98-101, 113, 123-126, 128-137, 140,           equivalent input -, 56-58, 61, 64
                                                                                                 excess -, 579
maximally flat magnitude, 385                       142, 143, 145, 146, 148, 151, 152, 154       excess - figure, 579
mean                                          motor                                              flicker -, 105, 145, 146, 173
                                                                                                 input - source, 172, 173
   - square value, 509, 511, 512, 515, 518       electric -, 39                                  Johnson -, 578
mechanism                                     MTBF, 7, 82                                        shot -, 105, 118, 578
                                              MTTF, 7, 82                                        source-referred -, 56, 57, 61, 63
   amplification -, 35, 44, 86, 95            MTTR, 7, 82                                        thermal -, 578, 579
   current limiting -, 171                    multi-loop                                      noise-free
   operating -, 12, 13, 24                                                                       - resistor, 578
   transducer -, 39, 40                          - feedback, 343                                 - two-port, 57, 58, 61, 62
   voltage limiting -, 170                    multi-stage                                     noisy
merit                                                                                            - two-port, 581
   figure of -, 6, 9, 16, 22                     - negative feedback, 466, 471, 472           non-controllable
Meyer                                                                                            - state, 380
   - capacitance model, 136                   NA                                              non-dominant
MFM, 385, 387, 388, 390-392, 394-398,            - stamp, 547, 548, 550                          - pole, 356
                                                                                              non-ideal
      400, 401, 403-405, 411, 417, 419, 426,  natural                                            - base current, 102, 103, 108, 113
      429, 431-433, 436, 439, 441, 442, 444,     - two-port, 571, 574                         non-observable
      445                                                                                        - state, 381
                                              negative                                        nonenergic, 576
   - response, 356, 359                          - feedback, 318-320, 322-324, 326-328,          - feedback, 233, 236, 239-244
   second-order -, 391                                 338, 341, 342, 344, 348                   - feedback stage, 451, 452, 458
   third-order -, 400                            - feedback amplifier, 233, 234, 240-242,        - two-port, 576
   unity-gain - transfers, 355                         244, 258                               nonlinear, 524, 530, 532, 533
microphone, 39                                   - feedback biasing, 310, 311, 390, 438,         - resistive element, 93
midband                                                443                                       - resistive two-port, 91
   - frequencies, 386, 388, 391                  multi-stage - feedback, 466, 471, 472           passive - resistor, 487-490, 493, 496
   - frequency range, 354                                                                     nonlinearity, 531-533
   - loop gain, 354                           nested                                          norator, 15, 234, 235, 240, 243, 250, 258,
Miller                                           - control, 443, 445                                265, 548
   - effect, 178, 179, 183                                                                    Norton, 56, 59, 536, 542, 543, 545
Miller effect, 426                            network                                         notation
minimum                                          - elements, 536, 537, 541, 543, 545, 547,       current-controlled -, 543
   - phase system, 529                                 548, 550, 563                             voltage-controlled -, 543
minor                                            - solution, 538, 542, 544, 575               NPN, 100, 101, 106, 109-111, 124
   - matrix, 538                                 - transformations, 542                       nullator, 15, 548
mirror                                           feedback -, 318-325, 337, 344, 350, 351,     nullor, 15, 24, 25, 47, 50, 51, 234-236, 240,
   current -, 463                                      353, 372                                     241, 243, 245, 246, 249, 252, 256, 258,
   voltage -, 463                                two-terminal - element, 550                        265, 547-550
MNA, 250, 261-264, 268                                                                        Nyquist, 319
   - stamp, 547, 548, 550                     NMOS, 123, 124, 134, 140, 142, 148, 151,           - stability criterion, 374, 375
mode                                                154
   forward -, 116, 122                                                                        observer, 10, 12, 22
   reverse -, 117, 127, 132                   nodal                                           of
model                                            - analysis, 536, 537, 541-543, 554, 571,
   asymptotic gain -, 319, 324, 326, 327,              575                                       figure - merit, 6, 9, 16, 22
                                                 - current, 543, 545, 554, 557, 572           offset, 71-74, 77, 82
         329-332, 334, 338, 339, 341, 345-       - voltage, 537, 538, 543-545, 547, 554,
         348                                           557, 572, 573                             - current, 273, 279, 281, 284
                                                 modified - analysis, 536, 537, 543, 545
   Black's feedback -, 319-323, 327, 346
   BSIM -, 125                                node
   Ebers-Moll -, 101                             ground -, 41
   EKV -, 126, 150, 154
   EKV noise -, 173, 189                      nodes, 536, 537, 539, 541-543, 545, 548,
   feedback -, 319, 325, 328, 338, 342              554, 572
   Gummel-Poon -, 101, 102, 104-106,
                                              noise, 2, 10-12, 18, 19, 22, 23, 26-29
         111-113                                 - addition, 82
   - voltage, 273, 276, 284, 286                path                                               gain - product, 389, 398, 412, 446
   output -, 530, 531                              split signal -, 503                             zero-frequency -, 564, 565
operating                                                                                       port
   - condition, 37, 73, 82                      pattern                                            - impedance, 40, 43, 46-48, 51, 70, 82
   - cost factor, 82                               pole-zero -, 385, 443, 528                      - isolation, 43, 53-55, 78, 82, 466-468,
   - mechanism, 12, 13, 24
   - point, 72, 80, 86, 88-90, 92, 93, 96,      performance                                              476, 477, 482
                                                   - limitation, 23, 24                            differential-mode - current, 572
         98, 99, 104, 105, 109, 111-114, 117,      - parameters, 6, 7, 9, 17                       differential-mode - voltage, 572, 573
         120-122, 131-133, 137, 146, 147,          - requirement, 81                               input -, 35, 38-40, 42, 44, 49-51, 54, 56,
         180, 190, 197, 202, 530, 531              - specification, 7, 10, 16
   - point information, 99, 111                                                                          57, 61, 63-65, 72, 77, 81
   - point shift, 74, 172                       performance-cost                                   output -, 35, 36, 38-40, 42, 44, 45, 48,
   quiescent - current, 490                        - ratio, 6, 13, 16, 23
   quiescent - point, 88-90, 92, 160                                                                     50, 51, 54, 55, 65, 72, 81
operation                                       performance-to-cost                                power -, 35, 38
   forward -, 151                                  - ratio, 37, 81                                 shorted -, 447
   reverse -, 102, 103, 113, 132, 137, 141                                                      ports
operational                                     periodic                                           floating -, 313
   - amplifier, 272-280, 282, 285, 286, 288        - signal, 508, 511-514                       potential
   - requirement, 80                                                                               surface -, 124, 125, 137
   auto-zero - amplifier, 273                   phantom                                         power
   current-feedback - amplifier, 273, 281          - zero, 388-391, 394-396, 399-409, 411-         - efficiency, 51, 53, 65-67, 232-234, 240,
   fully-differential - amplifier, 273, 274              417, 419-424, 427, 428, 431, 433,
   voltage-feedback - amplifier, 272, 273,               437, 441, 442, 444-446, 448                     241, 243, 244, 255, 257
         278, 279, 477                             active - zero, 420, 421, 444                    - gain, 50, 86
optimization                                       effective - zero, 412-414                       - limitation, 53
   noise - process, 185                                                                            - losses, 51, 65-68
orthogonal, 15                                  phase, 67-70, 76, 77                               - port, 35, 38
out-of-band                                        - margin, 375, 376, 389, 392, 394, 396,         - signal, 509
   - interference, 422, 424                              397, 399, 401, 432-434, 437               - spectral density, 515, 518, 519, 527
output                                             differential -, 75, 76, 534                     - supply rejection, 56, 79
   - current feedback, 236                         minimum - system, 529                           available -, 35, 48, 49, 65
   - impedance, 39, 40, 44, 46, 47, 51, 79,                                                        available - gain, 35, 36, 48-51, 77, 79,
         81, 166, 168-170, 275, 277, 279-       phasor, 511
         282, 286                               physical                                                 86, 90, 92, 93, 96
   - offset, 530, 531                                                                              joint -, 517
   - parallel feedback, 236                        - composition, 13, 15                           noise -, 580-582
   - port, 35, 36, 38-40, 42, 44, 45, 48, 50,      - design, 16, 17                             principle
         51, 54, 55, 65, 72, 81                    - limitation, 36, 38, 52                        physical -, 2, 13
   - series feedback, 236, 256                     - principle, 2, 13                           probability
   - shunt feedback, 236                        PID, 390, 445                                      - density function, 515, 516, 518, 519
   - voltage feedback, 236                      piezoelectric                                      joint - density, 516
   electrical - quantity, 39                       - transducer, 39                             problem
overdrive                                       PIN                                                generalized eigenvalue -, 553, 557
   - recovery, 75, 77, 82, 386, 431, 433, 438,     - diode, 39                                  process
         447                                    plot                                               basic design -, 3, 7
oxide                                              Gummel -, 106, 108                              design -, 2-6, 9, 10, 16-18, 22, 28
   - thickness, 124                             plots                                              ergodic -, 516-518, 578
                                                   Bode -, 70, 527, 528                            life-cycle -, 80, 83
pair                                            PMOS, 123, 154                                     noise optimization -, 185
   differential -, 218, 223                     PNP, 100, 101, 106                                 random -, 515, 516
                                                point                                              stationary -, 516, 518
parallel                                           bias - shift, 74                             processing
   - comparison, 236, 241, 256                     intermodulation intercept -, 75                 electronic information -, 2, 3, 13, 16
   - feedback, 341                                 operating -, 72, 80, 86, 88-90, 92, 93, 96,     information - error, 2, 12, 22
   - sensing, 236, 241, 256                                                                        information - function, 2, 35
   input - feedback, 236                                 98, 99, 104, 105, 109, 111-114, 117,      information - system, 2, 10, 13, 14, 16
   output - feedback, 236                                120-122, 131-133, 137, 146, 147,          information - task, 2
                                                         180, 190, 197, 202, 530, 531           product
parameters                                         operating - information, 99, 111                - development, 4, 6
   performance -, 6, 7, 9, 17                      operating - shift, 74, 172                      gain poles -, 389, 398, 412, 446
   transmission-1 matrix -, 92, 160, 166           quiescent operating -, 88-90, 92, 160           gain-bandwidth -, 280
                                                pole                                               loop gain-poles -, 355-357, 359, 361,
Parseval's                                         - splitting, 475, 476, 481
   - theorem, 511-513                              dominant -, 355-357, 359, 365, 370, 386,              372, 467, 470, 475
                                                         387, 389-392, 406, 411, 416, 417,      product life cycle, 3, 4
passive                                                  419, 421, 423, 424, 428, 429, 433,     project
   - feedback, 233, 234, 236, 240, 241, 243-             437, 438, 444, 446, 448, 566, 567
         245, 247, 252, 255-258, 264, 266,         non-dominant -, 356                             design -, 5, 6
         267, 269                               pole-splitting, 179-182, 388, 389, 425-         PSRR, 56, 79, 82, 278, 284
   - nonlinear resistor, 487-490, 493, 496            429, 431, 437, 446                        pulse
                                                pole-zero
                                                   - canceling, 388, 389, 427, 431, 433, 434       - signal, 508-510, 512-514
                                                   - pattern, 385, 443, 528                        unit Gaussian -, 510
                                                poles, 70, 71, 536, 538, 539, 541, 553, 556,
                                                      557, 560, 561, 563-569, 571
   unit sinc -, 510                           resistance                                             347, 350-358, 364, 366, 367, 369-
push-pull                                        - matrix, 558, 559, 561, 565                        372, 374-379, 381
                                                 bulk -, 166                                set
   - stage, 223, 225-228                         gate series -, 184                            cut -, 537, 563-565, 571
                                                                                            shift
quality                                       resistive                                        bias point -, 74
   - factor, 568, 570                            - broadbanding, 389, 429, 432                 operating point -, 74, 172
                                                 nonlinear - element, 93                    shock, 37, 82
quantity                                         nonlinear - two-port, 91                   shorted
   electrical input -, 37, 40                    two-terminal - element, 88                    - port, 447
   electrical output -, 39                                                                  shot
                                              resistor                                         - noise, 105, 118, 578
quiescent                                        - tolerances, 299, 302, 304, 307, 309      show stopper, 6, 17, 172, 186
   - losses, 65                                  noise-free -, 578                          shunt
   - operating current, 490                      passive nonlinear -, 487-490, 493, 496        input - feedback, 236
   - operating point, 88-90, 92, 160                                                           output - feedback, 236
                                              response, 525-527, 529, 531, 533              signal, 2, 10-14, 16, 18, 22-25, 28, 29
random                                           MFM -, 356, 359                               - source, 12, 15, 24
   - process, 515, 516                           step -, 69, 70, 77                            AC -, 512
   - signal modeling, 508                        unit impulse -, 69, 70, 526, 527, 529         deterministic - modeling, 508
                                                 unit step -, 526                              energy -, 508, 509
range                                                                                          load -, 36, 38, 76, 82, 236, 239
   midband frequency -, 354                   return difference, 326, 346, 347                 periodic -, 508, 511-514
                                              return path, 273, 285, 286, 493                  power -, 509
rate                                          return ratio, 346                                pulse -, 508-510, 512-514
   data -, 519, 520                           reverse                                          random - modeling, 508
   information -, 520                                                                          source -, 35, 36, 38, 56, 57, 65, 81, 234,
   slew - limitation, 170, 171                   - current, 102, 138-140, 146                        235, 239
                                                 - inversion coefficient, 138, 146             split - path, 503
ratio                                            - mode, 117, 127, 132                         unbounded -, 514
   common-mode rejection -, 54, 78, 79           - operation, 102, 103, 113, 132, 137, 141  signal-to-noise
   differential error-to-gain -, 353, 475        - transfer, 163                               - ratio, 232, 234, 245, 269
   performance-cost -, 6, 13, 16, 23          risk                                          sinc
   performance-to-cost -, 37, 81                 - management, 3, 6                            unit - pulse, 510
   signal-to-noise -, 232, 234, 245, 269         design -, 6                                single-loop
                                              RMS, 512, 515, 519                               - configuration, 244
reciprocal                                    roll-off                                      slew
   - two-port, 575                               high-frequency -, 385                         - rate limitation, 170, 171
                                                 low-frequency -, 385                       slew rate, 38, 75, 76, 82, 278, 285
recovery                                      root-locus, 418, 447                          small
   overdrive -, 75, 77, 82, 386, 431, 433,                                                     - geometry effects, 124
         438, 447                             safety, 7, 8                                  small-signal
                                              safety regulation, 42, 83                        - bandwidth, 38
reduction                                     saturation                                       - current gain, 108, 109
   bandwidth -, 386, 389                                                                       - dynamic behavior, 69, 70, 72, 82
   error - technique, 13, 23, 25, 28, 293,       - current, 102, 116, 120, 127, 487         solution
         297, 310, 312                           - region, 101, 112, 113, 116, 117, 120-       AC -, 547
                                                                                               DC -, 547, 553, 558, 566
reference                                              122, 127, 128, 132, 136, 139-143,       network -, 538, 542, 544, 575
   loop gain -, 325-331, 335, 340, 342, 344,           145, 146, 148, 151, 166, 168, 170,   source
         346-348                                       171, 176, 178, 185, 187-189, 194,       - signal, 35, 36, 38, 56, 57, 65, 81, 234,
                                                       195, 197, 200, 203, 204                       235, 239
region                                           - voltage, 487, 502                           - transformation, 245, 248
   cut-off -, 116, 117, 121, 127, 132, 136    scheme                                           bias current -, 72, 292, 293, 310, 488-
   linear -, 116, 117, 121, 122, 127, 132,       initial biasing -, 489-492, 494, 500                490, 493, 496
         136, 140, 142-145, 151, 164, 165,    second-order                                     bias voltage -, 72, 293, 490, 491, 496
         171                                     - MFM, 391                                    capacitive current -, 200, 201, 203
   saturation -, 101, 112, 113, 116, 117,     sensing                                          capacitive voltage -, 195, 196, 200
         120-122, 127, 128, 132, 136, 139-       load current -, 236, 256                      current - character, 487-490, 492, 493,
         143, 145, 146, 148, 151, 166, 168,      load voltage -, 236, 256                            495, 496, 500
         170, 171, 176, 178, 185, 187-189,       parallel -, 236, 241, 256                     dependent bias -, 86, 91
         194, 195, 197, 200, 203, 204            series -, 236, 241                            floating voltage -, 488, 489, 491, 502
                                              sensor, 2, 12, 29, 35, 39, 40                    independent bias -, 91
rejection                                     series                                           input noise -, 172, 173
   - factor, 56, 78, 79                          - feedback, 338, 339, 341, 344                noise -, 578, 579
   common-mode - ratio, 54, 78, 79               - sensing, 236, 241                           signal -, 12, 15, 24
   power supply -, 56, 79                        gate - resistance, 184                        voltage - character, 487, 489, 495
                                                 input - feedback, 236
reliability, 7, 8                                output - feedback, 236, 256
representation                                   Taylor -, 530
                                              servo
   current-controlled -, 574                     - bandwidth, 356, 362, 389, 419, 437,
   transmission-1 matrix -, 44, 575                    448
   two-port -, 536                               - function, 322, 327, 331, 334, 343-345,
   voltage-controlled -, 574
requirement
   operational -, 80
   performance -, 81
requirements
   controller -, 350
research, 3, 4, 6
source-referred                                    symbolic - analysis, 301                   tolerance                               309,
   - noise, 56, 57, 61, 63                      step                                             device -, 293, 296, 300, 301, 305,
                                                                                                       310                            334,
source-to-load                                     - response, 69, 70, 77                                                             347,
   - isolation, 53                                 unit -, 508, 510                           tolerances                              233-
   - transfer, 45, 46, 61, 231, 233-235, 240,      unit - response, 526                          resistor -, 299, 302, 304, 307, 309
         258                                    storage
                                                   energy -, 51, 65, 66, 69, 77               total
sources                                         strong                                           - biasing error, 305, 307
   bias -, 86, 89, 91, 93-96                       - inversion, 124-126, 137, 138, 140, 142,
                                                                                              transadmittance
specification                                            145, 148, 151, 176, 186-188, 194,       - amplifier, 287, 288
   performance -, 7, 10, 16                              197, 200, 203, 204                      - factor, 44, 166, 167, 170
                                                structured
spectral                                           - design approach, 10, 18                  transconductance
   - efficiency, 521                               - electronics design, 3, 13, 14, 17, 21       - efficiency, 142, 143
   power - density, 515, 518, 519, 527          superposition, 245, 248                          - factor, 117, 128, 137, 139
                                                   - model, 319, 324, 326, 339, 340
spectrum                                           linear -, 510, 511                         transducer, 12
   energy density -, 513                        supply                                           - mechanism, 39, 40
                                                   - voltage change, 299                         piezoelectric -, 39
speed                                              power - rejection, 56, 79
   - limitation, 53                             surface                                       transfer
                                                   - potential, 124, 125, 137                    - function, 527, 528
spice, 99-101, 103-106, 108, 110-112, 115,      switching                                        direct -, 322-324, 326-328, 331,
      116, 119, 121, 122, 125, 126, 129, 132,      - amplifier, 67                                     335, 337, 339, 340, 343, 345,
      134, 135, 139, 143, 147, 148              symbolic                                               348
                                                   - statistical analysis, 301
split                                           system                                           feedback -, 346
   - signal path, 503                              - modeling, 524                               forward -, 346
                                                   information processing -, 2, 10, 13, 14,      reverse -, 163
splitting                                                16                                      source-to-load -, 45, 46, 61, 231,
   pole -, 475, 476, 481                           minimum phase -, 529
                                                systems                                                235, 240, 258
square                                             - engineering, 3, 13                          voltage -, 162-164, 171
   mean - value, 509, 511, 512, 515, 518                                                         voltage-to-current -, 162, 163
                                                task                                          transfers
stability                                          information processing -, 2                   unity-gain MFM -, 355
   Nyquist - criterion, 374, 375                                                              transform
                                                Taylor                                           Fourier -, 508, 513, 518, 527
stable, 525, 527, 529                              - series, 530                                 Hilbert -, 529
stage                                                                                            Laplace -, 509, 514, 526, 527, 529
                                                technique                                     transformation
   anti-series -, 218, 221, 225, 490, 496, 500     error reduction -, 13, 23, 25, 28, 293,       noise -, 61
   cascode -, 471, 475, 476, 478, 481-483                297, 310, 312                           source -, 245, 248
   CD -, 451-453, 455-457, 459, 461, 463,                                                     transformations
                                                technological                                    network -, 542
         492, 500                                  - limitation, 36-38, 53                    transformer, 35, 44, 51
   CG -, 452, 458-461, 492, 496                                                               transformer-like
   common-drain -, 451                          technology                                       - configuration, 47
   complementary-parallel -, 218, 226,             - current, 137, 138, 140                   transient
                                                   - development, 4                              - analysis, 99
         227, 501, 502                                                                        transimpedance, 177, 178, 184
   CS -, 160, 161, 163, 165-167, 170-173,       temperature                                      - amplifier, 286-288
                                                   - variation, 293, 312, 313                    - factor, 44, 167, 168, 170
         177-189, 194, 196, 197, 200-204,          noise -, 580                               transmission
         467-469, 471, 473-476, 482, 483,                                                        - line, 40
         489-492, 496, 499, 501, 503, 504       THD, 74, 531, 532, 534                        transmission-1
   direct feedback -, 451, 463                  theorem                                          - matrix parameters, 92, 160, 166
   indirect feedback -, 463                                                                      - matrix representation, 44, 575
   intermediate -, 476                             Parseval's -, 511-513                      transport
   intrinsic CS -, 160-166, 170, 172, 176,         Wiener-Khintchine -, 518                      - current, 102, 103
         184, 185                               thermal                                       tree, 537
   local feedback -, 462, 471, 473-476, 482,       - noise, 578, 579                          two-port, 536, 571, 572, 574-576
         483                                    thickness                                        - conditions, 572
                                                   oxide -, 124                                  - model, 572
   nonenergic feedback -, 451, 452, 458         third-order                                      - representation, 536
   push-pull -, 223, 225-228                       - MFM, 400                                    balanced -, 216
stamp                                           time                                             natural -, 571, 574
   matrix -, 536, 547, 550, 553-556                - average, 515, 516                           noise-free -, 57, 58, 61, 62
   MNA -, 547, 548, 550                            continuous -, 524, 525                        noisy -, 581
   NA -, 547, 548, 550                             discrete -, 524                               nonenergic -, 576
standard                                        time-constant                                    nonlinear resistive -, 91
   - deviation, 519                                - matrix, 553, 556-558, 560, 561, 563,        reciprocal -, 575
state                                                                                            unilateral -, 576
   - equation, 557, 558                                  565-568
   non-controllable -, 380                      time-variant, 524, 533
   non-observable -, 381
static
   - error, 444
   - inaccuracy, 351, 352, 354
stationary, 508, 516-518, 524, 525
   - process, 516, 518
statistical
two-step                                        - gain factor, 44, 49, 50, 166           voltage-dependent
   - design approach, 318, 319, 322, 326,       - limiting mechanism, 170                   - junction capacitance, 101, 117
         327, 334                               - mirror, 463
                                                - source character, 487, 489, 495        voltage-feedback
two-terminal                                    - transfer, 162-164, 171                    - operational amplifier, 272, 273, 278,
   - network element, 550                       bias -, 292, 294, 295                             279, 477
   - resistive element, 88                      bias - source, 72, 293, 490, 491, 496
                                                branch -, 537, 542, 543, 545, 547, 554,  voltage-to-current
unbounded                                                                                   - transfer, 162, 163
   - signal, 514                                      557
                                                                                         Ward-Dutton
unilateral, 35, 40, 46-48, 50, 79, 565, 576     capacitive - source, 195, 196, 200          - capacitance model, 136
   - two-port, 576                              common-mode -, 42, 43, 54, 56
                                                common-mode bias -, 73                   weak
unit                                            common-mode input -, 273, 276, 284,         - inversion, 124, 125, 137, 138, 142, 145,
   - Gaussian pulse, 510                                                                          148, 151
   - impulse, 508, 510                                285
   - impulse response, 69, 70, 526, 527,                                                 weighting
         529                                    differential - amplifier, 288               - function, 57
   - sinc pulse, 510                            differential-mode -, 43, 54, 56
   - step, 508, 510                             differential-mode port -, 572, 573       Wiener-Khintchine
   - step response, 526                         floating - source, 488, 489, 491, 502       - theorem, 518
                                                input - feedback, 236
unity-gain                                      load - sensing, 236, 256                 worst-case
   - MFM transfers, 355                         nodal -, 537, 538, 543-545, 547, 554,       - analysis, 300

unstable, 527                                         557, 572, 573                      zero
                                                noise -, 578, 579, 581                      active phantom -, 420, 421, 444
value                                           offset -, 273, 276, 284, 286                effective -, 406
   mean square -, 509, 511, 512, 515, 518       output - feedback, 236                      effective phantom -, 412-414
                                                saturation -, 487, 502                      phantom -, 388-391, 394-396, 399-409,
variation                                       supply - change, 299                              411-417, 419-424, 427, 428, 431,
   temperature -, 293, 312, 313              voltage-controlled, 87, 88, 90                       433, 437, 441, 442, 444-446, 448
                                                - element, 536, 537, 544, 554
VFMR, 139, 140, 145                             - notation, 543                          zero-frequency
vibration, 37, 82                               - representation, 574                       - poles, 564, 565
voltage
                                                                                         zeros, 70, 71, 536, 541, 544, 553, 556, 557,
   - comparison, 236-238, 242, 256, 270                                                        561, 563, 569-571
   - follower, 451, 452, 463
Structured Electronics Design -

A conceptual approach to amplifier design - 3rd ed.

Anton J.M. Montagne

Many people consider analog electronic circuit design complex. This is
because theoretical concepts, circuit topologies, electronic devices, their
operating conditions, and the system's physical construction constitute an
enormous design space in which it is easy to get lost. For this reason, analog
electronics often is regarded as an art rather than a solid discipline.

Structured Electronics Design:

· Defines a step-by-step hierarchically organized design process.
· Is based on solid principles from systems engineering, physics, signal

      processing, control theory, and network theory.
· Provides a solid foundation for circuit design education and automation.
· Has been developed at the TU Delft since the 1980s.

Anton J.M. Montagne TU Delft | Fac. EEMCS                                       © 2023 TU Delft Open
                                                                                ISBN 978-94-6366-712-8
Anton Montagne (Leiden, The Netherlands, 1953)                                  DOI: https://doi.org/10.59490/t.2023.005
received his master's degree in 1984 at the Delft
University of Technology. In 1983, he joined Philips                            textbooks.open.tudelft.nl
Semiconductors in Nijmegen where he designed analog
integrated circuits for audio and video applications.                           Cover image: Delfi - PQ, TU Delft
At Philips, he also developed training courses on                               with credits to Mlabspace, no
analog electronics. In 1989, together with Catena                               further use allowed.
Microelectronics, the Delft University of Technology
and the Institute of Microelectronics in Stuttgart, he
cooperated in the development of an intensive training
course, covering many topics of analog circuit design.
Since 1997, he works as an independent consultant,
trainer and designer in the field of analog circuit design.
Over the past 38 years, he developed analog electronics
for instrumentation and communication systems and
carried out many training courses on analog electronics.
Since 2016 Anton Montagne is coaching students
and giving lectures and masterclasses "Structured
Electronics Design" at the Delft University of Technology.
