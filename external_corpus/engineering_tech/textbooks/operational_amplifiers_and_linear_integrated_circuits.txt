Operational Amplifiers & Linear Integrated Circuits:
Theory and Application / 3E

                                                          James M. Fiore
2
 Operational Amplifiers & Linear Integrated Circuits:
                 Theory and Application

                                                                  by
                                                         James M. Fiore
                                             Version 3.2.11, 16 October 2024

3
This Operational Amplifiers & Linear Integrated Circuits: Theory and Application, by James M. Fiore is
              copyright James M. Fiore, and released under the terms of a Creative Commons license:

               This work is freely redistributable for non-commercial use, share-alike with attribution
              Device datasheets and other product information are copyright by their respective owners

                                         Published by James M. Fiore via dissidents
                                                    ISBN13: 978-1796856897

For more information or feedback, contact:
James Fiore, Professor Emeritus
oer@jimfiore.org
jfiore@mvcc.edu
For the latest revisions, related titles, and links to low cost print versions, go to:
www.mvcc.edu/jfiore or my mirror sites www.dissidents.com and www.jimfiore.org
YouTube Channel: Electronics with Professor Fiore
Cover art, Canadian Shield II, by the author

4
Preface

Welcome to the third edition of this text! The first edition was written circa 1990 and was published by West
Publishing. The title was then purchased by Delmar/Thomson/Cengage some years later and a new edition was
written around 2000 (although it was never tagged as a second edition). That version added a companion
laboratory manual. In the early 2000s the text went from hard cover to soft cover, and in early 2016, Cengage
decided to revert the copyright back to me, the original and singular author. Having already produced a number
of OER (Open Educational Resource) titles including a microcontroller text using the Arduino platform and
numerous laboratory manuals covering DC circuits, AC circuits, Python programming and discrete electronic
devices, it was an obvious decision to go the same route with this book. This third edition includes new specialty
ICs and rewrites of certain sections. If you need information on obsolete legacy ICs such as the NE565,
ICL8038, etc., an OER second edition is available (and for you fans of analog computing, Chapter 10 remains).
The OER lab manual to accompany this text has also been updated to the third edition. It features new exercises
and expansions of the existing ones. If you have any questions regarding the text or lab manual, or are interested
in contributing to the project, do not hesitate to contact me. Finally, note that the most recent versions of all of
my OER texts and manuals on electronics, circuit analysis and programming may be found at my MVCC web
site as well as my mirror site: www.dissidents.com The original Preface follows, slightly modified.

The goal of this text, as its name implies, is to allow the reader to become proficient in the analysis and design
of circuits utilizing modern linear ICs. It progresses from the fundamental circuit building blocks through to
analog/digital conversion systems. The text is intended for use in a second year Operational Amplifiers course at
the Associate level, or for a junior level course at the Baccalaureate level. In order to make effective use of this
text, students should have already taken a course in basic discrete transistor circuits, and have a solid
background in algebra and trigonometry, along with exposure to phasors. Calculus is used in certain sections of
the text, but for the most part, its use is kept to a minimum. For students without a calculus background, these
sections may be skipped without a loss of continuity. (The sole exception to this being Chapter Ten, Integrators
and Differentiators, which hinges upon knowledge of calculus.)

In writing this text, I have tried to make it ideal for both the teacher and the student. Instead of inundating the
student with page after page of isolated formulas and collections of disjunct facts and figures, this text relies on
building a sound foundation first. While it may take just a little bit longer to "get into" the operational amplifier
than a more traditional approach, the initial outlay of time is rewarded with a deeper understanding and better
retention of the later material. I tried to avoid creating formulas out of thin air, as is often done for the sake of
expediency in technical texts. Instead, I strove to provide sufficient background material and proofs so that the
student is never left wondering where particular formulas came from, or worse, coming to the conclusion that
they are either too difficult to understand completely, or are somehow "magic".

The text can be broken into two major sections. The first section, comprised of Chapters One through Six, can
be seen as the foundation of the operational amplifier. Here, a methodical, step by step presentation is used to
introduce the basic idealized operational amplifier, and eventually examine its practical limitations with great
detail. These chapters should be presented in order. The remaining six chapters comprise a selection of popular
applications, including voltage regulation, oscillators, and active filters, to name a few. While it is not
imperative that these chapters be presented in the order given (or for that matter, that they all be covered), the
present arrangement will probably result in the most natural progression. Treat these chapters as application
reference material and shape the presentation to your needs.

5
There are a few points worth noting about certain chapters. First, Chapter One presents material on decibels,
Bode plots, and the differential amplifier, which is the heart of most operational amplifiers. This chapter may be
skipped if your curriculum covers these topics in a discrete semiconductor or circuit analysis course. In this
case, it is recommended that students scan the chapter in order to familiarize themselves with the nomenclature
used later in the text. As part of the focus on fundamentals, a separate chapter on negative feedback (Chapter
Three) is presented. This chapter examines the four basic negative feedback connections that might be used with
an operational amplifier, and details the action of negative feedback in general. It stresses the popular series-
parallel (VCVS or non-inverting voltage amplifier) form to show how bandwidth, distortion, input impedance,
etc. are affected. Chapter Six presents a variety of modern special purpose devices for specific tasks, such as
high load current, programmable operation, and very high speed. An extensive treatment of active filters is
given in Chapter Eleven. Unlike many texts which use a "memorize this" approach to this topic, Chapter Eleven
strives to explain the underlying operation of the circuits, yet it does so without the more advanced math
requirement of the classical engineering treatment. The final chapter, Chapter Twelve, serves as a bridge
between the analog and digital worlds, covering analog to digital to analog conversion schemes. Please bare in
mind that entire books have been written on the topics of active filters and analog/digital systems. Chapters
Eleven and Twelve are designed as introductions to these topics, not as the final, exhaustive word.

At the beginning of each chapter is a set of chapter objectives. These point out the major items of importance
that will be discussed. Following the chapter objectives is an introduction. The introduction sets the stage for the
upcoming discussion, and puts the chapter into perspective with the text as a whole. At the end of each chapter
is a summary and a set of review questions. The review questions are of a general nature, and are designed to
test for retention of circuit and system concepts. Finally, each chapter has a problem set. For most chapters, the
problems are broken into four categories: analysis problems, design problems, challenge problems, and
computer simulation (SPICE) problems. An important point here was in including problems of both sufficient
variety and number. An optional coverage extended topic may also be found at the end of many chapters. An
extended topic is designed to present extra discussion and detail on a certain portion of a chapter. This allows
you to customize the chapter presentation to a certain degree. Not everyone will want to cover every extended
topic. Even if they aren't used as part of the normal run of the course, they do allow for interesting side reading,
possible outside assignments, and launching points for more involved discussions.

Integrated with the text are examples using popular SPICE-based circuit simulation packages and derivatives
such as the commercial offerings NI Multisim and Orcad PSpice, or free versions such as Texas Instruments'
TINA-TI and LTspice from Analog Devices. If you are not using computer simulations in your courses, these
items may be skipped over with little loss of continuity, however, if you are using simulations, I think that you
will find that this integrated approach can be very worthwhile. Generally, simulations should not be used in
place of a traditional analysis, and with this in mind, many of the examples are used to verify the results of
manual calculations, or to investigate second-order effects which may be too time consuming otherwise.
Computer simulations are also very valuable in the classroom and laboratory as a means of posing "what if"
questions. Some of the items explored include the effects of different op amp models, sensitivity to parameter
sweeps, and the usage of Monte Carlo analysis to investigate typical production spreads. The circuits are
presented using the schematic capture window of Multisim. Although Multisim's schematic editor and output
graphing tools are shown, the figures would be similar in other popular packages. At this level, the differences
between the input and output figures of the various packages are largely cosmetic. In general, any quality
SPICE-based simulator will be sufficient for the circuits presented in this book.

6
Finally, there are two elements included in this text which I always longed for when I was a student. First,
besides the traditional circuit examples used to explain circuit operation, a number of schematics of have been
included to show how a given type of circuit might be used in the real world. It is one thing to read how a
precision rectifier works, it is quite another thing to see how one is being used in an audio power amplifier as
part of an overload protection scheme.

The second element deals with the writing style of this text. I have tried to be direct and conversational, without
being overly cute or "chatty". The body of this text is not written in a passive formal voice. It is not meant to be
impersonal and cold. Instead, it is meant to sound as if someone were explaining the topics to you over your
shoulder. It is intended to draw you into the topic, and to hold your attention. Over the years, I have noticed that
some people feel that in order to be taken seriously, a topic must be addressed in a detached, almost antiseptic
manner. While I will agree that this mindset is crucial in order to perform a good experiment, it does not
translate particularly well to textbooks, especially at the undergraduate level. The result, unfortunately, is a
thorough but thoroughly unreadable book. If teachers find a text to be uninteresting, it shouldn't be surprising if
the students feel the same. I hope that you will find this text to be serious, complete and engaging.

Acknowledgements

In a project of this size, there are many people who have done their part to shape the result. Some have done so
directly, others indirectly, and still others without knowing that they did anything at all. First, I'd like to thank
my wife Karen, family and friends for being such "good eggs" about the project, even if it did mean that I
disappeared for hours on end in order to work on it. For their encouragement and assistance, my fellow faculty
members and students. For reverting the copyright back to me so that I could make an OER text, Cengage
Publishing. Finally, I'd like to thank the various IC and equipment manufacturers for providing pertinent data
sheets, schematics, and photographs.

For potential authors, this text was created using several free and open software applications including Open
Office and Dia, along with a few utilities I created myself. The filter graphs found in Chapter Eleven were
created using SciDAVis. Screen imagery was often manipulated though the use of XnView.

I cannot say enough about the emerging Open Educational Resource movement and I encourage budding
authors to consider this route. While there are (generally) no royalties to be found, having complete control over
your own work (versus the "work for hire" classification of typical contracts) is not to be undervalued. Neither
should contributions to the profession or the opportunity to work with colleagues be dismissed. Given the
practical aspects of the society in which we live, I am not suggesting that people "work for free". Rather,
because part of the mission of institutes of higher learning is to promote and disseminate formalized instruction
and information, it is incumbent on those institutions to support their faculty in said quest, whether that be in the
form of sabbaticals, release time, stipends or the like.

Finally, it is still no lie to say that I couldn't have completed this project without my personal computers; a stack
of Frank Zappa, Kate Bush, King Crimson, Stravinsky and Bartk CDs; and the endless stream of healthy and
tasty goodies flowing from Karen's kitchen.

- Jim Fiore, February, 2000, ed. 2016

7
                                                             For Karen

                                           

                                "Information is not knowledge, knowledge is not wisdom."
                                                          -- Frank Zappa

                                                  "Training is not education."
                                                               -- Anon

                                                 "My hovercraft is full of eels."
                                                         -- Monty Python

8
Table of Contents

Chapter 1: Introductory Concepts and Fundamentals              15

Chapter Objectives .           .        .  .          .  .  .  15
1.1 Introduction   .           .        .  .          .  .  .  15

   Variable Naming Convention                                  16

1.2 The Decibel .  .           .        .  .          .  .  .  17

   Decibel Representation of Power and Voltage Gains           17

   Signal Representation in dBW and dBV                        23

   Items Of Interest In The Laboratory                         25

1.3 Bode Plots .   .           .        .  .          .  .  .  27

   Lead Network Gain Response                                  28

   Lead Network Phase Response                                 31

   Lag Network Response                                        33

   Rise Time versus Bandwidth                                  36

1.4 Combining The Elements - Multi-Stage Effects .       .  .  38

1.5 Circuit Simulations Using Computers    .          .  .  .  40
1.6 The Differential Amplifier .        .  .          .  .  .  43

   DC Analysis                                                 43

   Input Offset Current and Voltage                            46

   AC Analysis                                                 46

   Common Mode Rejection                                       53

   Current Mirror                                              55

Summary .          .           .        .  .          .  .  .  58

Review Questions .             .        .  .          .  .  .  58
Problem Set .      .           .        .  .          .  .  .  59

Chapter 2: Operational Amplifier Internals                     63

Chapter Objectives .           .        .  .          .  .  .  63

2.1 Introduction   .           .        .  .          .  .  .  63
2.2 What Is An Op Amp?         .        .  .          .  .  .  63

   Block Diagram Of An Op Amp                                  64

   A Simple Op Amp Simulation Model                            69

   Op Amp Data Sheet and Interpretation                        70

2.3 Simple Op Amp Comparator            .  .          .  .  .  74

2.4 Op Amp Manufacture .                .  .          .  .  .  78

   Monolithic Construction                                     78

   Hybrid Construction                                         80

Summary .          .           .        .  .          .  .  .  81
Review Questions .             .        .  .          .  .  .  81

Problem Set .      .           .        .  .          .  .  .  82

9
Chapter 3: Negative Feedback                                   85

Chapter Objectives .             .       .         .  .  .  .  85
3.1 Introduction        .        .       .         .  .  .  .  85

3.2 What Negative Feedback Is and Why We Use It .        .  .  85
3.3 Basic Concepts .             .       .         .  .  .  .  86

    The Effects of Negative Feedback                           87

3.4 The Four Variants of Negative Feedback .          .  .  .  90

    Series-Parallel (SP)                                       91

    SP Impedance Effects                                       98

    Distortion Effects                                         102

    Noise                                                      106

    Parallel-Series (PS)                                       106

    PS Impedance Effects                                       109

    Parallel-Parallel (PP) and Series-Series (SS)              111

3.5 Limitations On The Use of Negative Feedback .        .  .  112

Summary .               .        .       .         .  .  .  .  113
Review Questions .               .       .         .  .  .  .  113

Problem Set             .        .       .         .  .  .  .  114

Chapter 4: Basic Op Amp Circuits                               117

Chapter Objectives .             .       .         .  .  .  .  117
4.1 Introduction        .        .       .         .  .  .  .  117

4.2 Inverting and Non-inverting Amplifiers .          .  .  .  118

    The Non-inverting Voltage Amplifier                        118

    Inverting Voltage Amplifier                                122

    Inverting Current-to-Voltage Transducer                    126

    Non-inverting Voltage-to-Current Transducer                127

    Inverting Current Amplifier                                130

    Summing Amplifiers                                         133

    Non-Inverting Summing Amplifier                            136

    Differential Amplifier                                     139

    Adder/Subtractor                                           141

    Adjustable Inverter/Non-inverter                           142

4.3 Single Supply Biasing .              .         .  .  .  .  143
4.4 Current Boosting .           .       .         .  .  .  .  146

Summary .               .        .       .         .  .  .  .  148
Review Questions .               .       .         .  .  .  .  149

Problem Set             .        .       .         .  .  .  .  149

Chapter 5: Practical Limitations of Op Amp Circuits            156

Chapter Objectives .             .       .         .  .  .  .  156
5.1 Introduction        .        .       .         .  .  .  .  156

5.2 Frequency Response           .       .         .  .  .  .  156
5.3 Gain-Bandwidth Product .             .         .  .  .  .  157

    Multi-stage Considerations                                 163

10
           Low Frequency Limitations                                             168

5.4 Slew Rate and Power Bandwidth .                  .  .  .                  .  169

           The Effect of Slew Rate on Pulse Signals                              171

           The Effect of Slew Rate on Sinusoidal Signals and Power Bandwidth     172

           Design Hint                                                           176

           Slew Rate and Multiple Stages                                         177

           Non-Compensated Devices                                               178

           Feedforward Compensation                                              178

           De-compensated Devices                                                179

5.5 Offsets .               .         .     .        .  .  .                  .  180

           Offset Sources and Compensation                                       180

5.6 Drift  .                .         .     .        .  .  .                  .  187
5.7 CMRR and PSRR .                   .     .        .  .  .                  .  189

5.8 Noise  .                .         .     .        .  .  .                  .  191
Summary .                   .         .     .        .  .  .                  .  196

Review Questions .                    .     .        .  .  .                  .  197
Problem Set .               .         .     .        .  .  .                  .  197

Chapter 6: Specialized Op Amps                                                   201

Chapter Objectives .                  .     .        .  .  .                  .  201

6.1 Introduction            .         .     .        .  .  .                  .  201
6.2 Instrumentation Amplifiers .            .        .  .  .                  .  202

6.3 Programmable Op Amps .                  .        .  .  .                  .  211
6.4 Op Amps for High Current, Power, and Voltage Applications                 .  214

           High Current Devices                                                  215

           High Voltage Devices                                                  218

6.5 High Speed Amplifiers .                 .        .  .  .                  .  219

6.6 Voltage Followers and Buffers .                  .  .  .                  .  220
6.7 Operational Transconductance Amplifier .            .  .                  .  221

6.8 Norton Amplifier .                .     .        .  .  .                  .  225
6.9 Current Feedback Amplifiers             .        .  .  .                  .  232

6.10 Other Specialized Devices              .        .  .  .                  .  237
Summary .                   .         .     .        .  .  .                  .  238

Review Questions .                    .     .        .  .  .                  .  238
Problem Set .               .         .     .        .  .  .                  .  239

Chapter 7: Nonlinear Circuits                                                    243

Chapter Objectives .                  .     .        .  .  .                  .  243

7.1 Introduction            .         .     .        .  .  .                  .  243
7.2 Precision Rectifiers .            .     .        .  .  .                  .  244

           Peak Detector                                                         248

           Precision Full-Wave Rectifier                                         251

7.3 Wave Shaping .                    .     .        .  .  .                  .  254

           Active Clampers                                                       254

           Active Limiters                                                       260

11
7.4 Function Generation       .         .  .        .   .  .  262
7.5 Comparators         .     .         .  .        .   .  .  273

7.6 Log and Anti-Log Amplifiers         .  .        .   .  .  282

    Four-Quadrant Multiplier                                  286

7.7 Extended Topic: A Precision Log Amp .           .   .  .  289
Summary .               .     .         .  .        .   .  .  292

Review Questions .            .         .  .        .   .  .  293
Problem Set .           .     .         .  .        .   .  .  293

Chapter 8: Voltage Regulation                                 298

Chapter Objectives .          .         .  .        .   .  .  298

8.1 Introduction        .     .         .  .        .   .  .  298
8.2 The Need For Regulation .           .  .        .   .  .  299

8.3 Linear Regulators         .         .  .        .   .  .  301

    Three Terminal Devices                                    305

    Current Boosting                                          309

    Low Dropout Regulators                                    310

    Programmable and Tracking Regulators                      310

8.4 Switching Regulators      .         .  .        .   .  .  323
8.5 Heat Sink Usage .         .         .  .        .   .  .  333

    Physical Requirements                                     334

    Thermal Resistance                                        334

8.6 Extended Topic: Primary Switcher .     .        .   .  .  338

Summary .               .     .         .  .        .   .  .  339
Review Questions .            .         .  .        .   .  .  340

Problem Set .           .     .         .  .        .   .  .  341

Chapter 9: Oscillators and Frequency Generators               344

Chapter Objectives .          .         .  .        .   .  .  344
9.1 Introduction        .     .         .  .        .   .  .  344

9.2 Op Amp Oscillators .      .         .  .        .   .  .  345

    Positive Feedback and the Barkhausen Criterion            345

    A Basic Oscillator                                        346

    Wien Bridge Oscillator                                    347

    Phase Shift Oscillator                                    353

    Square/Triangle Function Generator                        360

9.3 Single Chip Oscillators and Frequency Generators .  .  .  371

    Square Wave/Clock Generator                               371

    Voltage-Controlled Oscillator                             373

    Phase-Locked Loop                                         379

    555 Timer                                                 382

    555 Monostable Operation                                  383

    555 Astable Operation                                     385

12
Summary .                .       .    .         .        .     .   .  388
Review Questions .               .    .         .        .     .   .  389

Problem Set .            .       .    .         .        .     .   .  389

Chapter 10: Integrators and Differentiators                           396

Chapter Objectives .             .    .         .        .     .   .  396
10.1 Introduction .              .    .         .        .     .   .  396

10.2 Integrators         .       .    .         .        .     .   .  397

    Accuracy and Usefulness of Integration                            399

    Optimizing the Integrator                                         399

    Analyzing Integrators with the Time-Continuous Method             403

    Analyzing Integrators with the Time-Discrete Method               405

10.3 Differentiators .           .    .         .        .     .   .  410

    Accuracy and Usefulness of Differentiation                        411

    Optimizing the Differentiator                                     412

    Analyzing Differentiators with the Time-Continuous Method         413

    Analyzing Differentiators with the Time-Discrete Method           416

10.4 Analog Computer .           .    .         .        .     .   .  423
10.5 Alternatives to Integrators and Differentiators               .  426

10.6 Extended Topic: Other Integrator and Differentiator Circuits  .  426
Summary .                .       .    .         .        .     .   .  428

Review Questions .               .    .         .        .     .   .  429
Problem Set .            .       .    .         .        .     .   .  430

Chapter 11: Active Filters                                            435

Chapter Objectives .             .    .         .        .     .   .  435

11.1 Introduction .              .    .         .        .     .   .  435
11.2 Filter Types        .       .    .         .        .     .   .  436

11.3 The Use and Advantages of Active Filters .          .     .   .  437
11.4 Filter Order and Poles .         .         .        .     .   .  438

11.5 Filter Class or Alignment .      .         .        .     .   .  439

    Butterworth                                                       441

    Bessel                                                            441

    Chebyshev                                                         441

    Elliptic                                                          443

    Other Possibilities                                               443

11.6 Realizing Practical Filters .    .         .        .     .   .  443

    Sallen and Key VCVS Filters                                       443

    Sallen and Key Low-Pass Filters                                   446

    Sallen and Key High-Pass Filters                                  456

    Filters of Higher Order                                           459

11.7 Band-Pass Filter Realizations .            .        .     .   .  471

    Multiple-Feedback Filters                                         472

    State-Variable Filter                                             478

13
11.8 Notch Filter (Band-Reject) Realizations .          .            .  .  483

    A Note on Component Selection                                          486

    Filter Design Tools                                                    487

11.9 Audio Equalizers .     .      .                 .  .            .  .  487
11.10 Switched-Capacitor Filters   .                 .  .            .  .  491

11.11 Extended Topic: Voltage-Controlled Filters        .            .  .  495
Summary .                .  .      .                 .  .            .  .  497

Review Questions .          .      .                 .  .            .  .  498
Problem Set .            .  .      .                 .  .            .  .  499

Chapter 12: Analog-to-Digital-to-Analog Conversion                         503

Chapter Objectives .        .      .                 .  .            .  .  503

12.1 Introduction .         .      .                 .  .            .  .  503

    The Advantages and Disadvantages of Working in the Digital Domain      504

12.2 The Sampling Theorem .        .                 .  .            .  .  505
12.3 Resolution and Sampling Rate .                  .  .            .  .  506

12.4 Digital-to-Analog Conversion Techniques .          .            .  .  511

    Practical Digital-to-Analog Converter Limits                           516

    Digital-to-Analog Converter Integrated Circuits                        520

    Applications of Digital-to-Analog Converter Integrated Circuits        527

12.5 Analog-to-Digital Conversion .                  .  .            .  .  531

    Analog-to-Digital Conversion Techniques                                535

    Analog-to-Digital Converter Integrated Circuits                        538

    Applications of Analog-to-Digital Converter Integrated Circuits        544

12.6 Extended Topic: Digital Signal Processing .        .            .  .  548
Summary .                .  .      .                 .  .            .  .  551

Review Questions .          .      .                 .  .            .  .  552
Problem Set .            .  .      .                 .  .            .  .  552

Appendices                                                                 555

A: Manufacturer's Data Sheet Links .                 .  .            .  .  555
B: Standard Component Sizes .      .                 .  .            .  .  557

C: Answers to Selected Review Questions .               .            .  .  558
D: Answers to Selected Numbered Problems .              .            .  .  569

14
1 Introductory Concepts and Fundamentals

Chapter Learning Objectives

After completing this chapter, you should be able to:

              · Convert between ordinary and decibel based power and voltage gains.
              · Utilize decibel-based voltage and power measurements during circuit analysis.
              · Define and graph a general Bode plot.
              · Detail the differences between lead and lag networks, and graph Bode plots for each.
              · Combine the effects of several lead and lag networks together in order to determine a system

                   Bode plot.
              · Describe the use of digital computers in the area of circuit simulation.
              · Analyze differential amplifiers for a variety of AC characteristics, including single ended and

                   differential voltage gains.
              · Define common-mode gain and common-mode rejection.
              · Describe a current mirror and note typical uses for it.

1.1 Introduction

Before we can begin our study of the operational amplifier, it is very important that certain background elements
be in place. The purpose of this chapter is to present the very useful analysis concepts and tools associated with
the decibel measurement scheme and the frequency domain. We will also be examining the differential amplifier
that serves as the heart of most operational amplifiers. With a thorough working knowledge of these items, you
will find that circuit design and analysis will proceed at a much quicker and more efficient pace. Consider this
chapter as an investment in time, and treat it appropriately.

The decibel measurement scheme is in very wide use, particularly in the field of communications. We will be
examining its advantages over the ordinary system of measurement, and how to convert values of one form into
the other. One of the more important parameters of a circuit is its frequency response. To this end, we will be
looking at the general frequency domain representations of a circuit's gain and phase. This will include both
manual and computer generated analysis and graphing techniques. While our main emphasis will eventually
concentrate on application with operational amplifiers, the techniques explored can be applied equally to
discrete circuits. Indeed, our initial examples will use simple discrete or black box circuits exclusively.

Finally, we will examine the DC and AC operation of the differential amplifier. This is an amplifier that utilizes
two active devices and offers dual inputs. It offers certain features that make it suitable as the first section of
most operational amplifiers.

15
Variable Naming Convention

One item that often confuses students of almost any subject is nomenclature. It is
important, then, that we decide upon a consistent naming convention at the outset.
Throughout this text, we will be examining numerous circuits containing several
passive and active components. We will be interested in a variety of parameters and
signals. Although we will utilize the standard conventions, such as fc for critical
frequency and Xc for capacitive reactance, a great number of other possibilities exist.
In order to keep confusion to a minimum, we will use the following conventions in
our equations for naming devices and signals that haven't been standardized.

    R  Resistor (DC, or actual circuit component)

    r  Resistor (AC equivalent, where phase is 0 or ignored)

    C  Capacitor

    L  Inductor

    Q  Transistor (Bipolar or FET)

    D  Diode

    V  Voltage (DC)

    v  Voltage (AC)

    I  Current (DC)

    i  Current (AC)

Resistors, capacitors and inductors are differentiated via a subscript that usually
refers to the active device it is connected to. For example, RE is a DC bias resistor
connected to the emitter of a transistor, while rC refers to the AC equivalent
resistance seen at a transistor's collector. CE refers to a capacitor connected to a
transistor's emitter lead (most likely a bypass or coupling capacitor). Note that the
device related subscripts are always shown in upper case, with one exception: If the
resistance or capacitance is part of the device model, the subscript will be shown in
lower case to distinguish it from the external circuit components. For example, the
AC dynamic resistance of a diode would be called rd. If no active devices are
present, or if several items exist in the circuit, a simple numbering scheme is used,
such as R1. In very complex circuits, a specific name will be given to particularly
important components, as in Rsource.

Voltages are normally given a two-letter subscript indicating the nodes at which it is
measured. VCE is the DC potential from the collector to the emitter of a transistor,
while vBE indicates the AC signal appearing across a transistor's base-emitter
junction. A single-letter subscript, as in VB, indicates a potential relative to ground
(in this case, base to ground potential). The exceptions to this rule are power
supplies, that are given a double letter subscript indicating the connection point (VCC
is the collector power supply), and particularly important potentials that are directly
named, as in vin (AC input voltage) and VR1 (DC voltage appearing across R1). If an
equation for a specific potential is valid for both the AC and DC equivalent circuits,
the uppercase form is preferred (this makes things much more consistent with the

16
vast majority of op amp circuits that are directly coupled, and thus can amplify both
AC and DC signals). Currents are named in a similar way, but generally use a single
subscript referring to the measurement node (IC is the DC collector current). All
other items are directly named. By using this scheme, you will always be able to
determine whether the item expressed in an equation is a DC or AC equivalent, its
approximate circuit location, and other factors about it.

1.2 The Decibel

Most people are familiar with the term "decibel" in reference to sound pressure. It's
not uncommon to hear someone say something such as "It was 110 decibels at the
concert last night, and my ears are still ringing." This popular use is somewhat
inaccurate, but does show that decibels indicate some sort of quantity -- in this case,
sound pressure level.

Decibel Representation of Power and Voltage Gains

In its simplest form, the decibel is used to measure some sort of gain, such as power
or voltage gain. Unlike the ordinary gain measurements that you may be familiar
with, the decibel form is logarithmic. Because of this, it can be very useful for
showing ratios of change, as well as absolute change. The base unit is the Bel. To
convert an ordinary gain to its Bel counterpart, just take the common log (base 10)
of the gain. In equation form:

                              Bel gain=log10(ordinary gain)

Note that on most hand calculators common log is denoted as "log" while the natural
log is given as "ln". Unfortunately, some programming languages use "log" to
indicate natural log and "log10" for common log. More than one student has been
bitten by this bug, so be forewarned! As an example, if a circuit produces an output
power of 200 milliwatts for an input of 10 milliwatts, we would normally say that it
has a power gain of:

                                G= Pout
                                     Pin

                                G=200 mW 10 mW
                                G= 20

For the Bel version, just take the log of this result.

                              G '=log10G
                              G '=log1020
                              G '=1.301

17
The Bel gain is 1.3 Bels. The term "Bels" is not a unit in the strict sense of the word
(as in "watts"), but is simply used to indicate that this is not an ordinary gain. In
contrast, ordinary power and voltage gains are sometimes given units of W/W and
V/V to distinguish them from Bel gains. Also, note that the symbol for Bel power
gain is G' and not G. All Bel gains are denoted with the following prime (') notation
to avoid confusion. Because Bels tend to be rather large, we typically use one-tenth
of a Bel as the norm. The result is the decibel (one-tenth Bel). To convert to
decibels, simply multiply the number of Bels by 10. Our gain of 1.3 Bels is
equivalent to 13 decibels. The units are commonly shortened to dB. Consequently,
we may say:

         G '=10 log10G                                                   (1.1)

Where the result is in dB.

At this point, you may be wondering what the big advantage of the decibel system
is. To answer this, recall a few log identities. Normal multiplication becomes
addition in the log system, and division becomes subtraction. Likewise, powers and
roots become multiplication and division. Because of this, two important things
show up. First, ratios of change become constant offsets in the decibel system, and
second, the entire range of values diminishes in size. The result is that a very wide
range of gains may be represented within a fairly small scope of values, and the
corresponding calculations can become quicker. There are a couple of dB values that
are useful to remember. With the aid of your hand calculator, it is very easy to show
the following:

Factor   dB Value using
         G'= 10 log10 G
      1
      2               0 dB
      4           3.01 dB
      8           6.02 dB
    10            9.03 dB

                    10 dB

We can also look at fractional factors (i.e., losses instead of gains.)

Factor   dB Value

   0.5   -3.01 dB
  0.25   -6.02 dB
0.125    -9.03 dB
   0.1
           -10 dB

If you look carefully, you will notice that a doubling is represented by an increase of
approximately 3 dB. A factor of 4 is in essence, two doublings. Therefore, it is

18
equivalent to 3 dB + 3 dB, or 6 dB. Remember, because we are using logs,
multiplication turns into simple addition. In a similar manner, a halving is
represented by approximately -3 dB. The negative sign indicates a reduction. To
simplify things a bit, think of factors of 2 as ±3 dB, the sign indicating whether you
are increasing (multiplying), or decreasing (dividing). As you can see, factors of 10
work out to a very convenient 10 dB. By remembering these two factors, you can
often estimate a dB conversion without the use of your calculator. For instance, we
could rework our initial conversion problem as follows:

              · The amplifier has a gain of 20
              · 20 can be written as 2 times 10
              · The factor of 2 is 3 dB, the factor of 10 is 10 dB
              · The answer must be 3 dB + 10 dB, or 13 dB
              · This verifies our earlier result

Time for a few examples.

Example 1.1

         An amplifier has a power gain of 800. What is the decibel power gain?

                                        G '=10 log10G
                                        G '=10 log10800
                                        G '=10×2.903
                                        G '=29.03dB

         We could also use our estimation technique:

         · G = 800 = 8102
         · 8 is equivalent to 3 factors of 2, or 222, and can be expressed as 3 dB +

              3 dB + 3 dB, which is, of course, 9 dB
         · 102 is equivalent to 2 factors of 10, or 10 dB + 10 dB = 20 dB
         · The result is 9 dB + 20 dB, or 29 dB

         Note that if the leading digit is not a power of 2, the estimation will not be
         as precise. For example, if the gain is 850, you know that the decibel gain is
         just a bit over 29 dB. You also know that it must be less than 30 dB
         (1000=103 which is 3 factors of 10, or 30 dB.) As you can see, by using the
         dB form, you tend to concentrate on the magnitude of gain, and not so much
         on trailing digits.

19
Example 1.2

         An attenuator reduces signal power by a factor of 10,000. What is this loss
         expressed in dB?

                                        G '=10 log10 1 10,000
                                        G '=10×(-4 )
                                        G '=-40 dB

         By using the approximation, we can say,
                                        1 10,000 =1 0-4

         The negative exponent tells us we have a loss (negative dB value), and 4
         factors of 10.

                                        G '= -10 dB -10dB -10dB -10 dB
                                        G '= -40dB

         Remember, if an increase in signal is produced, the result will be a positive
         dB value. A decrease in signal will always result in a negative dB value. A
         signal that is unchanged indicates a gain of unity, or 0 dB.

To convert from dB to ordinary form, just invert the steps; that is, divide by ten and
then take the antilog.

                                       -1 G '
                              G= log10

                                           10

On most hand calculators, base 10 antilog is denoted as 10x. In most computer
languages, you just raise 10 to the appropriate power, as in G = 10.0^(Gprime / 10.0)
(BASIC), or use an exponent function, as in pow(10.0, Gprime / 10.0) (C or Python).

Example 1.3

         An amplifier has a power gain of 23 dB. If the input is 1 mW, what is the
         output?

         In order find the output power, we need to find the ordinary power gain, G.

20
                                                 -1 G '
                                        G= log10

                                                    10
                                                 -1 23
                                        G =log10

                                                    10
                                        G=199.5

         Therefore, Pout =199.5  1 mW, or 199.5 mW

         You could also use the approximation technique in reverse. To do this,
         break up the dB gain in 10 dB and 3 dB chunks:

                                        23dB=3 dB+10dB+10dB

         Now replace each chunk with the appropriate factor, and multiply them
         together (remember, when going from log to ordinary form, addition turns
         into multiplication.)

                                        3dB=2X ,10dB=10X , so,
                                        G= 2×10×10
                                        G= 200

While the approximation technique appears to be slower than the calculator, practice
will show otherwise. Being able to quickly estimate dB values can prove to be a
very handy skill in the electronics field. This is particularly true in larger, multi-
stage designs.

Example 1.4

         A three-stage amplifier has gains of 10 dB, 16 dB, and 14 dB per section.
         What is the total dB gain?

         Because dB gains are a log form, just add the individual stage gains to arrive
         at the system gain.

                                        G 'total =G ' 1+G ' 2+G ' 3
                                        G 'total =10 dB+16 dB+14dB
                                        G 'total =40 dB

As you may have noticed, all of the examples up to this point have used power gain
and not voltage gain. You may be tempted to use the same equations for voltage
gain. In a word, don't. If you think back for a moment, you will recall that power

21
varies as the square of voltage. In other words, a doubling of voltage will produce a
quadrupling of power. If you were to use the same dB conversions, a doubling of
voltage would be 3 dB, yet, because the power has quadrupled, this would indicate a
6 dB rise. Consequently, voltage gain (and current gain as well) are treated in a
slightly different fashion. We would rather have our doubling of voltage work out to
6 dB, so that it matches the power calculation. The correction factor is very simple.
Because power varies as the second power of voltage, the dB form should be twice
as large for voltage (remember, exponentiation turns into multiplication when using
logs). Applying this factor to equation 1.1 yields:

             A 'v=20 log10 Av  (1.2)

Be careful though, the Bel voltage gain only equals the Bel power gain if the input
and output impedances of the system are matched (you may recall from your earlier
work that it is quite possible to design a circuit with vastly different voltage and
power gains. A voltage follower, for example, exhibits moderate power gain with a
voltage gain of unity. It is quite likely that the follower will not exhibit matched
impedances.) If we were to recalculate our earlier table of common factors, we
would find that a doubling of voltage gain is equivalent to a 6 dB rise, and a ten fold
increase is equivalent to a 20 dB rise, twice the size of their power gain counterparts.

Note that current gain may be treated in the same manner as voltage gain (although
this is less commonly done in practice).

Example 1.5

    An amplifier has an output signal of 2 V for an input of 50 mV. What is A'v?
    First find the ordinary gain.

                                  Av= 2 0.05 =40
    Now convert to dB form.

                                  A 'v=20 log10 40
                                  A 'v=20×1.602
                                  A 'v=32.04 dB

    The approximation technique yields 40 = 2210, or 6 dB + 6 dB + 20 dB =
    32 dB

    To convert A'v to A, reverse the process.
                                  Av=log10 -1 A 'v 20

22
Example 1.6

         An amplifier has a gain of 26 dB. If the input signal is 10 mV, what is the
         output?

                                        Av=log10 -1 A' v 20
                                        Av=log10 -1 2620
                                        Av =19.95
                                        V out= Av V i n
                                        V out=19.95×10 mV

The final point to note in this section is that, as in the case of power gain, a negative
dB value indicates a loss. Therefore, a 2:1 voltage divider would have a gain of -6
dB.

Signal Representation in dBW and dBV

As you can see from the preceding section, it is possible to spend considerable time
converting between decibel gains and ordinary voltages and powers. Because the
decibel form does offer advantages for gain measurement, it would make sense to
use a decibel form for power and voltage levels as well. This is a relatively
straightforward process. There is no reason why we can't express a power or voltage
in a logarithmic form. Because a dB value just indicates a ratio, all we need to do is
decide on a reference (i.e., a comparative base for the ratio). For power
measurements, a likely choice would be 1 watt. In other words, we can describe a
power as being a certain number of dB above or below 1 watt. Positive values will
indicate powers greater than 1 watt, while negative values will indicate powers less
than 1 watt. In general equation form:

                                P ' =10log 10 P reference (1.3)

The answer will have units of dBW, that is, decibels relative to 1 watt.

23
Example 1.7

         A power amplifier has a maximum output of 120 W. What is this power in
         dBW?

                                        P ' =10log 10 P 1 Watt
                                        P ' =10log 10 120 W 1 W
                                        P ' =20.8 dBW

There is nothing sacred about the 1 watt reference, short of its convenience. We
could just as easily choose a different reference. Other common reference points are
1 milliwatt (dBm) and 1 femtowatt (dBf). Obviously, dBf is used for very low signal
levels, such as those coming from an antenna. dBm is in very wide use in the
communications industry. To use these other references, just divide the given power
by the new reference.

Example 1.8

         A small personal music player delivers 200 mW to its headphones. What is
         this output power in dBW, and in dBm?

         For an answer in units of dBW, use the 1 watt reference

                                          P ' =10 log10 P 1 Watt
                                          P ' =10 log10 200 mW 1 W
                                          P ' =-7 dBW

         For units of dBm, use a 1 milliwatt reference

                                          P ' =10 log10 P 1 Watt
                                          P ' =10 log10 200 mW 1 mW
                                          P ' =23 dBm

         200 mW, -7 dBW, and 23 dBm are three ways of saying the same thing.
         Note that the dBW and dBm values are 30 dB apart. This will always be
         true, because the references are a factor of 1000 (30 dB) apart.

24
In order to transfer a dBW or similar value into watts, reverse the process.
                              P=log10 -1 P '10 ×reference

Example 1.9

         A studio microphone produces a 12 dBm signal while recording normal
         speech. What is the output power in watts?

                                           P=log10 -1 P '10 × reference
                                           P=log10 -1 12dBm 10 ×1 mW
                                          P=15.8mW=0.0158 W

For voltages, we can use a similar system. A logical reference is 1 V, with the
resulting units being dBV. As before, these voltage measurements will use a
multiplier of 20 instead of 10.

                                V '=20log10 V reference (1.4)
Example 1.10

         A test oscillator produces a 2 V signal. What is this value in dBV?
                                        V '=20log10 V reference
                                        V '=20log10 2 V 1 V
                                        V '= 6.02 dB

When both circuit gains and signal levels are specified in dB form, analysis can be
very quick. Given an input level, simply add the gain to it in order to find the output
level. Given input and output levels, subtract them in order to find the gain.

25
Example 1.11

         A computer hard drive read/write amplifier exhibits a gain of 35 dB. If the
         input signal is -42 dBV, what is the output signal?

                                        V 'out=V ' i n+A' v
                                        V 'out=-42 dBV+35dB
                                        V 'out=-7 dBV

         Note that the final units are dBV and not dB, thus indicating a voltage and
         not merely a gain.

Example 1.12

         A guitar power amp needs an input of 20 dBm to achieve an output of
         25 dBW. What is the gain of the amplifier in dB?

         First, it is necessary to convert the power readings so that they share the
         same reference unit. Because dBm represents a reference 30 dB smaller than
         the dBW reference, just subtract 30 dB to compensate.

                                        20 dBm=-10 dBW
                                        G '= P 'out- P 'i n
                                        G '=25dBW-(-10 dBW)
                                        G '=35 dB

         Note that the units are dB and not dBW. This is very important! Saying that
         the gain is "so many" dBW is the same as saying the gain is "so many"
         watts. Obviously, gains are "pure" numbers and do not carry units such as
         watts or volts.

The usage of a dB-based system is shown graphically in Figure 1.1. Note how the
stage gains are added to the input signal to form the output. Even large circuits can
be quickly analyzed in this form. To make life in the lab even easier, it is possible to
take measurements directly in dB form. By doing this, you need never convert while
troubleshooting a design. For general-purpose work, voltage measurements are the
norm, and therefore a dBV scale is often used.

26
           10 dB          -6 dB          15 dB                                           Figure 1.1
                                                                                         Multistage dB application.

    8 dBm         18 dBm         12 dBm         27 dBm

Items Of Interest In The Laboratory

When using a digital meter on a dBV scale it is possible to "underflow" the meter if
the signal is too weak. This will happen if you try to measure around zero volts, for
example. If you attempt to calculate the corresponding dBV value, your calculator
will probably show "error". The effective value is negative infinite dBV. The meter
will certainly have a hard time showing this value! Another item of interest revolves
around the use of dBm measurements. It is common to use a voltmeter to make dBm
measurements, in lieu of a wattmeter. While the connections are considerably
simpler, a voltmeter cannot measure power. How is this accomplished then? Well, as
long as the circuit impedance is known, power can be derived from a voltage
measurement. A common impedance in communication systems (such as recording
studios) is 600 , so a meter can be calibrated to give correct dBm readings by using
Power Law. If this meter is used on a non-600  circuit, the readings will no longer
reflect accurate dBm values (but will still properly reflect relative changes in dB).

1.3 Bode Plots

The Bode plot is a graphical response prediction technique that is useful for both
circuit design and analysis. It is named after Hendrik Wade Bode, an American
engineer known for his work in control systems theory and telecommunications. A
Bode plot is, in actuality, a pair of plots: One graphs the gain of a system versus
frequency, while the other details the circuit phase versus frequency. Both of these
items are very important in the design of well-behaved, optimal operational
amplifier circuits.

Generally, Bode plots are drawn with logarithmic frequency axes, a decibel gain
axis, and a phase axis in degrees. First, let's take a look at the gain plot. A typical
gain plot is shown Figure 1.2.

27
             A' v                                                                         Figure 1.2
    A' midband                                                                            Gain plot.

                   f1             midband  f2  f

Note how the plot is relatively flat in the middle, or midband, region. The gain value
in this region is known as the midband gain. At either extreme of the midband
region, the gain begins to decrease. The gain plot shows two important frequencies,
f1 and f2. f1 is the lower break frequency while f2 is the upper break frequency. The
gain at the break frequencies is 3 dB less than the midband gain. These frequencies
are also known as the half-power points, or corner frequencies. Normally, amplifiers
are only used for signals between f1 and f2. The exact shape of the rolloff regions will
depend on the design of the circuit. It is possible to design amplifiers with no lower
break frequency (i.e., a DC amplifier), however, all amplifiers will exhibit an upper
break. The break points are caused by the presence of circuit reactances, typically
coupling and stray capacitances. The gain plot is a summation of the midband
response with the upper and lower frequency limiting networks. Let's take a look at
the lower break, f1.

Lead Network Gain Response

Reduction in low frequency gain is caused by lead networks. A generic lead network        Figure 1.3
is shown in Figure 1.3. It gets its name from the fact that the output voltage            Lead network.
developed across R leads the input. At very high frequencies the circuit will be
essentially resistive. Conceptually, think of this as a simple voltage divider. The
divider ratio depends on the reactance of C. As the input frequency drops, Xc
increases. This makes Vout decrease. At very high frequencies, where Xc<<R, Vout
is approximately equal to Vin. This can be seen graphically in Figure 1.4. The
break frequency (i.e., the frequency at which the signal has decreased by 3 dB) is
found via the standard equation

                   f c= 1 2  R C

28
   A'v               fc                                                                     Figure 1.4
                                                      f                                     Lead gain plot (exact).
 0 dB
-3 dB               6 dB/octave                                                             Figure 1.5
                 A'v = 20 log( Vout/Vin )                                                   Lead gain plot (approximate).
  A' v
                     fc
0 dB                                                    f

                    6 dB/octave

The response below fc will be a straight line if a decibel gain axis and a logarithmic
frequency axis are used. This makes for very quick and convenient sketching of
circuit response. The slope of this line is 6 dB per octave (an octave is a doubling or
halving of frequency, e.g., 800 Hz is 3 octaves above 100 Hz).1 This range covers a
factor of two in frequency. This slope may also be expressed as 20 dB per decade,
where a decade is a factor of 10 in frequency. With reasonable accuracy, this curve
may be approximated as two line segments, called asymptotes, as shown in Figure
1.5. The shape of this curve is the same for any lead network. Because of this, it is
very easy to find the approximate gain at any given frequency as long as fc is known.
It is not necessary to go through reactance and phasor calculations. To create a
general response equation, start with the voltage divider rule to find the gain:

        V out = R
        V i n R- j X c

        V out =         R0
        V i n  R2+X c2 -arctan X c R

1 The term octave is borrowed from the field of music. It gets its name from the fact that
there are eight notes in the standard western scale: do-re-mi-fa-sol-la-ti-do.

29
The magnitude of this is,

                            Av=    R

                                   2R +X c   2

                           Av=       1                          (1.5)
                                       X c2

                                   1+ 2
                                       R

Recalling that,

                           f c= 1 2  R C

we may say,

                           R= 1
                               2 fcC

For any frequency of interest, f,

                           X c= 1 2  f C

Equating the two preceding equations yields,

                           fc= Xc                               (1.6)
                           fR

Substituting equation 1.6 in equation 1.5 gives,

                           Av=       1                          (1.7)
                                       f c2

                                   1+ 2
                                       f

To express Av in dB, substitute equation 1.7 into equation 1.2

                            A 'v=20 log10        1
                                                    f c2

                                                1+ 2
                                                    f

30
After simplification, the final result is:

                    ( )f c2                                (1.8)

              A 'v=-10 log10 1+ 2
                                      f

    Where
    fc is the critical frequency,
    f is the frequency of interest,
    A'v is the decibel gain at the frequency of interest.

Example 1.13

    An amplifier has a lower break frequency of 40 Hz. How much gain is lost
    at 10 Hz?

                    ( )f c2

                                  A 'v=-10 log10 1+ 2
                                                          f

                     ( )402

                                  A 'v=-10 log10 1+ 2
                                                         10

                                  A 'v=-12.3 dB

    In other words, the gain is 12.3 dB lower than it is in the midband. Note that
    10 Hz is 2 octaves below the break frequency. Because the cutoff slope is
    6 dB per octave, each octave loses 6 dB. Therefore, the approximate result is
    -12 dB, which double-checks the exact result. Without the lead network, the
    gain would stay at 0 dB all the way down to DC (0 Hz.)

Lead Network Phase Response

At very low frequencies, the circuit of Figure 1.3 is largely capacitive. Because of
this, the output voltage developed across R leads by 90 degrees. At very high
frequencies the circuit will be largely resistive. At this point Vout will be in phase
with Vin. At the critical frequency, Vout will lead by 45 degrees. A general phase
graph is shown in Figure 1.6. As with the gain plot, the phase plot shape is the same
for any lead network. The general phase equation may be obtained from the voltage
divider:

              V out = R
              V i n R- j X c

              V out =                       R0
              V i n  R2+X c2 -arctan X c R

31
The phase portion of this is,                                    (1.9)

                              =arctan X c                                            Figure 1.6
                                           R                                         Lead phase (exact).
                                                               f
By using equation 1.6, this simplifies to,

                                =arctan f c
                                             f

         Where
         fc is the critical frequency,
         f is the frequency of interest,
          is the phase angle at the frequency of interest.

                 

                 90°

    45°

    0°

             .1fc  fc  10fc

Often, an approximation such as Figure 1.7 used in place of 1.6. By using equation  Figure 1.7
1.9, you can show that the approximation is off by no more than 6 degrees at the    Lead phase (approximate).
corners.

                     

                      90°

    45°

         0°

             .1fc  fc  10fc                                 f

32
Example 1.14

         A telephone amplifier has a lower break frequency of 120 Hz. What is the
         phase response one decade below and one decade above?

         One decade below 120 Hz is 12 Hz, while one decade above is 1.2 kHz.

                                        =arctan f c
                                                     f

                                        =arctan 120 Hz 12Hz
                    =84.3degrees one decade below f c (i.e, approaching 90 degrees)

                                        =arctan 120 Hz 1.2 kHz
                    =5.71degrees one decade above f c (i.e., approaching 0 degrees)

         Remember, if an amplifier is direct-coupled, and has no lead networks, the
         phase will remain at 0 degrees right back to 0 Hz (DC).

Lag Network Response                                                                     Figure 1.8
                                                                                         Lag network.
Unlike its lead network counterpart, all amplifiers will contain lag networks. In
essence, it's little more than an inverted lead network. As you can see from Figure
1.8, it simply transposes the R and C locations. Because of this, the response tends to
be inverted as well. In terms of gain, Xc is very large at low frequencies, and thus
Vout equals Vin. At high frequencies, Xc decreases, and Vout falls. The break point
occurs when Xc equals R. The general gain plot is shown in Figure 1.9. Like the lead
network response, the slope of this curve is -6 dB per octave (or -20 dB per
decade.) Note that the slope is negative instead of positive. A straight-line
approximation is shown in Figure 1.10. We can derive a general gain equation for
this circuit in virtually the same manner as we did for the lead network. The
derivation is left as an exercise.

          ( )f 2                                           (1.10)

    A 'v=-10 log10 1+ 2
                            fc

    Where
    fc is the critical frequency,
    f is the frequency of interest,
    A'v is the decibel gain at the frequency of interest.

33
Note that this equation is almost the same as equation 1.8. The only difference is that
f and fc have been transposed.

       A'v                                                                            Figure 1.9

    0 dB fc                                            f Lag gain (exact).

    -3 dB

    -6 dB/octave

      A'v                                                                           Figure 1.10

    0 dB fc                                            f Lag gain (approximate).

    -6 dB/octave

In a similar vein, we may examine the phase response. At very low frequencies, the
circuit is basically capacitive. Because the output is taken across C, Vout will be in
phase with Vin. At very high frequencies, the circuit is essentially resistive.
Consequently, the output voltage across C will lag by 90 degrees. At the break
frequency the phase will be -45 degrees. A general phase plot is shown in Figure
1.11, with the approximate response detailed in Figure 1.12. As with the lead
network,we may derive a phase equation. Again, the exact steps are very similar,
and left as an exercise.

    =-90+arctan f c                                    (1.11)
                        f

    Where
    fc is the critical frequency,
    f is the frequency of interest,
     is the phase angle at the frequency of interest.

34
                                                                                      Figure 1.11
      0° .1fc fc 10fc                                                                 Lag phase (exact).

                                                                             f

    -45°

    -90°

                                                                                      Figure 1.12
      0° .1fc fc 10fc                                                                 Lag phase (approximate).

                                                                         f

    -45°

    -90°

Example 1.15

    A medical ultra sound transducer feeds a lag network with an upper break

    frequency of 150 kHz. What are the gain and phase values at 1.6 MHz?

    Because this represents a little more than a 1 decade increase, the                 Figure 1.13
                                                                                        Bode plot for 150 kHz lag.
    approximate values are -20 dB and -90 degrees, from Figures 1.10 and
                                                                                           150 kHz
    1.12, respectively. The exact values are:
                                                                                                                            f
                                                                                A'v
                                                                                      -6 dB/octave
                                               ( )f 2
              A 'v=-10 log10 1+ 2                                               0 dB
                                               fc

              A 'v=-10 log10 1+                ( ) 1.6 MHz22
                                               150 kHz

              A 'v=-20.6 dB

35
                   =-90+arctan f c                                                      Figure 1.13 (continued)
                                       f                                                Bode plot for 150 kHz
                                                                                        lag.
                   =-90+arctan 150 kHz 1.6 MHz
                   =-84.6 degrees                                     

                                                                      0°        15 kHz   150 kHz 1.5 MHz

    The complete Bode plot for this network is shown in Figure f

    1.13. It is very useful to examine both plots simultaneously. -45°
    In this manner you can find the exact phase change for a

    given gain quite easily. This information is very important

    when the application of negative feedback is considered         -90°

    (Chapter Three). For example, if you look carefully at the

    plots of Figure 1.13, you will note that at the critical

    frequency of 150 kHz, the total phase change is -45 degrees. Because this

    circuit involved the use of a single lag network, this is exactly what you

    would expect.

Rise Time versus Bandwidth

For pulse-type signals, the speed of an amplifier is often expressed in terms of its
rise time. If a square pulse such as Figure 1.14a is passed into a simple lag network,
the capacitor charging effect will produce a rounded variation, as seen in Figure
1.14b. This effect places an upper limit on the duration of pulses that a given
amplifier can handle without producing excessive distortion.

    Vpeak                                                                                Figure 1.14a
                                                                                         Pulse rise time effect:

                                                                                         Input to network.

                   t0                                            t

By definition, rise time is the amount of time it takes for the signal to traverse from
10% to 90% of the peak value of the pulse. The shape of this pulse is defined by the
standard capacitor charge equation examined in earlier course work, and is valid for
any system with a single clearly dominant lag network.

                         ( )-t                                (1.12)

                   V out=V peak 1- RC

36
      Vpeak                                                                               Figure 1.14b
    .9Vpeak                                                                               Pulse rise time effect:

                                                                                          Output of network.

    .1Vpeak

                               t0 t1 t2                                 t

In order to find the time internal from the initial starting point to the 10% point, set
Vout to 0.1Vpeak in equation 1.12 and solve for t1 .

                          ( )-t1                                           (1.13)

                 0.1 V peak = V peak 1- RC

                                                                   -t1

                 0.1 V peak = V peak -V peak  RC

                                                     -t1

                 0.9 V peak = V peak  RC

                                          -t 1

                       0.9 =  RC
                   log 0.9 = -t1

                               RC

                       t1=0.105 RC

To find the interval up to the 90% point, follow the same technique using 0.9Vpeak .

Doing so yields

                 t2=2.303 RC                                               (1.14)

The rise time, Tr, is the difference between t1 and t2

                 T r=t 1-t 2                                               (1.15)
                 T r=2.303 R C-0.105 RC

                  T r2.2 R C

Equation 1.15 ties the rise time to the lag network's R and C values. These same
values also set the critical frequency f2. By combining equation 1.15 with the basic
critical frequency relationship, we can derive an equation relating f2 to Tr.

                 f 2= 1 2  RC

37
Solving 1.15 in terms of RC, and substituting yields            (1.16)

                            f 2= 2.2
                                  2 T r

                                f 2=0.35
                                       Tr

         Where
         f2 is the upper critical frequency,
         Tr is the rise time of the output pulse.

Example 1.16

Determine the rise time for a lag network critical at 100 kHz.

                               f 2=0.35
                                     Tr

                              T r= 0.35
                                      f2

                              T r= 0.35 100 kHz
                              T r= 3.5 s

1.4 Combining the Elements - Multi-Stage Effects

A complete gain or phase plot combines three elements: (1) the midband response,
(2) the lead response, and (3) the lag response. Normally, a particular design will
contain multiple lead and lag networks. The complete response is the summation of
the individual responses. For this reason, it is useful to find the dominant lead and
lag networks. These are the networks that affect the midband response first. For lead
networks, the dominant one will be the one with the highest fc . Conversely, the
dominant lag network will be the one with the lowest fc . It is very common to
approximate the complete system response by drawing straight-line segments such
as those given in Figures 1.5 and 1.10. The process goes something like this:

              · Locate all fc s on the frequency axis.
              · Draw a straight line between the dominant lag and lead fc s at the

                   midband gain. If the system does not contain any lead networks,
                   continue the midband gain line down to DC.
              · Draw a 6 dB per octave slope between the dominant lead and the
                   next lower lead network.
              · Because the effects of the networks are cumulative, draw a 12 dB

38
                   per octave slope between the second lead fc and the third fc . After
                   the third fc , the slope should be 18 dB per octave, after the fourth,
                   24 dB per octave, and so on.
              · Draw a -6 dB per octave slope between the dominant lag fc and the
                   next highest fc . Again, the effects are cumulative, so increase the
                   slope by -6 dB at every new fc .

Example 1.17

         Draw the Bode gain plot for the following amplifier: A'v midband = 26 dB,
         one lead network critical at 200 Hz, one lag network critical at 10 kHz, and
         another lag network critical at 30 kHz.

         The dominant lag network is 10 kHz. There is only one lead network, so it's
         dominant by default.

                        · Draw a straight line between 200 Hz and 10 kHz at an
                             amplitude of 26 dB.

                        · Draw a 6 dB per octave slope below 200 Hz. To do this,
                             drop down one octave (100 Hz) and subtract 6 dB from the
                             present gain (26 dB - 6dB = 20 dB.) The line will start at
                             the point 200 Hz/26 dB, and pass through the point
                             100 Hz/20 dB. Because there are no other lead networks,
                             this line may be extended to the left edge of the graph.

                        · Draw a -6 dB per octave slope between 10 kHz and
                             30 kHz. The construction point will be 20 kHz/20 dB.
                             Continue this line to 30 kHz. The gain at the 30 kHz
                             intersection should be around 16 dB. The slope above this
                             second fc will be -12 dB per octave. Therefore, the second
                             construction point should be at 60 kHz/4 dB (one octave
                             above 30 kHz, and 12 dB down from the 30 kHz gain).
                             Because this is the final lag network, this line may be
                             extended to the right edge of the graph.

         A completed graph is shown in Figure 1.15.

39
   A'v                     -6 dB/octave                                                Figure 1.15
                                   -12 dB/octave                                       Gain plot of complete
26 dB                                                                                  amplifier.

              6 dB/octave  10 k 30 k  f

 0 dB
                     200

There is one item that should be noted before we leave this section, and that is the
concept of narrowing. Narrowing occurs when two or more networks share similar
critical frequencies, and one of them is a dominant network. The result is that the
true -3 dB breakpoints may be altered. Here is an extreme example. Assume that a
circuit has two lag networks, both critical at 1 MHz. A Bode plot would indicate that
the breakpoint is 1 MHz. This is not really true. Remember, the effects of lead and
lag networks are cumulative. Because each network produces a 3 dB loss at 1 MHz,
the net loss at this frequency is actually 6 dB. The true -3 dB point will have been
shifted. The Bode plot only gives you the approximate shape of the response.

1.5 Circuit Simulations Using Computers

With the advent of low cost personal computers, there are many alternatives to hand
sketching of plots. One method involves the use of commercial or public domain
software packages designed for circuit analysis. One common package is the public
domain program SPICE. SPICE is an acronym that stands for Simulation Program
with Integrated Circuit Emphasis, and was originally written in the mid- 1970's by
Dr. Laurence Nagel of the University of California. This program is available for
many different computing platforms for minimal cost. SPICE also serves as the core
for a number of commercial packages. The commercial versions generally add
features such as schematic capture (the ability to "draw" circuits using the
computer's mouse), graphical input and output of data, interactive analysis, analog-
digital mixed signal analysis and large device libraries. Examples of popular
simulation packages include the commercial offerings OrCAD PSpice and
Electronics Workbench Multisim, while freeware packages include Linear
Technology LTspice and Texas Instruments TINA-TI. The choice of a specific
simulation tool depends on the needs of the user, available facilities, costs, and so
forth. Of course, everyone has their own working style, so personal preference also
plays a role. Generally, any quality SPICE-based simulator will be sufficient for the

40
circuits presented in this book.

In order to use a simulator, a circuit is "described" with a special data file. For non-
graphical simulators, the data file can be created using an ordinary text editor. The
data file is then used by the simulation program to estimate the circuit response.
Simulation results can include items such as Bode gain and phase plots.

                                                                                          Figure 1.16a
                                                                                          Multisim schematic for a
                                                                                          simple lag network.

With graphical input (AKA schematic capture), components are usually dragged
onto the work area and interconnected through the use of a mouse or other pointing
device. Consequently, text-based input files are not needed, although many
programs can import them and create the circuit from there. Similarly, simulation
results are generally shown in graphical form using a plotting window or virtual
oscilloscope instead of using a text-based output file. Graphical input and output
using Multisim is shown in Figure 1.16. Here a simple lag network is drawn on the
worksheet. A Bode plot is then generated by selecting the AC Analysis option of
Simulate.

41
                                                                                                                     Figure 1.16b
                                                                                                                     Multisim gain and phase
                                                                                                                     output graphs.

Note that accurate models for specific op amps or other devices that are not included
in the simulator's libraries may be obtained from their manufacturer. This is often as
simple as downloading them from the manufacturer's Web site. A listing of
manufacturer's Web sites may be found in the Appendix.
Simulators are by no means small or trivial programs. They have many features and
options, not to mention the variations produced by the many commercial versions.
This text does not attempt to teach all of the intricacies of SPICE-based simulators.
For that, you should consult your simulator user's manual, or one of the books
available on the subject. The examples in this book assume that you already have
some familiarity with computer circuit simulators.
We will be using simulations in the following chapters for various purposes. One
thing that you should always bear in mind is that simulation tools should not be used
in place of a normal "human" analysis. Doing so can cause no end of grief.
Simulations are only as good as the models used with them. It is easy to see that if
the description of the circuit or the components within the circuit is not accurate, the
simulation will not be accurate. Simulation tools are best used as a form of double-
checking a design, not as a substitute for proper analysis.

42
1.6 The Differential Amplifier

Most modern operational amplifiers utilize a differential amplifier front end. In other
words, the first stage of the operational amplifier is a differential amplifier. This
circuit is commonly referred to as a diff amp or as a long-tailed pair. A diff amp
utilizes a minimum of 2 active devices, although 4 or more may be used in more
complex designs. Our purpose here is to examine the basics of the diff amp so that
we can understand how it relates to the larger operational amplifier. Therefore, we
will not be investigating the more esoteric designs. To approach this in an orderly
fashion, we will examine the DC analysis first, and then follow with the AC small
signal analysis.

                                                                                                                     Figure 1.17
                                                                                                                     Simplified diff amp.

DC Analysis

A simplified diff amp is shown in Figure 1.17. This circuit utilizes a pair of NPN
bipolar transistors, although the circuit could just as easily be built with PNPs or
FETs. Note the inherent symmetry of the circuit. If you were to slice the circuit in
half vertically, all of the components on the left half would have a corresponding
component on the right half. Indeed, for optimal performance, we will see that these
component pairs should have identical values. For critical applications, a matched
pair of transistors would be used. In this case, the transistor parameters, such as ,
would be very closely matched for the two devices.

In Figure 1.18, the circuit currents are noted, and the generalized current source has
been replaced with a resistor/negative power supply combination. This is in essence,
an emitter bias technique. Assuming that the base voltages are negligible and that
VBE is equal to 0.7 V, we can see that the emitter of each device is at approximately
-0.7 V. Kirchhoff's voltage law indicates that the bulk of the negative supply

43
potential must drop across RT.

                           V RT=V EE-.7 V

                                                                                        Figure 1.18
                                                                                        Diff amp analysis of

                                                                                        Figure 1.17.

Knowing this, we may find the current through RT, which is known as the tail            Figure 1.19
current, IT.                                                                            Diff amp for example 1.18.

                              I T=V EE-0.7 V
                                          RT

If the two halves of the circuit are well matched, the tail current will split equally
into two portions, IE1 and IE2. Given identical emitter currents, it follows that the
remaining currents and voltages in the two halves must be identical as well. These
potentials and currents are found through the application of Kirchhoff's Voltage and
Current Laws just as in any other transistor bias analysis.

Example 1.18

    Find the tail current, the two emitter currents, and the two collector to
    ground voltages in the circuit of Figure 1.19. You may assume that the
    two transistors are very closely matched.

    The first step is to find the tail current:

                                  I T=V EE-0.7 V
                                              RT

44
         The tail current is the combination of the two equal emitter currents, so

                                        I E1= I E2= I T 2
                                         I E1= I E2= 4.65 mA 2
                                        I E1=I E2=2.325 mA

         If we make the approximation that collector and emitter currents are equal,
         we may find the collector voltage by calculating the voltage drop across the
         collector resistor, and subtracting the result from the positive power supply.

                                        V C=V CC -I C RC
                                        V C=20 V-2.325 mA×3 k
                                        V C=20 V-6.975 V
                                        V C=13.025 V

         Again, because we have identical values for both halves of the circuit,
         VC1 =VC2 . If we continue with this and assume a typical  of 100, we find
         that the two base currents are identical as well.

                                        I B= I C
                                               

                                        I B= 2.325 mA 100
                                        I B=23.25 A

         Noting that the base currents flow through the 5 k base resistors, we may
         find the base voltages. Note that this is a negative potential because the base
         current is flowing from ground into the transistor's base.

                                        V B=-I B RB
                                        V B=-23.25A×5 k
                                        V B=-116.25 mV

         This result indicates that the actual emitter voltage is closer to -0.8 V than
         -0.7 V, and thus, the tail current is actually a little less than our
         approximation of 4.65 mA. This error is probably within the error we can
         expect by using the 0.7 V junction potential approximation.

45
Input Offset Current and Voltage

As you have no doubt guessed, it is impossible to make both halves of the circuit
identical, and thus, the currents and voltages will never be exactly the same. Even a
small resistor tolerance variation will cause an upset. If the base resistors are
mismatched, this will cause a direct change in the two base potentials. A variation in
collector resistance will cause a mismatch in the collector potentials. A simple  or
VBE mismatch can cause variations in the base currents and base voltages, as well as
smaller changes in emitter currents and collector potentials. It is desirable then to
quantify the circuit's performance so that we can see just how well balanced it is.
We can judge a diff amp's DC performance by measuring its input offset current and
its input and output offset voltages. In simple terms, the difference between the two
base currents is the input offset current. The difference between the two collector
voltages is the output offset voltage. The DC potential required at one of the bases to
counteract the output offset voltage is called the input offset voltage (this is little
more than the output offset voltage divided by the DC gain of the amplifier). In an
ideal diff amp all three of these factors are equal to 0. We will take a much closer
look at these parameters and how they relate to operational amplifiers in later
chapters. For now, it is only important that you understand that these inaccuracies
exist, and what can cause them.

AC Analysis

Figure 1.20 shows a typical circuit with input and output connections. In order to
minimize confusion with the DC circuit, AC equivalent values will be shown in
lower case. Small emitter degeneration resistors, rE1 and rE2, have been added to this

                                                                                                                 Figure 1.20
                                                                                                                 A typical diff amp with input
                                                                                                                 and output connections.

diff amp. This circuit has two signal inputs and two signal outputs. It is possible to
configure a diff amp so that only a single input and/or output is used. This means
that there are four variations on the theme:

46
              · Differential (also called dual- or double-ended) input, differential
                   output.

              · Differential input, single-ended output.
              · Single-ended input, differential output.
              · Single-ended input, single-ended output.

These variations are shown in Figure 1.21. For use in operational amplifiers, the
differential input/single-ended output variation is the most common. We will
examine the most general case, the differential input/differential output version.

                                                                                                                     Figure 1.21
                                                                                                                     The four different diff amp
                                                                                                                     input/output configurations.

    a. Differential input and output  b. Single-ended input and
                                      differential output

    c. Differential input and         d. Single-ended input and
    single-ended output               output

Because the diff amp is a linear circuit, we can use the principle of Superposition to
independently determine the output contribution from each of the inputs. Utilizing
the circuit of Figure 1.20, we will first determine the gain equation from Vin1 to
either output. To do this, we replace Vin2 with a short circuit. The AC equivalent
circuit is shown in Figure 1.22.

47
                                                                                                                     Figure 1.22
                                                                                                                     The circuit of Figure 1.20
                                                                                                                     redrawn for AC analysis.

For the output on collector 1, transistor 1 forms the basis of a common emitter
amplifier. The voltage across rC1 is found via Ohm's law.

                              v rC1=-iC1 r C1
The negative sign comes from the fact that AC ground is used as our reference. (i.e.,
for a positive input, current flows from AC ground down through rC1, and into the
collector.) To a reasonable approximation, we can say that the collector and emitter
currents are identical.

                              v rc1=-i E1 r C1
We must now determine the AC emitter current in relation to Vin1. In order to better
visualize the process, the circuit of Figure 1.22 is altered to include simplified
transistor models, as shown in Figure 1.23.

                                                                                                                     Figure 1.23
                                                                                                                     AC analysis.

48
r'e is the dynamic resistance of the base emitter junctions and is inversely
proportional to the DC emitter current. You may recall the following equation from
your prior course work:

                              r ' e= 26 mV
                                       IE

         Where
         r'e is the dynamic base-emitter junction resistance,
         IE is the DC emitter current.

For typical circuits, the values of r'e and rE are much smaller than the tail current
biasing resistor, RT. Because of its large size, we can ignore the parallel effect of RT.
By definition, the AC emitter current must equal the AC emitter potential divided by
the AC resistance in the emitter section. If you trace the signal flow from the base of
transistor 1 to ground, you find that it passes through r'e1, rE1, r'e2 and rE2. You will
also notice that the magnitude of iE1 is the same as iE2 , although they are out of
phase.

                              iE= vin1
                                   r ' e1+r E1+r ' e2+r E2

Because the circuit values should be symmetrical for best performance, this equation
may be simplified to

                              iE= vin
                                   2( r ' e+rE )

If we now solve for voltage gain,

                                     Av= vo ut
                                            vi n

                                    Av=-iE rC
                                            vi n

                                    - vin rC
                                       2( r ' e+rE )

                              Av =
                                            vi n

                                 Av= -rC
                                       2( r ' e+r E )

         Where
         Av is the voltage gain,
         rC is the AC equivalent collector resistance,
         rE is the AC equivalent emitter resistance,
         r'e is the dynamic base-emitter junction resistance.

49
The final negative sign indicates that the collector voltage at transistor number 1 is     Figure 1.24
180 degrees out of phase with the input signal. Earlier, we noted that iE2 is the same     Waveforms for a single
magnitude as iE1, the only difference being that it is out of phase. Because of this, the  input.
magnitude of the collector voltage at transistor number 2 will be the same as that on
the first transistor. Because the second current is out of phase with the first, it        Vin t
follows that the second collector voltage must be out of phase with the first. This
means that the voltage at the second collector is in phase with the first input signal.
Its gain equation is

              Av= rC
                   2( r ' e+rE )

The various waveforms are depicted in Figure 1.24. The preceding equation is often VC1     t
referred to as the single-ended input/single-ended output gain equation because it

describes the single change from one input to one output. The output signal will be

in phase if we are examining the opposite transistor, and out of phase if we are

looking at the input transistor. Because the circuit is symmetrical, we will get similar

results when we examine the second input. The voltage between the two collectors is 180 degrees apart. If we were to use a differential output, that is, derive the output VC2 t

from collector to collector rather than from one collector to ground, we would see an

effective doubling of the output signal. If the reason for this is not clear to you,

consider the following. Assume that each collector has a 1 V peak sine wave riding

on it. When collector 1 is at +1 V, collector 2 is at -1 V, making +2 V total.

Likewise, when collector 1 is at its negative peak, collector 2 is at its positive peak,

producing a total of -2 V. The single ended input/differential output gain therefore

is

              Av= rC
                   r ' e+rE

Example 1.19

         Using the circuit of Figure 1.20, determine the single-ended
         input/differential output and single-ended input/single-ended output voltage
         gains. Use the following component values: VCC =15V, VEE =-8V, RT=10k,
         RC=8k, rE=30.

         In order to find r'e we must find the DC current.

                                        I T=V E E-0.7 V
                                                    RT

                                        I T= 7.3 V 10 k
                                        I T=730 A

50
                                        I E= I T 2
                                        I E= 730 A 2
                                        I E=365 A

                                        r ' e= 26 mV
                                                 IE

                                         r 'e= 26 mV 365 A
                                        r ' e=71.2 

         For the single ended output gain,

                                        Av= rC
                                              2 (r ' e+rE )

                                        Av= 8 k 2( 71.2+30 )
                                        Av= 8 k 202.4 
                                        Av =39.5

         The differential output gain is twice this value, or 79.

Because it is possible to drive a diff amp with two distinct inputs, a wide variety of
outputs may be obtained. It is useful to investigate two specific cases:

              · Two identical inputs in both phase and magnitude.
              · Two inputs with identical magnitude, but 180 degrees out of phase.

Let's consider the collector potentials for the first case. Assume that a diff amp has a
single-ended input/single-ended output gain of 100 and a 10 mV signal is applied to
both bases. Using Superposition, we find that the outputs due to each input are 100
times 10 mV, or 1 V in magnitude. For the first input, the voltages are sketched in
Figure 1.25a (following page). For the second input, the voltages are sketched in
Figure 1.25b. Note that each collector sees both a sine wave and an inverted sine
wave, both of equal amplitude. When these two signals are added, the result is zero,
as seen in Figure 1.25c. In equation form,

                              vC 1=vi n1 (- Av )+vi n 2 Av
                              vC 1= Av(vi n 2-vi n 1)

Because vin1 and vin2 are identical, the output is ideally zero given a perfectly
matched and biased diff amp. The exact same effect is seen on the opposite

51
collector. This last equation is very important. It says that the output voltage is equal
to the gain times the difference between the two inputs. This is how the differential
amplifier got its name. In this case, the two inputs are identical, and thus their
difference is zero. On the other hand, if we were to invert one of the input
signals(case 2), we find a completely different result.

                              vin1 =-vin2
                              vC1= Av (vin2-vin1)
                              vC1= Av (vin2-(-v in2))
                              vC1=2 Av vin2

Thus, if one input is inverted, the net result is a doubling of gain. This effect is
shown graphically in Figures 1.25d through 1.25f. In short, a differential amplifier
suppresses in phase signals while simultaneously boosting out of phase signals. This
can be a very useful attribute, particularly in the area of noise reduction.

     10 mV                    10 mV                                                        Figure 1.25
                                                                                           Input-output waveforms for
      Vin t                    Vin t                                                       common mode.

    1 V{                      1 V{

      VC1 t                     VC1 t VC1 t

    1 V{                      1 V{

      VC2 t                     VC2 t VC2 t

      a. Waveforms for first  b. Waveforms for second  c. Combinations of a and b
      input                   input

52
                                                                 10 mV                              Figure 1.25 (continued)
    10 mV                                                                                           Input-output waveforms for
                                                                                                    common mode.
     Vin Vin t t

    1 V{        1 V{               2 V{

      VC1                 VC1   t VC1 t
           t

    1 V{        1 V{               2 V{

      VC2  t VC2                t VC2 t

    d. Waveforms for identical  e. Waveforms for                        f. Combinations of d and e
    first input                 inverted second input

Common Mode Rejection

By convention, in phase signals are known as common-mode signals. An ideal
differential amplifier will perfectly suppress these common-mode signals, and thus,
its common-mode gain is said to be zero. In the real world, a diff amp will never
exhibit perfect common-mode rejection. The common-mode gain may be made very
small, but it is never zero. For a common-mode gain of zero, the two halves of the
circuit have to be perfectly matched, and all circuit elements must be ideal. This is
impossible to achieve as errors may arise from several sources. The most obvious
error sources are resistor tolerance variations and transistor parameter spreads. The
basic design of the circuit will also affect the common-mode gain. With some circuit
rearrangements, it is possible to determine a common-mode gain for the circuits we
have been using. The circuit of Figure 1.20 has been redrawn in Figure 1.26 in order
to emphasize its parallel symmetry.

53
                                                                                                                   Figure 1.26
                                                                                                                   The circuit of Figure 1.20
                                                                                                                   redrawn for common mode
                                                                                                                   rejection ratio (CMRR)
                                                                                                                   analysis.

Because the DC potentials are identical in both halves, and identical signals drive
both inputs, we can combine resistors in parallel in order to arrive at the circuit of
Figure 1.27.

                                                                                                                  Figure 1.27
                                                                                                                  Common mode gain analysis.

Although it is not shown explicitly on the diagram, the internal dynamic resistances
(r'e) may also be combined (r'e/2). This circuit has been effectively reduced to a
simple common emitter stage. Based on our earlier work, the gain for this circuit is
54
          rC

Av (cm)=   2
          r'e rE
          RT + 2 + 2

This is the common-mode voltage gain. If RT is considerably larger than rC, then this
circuit will exhibit good common mode rejection (assuming that the other parts are
matched, naturally). RT is the effective resistance of the tail current source. A very
high internal resistance (i.e., an ideal current source) is desirable. There are many
ways of creating a more ideal current source. One way is to use a third bipolar

                                                                                           Figure 1.28
                                                                                           Improved current source.

transistor as shown in Figure 1.28. The tail current is found by determining the           Figure 1.29
potential across R2 and subtracting the 0.7 V VBE drop. The remaining potential            Current mirror.
appears across R3. Given the voltage and resistance, Ohm's law will let you find the
tail current. In this circuit, R2 is sometimes replaced with a Zener diode. This can
help to reduce temperature induced current fluctuations. In any case, the effective
resistance of this current source is considerably larger than the simple tail resistor
variation. It is largely dependent on the characteristics of the tail current transistor,
and can easily be in the megohm region.

Current Mirror

A very popular biasing technique in integrated circuits involves the current mirror.
Current mirrors are also employed as active loads in order to optimize a circuit's
gain. A simple current mirror is shown in Figure 1.29. This circuit requires that the
transconductance curves of the diode and the transistor be very closely matched.
One way to guarantee this is to use two transistors, and form one of them into a
diode by shorting its collector to its base. If we use an approximate forward bias

55
potential of 0.7 V and ignore the small base current, the current through the diode is

              I D= V CC-0.7 V R                                                            Figure 1.30
                                                                                           Transfer curve mismatch.

In reality, the diode potential will probably not be exactly 0.7 V. This will have         ID

little effect on Id though. Because the diode is in parallel with the transistor's

base-emitter junction, we know that Vd=VBE. If the two devices have identical

transconductance curves, the transistor's emitter current will equal the diode

current. You can think of the transistor as mirroring the diode's current, hence the

circuit's name. If the two device curves are slightly askew, then the two currents    10 mA

will not be identical. This is shown graphically in Figure 1.30.

Example 1.20                                                                                   .65 V VD

    A current mirror could be used in the circuit of Figure 1.28. The result is

    shown in Figure 1.31. If the positive power supply is 15 V, the negative

    supply is -10 V, and R is 10 k, the tail current will be

                                                                                      ID

              I D= V CC -V E E -V D R                                                          transistor curve

              I D= 15V-(-10 V) -0.7 V 10 k                                          15 mA                              diode curve
              I D=2.43mA                                                            10 mA                       .65 V VD

    Because the tail current is the mirror current,

              I T=I D
              I T=2.43 mA

Biasing of this type is very popular in operational amplifiers. Another use for current
mirrors is in the application of active loads. Instead of using simple resistors for the
collector loads, a current mirror may be used instead. A PNP based current mirror
suitable for use as an active load in our previous circuits is shown in Figure 1.32.

56
                                                                                                                     Figure 1.31
                                                                                                                     Current mirror bias.

                                                                                                                     Figure 1.32
                                                                                                                     Active load current mirror.

To use this, we simply remove the two collector resistors from a circuit such as
Figure 1.31, and drop in the current mirror. The result of this operation is shown in
Figure 1.33. The current mirror active load produces a very high internal impedance,
thus contributing to a very high differential gain. In effect, by using a constant
current source in the collectors, all AC current is forced into the following stage.
You may also note that the number of resistors used in the circuit has decreased
considerably.

                                                                                                                     Figure 1.33
                                                                                                                     Current mirrors for bias and
                                                                                                                     active load.

57
Summary

We have seen how to convert gains and signals into a decibel form for both powers
and voltages. This is convenient because what would require multiplication and
division under the ordinary scheme only requires simple addition and subtraction in
the dB scheme. Along with this, dB measurement is used almost exclusively for
Bode gain plots. A Bode plot details a system's gain magnitude and phase response.
For gain, the amplitude is measured in dB, while the frequency is normally
presented in log form. For a phase plot, phase is measured in degrees, and again, the
frequency axis is logarithmic. The changes in gain and phase at the frequency
extremes are caused by lead and lag networks. Lead networks cause the low
frequency gain to roll off. The roll off rate is 6 dB per octave per network. The phase
will change from +90 degrees to 0 degrees per network. Lag networks cause the high
frequency gain to roll off at a rate of -6 dB per octave per network. The phase
change per lag network is from 0 degrees to -90 degrees. It was noted that
computers may be used to quickly tabulate the response of complex networks such
as these. Many computer circuit simulators are based on the original SPICE program.
Among the popular commercial simulation programs are PSpice and Multisim.
Freeware versions include LTspice and TINA-TI. Packages such as these offer
graphical schematic capture tools and large component libraries.

Differential amplifiers are symmetrical circuits, employing a minimum of two active
devices. They may be configured with single or dual inputs, and single or dual
outputs. Diff amps are commonly used as the first stage of an operational amplifier.
They tend to amplify the difference in the input signals while simultaneously
suppressing in-phase, or common-mode, signals. Current mirrors are widely used for
biasing purposes and as active loads. Active loads offer the advantage of producing
higher gains than ordinary resistive loads.

Review Questions

    1. What are the advantages of using decibels over the ordinary scheme?
    2. How do decibel power and voltage gain calculations differ?
    3. What does the third letter in a decibel-based signal measurement indicate (as

         in dBV or dBm)?
    4. What is a Bode plot?
    5. What is a lead network? What general response does it yield?
    6. What is a lag network? What general response does it yield?
    7. What do the terms f1 and f2 indicate about a system's response?
    8. What are the rolloff slopes for lead and lag networks?
    9. What are the phase changes produced by individual lead and lag networks?
    10. How is rise time related to upper break frequency?
    11. How do multiple lead or lag networks interact to form an overall system

         response?

58
    12. What is SPICE?
    13. What is common-mode rejection?
    14. What is a current mirror?
    15. What is the advantage of using an active load?

Problems

Analysis Problems - dB emphasis

    1. Convert the following power gains into dB form: a) 10 b) 80 c) 500 d) 1
         e) 0.2 f) 0.03.

    2. Convert the following dB power gains into ordinary form: a) 0 dB b) 12 dB
         c) 33.1 dB d) 0.2 dB e) -5.4 dB f) -20 dB.

    3. An amplifier has an input signal of 1 mW, and produces a 2 W output. What
         is the power gain in dB?

    4. A hi-fi power amplifier has a maximum output of 50 W and a power gain of
         19 dB. What is the maximum input signal power?

    5. An amplifier with a power gain of 27 dB is driven by a 25 mW source.
         Assuming the amplifier doesn't clip, what is the output signal in watts?

    6. Convert the following voltage gains into dB form: a) 10 b) 40 c) 250 d) 1
         e) 0.5 f) 0.004

    7. Convert the following dB voltage gains into ordinary form: a) 0.5 dB
         b) 0 dB c) 46 dB d) 10.7 dB e) -8 dB f) -14.5 dB

    8. A guitar pre-amp has a gain of 44 dB. If the input signal is 12 mV, what is
         the output signal?

    9. A video amplifier has a 140 mV input and a 1.2 V output. What is the
         voltage gain in dB?

    10. The pre-amp in a particular tape deck can output a maximum signal of 4 V.
         If this amplifier has a gain of 18 dB, what is the maximum input signal?

    11. Convert the following powers into dBW: a) 1 W b) 23 W c) 6.5 W
         d) 0.2W e) 2.3 mW f) 1.2 kW g) 0.045 mW h) 0.3 W i) 5.6E-18 W.

    12. Repeat Problem 11 for units of dBm.
    13. Repeat Problem 11 for units of dBf.
    14. Convert the following voltages into dBV: a) 12.4 V b) 1 V c) 0.25 V

         d) 1.414 V e) 0.1 V f) 10.6 kV g) 13 mV h) 2.78 V.
    15. A two stage power amplifier has power gains of 12 dB and 16 dB. What is

         the total gain in dB and in ordinary form?
    16. If the amplifier of Problem 15 has an input of -18 dBW, what is the final

         output in dBW? in dBm? in watts?

59
    17. Referring to Figure 1.1, what are the various stages' outputs if the input is
         changed to -4 dBm? to -34 dBW?

    18. Which amplifier has the greatest power output? a) 50 watts b) 18 dBW
         c) 50 dBm.

    19. Which amplifier has the greatest power output? a) 200 mW b) -10 dBW
         c) 22 dBm.

    20. A three stage amplifier has voltage gains of 20 dB, 5 dB, and 12 dB
         respectively. What is the total voltage gain in dB and in ordinary form?

    21. If the circuit of Problem 20 has an input voltage of -16 dBV, what are the
         outputs of the various stages in dBV? In volts?

    22. Repeat Problem 21 for an input of 12 mV.
    23. Which amplifier produces the largest output voltage? a) 15 V b) 16 dBV

Analysis Problems - Bode plot emphasis

    24. Given a lead network critical at 3 kHz, what are the gain and phase values at
         100 Hz, 3 kHz, and 40 kHz?

    25. Given a lag network tuned to 700 kHz, what are the gain and phase values at
         50 kHz, 700 kHz, and 10 MHz? What is the rise time?

    26. A noninverting amplifier has a midband voltage gain of 18 dB and a single
         lag network at 200 kHz. What are the gain and phase values at 30 kHz, 200
         kHz, and 1 MHz. What is the rise time?

    27. Repeat Problem 26 for an inverting (-180 degrees) amplifier.
    28. Draw the Bode plot for the circuit of Problem 26.
    29. Draw the Bode plot for the circuit of Problem 27.
    30. An inverting (-180 degrees) amplifier has a midband gain of 32 dB and a

         single lead network critical at 20 Hz (assume the lag network fc is high
         enough to ignore for low frequency calculations). What are the gain and
         phase values at 4 Hz, 20Hz, and 100 Hz?
    31. Repeat Problem 29 with a noninverting amplifier.
    32. Draw the Bode plot for the circuit of Problem 30.
    33. Draw the Bode plot for the circuit of Problem 31.
    34. A noninverting amplifier used for ultrasonic applications has a midband
         gain of 41 dB, a lag network critical at 250 kHz, and a lead network critical
         at 30 kHz. Draw its gain Bode plot.
    35. Find the gain and phase at 20 kHz, 100 kHz, and 800 kHz for the circuit of
         Problem 34.
    36. If the circuit of Problem 34 has a second lag network added at 300 kHz,
         What are the new gain and phase values at 20 kHz, 100 kHz, and 800 kHz?

60
    37. Draw the gain Bode plot for the circuit of Problem 36.
    38. What are the maximum and minimum phase shifts across the entire

         frequency spectrum for the circuit of Problem 36?
    39. A noninverting DC amplifier has a midband gain of 36 dB, and lag networks

         at 100 kHz, 750 kHz, and 1.2 MHz. Draw its gain Bode plot.
    40. What are the maximum and minimum phase shifts across the entire

         frequency spectrum for the circuit of Problem 39?
    41. What is the maximum rate of high frequency attenuation for the circuit of

         Problem 39 in dB/decade?
    42. If an amplifier has two lead networks, what is the maximum rate of low

         frequency attenuation in dB/octave?

Analysis Problems - Differential amplifier emphasis

    43. Given the circuit of Figure 1.20, determine the single-ended input/single-
         ended output gain for the following values: RB=5 k , RT=7.5 k,
         RC=12 k , VCC=25 V, VEE=-9 V, rE=50 .

    44. Determine the differential voltage gain in the circuit of Figure 1.28 if
         RB= 15 k, R1=5 k, R2=7 k, R3= 10 k, RC= 20 k, VCC= 22 V,
         VEE=-12 V, rE=75 .

    45. For the circuit of Problem 44, determine the output at collector 2 if
         Vin1(t)=0.001 sin 21000t and Vin2(t)=-0.001 sin 21000t.

    46. Determine the differential voltage gain in the circuit of Figure 1.31 if
         Rb=8 k, Rmirror=22 k, RC=10 k, VCC=18 V, VEE=-15 V, rE=25 .

    47. For the circuit of Problem 46, determine the output at collector 1 if
         Vin1(t)=-0.005 sin 22000t and Vin2(t)=0.005 sin 22000t.

    48. Determine the tail and emitter currents in the circuit of Figure 1.33 if
         RB=6 k, Rmirror=50 k, VCC=15 V, VEE=-15 V, rE=0.

Challenge Problems

    49. You would like to use a voltmeter to take dBm readings in a 600  system.
         What voltage should produce 0 dBm?

    50. Assuming that it takes about an 8 dB increase in sound pressure level in
         order to produce a sound that is subjectively "twice as loud" to the human
         ear, can a hi-fi using a 100 W amplifier sound twice as loud as one with a 40
         W amplifier (assuming the same loudspeakers)?

    51. Hi-fi amplifiers are often rated with a "headroom factor" in dB. This
         indicates how much extra power the amplifier can produce for short periods
         of time, over and above its nominal rating. What is the maximum output
         power of a 250 W amplifier with 1.6 dB headroom?

61
    52. If the amplifier of Problem 34 picks up an extraneous signal that is a
         -10 dBV sine wave at 15 kHz, what is the output?

    53. If the amplifier of Problem 39 picks up a high frequency interference signal
         at 30 MHz, how much is it attenuated over a normal signal? If this input
         signal is measured at 2 dBV, what should the output be?

    54. If an amplifier has two lag networks, and both are critical at 2 MHz, is the
         resulting f2 less than, equal to, or greater than 2 MHz?

    55. If an amplifier has two lead networks, and both are critical at 30 Hz, is the
         resulting f1 less than, equal to, or greater than 30 Hz?

Computer Simulation Problems
    56. Use a simulator to plot the Bode gain response of the circuit in Problem 39.
    57. Use a simulator to plot the Bode phase response of the circuit in Problem 34.
    58. Use a simulation program to generate a Bode plot for a lead network
         comprised of a 1 k resistor and a 100 nF capacitor.

                                         A Circuit Analysis Haiku
                                          Kirchhoff's voltage law
                                     What could be more important?
                                          I'm thinking Ohm's law

62
2 Operational Amplifier Internals

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Describe the internal layout of a typical op amp.
    · Describe a simple op amp computer simulation model.
    · Determine fundamental parameters from an op amp data sheet.
    · Describe an op amp based comparator, and note where it might be used.
    · Describe how integrated circuits are constructed.
    · Define monolithic planar construction.
    · Define hybrid construction.

2.1 Introduction

In this chapter we introduce the fundamentals of the operational amplifier, or op amp, as it is commonly known.
We will investigate the construction and usage of a typical general-purpose op amp. Specific along with
generalized internal circuits and associated block diagrams are examined. An initial op amp data sheet
interpretation is given as well. Toward the middle of the chapter, the first op amp circuit examples are presented.
The chapter finishes with an explanation of semiconductor integration and construction techniques. After
finishing this chapter, you should be familiar with the concepts of what an op amp is composed of, how it is
manufactured, and a beginning idea of how it might be used in application circuit design.

2.2 What Is An Op Amp?

An operational amplifier is, in essence, a multi-stage high gain amplifier treated as a single entity. Normally, op
amps have a differential input and a single-ended output. In other words, one input produces an inverted output
signal, and the other input produces a noninverted output signal. Often, the op amp is driven from a bipolar
power supply (i.e., two supplies, one positive and one negative). Just about any sort of active amplifying device
may be used for the individual stages. Op amps can be made entirely from vacuum tubes or discrete bipolar
transistors (and of course, they were made that way some years ago). The advances in semiconductor
manufacture in the late 1960s and early 1970s eventually made it possible to miniaturize the required
components and place the whole affair on a single silicon chip (hence the term, integrated circuit). Through
common use, this is what is generally meant by the term op amp today.

63
As seen in Figure 2.1, a typical op amp has at least five distinct connections; an       Figure 2.1
inverting input (labeled "-"), a noninverting input (labeled "+"), an output, and        General op amp symbol.
positive and negative power supply inputs. These power supply connections are
sometimes referred to as supply rails. Note that a ground connection is not directly
given. Rather, a ground connection is implied through the other connections. This
symbol and its associated connections are typical, but by no means absolute. There
are a wide variety of devices available to the designer that offer such features as
differential outputs or unipolar power supply operation. In any case, some form of
triangle will be used for the schematic symbol.

It is best to think of op amps as general-purpose building blocks. With them, you can
create a wide variety of useful circuits. For general-purpose work, designing with op
amps is usually much quicker and more economical than an all-discrete approach.
Likewise, trouble shooting and packaging constraints may be lessened. For more
demanding applications, such as those requiring very low noise, high output current
and/or voltage, or wide bandwidth, manufacturers have created specialized op amps.
The final word in performance today is still dominated by discrete circuit designs
though. Also, it is very common to see a mix of discrete and integrated devices in a
given circuit. There is certainly no law that states that op amps can only be used with
other op amps. Often, a judicious mix of discrete devices and op amps can produce a
circuit superior to one made entirely of discretes or op amps alone.

Where might you find op amp circuits? In a word, anywhere. They're probably in
use in your home stereo or TV where they help capture incoming signals, in
electronic musical instruments where they can be used to create and modify tones, in
a camera in conjunction with a light metering system, or in medical instruments
where they might be used along with various bio-sensing devices. The possibilities
are almost endless.

Block Diagram Of An Op Amp

At this point you may be asking yourself, "what's inside of the op amp?" The
generic op amp consists of three main functional stages. A real op amp may contain
more than three distinct stages, but can be reduced to this level for analysis. A
generalized discrete representation is given in Figure 2.2. Since the op amp requires
a differential input scheme, the first stage is most often a differential amplifier. As
seen here, Q1 and Q2 comprise a PNP-based differential amplifier. The output of one
collector (Q2 here) is then fed to a high-gain second stage. This stage usually
includes a lag network capacitor that plays a major roll in setting the op amp's AC
characteristics (this is examined further in Chapter Five). Q3 makes up the second
stage in the example. It is set in a common emitter configuration for both current and
voltage gain. The aforementioned lag capacitor is positioned across Q3's base-
collector junction in order to take advantage of the Miller effect. The third and final
section is a class B or class AB follower for the most effective load drive. Q4 and Q5
make up the final stage. The twin diodes compensate for the Q4 and Q5 VBE drops,

64
and produce a trickle bias current that minimizes distortion. This is a relatively
standard class AB stage. Note that the entire circuit is direct-coupled. There are no
lead networks, and thus the op amp can amplify down to zero hertz (DC). There are
many possible changes that may be seen in a real world circuit, including the use of
Darlington pairs or FETs for the differential amplifier, multiple high gain stages, and
output current limiting for the class B section.

                                                                                                                     Figure 2.2
                                                                                                                     General op amp schematic.

The example discrete circuit uses only five transistors and two diodes. In contrast, an
integrated version may use two to three dozen active devices. Because of the
excellent device matching abilities of single chip integration, certain techniques are
used in favor of standard discrete designs. Internal IC current sources are normally
made through the use of current mirrors. Current mirror configurations are also
employed to create active loads, in order to achieve maximum circuit gain.

                                                                                                                     Figure 2.3
                                                                                                                     LF411 simplified schematic.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

A typical integrated op amp will contain very few resistors, and usually only one or
two lag network capacitors. Due to size limitations and other factors, inductors are
65
virtually unseen in these circuits. A simplified equivalent circuit of the LF411 op
amp is shown in Figure 2.3. Note that this device uses JFETs for the diff amp with an
active load. The diff amp tail current source and the class AB trickle bias source are
shown as simple current sources. In reality, they are a bit more complex, utilizing
current mirror arrangements.

One of the most popular op amps over the years has been the 741. The specifications
of this device seem rather lackluster by today's standards, but it was one of the first
easy-to-use devices produced. As a result, it has found its way into a large number of
designs. Indeed, it is still a wise choice for less demanding applications, or where
parts costs are a major consideration. A complete schematic of the A 741 is shown
in Figure 2.4. Several different manufacturers make the 741. This version is
manufactured by Signetics, and may be somewhat different than a 741 made by
another company2. The circuit contains 20 active devices and about one dozen
resistors.

                                                                                                                     Figure 2.4
                                                                                                                     Schematic of µA741.

                                                                                                                                                   Reprinted courtesy of Philips
                                                                                                                                                   Semiconductors

At first glance, this circuit may look hopelessly confusing. A closer look reveals
many familiar circuit blocks. First off, you will notice that a number of devices show
a shorting connection between their base and collector terminals, such as Q8, Q11,
and Q12. In essence, these are diodes (they are drawn this way because they are
manufactured as transistor junctions. It is actually easier to make diodes in this
fashion). For the most part, these diodes are part of current mirror biasing networks.
The bias setup is found in the very center of the schematic, and revolves around Q9
through Q12. The setup current is found by subtracting two diode drops (Q11, Q12)
2 While the exact internal circuitry may be altered, the various manufacturers versions will

    have the same pinouts, and very similar performance specifications.

66
from the total power supply potential (V+ - V-), and dividing the result by R5. For a
standard ±15 V power supply, this works out to

                                I bias= V +-V --V BE -Q11-V BE -Q12
                                                      R5

                                Ibias= 30V-1.4 V 39k 
                                I bias=733 A

This current is reflected into Q13. A close look at Q10 and Q11 reveals that this portion
is not a simple current mirror. By including R4, the voltage drop across the base-
emitter of Q10 is decreased, thus producing a current less than 733 A. This
configuration is known as a Widlar current source. The derivation of the exact
current equation is rather involved, and beyond the scope of this chapter3. This
current is reflected into Q8 via Q9, and establishes the tail current for the differential
amplifier. The diff amp stage uses a total of four amplifying transistors in a
common-collector/common-base configuration (Q1 through Q4). In essence, Q1 and
Q2 are configured as emitter followers, thus producing high input impedance and
reasonable current gain. Q3 and Q4 are configured as common base amplifiers, and
as such, produce a large voltage gain. The gain is maximized by the active load
comprised of Q5 through Q7. The output signal at the collector of Q4 passes on to a
dual transistor high-gain stage (Q16 and Q17). Q16 is configured as an emitter follower
and buffers Q17, which is set as a common emitter voltage amplifier. Resistor R11
serves to stabilize both the bias and gain of this stage (i.e., it is an emitter
degeneration or swamping resistor). Q17 is directly coupled to the class AB output
stage (Q14 and Q20). Note the use of a VBE multiplier to bias the output transistors.
The VBE multiplier is formed from Q18 and resistors R7 and R8. Note that this section
receives its bias current from Q13 which is part of the central current mirror complex.

Some transistors in this circuit are used solely for protection from overloads. A good
example of this is Q15. As the output current increases, the voltage across R9 will
increase proportionally. Note that this resistor is in parallel with the base emitter
junction of Q15. If this potential gets high enough, Q15 will turn on, shunting base
drive current around the output device (Q14). In this manner, current gain is reduced,
and the maximum output current is limited to a safe value. This limiting value may
be found via Ohm's law:

                                 I limit= V BE
                                          R9

                                I limit= 0.7 V 25 
                                I limit=28 mA

3 A complete derivation of the Widlar current source may be found in Principles of
    Electronic Circuits, by S.G.Burns and P.R.Bond, 1987, West Publishing Company.

67
In a similar fashion, Q20 is protected by R10, R11, and Q22. If the output tries to sink
too large of a current, Q22 will turn on, shunting current away from the base of Q16.
While individual op amp schematics will vary widely, they generally hold to the
basic four-part theme presented here:

    · A central current source/current mirror section to establish proper bias.
    · A differential amplifier input stage with active load.
    · A high voltage gain intermediate stage.
    · A class B or AB follower output section.
Fortunately for the designer or repair technician, intimate knowledge of a particular
op amp's internal structure is usually not required for successful application of the
device. In fact, a few simple models can be used for the majority of cases. One very
useful model is given in Figure 2.5.

                                                                                                                     Figure 2.5
                                                                                                                     Simplified model.

Here the entire multistage op amp is modeled with a simple resistive input network,
and a voltage source output. This output source is a dependent source. Specifically,
it is a voltage-controlled voltage source. The value of this source is

                                E out= Av(V in+-V in-)
The input network is specified as a resistance from each input to ground, as well as
an input-to-input isolation resistance. For typical op amps these values are normally
hundreds of kilo ohms or more at low frequencies. Due to the differential input
stage, the difference between the two inputs is multiplied by the system gain. This
signal is presented to the output terminal through the final stage's output impedance.
The output impedance will most likely be less than 100 . System voltage gains in
excess of 80 dB (10,000) are the norm.

68
A Simple Op Amp Simulation Model

It is possible to create a great variety of simulation models for any given op amp.
Generally speaking, the more accurate the model is, the more likely it is to be
complex. Due to the nature of most simulators, a more complex model requires a
greater amount of time for an analysis to be completed. There is always a trade-off
between model complexity and computation time. We can create a very simple
model based on the previous section. This model is shown in Figure 2.6.

                                                                                                                     Figure 2.6
                                                                                                                     Simplified SPICE model.

It consists of just five nodes. The input section is modeled as a single resistor, Rin,
between nodes 1 and 2. These two nodes are the noninverting and inverting inputs of
the op amp, respectively. The second half of the model consists of a voltage-
controlled voltage source and an output resistor. The value of this dependent source
is a function of the differential input voltage and the voltage gain. With a minimum
of components, the simulation time for this model is very low. In order to use this
model, you need only set three parameters, the input resistance, the output
resistance, and the voltage gain. An example is shown in Figure 2.7 using Multisim.

                                                                                                                     Figure 2.7
                                                                                                                     Simple op amp model in
                                                                                                                     Multisim.

69
This model must be used with great care because it is so simplistic. It is useful as a
learning tool for investigating the general operation of an op amp, but should never
be considered as part of a true-to-life simulation. This model makes no attempt to
consider the many limitations of the op amp. Because this model in no way imposes
output signal swing limits, the effects of saturation will go unnoticed. Similarly, no
attempt has been made at modeling the frequency response of the op amp. This is of
great concern and we will spend considerable time on this subject in later chapters.
Many other effects are also ignored. With so many limitations, you might wonder
just where such a model may be used. This model is useful for noncritical
simulations given low frequency inputs. You must also recognize the onset of
saturation (clipping) yourself. Its primary advantage is that the circuit model is
small, and thus computationally fast. Because of this, it is very efficient for students
who are new to both op amps and circuit simulation. Perhaps of equal importance, is
the fact that this model points out the fact that your simulation results can only be as
good as the models you use. Many people fall into the trap that "because the
simulation came from a computer, it must be correct". Nothing could be further from
the truth. Always remember the old axiom: GIGO (Garbage In = Garbage Out). It
can be very instructive to simulate a circuit using differing levels of accuracy and
complexity, and then noting how closely the results match the same circuit built in
the laboratory.

Op Amp Data Sheet and Interpretation

Different manufacturers often use special codes and naming conventions to delineate
their products from those of other manufacturers, as well as providing quality level
and manufacturing information. A manufacturer's code is usually a letter prefix,
while a quality or construction code is a suffix. Common prefix codes include A
(Fairchild), AD (Analog Devices), CS (Crystal), LM, LH, and LF (National
Semiconductor, now owned by Texas Instruments, with M indicating monolithic
construction, H indicating hybrid construction, and F indicating an FET device), LT
(Linear Technology), MC (Motorola), NE and SE (Signetics), OPA (Burr-Brown),
and TL (Texas Instruments).

Many manufacturers make a host of standard parts such as the 741. For example,
Texas Instruments makes the LM741, while Fairchild makes the A741. These parts
are generally considered to be interchangeable, although they may vary in some
ways. Some manufacturers will use the prefix code of the original developer of a
part, and reserve their prefix for their own designs. As an example, Signetics
produces their version of the 741, that they call A741 because this op amp was first
developed by Fairchild. (Signetics is then referred to as a second source for the
A741).

Suffix codes vary widely between manufacturers. Typical designations for consumer
grade parts are C, and CN. The suffix N often means Not Graded. Interestingly, the
lack of a final suffix often indicates a very high quality part, usually with an

70
extended temperature range. Suffix codes are also used to indicate package styles.
This practice is particularly popular among voltage regulators and other high power
linear ICs.
Finally, some manufacturers will use a "parallel" numbering system for high-grade
parts. For example, the commercial grade device may have a "300 series" part
number, with industrial grade given a "200 series" designation, and a military grade
part given a "100 series" number. One possible example is the LM318 commercial
grade op amp versus its high-grade counterpart, the LM118. Generally, military-
specified parts will have a very wide temperature range, with industrial and
commercial grades offering progressively less.
The data sheet for the LF411 op amp is shown in Figure 2.8. Let's take a look at
some of the basic parameters and descriptions. The values given are typical of a
modern op amp. A complete investigation of all parameters will be given in Chapter
Five, once we've gotten a little more familiar with the device.

                                                                                                                     Figure 2.8
                                                                                                                     Data sheet for the LF411.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

71
                                                                                                                      Figure 2.8 (cont.)
                                                                                                                      Data sheet for the LF411.

                                                                                                                                                    Reprinted courtesy of Texas
                                                                                                                                                    Instrutments

First, note that two versions of the IC are given. We will examine the LF411 rather
than the high-grade LF411A. At the very top of the data sheet is a listing of the
absolute maximum ratings. The op amp should never operate at values greater than
those presented as doing so may permanently damage it. Like most general purpose
op amps, the LF411 is powered by a bipolar power supply. The supply rails should
never exceed ±18 VDC. Normally, op amps will be used with ±15 V supplies.
Maximum power dissipation is given as 670 mW. Obviously then, this is a small
signal device. In keeping with this, the operating temperature range and maximum
junction temperatures are relatively low. We also see that the device can withstand
differential input signals of up to 30 V, and single-ended inputs of up to 15 V,
without damage. On the output, the LF411 is capable of withstanding a shorted load
condition continuously. This makes the op amp a bit more "bullet proof'". The
remainder of this section details soldering conditions. Excessive heat during
soldering may damage the device.

72
The second section of the data sheet lists the DC characteristics of the op amp. This
table is broken down into five major sections:

    · The parameter symbol.
    · The parameter name.
    · The conditions under which the parameter is measured.
    · The parameter values, either typical or min/max.
    · The parameter units.

We will examine a few of these parameters right now. The fourth parameter given is
IB, the input bias current. IB is the current drawn by the bases (or gates) of the input
differential amplifier stage. Because the LF411 utilizes a JFET diff amp, we expect
this value to be rather small. For an operating temperature of 25°C, a typical LF411
will draw 50 pA, and a worst-case LF411 no more than 200 pA. If we extend the
temperature range out a bit, IB can extend out to 50 nA. This is a sizable jump, but
even 50 nA is a very small value for general purpose work. Because larger bias
currents are normally seen as undesirable, the maximum IB is the worst case
scenario, hence a minimum IB is not reported. Along with this, we see a very high
value for input resistance, some 1012 , typically. Op amps utilizing bipolar input
devices will show much higher values for IB, and much lower values for Rin.

Next in line comes Avol. This is the DC voltage gain. Note the test conditions. The
power supply is set to ±15 V, the load is 2 k, and Vout is 10 V peak. Normally, we
desire as much gain as possible, so the worst case scenario is the minimum Avol. For
25°C operation this is specified as 25 V/mV, or 25,000. The average device will
produce a gain of 200,000. As is typical, once the temperature range is expanded
performance degrades. Over the operating temperature range, the minimum gain
may drop to 15,000.

Because the op amp uses a class AB follower for its output stage, we should expect
the output compliance to be very close to the power supply rails. The output voltage
swing is specified for ±15 V supplies with a 10 k load. The typical device can
swing out to ±13.5 V, with a worst case swing of ±12 V. A reduction in power
supply value will naturally cause the maximum output swing to drop. A sizable
reduction in the load resistance will also cause a drop in Vo, as we will see a bit later.
These maximum output values are caused by the internal stages reaching their
saturation limits. When this happens, the op amp is said to be clipping or in
saturation. As a general rule of thumb, saturation may be approximated as 1.5 V less
than the magnitude of the power supplies.

The last item in the list is the standby current draw, IS. Note how small this is, only
1.8 mA, 3.4 mA worst case. This is the current the op amp draws from the supply
under no signal conditions. When producing output signals, the current draw will
rise.

73
The final section of the data sheet lists certain AC characteristics of the op amp that
will be of great concern to us in later sections. Many device parameters change a
great deal with frequency, temperature, supply voltage, or other factors. Because of
this, data sheets also include a large number of graphs that further detail the op
amp's performance. Finally, application hints and typical circuits may round out the
basic data sheet.

2.3 Simple Op Amp Comparator                                                              Figure 2.9
                                                                                          Comparator (single input).
Now that you have a feel for what an op amp is and what some typical parameters
are, let's take a look at an application. The one thing that jumps to most people's       Figure 2.10
attention is the very high gain of the average op amp. The typical LF411 showed Avol      Comparator (dual input).
at approximately 200,000. With gains this high, it is obvious that even very small
input signals can force the output into saturation (clipping). Take a look at Figure
2.9. Here an op amp is being supplied by ±15 V, and is driving a 10 k load. As
seen in our model of Figure 2.5, Vout should equal the differential input voltage
times the op amp's gain, Avol.

                                V out= Avol (V in+-V in-)
                                V out= 200,000×(0.1 V-0 V )
                                V out= 20,000 V

The op amp cannot produce 20,000 V. The data sheet lists a maximum output swing
of only ±13.5 V when using ±15 V supplies. The output will be truncated at 13.5 V.
If the input signal is reduced to only 1 mV, the output will still be clipped at 13.5 V.
This holds true even if we apply a signal to the inverting input, as in Figure 2.10.

                                V out= Avol (V in+-V in-)
                                V out=200,000×(0.5 V-0.3 V )
                                V out=40,000 V
                                V out=13.5 V, due to clipping

Computer Simulation

A simulation of Figure 2.10 using Multisim is shown in Figure 2.11. The LF411 op
amp is selected from the component library, and you need not concern yourself with
the model's internal make-up just yet. This particular model includes the effects of
power supply limitations (i.e., output saturation) that the very simple dependent-
source model presented earlier does not. Individual DC sources are used for the input
signals. Although no AC signals are applied, it is perfectly valid to run a transient-
mode simulation. The first millisecond of the output voltage is shown. It verifies the
manual calculation, indicating a DC level of slightly more than 13.5 V.

74
                                                                                                                     Figure 2.11a
                                                                                                                     Comparator example in
                                                                                                                     Multisim.

                                                                                                                     Figure 2.11b
                                                                                                                     Comparator output.

For any reasonable set of inputs, as long as the noninverting signal is greater than
the inverting signal, the output will be positive saturation. If you trade the input
signals so that the inverting signal is the larger, the converse will be true. As long as
the inverting signal is greater than the noninverting signal, the output will be
negative saturation. If the inverting and noninverting signals are identical, Vout
75
should be 0 V. In the real world, this will not happen. Due to minute discrepancies
and offsets in the diff amp stage, either positive or negative saturation will result.
You have no quick way of knowing in which direction it will go. It is for this reason
that it is impractical to amplify a very small signal, say around 10 V. You might
then wonder, "What is the use of this amplifier if it always clips? How can I get it to
amplify a simple signal?" Well, for normal amplification uses, we will have to add
on some extra components, and through the use of negative feedback (next chapter),
we will create some very well-controlled, useful amplifiers. This is not to say that
our barren op amp circuit is useless. Quite to the contrary, we have just created a
comparator.

A comparator has two output states: High and low. In other words, it is a digital,
logical output. Our comparator has a high state potential of 13.5 V, and a low state
potential of -13.5 V. The input signals, in contrast, are continuously variable analog
potentials. A comparator, then, is an interface between analog and digital circuitry.
One input will be considered the reference, while the other input will be considered
the sensing line. Note that the differential input signal is the difference between the
sensing input and the reference input. When the polarity of the differential input
signal changes, the logical output of the comparator changes state.

Example 2.1

    Figure 2.12 shows a light leakage detector that might be used in a                   Figure 2.12
    photographer's dark room. This circuit utilizes a Cadmium Sulfide (CdS)              Light alarm.
    cell that is used as a light sensitive resistor. The inverting input of the op
    amp is being used as the reference input, with a 1 VDC level. The
    noninverting input is being used as the sensing input. Under normal (no
    light) conditions, the CdS cell acts as a very high resistance, perhaps 1 M.
    Under these conditions, a voltage divider is set up with the 10 k resistor,
    producing about 150 mV at the noninverting input. Remember, no loading
    of the divider occurs because the LF411 utilizes a JFET input. Because the
    noninverting input is less than the inverting input, the comparator's output is
    negative saturation, or approximately -13.5 V. If the ambient light level
    rises, the resistance of the CdS cell drops, thus raising the signal applied to
    the noninverting input. Eventually, if the light level is high enough, the
    noninverting input signal will exceed the 1 V reference, and the
    comparator's output will move to positive saturation, about +13.5 V. This
    signal could then be used to trigger some form of audible alarm. A real
    world circuit would need the flexibility of an adjustable reference in place of
    the fixed 1 V reference. By swapping the CdS cell and the 10 k resistor,
    and adjusting the reference, an inverse circuit (i.e., an alarm that senses
    darkness) may be produced.

    Circuits of this type can be used to sense a variety of over level/under level
    conditions, including temperature and pressure. All that is needed is an

76
appropriate sensing device. Comparators can also be used with AC input
signals.

Example 2.2

Sometimes, it is necessary to square up an AC signal for further processing.                Figure 2.13
That is, we must turn it into an equivalent pulse waveform. One example of                  "Square-up" circuit.
this might be a frequency counter. A frequency counter works by tallying
the number of high-to-low or low-to-high transitions in the input signal over
a specific length of time. For accurate counts, good edge transitions are
required. Because a simple sine wave changes relatively slowly compared to
an equal frequency square wave, some inaccuracy may creep into the
readings. We can turn the input into a pulse-type output by running it
through the comparator of Figure 2.13. Note that the reference signal is
adjustable from -15 to +15 V. Normally, the reference is set for 0 V.
Whenever the input is greater than the reference, the output will be positive
saturation. When the input is less than the reference, the output will be
negative saturation. By making the reference adjustable, we have control
over the output duty cycle, and can also compensate for DC offsets on the
input signal. A typical input/output signal set is given in Figure 2.14.

                      reference

                      setting                                                               Figure 2.14

                                                                                                           Output of "square-up" circuit.

             Vin t

             +13.5 V  signal
                      input
               Vout
                                      t
             -13.5 V

         There are a few limitations with our simple op amp comparator. For very
         fast signal changes, a typical op amp will not be able to accurately track its
         output. Also, the output signal range is rather wide and is bipolar. It is not at
         all compatible with normal TTL logic circuits. Extra limiting circuitry is
         required for proper interfacing. To help reduce these problems, a number of
         circuits have been specially optimized for comparator purposes. We will
         take a closer look at a few of them in Chapter Seven.

77
2.4 Op Amp Manufacture

Op amps and other linear integrated circuits are generally manufactured in one of
two ways: The device is either a hybrid, or is monolithic. In either case, the circuit
can contain hundreds of components. The resulting device will be packaged in a
variety of styles, including plastic and ceramic dual in-line and single in-line types,
multi-lead cans, flat packs, and surface mount forms. Some examples are shown in
Figure 2.15. In each type, the circuitry is completely encased and not accessible to
the designer or technician. If one of the components should fail, the entire op amp is
replaced. The design and layout of the integrated circuit itself is normally carried out
with the use of special computer workstations and software tools. These allow the
designers to simulate portions of the circuit, and create the outlines and
interconnections for the various components to be formed.

                                                                                                                Figure 2.15
                                                                                                                Package styles (through hole)
                                                                                                                clockwise from top-left: can,
                                                                                                                single in-line, mini dual in-line,
                                                                                                                dual in-line.

Monolithic Construction

The term monolithic is from the Greek, meaning literally "single stone". In this
process, all circuit elements are created and interconnected using a single slab of
silicon (or other suitable material). Normally, several op amps are made from a
single silicon wafer. Each wafer may be a few inches in diameter, with each op amp
circuit chip comprising perhaps a square 1 millimeter by 1 millimeter in area. A
single transistor can easily be smaller than 15 micrometers by 20 micrometers.
Because the scale of construction is so small, special clean rooms are required in
order to remove tiny air-borne particles of dust and grit that could interfere with the
production of these super-small components. Workers in clean rooms are required to
wear special suits as well.

Figure 2.16 outlines the major steps in the chip manufacturing process. This process
starts with the preparation of a P-type silicon wafer. This is referred to as the
substrate. After it has been cleaned and polished, an N-type epitaxial region is
diffused into the P-type base. Epitaxial is from the Greek, roughly meaning "to

78
arrange upon". It is within this thin epitaxial region that the circuit elements will be
formed, the remainder of the substrate lending mechanical support to the structure.
The term diffusion refers to the manner in which the semiconductor material
becomes doped. In essence, the base material is surrounded by a high concentration
of doping material, usually gaseous, along with the application of heat. The low
concentration wafer material will be infiltrated by the high concentration doping
material. Diffusion is a relatively accurate and inexpensive means of controlling the
semiconductor's properties.

    Circuit  Creation of photomasks                                                        Figure 2.16
    design                                                                                 Chip manufacturing process.

    Ingot    Wafer (slice)  Epitaxial  Various diffusion sets  Test

                            diffusion

                                       Final  Packaging        Individual
                                       test                    chip
                                                               breakout

Once the N-type region is produced, the wafer will undergo an oxidizing process
that will leave the top surface covered with silicon dioxide. This layer prevents
impurities from entering the N-type region. At this point, a series of steps will be
used to create wells or deposits of alternate p and n material. These deposits will
form the various active and passive components. Normally, this is done through a
photolithographic process. This involves the use of light sensitive materials and
masks. Conceptually, the process is not very much different from the way printed
circuit boards are often made. In essence, specific areas of the silicon dioxide layer
will be stripped away, thus exposing the epitaxial region, and allowing diffusion of
other acceptor/donor impurities to take place. Because the silicon dioxide serves as
an effective barrier to diffusion, only areas cleared of silicon dioxide will be affected
by the diffusion process. In this manner, specific areas can be singled out, and
selectively doped to create specific components. This is detailed below and in
Figure 2.17.

In order to selectively remove the silicon dioxide, the top surface is coated with a
light sensitive material called photoresist. Above this is placed a mask. This mask is
much like a black and white negative; some areas are clear, and some areas are
opaque. The resulting sandwich is then exposed to ultraviolet light. The clear areas
of the mask will allow the light to pass through and cause a chemical change in the
photoresist. A solution is then used to wash away the unexposed photoresist. At this
point, a second solution is used to wash away the silicon dioxide. This solution will
not effect the exposed photoresist, and thus, the silicon dioxide beneath it is
unaffected. After this protecting layer of photoresist is removed, all that remains on

79
the top surface of the wafer are alternating patches of silicon dioxide. The wafer can
now be lead through another diffusion process.

                                                                                                                            UV

                                                                             Mask                                               Figure 2.17
                                                                             Photoresist                                        Diffusion process (one run).

                            SiO2                       SiO2

               n epitaxial        n epitaxial                n epitaxial
               p substrate        p substrate                p substrate

Photoresist                 SiO 2                            p            p
        SiO 2
                                          n epitaxial  SiO2                  Newly diffused
                                          p substrate                        p+ region
               n epitaxial                                                   (isolation mask)
               p substrate
                                                             p substrate

The process of oxidizing, masking, and diffusing will be repeated several times. The
initial run will be produced with an isolation mask. This is used to separate the
various components. Normally, a base mask will be used next, followed by the
emitter mask. The final masks will be used for contacts and interconnections. In this
way, N-type material can be placed next to, or completely within, P-type material.
The adjoining areas are, of course, PN junctions. Because all circuit elements are
laid out length-wise on a thin strip, this form of manufacture is referred to as a
planar process.

Once the final mask is completed, the wafer will be inspected. The individual chips
will then be broken out of the wafer and mounted into the desired package. Leads
will be connected to the chip with fine angel hair wire, and then the package will be
sealed. It is now ready for final test and inspection. Part numbers and date codes will
also be imprinted.

Virtually all general-purpose op amps today use a planar monolithic process. Some
of the advantages of monolithic construction are its relative simplicity and low per-
part cost.

Hybrid Construction

Hybrids are usually used where a complete monolithic solution is impractical. This
is usually the case for special purpose devices, such as those requiring very high
output current, very wide bandwidth, or that are very complex or sensitive. Hybrids,
as the name suggests, are a collection of smaller circuit elements interconnected. A
typical hybrid may contain two or three smaller monolithic chips and assorted
miniaturized passive and/or power components. Passive components may be further
integrated by using either a thin or thick film chip process. (A discussion of thin and
thick film chip techniques is beyond the scope of this text). Due to the complexity of

80
a hybrid chip, it is normally more expensive than its monolithic cousins. Although
the IC itself may be more expensive, the complete application may very well wind
up being less costly to produce because the cost of other components are effectively
absorbed within the hybrid IC. One place where hybrids are often used is in
consumer stereo music systems. A hybrid power amplifier IC offers the convenience
of a single IC solution with the capabilities of a discrete transistor approach. As an
op amp user, it makes little difference whether the device is hybrid or monolithic
when it comes to circuit analysis or design.

Summary

Op amps are presently in wide use in just about every aspect of linear electronics.
An op amp is a multi-stage amplifier treated as a single entity. The first stage usually
utilizes a differential amplifier that can be made with either bipolar or FET devices.
The following stage(s) create a large voltage gain. The final stage is a class B
voltage follower. The resulting op amp typically has a high input impedance, a low
output impedance, and voltage gains in excess of 10,000. The op amp operates from
a bipolar power supply, usually around ±15 V. Externally, it has connections for the
inverting and noninverting inputs, the single-ended output, and the power supplies.
The op amp may be packaged in a variety of forms, including DIPs, SIPs, cans, flat
packs and surface mount.

The general-purpose op amp is manufactured using a monolithic structure and a
photolithographic process. Several chips are created from a single master wafer.
Creation is a multi-step process involving the selective doping of specific areas on
the chip through diffusion. The monolithic technique is relatively inexpensive and
accurate. Because integration allows for very tight part matching and consistency,
certain circuit design techniques are favored, including the use of current mirrors
and active loads.

Finally, with very little supporting circuitry, simple op amps can make effective
comparator circuits. A comparator is in essence, a bridge between the analog and
digital worlds.

Review Questions

    1. What is an op amp?
    2. Give several examples of where op amps might be used.
    3. What is the typical stage layout of an op amp?
    4. What comprises the first stage of a typical op amp?
    5. What comprises the final stage of a typical op amp?
    6. How does integrated circuit design differ from discrete design?
    7. What is a comparator, and how might it be used?
    8. What is meant by monolithic planar construction?

81
    9. What is a mask, and how is it used in the construction of IC op amps?
    10. What is the process of diffusion and how does it relate to the construction of

         IC op amps?
    11. What are the advantages of monolithic IC construction?
    12. How does hybrid construction differ from monolithic construction?

Problems

    1. For the circuit in Figure 2.18, find Vout for the following inputs: a) 0 V b) -1
         V c) +2 V
                                                                        Figure 2.18

    2. For the circuit in Figure 2.19, find Vout for the following inputs: a) 0 V b) -4
         V c) +5 V d) -0.5 V

                                                                        Figure 2.19

    3. For the circuit in Figure 2.20, find Vout for the following inputs: a) 0 V b) -2
         V c) +1 V d) -0.5 V
                                                                        Figure 2.20

    4. Sketch Vout if Vin(t) = 1 sin 60t in Figure 2.18.
    5. Sketch Vout if Vin(t) = 2 sin 20t in Figure 2.19.
    6. Sketch Vout if Vin(t) = 3 sin 10t in Figure 2.20.
    7. A Temperature Dependent Resistor is used in the comparator of Figure 2.21.

         At what temperature will the comparator change state?

82
                                                                        Figure 2.21

    8. What is the value of the Light Dependent Resistor at the comparator trip
         point in Figure 2.22?
                                                                        Figure 2.22

    9. What reference voltage is required for a 50°C trip point in Figure 2.21?
                                                                        Figure 2.23

    10. A thermal fuse is device found in such common items as coffee makers.
         Normally, its resistance is very low, ideally 0 . With the application of
         excessive heat, the fuse opens, presenting a very high resistance, ideally
         infinite. Explain the operation of the circuit in Figure 2.23. Is the output
         voltage normally high or low?

    11. A strain gauge is a device that can be used to measure the amount of bend or
         deflection in a part that it is attached to. It can be connected so that its

83
         resistance rises as the bend increases. What resistance is required to trip the
         comparator of Figure 2.24?

                                                                        Figure 2.24

    12. Determine the current flowing out of the collector of Q13 in Figure 2.4.
Computer Simulation Problem

    13. Alter the simple simulation model presented in the chapter to include
         saturation effects. (Hint: Consider a device that limits voltage.)

84
3 Negative Feedback

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Give examples of how negative feedback is used in everyday life.
    · Discuss the four basic feedback connections, detailing their similarities and differences.
    · Detail which circuit parameters negative feedback will alter, and how.
    · Discuss which circuit parameters are not altered by negative feedback.
    · Define the terms sacrifice factor, gain margin, and phase margin, and relate them to a Bode plot.
    · Discuss in general, the limits of negative feedback in practical amplifiers.

3.1 Introduction

As we saw in the last chapter, op amps are very useful devices. However, in many applications, the device's gain
is simply too large and its bandwidth too narrow, for effective use. In this chapter we will explore the concept of
negative feedback. This concept is realized by feeding a portion of the output signal back to the input of the
system. The proper use of negative feedback will allow us to exercise fine control over the performance of
electronic circuits. As a matter of fact, negative feedback is so useful to us that we will seldom use op amps
without it. Negative feedback is not tied solely to op amps though, as almost any electronic circuit may benefit
from its application. As with most things, there are disadvantages as well. A successful design will minimize the
disadvantages and capitalize on the positive aspects. We will begin with the basic concepts of what negative
feedback is and does, and then fine tune our viewing by examining its four specific variants. We will look at
specific examples of how negative feedback is applied to op amps, and finish off with a discussion of its
practical limits.

3.2 What Negative Feedback Is and Why We Use It

People use negative feedback every day of their lives. In fact, we probably couldn't get along without it. Simply
put, negative feedback is a very rudimentary part of intelligence. In essence, negative feedback lets something
correct for mistakes. It tends to stabilize operations and reduce change. Negative feedback relies on a loop
concept. In human terms, it is akin to knowing what you are doing and being able to correct for mistakes as they
happen. You are constantly evaluating and correcting your actions in order to achieve a desired goal. This may
be stated as letting the input know what the output is doing. A good example of this is your ability to maintain a
constant speed while driving along the highway. You have a desired result, or set-point, in mind, say 60 MPH.
As you drive, you constantly monitor the speedometer. If you glance down and see that you're zipping along at
70 MPH, you think "Oops, I'm going a bit too fast" and lift your foot slightly off of the gas pedal. On the other

85
hand, if you're only going 40 MPH, you will depress the gas pedal further. The faster
and more accurate your updates are, the better you will be at maintaining an exact
speed.

In contrast to negative feedback is positive feedback, which reinforces change. If
you were to correct your speed by saying "Hmm, I'm going 70 MPH, I'd better step
on the gas", you'd be using positive feedback. Other examples of positive feedback
include the "acoustic squeal" often heard over public address systems, and thermal
runaway effects seen in discrete devices. When positive feedback is applied to
normal amplifiers, they oscillate. That is, they produce their own signals without any
input applied.

3.3 Basic Concepts

Seeing the usefulness of negative feedback, it would be nice if we could apply the
concept to our electronic circuits. The basic idea is quite simple, really. What we
will do is sample a piece of the output signal, and then add it to the input signal out
of phase (i.e., subtract it). By doing so, the circuit will see the difference between the
input and the output. If the output signal is too large, the difference will be negative.
Conversely, the difference signal will be positive if the output is too small. This
signal is then multiplied by the circuit gain and cancels the output error. Thus, the
circuit will be presented with the undesired errors in a way that will force the output
to compensate (move in the opposite direction). This process is done continuously;
the only time lags involved are the propagation delays of the circuits used.

Because the sampled output signal is effectively subtracted from the input signal,          Figure 3.1
negative feedback is sometimes referred to as degenerative or destructive feedback.         Negative feedback.
This subtraction can be achieved in a variety of ways. A differential amplifier is
tailor made for this task because it has one inverting input and one noninverting
input. (Note: If the error is presented in phase, the circuit magnifies the errors and
positive feedback results.)

To see an example of how this works, refer to Figure 3.1. The triangle
represents an amplifying circuit. It has a gain of A. The output signal is also
presented to the input of the feedback network represented by the box. This
network scales the output signal by a factor, . The feedback network ranges
from very simple to complex. It may contain several resistors, capacitors,
diodes and what not, or it may be as simple as a single piece of wire. In any
case, this scaled output signal is referred to as the feedback signal and is
effectively subtracted from the input signal. This combination, called the
error signal, is then fed to the amplifier where it is boosted and appears at the
output. The process repeats like this forever (or at least until the power is switched
off).

86
Let's assume that for some reason (perhaps a temperature change) the amplifier's
gain were to rise. This should make the output signal increase by a similar
percentage, but it doesn't. Here's why: As the output signal tries to rise, the feedback
signal tracks with it. Now that there is a larger feedback signal, the error signal will
become smaller (remember, error = input - feedback). This smaller signal is
multiplied by the gain of the amplifier, thus producing a smaller output signal that
almost completely offsets the original positive change. Note that if the output signal
were too small, the error signal would increase, thus bringing the output back up to a
normal level. When everything is working right, the feedback and input signals are
almost the same size. (Actually, the feedback signal is somewhat smaller in
magnitude.)

The Effects of Negative Feedback

Besides smoothing out gain anomalies, negative feedback can reduce the effect of
device nonlinearities, thus producing a reduction in static forms of distortion such as
THD (Total Harmonic Distortion). Basically, these nonlinearities can be viewed as a
string of small gain errors. As such, they produce appropriate error signals and are
compensated for in the above manner. Negative feedback can also increase the
bandwidth of the system. It can increase the upper cutoff frequency f2 and decrease
the lower cutoff frequency f1 (assuming the system has one). Also, we can exercise
control over the input and output impedances of the circuit. It is possible to increase
or decrease the impedances. As you might have guessed, we don't receive these
benefits for nothing. The down side to negative feedback is that you lose gain.
Effectively, you get to trade off gain for an increase in bandwidth, a decrease in
distortion, and control over impedances. The more gain you trade off, the greater
your rewards in the other three areas. In the case of our op amp, this is a wise trade-
off because we already have more gain than we need for typical applications. This
give-and-take is a very important idea, so remember "BIG D". That stands for
Bandwidth, Impedance, Gain, and Distortion.

At this point, we need to define a few terms. Closed loop refers to the characteristics
of the system when feedback exists. For example, closed-loop gain is the gain of the
system with feedback, whereas closed-loop frequency response refers to the new
system break points. Generalized closed-loop quantities will be shown with the
subscript "cl". Similarly, we will denote impedances, gain and the like for specific
feedback variants with a two- letter subscript abbreviating the exact feedback
configuration. One possibility for closed-loop gain would be Asp. Open loop refers to
the characteristics of the amplifier itself. To remember this, think of disconnecting
or opening the path through the feedback network. Once the path is broken, the
amplifier is on its own. Open-loop gain then, refers to the gain of the amplifier by
itself, with no feedback. All open-loop quantities will be shown with the subscript
"ol". The symbol for open-loop gain would be Aol. The term loop gain refers to the
ratio between the open- and closed-loop gains (it may also be computed from their
difference in decibels on a Bode plot). Loop gain indicates how much gain we have

87
given up or sacrificed in order to enhance the operation of the system. Consequently,
loop gain is often called sacrifice factor, and given the symbol S. Generally, trade-
offs are proportional to the sacrifice factor. For example, if we cut the gain in half,
we will generally double the bandwidth, and halve the distortion. An example that
illustrates this can be seen in Figure 3.2. Note how the loop gain decreases with
increasing frequency. This means that the effects of feedback at higher frequencies
are not as great.

           A' v                open loop gain                                            Figure 3.2
                                    closed loop gain                                     Response with and without
    loop gain                                                                            feedback.

                 open loop f2  closed loop f 2        f

Up to this point we have made one simple assumption about our system; that it
exhibits no "extra" phase change beyond the desired inversion. As we saw in the
first chapter, however, all circuits do produce phase changes as the input frequency
is increased. If this extra phase change were to reach -180° while the gain was
greater than unity (0dB), our negative feedback will turn into positive feedback (the
inversion = -180°, plus this extra -180°, places us at -360°. The net result is an in-
phase signal). If this were to happen, our amplifier would no longer be stable. In
fact, it may very well turn into a high frequency oscillator. (You will see how to do
this on purpose when you cover Chapter Nine). As the input frequency is raised, the
phase will eventually exceed -180° and the gain will drop to a fraction (< 0dB). The
real key here is making sure that the phase never reaches or exceeds -180° when the
gain falls to 1. Stated another way, when the phase hits -180°, the gain should be a
fraction. Generally, the farther you are from this "danger zone", the better. In other
words, you're better off if the extra phase at the unity gain point is -90° rather than
-170°. Both are stable, but the first one gives you some breathing room.

88
Two measures of circuit safety are the gain and phase margins. Phase margin                      Figure 3.3
indicates the difference between the actual phase at unity gain and -180°. In the                Gain and phase margin
example above the first circuit would have a phase margin of 90° and the second                  graphically determined from
would have a margin of 10°. Gain margin is the difference between the actual gain                Bode plot.
in dB at the -180° phase point, and 0dB. If our gain was -9 dB at -180°, the gain
margin would be 9 dB (i.e., we have 9 dB "to spare"). Reasonable values for gain
and phase margin are > 6 dB and > 45°. Gain and phase margins are depicted in
Figure 3.3. It is possible to guarantee safe margins if the amplifier's open loop
response maintains a 20 dB-per-decade rolloff up to the unity gain frequency, funity.
This means that there is only one dominating lag network that will add a maximum
phase shift of -90°. Even if the second network coincided with funity, it would add
-45° at most. This would still leave us with a 45° phase margin. (Note that if we had
several secondary networks critical at funity the phase could exceed -180°, however
the slope would no longer be 20 dB-per-decade in reality.) It is for this reason that
the general-purpose op amps examined in Chapter Two included a compensating
capacitor. No matter how much feedback we wish to use, our circuits will always
end up being stable. For the best circuit performance, it is possible to use amplifiers
that do not have the "constant rolloff" characteristic. The possibility exists that they
may go into oscillation or become unstable if you are not careful and ignore the
margins.

                  A' v

                                                                                         gain
                                                                                         margin

    0 dB

                                                                     f

    

    0°

                                                                  f

           phase
           margin

    -180°

89
3.4 The Four Variants of Negative Feedback

Negative feedback can be achieved via four different forms. They differ in how the
input and output impedances are changed. We have basically two choices when it
comes to connecting the input and output of the amplifier to the output and input of
the feedback network. We may produce either a series connection or a parallel
connection. This yields four possibilities total. Each connection will produce a
specific effect on the input or output impedance of the system. As you might guess,
parallel connections decrease the impedance and series connections increase it. A
high input impedance is desirable for maximum voltage transfer, whereas a low
impedance is required for maximum current transfer. As a memory aid, think of volt
meters and ammeters. For the smallest loading effect, volt meters should exhibit a
high impedance and ammeters a very low one. In the case of the output connection,
a low source impedance is required for the best voltage transfer, and a high source
impedance for current transfer. You should think of the ideal voltage source (zero
Zout) and the ideal current source (infinite Zout) here. Consequently, if we were to
connect our feedback network in series with the amplifier's input, and in parallel
with its output, we would have an increase in Zin and a decrease in Zout. This means
that our system would be very good at sensing an input voltage, and ideal for
producing a voltage. We will have created a voltage-controlled voltage source
(VCVS), the ideal voltage amplifier. So that you can get a good idea of the
possibilities, all four types are summarized in the following table.

 Type       Zin  Zout  Model  Idealization     Transfer
(in-out)   High  Low   VCVS                     Ratio
Series-    High  High  VCCS     Voltage
Parallel   Low   Low   CCVS   Amplifier        Vout /Vin
           Low   High  CCCS   Voltage to    Voltage gain
Series-
 Series                         Current        Iout /Vin
                              Transducer       Trans-
Parallel-                     Current to    conductance
Parallel
                                Voltage        Vout /Iin
Parallel-                     Transducer       Trans-
 Series                                      resistance
                                Current
                               Amplifier       Iout /Iin
                                               Current

                                                Gain

Generally speaking, the input and output impedances will be raised or lowered from
the non-feedback value by the sacrifice factor. Note that by using the proper form of
feedback, we can achieve any of the possible models. This greatly enhances our
ability to deal with specific applications. Much work in our field relies on optimal
voltage transfer, therefore Series-Parallel (SP) is often used. A variation on Parallel-
Parallel (PP) is also used frequently, as we shall see.

90
Series-Parallel (SP)                                                                     Figure 3.4
                                                                                         Series-parallel connection.
The SP connection makes for the ideal voltage amplifier. A generalized block
diagram is shown in Figure 3.4. You can tell that it has a series input because there
is no input current node. Contrast this with the output: Note that the op amp's output
current splits into two paths, one through the load and the other into the feedback
network. This output node clearly denotes the feedback's parallel output connection.

Let's take a look at exactly how SP negative feedback alters the system gain,
impedances, and frequency response. For starters, let's examine the closed-loop gain
(Asp). Our amplifier block produces a gain A, and could be a diff amp, op amp, or
other multi-stage possibility. The feedback network is typically a voltage divider and
produces a loss, . The signal presented to the inverting input of the amp is the
feedback signal and is equal to Vout. Note that the source's signal, Vin, is applied to
the noninverting input. Therefore, the differential input voltage (usually referred to
as Verror), equals Vin - Vfeedback . We also know from previous work with differential
amplifiers that that Vout= Verror Aol (Aol is the amplifiers open-loop gain). In other
words we know:

and by definition,  V i n=V error +V feedback  (3.1)
                    V feedback=V out           (3.2)
                    V out=V error Aol          (3.3)

                    A sp= V out                (3.4)
                           Vin

Substituting Equation 3.3 into Equation 3.2,

                    V feedback=V error  Aol    (3.5)

91
Substituting Equation 3.5 into Equation 3.1, and simplifying,

    V i n=V error (1+ Aol)                                     (3.6)

Finally, substituting Equation 3.6 and Equation 3.3 into Equation 3.4 and
simplifying, yields,

    A sp= Aol                                                              (3.7)
          1+ Aol

Since the fundamental definition of sacrifice factor, S, is Aol/Acl, we may also say
Asp=Aol/S and therefore, for SP,

    S =1+ Aol                                                              (3.8)

Equation 3.7 is our general gain equation but, if we can make Aol >> 1 we may
ignore the "+1" in the denominator and further simplify this as,

    Asp= 1                                                                 (3.9)

This seemingly innocent equation packs a rather hefty punch. What it is telling us is
that the open-loop gain of the amplifier does not play a role in setting the system
gain, as long as the open-loop gain is very large. In other words, the system gain is
controlled solely by the feedback network. Consequently, our amplifier can exhibit
large gain changes in its open-loop response, but the closed-loop response will
remain essentially constant. For this reason we will achieve identical closed-loop
gains for op amps that exhibit sizable differences in their open-loop gains. Because
signal distortion is produced by nonlinearities that can be viewed as dynamic gain
changes, our closed-loop distortion drops as well. Also, it is this very effect that
extends our closed-loop frequency response. Imagine that our amplifier exhibits a
gain of 10,000 at its upper break frequency of 100 Hz. If the feedback factor is equal
to 0.1, our exact gain is:

    Asp= 10,000 1+0.1×10,000 =9.99

If we were to measure the amplifier's open-loop gain one decade up, at 1 kHz, it
should be around 1,000 (assuming 20 dB/decade loss). The closed loop gain now
equals:

    Asp= 1,000 1+0.1×1,000 =9.9

92
As you can see, the closed-loop gain changed only about 1 despite the fact that the
open-loop gain dropped by a factor of 10. If we continue to raise the frequency, Asp
would equal 9.09 at 10 kHz. Finally, at 100 kHz a sizable drop is seen because the
gain falls to 5. At this point, our assumption of Aol >> 1 falls apart. Note however,
that our loss relative to the midband gain is only a few dB. We have effectively
stretched out the bandwidth of the system. Actually, this calculation is somewhat
over-simplified as we have ignored the extra phase lag produced by the amplifier
above the open-loop break frequency. If we assume that the open-loop response is
dominated by a single lag network (and it should be, in order to guarantee stability,
remember?), a phase sensitive version of Equation 3.7 would be:

                                Asp= - jAol
                                      1- jAol 

This extra phase will reach its maximum of -90 degrees approximately one decade
above the open-loop break frequency. Consequently, when we find the magnitude of
gain at 100 kHz, it's not

                                Asp= 10 1+1

but rather

                      Asp= 12+12 10

which equals 7.07, for a -3 dB relative loss.

A simpler way of stating all of this is: The new upper break frequency is equal to the
open-loop upper break times the sacrifice factor, S. Because S is the loop gain, it is
equal to Aol/Asp. Note that our low frequency S = 10,000/10, or 1,000. Therefore, our
closed-loop break equals 1,000 times 100 Hz, or 100 kHz. A very important item to
notice here is that there is an inverse relation between closed-loop gain and
frequency response. Systems with low gains will have high upper-breaks, while high
gain systems will suffer from low upper-breaks. This sort of trade-off is very
common. Although most diff amps and op amps do not have lower break
frequencies, circuits that do will see an extension of their lower response in a similar
manner. (i.e., the lower break will be reduced by S). In order to achieve both high
gain and wide bandwidth, it may be necessary to cascade multiple low gain stages.

93
Example 3.1

         Assume that you have an amplifier connected as in Figure 3.4. The open
         loop gain (Aol) of the amp is 200 and its open loop upper break frequency
         (f2-ol) is 10 kHz. If the feedback factor () is 0.04, what are the closed loop
         gain (Asp) and break frequency (f2-sp)?

         For Asp,

                                          Asp = Aol
                                                1+ Aol

                                          Asp= 200 1+0.04×200
                                          A sp=22.22

         The approximation says,

                                          Asp =1
                                          Asp= 1 0.04
                                          A sp=25

         That is reasonably close to the general equation's answer (note that there is
         no need to include phase effects as we are looking for the midband gain).
         The approximation is more accurate when Aol is larger.

         For f2-sp, first find the sacrifice factor, S.

                                         S = Aol
                                              Asp

                                         S = 200 22.22
                                         S =9

                                          f 2- sp= f 2-ol S
                                          f 2- sp=10 kHz×9
                                          f 2- sp=90 kHz

         One interesting thing to note is that the product of the gain and upper break
         frequency will always equal a constant value, assuming a 20 dB per decade
         rolloff. Our open loop product is 200 times 10 kHz, or 2 MHz. Our closed
         loop product is 22.22 times 90 kHz, which is 2 MHz. If we choose any other
         feedback factor, the resulting Asp and f2-sp will also produce a product of
         2 MHz (try it and see). The reason for this is simple. A 20 dB per decade

94
    rolloff means that the gain drops by a factor of 10 when the frequency is
    increased by a factor of 10. There is a perfect 1:1 inverse relationship
    between the two parameters. No matter how much you increase one
    parameter, the other one will decrease by the same proportion. Thus, the
    product is a constant.

At this point you may be asking yourself, "What exactly is in that feedback network        Figure 3.5
and how do I figure out ?" Usually, the feedback network just needs to produce a           Simple voltage divider for .
loss -- it has to scale Vout down to Vfeedback. The simplest item for the job would be a
resistive voltage divider. (It is possible to have complex frequency dependent or
nonlinear elements in the network as we shall see in the future). An example is
presented in Figure 3.5. If you study this diagram for a moment, you will notice that
the feedback factor  is really nothing more than the voltage divider loss. Vout is the
input to the feedback network and appears across Rf + Ri || Zin. The output of the
network is Vfeedback, which appears across Ri. Simply put, the ratio is

                                = Ri || Z i n
                                    R f +Ri || Zi n

If the Zin is large enough to ignore, as in most op amps, this simplifies to

    = Ri
        R f +Ri

By substituting this equation into our approximate gain Equation 3.9, we find

    Asp = R f +Ri = R f +1                                                    (3.10)
    Ri           Ri

Note that the values of Rf and Ri are not really important, rather, their ratio is. We
arrive at the same gain if Rf = 10 k and Ri = 1 k, or if Rf = 20 k and Ri = 2 k.
We obviously have quite a bit of latitude when designing circuits for a specific gain,
but we do face a few practical limits. If the resistors are too small we will run into
problems with op amp output current. On the other hand, if the resistors are too
large, excessive noise, offset, drift and loading effects will result. As a guideline for
general-purpose circuits, Rf + Ri is usually in the range of 10 k to 100 k.

Computer Simulation

As evidenced earlier, if the open loop gain is very high, its precise value does not
matter. We'll examine this effect using Example 3.1, but with much higher open
loop gains. The simulation is shown in Figure 3.6 using Multisim and the basic op
amp model presented in Chapter Two. The circuit uses Rf = 24 k and Ri = 1 k  for
an ideal closed loop voltage gain of 25. The input signal is set to 40 millivolts.

95
                                                                                                                     Figure 3.6a
                                                                                                                     Multisim schematic for gain
                                                                                                                     sweep.

                                                                                                                     Figure 3.6b
                                                                                                                     Output variation due to
                                                                                                                     open-loop gain change.

Using the Parameter Sweep option, the open loop gain is initialized at 10,000 and is
progressively doubled to a maximum of 160,000. These are reasonable gain values
for a production op amp. The output transient analysis shows that in spite of a 16 to
1 variation in open loop gain, all output voltages are approximately 1 V, achieving a
closed loop gain of nearly 25 in all cases.
96
Example 3.2

Let's say that the microphone that you use for acoustic instruments produces
a signal that is just too weak for you to record without excessive noise. After
a little experimentation in lab, you discover that you need about 20 dB of
voltage gain before you can successfully capture a softly picked guitar.
Using Figure 3.7 as a guide, design this amplifier with the following device:
Aol = 50,000, Zin-ol = 600 k.

First, note that our Aol and Zin-ol values are more than sufficient for us to use         Figure 3.7
the approximation formulas. Because our formulas all deal with ordinary                   Microphone amplifier.
gain, we must convert 20 dB.

                                Asp=log-1 Asp' 20
                                Asp=log-1 20 dB 20
                                A sp=10

By rearranging Equation 3.10,

             R f = Asp-1
             Ri
             R f =9
             Ri

We see that Rf must be 9 times larger than Ri. There is no single right answer
here; there are many possibilities.

Computer Simulation

One viable solution for Example 3.2 is simulated using Multisim in Figure 3.8. This
circuit uses Rf = 9 k and Ri = 1 k . The op amp model is the simple dependent
source version examined in Chapter Two. The input signal is set to 0.1 VDC for
simplicity. Both the output and feedback potentials are presented. The results of this
simulation verify our hand calculations. In order to note the sensitivity of the design,
you can alter certain parameters of the input file and rerun the simulation. Two of
the more interesting areas are the absolute values of the feedback resistors and the
open loop gain of the op amp. You will note that as these quantities are lowered, our
approximation formulas become less accurate. With the given values, the
approximations deviate from the simulation results by less than 1.

97
                                                                                                                    Figure 3.8a
                                                                                                                    Multisim schematic for
                                                                                                                    analysis of the simple op
                                                                                                                    amp model of Example 3.2.

                                                                                                                     Figure 3.8b
                                                                                                                     Multisim DC outputs.

SP Impedance Effects

As noted earlier, negative feedback affects the closed-loop input and output
impedances of our system. Series connections increase the impedance and parallel
connections decrease the impedance.
Let's see exactly how this works in the SP case. First, we must distinguish between
the Zin of the amplifier itself and the Zin of the system with feedback. We shall call
them Zin-ol and Zin-sp respectively. Figure 3.9 shows this difference by using a simple
model of the amplifier. By definition,

                                Zi n - sp= V i n
                                          Iin

98
The idea here is to notice that the source only needs to supply enough signal current
to develop the Verror drop across the amplifier's Zin-ol. As far as the Vin signal source is
concerned, Vfeedback is a voltage source, not a voltage drop. Therefore, Iin = Verror /Zin-ol.

                                                                                                                     Figure 3.9
                                                                                                                     Series-parallel input
                                                                                                                     impedance.

We may now say,

                 ( ) Zin-sp =             V in      = Z i n - ol V i n
                                                         V error
                                         V error
                                         Z i n- ol

Because Verror ideally equals Vout/Aol,

                 Zi n - sp= Z i n- ol Aol V i n = Z i n- ol Aol
                                         V out      Asp

Sacrifice factor S, is defined as Aol/Asp, so,                                       Figure 3.10
                                                                                     Common -mode input
                 Zi n - sp= Z i n- ol S                                              impedance.

This is our ideal SP input impedance. Obviously, even moderate open-loop Zins with
moderate sacrifice factors can yield high closed-loop Zins. The upper limit to this
will be the impedance seen from each input to ground. In the case of a typical op
amp, this is sometimes referred to as the common-mode input impedance, Zin-cm, and
can be very high (perhaps hundreds of mega ohms). This is the impedance presented
to common mode signals. This value effectively appears in parallel with our

99
calculated Zin-sp, above. An example is shown in Figure 3.10. Note that because Zin-cm
is measured with the inputs of the op amp in parallel, each input has approximately
twice the value to ground. In the case of a discrete amplifier, you would be most
concerned with the noninverting input's Zin. In any case, because S drops as the
frequency increases, Zin-sp decreases as well. At very high frequencies, input and
stray capacitances dominate, and the real system input impedance may be a small
fraction of the low frequency value. Negative feedback cannot reduce effects that
live outside of the loop.
Now for our Zout-sp. Refer to Figure 3.11. Zout-sp is the Thevenin output impedance. In
order to find this, we will drive the amplifier's output with a voltage source and
reduce all other independent voltage sources to zero (we have no current sources.
Remember, this is a "paper" analysis technique and may not work in lab due to other
factors). By figuring out the resulting output current, we can find Zout-sp (by
definition, Zout-sp = Vout/Iout).

                                                                                                                     Figure 3.11
                                                                                                                     Series-parallel output
                                                                                                                     impedance.

First, notice that Iout is made of two pieces, Ifeedback and Iamp. If we can find the two
impedances associated with these parts, we can simply perform a parallel equivalent
in order to determine Zout-sp. The Ifeedback portion is very easy to determine. Ignoring
the inverting input's loading effects on Ri, this impedance is just Rf + Ri. Finding the
output impedance of the amplifier itself is a little more involved. Iamp is found by
taking the drop across Zout-ol and using Ohm's law. The voltage across Zout-ol is the
difference between Vout and the signal created by the feedback path to the inverting
input. This signal is -Aol Vfeedback.

100
                        I amp= V out-(-Aol V feedback)
                                        Z out - ol

Since Vfeedback = Vout

                        I amp= V out +Aol  V out
                                    Z out- ol

                        I amp= V out (1+Aol )
                                    Z out- ol

By using Equation 3.8, this may be simplified to,

                        I amp= S V out
                               Z out - ol

Because

                        Zout-amp= V out
                                    I amp

we may say

                        Zout-amp= Z out- ol S

This is the part of Zout-sp contributed by Iamp. To find Zout-sp, just combine the two
pieces in parallel:

                        Zout - sp= Z out- ol S ||(R f +Ri )

With op amps, Rf + Ri is much larger than the first part and can be ignored. For
example, a typical device may have Zout-ol = 75 . Even a very modest sacrifice
factor will yield a value many times smaller than a typical Rf + Ri combo (generally
over 1 k). Discrete circuits using common emitter or common base connections
will have larger Zout-ol values, and therefore the feedback path may produce a sizable
effect. As in the case of input impedance, Zout-sp is a function of frequency. As S
decreases as the frequency rises, Zout-sp will increase.

101
Example 3.3

     An op amp has the following open-loop specs: Zin = 300 k Zout = 100 
     and A = 50,000. What are the low frequency system input and output
     impedances if the closed loop gain is set to 100?

     First we must find S.

                            S = Aol
                                Asp

                            S = 50,000 100
                            S =500

     We may now find the approximate solutions.

                            Zi n - sp= S Zi n - ol    M
                            Zi n -sp=500×300 k  =150
                            Zout - sp=Z out - ol S

                            Zout-sp = 100 500 = 0.2

     The effects are quite dramatic. Note that with such high Zin values, op amp
     circuits may be used in place of FETs in some applications. One example
     would be the front-end amplifier/buffer in an electrometer (electrostatic
     voltmeter).

Distortion Effects

As noted earlier, negative feedback lowers static forms of distortion, such as THD.
The question, as always, is "How much?" Something like harmonic distortion is
internally generated, so we may model it as a voltage source in series with the output
source. An example of this model can be seen in Figure 3.12. Vdist is the distortion
generator. In the case of a simple input sine wave, Vdist will contain harmonics at
various amplitudes (sine waves at integer multiples of the input frequency). These
amplitudes are directly related to the input signal's amplitude. If we assume that Zout
is small enough to ignore, Vdist will appear at the output of the open-loop circuit.
Thus, the total output voltage is the desired AVin plus Vdist.

102
                                                                                                                     Figure 3.12
                                                                                                                     Distortion model (open-loop).

When we add feedback, as in Figure 3.13, this distortion signal is fed back to the
inverting input, and because it is now out of phase, it partially cancels the internally
generated distortion. Thus the SP distortion signal (Vdis-sp) is much smaller.

                                                                                                                     Figure 3.13
                                                                                                                     Distortion model (closed-loop).

The SP output signal is

                         V out= Aol V error +V dist
                         V out= Aol (V i n-V feedback )+V dist
                         V out= Aol (V i n-V out)+V dist

103
We now perform some algebra in order to get this into a nicer form and solve for
Vout

                 V out =                     Aol V i n- Aol V out+V dist
     V out +Aol  V out =                     Aol V i n+V dist

      V out (1+Aol ) =                       Aol V i n+V dist

Remember that 1 + Aol = S, so,

     V out S = Aol V i n+V dist
                      V i n V dist

       V out = Aol +
                        SS

Because Aol/S is just Asp, this reduces to,

     V out= Asp V i n+V dist S

The internally generated distortion is reduced by the sacrifice factor. As you can see,
large sacrifice factors can drastically reduce distortion. An amplifier with 10% THD
and a sacrifice factor of 100 produces an effective distortion of only 0.1%. This
analysis does assume that the open-loop distortion is not overly grotesque. If the
distortion is large, we cannot use this superposition approach (remember,
superposition assumes that the circuit is essentially linear). Also, we are ignoring
any additional distortion created by feeding this distortion back into the amplifier.
For any reasonably linear amplifier, this extra distortion is a second-order effect, and
thus constitutes only a small part of the total output signal.

Computer Simulation

An example of the reduction of distortion is simulated using the Distortion Analyzer
from Multisim. A basic amplifier is shown in Figure 3.14. The value for Rf is
changed from 999 k to 99 k to 9 k. Vin is scaled accordingly so that the output
of the amplifier remains at approximately 10 volts. The test frequency was set to
1 kHz and a total of 20 harmonics (up to 20 kHz) were used in the analysis. Using
the LF411 op amp, the high gain version shows a THD of 0.09%. Reducing the gain
by a factor of 10 (and thus increasing sacrifice factor by 10 fold) yields a THD of
0.011%. Finally, a further 10 fold reduction of gain yields a THD of 0.001%.
Although the reduction in distortion is not exactly a factor of 10 each time, the trend
can be seen clearly. The precise distortion values will depend on the accuracy of the
op amp model used, the test frequency, and the number of harmonics kept in the
analysis. 20 kHz was chosen here because that represents the upper limit of human
hearing, and thus it would be appropriate for an audio amplifier.

104
                                                                                                                     Figure 3.14a
                                                                                                                     Multisim distortion analysis.

                                                                                                                     Figure 3.14b
                                                                                                                     Distortion analyzer results for
                                                                                                                     high-gain version.

                                                                                                                     Figure 3.14c
                                                                                                                     Distortion analyzer results for
                                                                                                                     medium-gain version.

                                                                                                                     Figure 3.14d
                                                                                                                     Distortion analyzer results for
                                                                                                                     low-gain version.

105
As we have seen, the sacrifice factor is a very useful item. Our gain, distortion, and
Zout are all reduced by S, while f2 and Zin are increased by S.

Noise

It is possible to model noise effects in much the same way as we just modeled
distortion effects. By doing so, you will discover that noise can also be decreased by
a large amount. Unfortunately, there is one major flaw. Unlike our distortion
generator, a noise generator will produce a signal that is not dependent on the input
signal. The net result is that although the noise level does drop by the sacrifice
factor, so does the desired output signal. Thus, the signal-to-noise ratio at the output
is unchanged. In contrast, the distortion signal is proportional to the input signal, so
that when the desired signal is cut by S, the distortion signal sees a further cut by S
(i.e., the distortion drops by S relative to the desired signal). As a matter of fact, it is
quite possible that the noise produced in following stages may add up to more noise
than the circuit had without feedback. Sad but true, negative feedback doesn't help
us when it comes to signal-to-noise ratio.

Parallel-Series (PS)                                                                          Figure 3.15
                                                                                              Parallel-series connection.
The Parallel-Series connection is the opposite of the Series-Parallel form. PS
negative feedback is used to make the ideal current amplifier. Its gain is
dimensionless, but for convenience, it is normally given the units A/A (amps per
amp). It produces a low Zin (perfect for sensing Iin) and a high Zout (making for an
ideal current source). An example of PS is shown in Figure 3.15.

The signal source's current splits in two, with part going into the amplifier, and part
going through the feedback network. This is how you know that you have a parallel
input connection. The output current on the other hand, passes through the load and
then enters the feedback network, indicating a series output connection. Note that
this general model is an inverting type, and that the load is floating (i.e., not ground
referenced). It is possible though to use ground referenced loads with some

106
additional circuitry. As PS is used for current amplification, let's see how we can
find the current gain. Figure 3.16 will help us along. PS current gain is defined as:

     A ps= I out                                              (3.11)                           Figure 3.16
            I in                                                                               Parallel-series analysis.

The signal source's current splits into two paths, so

     I i n= I amp+I feedback                                  (3.12)

Because Iamp times the amplifier's open-loop current gain is Iout, we can also say,

     I amp= I out                                             (3.13)
            Aol

The feedback network is nothing more than a current divider, where the feedback
network's output (Ifeedback) is  times smaller than its input (Iout). Don't let the arbitrary
current direction fool you -- the feedback "flow" is still from right to left, as always.
In this case the amplifier is sinking current instead of sourcing it. As  is just a
fraction, we may say

             = I feedback or,                                 (3.14)
                        I out

     I feedback =  I out
       I feedback = Aol  I amp

By substituting Equation 3.14 into Equation 3.12 we see that

     I i n= I amp+Aol  I amp or,                              (3.15)
     I i n= I amp (1+Aol )

After substituting this into Equation 3.11 we find that

     A ps= I out
           I amp(1+Aol)

or, with the help of Equation 3.13

     A ps= Aol                                                (3.16)
           1+Aol 

To make a long story short, the open-loop gain is reduced by the sacrifice factor.
(Where have we seen this before?) The one item that you should note is that we have
used only current gains in our derivation (compared to voltage gains in the SP case).

107
It is possible to perform a derivation using the open-loop voltage gain; however, the
results are basically the same, as you might have guessed. Once again, our
approximation for gain can be expressed as 1/.

Example 3.4

     A co-worker asks you to measure the output current of a circuit that she's        Figure 3.17
     just built. If all is working correctly, this circuit should produce 100          Current amplifier for
     microamps. Unfortunately, your hand-held DMM will only accurately                 Example 3.4.
     measure down to 1 milliamp. It is 10 times less sensitive than it needs to be.
     In order to be read accurately, the current will need to be boosted. Does the
     amplifier of Figure 3.17 have the current gain you need?

     If we are using an op amp, we can assume that Aps = 1/. The question then
     becomes, "what is ?"  is the current divider ratio. The resistors R1 and R2
     make up the current divider. The output current splits between R1 and R2,
     where the R1 path is Ifeedback. According to the current divider rule,

                                      = R2
                                          R1 +R2

     Consequently the gain magnitude is

                                     A ps= R1+R2 or,
                                              R2

                                     A ps= R1 +1
                                           R2

     This equation looks a lot like the one in the SP example! Solving for Aps
     yields

                                     A ps=9 k 1 k +1
                                     A ps=10

     Yes, this circuit has just the gain you need. All you have to do is connect
     your co-worker's circuit to the input, and replace the load resistor with your
     hand-held DMM. Note that most DMMs are floating instruments and are not
     tied to ground (unlike an oscilloscope), so using it as a floating load presents
     no problems. The accuracy of the gain (and thus your measurement)
     depends on the accuracy of the resistors and the relative size of the op amp's
     input bias current. Therefore, it would be advisable to use a bi-FET type
     device (i.e., an op amp with an FET diff amp) and precision resistors.

108
PS Impedance Effects

As you have seen, the gain derivation for PS is similar to that for SP. The same is
true for the impedance equations. First, we'll take a look at input impedance with
Figure 3.18.

                                                                                         Figure 3.18
                                                                                         Parallel-series input
                                                                                         impedance.

As always, we start with our base definition,

     Zi n - ps= V i n
              Iin

Recalling Equation 3.15, this can be rewritten as,

     Zi n - ps= V i n                               (3.17)
              I amp(1+Aol  )

Vin is merely the voltage that appears from the inverting input to ground. By using
Ohm's law, we can say,

     V i n= I amp Z i n- ol

Where Zin-ol is the open-loop input impedance. Finally, substituting this into Equation
3.17 gives,

     Zi n - sp= I amp Zi n - ol
              I amp(1+Aol  )

     Zi n - sp= Z i n- ol
             1+Aol 

The input impedance is lowered by the sacrifice factor. If you're starting to wonder
whether everything is altered by the sacrifice factor, the answer is, yes. This is, of
course, an approximation. What do you think is going to happen to the output

109
impedance? At this point, it shouldn't be too surprising. For this proof, refer to
Figure 3.19. We shall use the same general technique to find Zout as we did with the
SP configuration. In this case we replace the load with a current source, and then
determine the resulting output voltage.

                                                                                                                     Figure 3.19
                                                                                                                     Parallel-series output
                                                                                                                     impedance.

Note that the input signal current source is opened. The output current drives the
feedback network and produces the feedback current. The feedback current is then
multiplied by the amplifier's open-loop current gain. Because the feedback current
enters the inverting input, the internal source is sinking current. Because we are
driving the circuit from the output,

                                Zout-ps = V out
                                           I out

Vout is found through Ohm's law.
                                V out= Z out -ol( I out+I i nt )

We now expand on our currents.
                                I i nt= I feedback Aol
                                I i nt= I out  Aol
                                V out= Z out-ol( I out+I out  Aol )
                                V out= Z out-ol I out(1+Aol )
                                V out= Z out-ol I out S

110
Finally, we see that,

                                Zout- ps = Z out-ol I out S
                                                I out

                                Zout- ps =Z out-ol S

As expected, the series output connection increased Zout by the sacrifice factor. The
remainder of the PS equations are essentially those used in our earlier SP work. Once
again, the bandwidth will be increased by S, and the distortion will be reduced by S.
This is also true for the Parallel-Parallel and Series-Series connections. As a matter
of fact, the Zin and Zout relations are just what you might expect. The proofs are
basically the same as those already presented, so we won't go into them. Suffice to
say that parallel connections reduce the impedance by S, and series connections
increase it by S.

Parallel-Parallel (PP) and Series-Series (SS)                                            Figure 3.20
                                                                                         Parallel-parallel connection.
Unlike our two earlier examples, the concept and modeling of gain is not quite as
straight forward in the Parallel-Parallel and Series-Series cases. These forms do not
produce gain, so to speak. They are neither voltage amplifiers, nor current
amplifiers. Instead, these connections are used as transducers. Parallel-Parallel turns
an input current into an output voltage. It is shown in Figure 3.20.

Series-Series turns an input voltage into an output current. It is shown in Figure
3.21. Our normal gain and feedback factors now have units associated with them.
Because our output versus input quantities are measured in volts-per-amp (PP) or
amps-per-volt (SS), the appropriate units for our factors are ohms and siemens. To
be specific, we refer to our PP gain as a transresistance value, and the SS gain as a
transconductance value. Although it is quite possible (and useful) to derive formulas
for gain based on these, it is often done only for discrete designs. Quite simply, you
cannot find transresitance or transconductance values on typical op amp data sheets.

111
Fortunately, we can make a few approximations and create some very useful circuits        Figure 3.21
utilizing PP and SS feedback with op amps. These design and analysis shortcuts are        Series-series connection.
presented in the next chapter, along with practical applications.

3.5 Limitations On The Use of Negative Feedback

From the fore-going discussion, you may well think that negative feedback can do
just about anything, short of curing a rainy day. Such is not the case. Yes, negative
feedback can drastically lower distortion and increase bandwidth. Yes, it can have a
very profound effect on input and output impedance. And yes, it certainly does
stabilize our gains. What then, is the problem? Like all things, negative feedback has
specific limitations. The first thing you should note is that S is a function of
frequency. This was graphically depicted back in Figure 3.2. The amount of change
seen in impedances and distortion is a function of S, it follows that these changes
must be a function of frequency. Because S drops as the frequency increases, the
effects of negative feedback diminish as well. For example, if an SP amplifier has an
open-loop Zin of 200 k and the low frequency S is 500, the resulting Zin with
feedback is 100 M. If we increase the input frequency past the open-loop f2, the
open-loop gain drops and thus, S drops. One decade up, S will only be 50, so the Zin
with feedback will only be 10 M. If this amplifier has a lower break frequency (f1),
S will drop as the frequency is reduced (below f1). The same sort of thing occurs
with distortion, however, the harmonics each see a different S, so the calculation is a
bit more involved. Along with the reduction in gain, there is also a change in phase.
If the phase around the feedback loop varies from -180°, incomplete cancellation
takes place, and thus, the effects of feedback are lessened. The bottom line is that the
effects of negative feedback weaken as we approach the frequency extremes.

The other item that must be kept in mind is the fact that negative feedback does not
change specific fundamental characteristics of the amplifier. Negative feedback
cannot get a circuit to do something beyond its operational parameters. For example,
feedback has no effect on clipping level (saturation point). Further, feedback has no
effect on slew rate (the maximum rate of output signal change, and an item that we
will examine in a later chapter). Actually, when an amplifier slews, feedback is

112
effectively blocked. An accurate output signal is no longer sent back to the input, but
the amplifier can't correct for the errors any faster than it already is. In a similar
manner, even though feedback can be used to lower the output impedance of a
system, this does not imply that the system can produce more output current.

One possible "problem" with negative feedback is really the fault of the designer. It
can be very tempting to sloppily design an amplifier with poor characteristics and
then correct for them with large amounts of feedback. No matter how much
feedback you use, the result will never be as good as a system that was designed
carefully from the start. An example of this effect can be seen with TIMD (Transient
Inter-Modulation Distortion). TIMD is a function of nonlinearities in the first stages
of an amplifier, and the excessive application of negative feedback will not remove
it. On the other hand, if the initial stages of the system are properly designed, TIMD
is not likely to be a problem.4

Summary

We have seen that negative feedback can enhance the performance of amplifier
circuits. This is done by sampling a portion of the output signal and summing it out
of phase with the input signal. In order to maintain stability, the gain of the amplifier
must be less than unity by the time its phase reaches -180°. There are four basic
variants of negative feedback: Series-Parallel, Parallel-Series, Parallel-Parallel, and
Series-Series. In all cases, gain and distortion are lowered by the sacrifice factor S,
and the bandwidth is increased by S. Parallel connections reduce impedance by S,
whereas series connections increase the impedance by S. At the input, parallel
connections are current sensing, and series connections are voltage sensing. At the
output, parallel connections produce a voltage-source model, and series connections
produce a current-source model. The sacrifice factor is the ratio between the open-
and closed-loop gains. It is a function of frequency, and therefore, the effects of
negative feedback lessen at the frequency extremes.

Review Questions

    1. Give two examples of how negative feedback is used in everyday life.
    2. What circuit parameters will negative feedback alter, and to what extent?
    3. What is meant by the term "Sacrifice Factor"?
    4. What is the usage of Gain and Phase Margin?
    5. Name the different negative feedback connections (i.e., variants or forms).
    6. How might negative feedback accidentally turn into positive feedback?
    7. What circuit parameters won't negative feedback effect?

4 See E.M.Cherry and K.P.Dabke, "Transient Intermodulation Distortion- Part 2: Soft
    Nonlinearity", Journal of the Audio Engineering Society, Vol.34 No.1/2 (1986): 19-35

113
     8. In practical amplifiers, when does negative feedback "stop working", and
         why?

Problems

Analysis Problems

     1. An amplifier's open-loop gain plot is given in Figure 3.22. If the amplifier is
         set up for a closed-loop gain of 100, what is the sacrifice factor (S) at low
         frequencies? What is S at 1 kHz?

          A' v                     Figure 3.22

                     10,000

                             1000

                   100 Hz 1 kHz               f

     2. If the amplifier in Problem 1 has an open-loop THD of 5%, what is the
         closed-loop THD at low frequencies? Assuming that the open-loop THD
         doesn't change with frequency, what is the closed-loop THD at 1 kHz?

     3. If an amplifier has an open-loop response as given in Figure 3.22, and a
         feedback factor () of 0.05 is used, what is the exact low frequency closed-
         loop gain? What is the approximate low frequency gain? What is the
         approximate gain at 1 kHz?

               A' v Figure 3.23

                86 dB

                66 dB

                   25 Hz 250 Hz    500 kHz f

     4. Using the open loop response curve in Figure 3.23, determine exact and
         approximate values of  for a closed-loop gain of 26 dB.

     5. Determine the closed-loop f2 for the circuit of Problem 4.

114
6. What is the maximum allowable phase shift at 500 kHz for stable usage of
    negative feedback in Figure 3.23?

7. Determine the gain and phase margins for the amplifier response given in
    Figure 3.24. Is this amplifier a good candidate for negative feedback?

A' v  Figure 3.24

              0 dB

                                                                                f

           -12 dB

                

                   0°

                                                                                f

                -90°
              -120°
              -180°

8. Determine the closed-loop (mid-band) gain in Figure 3.25.
9. What is the closed-loop Zin in Figure 3.25? What is Zout?
10. What is the low-frequency sacrifice factor in Figure 3.25?

                                                                  Figure 3.25

    11. How much distortion reduction can we hope for in Figure 3.25?
    12. How much of a signal/noise improvement can we expect in Figure 3.25?
    13. Assuming Vin(t) = 0.1 sin 2  500t, in Figure 3.25, what is Vout(t)?

115
    14. If the circuit in Figure 3.25 had an open-loop f1 of 10 Hz, what would the
         closed-loop f1 be?

    15. Determine an appropriate pair of resistors to set  to 0.1 in Figure 3.25.
Challenge Problems

    16. If the feedback network of Figure 3.25 produces a phase shift of -200° at
         4 kHz, what effect will this have on circuit operation in Problem 10?

    17. Consider the circuit of Figure 3.7. In general, what effect will the following
         alterations to the feedback network have on the closed loop system
         response? A) Placing a capacitor across Rf B) Placing a capacitor across Ri
         C) Placing a rectifying diode across Rf (both polarities).

Computer Simulation Problems
    18. Rerun the simulation of Figure 3.8 using the following open loop gains: 1 k,
         10 k, and 100 k. What can you conclude from the results?
    19. Verify the results of Problem 13 using a circuit simulator. It is possible to
         extend the basic op amp model with a lag network in order to mimic f2-ol.
    20. Verify the stability of the circuit used in Problem 13 with regard to the open
         loop gain. Run simulations with the given Aol, and with values one decade
         above and below. Compare the resulting simulations and determine the
         maximum deviation of Asp.

116
4 Basic Op Amp Circuits

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Relate each op amp circuit back to its general feedback form.
    · Detail the general op amp circuit analysis idealizations.
    · Solve inverting and noninverting voltage amplifier circuits for a variety of parameters, including gain

         and input impedance.
    · Solve voltage/current transducer circuits for a variety of parameters.
    · Solve current amplifier circuits for a variety of parameters.
    · Define the term virtual ground.
    · Analyze and design differential amplifiers.
    · Analyze and design inverting and noninverting summing amplifiers.
    · Discuss how output current capability may be increased.
    · Outline the circuit modifications required for operation from a single polarity power supply.

4.1 Introduction

In this chapter we will be examining some common uses of op amps. Where Chapter Three focused on the
theory of negative feedback in a more abstract way, this chapter zeroes in on the practical results of using
negative feedback with op amps. Now that you know what negative feedback is and how it works, you can reap
the benefits. The main theme is in the design and analysis of simple, small-signal, linear amplifiers. We will also
be looking at some convenient approximation methods of analysis that can prove quite efficient. By the end of
the chapter, you should be able to design single and multistage voltage amplifiers, voltage followers, and even
amplifiers that sense current and/or produce constant current output. The voltage amplifiers offer the
possibilities of inverting or not inverting the signal. Simple differential amplifiers are examined too. The chapter
wraps up with a section on using op amps with a single polarity power supply and how to increase the available
output current.

This is an introductory design section so the details of high frequency response, noise, offsets, and other
important criteria are ignored. These items await a detailed analysis in Chapter Five. For the most part then, all
calculations and circuit operations are assumed to be in the midband region.

117
4.2 Inverting and Noninverting Amplifiers

As noted in our earlier work, negative feedback can be applied in one of four ways.
The parallel input form inverts the input signal, and the series input form doesn't.
Because these forms were presented as current-sensing and voltage-sensing
respectively, you might get the initial impression that all voltage amplifiers must be
noninverting. This is not the case. With the simple inclusion of one or two resistors,
for example, we can make inverting voltage amplifiers or noninverting current
amplifiers. Virtually all topologies are realizable. We will look at the controlled-
voltage source forms first (those using SP and PP negative feedback).

For analysis, you can use the classic treatment given in Chapter Three; however, due
to some rather nice characteristics of the typical op amp, approximations will be
shown. These approximations are only valid in the midband and say nothing of the
high frequency performance of the circuit. Therefore, they are not suitable for
general-purpose discrete work. The idealizations for the approximations are:

    · The input current is virtually zero (i.e., Zin is infinite).
    · The potential difference between the inverting and noninverting inputs is

         virtually zero (i.e., loop gain is infinite). This signal is also called the error
         signal.

Also, note for clarity that the power supply connections are not shown in most of the
diagrams.

The Noninverting Voltage Amplifier

The noninverting voltage amplifier is based on SP negative feedback. An example is           Figure 4.1
given in Figure 4.1. Note the similarity to the generic SP circuits of Chapter Three.        Noninverting
Recalling the basic action of SP negative feedback, we expect a very high Zin, a very        amplifier.
low Zout, and a reduction in voltage gain. Idealization 1 states that Zin must be
infinite. We already know that op amps have low Zout, the second item is taken care
of. Now let's take a look at voltage gain.

                            Av = V out                                                                     voltage
                                  Vin

Because ideally Verror = 0

                            V i n=V Ri

Also,

                            V out=V Ri +V Rf
                            Av= V Ri+V Rf

                                     V Ri

118
Expansion gives

                 Av= R i I Ri +R f I Rf
                           Ri I Ri

Because Iin = 0, IRf = IRi, and finally we come to

                 Av= Ri+R f or                      (4.1)
                         Ri

                 Av=1+R f
                          Ri

Now that's convenient. The gain of this amplifier is set by the ratio of two resistors.
The larger Rf is relative to Ri, the more gain you get. Remember, this is an
approximation. The closed loop gain can never exceed the open loop gain, and
eventually, Av will fall off as frequency increases. Note that the calculation ignores
the effect of the load impedance. Obviously, if Rl is too small, the excessive current
draw will cause the op amp to clip.

Example 4.1

     What are the input impedance and gain of the circuit in Figure 4.2?                 Figure 4.2
                                                                                         Noninverting circuit for
     First off, Zin is ideally infinite. Now for the gain:                               Example 4.1.

                                     Av=1+R f
                                               Ri

                                     Av=1+10k 1 k
                                     Av =11

     The opposite process of amplifier design is just as straightforward.

Example 4.2

         Design an amplifier with a gain of 26 dB and an input impedance of 47 k.
         For the gain, first turn 26 dB into ordinary form. This is a voltage gain of
         about 20.

119
              Rf                                                                             Figure 4.3
     Av=1+                                                                                   Noninverting design for
                                                                                             Example 4.2.
              Ri

     R f = Av-1
     Ri
     R f =19
     Ri

     At this point, choose a value for one of the resistors and solve for
     the other one. For example, the following would all be valid:

     Ri=1 k , R f =19 k 
     Ri=2 k  , R f =38 k 
     Ri=500 , R f =9.5 k 

     Most of these are not standard values, though, and will need slight
     adjustments for a production circuit (see Appendix B). A reasonable range is
     100 k > Ri + Rf > 10 k. The accuracy of this gain will depend on the
     accuracy of the resistors. Now for the Zin requirement. This is deceptively
     simple. Zin is assumed to be infinite, so all you need to do is place a 47 k in
     parallel with the input. The resulting circuit is shown in Figure 4.3.

If a specific Zin is not specified, a parallel input resistor is not required. There is one
exception to this rule. If the driving source is not directly coupled to the op amp
input (e.g., it is capacitively coupled), a resistor will be required to establish a DC
return path to ground. Without a DC return path, the input section's diff amp stage
will not be properly biased. This point is worth remembering, as it can save you a
great deal in future headaches. For example, in the lab a circuit like the one in Figure
4.2 may work fine with one function generator, but not with another. This would be
the case if the second generator used an output coupling capacitor and the first one
didn't.

Example 4.3

         Design a voltage follower (i.e., ideally infinite Zin and a voltage gain of 1).

         The Zin part is straightforward enough. As for the second part, what ratio of
         Rf to Ri will yield a gain of 1?

120
                                           Rf                                            Figure 4.4
                                 Av = 1+                                                 Voltage follower for
                                                                                         Example 4.3.
                                           Ri
                                R f = Av-1
                                Ri
                                Rf =0
                                Ri

This says that Rf must be 0 . Practically speaking, that means that Rf is
replaced with a shorting wire. What about Ri? Theoretically, almost any
value will do. As long as there's a choice, consider infinite. Zero divided by
infinite is certainly zero. The practical benefit of choosing Ri =  is that you
may delete Ri. The resulting circuit is shown in Figure 4.4. Remember, if the
source is not directly coupled, a DC return resistor will be needed. The value
of this resistor has to be large enough to avoid loading the source.

As you can see, designing with op amps can be much quicker than its discrete
counterpart. As a result, your efficiency as a designer or repair technician can
improve greatly. You are now free to concentrate on the system, rather than on the
specifics of an individual biasing resistor. In order to make multi-stage amplifiers,
just link individual stages together.

Example 4.4

         What is the input impedance of the circuit in Figure 4.5? What is Vout?

         As in any multi-stage amplifier, the input impedance to the first stage is the
         system Zin. The DC return resistor sets this at 100 k.

                                                                                         Figure 4.5
                                                                                         Multistage circuit for
                                                                                         Example 4.4.

         To find Vout, we need to find the gain (in dB).
121
                                           Av1= 1+R f                                     Figure 4.6
                                                     Ri                                   A basic parallel-parallel
                                                     14 k                                 amplifier.

                                           Av1= 1+                                        Figure 4.7
                                                      2k                                  Inverting voltage amplifier.

                                           Av1= 8
                                          Av1 ' = 18 dB

                                                     Rf
                                           Av2= 1+

                                                     Ri
                                                     18 k
                                           Av2= 1+
                                                      2k
                                           Av2= 10
                                          Av2 ' = 20 dB

                                          Avt ' = 18 dB + 20dB = 38 dB

                                         V out '= Avt ' + V i n '
                                         V out '= 38 dB +( -30 dBV)
                                         V out '= 8 dBV

         Because 8 dBV translates to about 2.5 V, there is no danger of clipping
         either.

Inverting Voltage Amplifier

The inverting amplifier is based on the PP negative feedback model. The base form
is shown in Figure 4.6. By itself, this form is current sensing, not voltage sensing. In
order to achieve voltage sensing, an input resistor, Ri, is added. See Figure 4.7.
Here's how the circuit works: Verror is virtually zero, so the inverting input potential
must equal the noninverting input potential. This means that the inverting input is at
a virtual ground. The signal here is so small that it is negligible. Because of this, we
may also say that the impedance seen looking into this point is zero. This last point
may cause a bit of confusion. You may ask, "How can the impedance be zero if the
current into the op amp is zero?" The answer lies in the fact that all of the entering
current will be drawn through Rf, thus bypassing the inverting input.

Refer to Figure 4.8 for the detailed explanation. The right end of Ri is at virtual
ground, so all of the input voltage drops across it, creating Iin, the input current.
This current cannot enter the op amp and instead will pass through Rf. Because a
positive signal is presented to the inverting input, the op amp will sink output
current, thus drawing Iin through Rf. The resulting voltage drop across Rf is the
same magnitude as the load voltage. This is true because Rf is effectively in
parallel with the load. Note that both elements are tied to the op amp's output and

122
to (virtual) ground. There is a change in polarity because we reference the output          Figure 4.8
signal to ground. In short, Vout is the voltage across Rf, inverted.                        Analysis of the inverting
                                                                                            amplifier from Figure 4.7.
                                 Av=V out
                                       Vin

                                V in=Iin Ri
                                V out= -V Rf
                                V Rf = I i n R f

Substitution yields

                     Av=- I i n R f    (4.2)
                             I i n Ri

                     Av=- R f
                             Ri

Again, we see that the voltage gain is set by resistor ratio. Again, there is an
allowable range of values.

The foregoing discussion points up the derivation of input impedance. Because all of
the input signal drops across Ri, it follows that all the driving source "sees" is Ri.
Quite simply, Ri sets the input impedance. Unlike the noninverting voltage amp,
there is a definite interrelation between Zin (Ri) and Av (-Rf/Ri). This indicates that it
is very hard to achieve both high gain and high Zin with this circuit.

Example 4.5

     Determine the input impedance and output voltage for the circuit in                    Figure 4.9
     Figure 4.9.                                                                            Inverting amplifier for
                                                                                            Example 4.9.
     The input impedance is set by Ri. Ri = 5 k, therefore Zi n = 5 k.

                                    V out=V i n Av
                                      Av=- R f
                                               Ri
                                      Av=-20 k 5 k
                                      A v= -4

                                    V out=100 mV×(-4)
                                    V out=-400 mV, (i.e., inverted)

123
Example 4.6

         Design an inverting amplifier with a gain of 10 and an input impedance of
         15 k.

         The input impedance tells us what Ri must be

                                          Zi n= Ri
                                          Ri=15 k

         Knowing Ri, solve for Rf:

                                          Av=- R f
                                                 Ri

                                          R f = Ri (- Av)
                                          R f =15k ×(-(-10))
                                          R f =150 k

Computer Simulation

A Multisim simulation of the result of Example 4.6 is shown in Figure 4.10, along
with its schematic. This simulation uses the simple dependent source model
presented in Chapter Two. The input is set at 0.1 VDC for simplicity. Note that the
output potential is negative, indicating the inverting action of the amplifier. Also,
note that the virtual ground approximation is borne out quite well, with the inverting
input potential measuring in the V region.

                                                                                        Figure 4.10a
                                                                                        Multisim simulation of the
                                                                                        simple op amp model for
                                                                                        Example 4.6. a. Schematic.

124
                                                                                          Figure 4.10b
                                                                                          Multisim simulation of the
                                                                                          simple op amp model for
                                                                                          Example 4.6. b. Output listing.

Example 4.7

         The circuit of Figure 4.11 is a pre-amplifier stage for an electronic music
         keyboard. Like most musicians' pre-amplifiers, this one offers adjustable
         gain. This is achieved by following the amplifier with a pot. What are the
         maximum and minimum gain values?

                                                                                          Figure 4.11
                                                                                          Musical instrument pre-
                                                                                          amplifier for Example 4.7.

         Note that the gain for the pre-amp is the product of the op amp gain and the
         voltage divider ratio produced by the pot. For maximum gain, use the pot in
         its uppermost position. Because the pot acts as a voltage divider, the upper-
         most position provides no divider action (i.e., its gain is unity). For midband
         frequencies, the 20 pF may be ignored.

125
                                 Av- max= - R f
                                              Ri

                                 Av- max= -200 k 15 k
                                 Av- max= -13.33
                                Av -max' = 22.5 dB

For minimum gain, the pot is dialed to ground. At this point, the divider
action is infinite, and thus the minimum gain is 0 (resulting in silence).

Zin for the system is about 15 k. As far as the extra components are
concerned, the 20 pF capacitor is used to decrease high frequency gain. The
two 0.1 F bypass capacitors across the power supply lines are very
important. Virtually all op amp circuits use bypass capacitors. Due to the
high gain nature of op amps, it is essential to have good AC grounds at the
power supply pins. At higher frequencies the inductance of power supply
wiring may produce a sizable impedance. This impedance may create a
positive feedback loop that wouldn't exist otherwise. Without the bypass
capacitors, the circuit may oscillate or produce spurious output signals. The
precise values for the capacitors are usually not critical, with 0.1 to 1 F
being typical.

Inverting Current-to-Voltage Transducer

As previously mentioned, the inverting voltage amplifier is based on PP negative
feedback, with an extra input resistor used to turn the input voltage into a current.
What happens if that extra resistor is left out, and a circuit such as Figure 4.6 is
used? Without the extra resistor, the input is at virtual ground, thus setting Zin to 0 .
This is ideal for sensing current. This input current will pass through Rf and produce
an output voltage as outlined above. The characteristic of transforming a current to a
voltage is measured by the parameter transresistance. By definition, the
transresistance of this circuit is the value of Rf. To find Vout, multiply the input
current by the transresistance. This circuit inverts polarity as well.

             V out=- I i n R f           (4.3)

Example 4.8

         Design a circuit based on Figure 4.6 if an input current of -50 A should
         produce an output of 4 V.
         The transresistance of the circuit is Rf

126
                                R f =- V out
                                         I in

                                R f =- 4 V -50  A
                                R f =80 k

The input impedance is assumed to be zero.

At first glance, the circuit applications of the topology presented in the prior
example seem very limited. In reality, there are a number of linear integrated circuits
that produce their output in current form5. In many cases, this signal must be turned
into a voltage in order to properly interface with other circuit elements. The current-
to-voltage transducer is widely used for this purpose.

Noninverting Voltage-to-Current Transducer

This circuit topology utilizes SS negative feedback. It senses an input voltage and
produces a current. A conceptual comparison can be made to the FET (a voltage-
controlled current source). Instead of circuit gain, we are interested in
transconductance. In other words, how much input voltage is required to produce a
given output current? The op amp circuit presented here drives a floating load. That
is, the load is not referenced to ground. This can be convenient in some cases, and a
real pain in others. With some added circuitry, it is possible to produce a grounded-
load version, although space precludes us from examining it here.

A typical voltage-to-current circuit is shown in Figure 4.12. Because this uses series-    Figure 4.12
input type feedback, we may immediately assume that Zin is infinite. The voltage to        Voltage-to-current transducer.
current ratio is set by feedback resistor Ri. As Verror is assumed to be zero, all of Vin
drops across Ri, creating current IRi. The op amp is assumed to have zero input
current, so all of IRi flows through the load resistor, Rl. By adjusting Ri, the load
current may be varied.

I load = I Ri
 I Ri= V i n Ri
I load = V i n
        Ri

5 Most notably, operational transconductance amplifiers and digital to analog converters,
    which we will examine in Chapters Six and Twelve, respectively.

127
By definition,

                g m= I load               (4.4)
                      Vin

                g m= 1
                      Ri

So, the transconductance of the circuit is set by the feedback resistor. As usual, there
are practical limits to the size of Ri. If Ri and Rl are too small, the possibility exists
that the op amp will "run out" of output current and go into saturation. At the other
extreme, the product of the two resistors and the Iload cannot exceed the power supply
rails. As an example, if Ri plus Rl is 10 k, Iload cannot exceed about 1.5 mA if
standard ±15 V supplies are used.

Example 4.9

     Given an input voltage of 0.4 V in the circuit of Figure 4.13, what is the load
     current?

                gm= 1                            Figure 4.13
                      Ri                         Voltage-to-current transducer
                                                 for Example 4.9.
                g m= 1 20 k
                g m=50 S

                I load = gm V in
                I load=50  S×0.4 V
                I load =20  A

     There is no danger of current overload here as the average op amp can
     produce about 20 mA, maximum. The output current will be 20 A
     regardless of the value of Rl, up to clipping. There is no danger of clipping in
     this situation either. The voltage seen at the output of the op amp to ground
     is

                V max =( Ri+Rl ) I load

                V max=(20 k +1 k )×20  A
                V max=420 mV

     That's well below clipping level.

128
Computer Simulation

A simulation of the circuit of Example 4.9 is shown in Figure 4.14. Multisim's ideal
op amp model has been chosen to simplify the layout. The load current is exactly as
calculated at 20 A. An interesting trick is used here to plot the load current, as
many simulators only offer plotting of node voltages. Using Multisim's Post
Processor, the load current is computed by taking the difference between the node
voltages on either side of the load resistor and then dividing the result by the load
resistance.

                                                                                                                     Figure 4.14a
                                                                                                                     Voltage-to-current transducer
                                                                                                                     simulation schematic.

                                                                                                                     Figure 4.14b
                                                                                                                     Simulation results.

129
Example 4.10

The circuit of Figure 4.15 can be used to make a high-input-impedance DC         Figure 4.15
voltmeter. The load in this case is a simple meter movement. This particular     DC voltmeter for
meter requires 100 A for full-scale deflection. If we want to measure            Example 4.10.
voltages up to 10 V, what must Ri be?

First, we must find the transconductance.

                                g m= I load
                                      Vin

                                g m= 100 A 10 V
                                g m=10 S
                                Ri= 1

                                     gm
                                Ri= 1 10  S
                                Ri=100 k

The meter deflection is assumed to be linear. For example, if the input signal
is only 5 V, the current produced is halved to 50 A. 50 A should produce
half-scale deflection. The accuracy of this electronic voltmeter depends on
the accuracy of Ri, and the linearity of the meter movement. Note that this
little circuit can be quite convenient in a lab, being powered by batteries. In
order to change scales, new values of Ri can be swapped in with a rotary
switch. For a 1 V scale, Ri equals 10 k. Note that for higher input ranges,
some form of input attenuator is needed. This is due to the fact that most op
amps may be damaged if input signals larger than the supply rails are used.

Inverting Current Amplifier                                                      Figure 4.16
                                                                                 Inverting current amplifier.
The inverting current amplifier uses PS negative feedback. As
in the voltage-to-current transducer, the load is floating. The
basic circuit is shown in Figure 4.16. Due to the parallel
negative feedback connection at the input, the circuit input
impedance is assumed to be zero. This means that the input
point is at virtual ground. The current into the op amp is
negligible, so all input current flows through Ri to node A.
Effectively, Ri and Rf are in parallel (they both share node A
and ground; actually virtual ground for Ri). Therefore, VRi and
VRf are the same value. This means that a current is flowing

130
through Rf, from ground to node A. These two currents join to form the load current.
In this manner, current gain is achieved. The larger IRf is relative to Iin, the more
current gain there is. As the op amp is sinking current, this is an inverting amplifier.

      Ai=- I out                       (4.5)
             Iin

     I out= I Rf +I Ri
     I Ri= I i n
     I Rf = V Rf

             Rf

Because VRf is the same value as VRi,

     I Rf = V Ri                       (4.6)
            Rf                         (4.7)

     V Ri= I i n Ri

Substitution of 4.7 into 4.6 yields

     I Rf = I i n Ri
             Rf

Substituting into 4.5 produces

     I out= I i n+Ii n Ri
                   Rf

     ( ) I out=I in 1+ Ri
                    Rf

     ( ) Ai=- 1+Ri                     (4.8)
                 Rf

As you might expect, the gain is a function of the two feedback resistors. Note the
similarity of this result with that of the noninverting voltage amplifier.

131
Example 4.11                                                                         Figure 4.17
                                                                                     Current amplifier for
         What is the load current in Figure 4.17?                                    Example 4.11.

                                          I out=- Ai I i n

              ( ) Ai=- 1+Ri
                                                      Rf
                   ( )33k
                                          Ai=- 1+

                                                       1k
                                          Ai=-34

                                          I out=-34×5 A
                                          I out=-170  A (sinking)

         We need to check to make sure that this current doesn't cause output
         clipping. A simple Ohm's law check is all that's needed.

                                         V max = I out Rload +I i n Ri
                                         V max=170 A×10 k +5 A ×33k
                                         V max=1.7 V +.165 V
                                         V max=1.865V (no problem)

Example 4.12

         Design an amplifier with a current gain of -50. The load is approximately
         200 k. Assuming a typical op amp (Iout-max = 20 mA with ± 15 V supplies),
         what is the maximum load current obtainable?

                 ( )Ri

                                           Ai=- 1+
                                                       Rf

                                          Ri =-Ai -1
                                          Rf
                                          Ri =50 -1
                                          Rf
                                          Ri =49
                                          Rf

         Therefore, Ri must be 49 times larger than Rf. Possible solutions include:

132
     Ri= 49k , R f =1 k 
     Ri=98 k  , R f =2 k 
     Ri=24.5 k , R f =500 

     As far as maximum load current is concerned, it can be no greater than the         Figure 4.18
     op amp's maximum output of 20 mA, but it may be less. We need to                   Current amplifier design for
     determine the current at clipping. Due to the large size of the load resistance,   Example 4.12.
     virtually all of the output potential will drop across it. Ignoring the extra
     drop across the feedback resistors will introduce a maximum of 1% error
     (that's worst case, assuming resistor set number two).

     With 15 V rails, a typical op amp will clip at 13.5 V. The resulting
     current is found through Ohm's law:

     I max=13.5 V 200 k
     I max=67.5  A

     Another way of looking at this is to say that the maximum
     allowable input current is 67.5 A/50, or 1.35 A. One possible
     solution is shown in Figure 4.18.

Summing Amplifiers

It is very common in circuit design to combine several signals into a single common
signal. One good example of this is in the broadcast and recording industries. The
typical modern music recording will require the use of perhaps dozens of
microphones, yet the final product consists of typically two output signals (stereo
left and right). If signals are joined haphazardly, excessive interference, noise, and
distortion may result. The ideal summing amplifier would present each input signal
with an isolated load not affected by other channels.

The most common form of summing amplifier is really nothing more than an
extension of the inverting voltage amplifier. Because the input to the op amp is at
virtual ground, it makes an ideal current summing node. Instead of placing a single
input resistor at this point, several input resistors may be used. Each input source
drives its own resistor, and there is very little affect from neighboring inputs. The
virtual ground is the key. A general summing amplifier is shown in Figure 4.19.

133
                                                                                         Figure 4.19
                                                                                         Summing amplifier.

The input impedance for the first channel is Ri1, and it's voltage gain is -Rf/Ri1. For
channel 2, the input impedance is Ri2, with a gain of -Rf/Ri2. In general, then for
channel N we have

              Zi n N = Ri N
              Av N = -R f

                       RiN

The output signal is the sum of all inputs multiplied by their associated gains.

              V out=V in1 Av1+V in2 Av2+... +V i n N Av N

which is written more conveniently as

               V out=  n                                   (4.9)

                       i=1 V ini Avi

A summing amplifier may have equal gain for each input channel. This is referred to
as an equal-weighted configuration.

Example 4.13

What is the output of the summing amplifier in Figure 4.20, with the given
DC input voltages?

                                                                                         Figure 4.20
                                                                                         Summing amplifier for
                                                                                         Example 4.13.

         The easy way to approach this is to just treat the circuit as three inverting
         voltage amplifiers, and then add the results to get the final output.

134
Channel 1:

            Av=- R f
                    Ri

            Av=-10 k 4 k
            Av =-2.5

            V out=-2.5×1 V
            V out=-2.5 V

Channel 2:

            Av=- R f
                    Ri

            Av=-10 k 2 k
            Av =-5

Channel 3:  V out=-5×-2 V
            V out=10 V

            Av=- R f
                    Ri

            Av=-10 k 1 k
            Av =-10

            V out=-10×.5 V
            V out=-5 V

The final output is found via summation:

            V out=-2.5 V+10 V+(-5 V)
            V out= 2.5 V

If the inputs were AC signals, the summation is not quite so straightforward.
Remember, AC signals of differing frequency and phase do not add
coherently. You can perform a calculation similar to the preceding to find
the peak value, however, an RMS calculation is needed for the effective
value (i.e., square root of the sum of the squares).

For use in the broadcast and recording industries, summing amplifiers will also
require some form of volume control for each input channel and a master volume
control as well. This allows the levels of various microphones or instruments to be
properly balanced. Theoretically, individual channel gain control may be produced

135
by replacing each input resistor with a potentiometer. By adjusting Ri, the gain may
be directly varied. In practice, there are a few problems with this arrangement. First
of all, it is impossible to turn a channel completely off. The required value for Ri
would be infinite. Second, because Ri sets the input impedance, a variation in gain
will produce a Zin change. This change may overload or alter the characteristics of
the driving source. One possible solution is to keep Ri at a fixed value and place a
potentiometer before it, as in Figure 4.21. The pot produces a gain from 1 through 0.
The Rf/Ri combo is then set for maximum gain. As long as Ri is several times larger
than the pot's value, the channel's input impedance will stay relatively constant. The
effective Zin for the channel is Rpot in parallel with Ri, at a minimum, up to Rpot.

                                                                                                                     Figure 4.21
                                                                                                                     Audio mixer.

As far as a master volume control is concerned, it is possible to use a pot for Rf.
Without a limiting resistor though, a very low master gain runs the risk of over
driving the op amp due to the small effective Rf value. This technique also causes
variations in offset potentials and circuit bandwidth. A technique that achieves
higher performance involves using a stage with a fixed Rf value, followed with a pot,
as in Figure 4.21.

Still another application of the summing amplifier is the level shifter. A level shifter
is a two-input summing amplifier. One input is the desired AC signal, and the second
input is a DC value. The proper selection of DC value lets you place the AC signal at
a desired DC offset. There are many uses for such a circuit. One possible application
is the DC offset control available on many signal generators.

Noninverting Summing Amplifier

Besides the inverting form, summing amplifiers may also be produced in a
noninverting form. Noninverting summers generally exhibit superior high frequency
performance when compared to the inverting type. One possible circuit is shown in
Figure 4.22. In this example, three inputs are shown, although more could be added.
Each input has an associated input resistor. Note that it is not possible to simply wire
several sources together in hopes of summing their respective signals. This is
because each source will try to bring its output to a desired value that will be
different from the values created by the other sources. The resulting imbalance may

136
cause excessive (and possibly damaging) source currents. Consequently, each source
must be isolated from the others through a resistor.

                                                                                                                     Figure 4.22
                                                                                                                     Noninverting summing
                                                                                                                     amplifier.

In order to understand the operation of this circuit it is best to break it into two parts:
the input source/resistor section and the noninverting amplifier section. The input
signals will combine to create a total input voltage, Vt. By inspection, you should see
that the output voltage of the circuit will equal Vt times the noninverting gain, or

                      ( ) V out=V t 1+R f
                                      Ri

All that remains is to determine Vt. Each of the input channels contributes to Vt in a
similar manner, so the derivation of the contribution from a single channel will be
sufficient.

Unlike the inverting summer, the noninverting summer does not take advantage of              Figure 4.23
the virtual-ground summing node. The result is that individual channels will affect          Channel 1 input equivalent
each other. The equivalent circuit for channel 1 is redrawn in Figure 4.23. Using            circuit.
superposition, we would first replace the input generators of channels 2 and 3 with
short circuits. The result is a simple voltage divider between V1 and Vt1.

                                V t 1=V 1 R2 || R3
                                          R1+R2 || R3

In a similar manner, we can derive the portions of Vt due to channel 2
                                V t 2=V 2 R1|| R3
                                          R2 +R1 || R3

and due to channel 3

                      V t 3=V 3 R1 || R2
                                R3+R1 || R2

137
Vt is the summation of these three portions.

     V t =V t 1+V t 2+V t 3

Thus, by combining these elements, we find that the output voltage is

     ( )( ) V out= 1+Rf
                  Ri
                             V 1 R2 || R3 +V 2 R1 || R3 +V 3 R1 || R2
                                 R1+R2 || R3 R2+R1|| R3 R3+R1|| R2

For convenience and equal weighting, the input resistors are often all set to the same
value. This results in a circuit that averages together all of the inputs. Doing so
simplifies the equation to

     ( ) V out= 1+R f               V 1+V 2+V 3
                  Ri                      3

or in a more general sense,

     ( ) V out= 1+R f                    n                             (4.10)
                  Ri
                                    i=1 V n

                                        n

where n is the number of channels.

One problem still remains with this circuit, and that is inter-channel isolation or
crosstalk. This can be eliminated by individually buffering each input, as shown in
Figure 4.24.

                                                                                        Figure 4.24
                                                                                        Buffered and isolated
                                                                                        noninverting summing
                                                                                        amplifier.

138
Example 4.14

         A noninverting summer such as the one shown in Figure 4.22 is used to
         combine three signals. V1 = 1 VDC, V2 = -0.2 VDC, and V3 is a 2 V peak
         100 Hz sine wave. Determine the output voltage if R1= R2= R3= Rf = 20 k
         and Ri = 5 k.

         Because all of the input resistors are equal, we can use the general form of
         the summing equation.

    ( ) V out= 1+R f V 1+V 2+...+V n
                          Ri Number of channels

    ( ) V out= 1+20 k 1 VDC+(-0.2 VDC)+2 sin 2  100 t 5 k 3

            V out=5 0.8 VDC+2 sin 2  100 t 3
            V out=1.33 VDC+3.33sin 2  100 t

         So we see that the output is a 3.33 V peak sine wave riding on a 1.33 VDC
         offset.

Differential Amplifier                                                                 Figure 4.25
                                                                                       Differential amplifier
As long as the op amp is based on a differential input stage, there is nothing         candidate.
preventing you from making a diff amp with it. The applications of an op amp based
unit are the same as the discrete version examined in Chapter One. In essence, the
differential amplifier configuration is a combination of the inverting and
noninverting voltage amplifiers. A candidate is seen in Figure 4.25. The analysis is
identical to that of the two base types, and Superposition is used to combine the
results. The obvious problem for this circuit is that there is a large mismatch
between the gains if lower values are used. Remember, for the inverting input
the gain magnitude is Rf/Ri, whereas the noninverting input sees Rf/Ri + 1. For
proper operation, the gains of the two halves should be identical. The
noninverting input has a slightly higher gain, so a simple voltage divider may
be used to compensate. This is shown in Figure 4.26. The ratio should be the
same as the Rf/Ri ratio. The target gain is Rf/Ri, the present gain is 1 + Rf/Ri,
which may be written as (Rf + Ri)/Ri. To compensate, a gain of Rf/(Rf + Ri) is
used.

139
              Av+= R f +Ri    Rf                                                        Figure 4.26
                       Ri   R f +Ri                                                     Differential amplifier with
                                                                                        compensation for
              Av += R f ( R f +Ri)                                                      mismatched gains.
                     Ri (R f +Ri)

              Av += R f              (4.11)
                    Ri

For a true differential amplifier, Ri' is set to Ri, and Rf' is set to Rf. A small
potentiometer is typically placed in series with Rf' in order to compensate for
slight gain imbalances due to component tolerances. This makes it possible for
the circuit's common-mode rejection ratio to reach its maximum value.
Another option for a simple difference amplifier is to set Ri' plus Rf' equal to Ri.
Doing so will maintain roughly equal input impedance between the two halves
if two different input sources are used.

Once the divider is added, the output voltage is found by multiplying the differential
input signal by Rf/Ri.

Example 4.15

     Design a simple difference amplifier with an input impedance of 10 k per           Figure 4.27
     leg, and a voltage gain of 26 dB.                                                  Difference amplifier for
                                                                                        Example 4.15.
     First of all, converting 26 dB into ordinary form yields 20. Because Ri sets
     Zin, set Ri = 10 k, from the specifications.

                                     Av= R f
                                           Ri

                                     R f = Av Ri
                                     R f =20×10 k
                                     R f =200 k

     For equivalent inputs,

                                     Ri ' +R f ' = Ri
                                     Ri ' +R f ' =10 k

     Given that Av = 20,

                                     R f ' =20× Ri '

140
         Therefore,

                                         21× Ri '=10 k
                                          Ri ' =476
                                          R f ' =20×Ri '
                                          R f ' =9.52 k

         The final result is shown in Figure 4.27. As you will see later in Chapter Six,
         the differential amplifier figures prominently in another useful circuit, the
         instrumentation amplifier.

Adder/Subtractor

If inverting and noninverting summing amplifiers are combined using the
differential amplifier topology, an adder/subtractor results. Normally, all resistors in
an adder/subtractor are the same value. A typical adder/subtractor is shown in
Figure 4.28.

                                                                                                                     Figure 4.28
                                                                                                                     Adder-subtractor.

The inverting inputs number from 1 through m, and the noninverting inputs number
from m+1 through n. The circuit can be analyzed by combining the preceding proofs
of Equations 4.9 through 4.11 via the Superposition Theorem. The details are left as
an exercise (Problem 4.45). When all resistors are equal, the input weightings are
unity, and the output is found by:

     n              m

     i=m+1 V i ni-  j=1 V i nj
       V out=                   (4.12)

In essence, you can think of the output voltage in terms of subtracting the inverting
input summation from the noninverting input summation.

141
Adjustable Inverter/Noninverter

A unique adjustable gain amplifier is shown in Figure 4.29. What makes this circuit
interesting is that the gain is continuously variable between an inverting and
noninverting maximum. For example, the gain might be set for a maximum of 10. A
full turn of the potentiometer would swing the gain from +10 through -10. The
exact middle setting would produce a gain of 0. In this way, a single knob controls
both the phase and magnitude of the gain.

                                                                                                                 Figure 4.29
                                                                                                                 Adjustable inverter/
                                                                                                                 noninverter.

For the analysis of the circuit, refer to Figure 4.30.

                                                                                        Figure 4.30
                                                                                        Inverter/noninverter
                                                                                        analysis.

As you would expect, the gain of the circuit is defined as the ratio of the output to
input voltages. It is important to note that unlike a normal inverting amplifier, the
magnitude of the output voltage is not necessarily equal to the voltage across R2.
This is because the inverting terminal of the op amp is not normally a virtual ground.
Instead, the voltage across R3 must also be considered. Because the two inputs of the
op amp must be at approximately the same potential (i.e., Verror must be 0), the
voltage at the inverting terminal must be the same as the voltage tapped off of the
potentiometer. Representing the potentiometer's voltage divider factor as k, we find:

     V out= k V i n-V R2                                (4.13)

142
The drop across R2 is simply I2 R2. I2 is found by Kirchhoff's Current Law and the
appropriate voltage-resistor substitutions:

                          I 2=I1 -I 3

                          I 2=V i n-k V in -k V i n
                            R1             R3

                          ( ) I 2=V in 1-k - k
                                      R1 R3

Thus, VR2 is found to be

                          ( ) V R2=V i n (1-k) R2 -k R2               (4.14)
                                               R1 R3

Combining Equations 4.13 and 4.14 and then solving for gain, we find

                          ( ) Av=k- (1-k ) R2 -k R2
                                             R1 R3

                          ( ) Av=k- R2 -k R2 -k R2
                                    R1 R1 R3

                            ( ) R2
                                           R2 R2
                          Av=- +k 1+ +k
                          R1               R1 R3

The value of R3 is chosen so that R1 = R2 || R3. This means that

                                R3= 1 1 1
                                          -

                                      R1 R2
Substituting this into our gain equation and simplifying yields

                          Av= R2 (2 k -1)
                               R1

In essence, the resistors R1 and R2 set the maximum gain. The potentiometer sets k
from 0 through 1. If k = 1, then Av = R2/R1, or maximum noninverting gain. When
k = 0, then Av = - R2/R1, or maximum inverting gain. Finally, when the potentiometer
is set to the mid-point, k = 0.5 and Av = 0.

4.3 Single Supply Biasing

Up to this point, all of the example circuits have used a bipolar power supply,
usually ± 15 V. Sometimes this is not practical. For example, a small amount of

143
analog circuitry may be used along with a predominantly digital circuit that runs off
a unipolar supply. It may not be economical to create an entire negative supply just
to run one or two op amps. Although it is possible to buy op amps that have been
specially designed to work with unipolar supplies6, the addition of simple bias
circuitry will allow almost any op amp to run from a unipolar supply. This supply
can be up to twice as large as the bipolar counterpart. In other words, a circuit that
normally runs off a ± 15 V supply can be configured to run off of a +30 V unipolar
supply, producing similar performance. We will look at examples using both the
noninverting and inverting voltage amplifiers
The idea is to bias the input at one-half of the total supply potential. This can be
done with a simple voltage divider. A coupling capacitor may be used to isolate this
DC potential from the driving stage. For proper operation, the op amp's output
should also be sitting at one-half of the supply. This fact implies that the circuit gain
must be unity. This may appear to be a very limiting factor, but in reality, it isn't.
The thing to remember is that the gain need only be unity for DC. The AC gain can
be just about any gain you'd like.

                                                                                                                     Figure 4.31
                                                                                                                     Single-supply bias in a
                                                                                                                     noninverting amplifier.

An example using the noninverting voltage amplifier is shown in Figure 4.31. In
order to set DC gain to unity without affecting the AC gain, capacitor C3 is placed in
series with Ri. R1 and R2 establish the 50% bias point. Their parallel combination sets
the input impedance too. Resistors R3 and R4 are used to prevent destructive
discharge of the coupling capacitors C1 and C2 into the op amp. They may not be
required, but if present, typically run around 1 k and 100  respectively.

6 Examples include the LM324 and TLC270 series.

144
The inclusion of the capacitors produces three lead networks. A standard frequency
analysis and circuit simplification shows that the approximate critical frequencies
are

                                f i n= 1
                                      2  C 1 R1 || R2

                                 f out= 1
                                        2  C 2 Rload

                                f fdbk= 1
                                         2  C3 Ri

The input bias network can be improved by using the circuit of Figure 4.32. This
reduces the hum and noise transmitted from the power supply into the op amp's
input. It does so by creating a low impedance at node A. This, of course, does not
affect the DC potential. R5 now sets the input impedance of the circuit.

                                                                                                                     Figure 4.32
                                                                                                                     Improved bias for the circuit in
                                                                                                                     Figure 4.31.

The important points to remember here are that voltage gain is still 1 + Rf/Ri in the
midband, Zin is now set by the biasing resistors R1 and R2, or R5 (if used), and that
frequency response is no longer flat down to zero hertz.

A single-supply version of the inverting voltage amplifier is shown in Figure 4.33. It
uses the same basic techniques as the noninverting form. The bias setup uses the
optimized low-noise form. Note that there is no change in input impedance, it is still
set by Ri. The approximate lead network critical frequencies are found through

                                    f in= 1
                                          2  C1 Ri

                                  f out= 1
                                         2  C 2 Rload

                                f bias= 1
                                        2  C3 R1 || R2

Note the general similarity between the circuits of Figures 4.33 and 4.31. A simple
redirection of the input signal creates one form from the other.

145
                                                                                                                     Figure 4.33
                                                                                                                     Single-supply inverting
                                                                                                                     amplifier.

4.4 Current Boosting

As previously noted, general-purpose op amps produce a maximum output current
of around 20 mA. This is sufficient for a wide variety of uses. If the load is less than
about 1 k, the op amp will start to clip on the higher output signals. The average op
amp cannot drive low impedance loads. A few examples of applications whose loads
are inappropriate include distribution amplifiers, small audio power amplifiers such
as a headphone amplifier, and small motors. This is most unfortunate, as we have
already seen how useful these devices can be. There is a way out, though. It is
possible to include a current gain stage right after the op amp. All that is needed is a
simple class B or class AB push-pull follower. This follower will be able to produce
the higher current required by low impedance loads. The op amp only needs to drive
the follower stage. In order to increase system linearity and lower distortion, the
follower can be placed inside of the op amp's feedback loop. Because the follower is
noninverting, there is no problem with maintaining correct feedback (this assumes
that the power devices used have a wider bandwidth than the op amp). An example
of this is shown in Figure 4.34.

                                                                                                                     Figure 4.34
                                                                                                                     Current boosting.

146
This circuit is typical of an electronic crossover or distribution amplifier (an
electronic crossover design example is given in Chapter Eleven). This output circuit
needs to drive relatively low impedances through long cable runs of perhaps several
hundred feet. The excessive capacitance resulting from long cable runs increases the
current demand above that of a purely resistive load.

Circuits like the one in Figure 4.34 can produce currents of several hundred
milliamps or more. Many times, small resistors are placed in the emitter or collector
as a means of limiting maximum current or reducing distortion. The maximum
output current limitation is a function of the class B devices. Some manufacturers
offer current-boosting ICs to further simplify the design. The current-booster is a
drop-in replacement for the class B follower. For very high current demands,
Darlingtons or multi-stage designs may be required. It is even possible to provide
voltage gain stages. Indeed, several consumer audio power amplifiers have been
designed in exactly this way. In essence, the designers produce a discrete power
amplifier and then "wrap it" within an op amp feedback loop.

Computer Simulation

A basic current booster is simulated using Multisim in Figure 4.35. In order to see
secondary effects, the LF411 model has been chosen instead of the ideal device
model.

                                                                                                                     Figure 4.35a
                                                                                                                     Current booster simulation
                                                                                                                     schematic.

The circuit is configured for a voltage gain of unity, thus the 5 volt input signal
should yield a 5 volt output. According to its data sheet, the short-circuit current of
the LF411 is approximately 25 mA at room temperature. It is not capable of driving
a 75  load to 5 volts by itself. The Transient Analysis shows a full 5 volt output
signal, indicating the effectiveness of the current boosting stage. Also, a close

147
inspection of the output waveform shows no obvious forms of distortion such as the
cross-over distortion typical of simple class B stages. This shows that keeping the
class B stage within the feedback loop does indeed minimize distortion.

                                                                                                                  Figure 4.35b
                                                                                                                  Simulation of output
                                                                                                                  waveform.

Summary

In this chapter we have explored a variety of basic op amp circuits and learned a few
analysis shortcuts. The basic assumptions are that the error voltage (differential
input voltage) is zero and that the op amp's input current is zero. In all circuits, the
gain or transfer parameter is a function of just one or two resistors. Circuits can be
made that produce voltage gain, current gain, voltage-to-current conversion, or
current-to-voltage conversion. The most popular op amp circuits are the
noninverting voltage amplifier and the inverting voltage amplifier. These are based
on SP and PP negative feedback, respectively. The noninverting type shows an
ideally infinite input impedance, whereas the inverting type has its input impedance
set by one of the feedback resistors. A variation of the inverting voltage amplifier is
the summing amplifier. This adds its several input channels together in order to
arrive at its single output signal. The input node is at virtual ground. The differential
amplifier is basically the simultaneous use of both the inverting and noninverting
voltage amplifier forms.

The voltage-to-current transducer is based on SS feedback. Its transconductance is
set by a single feedback resistor. In a similar manner, the current-to-voltage
transducer is based on PP feedback and has a single feedback resistor to set its
transresistance. The current amplifier is based on PS feedback.

Although op amps are designed to run off bipolar power supplies, they can be used
with unipolar supplies. Extra circuitry is needed for the proper bias. There is no

148
restriction on AC gain; however, DC gain must be set to unity. Because lead
networks are introduced, the system gain cannot be flat down to zero hertz.

Finally, if higher output current requirements need to be met, it is possible to boost
the op amp's capabilities with a discrete output stage. This stage is typically a class
B or class AB push-pull follower. In order to lower system distortion, the follower is
kept within the op amp's feedback loop.

Review Questions

    1. What forms of feedback are used for the inverting and noninverting voltage
         amplifiers?

    2. What forms of feedback are used for the current-to-voltage and voltage-to-
         current transducers?

    3. What form of feedback is used for the inverting current amplifier?
    4. What are the op amp analysis idealizations?
    5. What is virtual ground?
    6. What is a summing amplifier?
    7. How can output current by increased?
    8. What circuit changes are needed in order to bias an op amp with a unipolar

         supply?
    9. What operational parameters change when a circuit is set up for single

         supply biasing?
    10. How might a circuit's gain be controlled externally?
    11. What is meant by the term "floating load"?

Problems

Analysis Problems

    1. What is the voltage gain in Figure 4.36? What is the input impedance?

                                                                        Figure 4.36

    2. What is the voltage gain for the first stage of Figure 4.37? What is the input
         impedance?

149
                                                                                   Figure 4.37

3. What is the voltage gain for the second stage of Figure 4.37? What is the
    input impedance?

4. What is the system voltage gain in Figure 4.37? What is the input
    impedance?

5. If the input to Figure 4.37 is -52 dBV, what is Vout' ?
6. What is the voltage gain in Figure 4.38? What is the input impedance?
7. If the input voltage to the circuit of Figure 4.38 is 100 mV, what is Vout?

                                                                  Figure 4.38

8. What is the system input impedance in Figure 4.39? What is the system
    gain?

                                                                                   Figure 4.39

    9. Redesign Figure 4.39 for an input impedance of 20 k.
    10. Given an input current of 2 A, what is the output voltage in Figure 4.40?

150
                                                                        Figure 4.40

    11. What is the meter deflection in Figure 4.41 if the input voltage is 1 V?
                                                                        Figure 4.41

    12. What input voltage will produce full-scale deflection in Figure 4.41?
    13. Determine a new value for the 10 k resistor in Figure 4.41 such that a 0.1

         V input will produce full-scale deflection.
    14. What is the current gain in Figure 4.42?

                                                                        Figure 4.42

    15. What is the maximum input current in Figure 4.42, assuming the circuit is
         running off of ±15 V supplies, and the op amp has a maximum output
         current of 25 mA?

    16. If the differential input signal is 300 mV in Figure 4.43, what is Vout?

151
                                                                        Figure 4.43

    17. Determine new values for the voltage divider resistors in Figure 4.43, such
         that the resulting input impedance is balanced.

Design Problems

    18. Design a noninverting amplifier with a voltage gain of 32 dB and an input
         impedance of 200 k.

    19. Design a voltage follower with a gain of 0 dB.
    20. Design an inverting amplifier with a voltage gain of 14 dB and an input

         impedance of 15 k.
    21. Design a current-to-voltage transducer such that a 20 A input current will

         produce a -1 V output.
    22. Design a voltage-to-current transducer such that a 100 mV input will

         produce a 1 mA output.
    23. Design a current amplifier with a gain of -20.
    24. Design a differential amplifier with a gain of 18 dB and a balanced input

         impedance of 25 k per input.
    25. Design a voltage to current transducer with a transconductance of 1 mS. If

         Vin is 200 mV, what is Iout?
    26. Design a current to voltage transducer with a transresistance of 10 k. If the

         input current is 500 A, what is Vout?
    27. Redesign the circuit of Figure 4.36 for single supply operation (don't bother

         calculating capacitor values).
    28. Redesign the circuit of Figure 4.38 for single supply operation (don't bother

         calculating capacitor values).
    29. Design a summing amplifier such that channel 1 has a gain of 10, channel 2

         has a gain of 15, and channel 3 has a gain of 5. The minimum channel input
         impedance should be 1 k.
    30. Determine capacitor values for Problem 27 if the lower break frequency f1,
         is set to 20 Hz.

152
    31. Determine capacitor values for Problem 28 if the lower break frequency f1,
         is set to 10 Hz.

Challenge Problems
    32. Design a three channel summing amplifier such that: channel 1 Zin  10 k,
         Av = 6 dB; channel 2 Zin  22 k, Av = 10 dB; and channel 3 Zin  5 k,
         Av = 16 dB
    33. Assuming 10% resistor values, determine the production gain range for
         Figure 4.36.
    34. Assuming 5% resistor values, determine the highest gain produced in Figure
         4.37.
    35. Design an inverting amplification circuit with a gain of at least 40 dB, and
         an input impedance of at least 100 k. No resistor used may be greater than
         500 k. Multiple stages are allowed.
    36. Redesign the circuit of Figure 4.38 as a voltmeter with 500 mV, 2 V, 5 V,
         20 V, and 50 V ranges.
    37. Assuming 1% precision resistors and a meter accuracy of 5%, what range of
         input values may produce a full-scale reading of 2 V, for the circuit of
         Problem 36?
    38. Design an amplifier with a gain range from -10 dB to +20 dB, with an input
         impedance of at least 10 k.
    39. Design an amplifier with a gain range from 0 to 20. The input impedance
         should be at least 5 k.
    40. What is the input impedance in Figure 4.44? What is Av?

                                                                                                                     Figure 4.44

    41. How much power supply ripple attenuation does the input biasing network
         of Figure 4.44 produce (assume fripple = 120 Hz)?

153
    42. Assume that the circuit of Figure 4.45 utilizes a standard 20 mA output op
         amp. If the output devices are rated for a maximum collector current of 5
         amps and a Beta of 50, what is the maximum load current obtainable?

                                                                        Figure 4.45

    43. What are the voltage gain and input impedance in Figure 4.45?
    44. Given a summer based on Figure 4.22, sketch the output waveform if

         R1 = R2= 10 k, R3 = Rf = 30 k, Ri = 15 k, V1 = 0.3 VDC,
         V2 = 0.1 sin 2 50 t and V3 = -0.2 sin 2 200 t.
    45. Prove Equation 4.12 for the case when all resistors are of equal value.

Computer Simulation Problems
    46. Simulate the operation of the circuit in Figure 4.9. Verify the output voltage
         and the virtual ground at the inverting input.
    47. Use a simulator to verify the maximum and minimum gains of the circuit in
         Figure 4.11.
    48. Use a simulator to verify the load current and the voltage of the circuit in
         Figure 4.17.
    49. Verify the output potential of the circuit in Figure 4.20.
    50. Simulate the output voltage of the circuit of Figure 4.39 for the following
         inputs: A) Vin = 0.1 VDC, B) Vin(t) = 1 sin 2 10 t, C) Vin = 5 VDC. Also,
         note the potential at the output of the first stage. How might your op amp
         model affect the results?
    51. Simulate the circuit in Figure 4.27. Determine the output potential for the
         following inputs: A) Vin+(t) = 0.1 sin 2 10t, Vin-(t) = 0.1 sin 2 10t,
         B) Vin+(t) = 0.1 sin 2 10t, Vin-(t) = -0.1 sin 2 10t.

154
    52. Simulate the circuit of Figure 4.45, and determine the output of the circuit
         and op amp for inputs of 0.1 VDC and 1 VDC.
         Use the space below creatively. Draw a cartoon. Compose a song. Write a
         limerick. Whatever works for you. If you're stuck, try starting with this: 

155
5 Practical Limitations of Op Amp Circuits

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Define gain-bandwidth product and describe its use in circuit design and analysis.
    · Determine upper and lower break frequencies in a multi-stage circuit.
    · Define slew rate and power bandwidth, and calculate their effect on circuit performance.
    · Understand the difference between power bandwidth and small-signal bandwidth.
    · Detail the differences between compensated, noncompensated, and decompensated op amps.
    · Calculate the DC offset of an op amp circuit and understand how to minimize it.
    · Calculate the DC drift of an op amp circuit and understand how to minimize it.
    · Discuss which factors affect the noise performance of an op amp circuit.
    · Calculate the noise voltage of an op amp circuit.
    · Analyze the CMRR, PSRR, and S/N performance of an op amp circuit.

5.1 Introduction

Up to now, the op amp has been treated as an ideal device. Although these idealizations are very useful in their
place, closer examination must follow. Without this knowledge, it will be impossible to accurately predict a
circuit's performance for very high or low frequencies, to judge its noise characteristics, or to determine its
stability with temperature or power supply variations. With this information, you will be able to optimize circuit
performance for given applications. A major part of this is determining the most desirable op amp for the job.
The function of this chapter, then, is to delve deeper into the specifics of individual op amps and to present
methods for determining system parameters such as frequency response, noise level, offsets, and drift. The
primary interest is in investigating the popular inverting and noninverting voltage amplifier topologies.

5.2 Frequency Response

In Chapter Four, a number of equations were presented for the various amplifier topologies. These enabled you
to find the circuit gain, among other things. These equations are, of course, only valid in the midband region of
the amplifier. They say nothing of the amplifier response at the frequency extremes. Chapter One showed that
all amplifiers eventually roll off their gain as the input frequency increases. Some amplifiers exhibit a rolloff as
the input frequency is decreased as well. Op amp circuits are no exception. There are two things we can say
about the average op amp circuit's frequency response: (1) if there are no coupling or other lead network
capacitors, the circuit gain will be flat from midband down to DC; and (2) there will eventually be a well-
controlled high-frequency rolloff that is usually very easy to find. Item one should come as no great surprise, but

156
you may well wonder about the second. For general-purpose op amps, the high
frequency response may be determined with a parameter called the gain-bandwidth
product, often abbreviated GBW.

5.3 Gain-Bandwidth Product

The open loop frequency response of a general-purpose op amp is shown in Figure
5.1A. Although the exact frequency and gain values will differ from model to
model, all devices will exhibit this same general shape and 20 dB per decade rolloff
slope. This is because the lag break frequency (fc) is determined by a single capacitor
called the compensation capacitor. This capacitor is usually in the Miller position
(i.e., straddling input and output) of an intermediate stage, such as C in Figure 5.1b.
Although this capacitor is rather small, the Miller effect drastically increases its
apparent value. The resulting critical frequency is very low, often in the range of 10
to 100 Hz. The other circuit lag networks caused by stray or load capacitances are
much higher, usually over 1 MHz. As a result, a constant 20 dB per decade rolloff is
maintained from fc up to very high frequencies. The remaining lag networks will not
affect the open-loop response until the gain has already dropped below zero dB.

     100 dB                                                                              Figure 5.1a
          80                                                                             Open-loop frequency response.
          60
          40   10 Hz 100 1 k 10 k 100 k 1 M f
          20
            0

This type of frequency response curve has two benefits: (1) The most important
benefit is that it allows you to set almost any gain you desire with stability. Only a
single network is active, thus satisfactory gain and phase margins will be
maintained. Therefore, your negative feedback never turns into positive feedback (as
noted in Chapter Three). 2) The product of any break frequency and its
corresponding gain is a constant. In other words, the gain decreases at the same rate
at which the frequency increases. In Figure 5.1, the product is 1 MHz. As you might
have guessed, this parameter is the gain-bandwidth product of the op amp (GBW).
GBW is also referred to as funity (the frequency at which the open loop gain equals
one). You will find both terms used on manufacturer's spec sheets.

157
                                                                                      Figure 5.1b
                                                                                      Miller compensation capacitor.

As you already know, operating an op amp with negative feedback lowers the
midband gain. To a first approximation, this gain will continue until it reaches the
open loop response. At this point, the closed loop response will follow the open-loop
rolloff. Remember, this is due to the reduction in loop gain, as seen in Chapter
Three. This effect is shown in Figure 5.2.

     A'v ol               open loop                                                   Figure 5.2
     A'v cl  closed loop                                                              Comparison of open-loop and
                                                                                      closed-loop responses.

                                     f

By knowing GBW and the gain, the associated break frequency can be quickly
determined. For the inverting and noninverting voltage amplifiers,

             f 2=GBW                    (5.1)
                   Anoise

The use of noise gain versus ordinary voltage gain simplifies things and actually
makes the results a bit more accurate. Noise gain is the same for both the inverting
and noninverting voltage amplifiers. The use of noise gain helps us to take into

158
account the true (non-ideal) feedback effects and circuit imperfections. An example
of these limitations is that the open loop gain of an op amp is never infinite. To find
the noise gain for any circuit, short all voltage sources and open all current sources.
The only item remaining for each source should be its internal resistance. At this
point, simplify the circuit as required, and find the gain from the noninverting input
to the output of the op amp. This gain is the noise gain. For the standard inverting
and noninverting voltage amplifiers, we find

                                Anoise=1+R f
                                             Ri

Noise gain is the same as ordinary voltage gain for the noninverting voltage
amplifier, but is one unit larger than the inverting amplifier's ordinary gain (Rf/Ri).
The deviation is only noticeable at lower gains. This does imply though, that for the
same gain, noninverting amplifiers will exhibit a higher break frequency than
inverting types. Thus, for maximum bandwidth with low gain circuits, the
noninverting form is generally preferred. The worst case occurs with an ordinary
voltage gain of 1. For the noninverting configuration, the noise gain will also equal
1, and the closed loop bandwidth will equal funity. On the other hand, an inverting
amplifier with a voltage gain of 1 will produce a noise gain of 2 and will exhibit a
small-signal bandwidth of funity/2. Never use the gain in dB form for this calculation!

Example 5.1

         Using a 741 op amp, what is the upper break frequency for a noninverting
         amplifier with a gain of 20 dB?

         A 741 data sheet shows a typical GBW of 1 MHz. The noise gain for a
         noninverting amplifier is the same as its ordinary gain. Converting 20 dB
         into ordinary form yields a gain of 10.

                                          f 2=GBW
                                                Anoise

                                          f 2=1 MHz 10
                                          f 2=100 kHz

         So, the gain is constant at 10 up to 100 kHz. Above this frequency the gain
         rolls off at 20 dB per decade.

159
Example 5.2

     Sketch the frequency response of the circuit in Figure 5.3                    Figure 5.3
                                                                                   Circuit for Example 5.2.

     This is an inverting voltage amplifier. The gain is

                      Av= - R f
                               Ri

                      Av= -10 k 2 k
                      Av= -5
                     Av ' =14dB

     For noise gain

                     Anoise= 1+R f                                                 Figure 5.4a
                                  Ri                                               Bode plot for the circuit.

                     Anoise= 1+10 k 2 k
                     Anoise= 6

     From a data sheet, GBW for a 741 is found to be 1 MHz.      14 dB             167 k  1M f
                                                                      0
                                     f 2= GBW
                                            Anoise

                                     f 2=1 MHz 6
                                     f 2=167 kHz

     The resulting gain Bode plot is shown in Figure 5.4. Note that if a "faster"
     op amp is used (i.e., one with a higher GBW, such as the LF411), the
     response will extend further. As you might guess, faster op amps are more
     expensive.

Computer Simulation

The simulation results for Example 5.2 are also shown in Figure 5.4. The low
frequency gain agrees with the hand calculation of approximately 14 dB. The 3 dB
down point (f2) also agrees with the calculated break of approximately 167 kHz.

160
                                                                                                                     Figure 5.4b
                                                                                                                     Multisim schematic for Bode
                                                                                                                     plot simulation.

                                                                                                                     Figure 5.4c
                                                                                                                     Simulation of Bode plot.

It is important to note that the simple dependent source model presented in Chapter
Two cannot be used because it does not have the proper frequency response. Instead,
manufacturers offer accurate models for their op amps. There are several variations
on the theme. The model presented here is typical. It is fairly complex and is quite
accurate. The op amp model is comprised of two basic parts, a differential amplifier
input portion and a dependent source output section. The input portion utilizes a pair
of NPN transistors with simple resistors for the loads (RC1 and RC2). Resistors RE1 and
RE2 serve as swamping or emitter-degeneration resistors. The tail-current source is
set by the independent source IEE. The non-ideal internal impedance and frequency
limitations of this current source are taken into account by RE and CE, whereas C1
161
helps to model the high frequency loading of the diff amp's output. The output
portion revolves around a series of voltage-controlled current sources. GCM models
common mode gain, GA models the ordinary gain, and R2 serves as the combined
internal impedance of these sources. C2 is the system compensation capacitor and
has a value of 30 pF. RO1 and RO2 serve to model the output impedance of the op
amp. Diodes D1 through D4 and voltage sources EC, VC, and VE model the limits of
the op amp's class AB output stage.

                                                                                                                     Figure 5.4d
                                                                                                                     Typical op amp model.

In spite of their accuracy, models such as this are time consuming and tedious to
recreate. Fortunately, many manufacturers offer simulation models for their
components in library form. To use these models, all you need to do is reference the
appropriate part number from the library. The op amp models normally use typical
rather than worst-case values.

Example 5.3

         Determine the minimum acceptable funity for the circuit of Figure 5.5 if         Figure 5.5
         response should extend to at least 50 kHz.                                       Circuit for Example 5.3.

                                          Anoise=1+R f
                                                      Ri

                                          Anoise=1+20 k 500
                                          Anoise= 41

                                          f unity= Anoise f 2
                                          f unity=41×50 kHz
                                          f unity=2.05 MHz

         For this application, a stock 741 would not be fast enough; however, a 411
         would be fine. From the foregoing, it is apparent that there is a direct trade-

162
     off between circuit gain and high frequency performance for a given device.
     For an application requiring both high gain and wide bandwidth, a multi-
     stage approach should be considered.

Multi-stage Considerations

By combining two or more wide-bandwidth, low-gain stages, a single high-gain,
wide-bandwidth system may be produced. Although the overall system gain will
simply be the combination of the individual stage gains, the upper break frequency
calculation can be a little tricky. Chances are, in a multi-stage op amp design all
stages will not exhibit the same upper break frequency. In this case the system's
upper break is approximately equal to the lowest of the stage fcs. In other words, the
system is treated as though it was a discrete stage with multiple lag networks. On the
other hand, if the break frequencies are close, this approximation can lead to a
sizable error. This is best illustrated with a quick example. Imagine two stages
exhibiting a 100 kHz break. If each stage produces a 3 dB loss at 100 kHz, it is
obvious that the cascaded system must be producing a 6 dB loss at 100 kHz.
Therefore, the system's critical frequency (i.e., -3 dB point) must be somewhat
lower than 100 kHz (to be exact, it is the frequency at which each stage produces a
1.5 dB loss). Taking this a step further, if we cascade three identical stages, the total
loss at 100 kHz will be 9 dB. The system break will be the point at which each of the
three stages produces a 1 dB loss. The more identical stages that are added, the
lower the effective break becomes. If we make a few assumptions about the exact
shape of the rolloff curve, we can reduce this to a simple equation. In Chapter One,
we derived the general equation describing the amplitude response of a lead network
(1.7). In a similar vein, the response for a lag network may be determined to be

     Av=                      1     (5.2)
                                f2

                            1+ 2
                                fc

     Where f is the frequency of interest and fc is the critical frequency.

It is more convenient to write this equation in terms of a normalized frequency of
interest. Instead of being expressed in hertz, the frequency of interest is represented
as a factor relative to fc. If we call this normalized frequency kn, we may rewrite the
amplitude response equation.

     Av= 2 1                        (5.3)
     1+k n

163
We now solve for kn

                          1A = v 1+k n2

                        k n2+1 = 2 1
                                  Av

                           k n2 = 2 1 -1
                                  Av

                        kn =   2 1 -1                 (5.4)
                               Av

We will now find the gain contribution of each stage. If all stages are critical at the
same frequency, each stage must produce the same gain as the other stages at any
other frequency. Because the combined gain of all stages must, by definition, be
-3 dB or 0.707 at the system's break frequency, we may find the gain of each stage
at this new frequency.

                        Avn=0.707                     (5.5)

Where n is the number of stages involved.

We may rewrite this as

                                            1         (5.6)

                        Av =0.707 n

Combining 5.6 with 5.4 yields

                        kn= 2 1 -1
                                                 1
                           (0.707 n )

                          1                           (5.7)

                        k n= 2 n -1

As kn is nothing more than a factor, this may be rewritten into a final convenient
form.

                        f 2- system= f 2 k n

                         f 2- system= f 2        1    (5.8)

                                               2n -1

where n is the number of identical stages.

164
Example 5.4

         Assuming that all stages in Figure 5.6 use 741 op amps, what is the system
         gain and upper break frequency?

                                                                                                                     Figure 5.6
                                                                                                                     Multistage circuit for
                                                                                                                     Example 5.4.

     Stage 1:

               Av=1+R f
                        Ri

               Av=1+14k 2 k
               Av=8

               Anoise=1+R f
                           Ri

               Anoise=8

               f 2= GBW
                      Anoise

               f 2=1 MHz 8
               f 2=125kHz

165
     Stage 2:

               Av=- R f
                      Ri

               Av=-20 k 10 k
               Av =-2

               Anoise=1+R f
                           Ri

               Anoise= 3

               f 2=GBW
                     Anoise

               f 2=1 MHz 3
               f 2=333 kHz

     Stage 3:

                        Rf
               Av=1+

                        Ri
                       12 k
               Av=1+
                        4k
               Av=4

               Anoise=1+R f
                           Ri

               Anoise= 4

               f 2= GBW
                      Anoise

               f 2=1 MHz 4
               f 2=250 kHz

     System:

               Av=8×(-2)× 4
               Av =-64

     f2 = dominant stage. The dominant break here is 125 kHz (stage 1).

     The system has a gain of 64 and an upper break of 125 kHz. If this level of
     performance is to be achieved with a single op amp, it would need a gain-
     bandwidth product of 125 kHz times 64, or 8 MHz.

166
Example 5.5

         A three-stage amplifier uses identical noninverting voltage stages with gains
         of 10 each. If the op amps used have an funity of 4 MHz, what is the system
         gain and upper break?

         Because these are noninverting amplifiers, the noise gain equals the signal
         gain. The break frequency for each stage is:

                                          f 2= f unity
                                               Anoise

                                          f 2= 4 MHz 10
                                          f 2=400 kHz

         Because the three stages are identical, the system will roll off before 400
         kHz.

                                                                                                     1

                   f 2-system= f 2 2n -1

                                                                                                                 1

                   f 2-system=400 kHz 23 -1

                                          f 2-system= 203.9 kHz

         Note that the system response in this case is reduced about an octave from
         the single-stage response.

Example 5.6

         Using only LF411 op amps, design a circuit with an upper break frequency
         of 500 kHz and a gain of 26 dB.

         A gain of 26 dB translates to an ordinary gain of 20. Assuming a
         noninverting voltage stage, and noting that Anoise = Av for noninverting form,
         a single op amp would require an funity of:

                                          f unity= f 2 Av
                                          f unity=500 kHz× 20
                                          f unity=10 MHz

         Because the 411 has a typical funity of 4 MHz, at least two stages are required.

167
There are many possibilities. One option is to set one stage as the dominant
stage and set its gain to produce the desired f2. The second stage will then be
used to make up the difference in gain to the desired system gain.

Stage 1:

          f 2= f unity
                 Av

          Av = f unity
                 f2

          Av= 4 MHz 500 kHz
          Av=8

Stage 2:
To achieve a final gain of 20, stage two requires a gain of 2.5. Its f2 is:

          f 2= f unity
                 Av

          f 2= 4 MHz 2.5
          f 2=1.6 MHz

Note that if this frequency worked out to less than 500 kHz, three or more
stages would be needed. To set the resistor values, the rules of thumb
presented in Chapter Four may be used. One possible solution is shown in
Figure 5.7.

                                                                                       Figure 5.7
                                                                                       Completed design for
                                                                                       Example 5.6.

Low Frequency Limitations

As mentioned earlier, standard op amps are direct-coupled. That is, their gain
response extends down to 0 Hz. Consequently, many op amp circuits have no lower
frequency limit. They will amplify DC signals just as easily as AC signals.
Sometimes it is desirable to introduce a low frequency rolloff. Two cases of this are
single-supply biasing (Chapter Four) and interference rejection (the removal of

168
undesired signals, such as low frequency rumble). In both cases, the circuit designer
produces a low frequency rolloff (lead network) by introducing coupling capacitors.
For single-supply circuits, these capacitors are a necessary evil. Without them,
stages would quickly overload from the large DC input. Also, signal sources and
loads may be very intolerant of the DC bias potential. The result could be gross
distortion or component failure. Even if a circuit uses a normal bipolar supply, a lead
network may be used to reduce interference signals. For example, a well-chosen
coupling capacitor can reduce 60 Hz hum interference while hardly affecting the
quality of a voice transmission. Generally, these coupling capacitors can be
simplified into the straightforward lead networks discussed back in Chapter One.
(Remember, for lead networks, the highest critical frequency is the dominant one.)
Also, if multiple networks are dominant, the resulting critical frequency will be
higher than the individual break frequency. The relationship is the mirror image of
Equation 5.8. The proof for the following equation is very similar to that of Equation
5.8, and is left as an exercise.

 f 1-system=   f1      (5.9)

                1

              2n -1

If you decide to add coupling capacitors in order to reduce interference, remember       Figure 5.8
that the op amp will need a DC return resistor. An example is shown in Figure 5.8.       DC return resistor (100 k).
The 100 k resistor is needed so that the inverting input's half of the diff amp stage
is properly biased. Note that for a typical op amp, this 100 k also ends up setting
the input impedance. Assuming a relatively low source impedance, the lead network
simplification boils down to the 0.1 F capacitor along with the 100 k. The critical
frequency is:

f c= 1 2  R C
f c= 1 2 ×100 k×0.1 F
f c=15.9 Hz

To sum up, then, when using general-purpose op amps, if no signal-coupling
capacitors are being used, the gain response extends back to 0 Hz. If coupling
capacitors are used, general lead network analysis techniques can be used to find the
critical frequencies.

5.4 Slew Rate and Power Bandwidth

As noted in the previous section, general-purpose op amps contain a compensation
capacitor that is used to control the open loop frequency response. The signal
developed across this capacitor will be amplified in order to create the final output
signal. In essence, this capacitor serves as the load for the preceding stage inside of

169
the op amp. Like all stages, this one has a finite current output capability. Due to
this, the compensation capacitor can be charged no faster than a rate determined by
the standard capacitor charge equation:

                                i=C dvdt
                                dv =i
                                dt C

The rate of change of voltage versus time is dv/dt. By definition, this parameter is
called slew rate (SR). The base unit for slew rate is volts per second, however, given
the speed of typical devices, slew rate is normally specified in volts per
microsecond. Slew rate is very important in that it helps determine whether or not a
circuit can accurately amplify high-frequency or pulse-type waveforms. In order to
create a fast op amp, either the charging current i must be large, or the compensation
capacitor C must be very small. Because C also plays a role in determining the gain-
bandwidth product, there is a lower limit to its size. A typical op amp might use a 30
pF compensation capacitor, and the driving stage may effectively produce a
charging current of 100 A. The resulting slew rate would be:

                                SR=dvdt =iC
                                SR=100 A

                                       30 pF
                                SR=3.33 Megavolts/second
                                SR=3.33 V/ s

This means that the output of the op amp can change no faster than 3.33 V over the
course of one microsecond. It would take this op amp about 3 microseconds for its
output signal to change a total of 10 V. It can go no faster than this. The ideal op
amp would have an infinite slew rate. Although this is a practical impossibility, it is
possible to find special high-speed devices that exhibit slew rates in the range of
several thousand volts per microsecond. Comparative slew rates for a few selected
devices are found in Table 5.1.

      Device  Slew Rate
      uA741    0.5 V/s
      LF411    15 V/s
     OPA134    20 V/s
     LM318     70 V/s
     LM6364   300 V/s
     LT1363   1000 V/s

     Table 5.1

170
Slew rate is always output-referred. This way, the circuit gain need not be taken into
account. Slew rate is normally the same regardless of whether the signal is positive
or negative going. There are a few devices that exhibit an asymmetrical slew rate.
One example is the 3900. It has a slew rate of 0.5 V/s for positive swings, but
shows 20 V/s for negative swings.

The Effect of Slew Rate on Pulse Signals

An ideal pulse waveform will shift from one level to the other instantaneously, as
shown in Figure 5.9.

     2 V                                                                                      Figure 5.9

                                                                                              Ideal output.

                        10 s  20 s          t

In reality, the rising and falling edges are limited by the slew rate. If this signal is fed
into a 741 op amp, the output pulse would be decidedly trapezoidal, as shown in
Figure 5.10. The 741 has a slew rate of 0.5 V/s. Because the voltage change is 2 V,
it takes the 741 4 s to traverse from low to high, or from high to low. The resulting
waveform is still recognizable as a pulse, however.

     2 V                                                                                      Figure 5.10
                .5 V/s                                                                        Slewed output of the 741.

                                    .5 V/s

          10 s 14 s           20 s 24 s t

Gross distortion of the pulse occurs if the pulse width is decreased, as in Figure 5.11.
Here, the pulse width is only 3 microseconds, so the 741 doesn't even have enough
time to reach the high level. In 3 microseconds, the 741 can only change 1.5 V. By
the time the 741 gets to 1.5 V, the input signal is already swinging low, so the 741
attempts to track it. The result is a triangular waveform of reduced amplitude as
shown in Figure 5.12. This same effect can occur if the amplitude of the pulse is
increased. Obviously, then, pulses that are both fast and large require high slew rate
devices. Note that a 411 op amp would produce a nice output in this example.
Because its slew rate is 15 V/s, it requires only 0.134 microseconds for the 2 V
output swing. Its output waveform is shown in Figure 5.13.

171
2 V                                                                                         Figure 5.11
                                                                                            Ideal output.
            3 s        6 s  t
                                                                                            Figure 5.12
  2 V                                                                                       Slewed output of the 741.
1.5 V
                                                                                            Figure 5.13
       3 s       6 s   9 s  t                                                               Slewed output of the 411.

2 V

       3 s                    6.134 s t
              3.134 s
                       6 s

The Effect of Slew Rate on Sinusoidal Signals and Power Bandwidth

Slew rate limiting produces an obvious effect on pulse signals. Slew rate limiting
can also affect sinusoidal signals. All that is required for slewing to take place is that
the signal change faster than the device's slew rate. If the rate of change of the signal
is never greater than the slew rate, slewing will never occur. To find out just how
fast a given sine wave does change, we need to find the first derivative with respect
to time. Assume that the input sine wave has a frequency f, and a peak amplitude K.

                                v (t )= K sin 2  f t
                                dvdt =2  f K cos2  f t

172
The rate of change of the signal with respect to time is dv/dt. The maximum rate of
change will occur when the sine wave passes through zero (i.e., at t = 0). To find this
maximum value, substitute 0 in for t, and solve the equation.

dvdt =2  f K                       (5.10)

So, the rate of change of the signal is directly proportional to the signal's frequency
(f), and its amplitude (K). From this, it is apparent that high-amplitude, high-
frequency signals require high slew rate op amps in order to prevent slewing. We
can rewrite our equation in a more convenient form:

Slew Rate required=2 V p f max     (5.11)

where Vp is the peak voltage swing required and fmax is the highest frequency sine
wave reproduced. Often, it is desirable to know just how "fast" a given op amp is. A
further rearranging yields

f max= Slew Rate
         2V p

In this case, fmax represents the highest frequency sine wave that the op amp can
reproduce without producing Slewing Induced Distortion (SID). This frequency is
commonly referred to as the power bandwidth. To be on the conservative side, set
Vp to the op amp's clipping level. Note that slew rate calculations are not dependent
on either the circuit gain or small-signal bandwidth. Power bandwidth and small-
signal bandwidth (f2) are not the same thing. This is a very important point!

                                                                                         Figure 5.14
                                                                                         Sine wave distorted by heavy
                                                                                         slewing.

           slewed

                                t

ideal

The effects of slewing can be either subtle or dramatic. Small amounts of SID are
very difficult to see directly on an oscilloscope and require the use of a distortion
analyzer or a spectrum analyzer for verification. Heavy slewing will turn a sine
wave into a triangular wave. An example of this is shown in Figure 5.14.

173
Example 5.7

         A 741 is used as part of a motor control system. If the highest reproducible
         frequency is 3 kHz and the maximum output level is 12 V peak, does
         slewing ever occur?

         Another way of stating the problem is to ask "Is the 741's power bandwidth
         at least 3 kHz?"

                                          f max= Slew Rate
                                                    2V p

                                          f max= 0.5 V/  s 2 ×12 V
                                          f max= 0.5 MV/s ×24 V
                                          f max=6631 Hz

         For this application, the 741 is twice as fast as it needs to be. Note in the
         calculation how the slew rate is transferred from V/s into V/s, and how the
         volts units cancel between denominator and numerator. This leaves units of
         "1/seconds", which is another way of saying "hertz". If the calculation
         produced a smaller value, say 2 kHz, then slewing is a possibility for certain
         signals.

Example 5.8

         An audio pre-amplifier needs to reproduce signals as high as 20 kHz. The
         maximum output swing is 10 V peak. What is the minimum acceptable slew
         rate for the op amp used?

            Slew Rate=2  V p f max
            Slew Rate=2 ×10 V×20kHz
            Slew Rate=1.257 MV/s
            Slew Rate=1.257 V/ s

         For this design, a 741 would not be fast enough. The aforementioned 411
         through 318 would certainly be satisfactory, whereas the 1363 would
         probably be overkill.

174
Computer Simulation

To verify the results of Example 5.8, a simple noninverting voltage amplifier may be
used with differing op amp models. The simulation is shown Figure 5.15 using
Multisim.

                                                                                                                     Figure 5.15a
                                                                                                                     Multisim schematic for slew
                                                                                                                     simulation.

The circuit is configured with a 2 volt input at 20 kHz and a gain of 5. This will
yield the worst case output of 10 volts at 20 kHz. For the first Transient Analysis, a
741 is used. Note how the output waveform is essentially triangular. It is also below
the expected peak output level. Clearly, this waveform is severely slewed, and
results in undesired distortion and a reduction in audio quality.

                                                                                                                     Figure 5.15b
                                                                                                                     Output with 741.

175
The second simulation is performed using the faster LF411. In this case, the
simulation shows a full 10 volt peak output with no discernable distortion. The
LF411 would certainly meet the circuit requirements.

                                                                                         Figure 5.15c
                                                                                         Output with LF411.

Design Hint

There is a convenient way of graphically determining whether the output of an op

amp will be distorted. It involves graphing output levels versus frequency. The two

major distortion causes are clipping and slewing. We start with a grid measuring

frequency on the horizontal axis, and output voltage on the vertical axis. The first

step involves plotting the output level limit imposed by clipping. Clipping is

dependent on the circuit's power supply and is independent of frequency. Therefore,

a horizontal line is drawn across the graph at the clipping level (see Figure 5.16). If  Figure 5.16
we assume a standard ±15 V power supply, this level will be around ±13 V. The            Limit due to clipping.
output level cannot swing above this line because clipping will be the result.

Everything below this line represents unclipped signals. The second step is to plot

the slewing line. To do this, a point needs to be calculated for fmax. In Example 5.7    clipped
a 741 was used and 12 V produced an fmax of 6631 Hz. Plot this point on the graph. 13 V

Now, as the slew rate is directly proportional to fmax and Vp, it follows that doubling  nonclipped

fmax while halving Vp results in the same slew rate. This new point lets you

graphically determine the slope of the slew limiting line. Plot this new point and                               f

connect the two points with a straight line (see Figure 5.17). Everything above this

line represents slewed signals, and everything below this line represents non-slewed

signals. As long as the desired output signal falls within the lower intersection area

of the two lines, the signal will not experience either slewing or clipping. A quick

glance at the graph allows you to tell what forms of distortion may affect a given

signal.

176
                      clipped  slewed                                                      Figure 5.17
                                                                                           Limits due to clipping and
13 V                                                                                       slewing.
12 V

                   safe

 6 V

6631 Hz                        13262 Hz  f

Slew Rate and Multiple Stages

Consider the three-stage circuit shown in Figure 5.18. The slew rates for each device
are found in Table 5.1. What is the effective slew rate of the system? You might
think that it is set by the slowest device (741 at 0.5 V/s), or perhaps by the final
device (318 at 70 V/s). The fact is that the system slew rate could be set by any of
the devices, and it depends on the gains of the stages.

                                                                                           Figure 5.18
                                                                                           Multistage circuit
                                                                                           incorporating the 741, 411 and
                                                                                           318.

The one thing that you can say immediately is that the system slew rate will never be
faster than the final device. In this example, the slew rate cannot be greater than 70
V/s. It may be less than this, however. The trick to finding the effective system
slew rate is to start at the output of the first stage, and then determine the maximum
rate of change for the following stages in sequence. Looking at stage 1, its
maximum output rate is 0.5 V/s. This is the maximum rate of change going into
stage 2. Because stage 2 has a gain of 32, it will attempt to increase this rate to 16
V/s. This cannot happen, however, because the 411 has a slew rate of only 15 V/s.
Therefore the 411 is the limiting factor at this point. The maximum rate of change
out of stage 2 is 15 V/s. This signal is then applied to stage 3, which has a gain of
3. So, the 318 triples its input signal to 45 V/s. Because the 318 is capable of
changing as fast as 70 V/s, 45 V/s becomes the limiting output factor. The system
slew rate is 45 V/s. This is the value used to calculate the system power bandwidth,
if needed. The first op amp to slew in this circuit is the 411, even though it is about
30 times faster than the 741 used in stage 1. The reason for this is that it must handle
signals 32 times as large. Note that if the final stage had a larger gain, say 5, the 318
would become the limiting factor. The important thing to remember is that the front-

177
end stages of a system don't need to be as fast as the final stages, as they handle
smaller signals.

Noncompensated Devices

As discussed in Chapter Three, all op amps need some form of frequency
compensation in order to ensure that their closed loop response is stable. The most
straightforward way to do this is to add a compensation capacitor, which forces a 20
dB/decade rolloff to funity. In this way, no matter what gain you choose, the circuit
will be stable. Although this is very convenient, it is not the most efficient form of
compensation for every circuit. High-gain circuits need less compensation
capacitance than a low-gain circuit does. The advantage of using a smaller
compensation capacitor is that slew rate is increased. Also, available loop gain at
higher frequencies is increased. This allows the resulting circuit to have a wider
small-signal bandwidth (the effect is as if funity increased). Therefore, if you are
designing a high gain circuit, you are not producing the maximum slew rate and
small-signal bandwidth that you might. The compensation capacitor is large enough
to achieve unity gain stability, but your circuit is a high-gain design. The bottom line
is that you are "paying" for unity gain stability with slew rate and bandwidth.

To get around this, manufacturers offer noncompensated op amps. No internal               Figure 5.19
capacitor is used. Instead, connections are brought out to the IC package so that you     Bode gain plots for the 301.
may add your own capacitor. This way, the op amp may be tailored to your
application. There is no set way of determining the values for the external               Reprinted courtesy of Texas
compensation circuit (it may be more complex than a single capacitor).                    Instrutments
Compensation details are given on manufacturers data sheets. One example of a
noncompensated op amp is the 301. You can think of a 301 as a 741 without a
compensation capacitor. If a 33 pF compensation capacitor is used, the 301 will be
unity gain stable and produce an funity of 1 MHz and a slew rate of 0.5 V/s. For
higher gains, a smaller capacitor may be used. A 10 pF unit will produce an
effective funity of 3 MHz, and a slew rate of 1.5 V/s. Comparative Bode gain plots
are shown in Figure 5.19 for the 301.

Feedforward Compensation

Besides the ordinary form of compensation, noncompensated devices like the 301
may utilize other methods that can make them even faster, such as feedforward
compensation. The concept of feedforward is in direct contrast to feedback. As its
name suggests, feedforward involves adding a portion of the input signal to the

178
output, thus bypassing certain sections of the system. Compared to ordinary
feedback, feedforward is seldom used as part of the design of an amplifier.7

Ordinarily, a compensation capacitor must be large enough to maintain sufficient
gain and phase margin for the slowest stage inside of an op amp. Quite often, the
slowest stage in an op amp is one of the first stages, such as a level shifter. Here is
where feedforward comes into play. If the high frequency content of the input signal
can be shunted around this slow stage, the effective bandwidth and speed of the op
amp may be increased. This is the key behind the technique of feedforward
compensation. Normally, manufacturers will provide details of specific feedforward
realizations for their op amps. (It would be very difficult to create successful
feedforward designs without detailed knowledge of the internal design of the
specific op amp being used.) Not all op amps lend themselves to feedforward
techniques.

In summary, noncompensated op amps require a bit more work to configure than
fully compensated devices, but offer higher performance. This means faster slew
rates and higher-upper break frequencies.

Decompensated Devices                                                                    Figure 5.20
                                                                                         Bode gain plot for the 5534.
Straddling the worlds of compensated and uncompensated op amps is the
decompensated device. Decompensated devices are also known as partially                  Reprinted courtesy of Philips
compensated devices. They include some compensation capacitance, but not enough          Semiconductors
to make them unity gain stable. Usually these devices are stable for gains above 3 to
5. Because the majority of applications require gains in this area or above,
decompensated devices offer the ease of use of compensated devices and the
increased performance of customized noncompensated units. If required, extra
capacitance can usually be added to make the circuit unity gain stable. One
example of this type is the 5534. Its gain Bode plot is shown in Figure 5.20. Note
how the addition of an extra 22 pF reduces the open loop gain. This 22 pF is
enough to make the device unity gain stable. It also has a dramatic effect on the
slew rate, as seen in the 5534's spec sheet. Without the 22 pF capacitor, the slew
rate is 13 V/s, but with it, the slew rate drops to 6 V/s. The performance that
you give up in order to achieve unity gain stability is obvious here.

There is one more interesting item to note about the 5534. A close look at the
Bode gain curve shows a hump in the rolloff region. Some other devices, such as the
318, exhibit this hump too. This is a nice extra. In essence, the manufacturer has
been able to achieve a slightly higher open loop gain than a normal device would

7 It can offer similar advantages though, such as a reduction in distortion. Also,
    feedforward and feedback techniques may be combined in order to achieve
    complementary increases in performance. For an example, see M.J.Hawksford,
    "Reduction of Transistor Slope Impedance Dependent Distortion in Large Signal
    Amplifiers",Journal of the Audio Engineering Society, Vol.36 No.4 (1988): 213-222

179
allow. This means that your circuits will have higher loop gains, and therefore, the
nice effects of negative feedback will remain active to higher frequencies. This also
means that very high gain circuits will be able to achieve a higher f2 than is predicted
by the gain-bandwidth calculation.

5.5 Offsets

Offsets are undesirable DC levels appearing at the output of a circuit. If op amps
were perfect, there would be no such thing as an offset. Even though part matching
is very close when ICs are made, the parts will not be identical. One possible
example is the fact that the transistors used for the differential amplifier stage will
not have identical characteristics. Because of this, their DC bias points are slightly
different. This difference, or unbalance, is amplified by the remaining stages and
will eventually produce a DC voltage at the output. Because all op amps are slightly
different, you never know what the exact output offset will be. For measurement
applications, this offset creates uncertainty in readings. For example, if the circuit
output measures 100 mV, the signal might be 99 mV with 1 mV of offset. It might
also be 101 mV with -1mV offset. In other applications, offsets can harm following
stages or loads. Dynamic loudspeakers and headphones are two loads that should not
be fed DC signals. This will reduce their maximum volume and increase their
distortion. In short, offsets are not desired. Let's see what the causes are and how we
can reduce or eliminate their effect.

Offset Sources and Compensation

For bipolar input sections the major cause of input current mismatch is the variation
of beta. Base-emitter junction voltage variation is the major cause of input voltage
deviation. For field effect devices, current variation is much less of a problem as the
magnitude of input current is very low to begin with. Unfortunately, FETs do suffer
from larger input voltage variations due to transconductance curve mismatches.

As mentioned in Chapter Two, the input current into the bases (or gates, in the case
of an FET) of the first stage is called IB, the input bias current. In reality, this is an
average of the two input currents, IB+ and IB-. The magnitude of their difference is
called the input offset current, IOS (some manufacturers use the symbol IIO). Note that
the actual direction of IB is normally not specified, but can usually be determined
from the manufacturer's circuit diagram. IB flows into the op amp if the input devices
are NPN, and out of the op amp if the input devices are PNP.

     I B= I B ++I B - 2          (5.12)
     I OS=| I B +- I B -|

180
The voltage difference for the input stage is referred to as the input offset voltage,
VOS (some manufacturers use the symbol VIO). This is the potential required between
the two inputs to null the output, that is, to re-align the output to 0 VDC. Both IOS and
VOS are available on data sheets. The absolute magnitude of these offsets generally
gets worse at temperature extremes. Table 5.2 shows some typical values. Note the
low IB and IOS values for the FET input 411.

     Device     IB     IOS                    VOS
      5534   800 nA  10 nA                 0.5 mV
       411   50 pA   25 pA                 0.8 mV
       318   150 nA  30 nA                  4 mV
       741   80 nA   20 nA                  1 mV

             Table 5.2

Remember, these numbers are absolutes, so when IOS is specified as 10 nA, it means
that the actual IOS can be anywhere between -10 nA and +10 nA. IB, IOS and VOS
combine with other circuit elements to produce an output offset voltage. As this is a
linear circuit, superposition may be used to separately calculate their effects. The
model in Figure 5.21 will be used. Ri and Rf are the standard feedback components,
and Roff is called the offset compensation resistor (in some cases it may be zero).
Because the input signal is grounded, this model is valid for both inverting and
noninverting amplifiers.

                                                                                           Figure 5.21
                                                                                           Offset model.

VOS is seen as a small input voltage and is multiplied by the circuit's noise gain in
order to find its contribution to the output offset. Offsets are by nature DC, so it is
important to use the DC noise gain. Consequently, any capacitors found within the
feedback loop should be mathematically "opened" for this calculation (for example,
when working with the filter circuits presented in Chapter Eleven).

             V out-offset 1= A noise V OS          (5.13)

181
where

                         Anoise=1+R f = Ri +R f
                         Ri                         Ri

IB and IOS pass through input and feedback resistors to produce their output
contributions. First, consider the effect of IB+. This creates a voltage across Roff. This
voltage is then multiplied by the circuit noise gain to yield its portion of the output
offset.

                         V out - offset 2= I B + R off Anoise                         (5.14)

For IB-, recall that the inverting input is at virtual ground. This implies that the
voltage across Ri must be zero, and therefore, the current through Ri must be zero.
Consequently, all of IB- flows through Rf. This creates a relative negative potential at
the output.

                         V out - offset 3=- I B - R f                                 (5.15)

So the combination of the input bias current effects is:

                         V out - offset (I B)=| I B + R off Anoise- I B- R f |        (5.16)

Expanding this produces

                         V out - offset(I B)= I B+ Roff Ri +R f R - I B - R f i

                         ( ) V out -offset(I B)= I B + Roff Ri+R f R -I B- R f i R f

By noting the product-sum rule for resistor combination Ri, Rf, this can be further
simplified to

                         ( ) V out -offset(I B)= I B+ Roff R - I B - R f i || R f     (5.17)

If Roff is set to equal Ri || Rf, this reduces to:

                         V out - offset(I B)=(I B+- I B - ) R f

By definition,

                         I OS=| I B +- I B -|

182
so we finally come to

                          V out-offset ( I B)= I OS R f       (5.18)

If it is possible, Roff should be set to Ri || Rf. This drastically reduces the effect of the
input bias current. Note that the value of Roff includes the driving source internal
resistance. If Ri || Rf= 2 k and the driving source resistance is 100 , the required
resistance value would be 1.9 k. If setting Roff to the optimum value is not possible,
you can at least reduce the effect of IB by using a partial value. Also, note that it is
possible to determine the polarity of the offset caused by IB+ and IB- (Equation 5.17)
if actual currents and the type of device used in the diff amp stage are known. The
circuit of Figure 5.21 assumes that NPN devices are being used, hence the currents
are drawn as entering the op amp. PNP input devices would produce the opposite
polarity. Typically, though, we don't have precise values for IB+ and IB-, and thus can
only compute the worst-case magnitude.

For a final result, we may combine our components:

                          V out-offset =V OS Anoise+I OS R f  (5.19)

if Roff = Ri || Rf , and

                          V out-offset=V OS Anoise+| I B+ Roff Anoise - I B- R f | (5.20)

if Roff  Ri || Rf.

There is one special case involving the selection of Roff, and that deals with a voltage       Figure 5.22
follower. Normally for a follower, Rf = 0 . What if the driving source resistance is           Offset compensation for a
perhaps 0 ? The calculation would require an Roff of 0 , and thus a -50  resistor              follower.
to compensate for the source resistance. This is of course, impossible! To
compensate for the 50  source, use 50  for Rf. The circuit gain will still be unity,
but IB will now be compensated for. This is shown in Figure 5.22.

Example 5.9

     Determine the typical output offset voltage for the circuit of Figure 5.23 if
     Roff is 0 . Then determine an optimum size for Roff and calculate the new
     offset.

     From the data sheet for the 5534, we find VOS = 0.5 mV, IOS = 10 nA, and
     IB = 800 nA. Because this is an approximation, assume IB+ = IB- = IB.

183
     Anoise=1+R f                                                                      Figure 5.23
                  Ri                                                                   Circuit for Example 5.9.

     Anoise=1+10 k 1 k
     Anoise=11

       V out - offset=V OS Anoise+| I B + Roff Anoise- I B - R f |
       V out -offset=0.5 mV×11+|800 nA×0×11-800 n A×10 k |
       V out -offset=5.5 mV+8 mV
       V out -offset=13.5 mV

     Remember, this is the magnitude of the offset, it could be anywhere within
     ±13.5 mV. It might be worse if this is not a typical device. Now we find the
     optimum offset compensating resistor:

                                     Roff = Ri || R f
                                     Roff =1 k ||10 k
                                     Roff =909

     For this case, the offset equation reduces to

                                     V out-offset =V OS Anoise+I OS R f
                                     V out-offset=0.5 mV×11+10 nA×10 k
                                     V out-offset=5.5 mV+100 V
                                     V out-offset=5.6 mV

     By adding Roff, the output offset voltage is more than halved. This may lead
     you to think that it is always wise to add Roff. Such is not the case. There are
     two times when you may prefer to leave it out: 1) to optimize noise
     characteristics, as we will see shortly, and 2) when using FET input op amps.
     FET input devices have very small input bias and offset currents to begin
     with, so their effect is negligible when using typical resistor values.

Example 5.10

         The circuit of Figure 5.24 is used as part of a measurement system.
         Assuming that the DC input signal is 3 mV, how much uncertainty is there in
         the output voltage typically?

184
     The desired output from the amplifier is                                            Figure 5.24
                                                                                         Circuit for Example 5.10.
                                     V out= Av V i n
                                     V out=- R f V i n

                                               Ri
                                     V out=- 20 k 5 k ×3 mV
                                     V out=-12 mV

     The typical specs for the 411 are VOS = 0.8 mV, IOS= 25 pA, IB = 50 pA

                                     Anoise=1+R f
                                                  Ri

                                     Anoise=1+20 k 5 k
                                     Anoise=5

       V out - offset=V OS Anoise+| I B + Roff Anoise- I B - R f |
       V out -offset=0.8 mV×5+| 50 pA×0×11-50 pA×20 k |
       V out -offset=4 mV+1  V
       V out -offset=4 mV

     The output can vary by as much as ±4 mV. As this a DC measurement
     system, the results are devastating. The output can be anywhere from
     -12 mV - 4 mV = -16 mV, to -12 mV + 4 mV = -8 mV. That's a 2:1
     spread, and it's caused solely by the op amp. Note that the addition of Roff
     would have little effect here. Because the 411 uses a FET input, its IB
     contribution is only 1 V.

So, then, how do you keep output offsets to a minimum? First and foremost, make          Figure 5.25
sure that the op amp chosen has low IOS and VOS ratings. Second, use the offset          A typical nulling connection.
compensation resistor, Roff. Third, keep the circuit resistances as low as possible.
Finally, if the output offset is still too large, it can be reduced by manually nulling
the circuit.

Nulling involves summing in a small signal that is of opposite polarity to the
existing offset. By doing this, the new signal will completely cancel the offset and
the output will show 0 V DC. This is much easier than it sounds. Most op amps have
connections for null circuits. These are specified by the manufacturer and usually
consist of a single potentiometer and perhaps one or two resistors. An example
nulling connection is shown in Figure 5.25. Usually the potentiometer is a multi-turn
trim type to allow for fine adjustment. To null the circuit, the technician monitors
the output with a very sensitive DC voltmeter. The input is grounded (or perhaps tied

185
to ground through a resistor equal to the driving source resistance if it's large). The
potentiometer is then adjusted until the meter reads zero.
The drawback to this procedure is that it requires someone (or perhaps some thing)
to perform the nulling. Also, the unit will require periodic adjustment to compensate
for aging and environmental effects.

Computer Simulation

As stated, it is very important to match the input resistors in order to keep offsets
low. This can be seen clearly in the simulation shown in Figure 5.26. A noninverting
voltage amplifier is modeled here using the 741. In order to focus on the offset
current effect, the contribution of VOS is kept small by keeping the voltage gain low.
The simulation is run twice for DC Operating Point. In the case where the
resistances are matched, the DC output voltage is less than 1 mV. For the unmatched
case, Roff is set to a fraction of an ohm. The resulting DC output voltage is much
larger at approximately 17 mV. It is worthy to note that this is approximately equal
to Ibias times Rf (80 nA times 200 k). This simulation also points out the poor
performance caused by excessively large resistor values. If the simulation is re-run
with the resistors scaled down in size, the offsets will be lessened.

                                                                                                                 Figure 5.26a
                                                                                                                 Multisim schematic for offset
                                                                                                                 simulation.

                                                                                                                 Figure 5.26b
                                                                                                                 Results with offset resistor.

186
                                                                                         Figure 5.26c
                                                                                         Results without offset resistor.

5.6 Drift

Drift is a variation in the output offset voltage. Often, it is temperature induced.
Even if a circuit has been manually nulled, an output offset can be produced if the
temperature changes. This is because VOS and IOS are temperature sensitive. The only
way around this is to keep the circuit in a constant temperature environment. This
can be very costly. If the drift can be kept within an acceptable range, the added cost
of cooling and heating equipment may be removed. As you might expect, the
magnitude of the drift depends on the size of the temperature change. It also depends
on the IOS and VOS sensitivities. These items are VOS/T, the change in VOS with
respect to temperature, and IOS/T, the change in IOS with respect to temperature.
Drift rates are specified in terms of change per Celsius degree. These parameters are
usually specified as worst-case values and can produce either a positive or negative
potential.

The development of the drift equation pretty much follows that of the equation for
offsets. The only difference is that offset parameters are replaced by their
temperature coefficients and the temperature change. The products of the
coefficients and the change in temperature produce an input offset voltage and
current.

           V drift= V OS T T Anoise + IOS T T R f  (5.21)

As with the offset calculation, the drift result may be either positive or negative.
Also, because IOS is so small for FET input devices, IOS/T is often not listed, as it
is almost always small enough to ignore. For lowest drift, it is assumed that the op
amp uses the offset compensation resistor Roff, and that the circuit has been nulled.

187
Example 5.11

     Determine the output drift for the circuit of Figure 5.23 for a target
     temperature of 80°C. Assume that Roff = 909  and that the circuit has been
     nulled at 25°C.

     The parameters for the 5534 are VOS/T = 5 V/C°, IOS/T = 200 pA/C°.

     The noise gain was already determined to be 11 in Example 5.9. The total
     temperature change is from 25°C to 80°C, or 55C°.

              V drift=  V OS  T Anoise + I OS  T R f

                        T                 T

              V drift=5  V/C°×55C°×11+200 pA/C°×55C°×10 k

              V drift=3.025 mV +.11 mV

              V drift=3.135 mV

     Note that for this circuit the VOS drift is the major source of error. At 80°C,
     the output of the circuit may have up to ±3.135 mV of DC error.

As with offsets, drift is partially a function of the circuit gain. Therefore high gain
circuits often appear to have excessive drift. In order to compare different
amplifiers, input referred drift is often used. To find input referred drift, just divide
the output drift by the signal gain of the amplifier. Don't use the noise gain! In this
way, both inverting and noninverting amplifiers can be compared on an equal
footing. For the circuit just examined, the input referred drift is

                                V drift (input )= V drift
                                               Av

                                V drift (input)= 3.135 mV 11
                                V drift (input)=285  V

For many applications, particularly those primarily concerned with AC performance,
drift specification is not very important. A communications amplifier, for example,
might use an output coupling capacitor to block any drift or offset from reaching the
output if it had to. Drift is usually important for applications involving DC or very
low frequencies where coupling capacitors are not practical.

188
5.7 CMRR and PSRR

CMRR stands for Common Mode Rejection Ratio. It is a measure of how well the
two halves of the input differential amplifier stage are matched. A common-mode
signal is a signal that is present on both inputs of the diff amp. Ideally, a differential
amplifier completely suppresses or rejects common-mode signals. Common-mode
signals should not appear at the circuit output. Due to the non-perfect matching of
transistors, some portion of the common-mode signal will make it to the output.
Exactly how much this signal is reduced relative to desired signals is measured by
the CMRR.

Ideally, CMRR is infinite. A typical value for CMRR would be 100 dB. In other
words, if an op amp had both desired (i.e., differential) and common-mode signals at
its input that were the same size, the common-mode signal would be 100 dB smaller
than the desired signal at the output.

CMRR is particularly important when using the op amp in differential mode (Chapter
Four) or when making an instrumentation amplifier (Chapter Six). There are two
broad uses for these circuits. First, the amplifier may be receiving a low level,
balanced signal over a considerable distance.8 Good examples of this are a
microphone cable in a recording studio and an instrumentation cable on a factory
floor. Interference signals tend to be induced into the cable in-phase (i.e., common-
mode). Because the desired signal is presented out-of-phase (i.e., differential), a high
CMRR will effectively remove the interference signal. Second, the op amp may be
used as part of a bridge-type measurement system. Here, the desired signal is seen as
a small variation between two DC potentials. The op amp must amplify the
difference signal, but suppress the DC outputs of the bridge circuit.

Example 5.12

         An amplifier has a closed loop voltage gain of 20 dB and a CMRR of 90 dB.
         If a common-mode signal is applied to the input at -60 dBV, what is the
         output?

         If the input signal were differential instead of common-mode, the output
         would be:

                                         V out '= Av ' +V in '
                                         V out '= 20dB+(-60 dBV)
                                         V out '=-40 dBV

8 A balanced system uses two signal-carrying conductors and a shield (ground). The two
    signals are the reference, or in-phase signal, and the inverted, or out-of-phase signal.

189
         Because this is a common-mode signal, it is reduced by the CMRR

                                         V out '=-40 dBV-90 dB
                                         V out '=-130 dBV

         This signal is so small that it is probably overshadowed by the circuit noise.

One final note concerning CMRR is that it is specified for DC. In truth, CMRR is
frequency dependent. The shape of its curve is reminiscent of the open loop gain
curve. The stated CMRR may remain at its DC level up to perhaps 100 or 1000 Hz,
and then fall off as frequency increases. For example, the 741 data sheet found in the
Appendix states a typical CMRR of 90 dB. By looking at the CMRR graph, though,
you can see that it starts to roll off noticeably around 1 kHz. By the time it hits 1
MHz, only 20 dB of rejection remains. A more gentle rolloff is exhibited by the 411.
At 1 MHz, almost 60 dB of rejection remains. What this means is that the op amp
cannot suppress high frequency interference signals as well as it suppresses low
frequency interference.

Similar to CMRR is PSRR, or Power Supply Rejection Ratio. Ideally, all ripple, hum,
and noise from the power supply will be prevented from reaching the output of the
op amp. PSRR is a measure of exactly how well the op amp reaches this ideal.
Typical values for PSRR are in the 100 dB range. Like CMRR, PSRR is frequency-
dependent and shows a rolloff as frequency increases. If an op amp is powered by a
60 Hz source, the ripple frequency from a standard full-wave rectifier will be 120
Hz. At the output, this ripple will be reduced by the PSRR. Higher frequency noise
components on the power supply line are not reduced as much because PSRR rolls
off. Normally, PSRR is consistent between power rails. Sometimes, there is a marked
performance difference between the positive and negative PSRR. One good example
of this is the 411. The positive rail exhibits about a 30 dB improvement over the
negative rail. Note that PSRR is only a few decibels for the negative rail by the time
it reaches 1 MHz.

Example 5.13

         An op amp is operated off a power supply that has a peak to peak ripple
         voltage of 0.5 V. If the op amp's PSRR is 86 dB, how much of this ripple is
         seen at the circuit output?

190
         First, determine the PSRR as an ordinary value.

                                                       -1 PSRR
                                          PSRR= log10

                                                            20
                                          PSRR=log 10 -1 86 dB 20
                                          PSRR= 20,000

         Divide the ripple voltage by the PSRR to find the amount that is seen at the
         output.

                                         V out - ripple =V ripple PSRR
                                         V out -ripple=0.5 Vpp 20,000
                                         V out -ripple=25  Vpp

5.8 Noise

Generally speaking, noise refers to undesired output signals. The background hiss
found on audio tape is a good example of noise. If noise levels get too high, the
desired signals are lost. We will narrow our definition down a bit by only
considering noise signals that are created by the op amp circuit. Noise comes from a
variety of places. First of all, all resistors have thermal, or Johnson noise. This is due
to the random effects that thermal energy produces on the electrons. Thermal noise
is also called white noise, because it is equally distributed across the frequency
spectrum. Semiconductors exhibit other forms of noise. Shot noise is caused by the
fact the charges move as discrete particles (electrons). It is also white. Popcorn
noise is dominant at lower frequencies and is caused by manufacturing
imperfections. Finally, flicker noise has a 1/f spectral density. This means that it
increases as the frequency drops. It is sometimes referred to as 1/f noise.

Any op amp circuit exhibits noise from all of these sources. Because we are not
designing the op amps, we don't really need to distinguish the exact sources of the
noise, rather, we'd just like to find out how much total noise arrives at the output.
This will allow us to determine the signal-to-noise ratio (S/N) of the circuit, or how
quiet the amplifier is.

If noise performance for a particular design is not paramount, it can be quickly
estimated from manufacturer's data sheets. Some manufacturers will specify RMS
noise voltages for specified signal bandwidths and source impedances. A typical plot
is found in Figure 5.27. To use this, simply find the source impedance of your circuit
on the horizontal axis, and by using the appropriate signal bandwidth curve, find the

191
noise voltage on the vertical axis. This noise voltage is input-referred. In order to
find the output noise voltage, multiply this number by the noise gain of the circuit.
The result will not be exact, but it will put you in the ballpark.

     En                                                                                     Figure 5.27
                   10 Hz to 20 kHz                                                          Noise voltage for given
                                                                                            bandwidth versus source
                                                                                            resistance.

     1 V                            200 Hz to 4 kHz
     .1 V

                                      102 103 104 Rs

A more exact approach involves the use of two op amp parameters, input noise
voltage density, vind, and input noise current density, iind. Nanovolts per root hertz are
used to specify vind. Picoamps per root hertz are used to specify iind. Refer to the 5534
data sheet for example specifications. (Some manufacturer's square these values and
give units of volts squared per hertz and amps squared per hertz. To translate to the
more common form, just take the square root of the values given. The data sheet for
the 741 is typical of this form). These two parameters take into account noise from
all internal sources. As a result, these parameters are frequency-dependent. Due to
the flicker noise component, the curves tend to be rather flat at higher frequencies
and then suddenly start to increase at lower frequencies. The point at which the
graphs start to rise is called the noise corner frequency. Generally, the lower this
frequency, the better.

In order to find the output noise we will combine the noise from three sources:

    1. vind
    2. iind
    3. The thermal noise of the input and feedback resistors

Before we start, there are a few points to note. First, the strength of the noise is
dependent on the noise bandwidth of the circuit. For general-purpose circuits with
20 dB/decade rolloffs, the noise-bandwidth, BWnoise, is 1.57 times larger than the
small-signal bandwidth. It is larger because some noise still exists in the rolloff
region. The noise-bandwidth would only equal the small-signal bandwidth if the
rolloff rate were infinitely fast. Second, because the noise-bandwidth factor is
common to all three sources, instead of calculating its effect three times, we will
combine the partial results of the three sources first, and then apply the noise-
bandwidth effect. This will make the calculation faster, as we have effectively
factored out BWnoise. Each of the three sources will be noise voltage densities, all
having units of volts per root hertz. Because vind is already in this form, we only need

192
to calculate the thermal and iind effects before doing the summation. Finally, because
noise signals are random, they do not add coherently. In order to find the effective
sum we must perform an RMS summation, that is, a square root of the sum of the
squares. This will result in the input noise voltage. To find the output noise voltage
we will then multiply by Anoise.

The first thing that must be done is to determine the input noise resistance. Rnoise is     Figure 5.28
the combination of the resistance seen from the inverting input to ground and from          Equivalent noise analysis
the noninverting input to ground. To do this, short the voltage source and ground the       circuit.
output. You will end up with circuit like Figure 5.28. Note that Ri and Rf are
effectively in parallel. Therefore,

     Rnoise= Rs+Ri || R f                                        (5.22)

You might note that Rs is in the same position as Roff for the offset calculations. For
absolute minimum noise, the offset compensating resistor is not used. Rnoise is used
to find the thermal noise and the contribution of iind. As always, Ohm's law still
applies, so as you might expect, iind Rnoise produces a noise voltage density with our
desired units of volts per root hertz. The only source left is the thermal noise.

The general equation for thermal noise is:

     eth=  4 K T BW noise Rnoise                                 (5.23)

     Where
     eth is the thermal noise,
     K is Boltzmann's constant, 1.3810-23 joules/kelvin degree,
     T is the temperature in kelvin degrees (celsius + 273),
     BWnoise is the effective noise bandwidth,
     Rnoise is the equivalent noise resistance.

Because we are interested in finding the noise density, we can pull out the BWnoise
factor. Also, when we perform the RMS summation, this quantity will need to be
squared. Instead of taking the square root and then squaring it again, we can just
leave it as eth2. These two considerations leave us with the mean squared thermal
noise voltage density, or

     eth2 = 4 K T Rnoise                                         (5.24)

Now that we have the components, we may perform the summation.

      etotal= v ind 2 +(iind× Rnoise)2+eth2                      (5.25)

The total input noise voltage density is etotal. Its units are in volts per root hertz. At
this point we may now include the noise bandwidth effect. In order to find BWnoise,

193
multiply the small-signal bandwidth by 1.57. If the amplifier is DC coupled, the
small-signal bandwidth is equal to f2, otherwise it is equal to f2 - f1. For most
applications setting the bandwidth to f2 is sufficient.

              BW noise=1.57 f 2    (5.26)

For the final step, etotal is multiplied by the square root of BWnoise. Note that the units
for etotal are volts per root hertz. Consequently, we need a root hertz bandwidth. We
are performing a mathematical shortcut here. You could square etotal in order to get
units of volts squared per hertz, multiply by BWnoise, and then take the square root of
the result to get back to units of volts, but the first way is quicker. Anyway, we end
up with the input referred RMS noise voltage.

              en=etotal  BW noise  (5.27)

Example 5.14

     Determine the output noise voltage for the circuit of Figure 5.29. For a                Figure 5.29
     nominal output of 1 V RMS, what is the signal-to-noise ratio? Assume                    Circuit for Example 5.14.
     T = 300 kelvin (room temperature).

     The 5534 shows the following specs, vind = 4 nV/Hz, iind = 0.6 pA/Hz.
     These values do rise at lower frequencies, but we will ignore this effect for
     now. Also, funity is 10 MHz.

                                     Av=1+R f
                                               Ri

                                     Av=1+99 k 1 k
                                     Av =100
                                     Av ' =40 dB

     For the noninverting amplifier, Av = Anoise, so

                                     Anoise=100=40 dB

                                     Rnoise= Rs+R f || Ri
                                     Rnoise=100 +99 k ||1 k
                                     Rnoise=1090 

                                     eth2 = 4 K T Rnoise
                                     eth2 =4×1.38×10-23×300×1090
                                     eth2 =1.805×10-17Volts squared per Hertz

194
 etotal= v ind 2 +(iind Rnoise)2+eth2

etotal=(4 nV/ Hz)2+(.6 pA/ Hz×1090 )2+1.805×10-17V2 /Hz

etotal=1.6×10 +4.277×10 +1.805×10-17   -19             -17

etotal=5.87 nV/ Hz

Note that the major noise contributors are vind and eth. Now to find BWnoise.

f 2= f unity
     Anoise

f 2=10 MHz 100
f 2=100 kHz

BW noise= f 2 1.57

BW noise=100 kHz×1.57
BW noise=157 kHz

en=etotal  BW noise

en=5.87 nV/ Hz 157 kHz

en=2.33 V RMS

To find the output noise, multiply by the noise gain.

en-out=en Anoise
en-out=2.33  V×100
en-out=233 V RMS

For a nominal output signal of 1 V RMS, the signal-to-noise ratio is

S / N = Signal Noise
S/N= 1V

        233 V
S / N =4290

Normally S/N is given in dB

S / N ' =20log10 S / N
S / N ' =20log104290
S / N ' =72.6dB

As was noted earlier, the noise curves increase at lower frequencies. How do you
take care of this effect? First of all, when using a wide-band design with a noise

195
corner frequency that is relatively low (as in Example 5.14), it can be safely ignored.
If the low frequency portion takes up a sizable chunk of the signal frequency range,
it is possible to split the calculation into two or more segments. One segment would
be for the constant part of the curves. Other segments can be made for the lower
frequency portions. In these regions, an averaged value would be used for vind and
iind. This is a rather advanced treatment, and we will not pursue it here.

Finally, it is common to use the parameter input referred noise voltage. Input
referred noise voltage is the output noise voltage divided by the circuit signal gain.

     ei n- ref = e n- out  (5.28)
                Av

This value is the same as en for noninverting amplifiers, but varies a bit for inverting
amplifiers because Anoise does not equal Av for inverting amplifiers.

Summary

In this chapter we have taken a closer look at op amp characteristics. First of all, we
find that the upper frequency limit is a function of the op amp parameter funity, also
known as the gain-bandwidth product, and the circuit's noise gain. The higher the
gain is, the lower the upper break frequency will be. Op amps are capable of flat
response down to DC. If coupling capacitors are used, the lower break frequency
may be found by using standard lead network analysis. When stages are cascaded,
the results echo those of cascaded discrete stages. The lowest f2 is dominant and
becomes the system f2. The highest f1 is dominant and sets the system f1. If more than
one stage exhibits the dominant critical frequency, the actual critical frequency will
be somewhat lower for f2 and somewhat higher for f1.

In order to make the op amp unconditionally stable, a compensation capacitor is
used to tailor the open loop frequency response. Besides setting funity, this capacitor
also sets the slew rate. Slew rate is the maximum rate of change of output voltage
with respect to time. Slewing slows down the edges of pulse signals and distorts
sinusoidal signals. The highest frequency that an amplifier can produce without
slewing is called the power bandwidth. In order to optimize funity and slew rate, some
amplifiers are available without the compensation capacitor. The designer then adds
just enough capacitance to make the design stable.

Due to slight imperfections between the input transistors, op amps may produce
small DC output voltages called offsets. Offsets may be reduced through proper
resistor selection. Simple nulling circuits may be used to completely remove the
offset. A variable offset due to temperature variation is called drift. The larger the
temperature variation, the larger the drift will be. The transistor mismatch also
means that common-mode signals will not be completely suppressed. Just how well

196
common mode signals are suppressed is measured by the common-mode rejection
ratio, CMRR. Similar to CMRR is PSRR, the power-supply rejection ratio. PSRR
measures how well power-supply noise and ripple are suppressed by the op amp.
Both PSRR and CMRR are frequency-dependent. Their maximum values are found at
DC and then they decrease as frequency increases.

Finally, noise is characterized as an undesired random output signal. The noise in op
amp circuits may be characterized by three components: the thermal noise of the
input and feedback resistors, the op amp's input noise voltage density, vind, and its
input noise current density, iind. The combination of these elements requires an RMS
summation. In order to find the output noise voltage, the input noise voltage is
multiplied by the circuit's noise gain. The ratio of the desired output signal and the
noise voltage is called, appropriately enough, the signal-to-noise ratio. Normally,
signal-to-noise ratio is specified in decibels.

Review Questions

    1. Define gain-bandwidth product. What is its use?
    2. How do you determine f2 and f1 for a multi-stage circuit?
    3. What happens if two or more stages share the same break frequency?
    4. What is slew rate?
    5. How is power bandwidth determined?
    6. How do power bandwidth and small-signal bandwidth differ?
    7. What are the advantages and disadvantages of noncompensated op amps?
    8. What are decompensated op amps?
    9. What causes DC offset voltage?
    10. What causes DC drift voltage?
    11. What is CMRR?
    12. What is PSRR?
    13. What parameters describe an op amps noise performance?
    14. What is S/N?

Problems

Analysis Problems

    1. Determine f2 for the circuit in Figure 5.3 if a 411 op amp is used.
    2. Determine f2 for the circuit of Figure 5.5 if a 318 op amp is used.

         Note: funity = 15 MHz for a 318.
    3. What is the minimum acceptable funity for the op amp in Figure 5.3 if the

         desired f2 is 250 kHz?
    4. What is the minimum acceptable funity for the op amp in Figure 5.5 if the

         desired f2 is 20 kHz?

197
    5. Determine the power bandwidth for Problem 5.1. Assume Vp = 10 V.
    6. Determine the power bandwidth for Problem 5.3. Assume Vp = 12 V.
    7. What is the minimum acceptable slew rate for the circuit of Figure 5.3 if the

         desired power bandwidth is 20 kHz with a Vp of 10 V?
    8. What is the minimum acceptable slew rate for the circuit of Figure 5.5 if the

         desired power bandwidth is 40 kHz with a Vp of 5 V?
    9. A circuit has the following specifications: ±15 V power supply, voltage gain

         equals 26 dB, desired power bandwidth equals 80 kHz at clipping.
         Determine the minimum acceptable slew rate for the op amp.
    10. Determine the system f2 in Figure 5.6 if all three devices are 318s.
    11. Determine the system slew rate for Figure 5.7. The first device is a 741 and
         the second unit is a 411.
    12. Find the output offset voltage for Figure 5.3.
    13. If Rs = Rf = 100  in Figure 5.22, find the output offset voltage using a 318
         op amp.
    14. Assume that the circuit of Figure 5.23 is nulled at 25°C and that an optimum
         value for Roff is used. Determine the drift at 75°C.
    15. Assuming that the 120 Hz power supply ripple in Figure 5.30 is 50 mV, how
         large is its contribution to the output?

                                                                        Figure 5.30

    16. Utilizing a 5534 op amp, what is the approximate input noise voltage for a
         source resistance of 1 k and a bandwidth from 10 Hz to 20 kHz?

    17. Assuming that the op amp of Problem 5.16 is connected like Figure 5.30,
         what is the approximate output noise voltage? What is the approximate input
         referred noise voltage?

    18. Assume that Rs = 0 , Ri = 500 , and Rf = 10 k in Figure 5.28. Find the
         input noise voltage if the op amp is a 411.

    19. For a nominal output voltage of 2 V RMS, determine the signal-to-noise
         ratio for Problem 5.18.

    20. Assume that the input to Figure 5.22 is a 5 V peak 50 kHz square wave.
         Draw the output waveform if a 741 is used.

    21. Repeat Problem 5.20 using a 10 V peak, 100 kHz sine wave.

198
Design Problems

    22. Determine an optimum value for Roff in Figure 5.3 and determine the
         resulting offset voltage.

    23. Determine the optimum value for Roff in Figure 5.30. Assuming that the
         circuit has been nulled at 25°C, find the drift at 60°C.

    24. Determine a new value for the 100 k resistor in Figure 5.8 in order to
         minimize the output offset.

    25. Using the optimum resistor found in Problem 5.24, determine a new value
         for the input capacitor that will maintain the original f1.

    26. Design a circuit with a gain of 32 dB and an f2 of at least 100 kHz. You may
         use any of the following: 741, 411, 318.

    27. Design a circuit with a gain of 50 and an fmax of at least 50 kHz, given a
         maximum output swing of 10 V peak. You may use any of the following:
         741, 411, 318.

    28. Design a circuit with a gain of 12 dB, a small-signal bandwidth of at least
         100 kHz, and an fmax of at least 100 kHz for a peak output swing of 12 V.

    29. Utilizing two or more stages, design a circuit with a gain of 150 and a small-
         signal bandwidth of at least 600 kHz.

Challenge Problems

    30. Determine the system f2 in Figure 5.18.
    31. Determine the input noise voltage for the circuit of Figure 5.30. Assume

         Roff = 950 .
    32. Determine the output noise voltage and the input-referred noise voltage for

         Problem 5.31.
    33. Assuming that driving source resistance in Figure 5.7 is 0 , how much

         offset voltage is produced at the output of the circuit? Assume that both
         devices are 411's.
    34. Assume that you have one each of: 411, 741, 318. Determine the
         combination that will yield the highest system slew rate in Figure 5.31.

                                                                                                                     Figure 5.31

199
    35. Repeat Problem 5.34 in order to produce the highest system f2.
    36. Assuming that the driving source resistance is 0  in Figure 5.7. Determine

         the output noise voltage if both devices are 411's.
    37. Derive Equation 5.9 from the text.
Computer Simulation Problems
    38. Use a simulator to create a Bode plot for Problem 5.10. If a macro model for

         the LM318 is not available, use the 741 instead.
    39. Create a time domain representation of the output voltage of Problem 5.20

         using a simulator.
    40. Create a time domain representation of the output voltage of Problem 5.21

         using a simulator. Repeat the simulation using an LM318 op amp in place of
         the 741. What do the results indicate?
    41. Simulate the circuit designed in Problem 5.26. Verify f2 and Av through a
         Bode plot.
    42. Generate a Bode plot using a simulator and verify f2 and Av for the circuit
         designed in Problem 5.29.
    43. Generate a Bode plot using a simulator and verify f2 for the circuit designed
         in Problem 5.35.

200
6 Specialized Op Amps

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Analyze instrumentation amplifiers.
    · Discuss the advantages of using instrumentation amplifiers versus simple op amp differential amplifiers.
    · Analyze and detail the advantages of programmable op amps and give possible applications.
    · Detail the advantages of high-speed and high-power op amps and give possible applications.
    · Describe an OTA, noting how it differs from a programmable op amp, and give possible applications.
    · Describe the operation of a Norton amplifier, compare how it is used relative to ordinary op amps, and

         analyze circuitry that makes use of Norton amplifiers.
    · Describe the operation of current feedback op amps, and explain what their primary advantages are.
    · Describe the need and usage of application-specific integrated circuits.

6.1 Introduction

So far, you have seen how to analyze and design op amp circuits for a variety of general-purpose applications.
There are many applications in which the ease of op amp circuit design would be welcome, but in which the
average op amp's performance is not suitable. Over the years, manufacturers have extended the performance of
op amps outside of their original low-power, low-frequency realm. A variety of special-purpose op amps and op
amp derivatives now exist for the designer's convenience. This chapter takes a look at a number of the areas
where specialized op amps may now be used.

Perhaps the two most noticeable areas of extended device performance are in power handling and speed. At one
time, op amps were considered to be suitable for use below 1 MHz. Today it is possible to find high-speed
devices designed for applications such as video where bandwidths are measured in the tens of MHz. In the area
of power, the general-purpose op amp typically operates from a ±15 V supply and can produce output currents
in the neighborhood of 25 milliamps. New devices can produce output currents measured in amperes, while
other devices can produce signals in the hundreds of volts. This makes it possible to directly connect low-
impedance loads to the op amp, which is a very useful commodity.

There are a variety of other useful variations on the basic op amp theme. These include devices optimized for
single-supply operation, dedicated voltage followers, devices that allow you to trade off speed for power
consumption, and application-specific items like low-noise audio pre-amplifiers and voltage-controlled
amplifiers. This chapter will introduce a selection of these devices and take a look at a few of their applications.
Although these devices may not find as wide an appeal, as say, a 411 or 741, they allow you to extend your
designs without "reinventing the wheel" each time.

201
6.2 Instrumentation Amplifiers

There are numerous applications where a differential signal needs to be amplified.
These include low-level bridge measurements, balanced microphone lines,
communications equipment, thermocouple amplifiers, and the like. The immediate
answer to these applications is the differential op amp configuration noted in
Chapter Four. There are limitations to this form unfortunately. For starters, it is
practically impossible to achieve matched high impedance inputs while maintaining
high gain and satisfactory offset and noise performance. For that matter, the input
impedances are not isolated; indeed, the impedance of one input may very well be a
function of the signal present on the other input. Simply put, this is an unacceptable
situation when a precision amplifier is needed, particularly if the source impedance
is not very low.

An instrumentation amplifier overcomes these problems. Instrumentation amplifiers
offer very high impedance, isolated inputs along with high gain, and excellent
CMRR performance. Some people like to think of instrumentation amplifiers as a
form of "souped up" differential amplifier. Instrumentation amplifiers can be
fashioned from separate op amps. They are also available on a single IC for highest
performance.

                                                                                                                   Figure 6.1
                                                                                                                   Basic differential amplifier
                                                                                                                   (left) and with buffers (right).

Instrumentation amplifiers are, in essence, a three-amplifier design. To understand
how they work, it is best to start with a differential amplifier based on a single op
amp, as seen in Figure 6.1a. One way to increase the input impedances and also
maintain input isolation, is to place a voltage follower in front of each input. This is
shown in Figure 6.1b. The source now drives the very high input impedance
followers. The followers exhibit very low output impedance and have no trouble
driving the differential stage. In this circuit, op amp 3 is used for common-mode
rejection as well as for voltage gain. Note that the gain-bandwidth requirement for
op amp 3 is considerably higher than for the input followers. An enhancement to this
circuit is shown in Figure 6.2. Here, op amps 1 and 2 are used for signal gain along
with their previous duty of input buffering. The major problem with this
configuration is that it requires very close matching of resistors in order to keep the
gains the same. Any mismatch in gain between the two inputs will result in a
degradation of CMRR. For optimum common-mode rejection, the undesired signal
must be identical at the inputs to op amp 3. For high CMRR systems, resistor

202
matching may need to be better than 0.01%. This is an expensive requirement if
discrete resistors are used. Another way around this would be to allow some
adjustment of the gain to compensate for gain mismatches, perhaps by using a
resistor/potentiometer combination in place of Rf' for op amp 3. For reasons of cost
and time, adjustments are frowned upon.

                                                                                                                     Figure 6.2
                                                                                                                     Basic instrumentation
                                                                                                                     amplifier.

Fortunately, there is a very slight modification to Figure 6.2 that will remove the
problem of mismatched gains. This modification involves joining the Ri values of op
amps 1 and 2 into a single resistor. This is shown in Figure 6.3. In order to prevent
possible confusion with op amp 3, the three resistors used for the input section have
been labeled as R1, R2, and R3. In order to analyze this circuit, we will use the
approximation techniques examined earlier.

                                                                                                                     Figure 6.3
                                                                                                                     Improved instrumentation
                                                                                                                     amplifier.

203
First of all, from preceding work we already know the gain equation for the
differential section

            V out= R f (V b-V a )                                   (6.1)
                    Ri

Our goal, then, is to find equations for Vb and Va. Let's examine op amp
1 for Va. First, due to the approximation that the error voltage of the op amps is zero,
the inverting and noninverting inputs of each op amp are the same. We can therefore
say that Vx must equal Vin-, and that Vy must equal Vin+.

            V x=V i n-                                              (6.2)
            V y=V i n +                                             (6.3)

The output voltage Va must equal Vx plus the drop across R1.

            V a=V x+V R1                                            (6.4)

The "positive" potential of VR1 is arbitrary. We are assuming that the current is
flowing down through R1. If the actual numbers work out opposite, VR1 will come up
negative. The voltage drop VR1 is found by Ohm's law:

            V R1= R1 I R1                                           (6.5)

To expand,

            I R1= I R2+I opamp1

Iopamp 1 is approximately 0, therefore,

            V R1= R1 I R2

The current through R2 is set by its value and the drop across it.

            I R2= V x-V y                                           (6.6)
                     R2

Substituting 6.6 and 6.5 into 6.4 yields

            V a=V x+R1 (V x-V y)                                    (6.7)
                             R2

204
Substituting 6.2 and 6.3 into 6.7 yields

     V a=V i n-+R1(V i n --V i n +)
                         R2

     V a=V i n-+R1 (V i n--V i n +)
                  R2

     V a=V i n-+V i n - R1 - V i n + R1
                                          R2        R2

     ( ) V a=V i n- 1+R1 - V i n + R1     R2        R2                 (6.8)

A close look at Equation 6.8 reveals that it is made up of two terms. The first term is
Vin- times the noninverting gain of op amp 1, as you may have expected. The second
term is Vin+ times the inverting gain of op amp 1. This output potential is important
to note. Even though it may not appear as though op amp 1 will clip a given signal,
it might if the input to the second op amp is large enough and of the proper polarity.

By a similar derivation, the equation for Vb is found

     ( ) V b=V i n+ 1+R3 - V i n - R3     R2        R2                 (6.9)

For gain matching, R3 is set equal to R1. R2 can then be used to control the gain of the
input pair, in tandem.

Finally, substituting 6.8 and 6.9 into 6.1 yields,

     (( ( ) ) ( ( ) )) Vout= Rf
             Ri
     V i n+ 1+R1 R - V i n- R1 - V i n - 1+R1 - V i n 2 R2 R2 + R1 R2  (6.10)

Combining terms produces

     ( ( ) ) Vout= Rf
             Ri
                          (V i n +-V i n-) 1+R1         +(V i n +-V i n-) R1
                                              R2                         R2

     ( )( ) V out=(V in+-V in-) R f
                             Ri
                                                       1+2 R1          (6.11)
                                                             R2

The first term is the differential input voltage. The second term is the gain produced
by op amp 3, and the third term is the gain produced by op amps 1 and 2. Note that
the system common-mode rejection is no longer solely dependent on op amp 3. A
fair amount of common-mode rejection is produced by the first section, as evidenced

205
by equations 6.8 and 6.9. Because the inverting and noninverting gains are almost
the same for very high values, high input gains tend to optimize the system CMRR.
The remaining common-mode signals can then be dealt with by op amp 3.

Example 6.1

     The instrumentation amplifier of Figure 6.4 is used to amplify the output of       Figure 6.4
     a balanced microphone. The output of the microphone is 6 mV peak (12 m             Instrumentation amplifier for
     differential), and a common-mode hum signal is induced into the lines at           Example 6.1.
     10 mV peak (0 mV differential). If the system has a CMRR of 100 dB, what
     is the output signal?

     First, let's check the outputs of the first section to make sure that no clipping
     is occurring. We will use superposition and consider the desired signal and
     hum signal separately.

        ( )R1            - Vin+R1
                                R2
     V a=V i n- 1+
                     R2

     ( ) V a=-6 mV 1+20 k 400 -6 mV 20 k 400

     V a=-306 mV-300 mV
     V a=-606 mV

     Performing the same calculation on the hum signal produces a contribution
     of

     ( ) V a=10 mV 1+20 k 400 -10 mV 20k 400

     V a=10 mV

206
     For worst case, these two components' magnitudes add, yielding 616 mV,
     which is far below clipping. The same results are produced for Vb, except
     that the desired signal is positive.

     Now for the output voltage. The second section has a gain of

     Av= R f
           Ri

     Av= 50 k 10 k
     Av=5

     The desired differential input signal is Vb - Va, so

     V out= Av(V b-V a )
     V out=5(606 mV-(-606 mV))
     V out=6.06 V

     This result may also be produced in one step by using Equation 6.11

     ( ) V out=(V i n+-V i n -) R f
                            Ri
                                                           1+2 R1
                                                                R2

     ( ) V out=12mV 50 k 10 k 1+2 20k 400

     V out=6.06 V

     Note that the total gain is 505. Because this amplifier is not perfect, some
     common-mode signal gets through. It is suppressed by 100 dB over a
     desired signal. 100 dB translates to a factor of 105 in voltage gain. To find
     the hum signal at the output, multiply the hum by the ordinary signal gain,
     and then divide it by the CMRR

     V hum=V out (cm)
     V out (cm)=V i n(cm) Av CMRR
     V out(cm)=10 mV 105 505
     V out (cm)=50.5 V

     Notice how the hum signal started out just as large as the desired signal, but
     is now many times smaller. The very high CMRR of the instrumentation
     amplifier is what makes this possible.

207
Computer Simulation

In Figure 6.5, Multisim is used to simulate the amplifier of Example 6.1. The simple
3-terminal op amp model is used here. In order to clearly see the common-mode
rejection, the desired differential input signal is set to a 1 mV sine wave, and the
common-mode signal is set to 1 VDC. The initial bias solution shows that op amps 1
and 2 amplify both the AC and DC portions of the input, while common-mode
rejection is left up to op amp 3. This is evidenced by the fact that the input nodes of
the final op amp both see the same DC potential. At the output, the sine wave has
been amplified by approximately 500 as expected. There is no DC offset at the
output, indicating rejection of the common-mode DC signal.

                                                                                                                    Figure 6.5a
                                                                                                                    Instrumentation amplifier
                                                                                                                    in Multisim.

                                                                                                                   Figure 6.5b
                                                                                                                   DC voltages for
                                                                                                                   instrumentation amplifier.

208
                                                                                                                     Figure 6.5c
                                                                                                                     AC output voltage for
                                                                                                                     instrumentation amplifier.

Having seen how useful instrumentation amplifiers are, it should come as no
surprise to find that manufacturers have produced these devices on a single IC. One
such device is the LT1167 from Linear Technology. This amplifier is suited for a
variety of applications including bridge amplifiers and differential to single-ended
converters. It is very similar in layout to Figure 6.3, using 24.7 k resistors for R1
and R3, and 10 k resistors for Ri and Rf. It features a typical CMRR of 115 dB for
gains of 10, and up to 140 dB for gains of 1000. Its input resistance is 200 G
minimum. The gain is set by placing an appropriate resistor between the gain set
pins. The gain may be approximated as

                                Av=1+49.4 k 
                                             Rg

For superior high frequency performance, some instrumentation amplifiers include
connections for a guard drive. This is shown in Figure 6.6.

                                                                                                                     Figure 6.6
                                                                                                                     Guard drive internal
                                                                                                                     connections.

209
This signal is derived from the outputs of the first section. By using two equal-
valued resistors, the differential signals cancel, and thus the guard-drive signal is
equal to the common-mode signal. This signal will then be buffered and used to
drive the shields of the input wires as shown in Figure 6.7.

                                                                                       Figure 6.7
                                                                                       Guard drive.

To understand how performance is improved, refer to Figure 6.8. Here, the cables       Figure 6.8
are replaced with a simple model. R represents the cable resistance and C represents   Unbalanced lag network
the cable capacitance. The cable model is little more than a lag network. As you       equivalents.
know, this causes high frequency roll off and phase change. If the two
sections are not identical, the rolloffs and phase changes will not be the
same in the two lines. These changes will affect the common-mode signal
and can lead to a degradation of the system CMRR. In the guard-drive
circuit, the cable shields are not connected to ground at the source signal.
They are only connected to the guard-buffer output. This is an important
point. By driving the shield with a signal equal to the common-mode
signal, the voltage developed across C will be zero. Both ends of the
capacitor see the same potential; therefore, the drop is nonexistent. This
reduces the cable effects considerably.

Example 6.2

     The signal produced by a transducer in a factory automation system provides
     a nominal level of 0.1 V. For proper use, the signal needs to be amplified up
     to 1 V. Because this signal must pass through the relatively noisy
     (electrically speaking) environment of the production floor, a balanced cable
     with an instrumentation amplifier is appropriate. Using the LT1167, design a
     circuit to meet these requirements.

210
     For the power supply, a standard ±15 V unit will suffice. Rg is used to set the     Figure 6.9
     desired gain of ten.                                                                Completed instrumentation
                                                                                         amplifier for Example 6.2.
                                     Av=1+49.4 k
                                                Rg

                                     Rg=49.4 k
                                           Av -1

                                     Rg=49.4 k 10 -1
                                     Rg=5.489 k

     The completed circuit is shown in Figure 6.9.

6.3 Programmable Op Amps

As noted in Chapter Five, there is always a trade-off between the speed of an op amp
and its power consumption. In order to make an op amp fast (i.e., high slew rate and
funity), the charging current for the compensation capacitor needs to be fairly high.
Other requirements may also increase the current draw of the device. This situation
is not unlike that of an automobile where high fuel mileage and fast acceleration
tend to be mutually exclusive. Op amps are available that can be set for
predetermined performance levels. If the device needs to be very fast, the designer
can adjust an external voltage or resistance and optimize the device for speed. At the
other end of the spectrum, the device can be optimized for low power draw. Because
of their ability to change operational parameters, these devices are commonly called
programmable op amps.

Generally, programmable op amps are just like general-purpose op amps, except that       Figure 6.10
they also include a programming input. The current into this pin is called Iset. Iset    Basic connections of the
controls a host of parameters including slew rate, funity, input bias current, standby   LM4250.
supply current, and others. A higher value of Iset increases funity, slew rate, standby
current, and input bias current. The value of Iset can be controlled by a simple
transistor current source, or even a single resistor in most cases.

One example of a programmable op amp is the Texas Instruments LM4250. The
outline of the LM4250 is shown in Figure 6.10. Two possible ways of adjusting Iset
are shown in Figures 6.11 and 6.12. A variety of graphs showing the variation of
device parameters with respect to Iset are shown in Figure 6.13. As an example,
assume that Iset= 10 A and that we're using standard ±15 V supplies. At this current,
we find that funity is 230 kHz, slew rate is 0.21 V/s, and the standby current draw is
50 A. The current draw is decidedly lower than that of a 741. This makes the
device very attractive for applications where power draw must be kept to a

211
minimum. Battery operated systems generally fall into the low power consumption
category. By keeping current drain down, battery life is extended.

                                                                                                                     Figure 6.11 (left)
                                                                                                                     Programming via resistor.

                                                                                                                     Figure 6.12 (right)
                                                                                                                     Programming via voltage.

Perhaps the strongest feature of this class of device is its ability to go into a power
down mode. When the device is sitting at idle and not being used, Iset can be
lowered, and thus the standby current drops considerably. For example, if Iset for the
LM4250 is lowered to 100 nA, standby current drops to under 1 A. By doing this,
the device may only dissipate a few microwatts of power during idle periods. When
the op amp again needs to be used for amplification, Iset can be brought back up to a
normal level. This form of real time adjustable performance can be instituted with a
simple controlling voltage and a transistor current source arrangement as in Figure
6.12.

                                                                                                                     Figure 6.13
                                                                                                                     LM4250 device curves.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

212
                                                                                     Figure 6.13 (continued)
                                                                                     LM4250 device curves.

                                                                                     Reprinted courtesy of Texas
                                                                                     Instrutments

Example 6.3

     Determine the power bandwidth for Vp = 10 V For the circuit of Figure 6.14.     Figure 6.14
     Also find f2. ±15 V power supplies are used.                                    Circuit for Example 6.3.

     In order to find these quantities, we need the slew rate and funity. These are
     controlled by Iset, so finding Iset is the first order of business.

                                     I set=V CC -0.5
                                               R set

                                     I set=15 -0.5 3 M 
                                     I set=4.83 A

213
         From the graph "Gain-Bandwidth Product versus Iset" we find that 4.83 A
         yields an funity of approximately 200 kHz. The graph "Slew Rate versus Iset"
         yields approximately 0.11 V/s for the slew rate.

                                          Anoise=1+R f
                                                       Ri

                                          Anoise=1+50 k 2 k
                                          Anoise= 26

                                          f 2= f unity
                                                Anoise

                                          f 2= 200 kHz 26
                                          f 2=7.69kHz

                                           f max= SR
                                                  2V p

                                          f max= 0.11 V / S 2 ×10 V
                                          f max=1.75 kHz

         As you can see, once the set current and associated parameters are found,
         analysis proceeds as in any general-purpose op amp.

6.4 Op Amps for High Current, Power, and Voltage
Applications

General-purpose op amps normally run on no more than ±15 V power rails and
typically produce less than 40 milliamps of output current. This makes it impossible
to directly connect them to a low impedance load such as a loudspeaker or motor.
The lack of high voltage capability hurts in many places, including many forms of
display technology. In short, general-purpose op amps are low power devices. There
are a few ways around these limitations. One way of boosting the output current
capability by using a discrete follower was shown in Chapter Four. In recent years,
manufacturers have produced a variety of op amps with extended power
performance.

214
High Current Devices

Perhaps the most immediate desire for higher current capacity op amps came from
the audio community. If an op amp could be directly connected to a loudspeaker, a
great deal of time and money could be saved for general-purpose audio design work.
Instead of a collection of perhaps half a dozen transistors and a handful of required
biasing resistors and capacitors, an audio amplifier could be produced with a single
op amp and just a few resistors and capacitors. Indeed, some of the first high output
devices were aimed squarely at the audio market. By 1980 it was possible to choose
from a number of amplifiers designed to drive loudspeakers with power levels of 1
to 5 watts. In an effort to make designs ever easier, the strict op amp form was
modified and devices with preset and programmable gains were produced. Due to
the increased dissipation requirements, the standard plastic dual inline package was
abandoned in favor of multi-lead TO-220 style cases. Devices have been created that
can produce output currents in excess of 10 amps. Besides their use in the
audio/communications area, these high current devices find use in direct motor drive
applications, power supply and regulation design, and in other areas.

Let's take a closer look at a few representative devices. First, on the lower end of the
scale is the LM386. This low-voltage device has been around for many years and is
housed in a hobbyist-friendly 8 pin mini DIP. It operates from a single power supply
between 4 and 12 V and is capable of producing 0.8 W into a 16  load with 3%
THD. The gain is set internally to 20, but can be increased up to 200 with the
addition of a few extra components. A minimum configuration layout requires only
one external component, as shown in Figure 6.15. In the minimum configuration the
PSRR bypass capacitor is omitted. This produces a PSRR of less than 10 dB. A more
respectable PSRR of 50 dB can be achieved by adding a 50 F capacitor from the
PSRR bypass pin to ground. The small number of required external components is
due to the fact that an internal feedback path has already been established by the
manufacturer. Normally, this device would not be set up in the forms we have
already examined. Configured as in Figure 6.15, the circuit exhibits a 300 kHz
bandwidth and an input impedance of 50 k.

                                                                                                                     Figure 6.15
                                                                                                                     Simple power amp.

A typical application using the LM386 is shown in Figure 6.16. This is a personal
amplifier called The Pocket Rockit. It is designed for musicians, so that they can
plug a guitar, keyboard, or other electronic instrument into the unit and hear what

215
they play through a pair of headphones. It is in essence, a personal practice amp. In       Figure 6.16
keeping with its small portable design, The Pocket Rockit runs off of a single 9 volt       Pocket Rockit schematic.
battery. Note how the single supply biasing techniques explained in Chapter Four
are used to bias op amps 1a and 1b.                                                         From Electronic Musician, Vol. 3,
                                                                                            No. 6, Reprinted with permission

The circuit is laid out in three main blocks. The first block serves as a pre-amplifier
and distortion circuit. Because the load for the first stage consists of a pair of diodes,
D2 and D3, large output signals will be clipped at the diode forward voltage.
Normally, clipping is not a desired result in linear circuit design but it can be
aesthetically pleasing, particularly when applied to guitar. (This is one case where
subjective valuations can make a designer do rather odd things.) The second stage
comprises a bass/mid/treble control. This is little more than a frequency selective
amplifier, a subject that will be covered in detail in Chapter Eleven. From the
musician's view, it allows control over the tone color, or timbre, of the sound. The
final stage utilizes an LM386 to drive a pair of mini headphones. As you can see, the
power amplifier section is the smallest of the three. It utilizes the default internal
gain of 20, and includes C20 for optimum PSRR. This is an important detail, as this
circuit may also be powered from 9 VAC adapters, which are not known for their
low noise. The volume control is merely a potentiometer that acts as a voltage
divider to the input signal. Coupling capacitors are used throughout to prevent DC

216
bias signals from affecting the load or adjacent stages. They are also used to make
sure that DC potentials don't appear across the potentiometers, which can increase
adjustment noise. A nice potential upgrade of the design would replace the LM386
with the more efficient LM4951 (1.8 watts into 8 ). This IC offers low current shut
down mode, internal circuitry to mute power on/off transients and is unity gain
stable.

Another possibility is to use the section prior to the volume control as the front end
of a more traditional instrument amplifier. In this instance the LM386 could be
replaced with a much more powerful device such as the similarly named LM3886
along with an appropriately upgraded DC power supply. The LM3886 offers an
average output power of 38 watts into an 8  load with no more than 0.1% THD
across the audio spectrum of 20 Hz to 20 kHz when operated from a ±28 volt supply
and 68 watts when driving a 4  load. It features output short circuit protection,
input mute and power supply turn on/turn off "pop" protection. It comes in an
extended TO-220 case. An example amplifier is shown in Figure 6.17.

                                                                                                                     Figure 6.17
                                                                                                                     High-power amplifier using
                                                                                                                     LM3886.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instruments

Still further along is the Apex PA05. This is a very high current device capable of
producing 30 amps and can run with power supplies as high as ±50 volts. Internal
power dissipation is 250 watts and resistor-programmable current limit is available.
Obviously, with the sort of power dissipation this device is capable of, appropriate
cooling methods, such as heat sinks, cannot be overlooked.

While the PA05 can be used as an audio power amplifier, there are many other
application areas in which it might fit. One example is the sonar drive circuit shown

217
Figure 6.18. Here the sonar transducer is driven via a tuned transformer. The circuit
is a parallel-parallel inverting configuration. RCL is the current limit sense resistor.

                                                                                                                     Figure 6.18
                                                                                                                     Sonar drive circuit using
                                                                                                                     PA05.

                                                                                                                                                   Reprinted courtesy of Apex
                                                                                                                                                   Microtechnology

Other possible applications include direct drive of modestly sized motors and
programmable power supplies.

High Voltage Devices

Sometimes an amplifier needs to deliver output voltages in excess of the 12 to 13 V
limits presented by most op amps. In this case, you may turn to a number of high-
voltage op amps. These devices do not necessarily have a higher output-current
capability as well. Basically, they may be treated as general-purpose op amps that
may be operated from higher supply voltages. Because of this, their output
compliance is increased. Devices are available that may operate from power supplies
well in excess of ±100 V.
One example of this breed is the Apex PA85. The PA85 runs from power supplies as
high as ±225 volts. The output current limit is typically 200 mA. The device is also
quite fast with a gain-bandwidth product of 100 MHz and a typical slew rate of 1000
V/s. The high output voltage capability makes this IC ideal for driving piezo-
electric or electrostatic transducers.

6.5 High Speed Amplifiers

There are many applications where amplification in the 1 MHz to 100 MHz region is
desired. In this range falls the broadcast spectrums of FM radio, VHF television,
citizen's band radio, and video processing in general. The bulk of general-purpose op

218
amps exhibit funity's in the 1 MHz to 10 MHz range. Also, slew rates tend to be below
20 V/s. These characteristics make them wholly unsuitable for higher frequency
applications. Even standard "fast" op amps like the LM318 offer funity's of no more
than 20 MHz with 50 V/s slew rates.

In contrast to general-purpose devices, "ultra fast" op amps exhibit gain bandwidth
products in excess of 50 MHz and slew rates over 100 V/s. Devices are available
with slew rates greater than 1000 V/s and others boast gain bandwidth products
around 1 GHz. In order to optimize performance, these devices are normally of the
uncompensated variety. In this way, the largest possible bandwidth is produced for
any given gain.

Of course, when working with such fast devices, circuit layout is far more critical     Figure 6.19
than normal. A very good circuit design may be crippled by a careless layout. First     Video driver.
of all, PC-board ground planes are advised. A ground plane offers isolation along
with low resistance and inductance pathways. These parasitic and stray impedance        Reprinted courtesy of Maxim
effects, which are often ignored at lower frequencies, can reduce circuit performance   Integrated
at high frequencies. Shielding around input and output paths may also be required
for some applications, but care must be exercised, as the resulting capacitance may
also produce high-frequency attenuation. In general, the circuit layout should
minimize stray capacitance between the output and feedback point, from the
feedback-summing node to ground, and between the circuit input and output. One
common technique involves extending a ground plane in order to isolate the input
and output traces. Also, the traces should be kept short to minimize coupling effects,
and thus, compact layouts are generally preferred. IC sockets are generally avoided
due to the increased lead inductance and capacitance they present. When bread-
boarding high speed circuits, the popular multi-row socket boards used for general-
purpose work are normally unacceptable due to high lead inductance and
capacitance effects. Finally, as with power op amps, some high-speed op amps have
been optimized for specific applications and are no longer interchangeable with the
generic op amp model. For example, specific gains may be selected by grounding or
opening certain pins on the IC.

The MAX4030/4031 family from Maxim
are low-cost dual and triple high speed op
amps. They boast typical specs of 115
V/s for slew rate and 144 MHz for gain-
bandwidth product. The devices run from
a 5 volt supply. As with any high
frequency device, power supply bypass
capacitors are required. As an example a
basic 75  video line driver is shown in
Figure 6.19. Another example is the
AD847 from Analog Devices which
boasts a 300 V/s for slew rate with a 50
MHz gain-bandwidth product.

219
6.6 Voltage Followers and Buffers

Unity gain noninverting buffers (voltage followers) are used in wide variety of
applications. Any time a signal source needs to be isolated, a buffer is needed. As
you have seen, connecting op amps in a follower configuration is a very
straightforward exercise. This is not always the best choice. By optimizing the
amplifier design for buffer operation, the manufacturer can increase performance, or
in some cases, reduce the case size. This is possible because followers need very few
connections: input, output, and power supply. Also, as the devices must, by nature,
be unity gain stable, an external compensation connection is normally not desired.

One buffer amplifier optimized for high performance is the Maxim MAX4200-4205
series. This device is designed with video applications, high-speed drivers, and
analog-to-digital converters in mind. Outside of the standard power supply bypass
capacitors and perhaps a line termination resistor, no other parts are needed. Figure
6.20 shows a minimum configuration for driving 50  co-axial cable. This buffer is
capable of supplying ±90 mA to its load, so direct 50  connection poses no
problem. Slew rate is typically 4200 V/s, and circuit bandwidth is 780 MHz.

                                                                                                                     Figure 6.20
                                                                                                                     Video RF cable buffer.

                                                                                                                                                   Reprinted courtesy of Maxim
                                                                                                                                                   Integrated

Example 6.4

         Determine the approximate bandwidth required for a high-resolution video
         display amplifier. The display has a resolution of 1024 pixels wide by 1024
         pixels high, with a refresh rate of 60 frames per second9. This specification
         is typical of a workstation or a high quality personal computer.

9 The term pixel is a contraction of picture element. The display is considered to be nothing
    more than a large grid of dots. The term refresh rate refers to how quickly the display is
    updated or redrawn.

220
         In its simplest form (monochrome, or black and white), each pixel is either
         on or off. As a controlling voltage, this means either a high or a low. An
         updated grid of 1024 by 1024 dots must be drawn on the display monitor 60
         times each second. From this, we can determine the pixel, or dot, rate

                                          Pixel Rate=Height×Width×Refresh
                                          Pixel Rate=1024×1024×60
                                          Pixel Rate=62,914,560 pixels per second

         This indicates that each pixel requires 1/62,914,560 seconds, or about 15.9
         ns, to reproduce. For proper pulse shape, the rise time should be no more
         than 30% of the pulse width (preferably less). From the rise time/bandwidth
         relationship established in Chapter One,

                                          f 2=0.35
                                                 Tr

                                          f 2= 0.35 0.3×15.9 ns
                                           f 2= 0.35 4.77 ns
                                          f 2=73.4MHz

         Theoretically, a 73.4 MHz bandwidth is required. Once overhead such as
         vertical retrace is added, a practical circuit will require a bandwidth on the
         order of 100 MHz.

6.7 Operational Transconductance Amplifier

The Operational Transconductance Amplifier, or OTA as it is normally abbreviated,
is primarily used as a controlled-gain block. This means that an external controlling
signal, either a current or a voltage, will be used to set a key parameter of the circuit,
such as closed-loop gain or f2. This is not the same thing as the programmable op
amps discussed earlier.

OTAs exhibit high output impedances. They are intended to be used as current
sources. Therefore, the output voltage is a function of the output current and the load
resistance. The output current is set by the differential input signal and the OTA's
transconductance. Transconductance is, in turn, controlled by a setup current, Iabc.
What this all means is that the output signal is a function of Iabc. If Iabc is increased,
transconductance rises and with it, output voltage. Normally, OTAs are operated
without feedback. One major consequence of this is that the differential input signal
must remain relatively small in order to avoid distortion. Typically, the input signal
remains below 100 mV peak to peak.

221
                                                                                                                     Figure 6.21
                                                                                                                     LM13700 equivalent circuit.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instruments

One of the first popular OTAs was the 3080. An improved version of this chip is the
LM13700. It features two amplifiers in a single package. Because OTAs are modeled
as output current sources, the LM13700 includes simple emitter follower buffers for
each OTA. Connection to the buffers is optional. Also included are input-linearizing
diodes that allow higher input levels, and thus, superior signal-to-noise performance.
The schematic of the LM13700 is shown in Figure 6.21. The differential amplifier
stage comprised of Q4 and Q5 is biased by Q2. The current set by Q2 establishes the
transconductance of this stage. Q2 is part of a current mirror made along with Q1 and
D1. Q2 mirrors the current flowing through Q1. The current flowing through Q1 is Iabc,
and is set externally. Thus, the differential amplifier is directly controlled by the
external current.

222
Example 6.5

         One example of OTA use is shown in Figure 6.22. This circuit is a simple
         voltage-controlled amplifier (VCA). Let's walk through the circuit to see
         how the component values were derived.

                                                                                       Figure 6.22
                                                                                       Voltage-controlled amplifier.

         The gain of the system is set by Vcontrol. The 22 k resistor is used to turn
         Vcontrol into Iabc. The maximum value for Iabc is specified as 1 mA. By
         referring to Figure 6.13, an expression for the maximum Iabc may be
         determined from Ohm's law.

                                          I abc= V +-V --V D1
                                                     Rcontrol

                                          Iabc= 5-(-5)-0.7 22 k
                                          I abc=423 A

         This places us at about half the allowed maximum, giving a twofold safety
         margin. The LM13700 transconductance graph indicates that we may expect
         a maximum value of about 10 millisiemens with our maximum Iabc. Note
         how the input signal must be attenuated in order to prevent overload. For
         reasonable distortion levels the input to the LM13700 should be below
         50 mV peak to peak. This is accomplished by the 33 k/470  voltage
         divider. This divider produces an input impedance of approximately 33 k,
         and a loss factor of

                                          Loss= 470 33 k+470
                                          Loss= 0.014

223
         This means that the circuit may amplify peak to peak signals as large as

                                         50 mV=V i n-max Loss
                                          V i n -max= 50 mV Loss
                                         V i n -max=3.56 V

         The current out of the LM13700 drives an LF411 configured as a current-to-
         voltage converter. The transresistance of this portion is 22 k. Using the
         maximum 50 mV input, the maximum output signal will be

                                          I out -13700=V i n- 13700 g m
                                          I out -13700=50 mV×10 ms
                                          I out -13700=500  A

         This current will drive the LF411 to a maximum output of

                                          V out= I out -13700 R f
                                          V out=500 A ×22 k
                                          V out=11 V

         With the signals shown, this circuit acts as a simple amplitude modulator.
         The Vcontrol signal is impressed upon the input signal. These are the audio and
         carrier signals, respectively. This setup can also be used as part of an AGC
         (automatic gain control) loop. Also, note the adjustable DC signal applied to
         the inverting input. This is used to null the amplifier. This is an important
         point. Any DC offset is also affected by the gain change, in effect causing
         the control signal to "leak" into the output. This can produce many
         undesirable side effects, including clicking and popping noises if the circuit
         is used as an audio VCA. By nulling the output offset, these effects are
         eliminated. In order to keep the inputs balanced, a 470 is added to the
         inverting input. Now, each input sees approximately 470  to ground.

When designing a VCA such as in the prior example, you usually start with known
maximum input and output voltages. The feedback resistor of the current-to-voltage
converter is chosen to yield the desired maximum output potential when the OTA is
producing its maximum output current. The OTA's maximum input potential times
its transconductance will yield the OTA's maximum output current. Once this current
has been established, the value of Rcontrol may be determined given the range of
Vcontrol. The maximum allowable OTA input potential is determined from the OTA
distortion graph, and in association with the desired maximum input voltage, dictates
the ratio of the input voltage divider.

224
OTAs may also be used to create voltage-controlled filters (VCF), where the cutoff
frequency is a function of Vcontrol. Discussion of filters in general is found in Chapter
Eleven. OTAs lend themselves to several unique applications. The down side is that
they have limited dynamic range. That is, the range of signal amplitudes that they
can handle without excessive distortion or noise is not as great as it is in many other
devices.

6.8 Norton Amplifier

It is possible to create an input-differencing function without using a differential
amplifier. One alternative is to use a current mirror arrangement to form a current
differencing amplifier. Because the input function deals with a difference of current
instead of voltage, amplifiers of this type are often referred to as Norton amplifiers.
Norton amplifiers have the distinct advantages of low cost and the ability to operate
from a single-polarity power supply. Perhaps the most popular Norton amplifier is
the LM3900. The LM3900 is a quad device, meaning that four amplifiers are
combined in a single package.

                                                                                                                     Figure 6.23
                                                                                                                     a. LM3900 schematic (left).
                                                                                                                     b. schematic symbol (below).

The internal circuitry of one Norton amplifer is shown in Figure 6.23a. Norton
amplifiers also use a slightly modified schematic symbol, shown in Figure 6.23b, to
distinguish them from ordinary op amps. The amplifier is comprised of two main
sections: a current-differencing input portion consisting of Q6 , Q7, and D1, and a
gain stage comprising Q1 through Q5. The current-differencing portion is of greatest
225
interest to us, and is based upon the current mirror concept. D1 and Q7 make up a
current mirror that is fed by the noninverting input's source current, I+. This current
flows down through D1, and is mirrored into Q7. Therefore, the collector current of
Q7 is equal to I+. This current is effectively subtracted from the current that enters
the inverting input. The differential current, I- - I+, is the net input current that feeds
Q6, and is amplified by the following stage. Note how the schematic symbol of
Figure 6.23b echoes the current mirror subtraction process.

                                                                                                                     Figure 6.24
                                                                                                                     Norton equivalent circuit.

Due to its unique input configuration, the equivalent model of the Norton amplifier
is rather different from the standard op amp. This is illustrated in Figure 6.24. This
clearly shows that the Norton amplifier is a current-sensing device. Also, note that
the input impedance for the noninverting input is little more than the dynamic
resistance of D+. This resistance is dependent on the input current, and may be found
using the standard diode resistance equation

     Zi n += 26 mV  (6.12)
               I+

Another important point is that both the inverting and noninverting inputs are locked
at approximately one diode drop above ground. This can be beneficial for a current
summing node, but it does require that some form of input resistor be used if a
voltage input is expected. A side benefit of this is that given a large enough input
resistor, there is virtually no limit to the input common-mode voltage range as the
potential will drop across the input resistor. For proper AC operation, an appropriate
biasing current must be used. A typical inverting amplifier is shown in Figure 6.25.

                                                                                        Figure 6.25
                                                                                        Typical inverting amplifier.

226
Note the input and output coupling capacitors, as well as RB, that serves to convert
the bias voltage into a bias current. A generalized model of this circuit is shown in
Figure 6.26. From this, we will be able to determine a voltage gain expression, and a
technique for determining a proper value for RB.

                                                                                                                     Figure 6.26
                                                                                                                     Generalized model of the
                                                                                                                     amplifier in Figure 6.25.
                                                                                                                     a. Bias equivalent (top).
                                                                                                                     b. AC equivalent (bottom).

We'll start by setting up an expression for the output voltage for the bias equivalent.

      V out=V D -+R f (I ++I B)

and,

      I += V supply-V D +
                 RB

Combining the above two equations yields

      ( ) V out=V D -+R f
      V supply-V D+ +I B                  (6.13)
            RB

Normally, Vsupply >> VD, and IB is relatively small. Given these factors, 6.13 may be
approximated as

227
             V out=V supply R f  (6.14)
                            RB

Therefore, for a midpoint bias,

             RB=2 R f            (6.15)

For the AC equivalent circuit, the gain equation may be derived in the same fashion
as it was in Chapter Four for a standard inverting op amp configuration.

             Av=- R f            (6.16)
                     Ri

As in the standard op amp inverting amplifier, the input impedance may be
approximated as Ri.

Example 6.6

     Using the LM3900, design an amplifier that operates from a single +9 V
     battery, has an inverting voltage gain of 20, an input impedance of at least
     50 k, and a lower break frequency of no more than 100 Hz.

     First, Ri may be established from the input impedance spec at 50 k. From
     here, both Rf and RB may be determined.

                                     Av=- R f
                                              Ri

                                     R f =- Av Ri
                                     R f =-(-20)×50 k 
                                     R f =1 M 

                                     RB=2 R f
                                     RB=2×1 M 
                                     RB=2M 

     The input coupling capacitor will be used to set the lower break frequency in
     association with Ri. This is basically unchanged from the single-supply bias
     calculations presented in Chapter Four.

228
                                 f c= 1 2  RC
                                C= 1

                                     2R f c
                                C= 1 2  50 k 100 Hz
                                C=31.8 nF

The completed circuit is shown in Figure 6.27. Although this circuit does
not detail the output coupling capacitor and load resistance, it would be
handled in a similar vein.

                                                                                          Figure 6.27
                                                                                          Completed design.

Computer Simulation

A Multisim simulation of the amplifier of Example 6.6 is shown in Figure 6.28. A
simple coupling network has been added to the output. The critical frequency of the
output network is approximately 1.6 Hz, well below the input network. In this way,
the input network is clearly dominant, and its effect on the system lower frequency
response can be seen clearly. The AC Analysis is plotted from 1 Hz to 10 kHz. The
midband gain is approximately 26 dB, yielding an ordinary gain of 20 as desired.
The lower end of the frequency response begins to roll off below 200 Hz, reaching
approximately 23 dB (i.e., 3 dB down) at the target frequency of 100 Hz. The
response continues its constant descent to the lower limit of the graph. Only a slight
increase in slope may be noted in the 1 to 2 Hz region. If the frequency range is
extended another decade lower, the effect of the output coupling network will be
more obvious.

One possible problem with the circuit presented in Example 6.6 is that any power
supply ripple present on Vsupply will be passed into the amplifier via RB, and appear at
the output. In order to minimize this problem, a power supply decoupling circuit
such as that presented in Chapter Four may be used.

229
                                                                                                                     Figure 6.28a
                                                                                                                     Simulation of LM3900
                                                                                                                     amplifier.

                                                                                                                     Figure 6.28b
                                                                                                                     Gain plot for LM3900
                                                                                                                     amplifier.

Figure 6.29 shows a typical inverting amplifier with a decoupling circuit added.
Note that RB is not set to twice Rf, but rather, is set equal to it. This is because RB is
only being driven by one half of the supply voltage due to the lower resistance
decoupling divider.
230
                                                                                     Figure 6.29
                                                                                     Optimized bias circuitry.

Norton amplifiers may be used in a variety of other configurations as well, including
noninverting and differential amplifiers. A simple noninverting amplifier is shown in
Figure 6.30. Unlike the ordinary op amp version, the Norton amplifier requires an
input resistor. Remembering that the input impedance of the noninverting input may
be quite low (Equation 6.12), we can derive equations for both circuit input
impedance and voltage gain.

                                                                                                                     Figure 6.30
                                                                                                                     Noninverting amplifier.

The input impedance is the series combination of Ri and the impedance looking into
the noninverting input, Zin+.

     Zi n= Ri +Zi n +         (6.17)

In order to find voltage gain, note that due to the virtual ground at the inverting
input, the drop across Rf is equivalent to Vout.

     V out=V Rf = R f I-      (6.18)

Vin drops across the system input impedance. Given Equation 6.17, we may say

     V i n= I +( Ri+Z i n +)  (6.19)

231
Because, by definition, Av = Vout/Vin, we may say

     Av= R f I-
          I + (Ri +Z i n+)

The two currents are identical in the AC equivalent circuit, so this simplifies to

     Av= R f                                       (6.20)
          R i+Z i n+

In summary, there are a few things that you should remember about Norton
amplifiers:

     · The inputs are current-sensing, and thus, require some form of input-current
         limiting resistance.

     · As with an ordinary op amp, voltage gain is set by the two feedback
         resistors.

     · A DC bias potential must be fed into the noninverting input via a current
         limiting resistor, RB. This resistor is normally twice the size of Rf.

6.9 Current Feedback Amplifiers

The current feedback amplifier is a unique device in the world of linear integrated
circuits. Its prime advantage is that it does not suffer from the strict gain/bandwidth
trade-off typical of normal op amps. This means that it is possible to increase its
gain without incurring an equal decrease in bandwidth. This has obvious advantages
for high-speed applications. Also, these devices tend to be free of slewing effects.

                                                                                         Figure 6.31
                                                                                         Current feedback amplifier
                                                                                         equivalent.

232
An equivalent model of a noninverting current feedback amplifier is shown in
Figure 6.31. This device uses a transimpedance source (i.e., a current-controlled
voltage source) to translate the feedback current into an output voltage. Instead of
relying on negative feedback to keep the inverting and noninverting terminals at the
same potential, the current feedback amplifier utilizes a unity-gain buffer placed
between the two inputs. In this manner, the potential that drives the noninverting
input must also appear at the inverting input. Also, the buffer exhibits a low output
impedance into or out of which the feedback current may flow. From this diagram
we may derive the general voltage-gain expression.

By inspection

                        V i n=V +=V -                        (6.21)

                        I 1= V i n                           (6.22)
                             R1

                        I 2= V out - V i n                   (6.23)
                                 R2

                        I f = I 1- I 2                       (6.24)

                        V out= Aol I f                       (6.25)

Combining 6.22, 6.23, and 6.24 with 6.25 yields

                        ( ) V out= Aol
                                        V i n - V out-V i n  (6.26)
                                        R1         R2

Simplification follows

                        V out = V i n -V out - V i n
                        Aol R1              R2

                        V out = V i n R2 -V out R1+V i n R1
                        A ol                R1 R2
               V out R1 R2 = V i n R2 -V out R1+V i n R1
               Aol

     V out R1 R2 +V out R1 = V i n( R2 +R1)
         Aol

     ( ) V out R1 R2 +R1 =V in ( R2+R1)                      (6.27)
             Aol

233
We now solve 6.27 in terms of Vout/Vin, which is Av.                                                   (6.28)

                                V out = R1+R2
                                V i n A R1 R2 +R1

                                                                                                   ol

                                   Av = R1+R2 R1 R2
                                          Aol +R1

                                      R2 +1

                                                    R1

                                Av= R
                                        2 +1

                                                    Aol

If, for convenience, we define R2/R1 + 1 as G, Equation 6.28 becomes

     Av= RG                                                                                            (6.29)
                      2
                 +1
             Aol

If Aol is sufficiently large, this may be approximated as

     Av =G

     Av= R2 +1                                                                                         (6.30)
          R1

Equation 6.30 is identical to the approximate gain equation for an ordinary
noninverting op amp stage. A closer look at the exact equation (6.29) reveals an
important difference with the exact series-parallel expression examined in Chapter
Three

     Av= Aol
          1+ Aol

As you may recall,  is the feedback factor and determines the closed loop gain. To
a first approximation,  Aol >> 1, and thus, the series-parallel gain is ideally 1/. As
frequency is raised, however, the value of Aol drops, and soon this approximation no
longer holds. It is very important to note that the point at which the idealization
ceases to be accurate is a function of . For higher closed-loop gains,  is smaller,
and thus, the  Aol product reaches unity at a lower frequency. It is this very
interdependency that causes the gain/bandwidth trade-off. A close look at Equation
6.29 shows no such interdependency. In this case, the denominator is not influenced
by the feedback factor. In its place is the fixed resistor value R2. Normally, R2 is set
by the manufacturer of the device, and is usually around 1 k to 2 k in size.
Closed-loop gain is set by altering the value of R1. This means that the closed-loop

234
upper-break frequency is not dependent on the closed-loop gain. This is the ideal
case. In reality, secondary effects will cause some decrease of f2 with increasing Av.
This effect is noticeable at medium to high gains, but is still considerably less than
what an ordinary op amp would produce. For example, a jump in gain from 10 to
100 may drop f2 from 150 MHz to only 50 MHz, whereas an ordinary device would
drop to 15 MHz.

The CLC1606 from Exar is one example of a current feedback amplifier. It boasts a       Figure 6.32
slew rate of 3300 V/s, a bandwidth of 1.3 GHz, and an output current capability of      CLC1606 current feedback
120 mA. This makes it ideal for applications such as high-speed line drivers or video   amplifier.
display drivers. The features and typical circuit are shown in Figure 6.32. Figure
6.33 shows the AC specifications. Note the small variation in f2 as the gain is         Reprinted courtesy of Exar
changed from 1 to 2. In a "normal" op amp the bandwidth would be halved.

235
                                                                                                                     Figure 6.33
                                                                                                                     CLC1606 specifications.

                                                                                                                                                   Reprinted courtesy of Exar

236
Example 6.7

         Design a noninverting 100 MHz amplifier with a voltage gain of 14 dB,
         utilizing the CLC1606.

         By design, the CLC1606 will meet our bandwidth requirement, as long as
         the desired gain is not excessive. A voltage gain of 14 dB translates to an
         ordinary gain of 5, which is not excessive. Rf is typically relatively low and
         assuming an Rf of 390 , we find

                                          Av =1 +390 R
                                          Rg= 390

                                               Av -1
                                          Rg= 390 5-1
                                          R g=97.5 

         As with any high-speed amplifier, care must be taken when laying out this
         circuit. Failure to do so may seriously degrade amplifier performance.

6.10 Other Specialized Devices

Op amps have been further refined into other specialized devices. Along with these,
a wide range of specialized linear integrated circuits have emerged. In the area of
simple amplifiers, devices are available that are designed to work primarily from
single polarity power supplies. Also, a large array of specialty amplifiers exist for
such applications as low noise audio pre-amplifiers. For very low offset applications,
specialized "auto zero" amplifiers are available. These amplifiers continually
monitor their DC offset and actively correct it.

Moving away from the strict confines of op amps, linear ICs are available for most
popular functions, making the designer's job even easier. Some of these items will
be explored in later chapters. Other devices are for very specific applications and
will not be covered here.

Some manufacturers develop ICs solely for specific market segments. As an
example, Analog Devices, THAT Corporation and Maxim make very specialized
ICs for audio and musical equipment manufacturers. The Analog Devices SSM line
includes high precision microphone pre-amps and low power loudspeaker and
headphone amplifiers. In like fashion, THAT Corporation makes voltage-controlled
amplifiers, balanced line drivers, dynamics processors and other items aimed at the

237
audio industry. Maxim makes a series of audio subsystem ICs for notebook PCs and
mobile communications. Of course, nothing prevents a designer from using one of
these ICs in a non-musical product.

Summary

In this chapter we have examined operational amplifiers that exhibit extended
performance, and those that have been tailored to more specific applications. In the
area of precision differential amplification comes the instrumentation amplifier.
Instrumentation amplifiers may be formed from three separate op amps, or they may
be purchased as single hybrid or monolithic ICs. Instrumentation amplifiers offer
isolated high impedance inputs and excellent common-mode rejection
characteristics.

Programmable op amps allow the designer to set desired performance
characteristics. In this way, an optimum mix of parameters such funity and slew rate
versus power consumption is achieved. Programmable op amps can also be set to a
very low power consumption standby level. This is ideal for battery powered
circuits. Generally, programming is performed by either a resistor for static
applications, or via an external current or voltage for dynamic applications.

The output drive capabilities of the standard op amp have been pushed to high
levels of current and voltage. Power op amps may be directly connected to low
impedance loads such as servo motors or loudspeakers. Moderate power devices
exist that have been designed for line drivers and audio applications. Due to the
higher dissipation requirements these applications produce, power op amps are often
packaged in TO-220 and TO-3 type cases.

Along with higher power devices, still other devices show increased bandwidth and
slewing performance. These fast devices are particularly useful in video
applications. Perhaps the fastest amplifiers are those that rely on current feedback
and utilize a transimpedance output stage. These amplifiers are a significant
departure from the ordinary op amp. They do not suffer from strict gain-bandwidth
limitations, and can achieve very wide bandwidth with moderate gain.

Operational transconductance amplifiers, or OTAs, may be used as building blocks
for larger circuits such as voltage-controlled amplifiers or filters. Norton amplifiers
rely on a current mirror to perform a current-differencing operation. They are
relatively inexpensive and operate directly from single-polarity power supplies with
little support circuitry. Because they are current-sensing, input limiting resistors are
required.

238
Review Questions

    1. What are the advantages of using an instrumentation amplifier versus a
         simple op amp differential amplifier?

    2. How might an instrumentation amplifier be constructed from general-
         purpose op amps?

    3. What are the advantages of using programmable op amps?
    4. What are the results of altering the programming current in a programmable

         op amp?
    5. Give at least two applications for a high-power op amp.
    6. Give at least two applications for a high-speed op amp.
    7. What is an OTA?
    8. How is an OTA different from a programmable op amp?
    9. Give an application that might use an OTA.
    10. Give at least three applications that could benefit from specialty linear

         integrated circuits.
    11. Describe how a Norton amplifier achieves input differencing.
    12. List a few of the major design differences that must be considered when

         working with Norton amplifiers versus ordinary op amps.
    13. Explain why a current feedback amplifier does not suffer from the same

         gain-bandwidth limitations that ordinary op amps do.

Problems

Analysis Problems

    1. An instrumentation amplifier has a differential input signal of 5 mV and a
         common-mode hum input of 2 mV. If the amplifier has a differential gain of
         32 dB and a CMRR of 85 dB, what are the output levels of the desired signal
         and the hum signal?

    2. Determine Vout in Figure 6.34 if Vin+ = +20 mV DC and Vin- = -10 mV DC.

                                                                                                                     Figure 6.34

239
    3. Repeat Problem 2 for a differential input signal of 10 mV peak to peak.
    4. Repeat Problem 3 for a differential input signal of 20 mV peak to peak and a

         common-mode signal of 5 mV peak to peak. Assume the system CMRR is
         75 dB.
    5. Determine the programming current in Figure 6.11 if Rset= 1 M. Assume
         standard ±15 V supplies.
    6. Using an LM4250 programmable amplifier, determine the following
         parameters if Iset = 5 A: slew rate, funity, input noise voltage, input bias
         current, standby supply current, and open loop gain.
    7. Determine the voltage gain, f2, and power bandwidth (assume Vp = 10 V) for
         the circuit of Figure 6.35.

                                                                        Figure 6.35

    8. The circuit of Figure 6.36 uses a light-dependent resistor to enable or disable
         the amplifier. Under full light, this LDR exhibits a resistance of 1 k, but
         under no light conditions, the resistance is 50 M. What are the standby
         current and funity values under full light and no light conditions?
                                                                        Figure 6.36

    9. Determine the required capacitance to set PSRR to at least 20 dB at 100 Hz
         for an LM386 power amp.

240
    10. What is the power bandwidth for a 5 V peak signal in Figure 6.20?
    11. Determine the device dissipation for an LM386 delivering 0.5 W into an

         8 ohm load. Assume a 12 V power supply is used.
    12. Determine the input resistance, output resistance and transconductance for

         an LM13700 OTA with Iabc = 100 A.
    13. Determine the value of Iabc in Figure 6.22 if Vcontrol = 0.5 VDC.
    14. Recalculate the value of Ri for the circuit of Figure 6.26 if a voltage gain of

         45 is desired.
    15. Recalculate the input capacitance value for the circuit of Figure 6.26 if a

         lower break frequency of 15 Hz is desired.

Design Problems
    16. Design an instrumentation amplifier with a gain of 20 dB using the LT1167.
    17. Utilizing the LM3900, design an inverting amplifier with a gain of 12 dB, an
         input impedance of at least 100 k, and a lower break frequency no greater
         than 25 Hz.
    18. Utilizing the LM3900, design a noninverting amplifier with a gain of 24 dB,
         an input impedance of at least 40 k, and a lower break frequency no
         greater than 50 Hz.
    19. Utilizing the CLC1606, design a noninverting amplifier with a gain of 6 dB.
    20. Utilizing the CLC1606, design an inverting amplifier with a gain of 12 dB.

Challenge Problems
    21. Using Figure 6.34 as a guide, design an instrumentation amplifier with a
         differential gain of 40 dB. The system bandwidth should be at least 50 kHz.
         Indicate which op amps you intend to use.

                                                                        Figure 6.37

241
    22. Determine the gain, f2, power bandwidth (Vp = 10 V), and standby current
         for the circuit of Figure 6.37 if Vb= 0 V, and if Vb = -15 V.

    23. Design a power amplifier with a voltage gain of 32 dB using the LM386.
    24. Determine Vout in Figure 6.22 if Vcontrol = 1 VDC and Vin = 100 mV sine wave.
    25. Sketch Vout for Figure 6.22 if Vcontrol(t) = 1 sin 2  1000 t, and

         Vin(t) = 0.5 sin 2  300,000 t.
    26. Alter Figure 6.22 such that a 100 mV input signal will yield a 1 V output

         signal when Vcontrol is +2 V.
    27. Derive Equation 6.9 from the text.
Computer Simulation Problems
    28. Use a simulator to verify the design produced in Problem 21.
    29. Simulate the output of the circuit shown in Figure 6.26. Use a +15 VDC

         power supply with Vin(t) = 0.01 sin 2  100 t.
    30. Use a simulator to verify the gain of the design produced in Problem 18.
    31. Device mismatching can adversely affect the CMRR of an instrumentation

         amplifier. Rerun the simulation of the instrumentation amplifier (Figure 6.5)
         with a ±5% tolerance applied to the value of Ri' (Rip). Based on these
         simulations, what do you think would happen if all of the circuit resistors
         had this same tolerance?

242
7 Nonlinear Circuits

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Understand the advantages and disadvantages of active rectifiers versus passive rectifiers.
    · Analyze the operation of various half- and full-wave precision rectifiers.
    · Analyze the operation of peak detectors, limiters, and clampers.
    · Utilize function generation circuits to alter the amplitude characteristics of an input signal.
    · Detail the usefulness of a Schmitt trigger and compare its performance to an ordinary open loop

         comparator.
    · Utilize dedicated comparator ICs, such as the LM311.
    · Analyze log and anti-log amplifiers, and multipliers.

7.1 Introduction

Besides their use as an amplification device, op amps may be used for a variety of other purposes. In this
chapter, we will look into a number of circuits that fall under the general classification of nonlinear applications.
The term nonlinear is used because the input/output transfer characteristic of the circuit is no longer a straight
line. Indeed, the characteristic may take on a wide variety of shapes, depending on the application. It might seem
odd to be studying nonlinear circuits when op amps are generally considered to be linear devices. Rest assured
that nonlinear elements are often essential tools in a larger system. The general usage of nonlinear elements is
that of wave shaping. Wave shaping is the process of reforming signals in a desired fashion. You might think of
it as signal sculpting.

Wave shaping runs the gamut from simple half-wave rectification up through transfer-function generation.
Although many of the applications presented in this chapter can be realized without op amps, the inclusion of
the op amp lends the circuit a higher level of precision and stability. This is not to say that the op amp versions
are always superior to a passive counterpart. Due to bandwidth and slew rate limitations, the circuits presented
perform best at lower frequencies - primarily in the audio range and below. Also, there are definite power
handling and signal level limitations. In spite of these factors, the circuits do see quite a bit of use in the
appropriate areas. Many of the applications fall into the instrumentation and measurement areas.

Besides the wave shaping functions, the other uses noted here are comparators and logarithmic amplifiers.
General-purpose comparators made from simple op amps were explained in Chapter 2. In this chapter,
specialized devices are examined, and their superiority to the basic op amp comparator is noted.

243
Logarithmic amplifiers have the unique characteristic of compressing an input
signal. That is, the range of signal variation is reduced. The mirror image of the log
amplifier is the anti-log amplifier. It increases the range of input signal variation.

7.2 Precision Rectifiers

Imagine for a moment that you would like to half-wave rectify the output of an              Figure 7.1
oscillator. Probably the first thing that pops into your head is the use of a diode, as in  Passive rectifier.
Figure 7.1. As shown, the diode passes positive half waves and blocks negative half-
waves. But, what happens if the input signal is only 0.5 V peak? Rectification never
occurs because the diode requires 0.6 to 0.7 V to turn on. Even if a germanium
device is used with a forward drop of 0.3 V, a sizable portion of the signal will be
lost. Not only that, the circuit of Figure 7.1 exhibits vastly different impedances to
the driving source. Even if the signal is large enough to avoid the forward voltage
drop difficulty, the source impedance must be relatively low. At first glance it seems
as though it is impossible to rectify a small AC signal with any hope of accuracy.

One of the items noted in Chapter 3 about negative feedback was the fact that it
tended to compensate for errors. Negative feedback tends to reduce errors by an
amount equal to the loop gain. This being the case, it should be possible to reduce
the diode's forward voltage drop by a very large factor by placing it inside of a
feedback loop. This is shown in Figure 7.2, and is called a precision half-wave
rectifier.

                                                                                            Figure 7.2
                                                                                            Precision half-wave rectifier.

To a first approximation, when the input is positive, the diode is forward-biased. In
essence, the circuit reduces to a simple voltage follower with a high input impedance
and a voltage gain of one, so the output looks just like the input. On the other hand,
when the input is negative, the diode is reverse-biased, opening up the feedback
loop. No signal current is allowed to the load, so the output voltage is zero. Thanks
to the op amp, though, the driving source still sees a high impedance. The output
waveform consists of just the positive portions of the input signal, as shown in
Figure 7.3. Due to the effect of negative feedback, even small signals may be
properly rectified. The resulting transfer characteristic is presented in Figure 7.4. A
perfect one-to-one input/output curve is seen for positive input signals, whereas
negative input signals produce an output potential of zero.

244
Vout
                                                                                                  Figure 7.3
                                                                                                  Output signal.

                                                                         t

In order to create the circuit output waveform, the op amp creates an entirely                                                                     Figure 7.4
different waveform at its output pin. For positive portions of the input, the op amp                                                               Transfer characteristic.
must produce a signal that is approximately 0.6 to 0.7 V greater than the final circuit
output. This extra signal effectively compensates for the diode's forward                                                                               Vout
drop. Because the feedback signal is derived after the diode, the                                                                                          +
compensation is as close as the available loop gain allows. At low
frequencies where the loop gain is high, the compensation is almost                                                                                                                + Vin
exact, producing a near perfect copy of positive signals. When the input
signal swings negative, the op amp tries to sink current in response. As                                                                                   -
it does so, the diode becomes reverse-biased, and current flow is halted.
At this point the op amp's noninverting input will see a large negative potential relative to the inverting input. The resulting negative error -
signal forces the op amp's output to go to negative saturation. Because
the diode remains reverse-biased, the circuit output stays at 0 V. The op
amp is no longer able to drive the load. This condition will persist until
the input signal goes positive again, at which point the error signal
becomes positive, forward-biasing the diode and allowing load current
to flow. The op amp and circuit output waveforms are shown in Figure 7.5.

V                                                                                                                                                  Figure 7.5
                                                                                                                                                   Output of op amp.
               .7 v

                                                     Vin
                                                                                    t

                             voltage at
                             point A

               -Vsat

245
One item to note about Figure 7.5 is the amount of time it takes for the op amp to
swing in and out of negative saturation. This time is determined by the device's slew
rate. Along with the decrease of loop gain at higher frequencies, slew rate
determines how accurate the rectification will be. Suppose that the op amp is in
negative saturation and that a quick positive input pulse occurs. In order to track
this, the op amp must climb out of negative saturation first. Using a 741 op amp with
±15 V supplies, it will take about 26 s to go from negative saturation (-13 V) to
zero. If the aforementioned pulse is only 20 s wide, the circuit doesn't have enough
time to produce the pulse. The input pulse will have gone negative again, before the
op amp has a chance to "climb out of its hole". If the positive pulse were a bit
longer, say 50 s, the op amp would be able to track a portion of it. The result would
be a distorted signal as shown in Figure 7.6.

     Vout                                                                              Figure 7.6

                                                                                       High frequency errors.

           t

In order to accurately rectify fast moving signals, op amps with high funity and slew
rate are required. If only slow signals are to be rectified, it is possible to configure
the circuit with moderate gain if needed, as a cost-saving measure. This is shown in
Figure 7.7. Finally, for negative half-wave output, the only modification required is
the reversal of the diode.

                                                                                                                     Figure 7.7
                                                                                                                     Rectifier with gain.

246
Computer Simulation

A Multisim simulation of the circuit shown in Figure 7.2 is presented in Figure 7.8.
The circuit is shown redrawn with the nodes labeled. This example utilizes the 741
op amp model examined earlier. The output waveform is also shown in Figure 7.8.
Note the accuracy of the rectification. The output of the op amp is also shown so that
the effects of negative feedback illustrated in 7.5 are clearly visible. Because this
circuit utilizes an accurate op amp model, it is very instructive to rerun the
simulation for higher input frequencies. In this way, the inherent speed limitations of
the op amp are shown, and effects such as those presented in Figure 7.6 may be
noted.

                                                                                                                     Figure 7.8a
                                                                                                                     Precision rectifier simulation
                                                                                                                     schematic.

                                                                                                                     Figure 7.8b
                                                                                                                     Output waveforms of precision
                                                                                                                     rectifier.

247
Peak Detector

One variation on the basic half-wave rectifier is the peak detector. This circuit will
produce an output that is equal to the peak value of the input signal. This can be
configured for either positive or negative peaks. The output of a peak detector can be
used for instrumentation or measurement applications. It can also be thought of as an
analog pulse stretcher.

A simple positive peak detector is shown in Figure 7.9. Here is how it works: The
first portion of the circuit is a precision positive half-wave rectifier. When its output
is rising, the capacitor, C, is being charged. This voltage is presented to the second
op amp that serves as a buffer for the final load. The output impedance of the first op
amp is low, so the charge time constant is very fast, and thus the signal across C is
very close to the input signal. When the input signal starts to swing back toward
ground, the output of the first op amp starts to drop along with it. Due to the
capacitor voltage, the diode ends up in reverse-bias, thus opening the drive to C. C
starts to discharge, but the discharge time constant will be much longer than the
charge time constant. The discharge resistance is a function of R, the impedance
looking into the noninverting input of op amp 2, and the impedance looking into the
inverting input of op amp 1, all in parallel. Normally, FET input devices are used, so
from a practical standpoint, R sets the discharge rate.

                                                                                                                     Figure 7.9
                                                                                                                     Peak detector.

The capacitor will continue to discharge toward zero until the input signal rises        Figure 7.10
enough to overtake it again. If the discharge time constant is much longer than the      Effect of  on pulse shape.
input period, the circuit output will be a DC value equal to the peak                Vout long 
value of the input. If the discharge time constant is somewhat
shorter, it has the effect of lengthening the pulse time. It also has                                         Vout short 
the effect of producing the overall contour, or envelope, of
complex signals, so it is sometimes called an envelope detector.                                                                t
Possible output signals are shown in Figure 7.10. For very long                       Vin
discharge times, large capacitors must be used. Larger capacitors
will, of course, produce a lengthening of the charge time (i.e., the
rise time will suffer). Large capacitors can also degrade slewing
performance. C can only be charged so fast because a given op
amp can only produce a finite current. This is no different than the

248
case presented with compensation capacitors back in Chapter Five. As an example,
if C is 10 F, and the maximum output current of the op amp is 25 mA,

                                   i=C dvdt
                                dv = i
                                dt C
                                dvdt =25 mA 10 F
                                dvdt =2500 V/s
                                dvdt =2.5 mV/ s

This is a very slow slew rate! If FET input devices are used, the effective discharge
resistance can be very high, thus lowering the requirement for C. For typical
applications, C would be many times smaller than the value used here. For long
discharge times, high quality capacitors must be used, as their internal leakage will
place the upper limit on discharge resistance.

Example 7.1

         A positive peak detector is used along with a simple comparator in Figure
         7.11 to monitor input levels and warn of possible overload. The LF412 is a
         dual-package version of the LF411. Explain how it works and determine the
         point at which the LED lights.

                                                                                                                     Figure 7.11
                                                                                                                     Detector for Example 7.1.

         The basic problem when trying to visually monitor a signal for overloads is
         that the overloading peak may come and go faster than the human eye can
         detect it. For example, the signal might be sent to a comparator that could
         light an LED when a preset threshold is exceeded. When the input signal
         falls, the comparator and LED will go into the off state. Even though the

249
         LED does light at the peak, it remains on for such a short time that humans
         won't notice it. This sort of result is quite possible in the communications
         industry, where the output of a radio station's microphone will produce very
         dynamic waves with a great many peaks. These peaks can cause havoc in
         other pieces of equipment down the line. The LED needs to remain on for
         longer periods.

         The circuit of Figure 7.11 uses a peak detector to stretch out the positive
         pulses. These stretched pulses are then fed to a comparator, which drives an
         LED. The input pulses are expanded, so the LED will remain on for longer
         periods.

         The discharge time constant is set by R and C. Because FET input devices
         are used, their impedance is high enough to ignore.

                                         T=RC
                                         T =10 M ×10 nF
                                         T =100 ms

         The 10 nF capacitor is small enough to maintain a reasonable slew rate. You
         may wish to verify this as an exercise. The comparator trip point is set by
         the 10 k/5 k voltage divider at 5 V. When the input signal rises above
         5 V, the comparator output goes high. Assuming that the LED forward drop
         is about 2.5 V, the 500  resistor limits the output current to

                                          I LED= V sat-V LED 500
                                          I LED= 13V-2.5 V 500
                                          I LED= 10.5 V 500
                                          I LED= 21 mA

         The LF412 should be able to deliver this current.

         In summary, then, the input pulses are stretched by the peak detector. If any
         of the resulting pulses are greater than 5 V, the comparator trips, and lights
         the LED. An example input/output wave is shown in Figure 7.12. The one
         problem with this is that only positive peaks are detected. If large negative
         peaks exist, they will not cause the LED to light. It is possible to use a
         similar circuit to detect negative peaks and use that output to drive a
         common LED along with the positive peak detector. Another way to
         accomplish this is to utilize a full-wave rectifier/detector.

250
         peak detector output                                                               Figure 7.12
                                                                                            Waveforms for the circuit of
                   Vin t                                                                    Figure 7.11.

+5 V  LED lights
      peak detector output

                                                t

Precision Full-Wave Rectifier

A full-wave rectifier has the input/output characteristic shown in Figure 7.13. No          Figure 7.13
matter what the input polarity is, the output is always positive. For this reason, this     Transfer characteristic for full-
circuit is often referred to as an absolute value circuit. The design of a precision full-  wave rectification.
wave rectifier is a little more involved than the single-polarity types. One way of
achieving this design is to combine the outputs of negative and positive half-wave
circuits with a differential amplifier. Another way is shown in Figure 7.14.

                                                              Vout
                                                                 +

      - + Vin

                                                                 -

251
                                                                                                                    Figure 7.14
                                                                                                                    Precision full-wave rectifier.

The precision rectifier of circuit 7.14 is convenient in that it only requires two op
amps and that all resistors (save one) are the same value. This circuit is comprised of
two parts: an inverting half-wave rectifier and a weighted summing amplifier. The
rectifier portion is redrawn in Figure 7.15. Let's start the analysis with this portion.

                                                                                                                    Figure 7.15
                                                                                                                    Inverting half-wave rectifier.

First, note that the circuit is based on an inverting voltage amplifier, with the diodes
D1 and D2 added. For positive input signals, the input current will attempt to flow
through Rf, to create an inverted output signal with a gain of Rf/Ri. (Normally, gain is
set to unity.) Because the op amp's inverting input is more positive than its
noninverting input, the op amp tries to sink output current. This forces D2 on,
completing the feedback loop, while also forcing D1 off. As D2 is inside the feedback
loop, its forward drop is compensated for. Thus, positive input signals are amplified
and inverted as in a normal inverting amplifier.
If the input signal is negative, the op amp will try to source current. This turns D1 on,
creating a path for current flow. Because the inverting input is at virtual ground, the
output voltage of the op amp is limited to the 0.6 to 0.7 V drop of D1. In this way,
the op amp does not saturate; rather, it delivers the current required to satisfy the
source demand. The op amp's output polarity also forces D2 off, leaving the circuit
output at an approximate ground. Therefore, for negative input signals, the circuit
output is zero. The combination of the positive and negative input swings creates an
inverted, half-wave rectified output signal, as shown in Figure 7.16. This circuit can
be used on its own as a half-wave rectifier if need be. Its major drawback is a

252
somewhat limited input impedance. On the plus side, because the circuit is non-                      Figure 7.16
saturating, it may prove to be faster than the half-wave rectifier first discussed.                  Output of half-wave rectifier.

                                                Vin

                                                                                                  t
                                                VA

The voltage at point A in Figure 7.14 is the output of the half-wave rectifier as                    Figure 7.17
shown in Figure 7.16. This is one of two signals applied to the summer configured                    Combination of signals
around op amp 2. The other input to the summer is the main circuit's input signal.                   produces output.
This signal is given a gain of unity, and the half-wave signal is given a gain of two.
These two signals will combine as shown in Figure 7.17 to create a positive full-
wave output. Mathematically,

For the first 180 degrees:

                                V out=- K sin  t +2 K sin  t
                                V out= K sin t

For the second 180 degrees:

                                V out= K sin t +0
                                V out= K sin t

In order to produce a negative full-wave rectifier, simply reverse the polarity of D1
and D2.

               t  +                       t  =                                                                               t

     inverted        inverted, times two

253
An example application of an op amp-based rectifier is shown in Figure 7.18. This         Figure 7.18
circuit is used detect dangerous overloads and faults in an audio power amplifier.        Power amplifier overload
Short-term signal clipping may not be a severe problem in certain applications;           detector.
however, long-term clipping may create very stressful conditions for the
loudspeakers. This would also be the case if an improperly functioning power
amplifier produced a DC offset. Unfortunately, a simple scaled comparison of the
input and output signals of the power amplifier may be misleading. In order to
compare long-term averages, the input and scaled output signals are precision full-
wave rectified and then passed through a peak-detecting or averaging stage. This
might be as simple as a single RC network. These signals are then compared by the
fault stage. If there is a substantial difference between the two signals, the amplifier
is most likely clipping the signal considerably or producing an unwanted DC offset.
The fault stage can then light a warning LED, or in severe cases, trip system shut-
down circuitry to prevent damage to other components.

absolute value  peak detector/averager

                                             comparison                                   display
                                             fault circuit                                shutdown

                absolute value

                                        peak detector/averager

                                loudspeaker

power amp

7.3 Wave Shaping

Active Clampers

Clampers are used to add a specific amount of DC to a signal. Generally, the amount
of DC will be equal to the peak value of the signal. Clampers are intelligent in that
they can adjust the amount of DC if the peak value of the input signal changes.
Ideally, clampers will not change the shape of the input signal; rather, the output
signal is simply a "vertically shifted" version of the input, as shown in Figure 7.19.
One common application of the clamper is in television receivers. Here, a clamper is
referred to as a DC restorer. Certain portions of the video signal, such as sync
pulses, are required to be at specific levels. After the video signal has been amplified
by AC coupled gain stages, the DC restorer returns the video to its normal

254
orientation. Without the clamping action, the various parts of the signal cannot be       Figure 7.19
decoded properly. Clampers are commonly made with passive components, just as             Effect of clampers on input
rectifiers are. Like rectifiers, simple clampers produce errors caused by the diode's     signal
forward voltage drop. Active clampers remove this error.                                  a. input signal (left)
                                                                                          b. clamped outputs (right).

Vin                          Vout         positive clamp

                          t                                                               t

                                   negative clamp

Conceptually, a clamper needs to sense the amplitude of the input signal and create a     Figure 7.20
DC signal of equal value. This DC signal is then added to the input, as shown in          Simple clamper model.
Figure 7.20. If the peak value is known, and does not change, it is possible to create
this function with a summing amplifier. If the signal level is dynamic, a different
course needs to be taken. The trick is in getting the DC source to properly track input
level changes. Obviously, a simple DC supply is not appropriate; however, a charged
capacitor will fit the bill nicely -- as long as its discharge time constant is much
longer than the period of the input wave. All that needs to be done is to have the
capacitor charge to the peak level of the input. When the capacitor voltage is added
to the input signal, the appropriate DC shift will result.

Figure 7.21 shows an active positive clamper. On the first negative going peak of the
input, the source will attempt to pull current through the capacitor in the direction
shown. This forces the inverting input of the op amp to go slightly negative, thus
creating a positive op amp output. The result of this action will be to forward-bias
the diode and supply charging current to the capacitor. The capacitor will charge to
the negative peak value of the input. The output resistance of the op amp is very
low, so charging is relatively fast, only being limited by the maximum output current
of the op amp. When the source changes direction, the op amp will produce a
negative output, thus turning off the diode and effectively removing the op amp
from the circuit. Because the discharge time for C is much longer than the input
period, its potential stays at roughly Vp-. It now acts like a voltage source. These two
sources add, so we can see that the output must be:

     V out=V i n+|V p -|           (7.1)

255
                                                                                                                     Figure 7.21
                                                                                                                     Active positive clamper.

The op amp will remain in saturation until the next negative peak, at which point the
capacitor will be recharged. During the charging period, the feedback loop is closed,
and thus, the diode's forward drop is compensated for by the op amp. In other words,
the op amp's output will be approximately 0.6 to 0.7 V above the inverting input's
potential. The discharge time of the circuit is set by the load resistor, Rl. If
particularly long time constants are required, a buffer stage may be used, along with
an FET input clamping op amp. The resistor R is used to prevent possible damage to
the op amp from capacitor discharge. This value is normally in the low kilohm
region. In order to make a negative clamper, just reverse the polarity of the diode.
Sometimes, it is desirable to clamp a signal and add a fixed offset as well. An
example output waveform of this type is shown in Figure 7.22.

                      Vout
                                                                                                                     Figure 7.22
                                                                                                                     Clamped output with offset.

                                                            offset

                                                                                        t

This function is relatively easy to add to the basic clamper. In order to include the
offset, all that needs to be done is to change the op amp's reference point. In the
basic clamper, the noninverting input is tied to ground. Consequently, this
establishes the point at which the charge/discharge cycle starts. If this reference is
altered, the charge/discharge point is altered too. To create a positive offset, a DC
signal equal to the offset is applied to the noninverting input, as shown in Figure
7.23. A similar arrangement may be used for negative clampers.

256
                                                                                                                     Figure 7.23
                                                                                                                     Active positive clamper with
                                                                                                                     offset.

Example 7.2
         An active clamper is shown in Figure 7.24. An LF412 op amp is used (a
         dual LF411). Determine the capacitor's voltage and verify that the time
         constant is appropriate for the input waveform. Also, sketch the output
         waveform and determine the maximum differential input voltage for the first
         op amp.

                                                                                                                     Figure 7.24
                                                                                                                     Active clamper circuit (top) and
                                                                                                                     input waveform (bottom) for
                                                                                                                     Example 7.2.

         Vin

          +3 V

        -1 V t

                                            1 kHz

257
     Because this is a positive clamper, the capacitor's voltage is the sum of the     Figure 7.25
     offset potential and the negative peak potential of the input waveform. Voffset   Output of clamper for
     is set by the 10 k/1.5 k divider.                                                 Example 7.2.

                                     V offset=V CC R2
                                                    R1 +R 2

                                     V offset=15 V 1.5 k 10 k+1.5 k
                                     V offset=1.96 V

                                     V c =V offset+|V p- |
                                     V c=1.96V+|-1V|
                                     V c=2.96V

     This is the amount of DC added to the input signal. The output waveform
     will look just like the input, except that it will be shifted up by 2.96 V. This
     is shown in Figure 7.25.

              Vin

            5.96 V

            1.96 V

                                                                             t

     The discharge time constant should be much larger than the period of the
     input wave. The input wave has a frequency of 1 kHz, and thus, a period of
     1 ms. The capacitor discharges through the load resistor. As FET input op
     amps are used, their effect on the discharge rate is minimal.

                                     T =Rl C
                                     T =10 M×10nF
                                     T =0.1 s

     The discharge rate is 100 times longer than the input period, so the capacitor
     droop will be satisfactory.

     The maximum differential input signal is the worst-case difference between
     the inverting and noninverting input potentials. The noninverting input is
     tied directly to 1.96 V. The inverting input sees the output waveform. The
     maximum value of the output is 5.96 V. So the difference is

258
                                         V i n - diff =V i n +-V in -
                                         V i n -diff =1.96 V-5.96 V
                                         V i n -diff =-4 V
         The LF412 will have no problem with a differential input of this size.

Computer Simulation

A simulation of the clamper circuit of Example 7.2 is shown in Figure 7.26. In order
to simplify the simulation somewhat, the input signal has been altered modestly.
Instead of the shifted 4 volt peak-to-peak full-wave rectified signal originally used, a
shifted 4 volt peak-to-peak sine wave is used.

                                                                                                                     Figure 7.26a
                                                                                                                     Clamper schematic in
                                                                                                                     Multisim.

Both the input and output waveforms are plotted in the Transient Analysis. The
circuit requires about 1 cycle of the waveform before the output stabilizes. After that
point the clamping action and shift of nearly 2 volts is quite evident in the output
waveform. There is no noticeable droop, scaling error, or obvious distortion in the
output either, although some minor aberrations can be seen at the negative peaks on
occasion.

259
                                                                                             Figure 7.26b
                                                                                             Clamper waveforms.

Active Limiters                                                                              Figure 7.27
                                                                                             Active limiter.
A limiter is a circuit that places a maximum restriction on its output level. The
output of a limiter can never be above a specific preset level. In one sense, all active
circuits are limiters, in that they will all eventually clip the signal by going into
saturation. A true limiter, though, prohibits the signal at levels considerably lower
than saturation. The exact level is fairly easy to set. Limiters can be used to protect
following stages from excessive input levels. They can also be seen as a type of
wave shaper. One form of limiter was shown in Chapter Six, in the Pocket Rockit's
schematic. In that circuit, a limiter was used to purposely clip the music signal for
artistic effect. The limitation of that form is that the limit potential is locked at ±.7 V
by the parallel signal diodes. For a more general form, an arbitrary limit potential is
desired. Instead of using parallel signal diodes, a series combination of Zener diodes
will prove useful.

An example limiter is shown in Figure 7.27. It is based
upon the inverting voltage amplifier form. As long as the
output signal is below the Zener potential, the output equals
the input times the voltage gain. If the output voltage tries
to rise above the Zener potential, one of the diodes will go
into Zener conduction, and the other diode will go into
forward bias. Once this happens, the low dynamic
resistance of the diodes will disallow any further increase in

260
output potential. The output will not be allowed to move outside of the Zener
potential (plus the 0.7 V turn-on for the second diode):

             |V out | V zener+0.7 V                                  (7.2)

Or we might reword this as

             V limit=±(V zener+0.7 V )                               (7.3)

This effect is shown graphically in Figure 7.28, the limiter's transfer characteristic.

                            Vout                                                         Figure 7.28
                              +                                                          Transfer characteristic of
                                                                                         limiter.
                                Vz +.7 V

                                                 slope = - R f /R i

             - + Vin

                            -(Vz +.7 V)

                                              -

Example 7.3

     If the input to the circuit of Figure 7.29 is a 4 V peak triangle wave, sketch      Figure 7.29
     Vout.                                                                               Limiter for Example 7.3.

     Without the Zener limit diodes, this amplifier would simply multiply the
     input by a gain of two and invert it.

                                     V out= Av V i n
                                     V out= -2× 4 V(peak)
                                     V out= -8 V(peak)

     So, an inverted 8 V peak triangle would be the output. With the
     inclusion of the diodes, the maximum output is

261
        V limit=±(V zener+0.7 V )
        V limit=±(5.1 V +0.7 V)
        V limit=±5.8 V

Consequently, the output wave is clipped at 5.8 V, as shown in Figure 7.30.

By using different Zeners, it is also possible to produce asymmetrical
limiting. For example, positive signals might be limited to 10 V, whereas
negative signals could be limited to -5 V.

Vin     output with  output without                                                      Figure 7.30
        limiter      limiter                                                             Input/output signals of
  8 V                                                                                    limiter for Example 7.3.

5.8 V

  4 V

                                     t

  -4 V  input
-5.8 V

  -8 V

7.4 Function Generation

Function generation circuits are used to create arbitrary transfer characteristics.
These can be used for a variety of purposes, including transducer linearization and
sine shaping. Indeed, many modern laboratory signal generators do not directly
create a sine wave; rather, they generate a triangle wave and pass it through a
function circuit, which will then produce the desired sine wave. In essence, a
function circuit gives different gains to different parts of the input signal. It
impresses its shape on the input waveform. If a "straight sided" waveform such as a
ramp or triangle is fed into a function circuit, the resulting output waveform will
bear a striking resemblance to the circuit's transfer curve. (This effect can be put to
good use when investigating function circuits via computer simulation.)

Basically, there are two ways in which to create a function circuit with an op amp.
The first way is an extension of the Zener limiter circuit. The second form relies on a
biased-diode network. In both cases, the base circuit form is that of an inverting-

262
voltage amplifier. Also, both techniques allow the resulting transfer curve's slope to
increase or decrease at specified break points and rates.

                                                                                                                     Figure 7.31
                                                                                                                     Simple function generator.

A simple function circuit is shown in Figure 7.31. Note that it is very similar to the      Figure 7.32
limiter of Figure 7.27. The only difference is the inclusion of Ra. Below the Zener         Transfer characteristic
potential, the circuit gain is still set by Rf. When the Zener potential is eventually      (decreasing slope).
reached, the diodes can no longer force the output to an unchanging value, as Ra is in
series with them. Instead of an ideal shunt across Rf as in the limiter, Rf is effectively
paralleled by Ra. In other words, once the Zener potential is reached, the gain drops
to (Rf||Ra)/Ri. This is shown in Figure 7.32. To be a bit more precise, the gain change
is not quite so abrupt as this approximation. In reality, the transfer curve is smoother
and somewhat delayed, as indicated by the dashed line.

                                                       Vout
                                 real +

approximation               Vz +.7 V

                                                       slope = - Rf /Ri

- + Vin

                                      slope = - (R f ||Ra) /Ri

               -(Vz +.7 V)

                                                           -

In order to achieve an increasing slope, the Zener/resistor combination is placed in
parallel with Ri. When the Zener potential is reached, Ra will effectively parallel Ri,
reducing gain. This has the unfortunate side effect of reducing the input impedance,

263
so it may be necessary to include an input buffer. An example circuit and resulting
transfer curve are shown in Figure 7.33.

                                                                                                                     Figure 7.33a
                                                                                                                     Simple function generator,
                                                                                                                     increasing gain.

                             Vout                                                            Figure 7.33b
                                +                                                            Transfer characteristic,
                                                                                             increasing slope.
   slope = - Rf /(Ri ||Ra )

                                   slope = - Rf /Ri                                   + Vin
                                             Vz +.7 V

-  -(Vz +.7 V)

                                                             slope = - Rf /(Ri ||Ra)         Figure 7.34a
                                                                                             Multiple section function
                                                    -                                        generator.

If more than two slopes are required, it is possible to parallel
multiple Zener/resistor combinations. This technique can be used
to create a piece-wise linear approximation of a desired transfer
characteristic. A two-section circuit is shown in Figure 7.34.
Note how the resistors are constantly placed in parallel, thus
reducing gain. If this multiple-section technique is used with a
circuit such as the one in Figure 7.33, the gain will increase.

264
              Vout                                                                  Figure 7.34b
                +                                                                   Transfer characteristic for
                                                                                    multiple section generator.
                   Vzb +.7 V

                   Vza +.7 V

     - + Vin

     -Rf /Ri                                              -(Rf ||Ra) /Ri

                                                          -(Rf ||Ra||Rb)/Ri

                                                       -

Example 7.4

     Given the circuit in Figure 7.35, sketch its transfer curve.                   Figure 7.35
                                                                                    Function generator for
     The first step is to note the break points in the curve. Because this circuit  Example 7.4.
     uses a decreasing gain scheme with diodes across Rf, the output break points
     are set by the Zener potentials. Also note that the break points are
     symmetrical about zero as identical diodes are used.

                                     V break=±(V z+0.7 V )
                                     V break=±(3.9 V +0.7 V )
                                     V break=±4.6 V

     The next item to determine is the base voltage gain. This
     is the gain without the Zener/resistor effect.

                                     Av=- R f
                                            Ri

                                     Av=-20 k 5 k
                                     Av =-4

265
The second level gain occurs when the diodes are on, placing Ra in parallel              Figure 7.36
with Rf.                                                                                 Transfer characteristic of
                                                                                         the circuit in Figure 7.35.
Av2= -R f || Ra                                                   -1.33
          Ri                                                                           Vout
                                                                                         +
Av2=-20k ||10 k 5 k
Av2=-1.33

The resulting plot is shown in Figure 7.36. In order              -4                   4.6 V            + Vin
to find the break point for the input signal (in this                  -1.15 V             1.15 V
case only the output break is found), you need to                                                  -1.33
divide the output break by the slope of the transfer                     -4.6 V
curve. For an output of 4.6 V, the input signal will be -
4 times less at 1.15 V. If multiple sections are used,                                 -
the changes due to each section are added in order to
find the corresponding input signal. If the circuit is
an increasing-gain type (as in Figure 7.33), then the
input break points are known, and the output points
are found by multiplying by the slope. Both of these
items are illustrated in the following example.

Example 7.5
         Draw the transfer curve for the circuit of Figure 7.37.

                                                                                       Figure 7.37
                                                                                       Multiple section circuit for
                                                                                       Example 7.5.

         All diode pairs are identical, so symmetry is maintained. By inspection, the
         input break points are:

                                         V break1-i n=1.0 V +0.7 V =1.7 V
                                         V break2 -in= 2.2 V +0.7 V=2.9 V

266
The base gain is

                                Av= - R f                                         Figure 7.38
                                         Ri                                       Characteristic of multiple
                                                                                  section circuit of Figure 7.37.
                                Av= -12 k 10 k
                                Av= -1.2                                         Vout
                                                                                    +
The second level gain is
                                                                  -2.6
                                Av2= - R f
                                          Ri || Ra                                    -1.8

                                Av2=- 12 k 10 k ||20 k                                         -1.2
                                Av2 = -1.8
                                                               -                                     1.7 V 2.9 V
The third level gain is
                                                                                                                       Vin
                                Av3= - R f                                                           +
                                         Ri || Ra || Rb                               -2.04 V

                                Av3=- 12 k 10 k ||20 k ||15 k                         -4.2 V
                                Av3 = -2.6
                                                                                               -
The corresponding output breaks are

                  V break1- out= Av V break1 -i n

                  V break1- out=-1.2×1.7
                  V break1- out=-2.04 V

                  V break2 - out=V break1- out +Av2( V break2 - in - V break1 - in )

                  V break2 -out=-2.04 V+(-1.8)×(2.9 V-1.7 V)
                  V break2 -out=-4.2 V

The resulting curve is shown in Figure 7.38.

Example 7.6

         A temperature transducer's response characteristic is plotted in Figure 7.39.
         Unfortunately, the response is not consistent across a large temperature
         range. At very high or low temperatures, the device becomes more sensitive.

267
     Design a circuit that will compensate for this error, so that the output will    Figure 7.39
     remain at a sensitivity of 1 V/10 C° over a large temperature range.             Temperature transducer's
                                                                                      response for Example 7.6.
                                         Vout
                                            +

                                                                  1 V/ 8 Cº

                                                3 V

            -40ºC                +30ºC             + Vin
                              1 V/ 10 Cº
     -               -4 V

     1 V/ 8 Cº

                         -

     First of all, in order to compensate for an increasing curve, a mirror image     Figure 7.40
     decreasing curve is called for. The circuit will only need a single diode        Desired transfer curve for
     section; however, it will not be symmetrical. The positive break occurs at 30    Example 7.6.
     degrees (3 V), and the negative break occurs at -40 degrees (-4 V). In this
     range the gain will remain at unity. Outside of this range, the gain must fall.
     In order to bring a ratio of 1 V/8 C° back to 1 V/10 C°, it must be multiplied
     by its reciprocal - a gain of 8/10. The desired transfer curve is shown in
     Figure 7.40.

                                       Vout
                                          +

                                             .8:1
                     3 V

     -                        1:1                  + Vin
                     -4 V
               .8:1
                     -

268
         If Rf and Ri are arbitrarily chosen to be 10 k, the resulting combination of
         Ra||Rf must be 8 k to achieve this gain. Ra can then be found:

                                          Ra || R f =8 k
                                          1+1 =1
                                          Ra 10 k 8 k
                                          Ra=40 k
         Because the break points have already been determined to be 3 and -4 V
         respectively, all that needs to be done is to compensate for the forward drop
         of the other diode.
                                         V z +=3 V-0.7 V
                                         V z += 2.3 V
                                         V z -=-(4 V-0.7 V)
                                         V z -=-3.3 V (use absolute value)
         Because this circuit inverts the signal, it may be wise to include an inverting
         buffer to compensate. The resulting circuit is shown in Figure 7.41.

                                                                                                                     Figure 7.41
                                                                                                                     Correction circuit for the
                                                                                                                     transducer in Example 7.6.

One of the problems with the Zener form is that the transfer curves change slope
slowly. Because of this, fine control over the shape is not very easy to come by.
Consequently, a good deal of trial and error is sometimes needed during the design
sequence. Also, there is a limited range of Zener diode values available. A form that
is somewhat more precise utilizes a biased-diode network.

269
                                                                                        Figure 7.42
                                                                                        Biased diode function
                                                                                        generator.

An increasing gain-function circuit that utilizes a biased-diode approach is shown in
Figure 7.42. Its corresponding transfer curve is shown in Figure 7.43. For each break
point, one diode and a pair of resistors are required. Even if the break points are
symmetrical for positive and negative inputs, one set of components will be required
for each polarity. The basic concept is the same as that of the Zener approach; by
turning on sections with higher and higher input voltages, resistors will be placed in
parallel with the base feedback resistors, thus changing the gain. As with the Zener
approach, a decreasing gain characteristic is formed by placing the network across
Rf, instead of Ri. Let's take a look at how a single section reacts.

                 S-2         Vout  V1= (R6/R7)(|-V|+.7)+.7                              Figure 7.43
                        S-1    +   V2= (R8/R9)(|-V|+.7)+.7                              Transfer characteristic of
                                   V-1= -(R2/R3)(+V+.7)+.7                              biased diode function
                                   V-2= -R4/R5)(+V+.7)+.7                               generator.

              -  V-2 V-1     S0 V1 V2 Vin
                                                 +
     S0= -Rf/R1
                                        S1
     S1= -Rf/(R1||R6)
                             - S2
     S2= -Rf/(R1||R6||R8)

     S-1= -Rf/(R1||R2)

     S-2= -Rf/(R1||R2||R4)

270
Each break point requires a blocking diode, a gain resistor and a bias resistor.
Resistors R2 and R3, along with diode D1 make up a single section for negative input
voltages. Under low signal conditions, D1 is off and blocks current flow. Effectively,
the section is an open circuit. If the input potential goes negative enough, D1 will
turn on, thus placing R2 in parallel with R1 and increasing the gain. The slope (gain)
of the transfer curve is:

     Slope =- R f
                 R1 || R2

The break point occurs when the cathode of D1 goes to approximately -0.7 V
(assuming silicon). At this point, the drop across R3 must be

     V R3=V CC +0.7 V

The drop across R2 must be

     V R2=V in-0.7 V

Right before D1 conducts, the current through R2 must equal the current through R3.

                                  V R3=V R2
                                  R3 R2

     V CC+0.7 V = V i n-0.7 V
                              R3             R2

At this instant, Vin equals the break point. Solving for Vin gives,

     V i n=V breakpoint= R2 (V CC +0.7 V)+0.7 V
                         R3

or to a rough approximation,

     V breakpoint  R2 V CC
                  R3

The approximation error may be minimized by using germanium diodes. Note that
since the break points are set by a resistor ratio, very tight control of the curve is
possible. When designing a function circuit, the required slopes dictate the values of
the gain resistors. For ease of use the bias potentials are set to the positive and
negative supply rails. Given these elements and the desired break point voltages, the
necessary bias resistor values may be calculated.

271
Computer Simulation

A simulation using the biased diode technique is presented in Figure 7.44. Here
the circuit has been designed to echo the response found in Figure 7.36 from
Example 7.4.

                                                                                 Figure 7.44a
                                                                                 Biased diode function
                                                                                 synthesizer in Multisim.

                                                                                                                     Figure 7.44b
                                                                                                                     Function synthesizer
                                                                                                                     waveforms.

Note that the same values are used here for the feedback resistors as those found in
the Zener version of the circuit. The only new calculation was for the biasing
272
resistors (the 40.3 k) to set the output breakpoints. In order to see the gain effect
clearly, a triangle wave is used as the input. Because the input waveform consists of
nice, straight, diagonal lines, the gain response will be reflected in the output
waveshape. This is obvious in the Transient Analysis graph. The signal inversion
stands out, but the more interesting and important item is the change in slope that
occurs when the output waveform reaches about 4.5 volts. This is approximately
where the output breakpoint was calculated to be, and the reduction in gain above
this point is quite apparent.

7.5 Comparators                                                                          Figure 7.45
                                                                                         False turn-off spike.
The simple open-loop op amp comparator was discussed in Chapter 2. Although this
circuit is functional, it is not the final word on comparators. It suffers from two
faults: (1) it is not particularly fast, and (2) it does not use hysteresis. Hysteresis
provides a margin of safety and "cleans up" switching transitions. Providing a
comparator with hysteresis means that its reference depends on its output state. As
an example, for a positive going transition, the reference might be 2 V, but for a
negative transition, the reference might be 1 V. This effect can dramatically improve
performance when used with noisy inputs.

                                 Vin

                                Vref

                                               t
Vout

                                                                                 t

Take a look at the noisy signal in Figure 7.45. If this signal is fed into a simple
comparator, the noise will produce a false turn-off spike. If this same signal is fed
into a comparator with hysteresis, as in Figure 7.46, a clean transition results. In
order to change from low to high, the signal must exceed the upper reference. In
order to change from high to low, the signal must drop below the lower reference.
This is a very useful feature. A comparator with hysteresis is shown in Figure 7.47.

273
       Vin                                                                         Figure 7.46
     Vref(u)                                                                       Clean transition using
     Vref(l)                                                                       hysteresis.

      Vout                                   t

                                             t

The output voltage of this circuit will be either +Vsat or -Vsat. Let's assume that the   Figure 7.47
device is at -Vsat. In order to change to +Vsat, the inverting input must go lower than   Comparator with hysteresis.
the noninverting input. The noninverting input is derived from the R1/R2 voltage
divider. The divider is driven by the output of the op amp, in this case, -Vsat.
Therefore, to change state, Vin must be

     V i n=V lower thres=-V sat R2              (7.4)
                                R1 +R 2

Similarly, to go from positive to negative,

     V i n=V upper thres=+V sat R 2             (7.5)
                                R1 +R 2

The upper and lower trip points are commonly referred to as the upper and lower           Figure 7.47
thresholds. The adjustment of R1 and R2 creates an "error band" around zero               Noninverting comparator
(ground). Note that when the trip point is reached, the comparator output state           with hysteresis
changes, thus changing the reference. This reinforces the initial change. In effect, the
comparator is now using positive feedback (note how the feedback signal is tied to
the noninverting terminal). This circuit is sometimes referred to as a
Schmitt Trigger.

A noninverting version of the Schmitt Trigger is shown in Figure 7.48.
Note that in order to change state, the noninverting terminal's voltage will
be approximately zero. If the circuit is in the low state, the voltage across
R1 will equal -Vsat at the time of transition. At this point, the voltage across

274
R2 will equal Vin. The current into the op amp is negligible, so the current through R1
equals that through R2.

             V R1 = V R2
              R1 R2

             -(-V sat )= V in
             R1                          R2

Because Vin equals the threshold voltage at transition,

             V i n=V upper thres=V sat R2                         (7.6)
                                      R1

Similarly, for the opposite transition,

             V i n=V lower thres=-V sat R2                        (7.7)
                                        R1

Example 7.7

     Sketch the output waveform for the circuit of Figure 7.49 if the input signal
     is a 5 V peak sine wave.

                                                                                         Figure 7.49
                                                                                         Comparator for Example 7.7.

     First, determine the upper and lower threshold voltages.

                                     V upper thres=V sat R2
                                                       R1

                                     V upper thres=13 V 2 k 20 k
                                     V upper thres=1.3 V

275
                                V lower thres=-V sat R 2
                                                    R1

                                V lower thres=-13 V 2 k 20 k
                                V lower thres=-1.3 V

The output will go to +13 V when the input exceeds +1.3 V and will go to
-13 V when the input drops to -1.3 V. The input/output waveform sketches
are shown in Figure 7.50.

  5 V                                  Figure 7.50
 1.3 V                                 Comparator waveforms.

-1.3 V  t
  -5 V

+13 V

 Vout t

-13 V

Computer Simulation

In Figure 7.51, a simulation of the circuit and waveforms of Example 7.7 are shown
using Multisim. A reasonably fast op amp, the LF411, was chosen for the simulation
in order to minimize slewing effects. The input and output waveforms are
superimposed in the Transient Analysis. This allows the switching levels to be
determined precisely. From the graph, it is very clear that the high-to-low output
transition occurs when the input drops below about -1.3 volts. Similarly, the low-to-
high transition occurs when the input rises above about 1.3 volts. This is exactly as

276
expected, and it reinforces the concept of hysteresis visually. The other effect that
may be noted here is an effective delaying of the pulse signal relative to the timing
at the input's zero-crossings. This is an unfortunate side effect that is magnified by
wide thresholds and slowing varying input signals.

                                                                                                                     Figure 7.51a
                                                                                                                     Simulation of comparator.

                                                                                                                     Figure 7.51b
                                                                                                                     Comparator waveforms.

Although the use of positive feedback and hysteresis is a step forward, switching
speed is still dependent on the speed of the op amp. Also, the output levels are
approximately equal to the power supply rails, so interfacing to other circuitry (such
as TTL logic) requires extra circuitry. To cure these problems, specialized
277
comparators circuits have evolved. Generally, comparator ICs can be broken down
into a few major categories: general-purpose, high speed, and low power/low cost. A
typical general-purpose device is the LM311, whereas the LM360 is a high-speed
device with differential outputs. Examples of the low power variety include the
LM393 dual comparator and the LM339 quad comparator. As was the case with
ordinary op amps, there is a definite trade-off between comparator speed and power
consumption. As you might guess, the high speed LM360 suffers from the highest
power consumption, whereas the more miserly LM393 and LM339 exhibit
considerably slower switching speeds. High-speed devices often exhibit high input
bias and offset currents as well.

The general-purpose LM311 is one of the more popular comparators in use today.
An FET input version, the LF311, is also available. Generally, all of the op amp-
based comparator circuits already mentioned can be adapted for use with the
LM311. The LM311 is far more flexible than the average op amp comparator,
however. An outline and data sheet for the LM311 are shown in Figures 7.52a and
7.52b.

First of all, note that the LM311 is reasonably fast, producing a response time of        Figure 7.52a
approximately 200 ns. This places it in squarely in the middle performance range,         The LM311comparator.
as it is 10 or so times faster than a low-power comparator, but at least 10 times
slower than high-speed devices. The voltage gain is relatively high, at
200,000 typically. Input offset voltage is moderate at 0.7 mV typically,
and 3.0 mV maximum, at room temperature. The input offset and bias
currents are 10 nA and 100 nA worst case, respectively. Devices with
improved offset and bias performance are available, but these values are
acceptable for most applications. (For example, the FET input LF311
shows input offset and bias currents of about 1000 times less, with only a
slight increase in worst case input offset voltage.) The saturation voltage
indicates exactly how low a "low state" potential really is. For a typical
TTL-type load, the LM311 low output will be no more than 400 mV.
Finally, note the current draw from the power supplies. Worst-case values
are 6.0 mA and 5.0 mA from the positive and negative supplies, respectively. By
comparison, low-power comparators are normally in the 1 mA range, whereas high-
speed devices can range up toward 20 to 30 mA.

The LM311 may be configured to drive TTL or MOS logic circuits, and loads
referenced to ground, the positive supply or the negative supply. Finally, it can
directly drive relays or lamps with its 50 mA output current capability.

The operation of the LM311 is as follows:

     · If Vin+ > Vin- the output goes to an open collector condition. Therefore, a pull-
         up resistor is required to establish the high output potential. The pull-up
         does not have to go back to the same supply as the LM311. This aids in

278
         interfacing with various logic levels. For a TTL interface, the pull-up resistor
         will be tied back to the +5 V logic supply.
    · If Vin- > Vin+ the output will be shorted through to the "comparator ground"
         pin. Normally this pin goes to ground, indicating a low logic level of 0 V. It
         may be tied to other potentials if need be.
    · The strobe pin affects the overall operation of the device. Normally, it is left
         open. If it is connected to ground through a current-limiting resistor, the
         output will go to the open-collector state regardless of the input levels.
         Normally, an LM311 is strobed with a logic pulse that turns on a switching
         transistor.

                                                                                                                     Figure 7.52b
                                                                                                                     LM311 data sheet.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

279
An LM311 based comparator circuit is shown in Figure 7.53. It runs off of ±15 V
supplies so that the inputs are compatible with general op amp circuits. The output
uses a +5 V pull-up source so that the output logic is TTL compatible. A small-signal
transistor such as a 2N2222 is used to strobe the LM311. A logic low on the base of
the transistor turns the transistor off, thus leaving the LM311 in normal operation
mode. A high on the base will turn on the transistor, thus placing the LM311's
output at a logic high.

                                                                                                                     Figure 7.53
                                                                                                                     LM311 with strobe.

Our final type of comparator circuit is the window comparator. The window
comparator is used to determine if a particular signal is within an allowable range of
levels. This circuit features two different threshold inputs, an upper threshold, and a
lower threshold. Do not confuse these items with the similarly named levels
associated with Schmitt Triggers. A block diagram of a window comparator is
shown in Figure 7.54.

                                                                                                                     Figure 7.54
                                                                                                                     Window comparator.

This circuit is comprised of two separate comparators, with common inputs and
outputs. As long as the input signal is between the upper and lower thresholds, the
280
output of both comparators will be high, thus producing a logic high at the circuit
output. If the input signal is greater than the upper threshold or less than the lower
threshold (i.e., outside of the allowed window), then one of the comparators will
short its output to comparator ground, producing a logic low. The other comparator
will go to an open collector condition. The net result is that the circuit output will be
a logic low. Because the window comparator requires two separate comparators, a
dual comparator package such as the LM319, can prove to be convenient.

An interesting application that uses comparators and function generation is shown in
Figure 7.55. This is a single neuron from a pulse-coded continuous-time recurrent
neural network.10 Neural networks are modeled after biological nervous systems and
are used in a variety of applications such as robot motion control. Such networks
may be implemented using digital or analog techniques, with advantages and
disadvantages in each approach. This particular system is largely analog, although
its final output is a pulse-width modulated square wave11. This avoids the signal
attenuation problem that a pure analog approach might suffer from.

A complete system contains several neurons. Each neuron has a single output and
several inputs. These inputs are fed from the outputs of the other neurons (including
itself). The signals are weighted and then summed to create a composite excitation
signal. The composite is summed with an offset or bias level, and then processed
through a sigmoid function to produce the final output. In a pure analog scheme, the
signals are just analog voltages. This scheme is a little different in that it uses pulse-
width modulation to encode the signal levels. Low-level signals are represented as
square waves with small duty cycles. High-level signals are represented via large
duty cycles. One convenient aspect of this representation is that the signal is already
in a form to directly control certain devices such as motors.

Let's follow the signal flow. The first stage is an adjustable gain inverting/
noninverting amplifier, as seen in Chapter Four. The gain of this stage corresponds
to the neuron weighting. Because the weighting can be either positive or negative, a
simple potentiometer by itself is insufficient. The second stage is a fairly stock
summing amplifier (also from Chapter Four). Its job is to combine the signals from
the various weighted inputs. Its output is a very complicated-looking waveform: It is
a combination of pulse-width modulated square waves, each with a different duty
cycle and amplitude. The average "area under the curve" represents the overall
signal strength. This is obtained via the adjustable RC network. The time constant is
much slower than the base square wave frequency, so an averaging of the signal
takes place. The output of op amp 3 is a smooth, slowly varying signal. This signal
is combined with an adjustable offset bias and fed into the function generation

10 For further details on pulse-coded continuous-time recurrent neural networks, see Alan
    Murray and Lionel Tarassenko Analogue Neural VLSI - A Pulse Stream Approach
    (London: Chapman and Hall, 1994).

11 See J.C. Gallagher and J.M. Fiore, "Continuous time recurrent neural networks: a
    paradigm for evolvalble analog controller circuits", NAECON 2000

281
circuit built around op amp 4. The gains and breakpoints are designed to mimic the     Figure 7.55
compressive nature of the sigmoid function 1/(1 + -x). The resulting output level is   Pulse-coded continuous
then pulse coded. The pulse-width modulator is made from a simple triangle wave        time recurrent neural
oscillator (covered in Chapter Nine) and a comparator. The amplitude range of the      network (single neuron
triangle wave precisely matches the range of signals expected from the sigmoid         shown).
circuit. The larger the sigmoid output is, the longer the comparator output will be
high. In other words, the duty cycle will follow the sigmoid circuit's output level,
creating a pulse-width modulated signal. This output signal will be fed to the inputs
of the other neurons in the network, and may also be used as one of the final desired
output signals. For example, this signal may be used to drive one of the leg motors
of a walking robot.

7.6 Log and Anti-Log Amplifiers

It is possible to design circuits with logarithmic response. The uses for this are
manyfold. Recalling your logarithm fundamentals, remember that processes such as
multiplication and division turn into addition and subtraction for logs. Also, powers
and roots turn into multiplication and division. Bearing this in mind, if an input
signal is processed by a logarithmic circuit, multiplied by a gain, A, and then
processed by an anti-log circuit, the signal will have effectively been raised to the
Ath power. This brings to light a great many possibilities. For example, in order to
take the square root of a value, the signal would be passed through a log circuit,
divided by two (perhaps with something as simple as a voltage divider), and then

282
passed through an anti-log circuit. One possible application is in true RMS detection
circuits. Other applications for log/anti-log amplifiers include signal compression
and process control. Signals are often compressed in order to decrease their dynamic
range (i.e., the difference between the highest and lowest level signals). In
telecommunications systems, this may be required in order to achieve reasonable
voice or data transmission with limited resources. Seeing their possible uses, our
question then, is how do we design log/anti-log circuits?

                                                                                                                     Figure 7.56
                                                                                                                     Basic log circuit.

Figure 7.56 shows a basic log circuit. The input voltage is turned into an input
current by Ri. This current feeds the transistor. Note that the output voltage appears
across the base-emitter junction, VBE. The transistor is being used as a current-to-
voltage converter. The voltage/current characteristic of a transistor is logarithmic,
thus the circuit produces a log response. In order to find an output equation, we start
with the basic Shockley equation for PN junctions:

        ( ) q V BE                                                          (7.8)

     I c= I s  K T -1

Where Is is the reverse saturation current,  is log base, q is the charge on one
electron 1.610-19 coulombs, K is Boltzmann's constant 1.3810-23 joules/kelvin, and
T is the absolute temperature in kelvin.

Using 300 kelvin (approximately room temperature) and substituting these constants
into Equation 7.8 produces

                     38.6 V BE                                              (7.9)

     I c=I s( -1)

Normally, the exponent term is much larger than one, so this may be approximated
as

     I c= I s 38.6V BE                                                      (7.10)

Using the inverse log relationship and solving for VBE, this is reduced to

     V BE=0.0259 ln Ic                                                      (7.11)
                        Is

283
Earlier it was noted that the current Ic is a function of the input voltage and Ri. Also,
note that Vout = -VBE. Substituting these elements into Equation 7.11 yields

                          V out=-0.0259 ln V i n                  (7.12)
                                               Ri I s

We now have an amplifier that takes the log of the input voltage and also multiplies       Figure 7.57
the result by a constant. It is very important that the anti-log circuit multiply by the   Input/output characteristic
reciprocal of this constant, or errors will be introduced. If the input voltage (or        of log amplifier.
current) is plotted against the output voltage, the result will be a straight line if
plotted on a semi-log graph, as shown in Figure 7.57. The rapid transition at
approximately 0.6 V is due to the fast turn-on of the transistor's base-emitter
junction. If output voltages greater than 0.6 V are required, amplifying stages will
have to be added.

                             Vin

                                            (linear)

                                                           Vout

                          .3 V  .6 V                1.2 V  (log)

There are a couple of items to note about this circuit. First, the range of input signals
is small. Large input currents will force the transistor into less-than-ideal logarithmic
operation. Also, the input signal must be unipolar. Finally, the circuit is rather
sensitive to temperature changes. Try using a slightly different value for T in the
above derivation, and you shall see a sizable change in the resulting constant.

A basic anti-log amplifier is shown in Figure 7.58. Note that the transistor is used to    Figure 7.58
turn the input voltage into an input current, with a log function. This current then       Basic antilog circuit.
feeds Rf, which produces the output voltage. The derivation of the
input/output equation is similar to the log circuit's:

                          V out=- R f I c

Recalling Equation 7.10,

                          I c= I s 38.6V BE                       (7.13)
                          V out=- R f I s 38.6V BE

284
The same comments about stability and signal limits apply to both the anti-log
amplifier and the log amplifier. Also, there is one interesting observation worth
remembering: in a general sense, the response of the op amp system echoes the
characteristics of the elements used in the feedback network. When just resistors are
used, which have a linear relation between voltage and current, the resulting
amplifier exhibits a linear response. If a logarithmic PN junction is used, the result is
an amplifier with a log or anti-log response.

Example 7.8

         Determine the output voltage for the circuit of Figure 7.56 if Vin = 1 V,
         Ri = 50 k, and Is = 30 nA. Assume T = 300 kelvin. Also determine the
         output for inputs of 0.5 V and 2 V.

         For Vin = 1 V

                                         V out=-0.0259 ln V i n
                                                               Ri I s

                                         V out=-0.0259 ln 1 V 50 k 30 nA
                                         V out=-0.0259 ln 666.6
                                         V out=-0.1684 V

         For Vin = 0.5 V

                                         V out=-0.0259 ln .5 V 50 k 30 nA
                                         V out=-0.0259 ln 333.3
                                         V out=-0.1504 V

         For Vin = 2 V

                                         V out=-0.0259 ln 2 V 50 k 30 nA
                                         V out=-0.0259 ln 1333
                                         V out=-0.1864 V

         Notice that for each doubling of the input signal, the output signal went up a
         constant 18 mV. Such is the nature of a log amplifier.

As noted, the basic log/anti-log forms presented have their share of problems. It is
possible to create more elaborate and accurate designs, but generally, circuit design

285
of this type is not for the faint-hearted, as the device-matching and temperature-
tracking considerations are not minor.

                                                                                    Figure 7.59
                                                                                    MAX4206 equivalent circuit.

                                                                                    Reprinted courtesy of Maxim
                                                                                    Integrated

Some manufacturers supply relatively simple-to-use log circuits in IC form. This
takes much of the "grind" out of log circuit design. An example device is the
MAX4206 from Maxim. An equivalent circuit for the MAX4206 is shown in Figure
7.59. An uncommitted amplifier and a voltage reference round out the package. The
MAX4206 can be powered from single or bipolar supplies and operates over a five
decade range. Further details on the design and application of higher quality log
amplifiers may be found in section 7.7, Extended Topic.

Four-Quadrant Multiplier

A four-quadrant multiplier is a device with two inputs and a single output. The
output potential is the product of the two inputs along with a scaling factor, K.

     V out= K V x V y     (7.14)

Typically, K is 0.1 in order to minimize the possibility of output overload. The    Figure 7.60
schematic symbol for the multiplier is shown in Figure 7.60. It is called a four-   Schematic symbol for
quadrant device, as both inputs and the output may be positive or negative. An      multiplier.
example device is the Analog Devices AD834. The AD834 operates from
DC through 500 MHz and can be powered by supplies from ±4 V through
±15 V. Although multipliers are not really "nonlinear" in and of themselves,
they can be used in a variety of out-of-the-ordinary applications and in areas
where log amps might be used.

286
Multipliers have many uses including squaring, dividing, balanced                              Figure 7.61
modulation/demodulation, frequency modulation, amplitude modulation, and                       Multiplication circuit.
automatic gain control. The most basic operation, multiplication, involves using one
input as the signal input and the other input as the gain control potential.                   Figure 7.62
Unlike the simple VCA circuit discussed earlier, this gain control potential is                Squaring circuit.
allowed to swing both positive and negative. A negative polarity will produce
an inverted output. This basic connection is shown in Figure 7.61. This same                   Figure 7.63
circuit can be used as a balanced modulator. This is very useful for creating                  Divider circuit.
dual sideband signals for communications work. Multiplier ICs may have
external connections for scale factor and offset adjust potentiometers. Also,
they may be modeled as current sources, so an external op amp connected as a
current-to-voltage converter may be required.

If the two inputs are tied together and fed from a single input, the result will be a
squaring circuit. Squaring circuits can be very useful for RMS calculations and for
frequency doubling. An example is shown in Figure 7.62.

The multiplier may also be used for division or square root functions. A divider
circuit is shown in Figure 7.63. Here's how it works: First, note that the output
of the multiplier, Vm, is a function of Vx and the output of the op amp, Vout.

                          V m= K V x V out                                  (7.15)

Vm produces a current through R2. Note that the bottom end of R2 is at a virtual
ground, so that all of Vm drops across R2.

                          I 2=V m
                               R2

As we have already seen,

                          I 1= V i n
                               R1

Now, because the current into the op amp is assumed to be zero, I1 and
I2 must be equal and opposite. It is apparent that the arbitrary direction
of I2 is negative. Therefore, if R1 is set equal to R2,

                            V m= -V i n and using Equation 7.15,
                          -V i n= K V x V out

                           V out= - V i n
                                      KVx

Vx then sets the magnitude of the division. There are definite size restrictions on Vx.
If it is too small, output saturation will result. In a similar vein, if Vx is also tied back

287
to the op amp's output, a square root function will result. Picking up the derivation at
the next-to-last step,

             -V i n= K V out V out                                      (7.17)

             V out= -V i n K

Example 7.9

     Determine the output voltage in Figure 7.62 if K = 0.1 and the input signal is                                                      Figure 7.64
     2 sin 2  60 t.                                                                                                                      Waveforms of the squaring
                                                                                                                                         circuit of Example 7.9.
                                     V out= K V x V y

                                                                                                                                    2 V

     Because both inputs are tied together, this reduces to

             V out= K V i n2                                                                                                                                                    t
             V out=0.1 (2 sin 2  60 t)2
                                                                                                                                         input to
     (7.18)                                                                                                                              squaring circuit

     A basic trig identity is

                                                                                                                                   -2 V

             (sin     2  =                  0.5-  0.5  cos  2  

                     )

     Substituting this into Equation 7.18,                                   .2 V

             V out=0.1 (2-2 cos 2  120t )                                    .1 V

             V out=0.2-0.2 cos 2  120 t

     This means that the output signal is 0.2 volts peak, and riding on a                                                                output of t

                                                                                                                                         squaring circuit

     0.2 volt DC offset. It also indicates a phase shift of -90 degrees and

     a doubling of the input frequency. This last attribute makes this

     connection very useful. We have seen many approaches to increasing a

     signal's amplitude, but this circuit allows us to increase its frequency. The

     waveforms are shown in Figure 7.64.

288
7.7 Extended Topic:

A Precision Log Amp

The basic log amplifier discussed earlier suffers from two major problems:
repeatability and temperature sensitivity. Let's take a closer look at Equation 7.12.
First, if you work backward through the derivation, you will notice that the constant
0.0259 is actually K T/q using a temperature of 300 kelvin. Thus, we may rewrite
this equation as,

                     V out=- K T ln V i n  (7.19)
                                q Ri I s

Note that the output voltage is directly proportional to the circuit temperature, T.     Figure 7.65
Normally, this is not desired. The second item of interest is Is. This current can vary  A high quality log amplifier.
considerably between devices, and is also temperature sensitive, approximately
doubling for each 10 C° rise. For these reasons, commercial log amps such as those
mentioned earlier, are preferred. This does not mean that it is impossible to create
stable log amps from the basic op amp building blocks. To the contrary, a closer
look at practical circuit solutions will point out why specialised log ICs are
successful. We shall treat the two problems separately.

One way of removing the effect of Is from our log amp is to subtract away an equal
effect. The circuit of Figure 7.65 does exactly this. This circuit utilizes two log
amps. Although each is drawn with an input resistor and input voltage source,
removal of R1 and R2 would allow current sensing inputs. Each log amp's transistor
is part of a matched pair. These two transistors are fabricated on the same silicon
wafer and exhibit nearly identical characteristics (here, the most notable being Is).

289
Based on Equation 7.19 we find

     V A=- K T ln V i n1        q
                                   R1 I s1

     V B=- K T ln V i n2        q
                                   R2 I s2

Where typically, R1 = R2. These two signals are fed into a differential amplifier
comprised of op amp 3, and resistors R3 through R6. It is normally set for a gain of
unity. The output of the differential amplifier (point C) is

     V C=V B-V A

     ( ) V C=-K T ln V i n2 - - K T ln V i n1
                                q  R2 I s2        q R1 I s1

     ( ) V C= K Tq
                                   ln V i n1 -ln V i n2      (7.20)
                                   R1 I s1  R2 I s2

Using the basic identity that subtracting logs is the same as dividing their arguments,
7.20 becomes

     V C= K Tq ln                  V in1                     (7.21)

                                   R1 I s1
                                   V in2
                                   R2 I s2

Because R1 is normally set equal to R2, and Is1 and Is2 are identical due to the fact that
Q1 and Q2 are matched devices, 7.21 simplifies to

     V C= K T ln V i n1                                      (7.22)
             q V i n2

As you can see, the effect of Is has been removed. VC is a function of the ratio of the
two inputs. Therefore, this circuit is called a log ratio amplifier. The only remaining
effect is that of temperature variation. Op amp 4 is used to compensate for this. This
stage is little more than a standard SP noninverting amplifier. What makes it unique
is that R8 is a temperature-sensitive resistor. This component has a positive
temperature coefficient of resistance, meaning that as temperature rises, so does its
resistance. Because the gain of this stage is 1 + (R7/R8), a temperature rise causes a
decrease in gain. Combining this with 7.22 produces

     ( ) V out= 1+R7               K T ln V i n1             (7.23)
                 R8                 q V i n2

290
If the temperature coefficient of R8 is chosen correctly, the first two temperature
dependent terms of 7.23 will cancel, leaving a temperature stable circuit. This
coefficient is approximately 1/300 K, or 0.33% per C°, in the vicinity of room
temperature.

Our log ratio circuit is still not complete. Although the major stability problems have     Figure 7.66
been eliminated, other problems exist. It is important to note that the transistor used     Compensation components.
in the feedback loop loads the op amp, just as the ordinary feedback resistor Rf
would. The difference lies in the fact that the effective resistance which the op
amp sees is the dynamic base-emitter resistance, r'e. This resistance varies with the
current passing through the transistor and is equal to 26mV/IE at room
temperature. For higher input currents this resistance can be very small and might
lead to an overload condition. A current of 1 mA, for example, would produce an
effective load of only 26 . This problem can be alleviated by inserting a large
value resistance in the feedback loop. This resistor, RE, is shown in Figure 7.66.
An appropriate value for RE may be found by realizing that at saturation virtually
all of the output potential will be dropped across RE, save VBE. The current through
RE is the maximum expected input current plus load current. Using Ohm's law,

     RE= V sat-V BE  (7.24)
              I max

Figure 7.66 also shows a compensation capacitor, Cc. This capacitor is used to roll
off high frequency gain in order to suppress possible high frequency oscillations. An
optimum value for Cc is not easy to determine, as the feedback element's resistance
changes with the input level. It may be found empirically in the laboratory. A typical
value would be in the vicinity of 100 pF.12

One possible application for the log ratio circuit is found in Figure 7.67. This system
is used to measure the light transmission of a given material. Because variations in
the light source will affect a direct measurement, the measurement is instead made
relative to a known material. In this example, light is passed through a known
medium (such as a vacuum) while it is simultaneously passed through the medium
under test. On the far side of both materials are light-sensitive devices such as
photodioides, phototransistors, or photomultiplier tubes. These devices will produce
a current proportional to the amount of light striking them. In this system, these
currents are fed into the log ratio circuit, which will then produce an output voltage
proportional to the light transmission abilities of the new material. This setup
eliminates the problem of light source fluctuation, because each input will see an
equal percentage change in light intensity. Effectively, this is a common-mode
signal that is suppressed by the differential amplifier section. This system also
eliminates the difficulty of generating calibrated light intensity readings for
comparisons. By its very nature, this system performs relative readings.

12 A detailed derivation for Cc may be found in Daniel H. Sheingold, ed., 2d ed. Nonlinear
    Circuits Handbook, (Norwood, Mass.: Analog Devices, 1976) pp 174-178.

291
              unknown  photosensitive                                                      Figure 7.67
              medium   devices                                                             Light transmission
                                                                                           measurement.
                          log ratio    Vout
                          amplifier

light source

              known
              medium

Summary

In this chapter, you have examined a variety of nonlinear op amp circuits. They are
deemed nonlinear because their input/output characteristic is not a straight line.

Precision rectifiers use negative feedback to compensate for the forward drop of
diodes. By doing so, very small signals may be successfully rectified. Both half-
wave and full-wave versions are available. An extension of the precision rectifier is
the precision peak detector. This circuit uses a capacitor to effectively lengthen the
duration of peaks. It can also be used as an envelope detector.

Other active diode circuits include clampers and limiters. Clampers adjust the DC
level of an input signal so that the output is either always positive or always
negative. The furthest peaks will just hit 0 V. Clampers may also be used with a DC
offset for greater control of the output signal. Limiters force their output to be no
greater than a preset value. It may be thought of as a programmable signal clipper.

Function generation circuits are used to create piece-wise linear approximations of
transfer functions. These can be used to compensate for the nonlinearities of
transducers and measurement devices. There are two basic approaches for realizing
a design: (1) using Zener diodes, and (2) using a biased-signal diode network. The
Zener scheme is a bit easier to set up, but does not offer the performance of the
biased-diode form.

In order to improve the performance of comparators, positive feedback may be used.
The resulting circuits are called Schmitt Triggers and have much greater noise
immunity than simple open loop op amp comparators do. Specialized comparators
are also available. These devices are generally faster than simple op amps, and offer
more flexibility for logic family interfacing.

Log and anti-log amplifiers utilize a transistor in their feedback loops. The result is a
form of signal compression for the log amp, and an inverse signal expansion for the
anti-log amp. Specialized log/anti-log ICs are available that take much of the tedium
out of amplifier design and testing.

292
Finally, a four-quadrant multiplier produces an output that is proportional to the
product of its two inputs. These devices may be used for a number of applications,
including balanced modulation, frequency doubling, and more.

In short, although op amps are linear devices, they may be used with other
components to form nonlinear circuits.

Review Questions

    1. What are the advantages of active rectifiers versus passive rectifiers?
    2. What are the disadvantages of active rectifiers versus passive rectifiers?
    3. What is a peak detector?
    4. What is a limiter?
    5. What is the function of a clamper?
    6. What are the differences between active and passive clampers?
    7. What is a transfer function generator circuit, and what is its use?
    8. Explain how a function circuit might be used to linearize an input

         transducer.
    9. What is a Schmitt trigger?
    10. What is the advantage of a Schmitt-type comparator versus an ordinary

         open-loop op amp comparator?
    11. What are the advantages of dedicated comparators such as the LM311

         versus ordinary op amp comparators?
    12. How are log and anti-log amplifiers formed?
    13. What is the effect of passing a signal through a log or anti-log amplifier?
    14. What is a four-quadrant multiplier?
    15. How might a multiplier be used?
    16. What is the difference between a multiplier and a VCA?

Problems

Analysis Problems

    1. Sketch the output of Figure 7.2 if the input is a 100 Hz 2 V peak triangle
         wave.

    2. Repeat Problem 1 for a square wave input.
    3. Sketch the output of Figure 7.8 if Rf = 20 k and Ri = 5 k. Assume that Vin

         is a 0.5 V peak triangle wave.
    4. Repeat Problem 3, but with the diode reversed.
    5. Sketch the output of Figure 7.9 if C = 50 nF and R = 5 M. Assume that the

         input is a 1 V peak pulse with 10% duty cycle. The input frequency is
         1 kHz.
    6. Repeat Problem 5 with the diode reversed.

293
    7. Sketch the output of Figure 7.14 if R = 25 k and Vin = 2 sin 2  500 t.

    8. Repeat Problem 7 with Vin equal to a 3 V peak square wave.

    9. Sketch the output of Figure 7.15 if the diodes are reversed. Assume that Vin
         is a 100 mV peak-to-peak sine wave at 220 Hz.

    10. In Figure 7.23, assume that R = 10 k, Rl = 1 M, C = 100 nF and
         Voffset = 2 V. Sketch the output for a 10 kHz 1 V peak sine wave input.

    11. Sketch the output of Figure 7.27 if Ri = 10 k, Rf = 40 k and the Zener
         potential is 3.9 V. The input signal is a 2 V peak sine wave.

    12. Sketch the transfer curve for the circuit of Problem 11.

    13. In Figure 7.31, sketch the transfer curve if Ri = 5 k, Rf = 33 k, Ra = 20 k
         and VZener = 5.7 V.

    14. Sketch the output of the circuit in Problem 13 for an input signal equal to a
         2 V peak triangle wave.

    15. Repeat Problem 14 with a square wave input.

    16. If Ri = 4 k, Ra = 5 k, Rf = 10 k, and Vz = 2.2 V in Figure 7.33, determine
         the minimum and maximum input impedance.

    17. Draw the transfer curve for the circuit of Problem 16.

    18. Sketch the output voltage for the circuit of Problem 16 if the input signal is a
         3 V peak triangle wave.

    19. Sketch the transfer curve for the circuit of Figure 7.34 if Ri = 1 k, Rf = 10
         k, Ra = 20 k, Rb = 18 k, VZener-a = 3.9 V, and VZener-b = 5.7 V.

    20. Sketch the output of the circuit in Problem 19 if the input is a 1 V peak
         triangle wave.

    21. If R1 = 10 k and R2 = 33 k in Figure 7.47, determine the upper and lower
         thresholds if the power supplies are ±15 V.

    22. Determine the upper and lower thresholds for Figure 7.48 if R1 = 4.7 k and
         R2 = 2.2 k, with ±12 V power supplies.

    23. Sketch the output of Figure 7.53 if Vin = 2 sin 2  660 t, Vref = 1 V DC, and
         Vstrobe = 5 VDC.

    24. Repeat Problem 23 for Vstrobe = 0 VDC.

    25. Determine the output of Figure 7.56 if Vin = 0.1 V, Ri = 100 k, and
         Is = 60 nA.

    26. Determine the output of Figure 7.58 if Vin = 300 mV, Rf = 20 k and
         Is = 40 nA.

    27. Sketch the output signal of Figure 7.61 if Vin= 2 sin 2  1000 t, K = 0.1, and
         Vcontrol = 1 VDC, -2 VDC, and 5 VDC.

    28. Sketch the output of Figure 7.62 if Vin = 1 sin 2  500 t, and K = 0.1.

    29. Sketch the output of Figure 7.63 if Vin = 5 sin 2  2000 t, K = 0.1,
         Vx = 4 VDC, and R1 = R2 = 10 k.

294
Design Problems

    30. Determine values of R and C in Figure 7.9 so that stage 1 slewing is at least
         1V/s, along with a time constant of 1 ms. Assume that op amp 1 can
         produce at least 20 mA of current.

    31. In Figure 7.21, assume that C = 100 nF. Determine an appropriate value for
         Rl if the input signal is at least 2 kHz. Use a time constant factor of 100 for
         your calculations.

    32. Determine new values for Ra and Rf in Problem 13, so that the slopes are -5
         and -3.

    33. Determine new resistor values for the circuit of Figure 7.33 such that the
         slopes are -10 and -20. The input impedance should be at least 3 k.

    34. Determine the resistor values required in Figure 7.37 to produce slopes of
         -5, -8, and -12, if the input impedance must be at least 1 k.

    35. Determine the resistor values required in Figure 7.42 for S0 = -1, S1 = S-1 =
         -5, S2 = S-2 = -12. Also V1 = |V-1| = 3 V, and V2 = |V-2| = 4 V. Use Rf = 20 k.

    36. Sketch the transfer curve for Problem 35.
    37. Determine a value for Ri in Figure 7.56 so that a 3 V input will produce an

         output of 0.5 V. Assume Is = 60 nA.
    38. Determine a value for Rf in Figure 7.58 such that a 0.5 V input will produce

         a 3 V output. Assume Is = 40 nA.
    39. If the multiplier of Figure 7.63 can produce a maximum current of 10 mA,

         what should the minimum sizes of R1 and R2 be? (Assume ±15 V supplies).

Challenge Problems

    40. Assuming that 5% resistors are used in Figure 7.14, determine the worst-
         case mismatch between the two halves of the rectified signal.

    41. Design a circuit that will light an LED if the input signal is beyond ±5 V
         peak. Make sure that you include some form of pulse-stretching element so
         that the LED remains visible for short duration peaks.

    42. A pressure transducer produces an output of 500 mV per atmosphere up to
         5 atmospheres. From 5 to 10 atmospheres, the output is 450 mV per
         atmosphere. Above 10 atmospheres, the output falls off to 400 mV per
         atmosphere. Design a circuit to linearize this response using the Zener form.

    43. Repeat the Problem above using the biased-diode form.
    44. Design a circuit to produce the transfer characteristic shown in Figure 7.68.
    45. Sketch the output waveform of Figure 7.48 if R1 = 22 k, R2 = 4.7 k, and

         Vin = 2 + 8 sin 2  120 t. Assume that the power supplies are ±15 V.

295
               Vout                  Figure 7.68
                  +

-1
          -.5

- -8 V -4 V    -1                8 V + Vin
                       4 V

                            -.5

                                 -1

                                             -

    46. Determine the output of Figure 7.60 if K = 0.1, Vx = 1 sin 2  440 t, and
         Vy = 3 sin 2  200000 t.

Computer Simulation Problems

    47. In preceding work it was noted that the use of an inappropriate device model
         can produce computer simulations that are way off mark. An easy way to
         see this is to simulate the circuit of Figure 7.2 using an accurate model (such
         as the 741 simulation presented in the chapter) and a simple model (such as
         the controlled-voltage source version presented in Chapter 2). Run two
         simulations of this circuit for each of these models. One simulation should
         use a lower input frequency, such as 1 kHz, and the second simulation
         should use a higher frequency where the differences in the models is very
         apparent, such as 500 kHz.

    48. Simulate the circuit designed in Problem 30 using a square wave input.
         Perform the simulation for several different input frequencies between
         10 Hz and 10 kHz. Do the resulting waveforms exhibit the proper shapes?

    49. Perform simulations for the circuit of Figure 7.14. Use R = 12 k. For the
         input waveform, use both sine and square waves, each being 1 V peak at
         200 Hz.

    50. Component tolerances can directly affect the rectification accuracy of the
         full-wave circuit shown in Figure 7.14. This effect is easiest to see using a
         square wave input. If the positive and negative portions of the input signal
         see identical gains, the output of the circuit will be a DC level. Any
         inaccuracy or mismatch will produce a small square wave riding on this DC
         level. This effect can be simulated using the Monte Carlo analysis option. If
         Monte Carlo analysis is not available on your system, you can still see the
         effect by manually altering the resistor values within a preset tolerance band
         for each of a series of simulation runs.

    51. Use a simulator to verify the results of the limiter examined in Example 7.3.

296
    52. Use a simulator to verify the response of the circuit shown in Figure 7.37.
         For the stimulus, use a low frequency triangle wave of 4 V peak amplitude.
         Does the resulting waveform exhibit the same hard "corners" shown on the
         transfer curve of Figure 7.37?

297
8 Voltage Regulation

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Understand the need and usefulness of voltage regulators.
    · Detail the difference between load and line regulation.
    · Detail the need for a stable reference voltage.
    · Describe the operation of a basic linear regulator.
    · Describe the operation of a basic switching regulator.
    · Outline the differences between linear and switching regulators, giving the advantages and

         disadvantages of each.
    · Detail the function of a pass transistor in both linear and switching regulators.
    · Utilize many of the popular linear IC regulators, such as the 78XX and 723.
    · Analyze system heat sink requirements.

8.1 Introduction

In this chapter, the need for voltage regulation is examined. The different schemes for achieving voltage
regulation and the typical ICs used are presented. By the end of this chapter, you should be able to use standard
voltage regulator devices in your work and understand the advantages and disadvantages of the various types.

Generally, voltage regulators are used to keep power supply potentials constant in spite of changes in load
current or source voltage. Without regulation, some circuits may be damaged by the fluctuations present in the
power supply voltage. Even if devices are not damaged, the fluctuations may degrade circuit performance.

Two general forms are presented, the linear regulator and the switching regulator. Both forms have distinct
advantages and drawbacks. The trick is to figure out which form works best in a given situation. Due to their
wide use in modern power supply design, many regulators have achieved high levels of internal sophistication
and robust performance. Often, the inclusion of voltage regulator ICs is a very straightforward -- almost
cookbook -- affair.

The chapter concludes with a discussion of heat sink theory and application. As regulators are called upon to
dissipate a bit of power, attention to thermal considerations is an important part of the design process.

298
8.2 The Need for Regulation

Modern electronic circuits require stable power supply voltages. Without stable
potentials, circuit performance may degrade, or if variations are large enough, the
circuit may cease to function all together and various components may be destroyed.
There are many reasons why a power supply may fluctuate. No matter what the
cause, it is the job of the regulator to absorb the fluctuations, and thereby maintain
constant operating potentials.

A basic power supply circuit is shown in Figure 8.1. First, a transformer is used to
isolate the circuit from the AC power source. It is also used to step down (or step up)
the AC source potential to a more manageable level. A rectifier then converts the
scaled AC signal to pulsating DC, in the form of either half-wave or, more typically,
full-wave rectification. The variations in the pulsating DC signal are then filtered out
in order to produce a (hopefully) stable DC potential, which feeds the load. The filter
may take the form of a simple capacitor or, possibly, more complex networks
comprising both capacitors and inductors.

        transformer  rectifier  filter                  load Figure 8.1
                                                                              Basic power supply.
AC
source

There are two main causes of power supply output variation. First, if the AC source
signal changes, a proportional change will be seen at the output. If, for example, a
brown out13 occurs, the nominal 120 VAC source used in the USA, may drop to, say,
100 VAC. This represents a decrease of one sixth, or about 16.7%. This same change
will be reflected by the transformer, so the output of the transformer will be about
16.7% low as well. This reduction carries right through the rectifier and filter to the
load. In some circuits, this will not present a major problem. For example, this may
mean that an op amp will be running off a 12 V supply instead of a 15 V supply. On
the other hand, a TTL logic circuit may not operate correctly if only 4 V instead of 5
V are applied. Of course, if an over-voltage occurred, both the op amp and the logic
circuit could be damaged.

How well a circuit handles variations in the AC line signal is denoted by the
parameter, line regulation.

                     Line Regulation= V max-V min ×100  (8.1)
                                               V min

13 A reduction in the standard supplied potential may be introduced by a power utility as a
    way of dealing with particularly heavy load conditions, such as on a very hot summer day
    when numerous air conditioners are running.

299
where Vmax is the load voltage produced at the maximum AC line potential and Vmin is
the load voltage for the lowest AC line potential. Normally, this value is expressed
as a percentage. Ideally, a power supply will always produce the same output
potential, and therefore, the perfect line regulation figure would be 0%.

The other major source of supply variation is variation of load current. Indeed, load
current variations can be far greater than the usual variations seen in the AC line.
This normally has the effect of increasing or decreasing the amount of AC ripple
seen in the output voltage. Ideally, there would be no ripple in the output. Ripple is
caused by the fact that heavy load currents effectively reduce the discharge time
constant of the filter. The result is that the filter gives up its stored energy faster and
cannot successfully "fill in the gaps" of the pulsating DC signal fed to it. The ripple
signal is effectively an AC signal that rides on the DC output. This rapid variation of
supply potential can find its way into an audio or signal processing path and create a
great deal of interference. Along with this variation, the effective DC value of the
supply may drop as the load current is increased. The figure of merit for stability in
spite of load changes is called load regulation.

                           Load Regulation= V max-V min ×100  (8.2)
                                                      V min

where Vmax is the largest load voltage produced, and Vmin is the minimum load                Figure 8.2
voltage produced. These points usually occur at the minimum and maximum load                 Two forms of regulator
currents, respectively. Again, this value is normally expressed as a percentage and          control elements.
would ideally be 0%.                                                                         a. Series regulator (top).

In order to maintain a constant output voltage, the power supply regulator needs to b. Parallel regulator (bottom).

sense its output and then compensate for any irregularities. This implies a number of

things. First, some form of reference is needed for stable comparison to the                    control
output signal. Second, some form of comparator or amplifier is required in                      element
order to make use of this comparison. Finally, some form of control

element is needed to absorb the difference between the input to the              from                                   load
                                                                                                logic and
regulator circuit and the desired output. This control element may either        filter

appear in series or in parallel with the load, as seen in Figure 8.2. The first                 reference

form is shown in Figure 8.2a and is normally referred to as a series mode

regulator. The control element allows current to pass through to the load,

but drops a specific amount voltage. The voltage that appears across             Rseries-limit
the control element is the difference between the filter's output and

the desired load voltage.

Figure 8.2b shows a shunt mode regulator. Here, the control element from             logic and           control element load
is in parallel with the load and draws enough current to keep the filter             reference
output level constant. For many applications, shunt mode regulators
are not as efficient as series mode regulators are. One example of a
simple shunt mode regulator is the resistor/Zener diode arrangement

300
shown in Figure 8.3. Note that under no-load conditions (i.e., when the load                 Figure 8.3
impedance is infinite) considerable current flows in the regulating circuit.                 Simple zener shunt regulator.

8.3 Linear Regulators

If a regulator's control element operates in its linear region, the regulator is said to be
a linear regulator. Most linear regulator ICs are series mode types. The main
advantages of linear regulators are their ease of use and accuracy of control. Their
main disadvantage is low efficiency.

A basic linear regulator is shown in Figure 8.4. The series control element is the
transistor Q1. This component is most often referred to as a pass transistor, because
it allows current to pass through to the load. The pass transistor is driven by the op
amp. The pass transistor's job is to amplify the output current of the op amp. The op
amp constantly monitors its two inputs. The noninverting input sees the Zener
voltage of device D1. R1 is used to properly bias D1. The op amp's inverting input
sees the voltage drop across R3. Note that R2 and R3 make up a voltage divider with
Vload as the divider's source. Remembering the basics of negative feedback, recall
that the op amp will produce enough current to keep its two inputs at approximately
the same level, thus keeping Verror at zero. In other words, the voltage across R3
should be equal to the Zener potential. As long as the op amp has a high enough
output current capability, this equality will be maintained. Note that the VBE drop
produced by Q1 is compensated for, as it is within the feedback loop. The difference
between the filtered input signal and the final Vload is dropped across the
collector/emitter of Q1.

                                                                                             Figure 8.4
                                                                                             Basic op amp linear regulator.

In essence, the circuit of Figure 8.4 is a noninverting amplifier. Vzener is the input
potential, and R2 and R3 take the place of resistors Rf and Ri, respectively. Vload is
found by using a variation of the basic gain formula:

     V load =V zener R2+R3  (8.3)
                       R3

301
By choosing the appropriate ratios of resistors along with a suitable Zener, a wide
range of output potentials may be achieved. Note that the op amp is fed from the
nonregulated input. Any ripple that exists on this line will hardly affect the op amp's
function. The ripple will be reduced by the op amp's PSRR (power supply rejection
ratio). The Zener bias resistor, R1, is chosen so that it sets up a current that will
guarantee Zener conduction. This is usually in the low milliamp range.

Example 8.1

         Determine the output of Figure 8.4 if R1 = 5 k, R2 = 20 k, R3 = 10 k
         and Vzener = 3.9 V. Assume that the filtered input is 20 VDC with no more
         than 3 V peak-to-peak ripple.

         First, note that the input signal varies between a minimum of 18.5 V to a
         maximum of 21.5 V (20 V ±1.5V peak). As long as the circuit doesn't try to
         produce more than the minimum input voltage and as long as all current and
         power dissipation limits are obeyed, everything should function correctly.

                                          V load =V zener R2+R3
                                                            R3

                                         V load =3.9 V× 20 k +10 k 10 k
                                         V load =11.7 V

         Due to the VBE drop, the op amp needs to produce about 0.7 V more than
         this. Also, note that the Zener current may now be found.

                                          I zener = V load-V zener
                                                        R1

                                          I zener=11.7 V-3.9 V 5 k
                                          I zener=1.56 mA

         This is a reasonable value.

Example 8.2

         Determine the power dissipation for Q1 and the circuit efficiency for
         Example 8.1 if the effective load resistance is 20 .

302
         First, Iload must be determined.

                                          I load = V load
                                                  Rload

                                          I load = 11.7 V 20
                                          I load =0.585 A

         The dissipation of Q1 is the product of the current passing through it and the
         voltage across it. The current through Q1 is the load current. The voltage
         across Q1 is the difference between the filter's output and the load voltage.
         Because the filter's output contains a relatively small AC signal riding on
         DC, the average will equal the DC value, in this case, 20 V.

                                          V CE=V C-V E
                                          V CE= 20 V-11.7 V
                                          V CE=8.3 V

                                          PD= I C V CE
                                          PD=0.585 A ×8.3 V
                                          PD=4.86 W

         So, the pass transistor must dissipate 4.86 W and tolerate a current of 0.585
         amps. The maximum collector-emitter voltage will occur at the peak input
         of 21.5 V. Therefore, the maximum differential is 9.8 V.

         Finally, note that a 0.585 amp output would require a minimum  of

                                          = IC
                                              IB

                                         =585 mA 20 mA
                                         =29.25

         This assumes that the op amp can produce 20 mA and also ignores the small
         Zener and voltage divider currents at the output.

         As far as efficiency is concerned, the input power and the load power need
         to be calculated. For load power,

                                          P load = I load V load
                                          Pload =.585 A ×11.7 V
                                          Pload =6.844 W

303
         Ignoring the current requirements of the op amp, Zener and R2/R3 divider,
         the supplied current equals 0.585 A. The average input voltage is 20 V.

                                          Pi n= I i n V i n
                                          Pi n=0.585 A ×20 V
                                          Pi n=11.7 W

         Efficiency, , is defined as the ratio of useful output to required input, so,

                                           = Pload
                                                Pin

                                           =6.844 W
                                                11.7 W

                                         =0.585 or 58.5 %

         Therefore, 41.5% of the input power is wasted. In order to minimize the
         waste and maximize the efficiency, the input/output differential voltage
         needs to be as small as possible. For proper operation of the op amp and
         pass transistor, this usually means a differential lower than 2 to 3 V is
         impossible. Consequently, this form of regulation is very inefficient when
         the power supply must produce low output voltage levels.

Computer Simulation

A Multisim simulation of an op amp-based linear regulator, such as the one in
Figure 8.4, is shown in Figure 8.5. The input signal is 20 volts average, with a 2 volt
peak 120 Hz sine wave riding on it representing ripple. A 741 op amp is used as the
comparison element along with a generic transistor for the pass device. The
reference is a 5.2 V Zener diode. Given the circuit values, a manual calculation
shows

           ( ) V out=V zener 1+R f
                                                    Ri

            ( ) V out=5.2 V× 1+14k 11k

                                V out=11.8 V

The output plot indicates a constant output at approximately 12.6 V. The
discrepancy can be attributed to the non-ideal nature of the Zener diode (e.g., its
internal resistance). Indeed, the initial solution indicates that the Zener potential
(node 5) is approximately 5.5 V. A more accurate specification of the Zener diode
(in particular, the BV and IBV parameters) would result in a much closer prediction.
Another way of looking at this is to say that the 5.2 V Zener specification is too far

304
below the actual Zener bias point for utmost accuracy (i.e., the manual calculation is
somewhat sloppy and is, therefore, the one in error). This minor discrepancy aside,
the time-domain plot does show the stability of the output signal in spite of the
sizable input variations.

                                                                                                                     Figure 8.5a
                                                                                                                     Op amp regulator in Multisim.

                                                                                                                     Figure 8.5b
                                                                                                                     Input and output waveforms
                                                                                                                     from Multisim.

Three Terminal Devices

In an effort to make the designer's job ever easier, manufacturers provide circuits
such as the one shown in Figure 8.4 in a single package. If you notice, the circuit
really needs only three pins with which to connect to the outside world: input from
the filter, ground, and output. These devices are commonly known as three pin
305
regulators - hardly a creative name tag, but descriptive at least. Several different
devices are available for varying current and power dissipation demands.
A typical "3 pin" device family is the LM340-XX/LM78XX and LM360-
XX/LM79XX. The LM340-XX/LM78XX series is for positive outputs, while the
LM360-XX/LM79XX series produces negative outputs. The "XX" indicates the
rated load voltage. For example, the LM340-05 is a +5 V regulator, while the
LM7912 is a -12 V unit. The most popular sizes are the 5, 12, and 15 V units. For
simplicity, the series will be referred to as the LM78XX from here on.
A data sheet for the LM78XX series is shown in Figure 8.6. This regulator comes in
several variants including TO-3, TO-220, and surface-mount versions. The TO-3
case version offers somewhat higher power dissipation capability. Output currents in
excess of 1 A are available. As a side note, for lighter loads with lower current
demands, the LM78LXX may be used. This regulator offers a 100 mA output and
comes in a variety of packages.

                                                                                                                     Figure 8.6a
                                                                                                                     LM78XX data sheet.

306
                                                                                                                     Figure 8.6b
                                                                                                                     LM78XX data sheet
                                                                                                                     (continued).

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

The practical power dissipation limit of the LM78XX series, like any power device,
is highly dependent on the type of heat sink used. The device graphs show that it can
be as high as 20 W with the TO-3 case. The typical output voltage is within
approximately 5 percent of the nominal value. This indicates the inherent accuracy
of the IC, and is not a measure of its regulation abilities. Figures for both load and
line regulation are given in the data sheet. For a variance in the line voltage of over
2:1, we can see that the output voltage varies by no more than 1 percent of the
nominal output. Worst-case load regulation is just as good, showing no more than 1
307
percent deviation for a load current change from 5 mA up to 1.5 A. The regulator
can also be seen to draw very little standby current, only 8.5 mA over a wide
temperature range.

The output of the LM78XX series is fairly clean. The LM7815 shows an output
noise voltage of 90 V, typically, and an average ripple rejection of 70 dB. This
means that ripple presented to the input of the regulator is reduced by 70 dB at the
output. Because 70 dB translates to a factor of over 3000, this means that an input
ripple signal of 1 V will be reduced to less than one-third of a millivolt at the output.
It is worthwhile to note that this figure is frequency-dependent, as shown by the
Ripple Rejection graph. Fortunately, the maximum value occurs in the desired range
of 60 to 120 Hz.

The last major item in the data sheet is an extremely important one: Input Voltage
Required To Maintain Line Regulation. This value is approximately 2.5 to 2.7 V
greater than the nominal rating of the regulator. Without this headroom, the
regulator will cease to function properly. Although it is desirable to keep the
input/output differential voltage low in order to decrease device power dissipation
and maximize efficiency, too low of a value will cripple the regulator. As seen in the
Peak Output Current graph, the highest load currents are achieved when the
differential is in the 5 to 10 V range.

In all cases, the devices offer thermal shutdown and output short-circuit protection.
The maximum input voltage is limited to 35 V. Besides the LM78XX series, special
high-current types with outputs in the 3 A and higher range are available.

                                                                                                                     Figure 8.7
                                                                                                                     Dual supply for op amp
                                                                                                                     circuits.

As an example, a bipolar power supply is shown in Figure 8.7. A center-tapped
transformer is used to generate the required positive/negative polarities. C1 and C2
serve as the filter capacitors. The positive peak across each capacitor should not
exceed 35 V, or the regulators may be damaged. The minimum voltage across the
capacitors should be at least 3 V greater than the desired output level. The exact size
of the capacitor depends on the amount of load current expected. In a similar

308
manner, the magnitude of the load current will determine which case style will be
used. Capacitors C3 and C4 are 220 nF units and are only required if the regulators
are located several inches or more from the filter capacitors. If their use is required,
C3 and C4 must be located very close the regulator. C5 and C6 are used to improve
the transient response of the regulator. They are not used for filtering or for circuit
stabilization. Through common misuse, C5 and C6 are often called "stability
capacitors", although this is not their function. Finally, diodes D1 and D2 protect the
regulators from output over-voltage conditions, such as those experienced with
inductive loads.

As you can see, designing moderate fixed voltage regulated power supplies with this
template can be a very straightforward exercise. Once the basic power supply is
configured, all that needs to be added are the regulators and a few capacitors and
diodes. Quite simply, the regulator is "tacked on" to a basic capacitor-filtered
unregulated supply. For a simple single polarity supply, the additional components
can be reduced to a single regulator IC, the extra capacitors and diode being ignored.

Current Boosting

For very high output currents, it is possible to utilize external pass transistors to
augment the basic linear regulator ICs. An example is shown in Figure 8.8. When
the input current rises to a certain level, the voltage drop across R1 will be large
enough to turn on transistor Q1. When Q1 starts to conduct, a current will flow
through R3. As this current rises, the potential across R3 will increase to the point
where the power transistor Q2 will turn on. Q2 will handle any further increases in
load current. Normally, R1 is set so that the regulator is running at better than one-
half of its maximum rating before switch over occurs. A typical value would be
22 . For example, if switch over occurs at 1 A, the regulator will supply all of the
load's demand up to 1 A. If the load requires more than 1 A, the regulator will
supply 1 A, and the power transistor will supply the rest. Circuits of this type often
need a minimum load current to function correctly. This "bleed-off" can be achieved
by adding a single resistor in parallel with the load.

                                                                                                                     Figure 8.8
                                                                                                                     Pass transistors for increased
                                                                                                                     load current.

309
Another possibility for increased output current is by paralleling devices and adding
small ballast resistors. An example of this is shown in Figure 8.9. The ballast
resistors are used to create local feedback. This reduces current hogging and forces
the regulators to equally share the load current. (This is the same technique that is
commonly used in high-power amplifiers so that multiple output transistors may be
connected in parallel.) The size of the ballast resistors is rather low, usually 0.5  or
less.

                                                                                                                     Figure 8.9
                                                                                                                     Parallel devices for
                                                                                                                     increased load current.

Low Dropout Regulators

Low dropout regulators (usually shortened to LDO) are a special subclass of ordinary
linear regulators. Generally, they operate the same way, but with one major
exception. Unlike normal linear regulators, LDOs do not require a large input-output
differential voltage of several volts. Instead, LDOs will regulate with a differential as
little as a few tenths of a volt. This minimum input-output differential is known as
the dropout voltage. With a lowered headroom requirement, the LDO is much more
efficient than the standard regulator, especially with low voltage outputs. An
example is the LM2940. Like the LM78XX, this regulator is available at many
popular output potentials, including 5, 12, and 15 V. It is rated for a 1 A output
current. At maximum current, the dropout voltage is typically 0.5 V. At an output of
100 mA, the dropout voltage is typically 110 mV.

Programmable and Tracking Regulators

Along with the simple three-pin fixed regulators, a number of adjustable or
programmable devices are available. Some devices also include features such as
programmable current limiting. Also, it is possible to configure multiple regulators
so that they track, or follow, each other.

One popular adjustable regulator is the LM317. This device is functionally similar to
the 340 series discussed in the previous section. In essence, it has an internal
reference of 1.25 V. By using an external voltage divider, a wide range of output

310
potentials are available. The LM317 will produce a maximum current of 1.5 A and a
maximum voltage of 37 V. A basic connection diagram is shown in Figure 8.10. The
R1/R2 divider sets the output voltage according to the formula

           ( ) V out=1.25 V 1+R2 +I adj R2
                                                     R1

Iadj is the current flowing through the bottom adjust pin. Iadj is about 100 A, and
being this small, may be ignored to a first approximation. R1 is set to 240 . D1
serves as a protection device for output over-voltages as seen in the preceding
section. The 10 F capacitor is used to increase the ripple rejection of the device.
The addition of this capacitor will increase ripple rejection by at least 10 dB. Diode
D2 is used to prevent possible destructive discharges from the 10 F capacitor. In
practice, R2 is set to a fixed size resistor for static supplies, or is a potentiometer for
user-adjustable supplies.

                                                                                                                     Figure 8.10
                                                                                                                     Basic LM317 regulator.

Example 8.3

         Determine a value for R2 so that the output is adjustable from a minimum of
         1.25 V to a maximum of 15 V.
         For the minimum value, R2 should be 0 . Ignoring the effect of Iadj, the
         maximum value is found by

               ( ) V out=1.25 V 1+R2
                                                               R1

               ( ) R2=R1× V out 1.25 V-1

                ( ) R2=240× 15 V 1.25 V-1

                                          R2=2.64 k
311
         Normally, such a value is not available for stock potentiometers. A 2.5 k
         unit may be readily available, so R1 may be reduced a bit in order to
         compensate.

Computer Simulation

Figure 8.11 shows a simulation of the regulator designed in Example 8.3. The
LM117 model used is very similar to the LM317. The maximum potentiometer
value of 2.5 k is used here in order to see just how far off the design is from the 15
volt target. As in the earlier chapter simulation, a sine wave riding on a DC offset is
used as the input to mimic the presence of ripple on the unregulated power source.
The Transient Analysis of Multisim is used to plot the input and output waveforms.
The circuit produces a very stable DC output as desired. Also, the level is only a few
tenths of a volt shy of the desired 15 volt maximum, as expected. The simulation
verifies the manual calculations quite well.

                                                                                                                     Figure 8.11a
                                                                                                                     LM317/LM117 simulation.

When using the LM317, if a minimum value greater than 1.25 V is needed, the pot
may be placed in series with a fixed resistor. Alternately, precise preset values may
be obtained through the use of a rotary switch and a bank of fixed resistors, as
shown in Figure 8.12. As a matter of fact, these techniques may also be applied to
the fixed three-pin devices presented in the previous section. For example, a
LM7805 may be used as a 15 V regulator just by adding an external divider network
as shown in Figure 8.13. You can think of the LM7805 as an LM317 with a 5 V
reference. The exact values are not critical; what is important is that the ratio of the
two resistors is 2:1.

312
                                                                                                                     Figure 8.11b
                                                                                                                     Waveforms from Multisim.

One of the major problems with adjustable linear regulators is a "bottom end"
limitation. It is easier for a regulator of this type to generate a high load current at a
high load voltage than it is to generate a high load current at a low load voltage. The
reason for this is that at low output voltages, the internal pass transistor sees a very
high differential voltage. This results in very high power dissipation. If the device
gets too hot, the thermal protection circuits may activate. From a user's standpoint,
this means that the power supply may be able to produce a 15 V, 1 A output, but be
unable to produce a 5 V, 1 A output.

                                                                                                                     Figure 8.12
                                                                                                                     Adjustable regulation.

                                                                                                                     Figure 8.13
                                                                                                                     Varying output voltage with a
                                                                                                                     fixed regulator.
Another popular regulator IC is the LM723. This device is of a more modular design
and allows for preset current limiting. The equivalent circuit of 723 is shown in
Figure 8.14. By itself, the LM723 is only capable of producing 150 mA. With the
use of external pass transistors, an LM723-based regulator may produce several
amps of load current. The internal reference is approximately 7.15 V. Because of

313
this, two basic configurations exist: one for outputs below 7 V, and one for outputs
above 7 V. These configurations and their output formulas are shown in Figure 8.15.

                                                                                                                     Figure 8.14
                                                                                                                     LM723 equivalent circuit.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

By combining Figure 8.13 with Figure 8.14 and redrawing the results in Figures
8.16a and 8.16b you can see a strong resemblance to the basic op amp regulator
encountered earlier. Figure 8.16a is used for outputs greater than the 7.15 V
reference. As such, resistors R1 and R2 are used to set the gain of the internal
amplifier (i.e., the amount by which the reference will be multiplied). Resistor R3
simply serves as DC bias compensation for R1 and R2. For outputs less than the
reference, R1 and R2 serve as a voltage divider, which effectively reduces the
reference, whereas the amplifier operates with a gain of unity. Again, R3 serves as
bias compensation. In short, the output voltage is once again determined by the
reference voltage in conjunction with a pair of resistors. In both cases, the output
current limit is set by

                                I limit= V sense
                                         R sc

Where Vsense is approximately 0.65 V at room temperature (for other temperatures, a
Vsense graph is given in the LM723 data sheet). This equation may be found on the

314
manufacturer's data sheet, but may be readily derived by inspecting Figure 8.16.
Resistor Rsc is placed in series with the load, and thus, the current through it is the
load current (ignoring the small current required by the adjustment resistors). The
current limit transistor is connected so that the voltage across Rsc is applied to this
transistor's base-emitter junction. The collector of the current limit transistor is
connected to the base of the output pass transistor. If the output current rises to the
point where the voltage across Rsc exceeds approximately 0.65 V, the current limit
transistor will turn on, thus shunting output drive current away from the output pass
transistor. As you can see, the formula for Ilimit is little more than the direct
application of Ohm's law. This scheme is similar to the method examined in Chapter
Two to safely limit an op amp's output current.

                                                                                                                     Figure 8.15
                                                                                                                     LM723 "hook ups".

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instruments

315
                                                                                                                     Figure 8.15 (continued)
                                                                                                                     LM723 "hook ups".

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instruments

316
                                                                                                                    Figure 8.16
                                                                                                                    Two basic configurations of an
                                                                                                                    LM723 regulator.
                                                                                                                    a. Output > 7.15 volts (top).
                                                                                                                    b. Output < 7.15 volts (bottom).

Example 8.4
         Design a +12 V regulator using the LM723, with a current limit of 50 mA.
         The basic form for this is the version shown in 8.15.2. The appropriate
         output equation is
                                         V out=V ref R1+R2
                                                         R2
         Choosing an arbitrary value for R2 of 10 k, and then solving for R1,
                                          R1= V out R2- R2
                                               V ref
                                          R1= 12V 7.15 V 10 k-10 k
                                          R1=6.78 k

317
         For the current sense resistor,
                                          I limit = V sense
                                                   R sc
                                          R sc= V sense
                                                 I limit
                                          Rsc= 0.65 V 50 mA
                                          Rsc=13 

         Finally, for minimum temperature drift, R3 is included, and set to R1 || R2
                                          R3= R1 || R2
                                          R3=10 k ||6.78 k
                                          R3=4.04 k

         The completed circuit is shown in Figure 8.17.

                                                                                                                  Figure 8.17
                                                                                                                  Completed 12 volt circuit for
                                                                                                                  Example 8.4.

Example 8.5

         Using the LM723, design a continuously adjustable 2V to 5V supply, with a
         current limit of 1.0 A.
         The basic form for this is the version shown in Figure 8.15.1. The
         appropriate output equation is

                                         V out=V ref R2
                                                      R1 +R 2

318
     We need to make a few modifications to the basic form in order to
     accommodate the high output current and the output voltage adjustment.
     One possibility is shown in Figure 8.18.

                                                                                     Figure 8.18
                                                                                     Circuit for Example 8.5:
                                                                                     2 V to 5 V regulator, 1 amp.

     In order to produce a 1 A load current, an external pass transistor will be
     used. To obtain the desired voltage adjustment, resistor R1 is replaced with a
     series potentiometer/resistor combination (R1a, R1b). In this fashion, the
     minimum value for R1 will be R1b, and the maximum value will be R1a + R1b.
     There are several ways in which we can approach the calculation of these
     three resistors. Perhaps the easiest is to pick a value for R2 and then
     determine values for R1a and R1b. Though this is fairly straightforward, it is
     not very practical because you will most likely wind up with an odd size for
     the potentiometer. A better, though admittedly more involved, approach
     revolves around the selection of a reasonable pot value, such as 10 k.
     Given the desired output potentials, the other two resistors may be found.

     First of all, note that these three resistors are nothing more than a voltage
     divider. The output voltage equation may be rewritten as

     R1 +R2 = V ref
     R2                             V out

     For the maximum case, we have

     R1b+R2 = V ref
         R2                         V out

     R1b+R2 = 7.15 V
         R2                                5V

     R1b+R2 = 1.43
         R2

319
     If we consider R2 to be unity, we may say that the ratio of the two resistors
     to R2 is 1.43:1, or, that the ratio of R1b to R2 is 0.43:1.

     For the minimum case, we have

                 R1a+R1b+R2 = V ref
                                      R2  V out

                 R1a +R1b+R2 = 7.15 V
                                      R2  2V

                 R1a+R1b+R2 = 3.575
                      R2

     We may say that the ratio of the three resistors to R2 is 3.575:1, or that the
     ratio of R1a+R1b to R2 is 2.575:1. Because we already know that the ratio of
     R1b to R2 is 0.43:1, the ratio of R1a to R2 must be the difference, or 2.145:1.
     Because we chose 10 k for R1a,

                 R2= R1a 2.145
                 R2= 10 k 2.145
                 R2=4.66 k

     Similarly,

                 R1b= R2×0.43

                 R1b= 4.66 k ×0.43
                 R1b= 2 k

     For the current sense resistor,

                 I limit= V sense
                          R sc

                 Rsc= V sense
                         I limit

                 Rsc= 0.65 V 1.0 A

                 Rsc=0.65 

     For minimum temperature drift, R3 is included, and set to R1 || R2.
     Because R1 is adjustable, a midpoint value will be used.

                 R3= R1 || R2
                 R3=6 k || 4.66k
                 R3=2.62 k

320
     The final calculation involves the external pass transistor. This design uses a
     1 A output, so this device must be able to handle this current continuously.
     Also, a minimum  specification is required. As the LM723 will be driving
     the pass transistor, the LM723 only needs to produce base drive current.
     With a maximum output of 150 mA, this translates to a minimum  of

                                     min= I c
                                            Ib

                                     min= 1 A 150 mA
                                     min=6.67

     This value should pose no problem for a power transistor.

Besides the applications we have just examined, the LM723 can also be used to              Figure 8.19
make negative regulators, switching regulators, and other types as well. One useful        Current limiting.
variation on the basic theme is the use of foldback current limiting, as seen in Figure    a. Ordinary (top).
8.15.6. Unlike the ordinary form of current limiting, foldback limiting actually           b. Fold back (bottom).
produces a decrease in output current once the limit point is reached. Figure 8.19a
shows the effect of ordinary limiting. Once the limit point is reached, further                     Vload
demands by the load will be ignored. The problem with this arrangement is that              Vout
under short circuit conditions, the pass transistor will be under heavy stress. Because
the load is shorted, so Vload = 0, and therefore, a large potential will drop across the                         I limit I load
pass transistor. This device is already handling the full current draw, thus the                    Vload
resulting power dissipation can be very high. Foldback limiting gets around this             Vout
problem by lowering the output current as the pass transistor's voltage increases.
Note how in Figure 8.19b, the current limit curve does not drop straight down to the                      I sc Iknee I load
limit point, but rather, as the load demand increases, the current drops back to Isc. By
limiting the current in this fashion, a much lower power dissipation is achieved.

Our last item of interest in this section is the LT3032 dual regulator series. These
devices are of particular interest to the op amp technician and designer. The LT3032
is available as a fixed bipolar regulator at outputs of ±3.3, ±5, ±12 or ±15 volts.
Another variant offers adjustable output from ±1.22 volts up to ±20 volts. Output
current capability is up to 150 mA. These devices are ideal for powering general-
purpose op amp circuits.

The circuit in Figure 8.20 is a minimum parts-configuration dual regulator requiring
only two resistors and a capacitor per side.. All that is needed ahead of this circuit is
a standard transformer, rectifier and filter capacitor arrangement, such as that found
in Figure 8.7. The maximum output (unloaded) of the filter capacitors should be no
more than 20 V in order to prevent damage to the LT3032. This circuit is certainly
simpler than the LM317-based regulator of Figure 8.10, and not much different from

321
an LM340-based design. In fact, note the similarity of the design equations
presented for the LM317 and the LT3032. Again, we see that the output potential is
found essentially by multiplying a reference voltage by a series-parallel voltage
gain. The downside is that its power dissipation and maximum currents are
considerably lower than its LM340 or LM317 counterparts. Still, a 150 mA output
capability is sufficient to drive a large number of op amps and other small signal
devices.

                                                                                                                     Figure 8.20
                                                                                                                     LT3032 pinout and
                                                                                                                     formulas.

                                                                                                                                                   Reprinted with permission of
                                                                                                                                                   Linear Technology

Current limiting and thermal shutdown are built-in. Other design features include the
fact that the LT3032 is a low drop-out regulator requiring only a 300 millivolt
differential per channel. ESD (electrostatic discharge) protection is included and
reverse output polarity protection diodes are not required. Further, the addition of a
small 10 nF capacitor at each output will reduce regulator noise voltage down to the
20 to 30 microvolt RMS range.

There are many other linear regulator ICs available to the designer than have been
presented here. Many of these devices are rather specialized, and all units seem to
have their own special set of operational formulas and graphs. There are, however, a
few common threads among them all. First, due to the relative internal complexity,
manufacturers often give very specific application guidelines for their particular ICs.
The resulting design sequence is rather like following a cookbook and makes the
designer's life much easier. Second, as mentioned at the outset, all linear regulators
tend to be rather inefficient. This inefficiency is inherent in the design and
implementation of the linear regulation circuits, and cannot be avoided. At best, the
inefficiency can be minimized for a given application. In order to achieve high
efficiency, a different topology must be considered. One alternative is the switching
regulator.

322
8.4 Switching Regulators

The major cause of the inefficiency of a linear regulator is that its pass transistor
operates in the linear region. This means that it constantly sees both a high current
and a high (or at least moderate) voltage. The result is a sizable power dissipation. In
contrast, switching regulators rely on the efficiency of the transistor switch. When
the transistor is off, no current flows, and thus, no power is dissipated. When the
transistor is on (in saturation), a high current flows, but the voltage across the
transistor (Vce(sat)) is very small. This results in modest power dissipation. The only
time that both the current and voltage are relatively large at the same time is during
the switching interval. This time period is relatively short compared to cycle time, so
again, the power dissipation is rather small.

Switching the pass transistor on and off can be very efficient, but unfortunately, the
resulting pulses of current are not appropriate for most loads. Some way of
smoothing out the pulses into a constant DC level is needed. One way to do this is
through an inductor/capacitor arrangement. This concept is essential to the switching
regulator.

Although the switching regulator does offer an increased efficiency over the linear
regulator, it is not without its detractions. First of all, switching regulators tend to be
more complex than linear types. This complexity may outstrip the efficiency
advantage, particularly for low-power designs. Some of the newer "single chip"
switching regulators make switching power supply design almost as straightforward
as linear design, so this problem is not quite as great as it once was. The other major
problem is that the switching process can create a great deal of radiated electrical
noise. Without proper shielding and similar precautions, the induced noise signals
can produce grave interference in nearby analog or digital circuits. In spite of these
obstacles, switching power supplies have seen great acceptance in a variety of areas,
including powering personal computers.

    control    LC filter                                                                     Figure 8.21
    element                                                                                  Basic switching regulator.

pulse width               load
modulator
and reference

A basic switching regulator outline is shown in Figure 8.21. Once again, a control
device is used to adjust the incoming signal. Unlike the linear regulator, the signal
out of the control element is a pulse train. In order to produce a smooth DC output,
the pulse train is passed through a capacitor/inductor network. The heart of the

323
circuit is the pulse-width modulator. This circuit creates a variable duty cycle pulse
waveform, which alternately turns the control element on and off. The duty cycle of
the pulse is proportional to the load current demand. Low load impedances require
large currents and, thus, will create pulse trains with long "on" times. The peak
value of the pulses will tend to be much greater than the average load current
demand, however, if this current pulse is averaged over one cycle, the result will
equal the load current demand. Effectively, the LC network serves to integrate the
current pulses. This is shown graphically in Figure 8.22. Because the lower load
impedance is receiving a proportionally larger current, the load voltage remains
constant. This is shown graphically in Figure 8.23.

     I  current pulse                                                                   Figure 8.22
                                                                                        Current waveforms.
        (control element)

                           average
                             I load

              low load current (high Z load) t

     I average

                  I load

        high load current (low Z load ) t

324
V  Vcontrol-out

                                                                                         Figure 8.23
                                                                                         Voltage waveforms.

                                                           Vload

   high Z load                                                    t

V

                    Vcontrol-out V

                                                     load

   low Z load                                                     t

Due to the constant charging and discharging of the L and C components, switching
regulators tend to respond to load changes somewhat slower than linear regulators
do. Also, if the frequency of the switching pulse is high, the required sizes for L and
C may be reduced, resulting in a smaller circuit and possible cost reductions. Many
switching regulators run in the 20 kHz to 100 kHz region. The practical upper limit
for switching speed is determined by the speed of the control element. Devices with
fast switching times will prove to be more efficient. Power FETs are very attractive
for this application because of their inherent speed and low drive requirements.
Their negative temperature coefficient of transconductance also helps reduce
thermal runaway problems. For the highest powers, bipolar devices are often the
only choice. Finally, it is possible to configure many switchers for step down, step
up, or inverter operation. As an example, we will investigate the step down, or buck,
configuration.

                                                                                         Figure 8.24a
                                                                                         Basic stepdown switching
                                                                                         regulator.
                                                                                         a. Q on: Source supplies
                                                                                         current and charges inductor.

A block diagram of a step down switching regulator is shown in Figure 8.24. Here is
how it works: When the transistor, Q, is on, current flows through Q, L, and the
load. The inductor current rises at a rate equal to the inductor voltage divided by the
inductance. The inductor voltage is equal to the input voltage minus the load voltage
and the transistor's saturation potential. While L is charging (i.e., IL < Iload), C

325
provides load current. When Q turns off, the inductor's magnetic field starts to
collapse causing an effective polarity reversal. In other words, the inductor is now
acting as a source for load current. At this point, diode D is forward biased,
effectively removing the left portion of the circuit. L also supplies current to
capacitor C during this time period. Eventually, the inductor current will drop below
the value required by the load, and C will start to discharge, making up the
difference. Before L completely discharges, the transistor switch will turn back on,
repeating the cycle. Because the inductor is never fully discharged, this is called
continuous operation. Discontinuous operation is also possible, although we will not
pursue it here. One point worth noting is that for proper continuation of this cycle,
some load current draw must always be present. This minimum level can be
achieved through the use of a bleed resistor in parallel with the load.

                                                                                                                     Figure 8.24b
                                                                                                                     Basic stepdown switching
                                                                                                                     regulator (continued).
                                                                                                                     b. Q off: Inductor supplies
                                                                                                                     current.

The values for C and L are dependent on the input and output voltages, desired         Figure 8.25
output current, the switching frequency, and the particulars of the switching circuit  LM3578 equivalent circuit.
used. Manufacturers generally give look-up tables and charts for appropriate values
and/or formulas. Earlier switching ICs contained the necessary base components and     Reprinted courtesy of Texas
required only a moderate amount of external circuitry. The newest ICs may be           Instrutments
configured with no more than three or four external
passive parts.

One example of a switch mode regulator is the
LM3578A. A functional diagram of the inner workings
of this IC is shown in Figure 8.25. The AND gates,
comparator, oscillator, and associated latches combine
to form the pulse-width modulator. Notice that this
circuit includes an internal reference and medium-
power switching transistor. Thermal shutdown and
current limiting are available. The circuit will operate
at inputs up to 40 V and can produce output currents up
to 750 mA. The maximum switching frequency is 100
kHz. Step up, step down, and inverter configurations
are all possible with this device. To make the design
sequence is fast as possible, the manufacturer has
included a design chart. This is shown in Figure 8.26.
As with virtually all highly specialized ICs, specific
design equations only apply to particular devices, and

326
probably cannot be used with ICs that produce similar functions. Consequently, it is    Figure 8.26
recommended that you do not memorize these formulas!                                    LM3578 design chart.

                                                                                        Reprinted courtesy of Texas
                                                                                        Instrutments

A step down regulator using the LM3578A is shown in Figure 8.27. C1 is the
frequency-selection capacitor and can be found from the manufacturer's chart. C3 is
necessary for continuous operation and is generally in the vicinity of 10 to 30 pF. D1
should be a Schottky-type rectifier. R1 and R2 set the step down ratio (they are
functionally the same as Rf and Ri in the previous work). R3 sets the current limit.
Finally, L1 and C2 are used for the final output filtering.

327
                                                                                        Figure 8.27
                                                                                        Step down regulator using
                                                                                        an LM3578.

The relevant equations from the manufacturer's data sheets are:

             V out = R1 +1 (in volts)
                         R2

             R3 = 0.11V
                       I sw( max)

             C2   V out            V i n-V out

                                   2
                         8 f V in V ripple L1

             L1 = V out V i n-V out
                             I out V i n f

              I out = 2 I out Discontinuity Factor (typically 0.2)

Where Isw(max) is the maximum current through the switching element, and Vripple is in
peak-to-peak volts. Some values may be found using the look-up chart method
shown in Figure 8.26.

Example 8.6

     Using the LM3578A, design a step down regulator that delivers 12 V from a
     20 V source, with 200 mA of load current. Use an oscillator frequency of 50
     kHz, and a discontinuity factor of 0.2 (20%). Ripple should be no more than
     40 mV.

     First determine the R1 and R2 values. R2 is arbitrarily chosen at 10 k.

328
V out= R1 +1 (in volts)
       R2

R1= R2(V out-1 V )
R1=10 k (12 V-1 V)
R1=110 k

R3= 0.11 V
      I sw( max)

R3= 0.11 V 0.75 A
R3=0.15 

Note that R3 will always be 0.15  for this circuit form.

From the oscillator graph, C1 is estimated at 1700 pF, and C3 is set to 20 pF,
as suggested by the manufacturer.

 I out=2 I out Discontinuity Factor
 I out=2×200 mA×0.2
 I out=80 mA

L1=V out V i n-V out
           I out V i n f

L1=12 V× 20 V-12 V 80 mA×20 V×50kHz
L1=1.2 mH

C2  V out×  V in-V out

            2
            8 f V i n V ripple L1

C2  12 V× 8×50 kHz2 20 V-12 V ×20 V×40 mV×1.2 mH

C2  5F

To be on the conservative side, C2 is usually set a bit higher, so a standard
33 F or 47 F might be used.

A basic inverting switcher is shown in Figure 8.28. This circuit produces a negative
output potential from a positive input. It works as follows: When the transistor
switch is closed, the inductor L is charged. Diode D is in reverse bias, as its anode is
negative. When the switch opens, the inductor's collapsing field causes it to appear
as a source of opposite polarity. The diode is forward-biased because its cathode is
now forced to be lower than its anode. The inductor is now free to deliver current to
the load. Eventually, the inductor will discharge to the point where the transistor

329
switch will turn back on. While the inductor is charging, capacitor C will supply the
load current. The process repeats, thus maintaining a constant output potential.

                                                                                                                    Figure 8.28
                                                                                                                    Basic inverting switcher.
                                                                                                                    a. Q on: Inductor is charged
                                                                                                                    by the source (top).
                                                                                                                    b. Q off: Inductor supplies
                                                                                                                    current (bottom).

A basic step up switcher is shown in Figure 8.29. This variation is used when a
potential greater than the input is desired, such as deriving a 15 V supply from an
existing 5 V source. Here is how the circuit works: When the transistor switch is
closed, the inductor L charges. During this time period, the capacitor C is supplying
load current. Because the output potential will be much higher than the saturation
voltage of the transistor switch, the diode D will be in reverse bias. When the
transistor turns off, the magnetic field of the inductor collapses, causing the inductor
to appear as a source. This potential is added to the driving source potential, as these
two elements are in series. This combined voltage is what the load sees; hence, the
load voltage is greater than the driving source. Eventually, the inductor will
discharge to the point where the transistor switches back on, thus reverse-biasing the
diode and recharging L. The capacitor will continue to supply load current during
this time. This process will continue in this fashion, producing the desired output
voltage.

                                                                                                                    Figure 8.29a
                                                                                                                    Basic step-up switching
                                                                                                                    regulator.
                                                                                                                    Q on: Source charges
                                                                                                                    inductor.

330
                                                                                                                     Figure 8.29b
                                                                                                                     Basic step-up switching
                                                                                                                     regulator.
                                                                                                                     Q off: Inductor supplies
                                                                                                                     current.

For the step up and inverter forms, other sets of equations are used for the
LM3578A. Although the design sequence is certainly not quite as straightforward as
in the linear regulator circuits, it is definitely not a major undertaking, either. If
750 mA is not sufficient, an external pass transistor may be added to the LM3578A.
Other switching regulator ICs are available from different manufacturers. Each unit
operates on the same basic principle, but the realization of the design may take
considerably different routes. Specific device data sheets must be consulted for each
model.
For specific applications, some manufacturers offer switching regulators that are
almost drop-in replacements for basic 3-pin linear regulators. These devices are not
nearly as flexible as the generic switching regulator ICs, though. A good example is
the LM2576 regulator. This is a 3 A output, step down regulator (i.e., buck-mode
only). It is available at a variety of output potentials ranging from 3.3 V to 15 V. An
adjustable version is also available. A block diagram and typical circuit are shown in
Figure 8.30. As you can see, a typical fixed output design requires a minimum of
external components: 2 capacitors, an inductor, and a diode. Other members of this
family include the LM2574 0.5 A step down regulator, and the LM2577 step up
regulator.

331
                                                                                                                   Figure 8.30
                                                                                                                   LM2576 switching regulator.

                                                                                                                                               Reprinted courtesy of Texas
                                                                                                                                               Instrutments

332
8.5 Heat Sink Usage

Whenever appreciable amounts of power are dissipated by semiconductor devices,
some form of cooling element needs to be considered. Power supply regulation
circuits are no exception. The pass transistors used in both linear and switching
regulators can be forced to dissipate large amounts of power. The result of this is the
production of heat. Generally, the life-span of semiconductors drops as the operation
temperature rises. Most silicon-based devices exhibit maximum allowable junction
temperatures in the 150°C range. Although power transistors utilize heavier metal
cases, they are generally not suitable for high dissipation applications by themselves.
In order to increase the thermal efficiency of the device, an external heat sink is
used. Heat sinks are normally made of aluminum and appear as a series of fins. The
fins produce a large surface, which enhances the process of heat convection. In other
words, the heat sink can transfer heat to the surrounding atmosphere faster than the
power transistor can. By bolting the transistor to the heat sink, the device will be
able to dissipate more power at a given operating temperature. Some typical heat
sinks are shown in Figure 8.31.

                                                                                                                     Figure 8.31
                                                                                                                     Typical heatsinks.

                                                                                                                                                   Reprinted courtesy of Thermalloy, Inc.

333
Physical Requirements

Heat sinks are designed to work with specific device-case styles. The most common
case styles for regulators are the TO-220 "power tab", and the TO-3 "can". Heat
sinks are available for these specific styles, including the requisite mounting
hardware and insulation spacers. Some of the lower power regulators utilize TO-5
"mini can" or DIP-type cases. Heat sinks are available for these package types, too,
but are not quite as common.

There are a couple of general rules that should be followed when using heat sinks:

    · Always use some form of heat sink grease or thermally conductive pad
         between the heat sink and the device. This will increase the thermal transfer
         between the two parts. Note that excessive quantities of heat sink grease will
         actually decrease} performance.

    · Mount fins in the vertical plane for optimum natural convective cooling.
    · Do not overcrowd or obstruct devices that use heat sinks.
    · Do not block air flow around heat sinks - particularly directly above and

         below items that rely on natural convection.
    · If thermal demands are particularly high, consider using forced convection

         (e.g., fans).

Thermal Resistance

In order to specify a particular heat sink for a given application, a more technical
explanation is in order. What we are going to do is create a thermal circuit
equivalent. In this model, the concept of thermal resistance is used. Thermal
resistance denotes how easy it is to transfer heat energy from one mechanical part to
another. The symbol for thermal resistance is , and the units are Celsius degrees per
watt. In this model, temperature is analogous to voltage, and thermal power
dissipation is analogous to current. A useful equation is,

                    P D= T total  (8.4)

Where PD is the power dissipated by the semiconductor device in watts, T is the
temperature differential, and total is the sum of the thermal resistances. Basically,
this is a thermal version of Ohm's law.

In order to construct our model, let's take a closer look at the power-device/heat-sink
combination. This is shown in Figure 8.32. Tj is the semiconductor junction
temperature. This heat energy source heats the device case to Tc. The thermal
resistance between the two entities is jc. The case, in turn, heats the heat sink via the
interconnection. This thermal resistance is cs, and the resulting temperature is Ts.

334
Finally, the heat sink passes the thermal energy to the surrounding air, which is
sitting at Ta. The thermal resistance of the heat sink is sa. The equivalent thermal
model is shown in Figure 8.33. (Although this does not have perfect correspondence
with normal circuit analysis, it does illustrate the main points.)

          mounting              heat sink                                                Figure 8.32
          interface                                                                      Device and heatsink.

junction

case

          jc

                        cs

                            sa

              Tj Tc Ts                     Ta

                                                                                         Figure 8.33
                                                                                         Equivalent thermal model of
                                                                                         Figure 8.32.

In this model, ground represents a temperature of absolute zero. The circuit is sitting
at an ambient temperature Ta, thus a voltage source of Ta is connected to ground and

335
the heat sink. The three thermal resistances are in series and are driven by a current
source that is set by the present power dissipation of the device. Note that if the
power dissipation is high, the resulting "voltage drops" across the thermal
resistances are high. Voltage is analogous to temperature in this model, so this
indicates that a high temperature is created. Because there is a maximum limit to Tj,
higher power dissipations require lower thermal resistances. As jc is set by the
device manufacturer, you have no control over that element. However, cs is a
function of the case style and the insulation material used, so you do have some
control (but not a lot) over that. On the other hand, as the person who specifies the
heat sink, you have a great deal of control over sa. Values for sa are given by heat
sink manufacturers. A useful variation of Equation 8.4 is

             P D= T j-T a  jc+cs+sa  (8.5)

Normally, power dissipation, junction and ambient temperatures, jc and cs are
known. The idea is to determine an appropriate heat sink. Both Tj and jc are given
by the semiconductor device manufacturer. The ambient temperature, Ta, may be
determined experimentally. Due to localized warming, it tends to be higher than the
actual "room temperature". Standard graphs, such as those found in Figure 8.34,
may be used to determine cs.

Example 8.7

     Determine the appropriate heat sink rating for a power device rated as
     follows: Tj(max) = 150°C, TO-220 case style, jc = 3.0 C°/W. The device will
     be dissipating a maximum of 6 W in an ambient temperature of 40°C.
     Assume that the heat sink will be mounted with heat sink grease and a 0.002
     mica insulator.

     First, find cs from the TO-220 graph. Curve 3 is used. The approximate
     (conservative) value is 1.6 C°/W.

                                     PD= T j-T a  jc+cs+sa
                                     sa=T j-T a - jc-cs

                                             PD
                                     sa= 150°C-40°C 6 W -3.0 C° / W-1.6 C°/ W
                                     sa=13.73 C° /W

     This is the maximum acceptable value for the heat sink's thermal resistance.
     Note that the use of heat sink grease gives us an extra 2 C°/W or so. Also,
     note the generally lower values of sa for the TO-3 case relative to the TO-

336
         220. This is one reason why TO-3 cases are used for higher power devices.
         This case also makes it easier for the manufacturer to reduce jc.

                                                                                                                     Figure 8.34
                                                                                                                     CS for TO-3 and TO-220.

                                                                                                                                                   Reprinted courtesy of Thermalloy, Inc.

337
8.6 Extended Topic: Primary Switcher

The switching regulators examined earlier are referred to as secondary switchers
because the switching elements are found on the secondary side of the power
transformer. In contrast to this is the primary or forward switcher. The switching
circuitry in these designs is placed prior to the primary of the power transformer.
This positioning offers a distinct advantage over the secondary switcher. The power
transformer and secondary rectifier will be handling much higher frequencies, thus
they can be made much smaller. The result is a physically smaller and lighter design.

One possible configuration of a primary switcher is shown in Figure 8.35. This is
known as a push-pull configuration. The two power transistors are alternately pulsed
on and off. That is, when one device is conducting, the other is off. By doing this,
opposite polarity pulses are fed into the primary of the transformer, creating a high
frequency alternating current (as is the case with secondary switchers, primary
switchers operate at frequencies well above the nominal 60 Hz power line). This
high frequency waveform is then stepped up or down to the secondary, where it is
again rectified and then filtered, producing a DC output signal.

                                                                                                                   Figure 8.35
                                                                                                                   Push-pull primary switching
                                                                                                                   regulator.

Although the transformer and secondary rectifier/filter may be reduced in size, it is
important to note that the main input rectifier and switching transistors are not
isolated from the AC power source, as is the case in other power supply designs.
These devices must handle high input potentials. For an ordinary 120 V AC line,
that translates to over 170 V peak. Also, the power transistors will see an off-state
potential of twice Vin, or over 340 V in this case. Some form of in-rush current
limiting will also need to be added.

A somewhat more sophisticated approach is taken in Figure 8.36. This circuit is
known as a full bridge switcher. In this configuration, diagonal pairs of devices are
simultaneously conducting (i.e., Q1/Q4 and Q2/Q3). By eliminating the center-tapped

338
primary, each device sees a maximum potential of Vin, or one-half that of the push-
pull switcher. The obvious disadvantage is the need for four power devices instead
of just two.

Primary switchers do offer a size and weight advantage over secondary switchers
and linear regulators. They also maintain the high efficiency characteristics of the
secondary switcher. They do tend to be somewhat more complex, though, and their
application is therefore best suited to cases where circuit size, weight, and efficiency
are paramount.

                                                                                                                     Figure 8.36
                                                                                                                     Full-bridge primary switching
                                                                                                                     regulator.

Summary

In this chapter you have examined the basic operation of voltage regulators. Their
purpose is simple: to provide constant, non-varying output voltages despite changes
in either the AC source, or in the load current demand. Voltage regulation circuits
are an integral part of just about every piece of modern electronic equipment. Due to
their wide use, a number of specialized voltage regulator ICs are available from a
variety of manufacturers.

Voltage regulation may be achieved through two main methods. These methods are
linear regulation and switching regulation. In both cases, a portion of the output
voltage is compared to a stable internal reference. The result of this comparison is
used to drive a control element, usually a power transistor. If the output voltage is
too low, the control element allows more current to flow to the load from the
rectified AC source. Conversely, if the output is too high, the control element
constricts the current flow. In the case of the linear regulator, the control element is
always in the active, or linear, state. Because of this, the linear regulator tends to
dissipate quite a bit of power and, as a result, is rather inefficient. On the plus side,
the linear regulator is able to quickly react to load variations, and thus exhibits good
transient response.

339
In contrast to the linear regulator, the control device in the switching regulator is
either fully on or fully off. As a result, its power dissipation tends to be reduced. For
best performance, fast control devices are needed. The control device is driven by a
pulse-width modulator. The output of this modulator is a rectangular pulse whose
duty cycle is proportional to the load-current demand. As the control device
produces current pulses instead of a constant current, some means of smoothing the
pulses is necessary. This function is performed by an LC filter. The main advantage
of the switching regulator is its high efficiency. On the down side, switching
regulators are somewhat more difficult to design, do not respond as fast to transient
load conditions, and tend to radiate high frequency interference.

No matter what type of regulator is used, power dissipation can be rather large in the
control device, so heat sinking is generally advisable. Heat sinks allow for a more
efficient transferal of heat energy to the surrounding atmosphere than the control
device exhibits on its own.

Review Questions

    1. What is the function of a voltage regulator?
    2. What is the difference between load regulation and line regulation?
    3. Why do regulators need a reference voltage?
    4. What is the functional difference between a linear regulator and a switching

         regulator?
    5. What are the main advantages of using linear regulators versus switching

         regulators?
    6. What are the main advantages of using switching regulators versus linear

         regulators?
    7. What is the function of a pass transistor?
    8. Describe two ways in which to increase the output current of an IC-based

         regulator.
    9. How can fixed "three-pin" regulators be used to regulate at other than their

         rated voltage?
    10. What is the purpose of the output inductor and capacitor in the switching

         regulator?
    11. Explain the correlation between the output current demand and the pulse-

         width modulator used in switching regulators.
    12. What is the purpose of a heat sink?
    13. What is meant by the term thermal resistance?
    14. What are the thermal resistance elements that control heat flow in a typical

         power-device/heat-sink connection?
    15. What are the general rules that should be considered when using heat sinks?

340
Problems

Analysis Problems

    1. If the average input voltage to the circuit of Problem 9 is 22 V, determine
         the maximum device dissipation for a 900 mA output.

    2. If the average input voltage is 25 V for the circuit of Problem 11, determine
         the maximum output current for each output voltage. Use the TO-220 case
         style (PD = 15 W, Ilimit = 1.5A).

    3. Draw a block diagram of a complete ±12 V regulated power supply using
         LM78XX and LM79XX series parts.

    4. Determine the maximum allowable thermal resistance for a heat sink given
         the following: Ambient temperature = 50°C, maximum operating
         temperature = 150°C, TO-3 case style with thermal grease and Thermalfilm
         isolator, power dissipation is 30 W, and the device's thermal resistance is 1.1
         C°/W, junction to case.

    5. A pass transistor has the following specifications: maximum junction
         temperature = 125°C, TO-220 case, junction to case thermal resistance = 1.5
         C°/W. Determine the maximum power dissipation allowed if this device is
         connected to a 20 C°/W heat sink with thermal grease, using a 0.003 mica
         insulator. The ambient temperature is 35°C.

    6. The thermal resistance of the LM723 is 25 C°/W, junction to case. Its
         maximum operating temperature is 150°C. For a maximum dissipation of
         500 mW and an ambient temperature of 30°C, determine the maximum
         allowable thermal resistance for the heat-sink/insulator-interface
         combination.

Design Problems

    7. Using Figure 8.4, design a 15 V regulator using a 3.3 V Zener. The Zener
         bias current should be 2 mA, the output should be capable of 500 mA.

    8. Using Figure 8.4 as a guide, design a variable power supply regulator with a
         5 to 15 V output range using a 3.9 V Zener. Izener = 3 mA.

    9. Design a +12 V regulator using the LM317. The output current capability
         should be at least 900 mA.

    10. Design a +3 to +15 V regulator using the LM317. The output should be
         continuously variable.

    11. Using the LM317, configure a regulator to produce either +5V, +12V, or
         +15V.

    12. Design a +12 V regulator using the LM7805.
    13. Design a +9 V regulator using the LM723. Use a current limit of 100 mA.

341
    14. Design a +5 V regulator with 100 mA current limiting using the LM723.
    15. Configure a ±12 V regulator with 70 mA current limiting. Use the LM326
    16. Reconfigure the circuit of Problem 15 for ±15 V.
    17. Using the LM3578A, design a 5 V, 400 mA, regulator. The input voltage is

         15 V. Use a discontinuity factor of 0.2, and an oscillator frequency of 75
         kHz. No more than 10 mV of ripple is allowed.
    18. Repeat Problem 17 for a 9 V output.

Challenge Problems

    19. Based on the LM723 adjustable regulator example, design a regulator that
         will produce a continuously variable output from 5 V to 12 V.

    20. The LM317 has a maximum operating temperature of 125°C. The TO-220
         case version shows a thermal resistance of 4 C°/W, junction to case. It also
         shows 50 C°/W, junction to ambient (no heat sink used). Assuming an
         ambient temperature of 50°C. What is the maximum allowable power
         dissipation for each setup? Assume that the first version uses a 15 C°/W heat
         sink with a 2 C°/W case to heat sink interconnection.

    21. Forced air cooling of a heat-sink/power-device can significantly aid in
         removing heat energy. As a rule of thumb, forced air cooling at a velocity of
         1000 feet per minute will effectively increase the efficiency of a heat sink by
         a factor of 5. Assuming such a system is applied to the circuit of Problem
         17, calculate the new power dissipation.

    22. An LM317 (TO-3) is used for a 5 V, 1 A power supply. The average voltage
         into the regulator is 12 V. Assume a maximum operating temperature of
         125°C, and an ambient temperature of 25°C. First, determine whether or not
         a heat sink is required. If it is, determine the maximum acceptable thermal
         resistance for the heat-sink/insulator combination. For the LM317, thermal
         resistance = 2.3 C°/W, junction to case, and 35 C°/W, junction to ambient.

Computer Simulation Problems

    23. Using a simulator, plot the time-domain response of the circuit of Figure
         8.13, assuming an input of 22 V with 3 V peak ripple. How does the
         simulation change if the ripple is increased to 8 V peak?

    24. Verify the output waveform for the circuit of Figure 8.17 using a simulator.
         Use various loads in order to test the current limit operation. The source is
         18 VDC, with 2 V peak ripple.

    25. Verify the adjustment range for the regulator designed in Example 8.5 in the
         text using a simulator. Use a load of 200 , and a source equal to 10 V, with
         1 V peak ripple.

342
    26. Use several different loads with a simulator in order to test the current limit
         portion of the regulator designed in Example 8.5 in the text.

343
9 Oscillators and Frequency Generators

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Explain the differences between positive and negative feedback.
    · Define the Barkhausen criterion, and relate it to individual circuits.
    · Detail the need for level-detecting circuitry in a practical oscillator.
    · Analyze the operation of Wien bridge and phase shift op amp oscillators.
    · Analyze the operation of comparator-based op amp oscillators.
    · Detail which factors contribute to the accuracy of a given oscillator.
    · Explain the operation of a VCO.
    · Explain the operation of a PLL, and define the terms capture range and lock range.
    · Explain the operation of basic timers and waveform generators.

9.1 Introduction

Oscillators are signal sources. Many times, it is necessary to generate waveforms with a known wave shape,
frequency, and amplitude. A laboratory signal generator perhaps first comes to mind, but there are many other
applications. Signal sources are needed to create and receive radio and television signals, to time events, and to
create electronic music, among other uses. Oscillators may produce very low frequencies (a fraction of a cycle
per second) to very high frequencies (microwaves, > 1 GHz). Oscillators employing op amps are generally used
in the area below 1 MHz. Specialized linear circuits may be used at much higher frequencies. The output wave
shape may be sinusoidal, triangular, pulse, or some other shape. Oscillators can generally be broken into two
broad categories: fixed frequency or variable. For many fixed frequency oscillators, absolute accuracy and
freedom from drift are of prime importance. For variable oscillators, ease of tuning and repeatability are usually
important. Also, a variable frequency oscillator might not be directly controlled by human hands, rather, the
oscillator may be tuned by another circuit. A VCO, or voltage-controlled oscillator, is one example of this.
Depending on the application, other factors such as total harmonic distortion or rise time may be important.

No matter what the application or how the oscillator design is realized, the oscillator circuit will normally
employ positive feedback. Unlike negative feedback, positive feedback is regenerative - it reinforces change.
Generally speaking, without some form of positive feedback, oscillators could not be built. In this chapter we
are going to look at positive feedback and the requirements for oscillation. A variety of small oscillators based
on op amps will be examined. Finally, more powerful integrated circuits will be discussed.

344
9.2 Op Amp Oscillators

Positive Feedback and the Barkhausen Criterion

In earlier work, we examined the concept of negative feedback. Here, a portion of          Figure 9.1
the output signal is sent back to the input and summed out of phase with the input         Positive feedback.
signal. The difference between the two signals then, is what is amplified. The result
is stability in the circuit response because the large open-loop gain effectively forces      + A
the difference signal to be very small. Something quite different happens if the                  +
feedback signal is summed in phase with the input signal, as shown in Figure 9.1. In
this case, the combined signal looks just like the output signal. As long as the open-                             
loop gain of the amplifier is larger than the feedback factor, the signal can be
constantly regenerated. This means that the signal source can be removed. In effect,
the output of the circuit is used to create its own input. As long as power is
maintained to the circuit, the output signal will continue practically forever. This
self-perpetuating state is called oscillation. Oscillation will cease if the product of
open loop gain and feedback factor falls below unity or if the feedback signal is not
returned perfectly in phase (0° or some integer multiple of 360°). This combination
of factors is called the Barkhausen Oscillation Criterion. We may state this as
follows:

In order to maintain self-oscillation, the closed-loop gain must be unity or greater,
and the loop phase must be N 360°, where N = 0, 1, 2, 3...

Note that when we examined linear amplifiers, we looked at this from the opposite
end. Normally, you don't want amplifiers to oscillate, and thus you try to guarantee
that the Barkhausen Criterion is never met by setting appropriate gain and phase
margins.

A good example of positive feedback is the "squeal" sometimes heard from
improperly adjusted public address systems. Basically, the microphone is constantly
picking up the ambient room noise, which is then amplified and fed to the
loudspeakers. If the amplifier gain is high enough or if the acoustic loss is low
enough (i.e., the loudspeaker is physically close to the microphone), the signal that
the microphone picks up from the loudspeaker can be greater than the ambient noise.
The result is that the signal constantly grows in proper phase to maintain oscillation.
The result is the familiar squealing sound. In order to stop the squeal, either the gain
or the phase must be disrupted. Moving the microphone may change the relative
phase, but it is usually easier to just reduce the volume a little. It is particularly
interesting to listen to a system that is on the verge of oscillation. Either the gain or
the phase is just not quite perfect, and the result is a rather irritating ringing sound,
as the oscillation dies out after each word or phrase.

345
There are a couple of practical considerations to be aware of when designing               Figure 9.2
oscillators. First of all, it is not necessary to provide a "start-up" signal source as    Practical oscillator.
seen in Figure 9.1. Normally, there is enough energy in either the input noise level
or possibly in a turn-on transient to get the oscillator started. Both the turn-on                            gain limit
transient and the noise signal are broad spectrum signals, so the desired                                     network
oscillation frequency is contained within either of them. The oscillation
signal will start to increase as time progresses due to the closed-loop gain              A
being greater than one. Eventually, the signal will reach a point where
further level increases are impossible due to amplifier clipping. For a more              frequency
controlled, low-distortion oscillator, it is desirable to have the gain start to          selective
roll off before clipping occurs. In other words, the closed-loop gain should              network
fall back to exactly one. Finally, in order to minimize frequency drift over
time, the feedback network should be selective. Frequencies either above or
below the target frequency should see greater attenuation than the target
frequency. Generally, the more selective (i.e., higher Q) this network is, the more
stable and accurate the oscillation frequency will be. One simple solution is to use an
RLC tank circuit in the feedback network. Another possibility is to use a piezo-
electric crystal. A block diagram of a practical oscillator is shown in Figure 9.2.

A Basic Oscillator

A real-world circuit that embodies all of the elements is shown in Figure 9.3. This
circuit is not particularly efficient or cost-effective, but it does illustrate the
important points. Remember, in order to maintain oscillation the closed-loop gain of
the oscillator circuit must be greater than 1, and the loop phase must be a multiple of
360°.

                                                                                          Figure 9.3
                                                                                          A basic oscillator.

To provide gain, a pair of inverting amplifiers is used. Note op amp 2 serves to
buffer the output signal. As each stage produces a 180° shift, the shift for the pair is
360°. The product of the gains has to be larger than the loss produced by the
frequency selecting network. This network is made up of R3, L, and C. Because the
LC combination produces an impedance peak at the resonant frequency, fo, a
minimum loss will occur there. Also, at resonance, the circuit is basically resistive,
so no phase change occurs. Consequently, this circuit should oscillate at the fo set by
L and C. This circuit can be easily tested in lab. For example, if you drop the gain of

346
one of the op amp stages, there will not be enough system gain to over come the
tank circuit's loss, and thus, oscillation will cease. You can also verify the phase
requirement by replacing one of the inverting amplifiers with a noninverting
amplifier of equal gain. The resulting loop phase of 180° will halt oscillation. This
circuit does not include any form of automatic gain adjustment, so the output signal
may be clipped. If properly chosen, the slew rate of the op amp may be used as the
limit factor. (A 741 will work acceptably for fo in the low kHz range). Although this
circuit does work and points out the specifics, it is certainly not a top choice for an
oscillator design based on op amps.

Wien Bridge Oscillator

A relatively straightforward design useful for general-purpose work is the Wien          Figure 9.4
bridge oscillator. This oscillator is far simpler than the generalized design shown in   Lead/lag network.
Figure 9.3, and offers very good performance. The frequency selecting network is a
simple lead/lag circuit, such as that shown in Figure 9.4. This circuit is a frequency-
sensitive voltage divider. It combines the response of both the simple lead
and lag networks. Normally, both resistors are set to the same value. The
same may be said for the two capacitors. At very low frequencies, the
capacitive reactance is essentially infinite, and thus, the upper series
capacitor appears as an open. Because of this, the output voltage is zero.
Likewise, at very high frequencies the capacitive reactance approaches
zero, and the lower shunt capacitor effectively shorts the output to ground.
Again, the output voltage is zero. At some middle frequency the output
voltage will be at a peak. This will be the preferred, or selected, frequency and will
become the oscillation frequency so long as the proper phase relation is held. We
need to determine the phase change at this point as well as the voltage divider ratio.
These items are needed in order to guarantee that the Barkhausen conditions are met.

First, note that

                  = Z 2
                      Z 1+Z 2

where Z1 = R1 - jXC1, and Z2 = R2 || -jXC2.

                  Z2=- j X C 2 R2
                       - j X C 2 +R2

                        - j X C2 R2
                  ( ) Z2=
                        - j X C2 1+ R2
                                             - j XC2

                        Z 2= R2
                                    R2

                             1+
                                 - j X C2

347
Recalling that XC = 1/C, we find

      Z 1= R1- j
                 C1

     Z2= R2
          1+j  R2 C2

So,

                        R2

     = 1+ j  R2 C2
         R2 1+j  R +R 2 C2 1 - j C1

     = R2
         R2+R1 - j C +j  R 1 1 R2 C2+R2 C2 C1

                                                  R2              (9.1)
                                          +R1+j  R1 R2 C2- 1 C 1
     ( ) ( ) =                    1 +C 2
         R2                          C1

We can determine the desired frequency from the imaginary portion of Equation 9.1.

      R1 R2 C 2= 1                                                (9.2)
                   C1

              2= 1
                    R1 R2C 1 C 2

               = 1

                 R1 R2C 1C 2

Normally, C1 = C2 and R1 = R2, so Equation 9.2 reduces to

     = 1R C or,
     f o= 1 2  RC (9.3)

To find the magnitude of the feedback factor, and thus the required forward gain of
the op amp, we need to examine the real portion of Equation 9.1.

     ( ) = R2
         R2 1+C2 C +R 1 1

348
Assuming that equal components are used, this reduces to

= R3 R  or simply,
= 1

    3

The end result is that the forward gain of the amplifier must have a gain of slightly
over 3 and a phase of 0° in order to maintain oscillation. It also means that the
frequency of oscillation is fairly easy to set and can even be adjusted if
potentiometers are used to replace the two resistors. The final circuit is shown in
Figure 9.5.

                                                                                            Figure 9.5
                                                                                            Wien bridge oscillator.

This circuit uses a combination of negative feedback and positive feedback to
achieve oscillation. The positive feedback loop utilizes Rt and C. The negative
feedback loop utilizes Ra and Rb. Rb must be approximately twice the size of Ra. If it
is smaller, the A product will be less than unity and oscillation cannot be
maintained. If the gain is significantly larger, excessive distortion may result.
Indeed, some form of gain reduction at higher output voltages is desired for this
circuit. One possibility is to replace Ra with a lamp. As the signal amplitude
increases across the lamp, its resistance increases, thus decreasing gain. At a certain
point the lamp's resistance will be just enough to produce an A product of exactly 1.
Another technique is shown in Figure 9.6. Here an opposite approach is taken.
Resistor Rb is first broken into two parts, the smaller part, Rb2, is shunted by a pair of
signal diodes. For lower amplitudes, the diodes are off and do not affect the circuit
operation. At higher amplitudes, the diodes start to turn on, and thus start to short
Rb2. If correctly implemented, this action is not instantaneous and does not produce
clipping. It simply serves to reduce the gain at higher amplitudes.

349
                                                                                                                 Figure 9.6
                                                                                                                 Wien bridge oscillator with
                                                                                                                 gain adjustment.

Another way of drawing the Wien bridge oscillator is shown in Figure 9.7. This
form clearly shows the Wien bridge configuration. Note that the output of the bridge
is the differential input voltage (i.e., error voltage). In operation, the bridge is
balanced, and thus, the error voltage is zero.

                                                                                                                 Figure 9.7
                                                                                                                 Wien bridge oscillator
                                                                                                                 redrawn.

Example 9.1
         Determine the frequency of oscillation for the circuit of Figure 9.8.
                                          f o= 1 2  R C
                                          f o= 1 2 ×50 k×.01  F
                                          f o=318Hz

350
                                                                                                                     Figure 9.8
                                                                                                                     Oscillator for Example 9.1.

         For other frequencies, either R or C may be altered as required. Also, note
         that the forward gain works out to exactly 3, thus perfectly compensating the
         positive feedback factor of 1/3. In reality, component tolerances make this
         circuit impractical. To overcome this difficulty, a small resistor/diode
         combination may be placed in series with the 20 k, as shown in Figure 9.6.
         A typical resistor value would be about one-fourth to one-half the value of
         Rf, or about 5 k to 10 k in this example. Rf would be decreased slightly as
         well (or, Ri might be increased).

The ultimate accuracy of fo depends on the tolerances of R and C. If 10% parts are
used in production, a variance of about 20% is possible. Also, at higher frequencies,
the op amp circuit will produce a moderate phase shift of its own. Thus, the
assumption of a perfect noninverting amplifier is no longer valid, and some error in
the output frequency will result. With extreme values in the positive feedback
network, it is also possible that some shift of the output frequency may occur due to
the capacitive and resistive loading effects of the op amp. Normally, this type of
loading is not a problem, as the op amp's input resistance is very high, and its input
capacitance is quite low.
Example 9.2

         Figure 9.9 shows an adjustable oscillator. Three sets of capacitors are used
         to change the frequency range, whereas a dual-gang potentiometer is used to
         adjust the frequency within a given range. Determine the maximum and
         minimum frequency of oscillation within each range.

351
                                                                                                                     Figure 9.9
                                                                                                                     Adjustable oscillator.

         First, note that the capacitors are spaced by decades. This means that the
         resulting frequency ranges will also change by factors of 10. The 0.1 F
         capacitor will produce the lowest range, the 10 nF will produce a range 10
         times higher, and the 1 nF range will be 10 times higher still. Thus, we only
         need to calculate the range produced by the 0.1 F.
         The maximum frequency of oscillation within a given range will occur with
         the lowest possible resistance. The minimum resistance is seen when the 10
         k pot is fully shorted, the result being 1.1 k. Conversely, the minimum
         frequency will occur with the largest resistance. When the pot is fully in the
         circuit, the resulting sum is 11.1 k. Note that a dual-gang potentiometer
         means that both units are connected to a common shaft; thus, both pots track
         in tandem.
         For fminimum with 0.1F:

                                          f o= 1 2  R C
                                          f o= 1 2 ×11.1 k×0.1  F
                                          f o=143.4 Hz

352
     For fmaximum with 0.1 F:

                                     f o= 1 2  R C
                                     f o= 1 2 ×1.1 k×0.1 F
                                     f o=1.447 kHz

     For the 0.01 F, the ranges would be 1.434 kHz to 14.47 kHz, and for the
     0.001 F, the ranges would be 14.34 kHz to 144.7 kHz. Note that each range
     picks up where the previous one left off. In this way, there are no "gaps", or
     unobtainable frequencies. For stable oscillation, this circuit must have a gain
     of 3. For low-level outputs, the diodes will not be active, and the forward
     gain will be

                                     Av=1+ R f
                                               Ri

                                     Av=1+10k +2.7 k 5.6 k
                                     Av =3.27

     As the signal rises, the diodes begin to turn on, thus shunting the 2.2 k
     resistor and dropping the gain back to exactly 3.

Phase Shift Oscillator

Considering the Barkhausen Criterion, it should be possible to create an oscillator by  Figure 9.10
using a simple phase shift network in the feedback path. For example, if the circuit    Block diagram of phase shift
uses an inverting amplifier (-180° shift), a feedback network with an additional        oscillator.
180° shift should create oscillation.

The only other requirement is that the gain of the inverting amplifier be
greater than the loss produced by the feedback network. This is
illustrated in Figure 9.10. The feedback network can be as simple as
three cascaded lead networks. The lead networks will produce a
combined phase shift of 180° at only one frequency. This will become
the frequency of oscillation. In general, the feedback network will look
something like the circuit of Figure 9.11. This form of RC layout is
usually referred to as a ladder network.

There are many ways in which R and C may be set in order to create the
desired 180° shift. Perhaps the most obvious scheme is to set each stage
for a 60° shift. The components are determined by finding a combination

353
that produces a 60° shift at the desired frequency. In order to avoid loading effects,   Figure 9.11
each stage must be set to higher and higher impedances. For example, R2 might be         Phase shift network.
set to 10 times the value of R1, and R3 set to 10 times the value of R2. The capacitors
would see a corresponding decrease. Because the tangent of the phase shift yields        Figure 9.12
the ratio of XC to R, at our desired 60° we find                                         Phase shift oscillator
                                                                                         (minimum loading form).
                                tan 60= X C
                                           R

                                1.732= X C
                                           R

                                   X C=1.732 R

Using this in the general reactance formula produces

                                f o= 1 2 1.732 R C (9.4)

Likewise, a look at the magnitude shows the approximate loss per stage of

                                = 2 2 R

                         R +X C

                                = 2 2 R

                         R +(1.732 R)

                                =.5

Because there are three stages, the total loss for the feedback network would be
0.125. Therefore, the inverting amplifier needs a gain of 8 in order to set the A
product to unity. Remember, these results are approximate and depend on minimum
interstage loading. A more exacting analysis will follow shortly.

Example 9.3

         Determine the frequency of oscillation in Figure 9.12.

                                          f o= 1 2  1.732 RC
                                          f o= 1 2 ×1.732×1 k×100 nF
                                          f o=919 Hz

Figure 9.12 graphically points up the major problem with the "60° per
stage" concept. In order to prevent loading, the final resistors must be very
high. In this case a feedback resistor of 8 M is required. It is possible to

354
simplify the circuit somewhat by omitting the 1 M and connecting the 100 k
directly to the op amp as shown in Figure 9.13. This saves one part and does allow
the feedback resistor to be dropped in value, but the resulting component spread is
still not ideal.

                                                                                                                     Figure 9.13
                                                                                                                     Improved phase shift oscillator.

If we accept the loading effect, we can simplify things a bit by making each resistor
and capacitor the same size, as shown in Figure 9.14. With these values, we can be
assured that the resulting frequency will no longer be 919 Hz, as Equation 9.4 is no
longer valid. Also, it is quite likely that the loss produced by the network will no
longer be 0.125.

                                                                                                                     Figure 9.14
                                                                                                                     Phase shift analysis.

We need to determine the general input/output (V0 /V3) ratio of the ladder network,
and from this, find the gain and frequency relations for a net phase shift of -180°.
One technique involves the use of simultaneous loop equations. Because all resistors
and capacitors are equal in this variation, we will be able to simplify our equations
readily. By inspection, the three loop equations are (from left to right):

                 V 0=(R+X C) I 1-R I 2          (9.5)

                 0=- R I 1+(2 R+X C) I 2-R I 3  (9.6)

                 0=- R I 2+( 2 R+X C) I3        (9.7)

Also, note that

                 V 3=I 3 R                      (9.8)

355
We now have expressions for V0 and V3, however, V0 is in terms of I1 and I2, and V3
is in terms of I3. Write I1 and I2 in terms of I3 so that we can substitute these back
into Equation 9.5. Rewriting Equation 9.7 yields an expression for I2

         ( ) I 2=I3 2+X C R                                     (9.9)

For I1, rewrite Equation 9.6

         ( ) I 1= 2+X C R I 2-I3                                (9.10)

Substituting Equation 9.9 into Equation 9.10 yields

         (( ) ) I1=I3
                                    2+X C 2-1                   (9.11)
                                        R

Thus, V0 may be rewritten as

     (( ) ) ( ) V0=I3(R+X C)
                                    R   XC 2 XC           R     (9.12)
                                    2+ -1 -I 3 R 2 +

Equation 9.12 may be simplified to

         ( ( ) ( ) ) XC 2                      XC 2
     V 0=I 3 R 2+ +X C 2+ -3 R-2 X C                            (9.13)
                                 R                R

The input/output expression is simplified as follows.

     V3( ( ) ( ) )( ) V 0 XC 2 XC 2 1R         R             R  (9.14)
        = R 2+ +X C 2+ -3 R -2 X C

     V3( ) ( ) V 0= 2+X C 2+X C 2+X C 2-3 -2 X CR      R
                              RR

     V 0 6 X C 5 X C2 X C3                                      (9.15)
        =1+ + 2 + 3
     V3                       R RR

356
At this point, we are nearly done with the general equation. All that is left is to
substitute 1 / jC in place of XC. Remember, j2 = -1.

     V 0 V =1+ 6 - 3 j  C R 2 C2 R2 5 - j 3 C3 R3 1   (9.16)

This equation contains both real and imaginary terms. For this equation to be
satisfied, the imaginary components (6 / jCR and 1 / j3C3R3) must sum to zero,
and the real components must similarly sum to zero (as there are only two terms,
their magnitudes must be equal). We can use these facts to find both the gain and the
frequency.

     6             1
     j C R = j 3C 3R3
     1                1
     j  C R = 6 j 3 C3 R3

          1= 6 2 C2 R2 1

      2=      1                                       (9.17)
                                                      (9.18)
               22                                     (9.19)
          6C R

     = 1 or,

         6 CR
     f o= 1 2  6 CR

For the gain, we solve Equation 9.16 in terms of the voltage ratio and zero the
imaginary terms, because the result must be real.

     V 0 V =1 - 3 2 C 2 R2 5                          (9.20)

Substituting Equation 9.17 into Equation 9.20 yields

     V 0=1 -       5                                  (9.21)
     V3         1 C2 R2                               (9.22)
              6C2 R2

     V 0 =1 -5×6
     V3

     V 0 =-29
     V3

The gain of the ladder network is V3 /V0, or the reciprocal of Equation 9.22, or

     = 1 -29                                          (9.23)

357
The loss produced will be 1/29. This has the disadvantage of requiring a forward
gain of 29 instead of 8 (as in the previous form). This disadvantage is minor
compared to the advantage of reasonable component values.
Example 9.4

         Determine a value for Rf in Figure 9.15 in order to maintain oscillation. Also
         determine the oscillation frequency.

                                                                                                                     Figure 9.15
                                                                                                                     Equal component phase
                                                                                                                     shift oscillator.

         Equation 9.23 shows that the inverting amplifier must have a gain of 29.
                                          Av= - R f
                                                    Ri
                                          R f = - Ri Av
                                          R f =-1 k×-29
                                          R f = 29 k

         Of course, the higher standard value will be used. Also, in order to control
         the gain at higher levels, a diode/resistor combination (as used in the Wien
         bridge circuits) should be placed in series with Rf. Without a gain limiting
         circuit, excessive distortion may occur.

                                  f o= 1 2  6 R C

                                          f o= 1

                                       2  6×1 k ×0.1 F

                                          f o=650 Hz

358
Computer Simulation

In order to verify Equations 9.3 and 9.19, the gain and phase responses of the
feedback networks of Figures 9.13 and 9.15 are found in Figure 9.16. These graphs
were obtained via the standard Multisim route. Note that the phase for both circuits
hits -180° very close to the predicted frequencies. The equal value network
prediction is very accurate, whereas the staggered network prediction is off by only
a few percent. Once the phase exceeds -180°, the Multisim grapher wraps it back to
+180°, so it is very easy to see this frequency. Likewise, the gain response agrees
with the derivations for attenuation at the oscillation frequency. It can be very
instructive to analyze these circuits for the gain and phase response at each stage as
well.

                                                                                                                     Figure 9.16a
                                                                                                                     Equal value network in
                                                                                                                     Multisim.

                                                                                                                     Figure 9.16b
                                                                                                                     Response of equal value
                                                                                                                     network.

359
                                                                                                                   Figure 9.16c
                                                                                                                   Staggered value network in
                                                                                                                   Multisim.

                                                                                                                   Figure 9.16d
                                                                                                                   Response of staggered value
                                                                                                                   network.

Square/Triangle Function Generator

Besides generating sine waves, op amp circuits may be employed to generate other
wave shapes such as ramps, triangle waves, or pulses. Generally speaking, square-
and pulse-type waveforms may be derived from other sources through the use of a
comparator. For example, a square wave may be derived from a sine wave by
360
passing it through a comparator, such as those seen in Chapter Seven. Linear
waveforms such as triangles and ramps may be derived from the charge/discharge
action of a capacitor. As you may recall from basic circuit theory, the voltage across
a capacitor will rise linearly if it is driven by a constant current source. One way of
achieving this linear rise is with the circuit of Figure 9.17.

                                                                                                                     Figure 9.17
                                                                                                                     Ramp generator.

In essence, this circuit is an inverting amplifier with a capacitor taking the place of
Rf. The input resistor, R, turns the applied input voltage into a current. Because the
current into the op amp itself is negligible, this current flows directly into capacitor
C. As in a normal inverting amplifier, the output voltage is equal to the voltage
across the feedback element, though inverted. The relationship between the
capacitor current and voltage is

       dvdt = iC       (9.24)
                       (9.25)
     V (t)= 1C  i dt
     V out=- 1C  i dt

As expected, a fast rise can be created by either a small capacitor or a large current.
(As a side note, this circuit is called an integrator and will be examined in greater
detail in the next chapter.)

By choosing appropriate values for R and C, the Vout ramp may be set at a desired
rate. The polarity of the ramp's slope is determined by the direction of the input
current; a positive source will produce a negative going ramp and vice versa. If the
polarity of the input changes at a certain rate, the output ramp will change direction
in tandem. The net effect is a triangle wave. A simple way to generate the alternating
input polarity is to drive R with a square wave. As the square wave changes from
plus to minus, the ramp changes direction. This is shown in Figure 9.18.

361
                                                                                                                 Figure 9.18
                            Vin Ramp generator waveforms.

                                                                           t

                            Vout

                                                                           t

So, we are now able to generate a triangle wave. The only problem is that a square
wave source is needed. How do we produce the square source? As mentioned
earlier, a square wave may be derived by passing an AC signal through a
comparator. Logically then, we should be able to pass the output triangle wave into a
comparator in order to create the needed square wave. The resulting circuit is shown
in Figure 9.19. A comparator with hysteresis is used to turn the triangle into a square
wave. The square then drives the ramp circuit. The circuit produces two
simultaneous outputs: a square wave that swings to ± saturation and a triangle wave
that swings to the upper and lower comparator thresholds. This is shown in Figure
9.20. The thresholds may be determined from the equations presented in Chapter
Seven. In order to determine the output frequency, the V/s rate of the ramp is
determined from Equation 9.24. Knowing the peak-to-peak swing of the triangle is
Vupper thres - Vlower thres, the period of the wave may be found. The output frequency is
the reciprocal of the period.

                                                                                                                 Figure 9.19
                                                                                                                 Triangle/square generator.

362
                               +Vsat                                                  Figure 9.20
                         Vupper thres                                                 Output waveforms of
                                                                                      triangle/square generator.
                                                                           t
                                                                                      Figure 9.21
                         Vlower thres                                                 Signal generator for
                                -Vsat                                                 Example 9.5.

Example 9.5
         Determine the output frequency and amplitudes for the circuit of Figure
         9.21. Use Vsat = ±13 V.

         First, note that the comparator always swings between +Vsat and -Vsat. Now,
         determine the upper and lower thresholds for the comparator.

                                         V upper thres=V sat R2
                                                            R3

                                         V upper thres=13 V 10 k 20 k
                                         V upper thres=6.5 V
         The lower threshold will be -6.5 V. We now know that the triangle wave
         output will be 13 V peak-to-peak. From this we may determine the output
         period.

363
     Because the ramp generator is driven by a square wave with an amplitude of
     Vsat, Equation 9.24 may be rewritten as

                                     dv =V sat
                                     dt RC
                                     dvdt = 13V 33 k×0.01 F
                                     dvdt =39,394 V/s

     The time required to produce the 13 V peak-to-peak swing is

                                     T = 13 V 39,394 V/s
                                     T =330  s

     This represents one half-cycle of the output wave. To go from +6.5 V to
     -6.5 V and back will require 660 s. Therefore, the output frequency is

                                      f = 1T
                                     f= 1

                                          660 s
                                     f =1.52 kHz

The resulting frequency of Example 9.5 may be adjusted by changing either the
33 k resistor or the 10 nF capacitor. Changing the comparator's resistors can alter
the thresholds, and thus alter the frequency, but this is generally not recommended,
as a change in output amplitude will occur as well. By combining steps, the above
process may be reduced to a single equation:

     f= 1                                                    (9.26)
         2V pp R C

           V sat

where Vpp is the difference between Vupper thres and Vlower thres. Note that if R3 is 4 times
larger than R2 in the comparator, Equation 9.26 reduces to

     f = 1R C

and the peak triangle wave amplitude is one-fourth of Vsat.

364
Generally, circuits such as this are used for lower frequency work. For clean square
waves, very fast op amps are required. Finally, for lower impedance loads, the
outputs should be buffered with voltage followers.

Computer Simulation

The Multisim simulation for the signal generator of Example 9.5 is shown in Figure
9.22. The square and triangle outputs are plotted together so that the switching
action can be seen. Note how each wave is derived form the other. The output plot is
delayed 5 milliseconds in order to guarantee a plot of the steady state output. Failure
to delay the plotting times will result in a graph of the initial turn-on transients. It
may take many milliseconds before the waveforms finally stabilize, depending on
the desired frequency of oscillation and the initial circuit conditions. Finally, note
the sharp rising and falling edges of the square wave. This is due to the moderately
fast slew rate of the LF411 op amp chosen. Had a slower device such as the 741
been used, the quality of the output waveforms would have suffered.

                                                                                                                     Figure 9.22a
                                                                                                                     Triangle/square generator in
                                                                                                                     Multisim.

365
                                                                                        Figure 9.22b
                                                                                        Output waveforms from
                                                                                        simulator.

If an accurate triangle wave is not needed, and only a square wave is required, the     Figure 9.23
circuit of Figure 9.19 may be reduced to a single op amp stage. This is shown in        Simple square wave
Figure 9.23. This circuit is, in essence, a comparator. Resistors R1 and R2 form the    generator.
positive feedback portion and set the effective comparator trip point, or threshold.
The measurement signal is the voltage across the capacitor. The potentials of interest
are shown in Figure 9.24. If the output is at positive saturation, the noninverting
input will see a percentage of this, depending on the voltage divider produced by R1
and R2. This potential is Vupper thres. Because the output is at positive
saturation, the capacitor C, will be charging towards it. Because it is
charging through resistor R, the waveform is an exponential type. Once the
capacitor voltage reaches Vupper thres, the noninverting input will no longer be
greater than the inverting input, and the device will change to the negative
state. At this point, C will reverse its course and move towards negative
saturation. At the lower threshold, the op amp will again change state, and
the process repeats. In order to determine the frequency of oscillation, we
need to find how long it takes the capacitor to charge between the two
threshold points. Normally the circuit will be powered from equal magnitude
supplies, and therefore +Vsat= -Vsat and Vupper thres = Vlower thres. By inspection,

     V thres=V sat R1       (9.27)
                   R1 +R 2

366
      +Vsat                                                                             Figure 9.24
     +Vthres                                                                            Waveforms of a simple square
                                                                                        wave generator.
                          Vc
                                                    Vout
     -Vthres
       -Vsat                                              t

The capacitor voltage is

                                ( )-t                             (9.28)

                          V C (t )=V k 1 -RC

where Vk is the total potential applied to the capacitor. Because the capacitor will
start at one threshold and attempt to charge to the opposite saturation limit, this is

                          V k=V sat +V thres                      (9.29)

Combining Equation 9.27, Equation 9.28, and Equation 9.29 yields

                                      ( )-t                       (9.30)

                          V C (t )=(V sat +V thres) 1 - RC

At the point where the comparator changes state,

                          V C=2 V thres                           (9.31)

Combining Equation 9.30 and Equation 9.31 produces

367
             2 V thres              ( )-t

                       -t  = (V sat +V thres ) 1-R C
                           = 2V thres
             1- RC
                               V sat +V thres
                       -t
                             ( ) 2 V sat R1 R1+R2
             1- RC
                           = R1
                       -t      V sat 1+

             1- RC                          R1+R2

                       -t  = 2 R1
                               2 R1+R2
                 RC
                           = R2
                 -t            2 R1+R2
                RC
                           ( ) = ln R2
                    t              2 R1+R2

                           ( ) = R C ln 2 R1+R2
                                            R2

This represents the charge time of the capacitor. One period requires two such
traverses, so we may say

             ( ) T =2 RC ln 2 R1+R2 or,
                                R2

             ( ) f o= 1                               (9.32)
                  2 R C ln 2 R1+R2
                                     R2

We can transform Equation 9.32 into "nicer" forms by choosing values for R1 and R2
such that the log term turns into a convenient number, such as 1 or 0.5. For example,
if we set R1 = 0.859 R2, the log term is unity, and consequently Equation 9.32
becomes fo = 1 / 2RC

Example 9.6

         Design a 2 kHz square wave generator using the circuit of Figure 9.23.

         For convenience, set R1 = 0.859 R2. If R1 is arbitrarily set to 10 k, then

                                          R1=0.859 R2
                                           R2= R1 0.859
                                           R2= 10 k 0.859
                                          R2=11.64 k

368
         In order to set the oscillation frequency, R is arbitrarily set to 10 k, and C
         is then determined.

                                          f o= 1 2 RC
                                         C= 1

                                               2R fo
                                         C= 1 2×10 k ×2 kHz
                                         C=25 nF

Computer Simulation

A simulation of the square wave generator of Example 9.6 is shown in Figure 9.25.
In order to graphically illustrate the importance of the op amp having sufficient
bandwidth and slew rate, the simulation is run twice, once using the moderately fast
LF411 and a second time using the much slower 741.

                                                                                                                     Figure 9.25a
                                                                                                                     Square wave generator in
                                                                                                                     Multisim.

Both the output and capacitor voltages are plotted from the Transient Analysis.
Using the LF411, the output waveform is very crisp with sharp rising and falling
edges. The capacitor voltage appears exactly as it should. The resulting frequency is
just a little lower than the 2 kHz target. In contrast, the 741 plots show some
problems. First, the square wave has noticeable slew rate limiting on the transitions.
Second, due to the slewing problems, the capacitor voltage waveshape appears
distorted (note the excessive rounding of the peaks). These effects combine to

369
produce a frequency about 15 percent lower than the target, or about 1.7 kHz. The
end result is a lackluster output waveform.

                                                                                   Figure 9.25b
                                                                                   Waveforms using LF411.

                                                                                   Figure 9.c
                                                                                   Waveforms using 741.

370
9.3 Single Chip Oscillators and Frequency Generators

The generation of signals is a basic requirement for a wide variety of applications,
thus a number of manufacturers produce a selection of single IC oscillators and
frequency generators. Some of these tend to work in the range below 1 MHz and
usually require some form of external resistor/capacitor network to set the operating
frequency. Other, highly specialized circuits for targeted applications are also
available. In this section we shall examine a few of the ICs that are generically
referred to as clock generators, voltage-controlled oscillators, phase-locked loops
and timers.

Square Wave/Clock Generator

The need for stable, low cost, easy-to-use integrated circuits to generate square
waves for clocking needs is widespread. Several companies manufacture such
devices. One example is the LTC6900 from Linear Technology. A description sheet
with a basic programming formula is shown in Figure 9.26.

                                                                                                                     Figure 9.26
                                                                                                                     LTC6900 description.

                                                                                                                                                   Reprinted courtesy of Linear
                                                                                                                                                   Technology

371
The LTC6900 is a 5 volt low power circuit available in an SOT-23 (5 pin) package.
It operates from 1 kHz to 20 MHz. The output frequency is programmable via a
single resistor and the connection to its divider pin (labeled DIV). The frequency of
the master oscillator is given by the equation

f o=10 MHz 20 k        (9.33)
                R set

Rset is connected from the power supply pin to the SET pin. Acceptable values range    Figure 9.27
between 10 k and 2 M. If the DIV pin is grounded, the output frequency will be         LTC6900 oscillator.
as calculated. If the DIV pin is left unconnected, the output frequency will be        operation
divided by 10 and if the DIV pin is connected to +5 volts, the output frequency will
be reduced by a factor of 100. This is summarized graphically in Figure 9.27.          Reprinted courtesy of Linear
                                                                                       Technology

Example 9.7

         Using the LTC6900, design a 10 kHz square wave oscillator.

         10 kHz is well within the range of this IC. To achieve this comfortably, we
         will need a divide-by-100 setting based on the graph of Figure 9.27. This
         will require us to tie the DIV pin to +5 volts. The value of Rset can be
         approximated from the graph or computed directly.

                                          f osc=10 MHz 20 k
                                                           N × Rset

                                          Rset=10 MHz 20 k
                                                           N × f osc

                                          Rset=10 MHz 20 k 100×10 kHz
                                          Rset=200 k

372
Voltage-Controlled Oscillator

A voltage-controlled oscillator (usually abbreviated as VCO) does not produce a
fixed output frequency. As its name suggests, the output frequency of a VCO is
dependent on a control voltage. There is a fixed relationship between the control
voltage and the output frequency. Theoretically, just about any oscillator can be
turned into a VCO. For example, if a resistor is used as part of the tuning circuit, it
could be replaced with some form of voltage-controlled resistor, such as an FET or a
light-dependent resistor/lamp combination. By doing this, an external potential can
be used to set the frequency of oscillation. This is very useful if the frequency needs
to be changed quickly or accurately swept through some range.

A classic example of the usefulness of a VCO is shown in Figure 9.28. This is a
simplified schematic of an analog monophonic musical keyboard synthesizer. The
keys on the synthesizer are little more than switches. These switches tap potentials
off a voltage divider. As the musician plays up the keyboard, the switches engage
higher and higher potentials. These levels are used to control a very accurate VCO.
The higher the control voltage, the higher the output frequency or pitch will be.

                                                                                                                     Figure 9.28
                                                                                                                     Simplified music synthesizer
                                                                                                                     using VCO.

VCOs can be used for a number of other applications, including swept frequency
spectrum analyzers, frequency modulation and demodulation, and control systems. It
is also an integral part of the phase-locked loop, as we will see later in this chapter.

An example of a VCO is the LTC6990. It is part of Linear Technology's TimerBlox
series of timer/counter/clock ICs. The series includes clock sources that operate in
excess of 100 MHz and timers that switch at multi-hour rates. The LTC6990
operates in the range of just under 500 Hz to 2 MHz. While it can be used for fixed
frequency applications, it also makes for a flexible VCO. An overview is shown in
Figure 9.29.

373
                                                                                                                     Figure 9.29
                                                                                                                     LTC6990 VCO.

                                                                                                                                                   Reprinted courtesy of Linear
                                                                                                                                                   Technology

Like the LTC6900, the LTC6990 is programmed with as little as one resistor and has
a frequency divider option. Unlike its brother, the divider capabilities are much more
broad, spanning eight power-of-two settings versus just three decade settings. A
basic fixed frequency oscillator is shown at the bottom left of Figure 9.29 where the
master oscillation frequency is controlled by Rset. Standard VCO operation is shown
at the bottom right. The LTC6990 also has the option of a high impedance output
state, making a total of 16 divider/output possibilities. This set up is programmed
typically through the use of two external resistors. The programming table is
reproduced in Figure 9.30.
374
                                                                                                                     Figure 9.30
                                                                                                                     LTC6990 oscillator.
                                                                                                                     programming

                                                                                                                                                   Reprinted courtesy of Linear
                                                                                                                                                   Technology

The output state depends on the combination of the Output Enable pin (OE) and the
Hi-Z logic. When OE is high, the output will be active. If OE is low and Hi-Z is low,
then the output will be held low. Finally, if OE is low and Hi-Z is high, then the
output will go to a high impedance state.
The voltage present at the DIVCODE pin sets the frequency divider and the
impedance mode. This voltage is interpreted by an internal 4 bit analog-to-digital
converter (AD converters are the topic of Chapter Twelve). While it is possible to
feed this pin with some external source, the more practical method is to simply
create a voltage divider with a pair of 1% tolerance resistors; one tied from the
power supply to the DIVCODE pin, and the second connected from DIVCODE to
ground.
The master oscillator of the LTC6990 is controlled by the current at the SET pin.
Internally, the voltage at this pin is maintained at 1 volt, therefore the frequency can
be set by a single resistor, Rset, connected from this pin to ground. It can then be
divided down to lower frequency. This is essentially the same situation we found
with the LTC6900. A 20 A current (i.e., 50 k) will produce the top rate of 1 MHz.
Lower currents (higher resistances) will produce proportionately lower frequencies.

375
The DIVCODE value will divide this base frequency down further by powers of two.
We can express this relation with the following formula,

             f osc=1 MHz 50 k                           (9.34)
                             N DIV Rset

     where NDIV is found from the table in Figure 9.30

The design process starts by identifying the appropriate frequency range. It is best if
the desired oscillation frequency is not located at the extremes of any given range.
Once a range is determined, the corresponding value for NDIV is found, and along
with it, the required divider resistor values, R1 and R2. From there it is a simple
matter to solve Equation 9.34 in terms of Rset.

Example 9.8

     An LTC6990 is connected as shown in Figure 9.31. It is being used as a              Figure 9.31
     light-to-frequency converter. That is, the output frequency will be controlled      Light-to-frequency
     by the amount of light hitting a sensor. The sensor is a CdS (Cadmium               converter circuit for
     Sulfide) cell that is connected in the position of Rset. Under low light            Example 9.8.
     conditions the cell will produce a high resistance and as the light level
     increases the resistance drops. Assuming that the cell varies from 500 k
     down to 60 k, determine the range of output frequencies.

     First, determine the DIVCODE value. This can be found by computing the
     voltage divider ratio of R1 and R2, but in this circuit recommended values
     have been used from the DIVCODE table. By observation, NDIV=16.

     Next, we calculate the limit frequencies.

                                     f osc=1 MHz 50 k
                                                     N DIV R set

                                     f osc=1 MHz 50k 16×500 k
                                     f osc=6.25 kHz

                                     f osc=1 MHz 50 k
                                                     N DIV R set

                                     f osc=1 MHz 50k 16×60 k
                                     f osc=52.08 kHz

     Note that as light levels increase, frequency increases in proportion.

376
When used in VCO mode, the most important element to remember is that the master
oscillator frequency is set by the current coming out of the SET pin, Iset, as expressed
by the following formula

    f o=1 MHz × 50 k I set
                          V set

Vset is kept to 1 volt internally so this reduces to

    f o=1 MHz × 50 k × I set                          (9.35)

fosc is then divided down by NDIV. The final oscillation frequency may be expressed

as

    f osc=1 MHz × 50 k I set                          (9.36)
                            N DIV

Note that Iset is exiting the chip. Further, note the frequency of oscillation and Iset are
directly proportional. Also, keep in mind that the Iset variation, and hence, the
frequency variation, should be kept to 16:1 for best performance, where the
maximum value of Iset is 20 A. A simple method for obtaining voltage control is
shown in Figure 9.29. There are some potential issues here. First, the range of
voltage from the control circuit may not be able to achieve the desired frequency
with that circuit. Second, note that higher control voltages will produce lower output
frequencies, that is, an inverse relation. This can be an issue in some applications.
Consequently, we shall examine a more generic method of controlling the circuit
through the use of an external op amp for scaling and offsetting.

                                                                                             Figure 9.32
                                                                                             A method of mapping the
                                                                                             control voltage.

The circuit of Figure 9.32 presents a method of mapping the existing control voltage
onto the LTC6990 or any similar VCO. In this circuit a simple summing amplifier is
used for scaling and offsetting. The control voltage, VC, is scaled by one channel of
the weighted summer. This signal is offset by a DC voltage, Voffset, fed through
another channel. The voltage at the output of the op amp is used to sink current from

377
the VCO via the control resistor, RC. Recall that the SET pin of the IC produces 1 volt
internally and it is the exiting current, Iset, that sets the master oscillator frequency, as
expressed in Equation 9.35. Obviously, the op amp output voltage must be less than
1 volt in order for the op amp to sink current (i.e., in order for Iset to be exiting the
LTC6990). The voltage difference between the op amp's output and the 1 volt at the
SET pin drops across RC and this is what creates Iset. Note that as the control voltage
grows more positive at the op amp's input, its output, and hence Iset, also increases.
Thus, frequency increases as control voltage increases.

Example 9.9

         Using Figure 9.32 as a guide, design a VCO circuit that will produce output
         frequencies from 20 kHz through 50 kHz when driven by control voltages
         from 6 to 8 volts (i.e., 6 volts will produce 20 kHz, 7 volts will produce 35
         kHz, 8 volts will produce 50 kHz, etc.)

         First, note that the frequency range is 2.5:1. As the LTC6990 can always
         cover any 8:1 span (as high as 16:1) and the maximum frequency of 50 kHz
         is well below the LTC6990's maximum, we know this IC is a good candidate
         for the design. We now need to determine the divider resistor values.
         Consulting Figure 9.30 shows that we can achieve this range using an NDIV
         of 4, 8 or 16. Choosing the middle value, and assuming we don't care about
         Hi-Z state, we arrive at DIVCODE=3 with R1=1 M and R2=280 k.

         Our frequency range is 2.5:1 which means that our Iset range must also be
         2.5:1. For convenience, choose the op amp's output to be 0 volts for the
         minimum frequency. This will yield 1 volt across RC and occurs when the
         control voltage into the op amp is at its 6 volt minimum. When the control
         voltage is at its maximum of 8 volts we'll need 2.5 volts across RC (i.e., 2.5
         times the prior Iset). This means that the op amp's output must go to -0.5
         volts. Note that a 2 volt change in the input control voltage will produce a
         1.5 volt change at the op amp's output. Thus, the gain of this channel is
         -0.75. If we choose Rf=100 k then Rb=75 k.

         At this point we need to add an offset. With only the gain scaling, the 6 volt
         VC produces -0.75 times 6, or -4.5 volts, and a VC of 8 volts similarly
         produces -6 volts. Consequently, we need to add a +4.5 volt offset to the
         output. If we tie Voffset to the op amp's -15 volt power rail then we will need a
         gain of 4.5/(-15), or -0.3. With an Rf of 100 k, Ra must be 333.3 k (the
         nearest 1% standard value is 332 k).

         Finally, to determine RC , refer to Equation 9.36 and solve for Iset

                                          I set = f osc× N DIV 1 MHz × 50 k

378
      Using the minimum fosc of 20 kHz yields

                                      I set= 20 kHz×8 1 MHz × 50 k
                                      I set=3.2  amps

      This occurs with 1 volt across RC. Therefore RC = 312.5 k. Crosschecking,
      when VC=8 V, we see 2.5 volts across RC for a current of 8 A. Inserting this
      into Equation 9.36 yields 50 kHz, our desired maximum frequency.

In closing, note that the way in which the frequency sweeps depends on the wave
shape of Vc. If a sinusoid is used, the output frequency will vary smoothly between
the stated limits. On the other hand, if the wave shape for Vc is a ramp, the output
frequency will start at one extreme and then move smoothly to the other limit as the
Vc ramp continues. When the ramp resets itself, the output frequency will jump back
to its starting point. An example of this is shown in Figure 9.33. Finally, if the
control wave shape is a square, the output frequency will abruptly jump from the
minimum to the maximum frequency and back. This effect is shown in Figure 9.34,
and can be used to generate FSK (frequency shift key) signals. FSK is used in the
communications industry to transmit binary information.

Vout     Vout                                                                           Figure 9.33 (left)
                                                                                        VCO frequency sweep using a
                                                                                        ramp.

      t        t

                                                                                        Figure 9.34 (right)

                                                                                        VCO two tone output using a

Vc Vc square wave.
      t        t

Phase-Locked Loop

One step up from the VCO is the Phase-Locked Loop, or PLL. The PLL is a self-
correcting circuit; it can lock onto an input frequency and adjust to track changes in
the input. PLLs are used in modems, for FSK systems, frequency synthesis, tone
decoders, FM signal demodulation, and other applications. A block diagram of a
basic PLL is shown in Figure 9.35.

379
in  phase           loop                                                                Figure 9.35
                    filter                                                              Phase-locked loop.
    comparator

                    VCO

In essence, the PLL uses feedback in order to lock an oscillator to the phase and
frequency of an incoming signal. It consists of three major parts; a phase
comparator, a loop filter (typically, a lag network of some form), and a VCO. An
amplifier may also exist within the loop. The phase comparator is driven by the
input signal and the output of the VCO. It produces an error signal that is
proportional to the phase difference between its inputs. This error signal is then
filtered in order to remove spurious high-frequency signals and noise. The resulting
error signal is used as the control voltage for the VCO, and as such, sets the VCO's
output frequency. As long as the error signal is not too great, the loop will be self-
stabilizing. In other words, the error signal will eventually drive the VCO to be in
perfect frequency and phase synchronization with the input signal. When this
happens, the PLL is said to be in lock with the input. The range of frequencies over
which the PLL can stay in lock as the input signal changes is called the lock range.
Normally, the lock range is symmetrical about the VCO's free-running, or center,
frequency. The deviation from the center frequency out to the edge of the lock range
is called the tracking range, and is therefore one-half of the lock range. This is
illustrated in Figure 9.36.

                                          lock range

    tracking range                 tracking range                                       Figure 9.36
                                                                                        Operating ranges for
                                                                                        phase-locked loop.

                    capture range

    pull-in range   pull-in range

                                          f0

Although a PLL may be able to track changes throughout the lock range, it may not
be able to initially acquire sync with frequencies at the range limits. A somewhat
narrower band of frequencies, called the capture range, indicates frequencies that
the PLL will always be able to lock onto. Again, the capture range is usually
symmetrical about fo. The deviation on either side of fo is referred to as the pull-in
range. For a PLL to function properly, the input frequency must first be within the
capture range. Once the PLL has locked onto the signal, the input frequency may

380
vary throughout the larger lock range. The VCO center frequency is usually set by an
external resistor or capacitor. The loop filter may also require external components.
Depending on the application, the desired output signal from the PLL may be either
the VCO's output, or the control voltage for the VCO.

One way to transmit binary signals is via FSK. This may be used to allow two
computers to exchange data over telephone lines. Due to limited bandwidth, it is not
practical to directly transmit the digital information in its normal pulse-type form.
Instead, logic high and low can be represented by distinct frequencies. A square
wave, for example, would be represented as an alternating set of two tones. FSK is
very easy to generate. All you need to do is drive a VCO with the desired logic
signal. To recover the data, the reception circuit needs to create a high or low level,
depending on which tone is received. A PLL may be used for this purpose. The
output signal will be the error signal that drives the VCO. The logic behind the
circuit operation is deceptively simple. If the PLL is in lock, the output frequency of
its VCO must be the same as the input signal. Remembering that the incoming FSK
signal is itself derived from a VCO, for the VCOs to be in lock, they must be driven
with identical control signals. Therefore, the control signal that drives the PLL's
internal VCO must be the same as the control signal that originally generated the
FSK signal. The PLL control signal can then be fed to a comparator in order to
properly match the signal to the following logic circuitry.

Along the same lines as the FSK demodulator is the standard FM signal demodulator.
Again, the operational logic is the same. In order for the PLL to remain in lock, its
VCO control signal must be the same as the original modulating signal. In the case of
typical radio broadcasts, the modulating signal is either voice or music. The output
signal will need to be AC coupled and amplified further. The PLL serves as the
intermediate frequency amplifier, limiter, and demodulator. The result is a very cost-
effective system.

reference   phase        loop                                                            Figure 9.37
                                                                                         PLL frequency synthesizer.
oscillator  comparator   filter

            divide by N  VCO

                                          program output

Another usage for the PLL is in frequency synthesis. From a single, accurate signal
reference, a PLL may be used to derive a number of new frequencies. A block
diagram is shown in Figure 9.37. The major change is in the addition of a
programmable divider between the VCO and the phase comparator. The PLL can
only remain in lock with the reference oscillator by producing the same frequency

381
out of the divider. This means that the VCO must generate a frequency N times
higher than the reference oscillator. We can use the VCO output as desired. In order
to change the output frequency, all that needs to be changed is the divider ratio.
Normally, a highly accurate and stable reference, such as a quartz crystal oscillator,
is used. In this way, the newly synthesized frequencies will also be very stable and
accurate.

One example of an advanced digital PLL is the LTC6950. This device operates at up
to 1.4 GHz and has five outputs. Each of the outputs has an independently
programmable divider and VCO clock cycle delay. The input reference frequency is
set between 2 MHz and 250 MHz. Due to the multiple outputs and syncing
capabilities, this device can be used for large distributed systems that require
precisely controlled multiple clocks. Indeed, one device can be used to control
several other LTC6950s for very large systems. An example of this would be a
system making use of several high-speed high-resolution analog-to-digital or digital-
to-analog converters. The accuracy of these devices depends greatly on very
accurate and stable clock sources. We will examine analog-to-digital-to-analog
conversion in Chapter Twelve.

555 Timer

The 555 timer is a versatile integrated circuit first introduced in the early 1970's by
Signetics. It has remained a popular building block in a variety of applications
ranging from simple square wave oscillators to burglar alarms to pulse-width
modulators and beyond. In its most basic forms, the one-shot, or monostable, and the
astable oscillator, the 555 requires only a handful of external components. Usually,
only two capacitors and two resistors are needed for basic functions. The 555 is
made by different manufacturers and in a few forms. The 556, for example, is a dual
555. The 555 can produce frequencies up to approximately 500 kHz. The output
current is specified as 200 mA, although this entails fairly high internal voltage
drops. A more reasonable expectation would be below 50 mA. The circuit may be
powered from supplies as low as 5 volts and as high as 18 volts. This makes the 555
suitable for both TTL digital logic and typical op amp systems. Rise and fall times
for the output square wave are typically 100 ns.

382
                                                                                                                     Figure 9.38
                                                                                                                     Block diagram of 555 timer.

A block diagram of the 555 is shown in Figure 9.38. It is comprised of a pair of
comparators tied to a string of three equal-valued resistors. Note that the upper, or
Threshold, comparator sees approximately 2/3 of Vcc at its inverting input, assuming
no external circuitry is tied to the Control pin. (If the Control pin is unused, a 10 nF
capacitor should be placed between the pin and ground.) The lower, or Trigger,
comparator sees approximately 1/3 of Vcc at its noninverting input. These two
comparators feed a flip-flop, which in turn feeds the output circuitry and Discharge
and Reset transistors. If the flip-flop output is low, the Discharge transistor will be
off. Note that the output stage is inverting, so that when the flip-flop output is low,
the circuit output is high. In contrast, if the input to the Reset transistor is low, this
will inhibit the output signal. If Reset capabilities are not needed, the Reset pin
should be tied to Vcc.
Returning to the comparators, if the noninverting input of the Threshold comparator
were to rise above 2/3 Vcc, the comparator's output would change state, triggering the
flip-flop and producing a low out of the 555. Similarly, if the input to the inverting
input of the Trigger comparator were to drop below 1/3 Vcc, the comparator's output
would change, and ultimately, the 555 output would go high.

555 Monostable Operation

The basic monostable circuit is shown in Figure 9.39. In this form, the 555 will
produce a single pulse of predetermined width when a negative going pulse is
applied to the trigger input. Note that the three input components, Rin, Cin, and D

383
serve to limit and differentiate the applied pulse. In this way, a very narrow pulse
will result which reduces the possibility of false triggers. To see how the circuit
works, refer to the waveforms presented in Figure 9.40.

                                                                                                                 Figure 9.39
                                                                                                                 555 monostable connection.

Vtrigger                                      Figure 9.40
   Vout                                       555 monostable waveforms.

                t

          Tout  t

VC

2/3 VCC

                                                                                t

Assume that the output of the 555 is initially low. This implies that the Discharge
transistor is on, shorting the timing capacitor C. A narrow low pulse is applied to the
input of the circuit. This will cause the Trigger comparator to change state, firing the
flip-flop, which in turn will cause the output to go high and also turn off the
Discharge transistor. At this point, C begins to charge toward Vcc through R. When
the capacitor voltage reaches 2/3 Vcc, the Threshold comparator fires, setting the

384
output low and turning on the Discharge transistor. This drains the timing capacitor,
and the circuit is ready for the application of a new input pulse. Note that without the
input waveshaping network, the trigger pulse must be narrower than the desired
output pulse. The equation for the output pulse width is

                                T out=1.1 R C

An interesting item to note is that the value of Vcc does not enter into the equation.
This is because the comparators are always comparing the input signals to specific
percentages of Vcc rather than to specific voltages.

Example 9.10

         Determine values for the timing resistor and capacitor to produce a 100 s
         output pulse from the 555.

         A reasonable choice for R would be 10 k.

                                         T out=1.1 R C
                                         C = T out

                                               1.1 R
                                         C= 100  s

                                              1.1×10 k
                                         C=9.09 nF

         The nearest standard value would be 10 nF, so a better choice for R might be
         9.1 k (also a standard value). This pair would yield the desired pulse width
         quite accurately.

555 Astable Operation                                                                     Figure 9.41
                                                                                          555 astable connection.
Figure 9.41 shows the basic astable, or free-running form, for a square wave
generator. Note the similarities to the monostable circuit. The obvious difference is
that the former trigger input is now tied into the resistor-capacitor timing network.
In effect, the circuit will trigger itself continually. To see how the circuit works,
refer to Figure 9.42 for the waveforms of interest.

Assume initially that the 555 output is in the high state. At this point, the
Discharge transistor is off and capacitor C is charging toward Vcc through RA and
RB. Eventually, the capacitor voltage will exceed 2/3 Vcc causing the Threshold
comparator to trigger the flip-flop. This will turn on the Discharge transistor and
make the 555 output go low. The Discharge transistor effectively places the upper

385
end of RB at ground, removing RA and Vcc from consideration. C now discharges
through RB toward 0. Eventually, the capacitor voltage will drop below 1/3 Vcc. This
will fire the Trigger comparator, which will in turn place the circuit back to its initial
state, and the cycle will repeat.

                            Vout

                                                                                            Figure 9.42
                                                                                            555 astable waveforms.

                                                                             t

                             VC

                           2/3 VCC

                           1/3 VCC

                                                                             t

The frequency of oscillation clearly depends only on C, RA, and RB. The time periods
are

                                T high=0.69 ( RA+RB)C
                                T low=0.69 RB C

This results in a frequency of

                                f = 1.44
                                     RA+2 RB

The duty cycle is normally defined as the high time divided by the period. The 555
documentation often reverses this definition, but we will stick with the industry
norm.

                                Duty Cycle = RA+RB
                                                RA+2 RB

A quick examination of the duty cycle equation shows that there is no reasonable
combination of resistors that will yield 50% duty cycle, let alone anything smaller.
There is a simple trick to solve this problem, though. All you need to do is place a
diode in parallel with RB as illustrated in Figure 9.43. The diode will be forward-
biased during the high time period and will effectively short out RB. During the low
time period the diode will be reverse-biased, and RB will still be available for the

386
discharge phase. If RA and RB are set to the same value, the end result will be 50%
duty cycle. Of course, due to the non-ideal nature of the diode, this will not be
perfect, so some adjustment of the resistor values may be in order. Further, note that
if RA is also replaced with a potentiometer (and perhaps a series limiting resistor) a
tunable square wave generator will result.

                                                                                                                     Figure 9.43
                                                                                                                     555 with shunting diode for
                                                                                                                     duty cycles  50%.

Example 9.11

         Determine component values for a 2 kHz square wave generator with an
         80% duty cycle.
         First, note the period is the reciprocal of the desired frequency, or 500 s.
         For an 80% duty cycle, that yields

                                         T high=Duty Cycle×T
                                         T high=0.8×500 s
                                         T high= 400 s
                                         T low=T -T high
                                         T low=500  s -400  s
                                         T low=100  s
         Choosing RB = 10 k,
                                         T low=0.69 RB C
                                         C= T low

                                               0.69 RB
                                         C= 100 s

                                               0.69×10 k 
                                         C=14.5 nF

387
                                         T high=0.69 ( RA+RB)C
                                          RA= T high 0.69 C - RB
                                          RA= 400 s 0.69×14.5 nF -10 k 
                                          RA=30k 

Summary

Oscillators and frequency generators find use in a wide variety of applications. They
may be realized from simple single op amp topologies or use more elaborate special-
purpose integrated circuits. Basic op amp oscillators are usually constrained to the
frequency range below 1 MHz. Two sine wave oscillators that are based on op amps
are the Wien bridge and phase shift types. Both oscillators rely on positive feedback
in order to create their outputs. To maintain oscillation, the amplifier/feedback loop
must conform to the Barkhausen criterion. This states that in order to maintain
oscillation, the loop phase must be 0°, or an integer multiple of 360°. Also, the
product of the positive feedback loss and the forward gain must be greater than unity
to start oscillations and revert to unity to maintain oscillation. In order to make the
gain fall back to unity, some form of gain limiting device, such as a diode or lamp, is
included in the amplifier's negative feedback loop. The oscillation frequency is
usually set by a simple resistor/capacitor network. As such, the circuits are relatively
easy to tune. Their ultimate accuracy will depend on the tolerance of the tuning
components and, to a lesser degree, on the characteristics of the op amp used.

Besides sine waves, other shapes such as triangles and squares may be produced. A
simultaneous square/triangle generator may be formed from a ramp
generator/comparator combination. Only two op amps are required to realize this
design.

The voltage-controlled oscillator, or VCO, produces an output frequency that is
dependent on an external control voltage. The free-running, or center, frequency is
normally set via a resistor/capacitor combination. The control voltage may then be
used to increase or decrease the frequency about the center point. The VCO is an
integral part of the phase-locked loop, or PLL. The PLL has the ability to lock onto
an incoming frequency. That is, its internal VCO frequency will match the incoming
frequency. Should the incoming frequency change, the internal VCO frequency will
change along with it. Two important parameters of the PLL are the capture range and
the lock range. Capture range is the range of frequencies over which the PLL can
acquire lock. Once lock is achieved, the PLL can maintain lock over a somewhat
wider range of frequencies called the lock range. The PLL is in wide use in the

388
electronics industry and is found in such applications as FM demodulation, FSK-
based communication systems, and frequency synthesis.

Timers can be used to generate rectangular waves of various duty cycles as well as
single-shot pulses.

Review Questions

    1. How does positive feedback differ from negative feedback?
    2. Define the Barkhausen criterion.
    3. Explain the operation of the Wien bridge op amp oscillator.
    4. Detail the operation of the phase shift op amp oscillator.
    5. How might a square wave be generated from a sinusoidal or triangular

         source?
    6. Give two ways to make the output frequency of a Wien bridge oscillator

         user-adjustable.
    7. What factors contribute to the accuracy of a Wien bridge oscillator's output

         frequency?
    8. What is a VCO, and how does it differ from a fixed-frequency oscillator?
    9. Draw a block diagram of a PLL and explain its basic operation.
    10. What is the difference between capture range and lock range for a PLL?
    11. Give at least two applications for a fixed-frequency oscillator or VCO.
    12. Give at least two applications for the PLL.
    13. Explain the difference between astable and monostable operation of a timer.

Problems

Analysis Problems

Unless otherwise specified, all circuits use ±15 V power supplies.

    1. Given the circuit of Figure 9.44, determine the frequency of oscillation if
         R1 = 1.5 k, R2 = R3 = R4 = 3 k, and C1 = C2 = 22 nF.

                                                                        Figure 9.44

389
    2. Given the circuit of Figure 9.44, determine the frequency of oscillation if
         R2 = 22 k, R1 = R3 = R4 = 11 k, and C1 = C2 = 33 nF.

    3. Given the circuit of Figure 9.45, determine the maximum and minimum fo if
         R1 = 5.6 k, R2 = 12 k, R3 = R4 = 1 k, P1 = P2 = 10 k, C1 = C2 = 39 nF.
                                                                        Figure 9.45

    4. Given the circuit of Figure 9.46, determine fo if R4 = 2 k, R3 = 20 k,
         R2 = 200 k, R1 = 1.6 M, C1 = 30 nF, C2 = 3 nF, C3 = 300 pF.
                                                                        Figure 9.46

    5. Given the circuit of Figure 9.46, determine fo if R1 = R3 = R4 = 3.3 k,
         R2 = 100 k, C1 = C2 = C3 = 86 nF.

    6. Given the circuit of Figure 9.47, determine fo if R1 = R2 = 22 k, R3 = 33 k,
         C = 3.3 nF.

390
                                                                                                                     Figure 9.47

    7. Using the circuit of Figure 9.48, find the output frequency if Rset = 100 k.
                                                                        Figure 9.48

    8. Using the circuit of Figure 9.49, find the output frequency if Rset = 50 k.
                                                                        Figure 9.49

    9. A temperature dependent resistor, or thermistor, is used in Figure 9.50. If
         the resistance varies between 20 k and 200 k through the temperature range
         of interest, determine the range of output frequencies.

391
                                                                        Figure 9.50

    10. For the circuit of 9.51, determine the range of output frequencies if VC varies
         between 0 V and -1 V. RC = 100 k, R1 = 1 M, R2 = 681 k.

    11. For the circuit of Problem 9.10, determine the output frequencies if Vc is a
         100 Hz square wave at 0.5 volts peak.

    12. Sketch the output waveform for Problem 9.11.
                                                                        Figure 9.51

    13. If a control voltage of 0.4 sin 260t is used for the circuit of Problem 9.10,
         find the resulting maximum and minimum output frequencies.

    14. Given the circuit of Figure 9.52, determine the output frequency if VC = 2 V,
         RVCO = Rset = 100 k, R1 = 976 k and R2 = 102 k.
                                                                        Figure 9.52

392
    15. Given the circuit of Figure 9.47, determine fo if R1 = R2 = 22 k, R3 = 33 k,
         and C = 1.6 nF.

    16. Determine the output frequency range in Figure 9.53 if VC varies from 0 to 2
         volts, Rf = 200k, Ri = 100 k, RC = 500 k, R1 = 976 k and R2 = 182 k.

                                                                                                                     Figure 9.53

    17. Determine the output frequency range in Figure 9.54 if Vb varies from 0 to
         2 volts, Va = 1 volt, Rf = 200 k, Ra = 100 k, Rb = 200 k, RC = 390 k, R1 = 182 k
         and R2 = 976 k.
                                                                                                                     Figure 9.54

Design Problems
    18. For the circuit of Figure 9.44, determine values for C1 and C2 if R1 = 6.8 k,
         R2 = R3 = R4 = 15 k, and fo = 30 kHz.
    19. For the circuit of Figure 9.44, determine values for R3 and R4 if R1 = 2.2 k,
         R2 = 4.7 k, C1 = C2 = 47 nF, and fo = 400 Hz.
    20. For the circuit of Figure 9.44, determine values for R2, C1 and C2 if
         R1 = 7.2 k, R3 = R4 = 3.9 k, and fo = 19 kHz.
    21. Determine the values required for R3, R4, P1, and P2 in Figure 9.45 if
         C1 = C2 = 98 nF, R1 = 5.6 k, R2 = 12 k, fo.min = 2 kHz, and fo.max = 20 kHz.
    22. Repeat Problem 21 for fo.min = 10 kHz and fo.max = 30 kHz.

393
    23. Redesign the circuit of Problem 1 so that exact gain resistors are not needed.
         Use Figure 9.6 as a model.

    24. Redesign the circuit of Problem 3 so that clipping does not occur. Use
         Figure 9.6 as a model.

    25. Determine new values for the capacitors of Problem 4 if fo is changed to
         10 kHz.

    26. Given the circuit of Figure 9.46, determine values for the capacitors if
         R1 = R3 = R4 = 3.3 k, R2 = 100 k, and fo = 7.6 kHz.

    27. Given the circuit of Figure 9.46, determine values for the resistors if the
         capacitors all equal 1100 pF and fo = 15 kHz.

    28. Determine the capacitor and resistor values for the circuit of Figure 9.46 if
         R2 = 56 k and fo = 1 kHz.

    29. Find C in Figure 9.47 if fo = 5 kHz, R1 = R3 = 39 k, R2 = 18 k.
    30. Determine the resistor values in Figure 9.47 if fo = 20 kHz and C = 22 nF.

         Set R1 = R2 and R2 = R3/2. Sketch the output waveforms as well.
    31. Determine the required ratio for R2/R3 to set the triangle wave output to 5 V

         peak in Figure 9.47.
    32. Using the circuit of Figure 9.48, find Rset for an output of 100 kHz.
    33. Determine the value for Rset in Figure 9.49 to set the frequency to 50 kHz.
    34. Design a square wave generator that is adjustable from 5 kHz to 20 kHz.
    35. For the circuit of Figure 9.52, determine the component values such that a

         frequency of 250 kHz is produced when VC = 0 volts and 125 kHz when VC
         is 1 volt.
    36. Design a VCO circuit and determine the component values such that a
         frequency of 250 kHz is produced when VC = 1 volt and 125 kHz when VC is
         0 volts.

Challenge Problems

    37. Using Figure 9.9 as a guide, design a sine wave oscillator that will operate
         from 2 Hz to 20 kHz, in decade ranges.

    38. Design a 10 kHz TTL-compatable square wave oscillator using a Wien
         bridge oscillator and a 311 comparator.

    39. Using a triangle or sine wave oscillator and a comparator, design a variable
         duty cycle pulse generator. Hint: Consider varying the comparator
         reference.

    40. Using a function synthesizer (Chapter Seven) and the oscillator of Figure
         9.47, outline a simple laboratory frequency generator with sine, triangle, and
         square wave outputs.

394
    41. For the preceding problem, outline how amplitude and DC offset controls
         could be implemented as well.

    42. Generate a square wave that smoothly increases from 50 kHz to 300 kHz
         and back at a rate 100 times each second.

    43. Assume that the output of the left-most op amp of Figure 9.47 drives Vb of
         Figure 9.54. Further, assume that a positive DC voltage equal to the peak
         value of Vb is used to drive Va. Also, Ra = Rb = Rf . Assuming the frequency
         produced by Figure 9.47 is considerably lower than that of Figure 9.54,
         describe the output waveform of Figure 9.54.

Computer Simulation Problems
    44. Perform a simulation of the circuit of Problem 1. Perform a frequency-
         domain analysis of the positive feedback loop's gain and phase, and verify
         that the Barkhausen Criterion is met.
    45. Perform a simulation for the circuit of Problem 4. Perform a frequency-
         domain analysis of the positive feedback loop's gain and phase, and verify
         that the Barkhausen Criterion is met.
    46. Perform a time-domain simulation analysis for the circuit of Problem 6.
         Make sure that you check both outputs (a simultaneous plot would be best).

395
10 Integrators and Differentiators

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Describe the fundamental usefulness and operation of an integrator.
    · Describe the fundamental usefulness and operation of a differentiator.
    · Detail the modifications required in order to make a practical op amp integrator or differentiator.
    · Plot the useful frequency range of a given integrator or differentiator.
    · Analyze the operation of integrator circuits using both time-continuous and time-discrete methods.
    · Analyze the operation of differentiator circuits using both time-continuous and time-discrete methods.
    · Explain the operation of an analog computer.

10.1 Introduction

Up to this point, we have examined a number of different op amp circuits and applications. Viewed from a
purely mathematical perspective, the circuits perform basic functions. Amplifiers multiply an input quantity by a
constant. Voltage-controlled or transconductance amplifiers can be used to multiply a quantity by a variable.
Absolute value and logarithmic functions can also be produced. There is no reason to stop with just these tools;
higher mathematical functions may be enlisted. In this chapter we shall examine circuits that perform integration
and differentiation. Although these circuits may appear to be somewhat esoteric at first glance, they can prove to
be quite useful. Integrators perform the function of summation over time. They may be used whenever an
integration function is required, for example, to solve differential equations. The differentiator is the mirror of
the integrator and may be used to find rates of change. One possible application is finding acceleration if the
input voltage represents a velocity.

Integrators and differentiators may be combined with summing amplifiers and simple gain blocks to form
analog computers, that can be used to model physical systems. This can be a valuable aid in the initial design
and testing of such things as mechanical suspension systems or loudspeakers. Unlike their digital counterparts,
analog computers do not require the use of a programming language, per se. Also, they can respond in real-time
to an input stimulus.

Besides the obvious use as a direct mathematical tool, integrators and differentiators can be used for wave
shaping purposes. As an example, the square/triangle generator of Chapter Nine used an integrator. With the
exception of simple sinusoids, both the integrator and differentiator will change the fundamental shape of a
waveform. This might be contrasted with a simple amplifier that only makes a wave larger and does not alter the
basic shape.

396
For practical work, certain alterations will be required to the ideal circuits. The
effects of these changes, both good and bad, will also be studied.

10.2 Integrators

The basic operation of an integrator is shown in Figure 10.1. The output voltage is        Figure 10.1
the result of the definite integral of Vin from time = 0 to some arbitrary time t. Added   A basic integrator.
to this will be a constant that represents the output of the network at t = 0.

Remember, integration is basically the process of summation. You can also

think of this as finding the "area under the curve". The output of this circuit             Vout
always represents the sum total of the input values up to that precise instant Vin
in time. Consequently, if a static value (non-zero) is used as an input, the
output will continually grow over time. If this growth continues unchecked,

output saturation will occur. If the input quantity changes polarity, the output

may also change in polarity. Having established the basic operation of the

circuit, we are left with the design realization and limitations to be worked out.

As noted in earlier work, the response of an op amp circuit with feedback will reflect     Figure 10.2
the characteristics of the feedback elements. If linear elements are used, the resulting   Capacitor as integration
response will be linear. If a logarithmic device is used in the feedback loop, the         element.
resulting response will have a log or anti-log character. In order to achieve
integration, then, the feedback network requires the use of an element that exhibits
this characteristic. In other words, the current through the device must be
proportional to either the integral or differential of the voltage across it. Inductors
and capacitors answer these requirements, respectively. It should be possible then, to
create an integrator with either an inductor or a capacitor. Capacitors tend to behave
in a more ideal fashion than do inductors. Capacitors exhibit virtually no problems
with stray magnetic field interference, do not have the saturation limitations of
inductors, are relatively inexpensive to manufacture, and operate reliably over a
wide frequency range. Because of these factors, the vast majority of integrators are
made using capacitors rather than inductors. The characteristic equation for a
capacitor is

                  i(t )=C dv(t)        (10.1)
                             dt

This tells us that the current charging the capacitor is proportional to the differential
of the input voltage. By integrating Equation 10.1, it can be seen that the integral of
the capacitor current is proportional to the capacitor voltage.

                              t        (10.2)

                   v(t )= 1C i (t) dt
                              0

397
Assume for a moment that the capacitor voltage is the desired output voltage, as in
Figure 10.2. If the capacitor current can be derived from the input voltage, the output
voltage will be proportional to the integral of the input. The circuit of Figure 10.3
will satisfy our requirements. Note that it is based on the parallel-parallel inverting
amplifier studied earlier. The derivation of its characteristic equation follows.

                                                                                                                  Figure 10.3
                                                                                                                  A simple op amp integrator.

First, note that the voltage across the capacitor is equal to the output voltage. This is
due to the virtual ground at the inverting op amp terminal. Given the polarities
marked, the capacitor voltage is of opposite polarity.

     V out (t)=-V c(t )                        (10.3)

Due to the virtual ground at the op amp's inverting input, all of Vin drops across Ri.
This creates the input current, i.

     i(t )= V i n (t )                 (10.4)
              Ri

Because the current drawn by the op amp's inputs is negligible, all of the input
current flows into the capacitor, C. Combining Equations 10.2 and 10.4 yields

      V c(t )= 1C       V i n (t ) dt
                          Ri

      V c(t )= 1        V i n (t )dt           (10.5)
              Ri C

Combining Equation 10.5 with Equation 10.3 produces the characteristic equation
for the circuit.

      V out (t)=- 1      V i n(t) dt           (10.6)
                  Ri C

Note that this equation assumes that the circuit is initially relaxed (i.e., there is no
charge on the capacitor at time = 0). The only difference between Equation 10.6 and
the general equation as presented in Figure 10.1 is the preceding constant -1/RiC. If

398
the inversion or magnitude of this constant creates design problems, it can usually be
corrected by gain/attenuation networks and/or inverting buffers. Finally, it is worth
noting that due to the virtual ground at the inverting input, the input impedance of
this circuit is approximately equal to Ri, as is the case with the ordinary parallel-
parallel inverting amplifier.

Accuracy and Usefulness of Integration

As long as the circuit operation follows the model presented above, the accuracy of
Equation 10.6 is very high. Small errors occur due to the approximations made. One
possible source is the op amp's input bias current. If the input signal current is
relatively low, the idealization that all of the input current will bypass the op amp
and flow directly into the capacitor is no longer realistic. One possible solution is to
use an FET input op amp. The limited frequency response and noise characteristics
of the op amp will also play a role in the ultimate circuit accuracy. Generally, slew
rate performance is not paramount, as integrators tend to "smooth out" signal
variations. As long as the input signal stays within the op amp's frequency limits,
well above the noise floor, and the output does not saturate, accurate integration
results.

Circuits of this type can be used to model any number of physical processes. For
example, the heat stress on a given transducer might be found by integrating the
signal across it. The resulting signal could then be compared to a predetermined
maximum. If the temperature proved to be too high, the circuit could be powered
down as a safety measure. Although the initial reaction might be to directly measure
the temperature with some form of thermal sensor, this is not always practical. In
such a case, simulation of the physical process is the only reasonable route.

Optimizing the Integrator

For best performance, high-quality parts are a must. Low offset and drift op amps
are needed, as the small DC values that they produce at the input will eventually
force the circuit into saturation. Although they are not shown in Figure 10.3, bias
and offset compensation additions are usually required.

Very low offset devices such as chopper-stabilized (or commutating auto-zero) op
amps may be used for lower frequency applications. For maximum accuracy, a small
input bias current is desired, and thus, FET input op amps should be considered.
Also, the capacitor should be a stable, low-leakage type, such as polypropylene film.
Electrolytic capacitors are generally a poor choice for these circuits.

Even with high-quality parts, the basic integrator can still prove susceptible to errors
caused by small DC offsets. The input offset will cause the output to gradually move
towards either positive or negative saturation. When this happens, the output signal

399
is distorted, and therefore, useless. To prevent this it is possible to place a shorting  Figure 10.4
switch across the capacitor. This can be used to re-initialize the circuit from time to   Response of a simple
time. Although this does work, it is hardly convenient. Before we can come up with        integrator.
a more effective cure, we must first examine the cause of the problem.

We can consider the circuit of Figure 10.3 to be a simple inverting amplifier, where
Rf is replaced by the reactance of the capacitor, XC. In this case, we can see that the
magnitude of the voltage gain is

                                Av=- X C =- 1
                                         Ri 2  f C Ri

Because XC is frequency-dependent, it follows that the voltage gain must be
frequency-dependent. Because XC increases as the frequency drops, the voltage gain
must increase as the frequency decreases. To be more specific, the gain curve will
follow a -6 dB per octave slope. Eventually, the amplifier's response reaches the
open-loop response. This is shown in Figure 10.4.

                    A' v

                                                                open loop

     integrator

     0

                                                          f

The DC gain of the system is at the open loop-level, thus it is obvious that even very    Figure 10.5
small DC inputs can play havoc with the circuit response. If the low-frequency gain       A practical integrator.
is limited to a more modest level, saturation problems can be reduced, if not
completely eliminated. Gain limiting may be produced by shunting the integration
capacitor with a resistor, as shown in Figure 10.5. This resistor sets the upper
limit voltage gain to

                                Amax =- R f
                                           Ri

As always, there will be a trade-off with modification. By definition,
integration occurs where the amplitude response rolls off at -6 dB per octave,
as this is the response of our idealized capacitor model. Any alteration to the
response curve will impact the ultimate accuracy of the integration. By limiting the
low frequency gain, the Bode amplitude response will no longer maintain a constant

400
-6 dB per octave rolloff. Instead, the response will flatten out below the critical
frequency set by C and Rf, as shown in Figure 10.6. This critical frequency, flow, is
found in the standard manner,

                       f low= 1                                  (10.7)
                              2Rf C

This is a very important frequency. It tells us where the useful integration range
starts. If the input frequency is less than flow, the circuit acts like a simple inverting
amplifier and no integration results. The input frequency must be higher than flow for
useful integration to occur. The question then, is how much higher? A few general
rules of thumb are useful. First, if the input frequency equals flow, the resulting
calculation will only be about 50% accurate14. This means that significant signal
amplitude and phase changes will exist relative to the ideal. Second, at about 10
times flow, the accuracy is about 99%. At this point, the agreement between the
calculated and actual measured values will be quite solid.

              A' v                                                                          Figure 10.6
                                                                                            Response of a practical
                                     open loop response                                     integrator.
                                           integration range

              Rf / Ri

              0                      flow                     f

Example 10.1

Determine the equation for Vout, and the lower frequency limit of integration
for the circuit of Figure 10.7.

                                                                                            Figure 10.7
                                                                                            Integrator for Example 10.1.

14 The term 50% accurate is chosen for convenience. The actual values are 50% of the
    calculated for power and phase angle and 70.7% of calculated for voltage.

401
     The general form of the output equation is given by Equation 10.6.

      V out (t)=- 1                                  V i n(t) dt
                  Ri C

      V out (t)=- 1 10 k×10 nF V i n(t )dt

      V out (t)=-104 V i n(t )dt

     The lower limit of integration is set by flow.

     f low= 1
           2Rf C

     f low= 1 2  100 k ×10 nF
     f low=159 Hz

     This represents our 50% accuracy point. For 99% accuracy, the input
     frequency should be at least one decade above flow, or 1.59 kHz. Accurate
     integration will continue to higher and higher frequencies.

The upper limit to useful integration is set by two factors: the frequency response of
the op amp, and the signal amplitude versus noise. Obviously, at much higher
frequencies, the basic assumptions of the circuit's operation will no longer be valid.
The use of wide-bandwidth op amps reduces this limitation but cannot eliminate it.
All amplifiers will eventually reach an upper frequency limit. Perhaps not so
obvious is the limitation caused by signal strength. As noted earlier, the response of
the integrator progresses at -6 dB per octave, which is equivalent to -20 dB per
decade. In other words, a tenfold increase in input frequency results in a tenfold
reduction in output amplitude. For higher frequencies, the net attenuation can be
very great. At this point, the output signal runs the risk of being lost in the output
noise. The only way around this is to ensure that the op amp is a low-noise type,
particularly if a wide range of input frequencies will be used. For integration over a
narrow band of frequencies, the RC integration constant may be optimized to
prevent excessive loss.

Now that we have examined the basic structure of the practical integrator, it is time
to analyze its response to different input waveforms. There are two basic ways of
calculating the output: time-continuous or time-discrete. The time-continuous
method involves the use of the indefinite integral, and is well suited for simple
sinusoidal inputs. Waveforms that require a more complex time domain
representation, such as a square wave, may be analyzed with the time-discrete
method. This corresponds to the definite integral.

402
Analyzing Integrators with the Time-Continuous Method

The time-continuous analysis approach involves finding a time-domain
representation of the input waveform and then inserting it into Equation 10.6. The
indefinite integral is taken, and the result is the time-domain representation of the
output waveform. The constant term produced by the indefinite integral is ignored.
As long as the input waveform can be written in a time-domain form, this method
may be used. Although any waveform may be expressed in this way, it is not always
practical or the most expedient route. Indeed, relatively common waveforms such as
square waves and triangle waves require an infinite series time-domain
representation. We shall not deal with these waveforms in this manner. The time-
continuous integration of these functions is left as an exercise in the Challenge
Problems at the end of this chapter.

Example 10.2

     Using the circuit of Figure 10.7, determine the output if the input is a 1 V
     peak sine wave at 5 kHz.

     First, write the input signal as a function time.

     V i n(t )=1 sin 2  5000 t

     Substitute this input into Equation 10.6:

      V out (t)=- 1     V i n(t) dt
                  Ri C

      V out (t)=- 1 10 k×10 nF 1 sin 2  5000 t dt

     V out (t)=-104 1sin 2  5000 t dt

      V out (t)=-104 1 2  5000 2 5000 sin 2  5000 t dt

     V out (t)=-0.318(-cos 2  5000 t)

     V out (t)=0.318 cos 2 5000 t

     Thus, the output is a sinusoidal wave that is leading the input by 90° and is
     0.318 V peak. Again, note that the constant produced by the integration is
     ignored. In Example 1 it was noted that flow for this circuit is 159 Hz.
     Because the input frequency is over 10 times flow, the accuracy of the result
     should be better than 99%. Note that if the input frequency is changed, both
     the output frequency and amplitude change. For example, if the input were
     raised by a factor of 10 to 50 kHz, the output would also be at 50 kHz, and

403
the output amplitude would be reduced by a factor of 10, to 31.8 mV. The
output would still be a cosine, though.

Computer Simulation

Figure 10.8 shows the Multisim simulation of the circuit of Example 10.2. The
steady-state response is graphed in Figure 10.8b..

                                                                                           Figure 10.8a
                                                                                           Integrator in Multisim.

Note that in order to achieve steady-state results, the output is plotted only after
several cycles of the input have passed through. Even after some 20 cycles, the
output is not perfectly symmetrical. In spite of this, the accuracy of both the
amplitude and phase is quite good when compared to the calculated results. This
further reinforces the fact that the circuit is operating within its useful range. It can
be instructive to rerun the simulation to investigate the initial response as well.

404
                                                                                                                     Figure 10.8b
                                                                                                                     Integrator input and output
                                                                                                                     waveforms.

Analyzing Integrators with the Time-Discrete Method

Unlike the time-continuous approach, this method uses the definite integral and is
used to find an output level at specific instances in time. This is useful if the
continuous time-domain representation is somewhat complex, and yet the wave
shape is relatively simple, as with a square wave. Often, a little logic may be used to
ascertain the shape of the resulting wave. The integral is then used to determine the
exact amplitude. The time-discrete method also proves useful for more complex
waves when modeled within a computer program. Here, several calculations may be
performed per cycle, with the results joined together graphically to form the output
signal.
The basic technique revolves around finding simple time-domain representations of
the input for specific periods of time. A given wave might be modeled as two or
more sections. The definite integral is then applied over each section, and the results
joined.
Example 10.3

         Sketch the output of the circuit shown in Figure 10.7 if the input signal is a
         10 kHz, 2 V peak square wave with no DC component.

405
      +2 V                                                                            Figure 10.9
     -2 V                                                                             Input waveform for
                                                                                      Example 10.3.

            50 s  100 s                            t

                                            150 s

     The first step is to break down the input waveform into simple-to-integrate
     components and ascertain the basic shape of the result. The input is sketched
     in Figure 10.9. The input may be broken into two parts: a non-changing 2 V
     potential from 0 to 50 s, and a non-changing -2 V potential from 50 s to
     100 s. The sequence repeats after this.

            V i n(t )=2 from t=0, to t=50 s
            V i n(t )=-2 from t =50 s , to t =100  s

     In essence, we are saying that the input may be treated as either ±2 V DC for
     short periods of time. Because integration is a summing operation, as time
     progresses, the area swept out from underneath the input signal increases,
     and then decreases due to the polarity changes. It follows that the output will
     grow (or shrink) in a linear fashion, as the input is constant. In other words,
     straight ramps will be produced during these time periods. The only
     difference between them will be the polarity of the slope. From this we find
     that the expected output waveform is a triangle wave. All we need to do now
     is determine the peak value of the output. To do this, perform the definite
     integral using the first portion of the input wave.

             V out (t)=- 1     V i n(t) dt
                         Ri C

                               50 s

             V out (t)=- 1 10 k×10 nF 2 dt
                                                     0

            V out (t)= -104×2×t |t=0 t=50s

                  V out= -20000×50 s

                  V out= -1 V

     This represents the total change over the 50 s half-cycle interval. This is a
     peak-to-peak change, saying that the output is 1 V negative relative to its

406
value at the end of the preceding half-cycle. Integration for the second half
cycle is similar, and produces a positive change. The resulting waveform is
shown in Figure 10.10.

 .5 V                                                                                      Figure 10.10
-.5 V                                                                                      Output waveform for
                                                                                           Example 10.3.

       50 s                  t

             100 s

Note that the wave is effectively inverted. For positive inputs, the output
slope is negative. Because the input frequency is much higher than flow, we
can once again expect high accuracy. Although the solution seems to imply
that the output voltage should swing between 0 and -1 V, a real world
integrator does indeed produce the indicated ±0.5 V swing. This is due to the
fact that the integration capacitor in this circuit will not be able to maintain
the required DC offset indefinitely.

Example 10.4

         Figure 10.11A shows an integrator connected to an accelerometer. This
         device produces a voltage that is proportional to the acceleration it
         experiences15. Accelerometers may be fastened to a variety of physical
         devices in order to determine how the devices respond to various mechanical
         inputs. This would be useful, for example, in experimentally determining the
         mechanical resonance characteristics of a surface. Another possibility is the
         determination of the lateral acceleration of an automobile as it travels
         through a corner. By integrating this signal, it is possible to determine
         velocity, and a further integration will produce position. If the accelerometer
         produces the voltage shown in Figure 10.11, determine the shape of the
         velocity curve (assume a non-repetitive input wave).

15 A mechanical accelerometer consists of a small mass, associated restoring springs, and
    some form of transducer that is capable of reading the mass's motion. More recent
    designs may be fashioned using micro-machined chips, where the deflection of a mass-
    supporting beam is measured indirectly.

407
                                                                                    Figure 10.11a
                                                                                    Accelerometer with integrator
                                                                                    circuit.

     +.6 V                                                                          Figure 10.11b
                                                                                    Signal produced by
                                                                                    accelerometer.

            1 ms  4 ms 5 ms

                                      t

     -.6 V

     First, check the frequency limit of the integrator in order to see if high
     accuracy may be maintained. If the input waveform was repetitive, it would
     be approximately 200 Hz (1/ 5 ms).

                                     f low= 1
                                            2Rf C

                                     f low= 1 2  400 k×20 nF
                                     f low=19.9 Hz

     The input signal is well above the lower limit.

     Note that the input waveshape may be analyzed in piece-wise fashion, as if
     it were a square wave. The positive and negative portions are both 1 ms in
     duration, and 0.6 V peak. The only difference is the polarity. As these are
     square pulses, we expect ramp sections for the output. For the positive pulse
     (t = 0 to t =1 ms),

408
                                 V out (t)=- 1     V i n(t) dt
                                             Ri C

                                                                       10-3

                                 V out (t)=- 1 15 k×20nF .6 dt
                                                                        0

                                V out (t)= -3333× 0.6×t |t=0 t=10-3

                                                                   -3

                                V out= -2000×10

                                V out= -2 V

     This tells us that we will see a negative going ramp with a -2 V change. For
     the time period between 1 ms and 4 ms, the input signal is zero, and thus the
     change in output potential will be zero. This means that the output will
     remain at -2 V until t = 4 ms.

                          1 ms                     4 ms                      5 ms      Figure 10.12
     -2 V                                                                              Integrator output.
                                                                                  t

     For the period between 4 ms and 5 ms, a positive going ramp will be
     produced. Because only the polarity is changed relative to the first pulse, we
     can quickly find that the change is +2 V. The input waveform is non-
     repetitive, so the output waveform appears as shown in Figure 10.12. (A
     repetitive input would naturally cause the integrator to "settle" around
     ground over time, producing the same basic waveshape, but shifted
     positively.) This waveform tells us that the velocity of the device under test
     increases linearly up to a point. After this point, the velocity remains
     constant until a linear decrease in velocity occurs. (Remember, the integrator
     inverts the signal, so the output curve is effectively upside down. If the input
     wave indicates an initial positive acceleration, the actual output is an initial
     positive velocity.) On a different time scale, these are the sort of waveforms
     that might be produced by an accelerometer mounted on an automobile that
     starts at rest, smoothly climbs to a fixed speed, and then smoothly brakes to
     a stop.

409
10.3 Differentiators

Differentiators perform the complementary function to the integrator. The base form                            Figure 10.13
of the differentiator is shown in Figure 10.13. The output voltage is the differential                         A basic differentiator.
of the input voltage. This is very useful for finding the rate at which a signal varies
over time. For example, it is possible to find velocity given distance and                                     d/dt Vout
acceleration given velocity. This can be very useful in process control work.
                                                                                                            Vout (t)=dVin (t)/dt
                                                                                                       Vin

Essentially, the differentiator tends to reinforce fast signal transitions. If the
input waveform is non-changing, (i.e., DC), the slope is zero, and thus the
output of the differentiator is zero. On the other hand, an abrupt signal change
such as the rising edge of a square wave produces a very large slope, and thus the
output of the differentiator will be large. In order to create the differentiation, an
appropriate device needs to be associated with the op amp circuit. This was the
approach taken with the integrator, and it remains valid here. In fact, we are left with
the same two options: using either an inductor, or a capacitor. Again, capacitors tend
to be somewhat easier to work with than inductors and are preferred. The only
difference between the integrator and the differentiator is the position of the
capacitor. Instead of placing it in the Rf position, the capacitor will be placed in the
Ri position. The resulting circuit is shown in Figure 10.14.

The analysis starts with the basic capacitor equation (Equation 10.1):                                      Figure 10.14
                                i(t )=C dv(t)                                                               A simple op amp
                                           dt                                                               differentiator.

We already know from previous work that the output voltage appears
across Rf, though inverted.

                     V out=-V Rf

Also, by Ohm's law,

                     V Rf =i R f

By using the approximation that all input current flows through Rf (since the op
amp's input current is zero), and then substituting Equation 10.1 for the current, we
find

                     V out (t)=- R f C dv (t ) dt

A quick inspection of the circuit shows that all of the input voltage drops across the
capacitor, because the op amp's inverting input is a virtual ground. Bearing this in
mind, we arrive at the final output voltage equation,

410
V out (t)=- R f C dV i n(t) dt  (10.8)

As with the integrator, a leading constant is added to the fundamental form. Again, it
is possible to scale the output as required through the use of gain or attenuation
networks.

Accuracy and Usefulness of Differentiation                                                Figure 10.15
                                                                                          Response of a simple
Equation 10.8 is an accurate reflection of the circuit response so long as the base       differentiator.
assumptions remain valid. As with the integrator, practical considerations tend to
force limits on the circuit's operating range. If the circuit is analyzed at discrete
points in the frequency domain, it can be modeled as an inverting amplifier with the
following gain equation:

                                Av=- R f =-2  f C R f
                                        XC

Note that as the frequency decreases, XC grows, thus reducing the gain. Conversely,
as the input frequency is raised, XC falls in value, causing the gain to rise. This rise
will continue until it intersects the open-loop response of the op amp. The resulting
amplitude response is shown in Figure 10.15.

                    A' v

                                                                   open loop

                           0

                                          differentiation f

                                                 (6 dB/octave)

This response is the mirror image of the basic integrator response and exhibits a
slope of 6 dB per octave. Note that DC gain is zero, and therefore the problems
created by input bias and offset currents are not nearly as troublesome as in the
integrator. Because of this, there is no limit as to how low the input frequency may
be, excluding the effects of signal-to-noise ratio. Things are considerably different
on the high end though. Once the circuit response breaks away from the ideal 6 dB
per octave slope, differentiation no longer takes place.

411
Optimizing the Differentiator                                                              Figure 10.16
                                                                                           Response of a partially
There are a couple of problems with the general differentiator of Figure 10.14. First      optimized differentiator.
of all, it is quite possible that the circuit may become unstable at higher frequencies.
Also, the basic shape of the amplitude response suggests that high frequencies are
accentuated, thus increasing the relative noise level. Both of these problems may be
reduced by providing an artificial upper-limit frequency, fhigh. This tailoring may be
achieved by shunting Rf with a small capacitor. This reduces the high frequency
gain, and thus reduces the noise. The resulting response is shown in Figure 10.16.

                 A' v

                                                             open loop

     0

                          fhigh f

We find fhigh in the standard manner:

     f high( fdbk )= 1                 (10.9)
                 2Rf C f

fhigh represents the highest frequency for differentiation. It is the 50% accuracy point.
For higher accuracy, the input frequency must be kept well below fhigh. At about 0.1
fhigh, the accuracy of equation 10.8 is about 99%. Generally, you have to be
somewhat more conservative in the estimation of accuracy than with the integrator.
This is because complex waves contain harmonics that are higher than the
fundamental. Even though the fundamental may be well within the high accuracy
range, the upper harmonics may not be.

The other major problem of the basic circuit is that the input impedance is inversely
proportional to the input frequency. This is because XC is the sole input impedance
factor. This may present a problem at higher frequencies because the impedance will
approach zero. To circumvent this problem, a resistor may be placed in series with
the input capacitor in order to establish a minimum impedance value. Unfortunately,
this will also create an upper break frequency, fhigh.

     f high(i n)= 1                    (10.10)
               2  Ri C

412
The resulting response is shown in Figure 10.17. The effective fhigh for the system      Figure 10.17
will be the lower of Equations 10.9 and 10.10.                                           Response of a practical
                                                                                         differentiator.
                   A' v

                                                                     open loop

                           0

                                               fhigh f

The completed, practical differentiator is shown in Figure 10.18. Note that a bias
compensation resistor may be required at the noninverting input, although it is not
shown.

                                                                                                                     Figure 10.18
                                                                                                                     A practical differentiator.

Analyzing Differentiators with the Time-Continuous Method

The time-continuous method will be used when the input signal may be easily
written in the time-domain (e.g., sine waves). For more complex waveforms, such as
a triangle wave, a discrete time method will be used. The continuous method will
lead directly to a time-domain representation of the output waveform. Specific
voltage/time coordinates will not be evaluated.

Example 10.5

         Determine the useful range for differentiation in the circuit of Figure 10.19.
         Also determine the output voltage if the input signal is a 2 V peak sine wave
         at 3 kHz.

413
                                                                                                                     Figure 10.19
                                                                                                                     Differentiator for
                                                                                                                     Example 10.5.

         The upper limit of the useful frequency range will be determined by the
         lower of the two RC networks.

                                          f high( fdbk )= 1
                                                       2 Rf C f

                                          f high( fdbk )= 1 2 ×5 k×100 pF
                                          f high( fdbk )=318.3 kHz

                                          f high(i n)= 1
                                                     2  Ri C

                                          f high(i n)= 1 2 ×100×10 nF
                                          f high(i n)=159.2 kHz

         Therefore, the upper limit is 159.2 kHz. Remember, the accuracy at this
         limit is relatively low, and normal operation will typically be several octaves
         lower than this limit. Note that the input frequency is 3 kHz, so high
         accuracy should result. First, write Vin as a time-domain expression:

                                         V i n(t )=2 sin 2  3000 t

                                         V out (t)=- R f C dV i n (t ) dt
                                         V out (t)=-5 k×10 nF d 2 sin 2  3000 t dt

                                                         -4 d sin 2  3000 t
                                         V out (t)=-10

                                                                   dt
                                         V out (t)=-1.885cos 2  3000 t

         This tells us that the output waveform is also sinusoidal, but it lags the input
         by 90°. Note that the input frequency has not changed, but the amplitude
         has. The differentiator operates with a 6 dB per octave slope, thus it can be
         seen that the output amplitude is directly proportional to the input frequency.
         If this example is rerun with a frequency of 6 kHz, the output amplitude will
         be double the present value.

414
Computer Simulation

The Multisim simulation for the circuit of Example 10.5 is shown in Figure 10.20.
Note the excellent correlation for both the phase and amplitude of the output. As was
the case with the integrator simulation, the Transient Analysis output plot is started
after the initial conditions have settled.

                                                                                                                     Figure 10.20a
                                                                                                                     Differentiator in Multisim.

                                                                                                                     Figure 10.20b
                                                                                                                     Differentiator input and output
                                                                                                                     waveforms.

415
Analyzing Differentiators with the Time-Discrete Method

For more complex waveforms, it is sometimes expedient to break the waveform into
discrete chunks, differentiate each portion, and then combine the results. The idea is
to break the waveform into equivalent straight-line segments. Differentiation of a
straight-line segment will result in a constant (i.e., the slope, which does not change
over that time). The process is repeated until one cycle of the input waveform is
completed. The resultant levels are then joined together graphically to produce the
output waveform.

Often, waveforms are symmetrical, and only part of the calculation need be
performed: a sign change is all that will be needed for the mirror image portions. As
an example, a triangle wave may be broken into a positive-going line segment and a
negative going-line segment. The slopes should be equal, only the direction (i.e.,
sign) has changed. A square wave may be broken into four parts: a positive-going
edge, a static positive value, a negative-going edge, and a static negative value. The
"flat" portions have a slope of zero, so only one calculation must be performed, and
that's the positive-going edge. We shall take a look at both of these waveforms in the
next two examples.

Example 10.6

         Sketch the output waveform for the circuit of Figure 10.19 if the input is a 3
         volt peak triangle wave at 4 kHz.

         First, note that the input frequency is well within the useful range of this
         circuit, as calculated in Example 10.5. (Note that the highest harmonics will
         still be out of range, but the error introduced will be minor.)

         The triangle wave may be broken into a positive-going portion and a
         negative-going portion. In either case, the total voltage change will be 6 V in
         one half-cycle. The period of the waveform is

                                          T = 1 4 kHz
                                         T =250 s

         Therefore, for the positive going portion, a 6 volt change will be seen in
         125 s (-6 V in 125 s for the negative going portion). The slope is

                                         Slope = 6 V 125 s
                                         Slope =48000 V/s

416
Which, as a time-domain expression is

                                V i n(t )=48000 t

Substituting this equation into equation 10.8 yields

                                V out (t)=- R f C dV i n (t ) dt
                                V out (t)=-5 k×10 nF d 48000 t dt
                                V out (t)=-2.4 V

During t = 0 through t = 125 s, the output is -2.4 V. Differentiation of the
second half of the wave is similar, but produces a positive output, +2.4 V.
The result is a 4 kHz square wave that is 2.4 V peak. The resulting
waveform is shown in Figure 10.21.

+3 V    Vout                                                                            Figure 10.21

+2.4 V                                                                                  Input/output waveforms.

                                                                               t

-2.4 V Vin

  -3 V

Computer Simulation

Some circuits are more sensitive to the choice of op amp than others are, and the
effects of an improper choice may not always be immediately apparent without first
building or simulating the circuit. A good example of this is shown in Figure 10.22.
Multisim was used to create the Transient Analysis for the circuit of Example 10.6
with two different op amps. Accurate differentiation requires excellent high
frequency response from the op amp. In the first simulation, a 741 op amp is used.
This device is not particularly fast. As a result, the output waveform suffers from
excessive overshoot and ringing. Also, slew rate limiting is fairly obvious, slowing
the transitions of the output waveform. In contrast, using an LF411 in the same
circuit yields far superior response. Some overshoot still exists, but its magnitude
has been restrained, as has the ringing. Also, slew rate limiting is reduced by a wide

417
margin. Clearly, the second result is much closer to the ideal calculation than the
first run.

                                                                                     Figure 10.22a
                                                                                     Multisim schematic of
                                                                                     differentiator.

                                                                                     Figure 10.22b
                                                                                     Input and output wave-
                                                                                     forms using 741.

418
                                                                                                                     Figure 10.22c
                                                                                                                     Input and output wave-
                                                                                                                     forms using LF411.

Example 10.7
         Repeat Example 10.6 with a 3 V peak, 4 kHz square as the input. Assume
         that the rising and falling edges of the square wave have been slew limited
         to 5 V/s.
         During the time periods that the input is at ±3 V, the output will be zero.
         This is because the input slope is, by definition, zero when the signal is
         "flat". An output is only noted during the transitions between the ±3 V
         levels. Therefore, we need to find the slope of the transitions. It was stated
         that due to slew rate limiting (perhaps from some previous amplifier stage)
         the transitions run at 5 V/s. As a time-domain expression, this is

                                          V i n(t )=5×106 t
         Substituting this equation into equation 10.8 yields,

                                         V out (t)=- R f C dV i n (t ) dt
                                                                  d 5×106 t

                                         V out (t)=-5 k 10 nF dt
                                         V out (t)=-250 V
419
Obviously, when using a standard op amp and ±15 V power supply, clipping
will occur in the vicinity of -13.5 V. For the negative going edge, a similar
result will be seen (+250 V calculated, with clipping at +13.5 V). The
resulting waveform is shown in Figure 10.23. Note that the output waveform
spikes will also be limited by the slew rate of the differentiator's op amp.

+3 V                    pulse to +13.5 V                                                        Figure 10.23
                                                                                                Differentiated square wave
           Vin  Vout                                                                            (note output clipping).

                                            t

-3 V
                          pulse to -13.5 V

Example 10.8

         Figure 10.24 shows a differentiator receiving a signal from an LVDT, or
         linear variable differential transformer16. An LVDT can be used to accurately
         measure the position of objects with displacements of less than one-
         thousandth of an inch. This could be useful in a computer-aided
         manufacturing system. By differentiating this position signal, a velocity
         signal may be derived. A second differentiation will produce acceleration. If
         the LVDT produces the wave shown in Figure 10.24, determine the
         velocity/time curve for the object being tracked.

16 An LVDT is a transformer with dual secondary windings and a movable core. The core is
    connected to a shaft, that is in turn actuated by some external object. The movement of
    the core alters the mutual inductance between primary and secondary. A carrier signal is
    fed into the primary, and the changing mutual inductance alters the strength of the signal
    induced into the secondaries. This signal change is turned into a simple DC voltage by a
    demodulator. The resulting DC potential is proportional to the position of the core, and
    thus, proportional to the position of the object under measurement.

420
                                                                                      Figure 10.24a
                                                                                      Differentiator circuit with
                                                                                      LVDT.

   First, check the upper frequency limit for the circuit.                            Figure 10.24b
                                                                                      Signal produced by LVDT.
                                    f high( fdbk )= 1
                                                2 Rf C f

                                    f high( fdbk )= 1 2 × 40 k×2 nF
                                    f high( fdbk )=1.99 kHz

                                    f high(i n)= 1
                                              2  Ri C

                                    f high(i n)= 1 2 ×250×500 nF
                                    f high(i n)=1.273 kHz

   The limit will be the lower of the two, or 1.273 kHz. This is well above the
   slowly changing input signal, and therefore, high accuracy should be
   possible.

+2 V

.2  .5  .7  1.0  1.2 t (sec)

         -2 V

         This wave can be analyzed in piece-wise fashion. The ramp portions will
         produce constant output levels and the flat portions will produce an output
         of 0 V (i.e., the rate of change is zero).

421
     For the first section,

                                   Slope = 2 V 0.2s
                                   Slope =10V/s

     Which, as a time-domain expression, is

                                     V i n(t )=10 t

                                      V out (t)=- R f C dV i n(t) dt
                                     V out (t)=-40 k×500 nF d 10t dt
                                     V out (t)=-0.2 V

     So, during t = 0 through t = 0.2 s, the output is -0.2 V. The time period
     between 0.2 s and 0.5 s will produce an output of 0 V. For the negative-
     going portion,

                                     Slope =-4 V 0.2s
                                     Slope =-20V/s thus,
                                     V i n(t )=-20 t

                                      V out (t )=-R f C dV i n (t ) dt
                                     V out (t)=-40 k 500 nF d 20t dt
                                     V out (t)=0.4 V

     The output is 0.4 V between 0.5 s and 0.7 s. The third section has the same
     slope as the first section, and will also produce a -0.2 V level. The output
     waveform is drawn in Figure 10.25.

     +.4 V                                                                         Figure 10.25
                                                                                   Differentiator output.

                               .2                    1.0  1.2
     -.2 V
                                   .5  .7                      t (sec)

422
10.4 Analog Computer

Analog computers are used to simulate physical systems. These systems may be
electrical, mechanical, acoustical, or what have you. An analog computer is basically
a collection of integrators, differentiators, summers, and amplifiers. Due to their
relative stability, integrators are favored over differentiators. It is not uncommon for
analog computers to be made without any differentiators. Because physical systems
may be described in terms of differential equations, analog computers may be used
to solve these equations, thus producing as output some system parameter.

The basic advantage of simulation is that several variations of a given system may
be examined in real time without actually constructing the system. For a large
project this is particularly cost-efficient. The process starts by writing a differential
equation (first-, second-, or third-order) that describes the system in question. The
equation is then solved for its highest-order element, and the result used to create a
circuit.

Example 10.9

Let's investigate the system shown in Figure 10.26. This is a simple
mechanical system that might represent (to a rough approximation) a variety
of physical entities, including the suspension of an automobile.

       spring                                                                              Figure 10.26
                                                                                           Mechanical system.

       mass displacement

force  shock absorber

         This system is comprised of a body with mass M, that is suspended from a
         spring. The spring has a spring constant, K. The mass is also connected to a
         shock absorber that produces damping, R. If an external force, F, excites the
         mass, it will move, producing some displacement, X. This displacement
         depends on the mass, force, spring constant, and damping. Essentially, the
         spring and shock absorber will create reactionary forces. From basic
         physics, F=MA, where A is the acceleration of the body. If X is the position

423
     of the body, then dX/dt is its velocity, and d2X/dt2 is its acceleration.
     Therefore, we can say

             d2X
     F =M 2

              dt

     In this system, the total force is comprised of the excitation force F, and the
     forces produced by the spring and shock absorber.

                                d2 X
     F- F spring-F shock= M 2

                                 dt

     The spring's force is equal to the displacement times the spring constant:

     F spring= KX

     The shock absorber's force is equal to the damping constant times the
     velocity of the body:

     F shock= R dXdt

     By substituting and rearranging the above elements we find that

             d 2 X dX
     F =M 2 +R +K X
     dt               dt

     Here F is seen as the input signal, and X as the output signal. A somewhat
     less busy notation form is the dot convention. A single dot represents the
     first derivative with respect to time, two dots represent the second
     derivative, and so on. The above equation may be rewritten as

     F =M X¨ +R X +K X

     This is the final differential equation. Note how it contains only derivatives
     and no integrals. The last step is to solve the equation for the highest-order
     differential. By setting it up in this form, the simulation circuit may be
     realized without using differentiators. This will indicate how many
     integrators will be required.

     X¨ = FM - RM X - KM X

     This says that the second differential of X is the sum of three components.
     To realize the circuit, start with a summing amplifier with the three desired

424
     signals as inputs. This is shown in block form in Figure 10.27. Note that two
     of the inputs use X and the first derivative of X.

     -R .                                                                             Figure 10.27
        X                                                                             Circuit realization (block
     M                                                     ..                         form).
                                     X
        F

     M

     -KM X

                               (noninverting summer used)

     These elements may be produced by integrating the output of Figure 10.27.
     Appropriate constants may be used to achieve the desired signal levels. This
     is shown in Figure 10.28. Certain elements may be combined; for example, a
     weighted summing amplifier may be used to eliminate unneeded amplifiers.

            -R .            X  R                                                      Figure 10.28
                                                                                      Circuit realization using
            M                  M                                                      function blocks.

     F 1M F                     ..  .  X
                         M        X                        -X

            -KM X KM

     In use, the constants R, K, and M are set by potentiometers (they are
     essentially nothing more than scaled gain factors). A voltage representing
     the excitation force is applied to the circuit, and the desired output quantity
     is recorded. Note that the output of interest could be the acceleration,
     velocity, or displacement of the body. In order to test the system with a new
     spring or damping constant, all that is needed is to adjust the appropriate
     potentiometer. In this manner, a large number of combinations may be tried
     quickly. The most successful combinations may then be built and tested for
     the final design. An analog computer such as this would be very useful in
     testing such items as the suspension of an automobile or a loudspeaker
     system. To ease the design of the simulation circuit, commercial analog
     computers are available. Construction (or programming) of the circuit
     involves wiring integrator, amplifier, and summer blocks, together with the
     appropriate potentiometers. In this way, the details of designing and
     optimizing individual integrators or amplifiers is bypassed.

425
10.5 Alternatives to Integrators and Differentiators

There are alternatives to using op amp based integrators and differentiators. As long
as systems can be described by a reasonable set of equations, simulation using
digital computers is possible. The primary advantages of a digital computer-based
simulation scheme is that it is very flexible and potentially very accurate. Before the
rise of affordable and powerful desktop digital computers, the speed of response of
the digital technique was a severe limitation. Analog computers can be configured as
real-time or faster-than-real-time devices: they respond at the same speed or faster
than the system that is being simulated. The typically heavy computation load of the
digital computer requires prodigious calculation speed to keep up with reasonably
fast processes. Fortunately, this is no longer the problem it once was. Another
advantage of the analog computer is its immediacy. It is by nature, interactive. This
means that an operator can change simulation parameters and immediately see the
result. Finally, there are some applications for which the added cost of the
computing hardware cannot be justified. If these are not issues, then a digital-based
simulation will most likely be preferred. The general idea is to calculate the response
for several closely spaced points in time. The results may be used in a variety of
ways. For example, graphs may be created that can then be studied at leisure or the
resulting digital signal may be used elsewhere in the system. An extreme (although
generally impractical) possibility is to design an op amp based simulator and then
simulate its response by using a digital circuit simulator! As you might guess, this
double simulation is not particularly efficient, especially with large systems.

10.6 Extended Topic: Other Integrator and
Differentiator Circuits

The basic integrator and differentiator circuits examined earlier may be extended
into other forms. Perhaps the most obvious extension is to add multiple inputs, as in
an ordinary summing amplifier. In complex systems, this concept may save the use
of several op amps. A summing integrator is shown in Figure 10.29. Note its
similarity to a normal summing amplifier. In this circuit, the input currents are
summed at the inverting input of the op amp.

                                                                                                                     Figure 10.29
                                                                                                                     Summing integrator.

426
If the resistors are all set to the same value, we can quickly derive the output
equation by following the original derivation. The result is

               V out= - 1RC V 1+V 2+...+V n dt

The output is the negative integral of the sum of the inputs.

                                                                                        Figure 10.30
                                                                                        Summing differentiator.

In a similar vein, a summing differentiator may be formed. This is shown in Figure
10.30. Again, the proof of its output equation follows the original differentiator
derivation.

     V out=-R C1 dV 1 dt - R C2 dV 2 dt -.... -R Cn dV n dt

Another interesting adaptation of the integrator is the augmenting integrator. This
circuit adds a constant gain portion to the output equation. An augmenting integrator
is shown in Figure 10.31. The addition of the feedback resistor Rf provides the
augmenting action. As you might surmise, the gain portion is directly related to Rf
and Ri.

      V out=-V i n R f - 1  V i n dt
                   Ri RC

The augmenting integrator can also be turned into a summing/augmenting integrator
by adding extra input resistors as in Figure 10.29. Note that the gain portion will be
the same for all inputs if the input summing resistors are of equal value.

                                                                                        Figure 10.31
                                                                                        Augmenting integrator.

427
The final variant that we shall note is the double integrator. This design requires two
reactive portions in order to achieve double integration. One possibility is shown in
Figure 10.32. In this circuit, a pair of RC "Tee" networks are used. The output
equation is

 V out=- 2 4     V i n dt
         (R C )

When properly used, the double integrator can cut down the parts requirement of
larger circuit designs.

                                                                                            Figure 10.32
                                                                                            Double integrator.

Summary

In this chapter we have examined the structure and use of integrator and
differentiator circuits. Integrators produce a summing action whereas differentiators
find the slope of the input. Both types are based on the general parallel-parallel
inverting voltage feedback model. In order to achieve integration and differentiation,
a capacitor is used in the feedback network in place of the standard resistor. Because
the capacitor current is proportional to the rate of change of the capacitor's voltage, a
differential or integral response is possible. For the integrator, the capacitor is placed
in the normal Rf position, and for the differentiator, the capacitor is placed in the
normal Ri position. As a result, the integrator exhibits a -6 dB per octave slope
through the useful integration range. The differentiator exhibits the mirror image, or
+6 dB per octave slope, throughout its useful range.

In both circuits, practical limitations require the use of additional components. In the
case of the integrator, small DC offsets at the input can force the output into
saturation. To avoid this, a resistor is placed in parallel with the integration capacitor
in order to limit the low frequency gain. This has the unfortunate side effect of
limiting the useful integration range to higher frequencies. In the case of the
differentiator, noise, stability, and input impedance limits can pose problems. In
order to minimize noise and aid in stability, a small capacitor may be placed in
parallel with Rf. This reduces the high frequency gain. In order to place a lower limit
on the input impedance, a resistor may be placed in series with the differentiation

428
capacitor. The addition of either component will limit the upper range of
differentiation.

We examined two general techniques for determining the output signal. The first
form is referred to as the time-continuous method and although it may be used with
virtually any waveform, our use was with simple sine waves only. In the case of the
integrator, it corresponds to the indefinite integral - a time-domain equation for the
output is the result. The second form is the time-discrete method and is useful for
waves that may be easily broken into segments. Each segment is analyzed, and the
results joined graphically. This has the advantage of an immediate graphical result,
whereas the shape of the time-continuous result may not be immediately apparent.
The time-discrete method is also useful for producing output tables and graphs with
a digital computer. In the case of the integrator, the time-discrete method
corresponds to the definite integral.

Integrators and differentiators may be used in combination with summers and
amplifiers to form analog computers. Analog computers may be used to model a
variety of physical systems in real time. Unlike their digital counterparts,
programming an analog computer only requires the proper interconnection of the
various building blocks and appropriate settings for the required physical constants.

Finally, it is noted that integrators and differentiators may be used as wave shaping
circuits. Integrators may be used to turn square waves into triangle waves.
Differentiators can be used to turn triangle waves into square waves. Indeed, as
differentiators tend to "seek" rapid changes in the input signal, they can be quite
useful as edge detectors.

Review Questions

    1. What is the basic function of an integrator?
    2. What is the basic function of a differentiator?
    3. What is the function of the capacitor in the basic integrator and

         differentiator?
    4. Why are capacitors used in favor of inductors?
    5. What practical modifications need to be done to the basic integrator, and

         why?
    6. What practical modifications need to be done to the basic differentiator, and

         why?
    7. What are the negative side effects of the practical versus basic integrator and

         differentiator?
    8. What is an analog computer, and what is it used for?
    9. What are some of the advantages and disadvantages of the analog computer

         versus the digital computer?
    10. How might integrators and differentiators be used as wave-shaping circuits?

429
Problems

Analysis Problems
    1. Sketch the output waveform for the circuit of Figure 10.33 if the input is a
         4 V peak square wave at 1 kHz.

                                                                        Figure 10.33

    2. Repeat Problem 1 if Vin(t) = 5 sin 2318t.
    3. Repeat Problem 1 if Vin(t) = 20 cos 210000t.
    4. Using the circuit of Problem 1, if the input is a ramp with a slope of 10 V/s,

         find the output after 1 ms, 10 ms, and 4 s. Sketch the resulting wave.
    5. Determine the low frequency gain for the circuit of Figure 10.34.

                                                                        Figure 10.34

    6. If C = 33 nF in Figure 10.34, determine Vout if Vin is a 200 mV peak sine
         wave at 50 kHz.

    7. Repeat Problem 6 using a 200 mV peak square wave at 50 kHz.
    8. Sketch the output of the circuit of Figure 10.7 with the input signal given in

         Figure 10.35.
    9. Assume that the input to the circuit of Figure 10.7 is 100 mV DC. Sketch the

         output waveform, and determine if it goes to saturation.
430
+9 V Figure 10.35

-1 V                                                                         t
             10 s
                                  100 s

10. Sketch the output waveform for Figure 10.7, given an input of:
    Vin(t) = 0.5 cos 29000t.

11. Given the circuit of Figure 10.36, sketch the output waveform if the input is
    a 100 Hz, 1 V peak triangle wave.

                                                                  Figure 10.36

12. Repeat Problem 11 if the input is a 2 V peak square wave at 500 Hz.
    Assume that the rise and fall times are 1 s and are linear (vs. exponential).

13. Repeat Problem 11 for the following input: Vin(t) = 3 cos 260t.
14. Repeat Problem 11 for the following input: Vin(t) = 0.5 sin 21000t.
15. Repeat Problem 11 for the following input: Vin(t) = 10 t2.

+.2 V                                Figure 10.37

                                  t

           -.2 V   1.8 ms 2.0 ms

431
16. Given the input shown in Figure 10.37, sketch the output of the circuit of
    Figure 10.19.

17. Given the input shown in Figure 10.38, sketch the output of the circuit of
    Figure 10.19.

                                                                  Figure 10.38

      +.1 V

3 ms  10 ms 12 ms t

    18. Sketch the output waveform for Figure 10.19, given an input of
         Vin(t) = 0.5 cos 24000t.

    19. Sketch the output waveform for Figure 10.19, if Vin is a 300 mV peak
         triangle wave at 2500 Hz.

Design Problems

    20. Given the circuit of Figure 10.34, A) Determine the value of C required in
         order to yield an integration constant of -2000. B) Determine the required of
         value of R for minimum integration offset error. C) Determine flow.
         D) Determine the 99% accuracy point.

    21. Given the differentiator of Figure 10.39, determine the value of R that will
         set the differentiation constant to -103.

                                                                        Figure 10.39

    22. Determine the value of Ri such that the maximum gain is 20 for the circuit of
         Figure 10.39. (Use the values of Problem 21.)

432
     23. Determine the value of Cf in Problem 22 such that noise above 5 kHz is
         attenuated.

     24. Design an integrator to meet the following specifications: integration
         constant of -4500, flow no greater than 300 Hz, Zin at least 6 k , and DC gain
         no more than 32 dB.

     25. Design a differentiator to meet the following specifications: differentiation
         constant of -1.2E-4, fhigh at least 100 kHz, and a minimum Zin of 50 .

Challenge Problems

     26. Sketch the output waveform for the circuit of Figure 10.7 if the input is the
         following damped sinusoid: Vin(t) = 3 -200t sin 21000t.

     27. A 1.57 V peak, 500 Hz square wave may be written as the following infinite

     series:  V  i  n  (  t  )  =  2             1    sin  2500(2 n  -1) t
                                               2 n-1
                                         n =1

     Using this as the input signal, determine the infinite series output equation
     for the circuit of Figure 10.7.

     28. Sketch the output for the preceding problem. Do this by graphically adding
         the first few terms of the output.

     29. Remembering that the voltage across an inductor is equal to the inductance
         times the rate of change of current, determine the output equation for the
         circuit of Figure 10.40.

                                                                     Figure 10.40

     30. Repeat the preceding Problem for the circuit of Figure 10.41.
                                                                       Figure 10.41

433
     31. A 2.47 V peak, 500 Hz triangle wave may be written as the following

     infinite series:  V        (  t  )=  2               1          cos  2500( 2  n  -1) t

                          i  n                  n =1  (2  n-  1   2

                                                                 )

     Using this as the input signal, determine the infinite series output equation
     for the circuit of Figure 10.19.

     32. Sketch the output for the preceding problem. Do this by graphically adding
         the first few terms of the output.

Computer Simulation Problems

    33. Simulate Problem 1 and determine the steady-state response.
    34. Model Problem 8 using a simulator. Determine both the steady-state and

         initial outputs.
    35. Simulate Problem 14. Determine the steady-state output.
    36. Model Problem 22 using a simulator and determine the output signal.
    37. Compare the resulting waveform produced by the circuit of Problem 8 using

         both the 741 op amp and the medium-speed LF411. Does the choice of op
         amp make a discernible difference in this application?

434
11 Active Filters

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Describe the four main types of filters.
    · Detail the advantages and disadvantages of active versus passive filters.
    · Describe the importance of filter order on the shape of a filter's response.
    · Describe the importance of filter alignment on the shape of a filter's response.
    · Compare the general gain and phase response characteristics of the popular filter alignments.
    · Analyze high- and low-pass Sallen and Key filters.
    · Analyze both low and high Q band-pass filters.
    · Analyze state-variable filters.
    · Analyze notch filters.
    · Analyze cascaded filters of high order.
    · Detail the operation of basic bass and treble audio equalizers.
    · Explain the operation of switched capacitor filters, and list their relative advantages and disadvantages

         compared to ordinary op amp filters.

11.1 Introduction

Generally speaking, a filter is a circuit that inhibits the transfer of a specific range of frequencies. Conversely,
you can think of a filter as a circuit that allows only certain frequencies to pass through. Filters are used to
remove undesirable frequency components from a complex input signal. The uses for this operation are many,
including the suppression of power-line hum, reduction of very low or high frequency interference and noise,
and specialized spectral shaping. One very common use for filters is bandwidth limiting, which, as you'll see in
Chapter Twelve, is an integral part of any analog-to-digital conversion system.

There are numerous variations on the design and implementation of filters. Indeed, an in-depth discussion of
filters could easily fill more than one textbook. Our discussion must by necessity be of a limited and
introductory nature. This chapter deals with the implementation of a number of popular op amp filter types. Due
to the finite space available, every mathematical proof for the design sequences will not be detailed here, but
may be found in the references listed at the end of the chapter.

Filter implementations may be classified into two very broad, yet distinct, camps: digital filters and analog
filters. Digital filters work entirely in the digital domain, using numeric data as the input signal. The design of
digital filters is an advanced topic and will not be examined here.

435
The second category, analog filters, utilizes standard linear circuit techniques for      Figure 11.1
their construction. Analog filter implementations can be broken into two                  High-pass response.
subcategories: passive and active. Passive filters utilize only resistors, A
inductors, and capacitors, whereas active filters make use of active devices
(i.e., discrete transistors or op amps) as well. Although we will be examining
only one subcategory in the world of filters, it is important to note that many of
the circuits that we will design can be realized through passive analog filters or
digital filters.

                                                                                                                                                                                                                  f

11.2 Filter Types

No matter how a filter is realized, it will usually conform to one of four basic          Figure 11.2

response types. These types are: high-pass, low-pass, band-pass, and band-reject          Low-pass response.

(also known as a notch type). A high-pass filter allows only frequencies above A
a certain break point to pass through. In other words, it attenuates low

frequency components. Its general amplitude frequency response is shown in

Figure 11.1. A low-pass filter is the logical mirror of the high-pass, that is, it

allows only low frequency signals to pass through, while suppressing high-

frequency components. Its response is shown in Figure 11.2. The band-pass

filter can be thought of as a combination of high- and low-pass filters. It only

allows frequencies within a specified range to pass through. Its logical inverse                               f

is the band-reject filter that allows everything to pass through, with the

exception of a specific range of frequencies. The amplitude frequency response

plots for these last two types are shown in Figures 11.3 and 11.4, respectively. In       Figure 11.3
complex systems, it is possible to combine several different types together in            Band-pass response.
order to achieve a desired overall response characteristic.

                                                                                       A

In each plot, there are three basic regions. The flat area where the input signal

is allowed to pass through is known as the pass band. The edge of the pass

band is denoted by the break frequency. The break frequency is usually defined

as the point at which the response has fallen 3 dB from its pass-band value.

Consequently, it is also referred to as the dB down frequency. It is important to

note that the break frequency is not} always equal to the natural critical                                     f

frequency, fc. The area where the input signal is fully suppressed is called the stop

band. The section between the pass band and the stop band is referred to as the

transition band. This is shown for the low-pass filter in Figure 11.5. Note that          Figure 11.4

plots 11.1 through 11.4 only define the general response of the filters. The actual       Notch response.

shape of the transition band for a given design will be refined in following           A

sections.

These response plots may be achieved through the use of simple RLC circuits.

For example, the simple lag network shown in Figure 11.6 may be classified as

a low-pass filter. You know from earlier work that lag networks attenuate high

frequencies. In a similar vein, a band-pass filter may be constructed as shown                                 f

436
in Figure 11.7. Note that at resonance, the tank circuit exhibits an impedance peak,     Figure 11.5
whereas the series combination exhibits its minimum impedance. Therefore, a large        Filter regions.
portion of Vin will appear at Vout. At very high or low frequencies the situation is
reversed (the parallel combination shows a low impedance, and the series
combination shows a high impedance), and very little of Vin appears at the output.
Note that no active components are used in this circuit. This is a passive filter.

                    A

pass               stop
band               band

       transition
       band

break              f

frequency

11.3 The Use and Advantages of Active Filters                                            Figure 11.6
                                                                                         Passive low-pass filter.
If filters may be made with only resistors, capacitors, and inductors, you might ask
why anyone would want to design a variation that required the use of an op amp.          Figure 11.7
This is a good question. Obviously, there must be certain shortcomings or                Passive band-pass filter.
difficulties associated with passive filter designs, or active filters would not exist.
Active filters offer many advantages over passive implementations. First of all,
active filters do not exhibit insertion loss. This means that the pass-band gain will
equal 0 dB. Passive filters always show some signal loss in the pass band. Active
filters may be made with pass-band gain, if desired. Active filters also allow for
interstage isolation and control of input and output impedances. This alleviates
problems with interstage loading and simplifies complex designs. It also produces
modest component sizes (e.g., capacitors tend to be smaller for a given response).
Another advantage of the active approach is that complex filters may be realized
without using inductors. This is desirable, as practical inductors tend to be far less
ideal than typical resistors and capacitors and are generally more expensive. The
bottom line is that the active approach allows for the rapid design of stable,
economical filters in a variety of applications.

Active filters are not perfect. First, by their very nature, active filters require
a DC power supply whereas passives do not. This is usually not a problem, as
the remainder of the circuit will probably require a DC supply anyway.
Active filters are also limited in their frequency range. An op amp has a
finite gain-bandwidth product, and the active filter produced can certainly

437
not be expected to perform beyond it. For example, it would be impossible to design
a filter that only passes frequencies above 10 MHz when using a standard A741.
Passive circuits do not have this limitation and can work well into the hundreds of
MHz. Finally, active filters are not designed to handle large amounts of power. They
are low signal-level circuits. With appropriate component ratings, passive filters
may handle hundreds of watts of input power. A classic example of this is the
crossover network found in most home loudspeaker systems. The crossover network
splits the music signal into two or more bands and routes the results to individual
transducers that are optimized to work within a given frequency range. Because the
input to the loudspeaker may be as high as a few hundred watts, a passive design is
in order.17 Consequently, we can say that active filters are appropriate for designs at
low to moderate frequencies (generally no more than 1 MHz with typical devices)
that do not have to handle large amounts of power. As you might guess, that
specification covers a great deal of territory, and therefore, active filters based on op
amps have become rather popular.

11.4 Filter Order and Poles

The rate at which a filter's response falls in the transition band is determined by the
filter's order. The higher the order of a filter, the faster its rolloff rate is. The order of
a filter is given as an integer value and is derived from the filter's transfer function.
As an example, all other factors being equal, a fourth-order filter will roll off twice
as fast as a second-order filter, and four times faster than a first-order unit. The order
of a filter also indicates the minimum number of reactive components that the filter
will require. For example, a third-order filter requires at least three reactive
components: one capacitor and two inductors, two capacitors and one inductor, or in
the case of an active filter, three capacitors. Related to this is the number of poles
that a filter utilizes. It is common to hear descriptions such as "a four-pole filter".
For most general-purpose high- or low-pass filters, the terms pole and order may be
used interchangeably and completely describe the rolloff rate. For more complex
filters this isn't quite the case, and you may also hear descriptions such as "a six-
pole, two-zero filter". Because this chapter is an introduction to filters, we will not
detail the operation of these more esoteric types. Suffice it to say that when a circuit
is described as an Nth-order filter, you may assume that it is an N-pole filter, as well.

A general observation can be given that the rolloff rate of a filter will eventually
approach 6 dB per octave per pole (20 dB per decade per pole). Therefore, a third-
order filter (i.e., three-pole) eventually rolls off at a rate of 18 dB per octave (60 dB
per decade). We say "eventually" because the response around the break frequency
may be somewhat faster or slower than this value. Figure 11.8 compares the effect
of order on four otherwise identical low-pass filters. Note that the higher order filters

17 In more advanced playback systems, active filters can be used. Examples include
    recording studio monitors and public address systems. We'll take a look at just how this is
    done in one of the upcoming examples.

438
offer greater attenuation at any frequency beyond the break point. As with most
response plots, Figure 11.8 utilizes decibel instead of ordinary gain. Also, these
filters are shown with unity gain in the pass band, although this doesn't have to be
the case. High-order filters are used when the transition band needs to be as narrow
as possible. It is not uncommon to see twelfth-order and higher filters used in special
applications. As you might guess, higher order filters are more complex and costly
to design and build. For many typical applications, orders in the range of two to six
are common.

                           Butterworth Response

                0.01  0.1  1                  10    100           1,000                  Figure 11.8
                                                                                         Effect of order on low-pass
                0                                                 0                      filters.

                -20 first order -20

Amplitude (dB)  -40                                                    -40
                                                                       -60
                                                    second order       -80
                                                                       -100
                -60                                               1,000.0

                                fourth order

                -80                                 third order

                -100  0.1  1.0                      100.0
                0.01                          10.0
                           Normalized frequency

11.5 Filter Class or Alignment

Besides order, the shape of the transition band is determined by a filter's class, or
alignment. These terms are synonymous and reflect the filter's damping factor.
Damping factor is the reciprocal of Q, the quality factor. You should be familiar
with Q from earlier work with inductors and resonant circuits. The symbol for
damping factor is alpha, . Alignment plays a key role in determining the shape of
the transition region and, in some cases, the pass-band or stop-band shape also.
There are a great number of possible filter alignments. We will look at a few of the
more popular types. A graph comparing the relative responses of the major types is
shown in Figure 11.9. For simplicity, only second-order types are shown. Figure
11.9a shows filters with the same critical frequency and identical DC gains. In
Figure 11.9b the responses have been adjusted for a peak gain of 0 dB and identical
break frequencies (f3dB).

439
                               Second Order Response

                   0.01  0.1                1               10       100
                 10                                                     10
                                               3 dB Chebyshev
                  0                            2 dB Chebyshev                  Figure 11.9a
                -10                            1 dB Chebyshev                  A comparison of the major
                -20                                                            filter alignments: second
Amplitude (dB)  -30            Butterworth                             0 order response.
                -40            Bessel
                                                                       -10
                   0.01  0.10            1.00               10.00
                   0.01        Normalized frequency                    -20
                 10
                  0      Second Order Response (adjusted)              -30
                -10
                -20      0.1                1               10         -40
                -30                                                100.00
Amplitude (dB)  -40                            Bessel
                   0.01                        Butterworth           100
                                                                        10
                               1 dB Chebyshev
                               2 dB Chebyshev                                  Figure 11.9b
                               3 dB Chebyshev                                  A comparison of the major
                                                                               filter alignments: second
                         0.10            1.00               10.00      0 order response (adjusted).
                               Normalized frequency
                                                                        -10

                                                                        -20

                                                                        -30

                                                                        -40
                                                                   100.00

440
Butterworth

Perhaps the most popular alignment type is the Butterworth. The Butterworth is
characterized by its moderate amplitude and phase response. It exhibits the fastest
rolloff of any monotonic (i.e., single slope or smooth) filter. In the time-domain,
moderate ringing on pulses may be observed. This is also the only filter whose 3 dB
down frequency equals its critical frequency (f3dB = fc). The Butterworth makes an
excellent general-purpose filter and is widely used.

Bessel

Like the Butterworth, the Bessel is also monotonic, so it shows a smooth pass-band
response. The transition region is somewhat elongated though, and the initial rolloff
is less than 6 dB per octave per pole. The Bessel does exhibit a linear phase response
that produces little ringing in the time domain. It is therefore a good choice for
filtering pulses when the overall shape of the pulse must remain coherent (i.e.,
smooth and undistorted in time).

Chebyshev

The Chebyshev is actually a class of filters all its own. They are based on
Chebyshev polynomials. There are many possible variations on this theme. In
general, the Chebyshev exhibits initial rolloff rates in excess of 6 dB per octave per
pole. This extra-fast transition is paid for in two ways: first, the phase response tends
to be rather poor, resulting in a great deal of ringing when filtering pulses or other
fast transients. The second effect is that the Chebyshev is non-monotonic. The pass-
band response is not smooth; instead, ripples may be noticed. In fact, the height of
the ripples defines a particular Chebyshev response. It is possible to design an
infinite number of variations from less than 0.1 dB ripple to more than 3 dB ripple.
Generally, the more ripple you can tolerate, the greater the rolloff will be, and the
worse the phase response will be. The choice is obviously one of compromise. The
basic differences between the various Chebyshev types are characterized in Figure
11.10. Figure 11.10a compares two different low-pass Chebyshev filters of the same
order. Note that only the height of the ripples is different. Figure 11.10b compares
equal ripple Chebyshevs, but of different orders. Note that the higher-order filter
exhibits a greater number of ripples. Also, note that even-order Chebyshevs exhibit a
dip at DC whereas odd-order units show a crest at DC. The number of ripples in the
passband is equal to the order of the filter divided by 2. When compared to the
Butterworth and Bessel alignments in Figure 11.9, it is apparent that heavy damping
produces the smoothest curves. The final note on the Chebyshev concerns, of all
things, its spelling. You will often see "Chebyshev" spelled in a variety of ways,
including "Chebycheff" and "Tschebycheff". It merely depends on how the name of
the Russian mathematician is transliterated from Russian Cyrillic into English. The
spellings all refer to the same filter.

441
                            Chebyshev Ripple Variation

        0.01                0.1                            1                  10
     10                                                                         10
       5
       0                                                                                Figure 11.10a
      -5                                                                                Variation of Chebyshev
    -10                                                                        5 ripple parameter.
    -15
    -20     Amplitude (dB)                                                                                   0

        0.01                1 dB ripple
                            3 dB ripple -5
        0.01
     10                                                                                                       -10
       5                          Slope approaches
       0
      -5                           6N dB/octave
    -10                              (N = order)
    -15
    -20                                                                                                       -15
    -25
    -30                     0.10                           1.00                   -20
    -35                           Normalized frequency                        10.00
    -40
                            Chebyshev Order Variation
        0.01
                            0.1                            1                   10
442                                                                               10
                                                                                  5                                Figure 11.10b
                                                                                  0                                Variation of Chebyshev
                                                                                  -5                               order parameter.
                                                                                  -10
            Amplitude (dB)                                       third order      -15
                                                                                  -20
                                              sixth order                         -25
                                                                                  -30
                                  number of                                       -35
                                  passband ripples                                -40
                                  = order / 2
                                                                              10.00
                            0.10                           1.00
                                  Normalized frequency
Elliptic                                                                                   Figure 11.11
                                                                                           Elliptic response.
The elliptic is also known as the Cauer alignment. It is a somewhat more advanced
filter. It achieves very fast initial rolloff rates. Unlike the other alignments noted  A
above, the elliptic does not "roll off forever". After its initial transition, the
response rises back up, exhibiting ripples in the stop band. A typical response is
shown in Figure 11.11. The design of elliptics is an advanced topic and will not be
considered further. It should be noted, though, that they are popular in analog-to-
digital conversion systems that require very narrow transition bands.

Other Possibilities

                                                                                                                                                                                   f

In order to optimize the time-domain and frequency-domain characteristics for
specific applications, a number of other alignments may be used. These include such
alignments as Paynter and Linkwitz-Reilly and are often treated as being midway
between Bessel and Butterworth, or Butterworth and Chebyshev.

11.6 Realizing Practical Filters

Usually, filter design starts with a few basic, desired parameters. This usually
includes the break frequency, the amount of ripple that may be tolerated in the pass
band (if any), and desired attenuation levels at specific points in the transition and
stop bands. Phase response and associated time delays may also be specified. If
phase response is paramount, the Bessel is normally chosen. Likewise, if pass-band
ripple cannot be allowed, Chebyshevs are not considered. With the use of
comparative curves such as those found in Figures 11.8 through 11.10, the filter
order and alignment may be determined from the required attenuation values. At this
point, the filter performance will be fully specified, for example, a 1 kHz, low-pass,
third-order Butterworth. There are many ways in which this specification may be
realized.

Sallen and Key VCVS Filters

There are many possible ways to create an active filter. Perhaps the most popular
forms for realizing active high- and low-pass filters are the Sallen and Key Voltage-
Controlled Voltage Source models. As the name implies, the Sallen and Key forms
are based on a VCVS; in other words, they use series-parallel negative feedback. A
general circuit for these models is shown in Figure 11.12. This circuit is a two-pole
(second-order) section and can be configured for either high- or low-pass filtering.
For our purposes, the amplifier block will utilize an op amp, although a discrete
amplifier is possible. Besides the amplifier, there are four general impedances in the
circuit. Usually, each element is a single resistor or capacitor. As we will see, the
selection of the component type will determine the type of filter.

443
         i3                               Z3                                               Figure 11.12

     i1                                                                                    General VCVS 2-pole filter

                                          Y           Vout                                 section.

     Z1 X Z2 A
     Vin i 2
                                          Z4      i2

At this point, we need to derive the general transfer equation for the circuit. Once the
general equation is established, we will be able to refine the circuit for special cases.
Being a higher-order active circuit, this procedure will naturally be somewhat more
involved than the derivations found in Chapter One for the simple first-order lead
and lag networks. The concepts are consistent though. This derivation utilizes a
nodal analysis. In order to make the analysis a bit more convenient, it will help if we
declare the voltage Vy as 1 V. This will save us from carrying an input voltage factor
through our calculations, which would need to be factored out of the general
equation anyway. By inspection we note the following:

         V out= AV y= A                               (11.1)
                                                      (11.2)
         i1 = V i n-V x                               (11.3)
                  Z1

         i2 = 1
               Z4

         i3 = V out-V x = A-V x
                   Z3                 Z3

         V x = i2 Z 2+V y = i2 Z 2+1

By the substituting Equation 11.2 into Equation 11.3, Vx may be expressed as

         V x= Z2 +1
               Z4

We now sum the currents according to the figure,

         i 2=i 1 +i 3

substitute our current equivalences,

         1 = V i n-V x +A-V x
         Z4        Z1                 Z3

444
and solve the equation in terms of Vin :

     V i n-V x = 1 -A-V x
     Z1                                   Z4 Z3

     V i n-V x = Z 1 -Z1 ( A-V x)
                                          Z4     Z3

     V i n = Z 1 -Z1 ( A-V x) +V x
                                          Z4     Z3

                                          Z 1 Z1 ( A-V x) Z 2
     V in =                                   -          + +1
                                          Z4     Z3      Z4

                                          ( ) Z1 Z1  Z2        Z2
     V i n = - A- -1 + +1
                                          Z4 Z3      Z4        Z4

                Z1 Z1 Z1 Z2 Z1 Z2
     V i n = - A+ + + +1

                Z4 Z3 Z3Z4 Z3 Z4

     V i n = Z 1 +Z 1 (1- A)+Z 1 Z2 +Z 2 +1                        (11.4)
         Z4 Z3                                   Z3 Z4 Z4

We can now write our general transfer equation using Equations 11.1 and 11.4.

     V out = A                                                     (11.5)
     V i n Z1 +Z1 (1- A)+Z 1 Z 2 +Z 2 +1
         Z4 Z3                                   Z3Z4 Z4

Equation 11.5 is applicable to any variation on Figure 11.12 that we wish to make.
All we need to do is substitute the appropriate circuit elements for Z1 through Z4. As
you might guess, direct substitution of resistance and reactance values would make
for considerable work. In order to alleviate this difficulty, designers rely on the
Laplace transform technique. This is also known as the s domain technique. A
detailed analysis of the Laplace transform is beyond the scope of this text, but some
familiarity will prove helpful. The basic idea is to replace complex terms with
simpler ones. This is performed by setting the variable s equal to j. As you will
see, this substitution leads to far simpler and more generalized circuit derivations
and equations. A capacitive reactance may be reduced as follows.

     Capacitive Reactance =- j X C
     Capacitive Reactance = - j

                                   C
     Capacitive Reactance = 1 j  C
     Capacitive Reactance = 1s C

445
Therefore, whenever a capacitive reactance is needed, the expression 1/ sC is used.
Equations can then be manipulated using basic algebra.

Sallen and Key Low-Pass Filters

Let's derive a general expression based on Equation 11.5 for low-pass filters. A low-
pass filter is a lag network, so to echo this, we will use resistors for the first two
elements and capacitors for the third and forth. Using the s operator we find, Z1 = R1,
Z2 = R2, Z3 = 1/ sC1, and Z4 = 1/ sC2.

              V out = A
              V i n Z 1 +Z 1 (1- A)+Z1 Z 2 +Z 2 +1
                   Z4 Z3         Z3 Z4 Z4
              V out = 2 A
              V i n s R1 C 2+s R1 C 1(1- A)+s R1 R2 C 1 C2+s R2C 2+1

              V out = 2 A
              Vin  s R1 R2C 1 C 2+s (R1C 2+R2 C2+R1C1 (1- A))+1

The highest power of s in the denominator determines the number of poles in the
filter. Because this is a 2 here, the filter must be a 2 pole-type (second-order), as
expected. Usually, it is most convenient if the denominator coefficient for s2 is unity.
This makes the equation easier to factor.

     V out =              A/ R1 R2 C1 C2             (11.6)

     V i n s2 +s( 1 + 1 + 1 (1- A))+ 1
                   R2 C 1 R 1C 1 R2 C2     R1R2C1C2

Second-order systems appear in a variety of areas including mechanical, acoustical,
hydraulic, and electrical. They have been widely studied, and a generalized form of
one group of second-order responses is given by

                   G= 2   A2                         (11.7)

                   s +  s+       2

where A is the gain of the system,  is the resonant frequency in radians, and  is the
damping factor.

By comparing the general form of Equation 11.7 to the low-pass filter Equation
11.6, we find that

                    2 = 1                            (11.8)
                           R1 R2 C1 C 2              (11.9)

                     = 1 + 1 + 1 (1-A)
                           R2 C 1 R1C 1 R2 C 2

446
Based on the general expression of Equation 11.7, we can derive equations for the
gain magnitude versus frequency and phase versus frequency, as we did in Chapter
One for the first-order systems. For most filter work, it is convenient to work with
normalized frequency instead of a true frequency. This means that the critical
frequency will be set to 1 radian per second, and a generalized equation developed.
For circuits using other critical frequencies, the general equation is used and its
results are simply scaled by a factor equal to this new frequency. The normalized
version of Equation 11.7 is

     G= 2 A                             (11.10)
           s + s+1

In order to determine the gain and phase expressions, Equation 11.10 must be split
into its real and imaginary components. The first step is to replace s with its
equivalent, j, and then group the real and imaginary components.

     G= 2 A
           ( j ) +j  +1

     G = -2 A +j  +1
     G = (1-2A)+j  

To split this into separate real and imaginary components, we must multiply the
numerator and denominator by the complex conjugate of the denominator,
(1-2) - j.

     G = 2A              (1-2)- j  

                                     2
         (1- )+j   (1- )- j  

     G=  A((1-2)- j  )

         22 2 2
         (1- ) + 

     G=  A (1- 2)        A              (11.11)
            2 2 2 2 -j
                          22 2 2
         (1- ) +  (1- ) + 

For the gain magnitude, recall that Mag = (real2 + imaginary2). Applying Equation
11.11 to this relation yields

447
     ( ) ( ) Mag =          2
            A (1 - 2 )           A 2
                             +-
            (1-2)2+2 2            22 2 2
                                 (1- ) + 

     Mag =  A2 (1-2)2 +          A2 2 2

                                    2 2 2 22
            ((1-2)2+2 2)2 ((1- ) +  )

     Mag =   A2((1-2)2+2 2)

            ((1- ) +  )  2
            22 2 2

     Mag =  A(1-2)2+2 2

            22 2 2
            (1- ) + 

     Mag =  A

            22 2 2
            (1- ) + 
     Mag =1+2(2-2)+4 A
                                              (11.12)

For the phase response, recall that  = tan-1(imaginary / real). Applying Equation
11.11 to this relation yields

                  - 2 2 2 2 A                 (11.13)
      = arctan 2 (1- ) + 

                       A(1- )
                   (1-2)2+2 2
      = arctan A(1-2 -A  )
      =-arctan   1-2

To use Equations 11.12 and 11.13 with a particular alignment, substitute the
appropriate damping value and simplify. Derivation of specific damping factors is
beyond the scope of this chapter, but can be found in texts specializing on filter
design. For our purposes, tables of damping factors for specific alignments will be
presented. As one possible example, the damping factor for a second-order
Butterworth alignment is 2. Substituting this into Equation 11.12 produces

     Mag = 1+2 (2-2)+4 A

     Mag = 2 2 A 4

           1+ ((2) -2)+

     Mag = 1+4 A

There are a large number of ways of configuring a low-pass filter given the above
equations. So that we might put some consistency into what appears to be a chaotic
mess, we'll look at two distinct and useful variations. They are the equal component
realization and the unity gain realization.

448
The equal-component version

Here, we will set R1 = R2 and C1 = C2. To keep the resulting equation generic, we
will use a normalized frequency of 1 radian per second. For other tuning frequencies,
we will just scale our results to the desired value. From Equation 11.8, if  = 1, then
R1R2C1C2 = 1, and the most straightforward solution would be to set R1 = R2= C1 = C2
= 1 (units of ohms and farads). Equation 11.6 simplifies to

                                V out V = i n s 2 A +s (1+1+1(1 - A))+1
Note the damping factor is now given by

                                 =1+1+1( 1- A )
                                 =3- A
We see that the gain and damping of the filter are linked together. Indeed, for a
certain damping factor, only one specific gain will work properly:
                                A=3-
As the gain of a noninverting amplifier is
                                A=1+R f

                                         Ri
we may find the required value for Rf by combining these two equations:

                                R f =2-
The finished prototype is shown in Figure 11.13.

                                                                                                                     Figure 11.13
                                                                                                                     Low-pass equal-component
                                                                                                                     VCVS.

449
The unity-gain version

Here we will set A = 1, and R1 = R2. From Equation 11.8, if  = 1, then R1R2C1C2 =
1, and therefore C1 = 1/C2. In effect, the ratio of the capacitors will set the damping
factor for the system. Equation 11.6 may be simplified to

                                V out = A
                                V i n s 2+s ( 1 + 1 )+1

                                               C1 C1
The damping factor is now given by

                                = 1 + 1
                                    C1 C1

                                = 2 or,
                                     C1
                                     2

                                C1= 
Because C1 = 1/C2, we find

                                C2= 2
The finished prototype is shown in Figure 11.14.

                                                                                                                     Figure 11.14
                                                                                                                     Low-pass unity gain VCVS.

As you can see, there is quite a bit of similarity between the two versions. It is
important to note that the inputs to these circuits must return to ground via a low-
impedance DC path. If the signal source is capacitively coupled, the op amp's input
bias current cannot be set up properly, and thus, some form of DC return resistor
must be used at the source. Also, you can see that the damping factor (i.e.,
alignment) of the filter plays a role in setting component values. If the values shown
are taken as having units of ohms and farads, the critical frequency will be 1 radian
per second. It is an accepted practice to normalize the basic forms of circuits such as

450
these, so that the critical frequency works out to this convenient value. This makes it
very easy to scale the component values to fit your desired critical frequency.
Because the critical frequency is inversely proportional to the tuning resistor and
capacitor values, you only need to shrink R or C in order to increase fc. (Remember,
fc = 1/(2RC) ). A second scaling step normally follows this, in order to create
practical values for R and C. This procedure is best shown with an example.

Example 11.1

         Design a 1 kHz low-pass, second-order Butterworth filter. Examine both the
         equal-component and the unity-gain forms as drawn in Figure 11.13 and
         11.14, respectively. The required damping factor is 1.414.

         Let's start with the equal-component version. First, find the required value
         for Rf from the damping factor, as given on the diagram.

                                          R f =2 -
                                          R f =2 -1.414
                                          R f =0.586

         Note that this will produce a pass-band gain of

                                          Av=1+ R f
                                                   Ri

                                          Av =1 +0.586 1
                                          Av =1.586

                                                                                                                     Figure 11.15
                                                                                                                     Initial damping calculation for
                                                                                                                     Example 11.1
                                                                                                                     (equal-component version).

         Figure 11.15 shows the second-order Butterworth low-pass filter. Its critical
         frequency is 1 radian per second. We need to scale this to 1 kHz.

                                         c=2  f c
                                         c=2  1 kHz
                                         c=6283 radians per second

451
         Our desired critical frequency is 6283 times higher than the normalized
         base. As c = 1/RC, to translate the frequency up, all we need to do is divide
         R or C by 6283. It doesn't really matter which one you choose, although it is
         generally easier to find "odd" sizes for resistors than capacitors, so we'll use
         R.

                                          R= 1 6283
                                          R=1.59×10- 4 

                                                                                                                     Figure 11.16
                                                                                                                     The filter for Example 11.1
                                                                                                                     after frequency scaling
                                                                                                                     (equal component version).

         Figure 11.16 shows our 1 kHz, low-pass, second-order Butterworth filter. As
         you can see, though, the component values are not very practical. It is
         therefore necessary to perform the final scaling operations. First, consider
         multiplying Rf and Ri by 10 k. Note that this will have no effect on the
         damping, as it is the ratio of these two elements that determines damping.
         This scaling will not affect the critical frequency either, as fc is set by the
         tuning resistors and capacitors. Second, we need to increase R to a
         reasonable value. A factor of 107 will place it at 1.59 k. In order to
         compensate, the tuning capacitors must be dropped by an equal amount,
         which brings them to 100 nF. The completed design is shown in Figure
         11.17. Other scaling factors could also be used. Also, if bias compensation is
         important, the Ri and Rf values will need to be scaled further, in order to
         balance the resistance seen at the noninverting input.

                                                                                                                     Figure 11.17
                                                                                                                     Final impedance scaling for
                                                                                                                     Example 11.1
                                                                                                                     (equal component version).

452
         The approach for the unity-gain version is similar. First, adjust the capacitor
         values in order to achieve the desired damping, as specified in Figure 11.14.

                                                2
                                         C1=
                                         C1= 2 1.414
                                         C1=1.414 F
                                         C2= 

                                                2
                                         C 2 = 1.414 2
                                         C2=0.707 F
         The resulting circuit is shown in Figure 11.18. The circuit must be scaled to
         the desired fc. The factor is 6283 once again, and the result is shown in
         Figure 11.19. The final component scaling is seen in Figure 11.20.

                                                                                                                     Figure 11.18
                                                                                                                     Initial damping calculation for
                                                                                                                     Example 11.1
                                                                                                                     (unity-gain version).

                                                                                                                     Figure 11.19
                                                                                                                     The filter for Example 11.1
                                                                                                                     after frequency scaling
                                                                                                                     (unity-gain version).

453
                                                                                                                     Figure 11.20
                                                                                                                     Final impedance scaling for
                                                                                                                     Example 11.1
                                                                                                                     (unity gain version).

Computer Simulation

A Multisim simulation of the filter design of Example 11.1 is shown in Figure 11.21.
The analysis shows the Bode plot, ranging from 50 Hz to better than 20 kHz. This
yields over one decade on either side of the 1 kHz critical frequency. The graph
clearly shows the -3 dB point at approximately 1 kHz, with an attenuation slope of
-12 dB per octave. Since this is the unity-gain version, the low-frequency gain is set
at 0 dB. Also, note that no peaking is evident in the response curve, as is expected
for a Butterworth alignment. The phase response is also shown. Some graphing tools
continue the phase shift below -180 degrees, whereas others will flip it back to
+180, as Multisim does. Note that if the frequency plot range is extended, the phase
shift starts to increase at the highest frequencies instead of leveling off. This is due
to the extra phase shift produced by the op amp as the operating frequency
approaches funity. A simpler op amp model would not create this real-world effect.

                                                                                                                     Figure 11.21a
                                                                                                                     VCVS low-pass filter in
                                                                                                                     Multisim.

454
                                                                                     Figure 11.21b
                                                                                     Gain and phase plots for VCVS
                                                                                     low-pass filter.

Finally, a Monte Carlo analysis is used to mimic the effects seen due to component
tolerance in a production environment (in this example, approximately 10 percent
variation of nominal for each component). A total of 10 runs were generated.
Although the overall shape of the curve remains consistent, there is some variation
in the corner frequency, certainly more than the 10 percent offered by any single
component. As you might guess, a Monte Carlo analysis is very tedious to do by
hand, but quite straightforward to set up on a simulator.

                                                                                     Figure 11.21c
                                                                                     Monte Carlo analysis for VCVS
                                                                                     low-pass filter.

455
As you can see, the realization process is little more than a scaling sequence. This
makes filter design very rapid. The operation for high-pass filters is essentially the
same.

Sallen and Key High-Pass Filters

We can derive a general expression for high-pass filters, based on Equation 11.5. A
high-pass filter is a lead network, so to echo this, we will use capacitors for the first
two elements and resistors for the third and forth. Using the s operator, we find,
Z1 = 1/sC1, Z2 = 1/sC2, Z3 = R1, and Z4 = R2.

     V out = A
     V i n Z 1 +Z 1 (1-A)+Z 1 Z 2 +Z 2 +1
     Z4 Z3                        Z3Z4 Z4
     V out = A
     V i n 1 + 1 (1-A)+ 2 1 + 1 +1
     s R2 C 1 s R1 C1             s R1 R2 C 1 C 2 s R2 C 2

     V out = A s2                                           (11.14)
     V i n s2+s( 1 + 1 + 1 (1-A))+ 1
                         R2 C1 R2C 2 R1 C 1  R1 R2 C1 C 2

As with the low-pass filters we have two basic realizations: equal-component and
unity-gain. In both cases, we start with Equation 11.14 and use normalized
frequency (1 radian per second). The derivations are very similar to the low-pass
case, and the results are summarized below.

The equal-component version:

                         =3 -A

The unity-gain version:

                               2
                         R2= 
                         R1= 

                               2

These forms are shown in Figures 11.22 and 11.23. You may at this point ask two
questions: One, how do you find the damping factor, and two, what about higher-
order filters?

In order to find the damping factor needed, a chart such as Figure 11.24 may be
consulted. This chart also introduces a new item, and that is the frequency factor, kf.
Normally, the critical frequency and 3 dB down frequency (break frequency) of a
filter are not the same value. They are identical only for the Butterworth alignment.

456
For any other alignment, the desired break frequency must first be translated to the
appropriate critical frequency before scaling is performed. This is illustrated in the
following example.

                                                                                                                     Figure 11.22
                                                                                                                     High-pass unity-gain VCVS.

                                          Figure 11.23
                                          High-pass equal-component
                                          VCVS.

     Second-Order Filter Parameters       Figure 11.24
                                          Second-order filter parameters.
     Type                          kf
                                          From Lancaster, Don, Active Filter
     Bessel       1.732            1.274  Cookbook, Second edition,
                                          Newnes1996. Reprinted with
     Butterworth  1.414            1.0    permission

     1 dB Chebyshev 1.045          0.863

     2 dB Chebyshev 0.895          0.852

     3 dB Chebyshev 0.767          0.841

     fc= f3 dB / kf for high-pass
     fc= f3 dB · kf for low-pass

457
Example 11.2

     Design a second-order, high-pass Bessel filter, with a break frequency         Figure 11.25
     (f3dB) of 5 kHz.                                                               Initial damping calculation
                                                                                    for Example 11.2.
     For this example, let's use the unity-gain form shown in Figure 11.22. First,
     obtain the damping and frequency factors from Figure 11.24.

     kf = 1.274, damping = 1.732.

     Using the damping factor, the two tuning resistors may be found:

                                     R1= 
                                           2

                                     R1 = 1.732 2
                                     R1=.866 

                                           2
                                     R2= 
                                     R2= 2 1.732
                                     R2=1.155 

     The intermediate result is shown in Figure 11.25. In order to do the
     frequency scaling, the desired break frequency of 5 kHz must first be
     translated into the required critical frequency. Because this is a high-pass
     filter,

                                     f c= f 3dB
                                            kf

                                     f c=5 kHz 1.274
                                     f c=3925 Hz

                                     c=2  f c
                                     c=2  3925
                                     c=24.66 k radians per second

     Either the tuning resistors or capacitors may now be scaled.

                                     R1= .866 24.66 k
                                     R1=3.51×10-5

458
                                          R2= 1.155 24.66 k

                                                                                                 -5

                                          R2=4.68×10 
         We now have a second-order, high-pass, 5 kHz Bessel filter. This is shown
         in Figure 11.26. A final scaling of 108 will give us reasonable values, and is
         shown in Figure 11.27.

                                                                                                                     Figure 11.26
                                                                                                                     Frequency scaling for
                                                                                                                     Example 11.2.

                                                                                                                     Figure 11.27
                                                                                                                     Impedance scaling for
                                                                                                                     Example 11.2.

Filters of Higher Order

There is a common misconception among novice filter designers that higher-order
filters may be produced by cascading a number of lower-order filters of the same
type. This is not true. For example, cascading three second-order 10 kHz
Butterworth filters will not} produce a sixth-order 10 kHz Butterworth filter. A
quick inspection reveals why this is not the case: A single filter of any order will
show a 3 dB loss at its break frequency by definition (in this case, 10 kHz). If three
filters of the same type are cascaded, each filter will produce a 3 dB loss at the break
frequency, which means an overall loss of 9 dB occurs. This much is true: a higher
order filter will require a number of individual sections, each with specific damping
and frequency factors. Each section will be based on the second-order forms already
459
examined.18 In order to make odd-ordered filters, we will introduce a simple single-
pole filter. The high- and low-pass versions of this unit are shown in Figure 11.28.
The damping factor for this circuit is always unity. When working with it, you need
only worry about the frequency factor.

                                                                                                                     Figure 11.28
                                                                                                                     Single-pole sections.

Designing higher-order filters is, conceptually, no different than designing second-
order filters. The reality is that new charts are needed for the required damping and
frequency factors. A set of compatible charts is shown in Figure 11.29 for orders 3
through 6 on the following pages. An example is then presented to show the design
sequence flow.

18 The transfer function of a higher-order filter contains a high-order polynomial in the
    denominator of the form sn+bn-1 sn-1+...+b1 s+b0 . The n indicates the order of the
    filter and the b coefficients determine the alignment. This polynomial is factored into a
    product of second-order expressions (with a possible first-order unit for odd-ordered
    systems). Each of these expressions corresponds to a single section in the larger filter.

460
                                   Third-Order Filter Parameters

                Second-order section  First-order section                 Figure 11.29a
                                                                          Filter design tools
Type                          kf             kf                           Parameters for third- through
Bessel                                                                    sixth-order filters.
Butterworth     1.447         1.454          1.328
1 dB Chebyshev                                                            From Lancaster, Don, Active Filter
2 dB Chebyshev  1.0           1.0            1.0                          Cookbook, Second edition,
3 dB Chebyshev                                                            Newnes1996. Reprinted with
                0.496         0.911          0.452                        permission

                0.402         0.913          0.322

                0.326         0.916          0.3

                              Fourth-Order Filter Parameters

                Second-order section  Second-order section

Type                          kf                                   kf
Bessel
Butterworth     1.916         1.436   1.241                        1.610
1 dB Chebyshev
2 dB Chebyshev  1.848         1.0     0.765                        1.0
3 dB Chebyshev
                1.275         0.502   0.281                        0.943

                1.088         0.466   0.224                        0.946

                0.929         0.443   0.179                        0.950

                                   Fifth-Order Filter Parameters

                Second-order section  Second-order section                First-order section
                                                                                   kf
Type                          kf                                   kf
Bessel                                                                            1.557
Butterworth     1.775         1.613   1.091                        1.819          1.0
1 dB Chebyshev                                                                    0.280
2 dB Chebyshev  1.618         1.0     0.618                        1.0            0.223
3 dB Chebyshev                                                                    0.178
                0.714         0.634   0.180                        0.961
Type
Bessel          0.578         0.624   0.142                        0.964
Butterworth
1 dB Chebyshev  0.468         0.614   0.113                        0.967
2 dB Chebyshev
3 dB Chebyshev                     Sixth-Order Filter Parameters

                Second-order section  Second-order section                Second-order section

                              kf                                   kf             kf

                1.959         1.609   1.636                        1.694  0.977   1.910

                1.932         1.0     1.414                        1.0    0.518   1.0

                1.314         0.347   0.455                        0.733  0.125   0.977

                1.121         0.321   0.363                        0.727  0.0989  0.976

                0.958         0.298   0.289                        0.722  0.0782  0.975

fc= f3 dB / kf for high-pass          fc= f3 dB · kf for low-pass

461
                         Third Order Response (adjusted)

                   0.01  0.1         1                        10                 100
                 10
Amplitude (dB)                                 Bessel                              10 Figure 11.29b
                  0                            Butterworth                              Filter design tools, continued
                -10
                -20            1 dB Chebyshev                                     0 Third-order response
                -30            3 dB Chebyshev                                           (adjusted).
                -40
                -50      0.10                  1.00           10.00                 -10
                -60                  Normalized frequency
                                                                                    -20
                   0.01
                                                                                    -30
                   0.01
                 10                                                                 -40

                  0                                                                 -50
                -10
                -20                                                                 -60
                -30                                                            100.00
                -40
                -50      Fourth Order Response (adjusted)
                -60
                               0.1                         1                    10
                   0.01
                                                                  Bessel          10 Figure 11.29c
                                                                  Butterworth          Filter design tools, continued

Amplitude (dB)                       1 dB Chebyshev                               0 Fourth-order response
                                     3 dB Chebyshev                                    (adjusted).

                               0.10                  1.00                          -10
                                     Normalized frequency
                                                                                   -20

                                                                                   -30

                                                                                   -40

                                                                                   -50

                                                                                   -60
                                                                               10.00

462
                            Fifth Order Response (adjusted)

        0.01                0.1                         1                 10
      10                                                                    10
                                                             Bessel
        0                                                    Butterworth           Figure 11.29d
     -10                                                                           Filter design tools, continued
     -20    Amplitude (dB)        1 dB Chebyshev                           0 Fifth-order response
     -30                          3 dB Chebyshev                                   (adjusted).
     -40
     -50                                                                    -10
     -60
                                                                            -20
        0.01
                                                                          -30
        0.01
      10                                                                  -40

        0                                                                 -50
     -10
     -20                    0.10                  1.00                        -60
     -30                          Normalized frequency                    10.00
     -40
     -50                    Sixth Order Response (adjusted)
     -60
                            0.1                         1                 10
        0.01
                                                             Bessel        10 Figure 11.29e
463                                                          Butterworth           Filter design tools, continued

            Amplitude (dB)        1 dB Chebyshev                           0 Sixth-order response
                                  3 dB Chebyshev                                   (adjusted).

                                                                            -10

                                                                            -20

                                                                          -30

                                                                          -40

                                                                          -50

                            0.10                  1.00                        -60
                                  Normalized frequency                    10.00
Example 11.3

We wish to design a filter suitable for removing subsonic tones from a stereo
system. This could be used to reduce turntable rumble in a vintage hi-fi or
DJ system, or to reduce stage vibration in a public address system. The filter
should attenuate frequencies below the lower limit of human hearing (about
20 Hz), while allowing all higher frequencies to pass. Transient response
may be important here, so we'll choose a Bessel alignment. We will also
specify a fifth-order system. This will create an attenuation of about 15 dB,
one octave below the break frequency.

First, note that the specification requires the use of a high-pass filter. This  Figure 11.30
filter may be realized with either the equal-component or the unity-gain         Circuit outline (Note: all
forms. As this design will require multiple sections, excessive gain may         values in ohms and farads).
result from the equal-component version. Our fifth-order system will be
comprised of two second-order sections and a first-order section. An
overview of the design is shown in Figure 11.30, with the appropriate
damping and frequency factors taken from Figure 11.29. We'll break the
analysis down stage by stage.

         First, find the desired break frequency in radians.
                                         3dB=2  f 3dB
                                         3dB=2  20 Hz
                                         3dB=125.7 radians per second

464
         Stage 1:
         The break frequency must be translated to the required critical frequency.
         Because this is a high-pass filter, we need to divide by the frequency factor.

                                         c =3dB
                                                kf

                                         c =125.7 1.557
                                         c=80.7 radians per second
         We will scale the resistor by 80.7 to achieve this tuning frequency.
                                          R= 1 80.7
                                          R=.0124 
         The R and C values must now be scaled for practical values. A factor of
         106 would be reasonable. The final result is
                                          R=12.4 k
                                         C=1 F
         Stage 2:
         First, determine the values for the two resistors from the given damping
         factor.
                                          R1= 2
                                          R1= 1.775 2
                                          R1=0.8875
                                          R2= 2
                                          R2= 2 1.775
                                          R2=1.127 

465
         Now the break frequency must be translated to the required critical
         frequency.

                                         c= 3dB
                                                 kf

                                         c= 125.7 1.613
                                         c=77.9 radians per second

         We will scale the resistors by 77.9 to achieve this tuning frequency.

                                          R1= 0.8875 77.9
                                          R1=0.0114 

                                          R2= 1.127 77.9
                                          R2=0.0145 

         Again, R and C must be scaled for practical values. A factor of 106 would be
         reasonable. The final result is

                                          R1=11.4 k
                                          R2=14.5 k
                                         C=1 F

         Stage 3:

         First, determine the values for the two resistors from the given damping
         factor.

                                          R1= 2
                                          R1= 1.091 2
                                          R1=0.5455

                                          R2= 2
                                          R2= 2 1.091
                                          R2=1.833 

466
     Now the break frequency must be translated to the required critical
     frequency.

     c= 3dB
             kf

     c= 125.7 1.819
     c= 69.1 radians per second

     We will scale the resistors by 69.1 to achieve this tuning frequency.

     R1= .5455 69.1

                               -3

     R1=7.89×10 

     R2= 1.833 69.1
     R2=0.0265 

     Again, R and C must be scaled for practical values. A factor of 106 would be
     reasonable. The final result is

     R1=7.89 k 
     R2=26.5 k 
     C=1 F

     The complete design is shown in Figure 11.31. Note that all of the capacitors  Figure 11.31
     are set at 1 F. This certainly helps to cut inventory and parts placement      Completed filter for
     costs.                                                                         Example 11.3.

467
We will complete our discussion of high- and low-pass VCVS filters with the
following example.

Example 11.4

As mentioned earlier, it is common for loudspeaker systems to rely on                             Figure 11.32
passive filters to create their crossover networks. More demanding                                Commercial electronic
applications such as recording studio monitoring or large public-address                          crossover.
systems (i.e., concert systems) cannot afford the losses associated with
passive crossovers.                                                                               Reprinted courtesy of Furman
                                                                                                  Sound, Inc.
Instead, these applications utilize active crossovers composed of active
filters, such as the one shown in Figure 11.32. Before the audio signal is fed
to a power amplifier, it is split into two or more frequency bands. The
resulting signals each feed their own power amplifier/loudspeaker section.

A block diagram of this approach is shown in Figure 11.33. This one is a
two-way system. Large concert sound reinforcement systems may break the
audio spectrum into four or five segments. The resulting system will be
undoubtedly expensive, but will show lower distortion and higher output
levels than a passively-crossed system. A typical two-way system might be
crossed at 800 Hz. In other words, frequencies above 800 Hz will be sent to
a specialized high frequency-transducer, whereas frequencies below 800 Hz
will be sent to a specialized low-frequency transducer. In essence, the
crossover network is a combination of an 800 Hz low-pass filter, and an 800
Hz high-pass filter. The filter order and alignment vary considerably
depending on the application. Let's design an 800 Hz crossover with second-
order Butterworth filters.

high-pass                                                                                         Figure 11.33
                                                                                                  Electronic crossover system.
           treble

low-pass   power amps

                                                                                            bass

468
         The basic circuit layout is shown in Figure 11.34. We're using the equal-
         component value version here. Exact gain is normally not a problem in this
         case, as some form of volume control needs to be added anyway, in order to
         compensate between the sensitivity of the low and high frequency
         transducers. (This is most easily produced by adding a simple voltage
         divider/potentiometer at the output of the filters.)

                                                                                                                     Figure 11.34
                                                                                                                     Basic filter sections for
                                                                                                                     crossover of Example 11.4.

         For second-order Butterworth filters, the damping factor is found to be
         1.414, and the frequency factor is unity (indicating that fc and f3dB are the
         same). Note that the design for both halves is almost the same. Both sections
         show an fc of 800 Hz, and a damping factor of 1.414. With identical
         characteristics, it follows that the component values will be the same in both
         circuits.
         The required value for Rf is

                                          R f =2 -
                                          R f =2 -1.414
                                          R f =0.586

469
     The critical frequency in radians is

                                     c=2  f c
                                     c=2  800 Hz
                                     c=5027 radians per second

     Again, we will scale the tuning resistors to yield

                                     R= 1 5027
                                     R=1.989×10-4 

     A final RC scaling by 108 produces

                                     R=19.9 k 
                                     C=10 nF

     Ri and Rf are scaled by 10 k, and 10 k log taper potentiometers may be
     used for the output volume trimmers. The resulting circuit is shown in
     Figure 11.35.

                                                                             Figure 11.35
                                                                             Completed crossover design
                                                                             for Example 11.4.

470
11.7 Band-Pass Filter Realizations

There are many ways to form a band-pass filter. Before we introduce a few of the
possibilities, we must define a number of important parameters. As in the case of the
high- and low-pass filters, the concept of damping is important. For historical
reasons, band-pass filters are normally specified with the parameter Q, the quality
factor, which is the reciprocal of the damping factor. Comparable to the break
frequency is the center, or peak, frequency of the filter. This is the point of
maximum gain. In RLC circuits, it is usually referred to as the resonance frequency.
The symbol for center frequency is fo. Because a band-pass filter produces
attenuation on either side of the center frequency, there are two "3 dB down"
frequencies. The lower frequency is normally given the name f1, and the upper is
given f2. The difference between f2 and f1 is called the bandwidth of the filter and is
abbreviated as BW. The ratio of center frequency to bandwidth is equal to the filter's
Q.

            BW = f 2 - f 1             (11.15)

            Q= f o                     (11.16)
                 BW

It is important to note that the center frequency is not equal to the arithmetic average
of f1 and f2. Instead, it is equal to the geometric average of f1 and f2.

            f o= f 1 f 2               (11.17)

These parameters are shown graphically in Figure 11.36. If a filter requires a fairly
low Q, say unity or less, the filter is best realized as a cascade of separate low- and
high-pass filters. For higher Qs, we will examine two possible realizations. Multiple-
feedback filters will be used for Q s up to about 10. For Q s above 10, the state-
variable filter is presented.

     0 dB                                                                                 Figure 11.36
     -3 dB                                                                                Band-pass response.

                     f1 f0 f2       f

471
Multiple-Feedback Filters

The basic multiple-feedback filter is a second-order type. It contains two reactive
elements as shown in Figure 11.37. One pair of elements creates the low-pass
response (R1C1), and the other pair creates the high-pass response (R2C2). Because of
this, the ultimate attenuation slopes are ±6 dB.

                                                                                                                 Figure 11.37
                                                                                                                 Multiple feedback band-pass
                                                                                                                 filter.

As with the VCVS high- and low-pass designs, the circuit of Figure 11.37 is
normalized to a 1 radian per second center frequency. Extrapolation to new center
frequencies is performed in the same manner as shown earlier. The peak gain for this
circuit is

                   Av=-2 Q2           (11.18)

You can see from Equation 11.18 that higher Q s will produce higher gains. For a Q
of 10, the voltage gain will be 200. For this circuit to function properly, the open-
loop gain of the op amp used must be greater than 200 at the chosen center
frequency. Usually, a safety factor of 10 is included in order to keep stability high
and distortion low. By combining these factors, we may determine the minimum
acceptable funity for the op amp.

                   f unity 10 f o Av  (11.19a)

or more directly,

                   f unity 20 f o Q2  (11.19b)

For a Q of 10 and a center frequency of 2 kHz, the op amp will need an funity of at
least 4 MHz. It is not possible to use this type of filter for high-frequency, high-Q
work, as standard op amps soon "run out of steam". This difficulty aside, the high
gains produced by even moderate values for Q may well be impractical. For many

472
applications, a unity gain version would be preferred. This is not particularly
difficult to achieve. All that we need to do is attenuate the input signal by a factor
equal to the voltage gain of the filter. Because the gain magnitude of the filter is 2Q2,
the attenuation should be

     Attenuation= 2 1               (11.20)
                      2Q

Although it is possible to place a pair of resistors in front of the filter to create a
voltage divider, there is a more efficient way. We can split R1 into two components,
as shown in Figure 11.38. As long as the Thevenin equivalent of R1a and R1b as seen
from the op amp equals the value of R1, the tuning frequency of the filter will not be
changed. Also required is that the voltage divider ratio produced by R1a and R1b
satisfies Equation 11.20.

                                                                                           Figure 11.38
                                                                                           Multiple feedback filter with
                                                                                           unity-gain variation.

First, let's determine the ratio of the two resistors. We can start by setting R1b to the
arbitrary value K. Using the voltage divider rule and Equation 11.20, R1a is found:

     Attenuation = R1b
                           R1a+R1b

     2 Q 2 1 =     K
                R1a+K

     R1a+K = K 2 Q2

     R1a = K (2 Q 2-1)              (11.21)

So, we see that R1a must be 2Q2-1 times larger than R1b. Now we must determine the
value of K which will set the parallel combination of R1a and R1b to the required
value of 1/(2Q), as based on Figure 11.37.

473
                             RThevenin = R1a || R1b
                             RThevenin = R1a R 1b

                                         R1a+R1b

                             RThevenin =  K 2(2 Q2-1)

                                                    2
                                          K (2 Q -1)+K

                             RThevenin =  K 2(2 Q2-1)

                                          K 2Q       2

                             RThevenin =  K (2 Q2-1)

                                          2Q  2

Because RThevenin = 1/(2Q),

                             1 K (2Q 2-1)
                                 =
                             2Q           2Q  2

                             1 = K (2Q 2-1)
                                             Q

                             K = 2Q                     (11.22)
                                       2Q -1

Because R1b was set to K,                               (11.23)
                                R1b= 2Q 
                                      2 Q -1

Substituting 11.22 into 11.21 yields

                             R1a=Q                      (11.24)

By using these values for R1a and R1b, the filter will have a peak gain of unity. Note
that as this scheme only attenuates the signal prior to gain, the funity requirement set in
Equation 11.19 still holds true.

Example 11.5

     Design a filter that will only pass frequencies from 800 Hz to 1200 Hz.
     Make sure that this is a unity-gain realization.

     First, we must determine the center frequency, bandwidth, and Q.

                                     BW = f 2- f 1
                                     BW =1200 Hz -800 Hz
                                     BW =400 Hz

474
                             f o= f 1 f 2                                            Figure 11.39
                                                                                     Initial damping calculation for
                               f o=800 Hz×1200 Hz                                    Example 11.5.

                                     f o=980 Hz

                                     Q= f o
                                          BW

                                     Q=980 Hz 400 Hz
                                     Q= 2.45

     The Q is too high to use separate high- and low-pass filters, but sufficiently
     low so that a multiple feedback type may be used. Before proceeding, we
     should check to make sure that the required funity for the op amp is
     reasonable.

                                     Av=-2 Q2
                                     Av =-2 ×2.452
                                     Av =-12

                                      f unity 10 Av f o
                                      f unity 10×12×980 Hz
                                      f unity 117.6 kHz

     Just about any modern op amp will exceed the funity specification. As this
     circuit shows a gain of 12, the unity gain variation shown in Figure 11.38
     will be used. The calculations for the normalized components follow.

                                     R2=2 Q
                                     R2=2×2.45
                                     R2=4.9 

                                     R1b= 2 Q
                                           2Q -1

                                     R1b= 2×2.452 2.45 -1
                                     R1b=.2226 

     The resulting normalized circuit is shown in Figure 11.39. We must now
     find the frequency scaling factor.

                                     o=2  f o
                                     o=2  980 Hz
                                     o=6158 radians per second

475
         In order to translate our circuit to this frequency, we must divide either the
         resistors or the capacitors by 6158. In this example, let's use the capacitors.

                                         C= 1 6158
                                         C=162.4 F

                                                                                                                     Figure 11.40
                                                                                                                     Final impedance and
                                                                                                                     frequency scaling for
                                                                                                                     Example 11.5.

         A further impedance scaling is needed for practical component values. A
         factor of a few thousand or so would be appropriate here. To keep the
         calculations simple, we'll choose 10 k. Each resistor will be increased by 10
         k, and each capacitor will be reduced by 10 k. The final scaled filter is
         shown in Figure 11.40.

Computer Simulation

The Multisim simulation of the circuit of Example 11.5 is shown in Figure 11.41.
Note that the gain is 0 dB at the approximate center frequency (about 1 kHz). Also,
the -3 dB breakpoints of 800 Hz and 1200 Hz are clearly seen. The phase response
of this filter is also plotted. Note the very fast phase transition in the area around fo.
If the Q of this circuit was increased, this transition would be faster still.

In simulations such as this, it is very important that realistic op amp models be
employed. If an over-idealized version is used, non-ideal behavior due to a reduction
of loop-gain will go unnoticed. This error is most likely to occur in circuits with
high center frequencies and/or high Q s. You can verify this by translating the filter
to a higher frequency and rerunning the simulation. For example, if C1 and C2 are
decreased by a factor of 1000, the center frequency should move up to about 1 MHz.
If the simulation is run again with an appropriate range of test frequencies, you will
see that the limited bandwidth of the A741 op amp prematurely cuts off the filter
response. The result is a peaking frequency more than one octave below target, a
maximum amplitude several dB below 0, and an asymmetrical response curve. This

476
response graph is shown in Figure 11.41c. The accompanying phase plot also shows
a great deviation from the ideal filter. An excessive phase shift at the middle and
higher frequencies is clearly evident.

                                                                                                                     Figure 11.41a
                                                                                                                     Band-pass filter in Multisim.

                                                                                                                     Figure 11.41b
                                                                                                                     Gain and phase plots for band-
                                                                                                                     pass filter.

477
                                                                                                                     Figure 11.41c
                                                                                                                     Gain and phase plots for
                                                                                                                     1000 times frequency shift.

State-Variable Filter

As noted earlier, the multiple-feedback filter is not suited to high frequency or high
Q work. For applications requiring Q s of about 10 or more, the state-variable filter
is the form of choice. The state-variable is often referred to as the universal filter, as
band-pass, high-pass, and low-pass outputs are all available. With additional
components, a band-reject output may be formed as well. Unlike the earlier filter
forms examined, the basic state-variable filter requires three op amps. Also, it is a
second-order type, although higher-order types are possible. This form gets its name
from state-variable analysis. One of the earliest uses for op amps was in the
construction of analog computers (see Chapter Ten). Interconnections of
differentiators, amplifiers, summers, and integrators were used to electronically
solve differential equations that described physical systems. State-variable analysis
provides a technique for solving involved differential equations. The equations may
in fact, describe a required filter's characteristics. Although we will not examine
state-variable analysis, this does not preclude a study of the state-variable filter.
Designing with state-variable filters is really no more complex than our previous
work.

478
Besides its ability to provide stable filters with relatively high Q s, the state-variable
has other unique characteristics:

    · It is relatively easy to tune electronically over a broad frequency range.
    · It is possible to independently adjust the Q and tuning frequency.
    · It offers the ability to create other, more complex, filters, as it has multiple

         outputs.

The state-variable filter is based on integrators. The general form utilizes a summing
amplifier and two integrators, as shown in Figure 11.42. To understand how this
circuit works on an intuitive level, recall that integrators are basically first-order,
low-pass filters. As you can see, the extreme right side output has passed through the
integrators and produces a low-pass response. If the low-pass output is summed out
of phase with the input signal, the low frequency information will cancel, leaving
just the high frequency components. Therefore, the output of the summer is the high-
pass output of the filter. If the high-pass signal is integrated (using the same critical
frequency), the result will be a band-pass response. This is seen at the output of the
first integrator. The band-pass signal is also routed back to the input summing
amplifier. By changing the amount of the signal that is fed back, the response near
the critical frequency may be altered, effectively setting the filter Q. Finally, the
loop is completed by integrating the band-pass response, which yields the low-pass
output. In effect, the second integrator's -6 dB per octave rolloff perfectly
compensates for the rising band-pass response below fo. This produces flat response
below fo. Above fo, the combination of the two falling response curves produces the
expected second-order, low-pass response.

     in           -            -        - low-pass                                          Figure 11.42
                                                                                            Block diagram of state-variable
               K  -          high-pass                                                      filter.

                  +                     band-pass

                          1
                         Q

Two popular ways of configuring the state-variable filter are the fixed-gain and
adjustable-gain forms. The fixed-gain form is shown in Figure 11.43. This circuit
uses a total of three op amps. The Q of the circuit is set by a single resistor, RQ. Qs
up to 100 are possible with state-variable filters. For the high- and low-pass outputs,
the gain of this circuit is unity. For the band-pass output, the gain is equal to Q.

479
                                                                                                                     Figure 11.43
                                                                                                                     Fixed-gain version of state-
                                                                                                                     variable filter.

                                                                                                                     Figure 11.44
                                                                                                                     Variable-gain version of
                                                                                                                     state-variable filter.

480
Figure 11.44 shows an adjustable-gain version. For high- or low-pass use, the gain is
equal to the arbitrary value K, whereas for band-pass use, the gain is equal to KQ.
This variation requires a fourth op amp in order to isolate the Q and gain settings.
Although four op amps may sound like a large number of devices, remember that a
variety of quad op amp packages exist, indicating that the actual physical layout may
be quite small. Also, even though three different outputs are available, it is not
possible to individually optimize each one for simultaneous use. Consequently, the
state-variable is most often used as a stable and switchable high/low-pass filter, or as
a high Q band-pass filter. Finally, in keeping with our previous work, the circuits are
shown normalized to a critical frequency of one radian per second. Although we will
concentrate on band-pass design in this section, it is possible to use these circuits to
realize various high- and low-pass filters, such as those generated with the Sallen
and Key forms. The procedure is nearly identical and uses the same frequency and
damping factors (Figures 11.24 and 11.29).

Example 11.6

         Design a band-pass filter with a center frequency of 4.3 kHz and a Q of 25.
         Use the fixed-gain form.

         First, determine the damping resistor value. Then, scale the components for
         the desired center frequency. Note that a Q of 25 produces a bandwidth of
         only 172 hertz for this filter (4.3 kHz/25).

                                          Rdamping =3 Q-1
                                          Rdamping =3× 25-1
                                          Rdamping =74 

                                         o=2  f o
                                         o=2  4.3 kHz
                                         o=27.02 k radians per second

         In order to translate the filter to our desired center frequency, we need to
         divide either the resistors or the capacitors by 27,020. For this example,
         we'll use the capacitors.

                                         C= 1 27.02 k
                                         C=37 F

         A final impedance scaling is required to achieve reasonable component
         values. A reasonable value might be a factor of 5000.

481
                                         C= 37 F
                                               5000

                                         C=7.4 nF
                                          Rdamping =74×5000
                                          Rdamping =370 k 

         All remaining resistors will equal 5 k.

         Because this is a band-pass filter,
                                          Av=Q
                                          Av =25

         The completed filter is shown in Figure 11.45. The value for Rdamping is
         considerably larger than the other resistors. This effect gets worse as the
         required Q is increased. If this value becomes too large for practical
         components, it may be reduced to a more reasonable value as long as the
         associated divider resistor (from the noninverting input to ground) is
         reduced by the same amount. The ratio of these two resistors is what sets the
         filter Q, not their absolute values. Lowering these values will upset the ideal
         input bias current compensation, but this effect can be ignored in many
         cases, or reduced through the use of FET input op amps.

                                                                                                                    Figure 11.45
                                                                                                                    Completed design of band-
                                                                                                                    pass filter for Example 11.6.

         Altering this circuit for a variable-gain configuration requires the addition of
         a fourth amplifier as shown in Figure 11.44. The calculation for the damping
         resistor is altered, and a value for the input gain determining resistor is
         needed. The remaining component calculations are unchanged from the
         example above. Note that by setting the gain constant K to 1/Q, the final
         filter gain may be set to unity.

482
11.8 Notch Filter (Band-Reject) Realizations

By summing the high-pass and low-pass outputs of the state-variable filter, a notch,
or band-reject, filter may be formed. Filters of this type are commonly used to
remove interference signals. The summation is easily performed with a simple
parallel-parallel summing amplifier, as shown in Figure 11.46.

                                                                                                                     Figure 11.46
                                                                                                                     Notch filter.

For reasonable Q values, there will be tight correlation between the calculated band-
pass center and -3 dB frequencies, and the notch center and -3 dB frequencies. The
component calculations proceed as in the band-pass filter.
Example 11.7

         A filter is needed to remove induced 60 Hz hum from a transducer's signal.
         The rejection bandwidth of the filter should be no more than 2 Hz.
         From the specifications we know that the center frequency is 60 Hz and the
         Q is 60/2, or 30. For simplicity, we will use the fixed-gain form. (Note that
         the gain of the filter on either side of the notch will be unity.)

                                          Rdamping =3 Q-1
                                          Rdamping =3× 30-1
                                          Rdamping =89 
                                         o=2  60
                                         o=377 rad/s
         Scaling C produces
                                         C= 1377
                                         C=2.65 milliFarads

483
A practical value scaling of 104 produces the circuit of Figure 11.47. Note               Figure 11.47
that the damping resistors have only been scaled by 103, as an Rdamping value             Completed notch filter for
of 890 k might be excessive. Remember, it is the ratio of these two                       Example 11.7.
resistors that is important, not their absolute values.

Computer Simulation

Figure 11.48 shows a simulation of the circuit of Example 11.7 using Multisim. To
keep the layout simple, an ideal op amp model was chosen. The AC analysis shows
the very sharp notch centered at 60 Hz as expected. As filters of this type are
designed to remove a single frequency without affecting surrounding material, high
precision tuning components are required. To see the effects of even modest
component deviations in a production run, a Monte Carlo analysis proves invaluable.
In Figure 11.48c a series of 10 runs is shown. Each resistor and capacitor in the filter
has been given a 1 percent nominal tolerance. Further, the frequency plot range has
been narrowed down to just 10 hertz on either side of the target frequency. Even
with these relatively tight tolerances, tuning deviations of more than 1 hertz can be
seen. Also, the response shape is not perfectly symmetrical in all cases.

484
                                                                                                                     Figure 11.48a
                                                                                                                     State-variable notch filter in
                                                                                                                     Multisim.

                                                                                                                     Figure 11.48b
                                                                                                                     Ideal notch response.

485
                                                                                                                     Figure 11.48c
                                                                                                                     Typical response with 1%
                                                                                                                     component variations.

A Note on Component Selection

Ideally, the circuit of Example 11.7 will produce -3 dB points at approximately
59 Hz and 61 Hz and will infinitely attenuate 60 Hz tones. In reality, component
tolerances may alter the response and, therefore, high-quality parts are required for
accurate, high- Q circuits such as this. Even simpler, less-demanding circuits such as
a second-order Sallen and Key filter may not perform as expected if lower quality
parts are used. As a general rule, component accuracy and stability becomes more
important as filter Q and order increase. One percent tolerance metal film resistors
are commonly used, with 5 percent carbon film types being satisfactory for the
simpler circuits. For capacitors, film types such as polyethylene (mylar) are common
for general-purpose work, with polycarbonate, polystyrene, polypropylene, and
teflon being used for the more stringent requirements. For small capacitance values
(<100 pF), NPO ceramics may be used. Generally, large ceramic disc and aluminum
electrolytic capacitors are avoided due to their wide tolerance and instability with
temperature, applied voltage, and other factors.

486
Filter Design Tools

In order to further speed the process of active filter design, some manufacturers offer
free filter design software. Examples include FilterCAD from Linear Technology
and FilterPro from Burr-Brown. Some programs are rather generic and help you
design Sallen and Key, multiple-feedback, and state-variable filters. Others are
written expressly to support the manufacturer's specialized filter ICs. Typically, the
programs will print out component values given desired filter types and break
frequencies. Bode plots and pulse waveform simulations may also be available. Such
programs can certainly reduce design tedium.

11.9 Audio Equalizers

Another range of circuits that fall under the heading of filters are equalizers.
Actually, equalizers are a class of adjustable filters that may produce gain as well as
attenuation. Perhaps the most common uses for equalizers are in the audio, music,
and communications areas. As the name suggests, equalizers are used to adjust or
balance the input frequency spectrum. Equalizers range from complex 1/3 octave
and parametric types for use in recording studios and large public-address systems,
to the simpler bass and treble controls found on virtually all home and car stereos.
Many of the more complex equalizers are based on extensions of the state-variable
filter. On the other hand, some equalizers are little more than modified amplifiers.
We'll take a look at the very common bass and treble controls, which adjust low and
high audio frequencies, respectively.

The purpose of bass and treble controls is to allow the listener some control of the
balance of high and low tones. They may be used to help compensate for the
acoustical shortcomings of a loudspeaker, or perhaps solely to compensate for
personal taste. Unlike the filters previously examined, these controls will be
manipulated by the user and must provide for signal boost as well as cut. A typical
response curve is shown in Figure 11.49. Normally, bass and treble circuits are

+20 dB                                                                                   Figure 11.49
                                                                                         Response of general bass/treble
                                                                                         equalizer.

                                 bass adjust          treble adjust
                                 range                range

0 dB                                                                     f

                         -20 dB               100 Hz  3 kHz

487
realized with parallel-parallel inverting amplifiers. In essence, the feedback network
will change with frequency.
A simple bass control is shown in Figure 11.50. To understand how this circuit
works, let's look at what happens at very low and at very high frequencies. First of
all, at very high frequencies, capacitor C is ideally shorted. Thus, the setting of
potentiometer Rb is inconsequential. In this case, the gain magnitude of the amplifier
will be set at Rc/Ra. Normally, Rc is equal to Ra, so the gain is unity. At very low
frequencies the exact opposite happens; the capacitor is seen as an open. Under this
condition the gain of the amplifier depends on the setting of potentiometer Rb. If the
wiper is set to the extreme right, the gain becomes Rc/(Ra+Rb). If the wiper is moved
to the extreme left, the gain becomes (Rc+Rb)/Ra. If Rb is set to nine times Ra, the
total gain range will vary from 0.1 to 10 (-20 dB to +20 dB). A similar arrangement
may be used to adjust the treble range.

                                                                                                                     Figure 11.50
                                                                                                                     Simple bass section.

When the bass and treble controls are combined, component loading makes the
circuit somewhat more difficult to design. Basic models have already been derived
by a number of sources, though, including the one shown in Figure 11.51.

                                                                                                                     Figure 11.51
                                                                                                                     Bass/treble equalizer.

488
The following equations are used to design the desired equalizer. (Refer to Figure
11.52.)

Bass section (assumes R2 >> R1):

                                 f l= 1
                                      2  R2 C1

                                f lb= 1
                                      2  R1 C1
                                          R2

                                Avb=1+
                                          R1

Treble section (assumes R4 >> R1+R3+2R5):

                                f h= 1
                                     2  R3 C3

                                f hb= 1
                                       2 ( R1+R3+2 R5)C3

                                Avt =1+R1+2 R5
                                             R3

     A'                                                                                  Figure 11.52

                                                                                         Response of bass/treble

                                                                                         equalizer.

     0 dB f

     -A'

          fl  flb  fhb  fh

In actuality, it is very common to design these sorts of circuits empirically. In other
words, the given equations are used as a starting point, and then component values
are adjusted in the laboratory until the desired response range is obtained. Circuits
like this may be altered further to include a midrange control. Generally, three
adjustments is considered to be the maximum for this type of circuit. An example of
a bass-midrange-treble equalizer is shown in the schematic for the Pocket Rocket
amplifier in Chapter Six.

489
Computer Simulation

A simple bass equalizer is simulated in Figure 11.53. The maximum cut and boost is
set to a factor of approximately 10, or 20 dB.

                                                                                                                     Figure 11.53a
                                                                                                                     Bass equalizer in Multisim.

                                                                                                                     Figure 11.53b
                                                                                                                     Gain response at full cut.

490
                                                                                                                     Figure 11.53c
                                                                                                                     Gain response at full boost.

In order to plot the response curves, two AC analysis runs are performed: the first
with the potentiometer at maximum, and the second at minimum. The two curves are
plotted from 10 Hz up to 10 kHz. These curves are essentially mirror images. In both
cases the response above 1 kHz is smooth and reasonably flat. The transition to the
cut/boost region occurs in the 100 Hz to 1 kHz range, with nearly full action by 40
Hz. If the plot is re-run with the potentiometer in some other position (say, 25
percent of rotation), some smooth, scaled curve within these two extremes will be
plotted. If the potentiometer is set at mid-point, the response will be flat across the
entire range.

11.10 Switched-Capacitor Filters

Our final topic is the class of ICs known as switched-capacitor filters. These are just
specific realizations of the types of filters that we have already examined. Generally,
switched-capacitor filters come in two types: fixed order and alignment, and
universal (state-variable based). A typical fixed IC might offer a sixth-order low-
pass Butterworth filter. The number of external components required is minimal.
The universal types offer most of the flexibility of the state-variable designs
discussed previously. Both types are tunable and are relatively easy to use. Tuning is
accomplished by adjusting the frequency of an external clock signal. The higher the
clock frequency, the higher the resulting critical frequency. These ICs offer a
convenient "black box" approach to general-purpose filter design. As is the case

491
with most special-purpose devices, individual manufacturer's data sheets will give
the specific application and design procedures for their parts.

                                                                                          Figure 11.54
                                                                                          Switched capacitor circuit.

The concept behind the switched-capacitor filter is quite interesting. The basic idea
is to mimic a resistor through the use of a capacitor and a pair of alternating
switches. As an example, a simple integrator is shown in Figure 11.54. As you have
already seen, integrators are little more than first-order, low-pass filters. In this
circuit, the input resistor has been replaced with a capacitor, Cin, and a pair of
switches. These switches are controlled by a non-overlapping bi-phase clock. This
means that when one switch is closed, the other will be open, and that during
switching, one switch will break contact before the other switch makes contact.
(This is sometimes referred to as a "break before make" switch.)

During the first half of the clock cycle, Cin charges to the value of Vin. During the
second half of the cycle, this charge is transferred to the integration capacitor.
Therefore, the total charge transferred during one clock cycle is

     Q=Ci n V i n                                       (11.25)

The flow of charge versus time defines current, so the average input current is

     I i n= Q                                           (11.26)
           T clock

Substituting Equation 11.25 into Equation 11.26 yields

     I i n=C i n V i n                                  (11.27)
               T clock

Because the input resistance is defined as the ratio of Vin to Iin, and recognizing that
fclock is the reciprocal of Tclock, Equation 11.27 is used to find Rin:

     Ri n= 1                                            (11.28)
           C i n f clock

492
Equation 11.28 says two important things: first, because Rin sets the input
impedance, it follows that input impedance is inversely proportional to the clock
frequency. Second, because Rin is used to determine the corner frequency (in
conjunction with the integration/feedback capacitor), it follows that the critical
frequency of this circuit is directly proportional to the clock frequency. In other
words, a doubling of clock frequency will halve the input impedance and double the
critical frequency. Depending on the actual design of the IC, there will be a constant
ratio between the clock frequency and the critical frequency. This is a very useful
attribute. It means that you can make a tunable/sweepable filter by using one of
these ICs and an adjustable square wave generator. For that matter, anything that can
produce a square wave (such as a personal computer) can be used to control the filter
response.
Typically, the ratio of clock frequency to critical frequency will be in the range of 50
to 100. The lower limit of clock frequency is controlled by internal leakage paths
that create offset errors. The upper limit is controlled by switch settling time,
propagation delays, and the like. A range of 100 Hz to 1 MHz is reasonable. This
means that the entire audio frequency range is covered by these devices. For use at
the highest frequencies, or with high impedance sources, an input buffer amplifier
should be used.

                                                                                                                     Figure 11.55
                                                                                                                     Block diagram of the MF10.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

493
An example of a switched capacitor filter IC is the MF10, shown in Figure 11.55.
The MF10 is a dual second-order filter that can be connected in a variety of modes.
Mode three is the general purpose state variable form and is shown in Figure 11.56.
Combining the two sections can produce fourth-order systems. In all cases, the
external component count is minimal.

                                                                                                                 Figure 11.56
                                                                                                                 MF10 mode 3 (state variable)
                                                                                                                 equivalent.

                                                                                                                                              Reprinted courtesy of Texas
                                                                                                                                              Instrutments

An example of a fourth-order filter is shown in Figure 11.57. As you can see, the
design is sparse, using only four resistors per section. In short, devices like the
MF10 are good choices for general-purpose filter work, particularly when space and
tuning considerations are important.

                                                                                                                 Figure 11.57
                                                                                                                 MF10 fourth-order low-pass
                                                                                                                 Chebyshev filter.

                                                                                                                                              Reprinted courtesy of Texas
                                                                                                                                              Instrutments

494
Another device of interest is the LTC1068 from Linear Technology. The LTC1068
is a quad device, so a cascaded response of up to eighth-order is possible. Because
these filters are basically little more than a switched capacitor version of the state-
variable, a wide range of response types are possible. These include the high-pass,
low-pass, band-pass and band-reject outputs, as well as a variety of alignments
including Bessel, Butterworth, and Chebyshev. The LTC1068 is modular, so its
internal op amps may be used as gain blocks or for creating a notch output without
added external op amps (as seen in Example 11.7). Normally, no more than four or
five external components (resistors and capacitors) are needed to realize a given
filter function. Component calculation procedures are specified by the manufacturer.

Although switched-capacitor filters offer relatively quick and physically small
realizations, they are not perfect. First of all, clock feedthrough is typically in the
range of 10 mV, meaning that 10 mV of clock signal "leaks" into the output.
Fortunately, this signal is much higher than the critical frequency, but may cause
some problems for low-noise applications. Another problem arises from the fact that
switched capacitor filters are actually sampled data devices. As you will see in the
next chapter, sampled data devices may suffer from a distortion producing
phenomenon called aliasing. In order to avoid aliasing, the input signal must not
contain any components that are greater than one-half of the clock frequency. For
example, if the MF10 is used to create a 1 kHz filter with a 50 kHz clock, no
component of the input signal may exceed 25 kHz (one-half of the clock) if aliasing
is to be avoided. If this requirement cannot be guaranteed, some form of pre-filtering
is needed. Within these limits though, switched capacitor filters make light work out
of many general-purpose applications.

11.11 Extended Topic                                                                     Figure 11.58
Voltage-Controlled Filters                                                               A photoresistor/lamp used as
                                                                                         a variable resistance.
A voltage-controlled filter, or VCF, is nothing more than a standard filter whose
tuning frequency is controlled by an external voltage. You might think of this
concept as an extension of the clock control aspects of the switched capacitor filter.
VCFs are used in a wide range of applications including instrumentation
devices such as swept frequency analyzers and music synthesizers. Any
application that requires precise or rapid control of tuning frequency calls
for a VCF. Virtually any of the filters presented in this chapter may be
turned into VCFs. All you need to do is substitute the tuning elements of the
filter with a voltage-controlled version. Typically, this means replacing the
tuning resistors with voltage-controlled resistances.

495
Two possible ways of creating a voltage-controlled resistance include the                  Figure 11.59
photoresistor/lamp combination (Figure 11.58), and the use of an FET in its ohmic          Using a JFET in the ohmic
region (Figure 11.59). To use these items, simply remove the tuning resistor(s), and       region.
replace them with a voltage-controlled resistance. As an example, a simple
single-pole high-pass VCF is shown in Figure 11.60. As the control voltage (Vc)
increases, the lamp brightness increases causing the photoresistor's value to drop.
Because the photoresistor sets the tuning frequency, the net result is an increase
in fc. The FET version produces a resistance that is proportional to the magnitude
of the gate voltage (Vc).

These two solutions are not without their problems. In the case of the
lamp/photoresistor, response time is not very fast, and the lamp portion requires a
fairly large drive current. The FET circuit eliminates these problems, but requires
that the voltage across it remain fairly low (usually less than 100 mV). Larger signal
swings will drive the FET out of the ohmic region, and distortion will increase
dramatically. Also, the popular N channel variety requires a negative gate potential,
which is generally not preferred. In both cases, one more problem remains: it is
difficult to create a wide linear control range.

                                                                                           Figure 11.60
                                                                                           Variable resistance
                                                                                           connection for VCF.

Another way to create the effect of a voltage-variable tuning element is through the
use of an operational transconductance amplifier, or OTA (see Chapter Six).
Remember, this device is essentially a voltage-to-current converter. Its output
current is a function of its control current. (The control current is easily derived from
a control voltage and resistor.) This device is ideally suited to "inverting" type
inputs, where an input resistor is used as a voltage-to-current converter. One
possible example is shown in Figure 11.61, a state-variable VCF. The boxed sections
show where an OTA has replaced a standard single resistor. In this circuit, a large
control voltage creates a large control current, thus increasing transconductance.
This simulates a smaller tuning resistor value, and thus creates a higher tuning
frequency. The OTA approach proves to be reliable, repeatable, and generally low in
cost. It also offers a fairly wide linear tuning range.

496
                                                                                                                     Figure 11.61
                                                                                                                     Using OTAs as a controlled
                                                                                                                     element in a VCF.

Summary

Filters are frequency-selective circuits. The basic forms are high-pass, low-pass,
band-pass, and band-reject. Although filters may be constructed solely from
resistors, capacitors, and inductors, active filters using op amps offer many
advantages. These advantages include: modest component size, control over
impedances and loading effects, elimination of inductors, and gain (if desired). The
negative aspects include: frequency range limited by op amps used, power supply
required, and the inability to handle large input/output powers. For many
applications the advantages far outweigh the disadvantages, and therefore, active
filters are used in a wide variety of modern products.
Filters are further defined by order and alignment. Order indicates the steepness of
the attenuation slope. As a general rule, the eventual rolloff rate will equal 6 dB
times the order, per octave. Order also indicates the minimum number of reactive
elements needed to realize the filter. Alignment indicates the shape of the filter
response in the frequency domain. Popular alignments include Bessel (constant time
delay), Butterworth (maximally flat response in the pass band), and Chebyshev
(ripples in the pass band, but with faster roll off rates). There is generally a trade-off
between fast attenuation rates and smooth phase response. Alignment is indicated by
the damping or Q of the filter. Q is the reciprocal of damping. Filters with low
damping factors (i.e., high Q) tend to be "peaky" in the frequency domain and
produce ringing on pulse-type inputs. (Chebyshevs are in this category.) The filter's
critical frequency and 3 dB down frequency are not the same for alignments other

497
than the Butterworth. The actual amount of "skew" depends on the alignment and
order of the filter.

Once filter performance is specified, there are a number of ways in which the circuit
can be physically realized. Common high- and low-pass realizations use the Sallen
and Key VCVS approach. There are two variations on this theme: the unity-gain
form and the equal-component form. Both forms use a second-order building block
section. For higher orders, several second-order sections (and optionally, a first-
order section) are combined to produce the final filter. It is important to remember
that higher-order filters are not simple combinations of identical lower-order filters.
For example, a fourth-order 1 kHz Butterworth filter is not made by cascading a pair
of identical second-order 1 kHz Butterworth filters. Rather, each section requires
specific damping and frequency factors. A common design procedure utilizes look-
up tables for these factors. The filters are designed by first scaling the general filter
to the desired cutoff frequency, and then scaling the components for practical values.

For relatively low Q s (<1), band-pass filters are best realized as a cascade of high-
and low-pass filters. For higher Q s, this technique is not satisfactory. Moderate Qs
(up to 10) may be realized with the multiple-feedback filter. Very high Q
applications (up to 100) may be realized with the state-variable filter. The state-
variable is often known as the universal filter, as it produces high-, low-, and band-
pass outputs. With the addition of a fourth amplifier, a band-reject filter may be
formed. Fixed and adjustable gain versions of the state-variable may be utilized by
the designer.

A somewhat more specialized group of filters are the equalizers commonly
employed in audio recording and playback equipment. Unlike traditional filters,
equalizers offer both boost and attenuation of frequencies. Generally, these circuits
are based on parallel-parallel inverting amplifiers, utilizing an adjustable, frequency-
selective feedback network.

Switched capacitor filter ICs offer the designer expedient solutions to general-
purpose filter design. They are generally suited to the audio frequency range and
require very few external components. The critical frequency is set by a clock input.
The order and alignment may be either factory set or user adjustable (as in the
universal state-variable types).

References

Lancaster, Don Active Filter Cookbook, 2nd e, Woburn, Mass.: Butterworth-
Heinemann, 1996.
Bohn, Dennis ed. Audio Handbook, Santa Clara, Ca.: National Semiconductor
Corporation, 1976.
Tedeschi, Frank P. The Active Filter Handbook, TAB Books, 1979.
Audio Handbook, Norwood, Mass.: Precision Monolithics Inc., 1990.

498
Jung, Walter G. Audio IC Op Amp Applications, 2nd e, Indianapolis, Ind.: Howard
W. Sams, 1978.

Review Questions

    1. What are the four main types of filters?
    2. What are the advantages of active filters versus passive filters?
    3. What are the disadvantages of active filters versus passive filters?
    4. What do the characteristics of order and poles indicate?
    5. Name several popular filter alignments.
    6. How do the popular filter alignments differ from one another in terms of

         phase and magnitude response?
    7. Which alignment should be used if linear phase response is of particular

         importance?
    8. Which alignment should be used if fastest rolloff rate is of particular

         importance?
    9. When are the "3 dB down" and critical frequencies of a filter identical?
    10. Outline the process for creating high-order filters and explain why cascades

         of similar lower-order filters do not give the appropriate results.
    11. Explain where each of the following band-pass filters would be appropriate:

         high-pass/low-pass cascade, multiple-feedback, and state-variable.
    12. Why is the state-variable often referred to as the universal filter?
    13. Briefly explain the operation of an adjustable bass equalizer.
    14. Briefly explain the concept behind the switched-capacitor filter.
    15. What are the advantages and disadvantages of switched-capacitor ICs versus

         the more traditional op amp approach?

Problems

Analysis Problems

    1. Using Figure 11.9b, determine the loss for a 1 kHz Butterworth second-
         order low-pass filter at 500 Hz, 1 kHz, 2 kHz, and 4 kHz.

    2. Using Figure 11.29, determine the loss for a 2 kHz 3 dB ripple Chebyshev
         third-order low-pass filter at 500 Hz, 1 kHz, 2 kHz, 4 kHz, and 6 kHz.

    3. Using Figure 11.9b, determine the loss for a 500 Hz Bessel second-order
         high-pass filter at 200 Hz, 500 Hz, and 2 kHz.

    4. Using Figure 11.29, determine the loss one octave above the cutoff
         frequency for a fourth-order low-pass filter of the following alignments:
         Butterworth, Bessel, 1 dB-ripple Chebyshev.

    5. Repeat Problem 4 for high-pass filters.

499
    6. using Figures 11.9b and 11.29, determine the loss at 8 kHz for 3 kHz low-
         pass Butterworth filters of orders 2 through 6.

    7. Using Figures 11.9b and 11.29, determine the loss at 500 Hz for 1.5 kHz
         high-pass Bessel filters of orders 2 through 6.

    8. Repeat Problem 7 using 3 dB-ripple Chebyshevs.
    9. Using Figures 11.9b and 11.29, determine the loss at 500 Hz for 200 Hz

         high-pass 3 dB-ripple Chebyshev filters of orders 2 through 6.
    10. Using Figure 11.29, determine the loss one octave below the cutoff

         frequency for a third-order high-pass filter of the following alignments:
         Butterworth, Bessel, 1 dB-ripple Chebyshev.
    11. Repeat Problem 10 for low-pass filters.
    12. An application requires that the stop-band attenuation of a low-pass filter be
         at least -15 dB at 1.5 times the critical frequency. Determine the minimum
         order required for the Butterworth and 1 dB and 3 dB-ripple Chebyshev
         alignments.
    13. An application requires that the stop-band attenuation of a high-pass filter be
         at least -20 dB one octave below the critical frequency. Determine the
         minimum order required for the Butterworth and 1 dB-ripple and
         3 dB-ripple Chebyshev alignments.
    14. A band-pass filter has a center frequency of 1020 Hz and a bandwidth of
         50 Hz. Determine the filter Q.
    15. A band-pass filter has upper and lower break frequencies of 9.5 kHz and
         8 kHz. Determine the center frequency and Q of the filter.
    16. Design a second-order Butterworth low-pass filter with a critical frequency
         of 125 Hz. The pass band gain should be unity.
    17. Repeat Problem 16 for a high-pass filter.
    18. Repeat Problem 16 using a Bessel alignment.

Design Problems

    19. A particular application requires that all frequencies below 400 Hz should
         be attenuated. The attenuation should be at least -22 dB at 100 Hz. Design a
         filter to meet this requirement.

    20. Repeat Problem 19 for an attenuation of at least -35 dB at 100 Hz.
    21. Audiophile quality stereo systems often use subwoofers to reproduce the

         lowest possible musical tones. These systems typically use an electronic
         crossover approach as explained in Example 11.4. Design an electronic
         crossover for this application using third-order Butterworth filters. The
         crossover frequency should be set at 65 Hz.

500
    22. Explain how the design sequence of Problem 21 is altered if either a new
         crossover frequency is chosen, or a different alignment is specified.

    23. Design a band-pass filter that will only allow frequencies between 150 Hz
         and 3 kHz. The attenuation slopes should be at least 40 dB per decade. (A
         filter such as this is useful for "cleaning up" recordings of human speech.)

    24. Design a band-pass filter with a center frequency of 2040 Hz and a
         bandwidth of 400 Hz. The circuit should have unity gain. Also, determine
         the funity requirement of the op amp(s) used.

    25. Repeat Problem 24 for a center frequency of 440 Hz and a bandwidth of
         80 Hz.

    26. Design a band-pass filter with upper and lower break frequencies of 700 Hz
         and 680 Hz.

    27. Design a notch filter to remove 19 kHz tones. The Q of the filter should be
         25. (This filter is useful in removing the stereo "pilot" signal from FM radio
         broadcasts.)

    28. Design a second-order low-pass filter with a critical frequency of 30 kHz.
         Use a state-variable filter. The circuit should have a gain of +6 dB in the
         pass band.

    29. Design a bass/treble equalizer to meet the following specification: maximum
         cut and boost = 25 dB below 50 Hz and above 10 kHz.

    30. Using the MF10, design a fourth-order low-pass Butterworth filter with a
         critical frequency of 3.5 kHz.

    31. Using the MF10, design a low-pass filter that is adjustable from 200 Hz to
         10 kHz. Do not ignore the oscillator design.

Challenge Problems

    32. Design a low-pass second-order filter that may be adjusted by the user from
         200 Hz to 2 kHz. Also, make the circuit switchable between Butterworth
         and Bessel alignments.

    33. Design a subsonic filter that will be 3 dB down from the pass band response
         at 16 Hz. The attenuation at 10 Hz must be at least 40 dB. Although pass
         band ripple is permissible, the gain should be unity.

    34. Design an adjustable band-pass filter with a Q range from 10 to 25, and a
         center frequency range from 1 kHz to 5 kHz.

    35. Modify the design of the previous problem so that as the Q is varied, the
         pass-band gain remains constant at unity.

501
Computer Simulation Problems
    36. Verify the magnitude response of the circuit designed in Problem 16 by
         using a simulator. Check both the critical frequency and the roll off rate.
    37. Verify the magnitude response of the electronic crossover designed in
         Problem 21 by using a simulator. Plot both outputs simultaneously on one
         graph.
    38. Verify the magnitude and phase of the filter designed in Problem 24 by
         using a simulator.
    39. Compare the simulations of the circuit designed in Problem 28 using the
         relatively slow LM741, versus the medium-speed LF411. Is there any
         noticeable change? What can you conclude from this? Would the results be
         similar if the break frequency was increased by a factor of 50?
    40. It is very common to plot the adjustment range of equalizers on a single
         graph, as shown in Figure 12-49. Use a simulator to create a plot of the
         adjustment range of the equalizer designed in Problem 29.
    41. Simulate and verify the design of challenge Problem 32.
    42. Simulate and verify the design of challenge Problem 33.
    43. Verify the design of challenge Problem 34 using a simulator. Include four
         separate plots, showing maximum and minimum Q with maximum and
         minimum center frequency.
    44. Verify the design of challenge Problem 35 using a simulator. Include two
         simultaneous plots, one showing minimum Q with maximum and minimum
         center frequency, and the other showing maximum Q with maximum and
         minimum center frequency.

502
12 Analog-to-Digital-to-Analog Conversion

Chapter Learning Objectives

After completing this chapter, you should be able to:

    · Outline the concept of pulse code modulation.
    · Detail the advantages and disadvantages of signal processing in the digital domain.
    · Define the terms resolution, quantization, and Nyquist frequency.
    · Define an alias, and detail how it is produced and subsequently avoided.
    · Explain the operation of an R/2R digital-to-analog converter.
    · Explain the need for anti-alias and reconstruction filters.
    · Explain the operation of a successive approximation analog-to-digital converter.
    · Detail the need for and operation of a track-and-hold amplifier.
    · Explain the operation of a flash analog-to-digital converter.
    · Compare the different analog-to-digital converters in terms of speed, size and complexity, and detail

         typical applications for each.

12.1 Introduction

Up to now, all of the circuits you have studied in this book were analog circuits. That is, the input waveforms
were time-continuous and had infinite resolution along the time and amplitude axes. That is, you could discern
increasingly smaller and finer changes as you examined a particular section. No matter whether the circuit was a
simple amplifier, function synthesizer, integrator, filter, or what have you, the analog nature of the signal was
always true. Fundamentally, the universe is analog in nature (at least as far as we can tell - until someone
discovers a quantum time particle). Our only real deviation from the pure analog system was the use of the
comparator. Although the input to the comparator was analog, the output was decidedly digital; its output was
either a logic high ( +Vsat) or a logic low (-Vsat). You can think of the comparator's output as having very low
resolution, as only two states are possible. The comparator's output is still time-continuous in that a logic
transition can occur at any time. This is in contrast to a pure digital system where transitions are time-discrete.
This means that logic levels can only change at specific times, usually controlled by some form of master clock.
A purely digital system then, is the antithesis of a pure analog system. An analog system is time-continuous and
has infinite amplitude resolution. A digital system is time-discrete and has finite amplitude resolution (two states
in our example).

As you have no doubt noticed in your parallel work, digital systems have certain advantages and benefits
relative to analog systems. These advantages include noise immunity, storage capability, and available numeric
processing power. It makes sense, then, that a combination of analog and digital systems could offer the best of
both worlds. This chapter examines the processes of converting analog signals into a digital format and turning

503
digital words into an analog signal. A few representative examples of processing the
signal in the digital domain are presented as well. Some examples with which you
might already be familiar include the stereo compact disk (CD) and the digital
storage oscilloscope. We will break down this topic into two broad sections: analog-
to-digital conversion (AD) and digital-to-analog conversion (DA). Since many AD
systems require digital-to-analog converters, we will examine DA systems first.

The Advantages and Disadvantages of Working in the Digital Domain

Given enough time, an analog circuit may be designed and manufactured for
virtually any application. Why, then, would anyone desire to work in the digital
domain? Perhaps the major reason for working in the digital domain is the flexibility
it offers. Once signals are represented in a digital form, they may be manipulated by
various means, including software programs. You have probably discovered that
replicating a computer program is far easier than replicating an analog circuit.
What's more, a program is much easier to update and customize than a hardware
circuit. Because of this, it is possible to manipulate a signal in many different ways
with the same digital/computer hardware; all that needs to be altered is the
manipulation instructions (i.e., the program). The analog circuit, in contrast, needs to
be re-wired, and extra components need to be added or old portions removed. This
can be far more costly and time-intensive than just updating software. By working in
the digital domain, processing circuits do not exist per se; rather, a generic IC such
as a CPU is used to create a "virtual circuit". With a certain amount of intelligence in
the system design, the virtual circuit may be able to alter its own performance in
order to precisely adapt to various signals. This all boils down to the fact that a
digital scheme may offer much greater flexibility for involved tasks and allows a
streamlined, generic hardware solution for complex applications. Because of this
attribute, the digital solution may wind up being significantly less expensive than its
analog counterpart.

When an analog signal is transferred to the digital domain, it is represented as a
series of numbers (usually, high/low binary logic levels). One nice property of this
representation is that it is exactly repeatable. In other words, an infinite number of
copies of the data may be generated, and no distortions or deviations from the
original will appear. The last copy will be identical to the first. Compare this to a
simple analog copy. For example, if you were to record a song with a cassette
recorder and then make a copy of the tape, the second-generation copy would suffer
from increased noise and distortion. A copy of the second copy would produce even
worse results. Every time the signal is copied, some corruption occurs. It is for this
reason that early long distance telephone calls were of such low quality. Modern
communications systems employ digital techniques that allow much higher quality,
even if one person is in New York and the other is in Australia, halfway around the
planet.

504
Besides being a desirable mathematical attribute, repeatability also lends itself to the
problem of long term storage. A storage medium for a binary signal only needs to
resolve two levels, whereas the analog medium needs to resolve very fine changes in
signal strength. As you might guess, deterioration of the analog medium is a serious
problem and results in information loss. The digital medium can theoretically
survive a much higher level of deterioration without information loss. In a
computerized system, data may be stored in a variety of formats including RAM
(Random Access Memory) and magnetic tape or disk. For playback only (i.e., read
only), data may be stored in ROM (Read Only Memory) or laser disk formats (such
as DVD or audio CD).

As always, the benefits of the digital scheme arrive with specific disadvantages.
First, for simpler applications, the cost of the digital approach is very high and
cannot be justified. Second, the process of converting a signal between the analog
and digital domains is an inexact one. Some information about the signal will be lost
during the conversion. This is because the digital representation has finite resolution.
This means that only signal changes larger than a certain minimum size (the
resolution step size) are discernable, and therefore, some form of round-off error is
inevitable. This characteristic helps determine the range of allowable signals, from
the smallest detectable signal to the maximum signal before overload occurs. Third,
analog systems are inherently faster than digital systems. Analog solutions can
process input signals at much higher frequencies than digital schemes. Also, analog
systems work in real-time, whereas digital systems might not. Digital systems can
only perform in real-time if the input signal is not a very high frequency, if the
processing task is not overly complex, or if specialized processing circuits are
added. Not all applications require real-time performance, so this limitation is not
always a problem. Also, because we can expect computing power to get less and less
expensive in the coming years, cost-effective digital processing will undoubtedly
expand into new areas.

12.2 The Sampling Theorem

There are many different ways in which an analog signal may be turned into a digital
form. This process is referred to as AD conversion or, more simply, as digitization.
We will only examine the most popular method, called pulse code modulation, or
PCM for short. The reverse of this process, or turning the digital information back
into analog form, is called DA conversion. The two most important charracteristics
in the conversion process are sampling frequency and amplitude resolution. Let's
look at the basic idea behind PCM.

In essence, PCM measures and encodes the value of the input signal at specific
points in time. Normally, the time spacing is constant, and several points are used
over the length of one input cycle. In other words, the process involves taking
representative samples of the input signal over time. This is shown graphically in

505
Figure 12.1, and is referred to as sampling. The result of the sampling procedure is a
list of times and corresponding amplitude values. A sequence might look something
like: at t = 1 ms, Vin = 23 mV; at t = 2 ms, Vin = 45 mV; at t = 3 ms, Vin = -15 mV;
etc. If the time interval between samples is held constant (i.e., constant rate of
sampling), then all we need to know is a starting time and the sampling rate in order
to reconstruct the actual sample times19. This is much more efficient than recording
each sample time. The resulting amplitude values may be manipulated in a variety of
ways since they are now in a numeric form. The ultimate accuracy of this conversion
will depend on two primary factors: how often we sample the signal and the
accuracy and resolution of the sample measurement. Theoretically, the conversion
will never be 100% accurate; that is, once converted, a finite amount of information
will be lost forever. Another way of stating this is that when the digital
representation is converted back to analog, the result will not be identical to the
original waveform. In practical terms, it is possible to reduce the error to such small
values that it may be ignored in many applications. It is important then, that we
investigate the implications of sample rate and accuracy/resolution on the quality of
conversion.

                                                                                                                     Figure 12.1
                                                                                                                     Sampling input signals over
                                                                                                                     time.

                                                                      t

12.3 Resolution and Sampling Rate

Perhaps the most obvious source of error is the finite measurement accuracy of the
individual signal levels. The major problem here is one of resolution. Resolution
represents the finest discernible change in the signal and is often specified in terms
of a number of bits, although a voltage specification is also possible. Because the
signal level is represented with a binary number, it follows that a large number of
bits are needed in order to achieve fine resolution. For example, if an eight-bit word
is used, there will be 256 distinct values available. If the maximum peak-to-peak
value of the input signal is 1 V, it works out that each step in the word represents
about 3.9 mV (1 V/256). Under these conditions, it would be impossible to perfectly
encode a value of 14 mV. The nearest values available would be binary 11, which
yields 11.7 mV (3 times 3.9 mV), and binary 100, which yields 15.6 mV (4 times

19 The terms sample rate and sample frequency are often used interchangeably, and are
    usually denoted by fs.

506
3.9 mV). Obviously, the resulting round-off creates some error in the digital
representation. This error can be reduced by increasing resolution so that finer steps
may be detected. If 16 bits are used for the same 1 V range, a total of 65,536 values
are available, with each step working out to 15.26 V. Now, although we still may
not be able to exactly represent the 14 mV level, we are guaranteed to be within
±7.63 V, instead of ±1.95 mV as in the eight-bit case. Because the round-off errors
tend to be random in magnitude and polarity, this effect may be viewed as a noise
source. In other words, lower resolutions (i.e., fewer bits) produce noisier signals.
The number of bits required for a particular application may vary from fewer than 6
for high speed video applications to more than 20 for high quality audio or
measurement purposes.

It is important to note that once the size of the digital word is chosen and the peak
amplitude fixed, the input signal must stay within specific bounds or gross distortion
will occur. For example, if a peak input of 1 V produces the maximum numeric
value, there is no way that the digital word can represent a level greater than 1 V.
Likewise, if the step size is set at 1 mV, any signals less than 1 mV are lost. Also,
low-level signals will suffer from reduced resolution. For best results, the signal
peak should produce the maximum numeric value. If the peak is significantly less,
the result is akin to using fewer bits in the representation. Finally, even if the
resolution is adequate, the absolute accuracy of the conversion must be considered,
as it is in any measurement device.

Example 12.1

         A certain system uses a 12-bit word to represent the input signal. If the
         maximum peak-to-peak signal is set for 2 V, determine the resolution of the
         system and its dynamic range.

         A 12-bit word means that 212, or 4096, levels are possible. As these levels
         are equally spaced across the 2 V range, each step is

                                         Step Size= 2 V 4096
                                         Step Size=488 V

         Therefore, the system can resolve changes as small as 488 V.

         Dynamic range represents the ratio of the largest value possible to the
         smallest.

507
              Dynamic Range = 2 V 488 V

              Dynamic Range = 4096
              Dynamic Range = 20log104096
              Dynamic Range = 72dB

In the preceding problem, note that the voltage range affects the step size, but does
not affect the bit resolution. The actual number of discrete steps that may be
resolved is set by the number of bits available. You may notice that each additional
bit adds approximately 6 dB of range (a doubling of voltage). Consequently, the
dynamic range calculation may be streamlined to

              Dynamic Range 6 dB×Number of Bits  (12.1)

Example 12.2

Audio compact disks use a 16-bit representation of the music signal.
Determine the dynamic range. Also, if the maximum output level is 0.775 V
peak, determine the step size.

                                Dynamic Range 6 dB×Number of Bits
                                Dynamic Range 6 dB×16
                                Dynamic Range 96 dB

For 16 bits, the total number of steps is 216, or 65536. Assuming that the
signal is bipolar, the total signal range will be from -0.775 V to +0.775 V,
or 1.55 V.

                                Step Size = 1.55 V 65536
                                Step Size = 23.65 V

At this point, we must consider the effect of sampling rate on the quality of the
signal. It should be intuitively obvious that higher sampling rates afford greater
overall conversion accuracy. Of course, there is a trade-off associated with high
sampling rates, and that is the accompanying high data rate. In other words, greater
resources will be required to store and process the larger volume of digital
information. The real question is, just how fast does the sampling rate need to be, for
optimum efficiency? The Nyquist-Shannon sampling theorem states that at least two
samples are needed per cycle for proper signal conversion. If the signal is not a
sinusoid, then at least two samples are required per cycle of the highest frequency
component. For example, if a range of signals up to 10 kHz needs to be digitized,

508
then a sample rate of at least 20 kHz is required. Normally, a certain amount of
"breathing room" is added to this figure. Another way of looking at this relationship
is to state that the highest input-frequency component can be no more than one-half
of the sampling rate. Because this is such an important parameter, the value of one-
half of the sampling rate is given the name Nyquist frequency.

             Nyquist frequency= f s                  (12.2)
                                       2

If an input frequency component is greater than the Nyquist frequency, a unique
form of distortion called alias distortion, is produced. The resulting distortion
product, called an alias, is a new signal at a frequency that is equal to the difference
between the input and Nyquist frequencies. Normally, this new signal is not
harmonically related to the input signal, and thus, is easily detected. The aliasing
effect is shown graphically in Figure 12.2.

                                                                        Figure 12.2
                                                                        The aliasing effect (sampling
                                                                        rate too low).

                                                     t

     t0  t1             t2                t3     t4

Here we see a sampling rate that is only about 1.5 times the input frequency, rather
than the required factor of 2 times minimum. In Figure 12.3 the sample points are
redrawn and connected as simply as possible. Note that the resulting outline is that
of a lower-frequency wave. What we notice here is that the data points produced in
Figure 12.2 are identical to the points produced by a lower-frequency input wave.
When these data points are converted back to analog form, the DA converter will
produce this lower frequency wave. Oddly enough, the original waveform has
completely disappeared; hence the term alias. Any signal component that is greater
than the Nyquist frequency will produce aliases.

         original wave                    alias                                           Figure 12.3
                                                                                          Alias production.

                                                     t

     t0  t1             t2                t3     t4

509
When considering the possibility of alias distortion, it is worth repeating that the
components of the signal must be investigated, not just the base frequency. For
example, a 1 kHz square wave has a 1 kHz fundamental and an infinite series of
odd-numbered harmonics (3 kHz, 5 kHz, 7 kHz, 9 kHz, etc.). If a 12 kHz sampling
rate is used to digitize this signal, a fair amount of alias distortion will be seen. In
this example, the Nyquist rate is 6 kHz. All of the harmonics above 6 kHz will
produce an alias. In order to prevent this, the input signal must be frequency-band
limited. That is, a low-pass filter must be used to attenuate all components above the
Nyquist frequency before AD conversion takes place. The amount of filtering
required depends on the resolution of the conversion and the relative strength of the
above-band signals. Because filters cannot roll off infinitely fast, as noted in Chapter
Eleven, sampling rates are normally set more than twice as high as the highest
needed input component. In this way, the Nyquist frequency will be somewhat
greater than the maximum desired input frequency. The low-pass filter (often
referred to as an anti-alias filter) will use this frequency range as its transition band.
Even though the attenuation in the transition band is less than optimum, alias
distortion will not be a problem. This is shown graphically in Figure 12.4. As you
can see, high-roll-off rate filters are desirable in order to attenuate the out-of-band
signals as quickly as possible. Very fast filter roll off rates mean that the sampling
frequency need only be as little as 10% greater than the theoretical minimum in
order to maintain sufficient alias rejection.

     response of anti-alias filter                                                 Figure 12.4
                                                                                   Filtering to eliminate aliasing
                                                                                   effects.

     desired input spectrum                                                     f

                                    fhigh        out of band components

                                           fN

                                               filtered input spectrum

                                                                        f

     fhigh                                 fN

510
Example 12.3

         Suppose that you need to digitize telephone signals. Assuming that you
         would like to maintain a dynamic range of at least 50 dB, with an upper
         frequency limit of 3 kHz, determine the minimum acceptable sampling rate
         and number of bits of required.

         The minimum Nyquist rate is equal to the highest desired input frequency.
         In this case, that's 3 kHz. Because the sampling rate is twice the Nyquist
         frequency, the sampling rate must be at least 6 kHz. In reality, if input
         components above 3 kHz exist, an anti-alias filter will be needed, and the
         sampling rate will have to be increased somewhat.

         Because dynamic range is set by the number of bits used, we find that

                                          Bits Required = Dynamic Range 6 dB
                                          Bits Required = 50dB

                                                               6 dB
                                          Bits Required =9

         Because we cannot have a fractional bit, the value is rounded up. The final
         system specification is a minimum rate of 6 kHz with a 9-bit resolution.
         Note that this represents a data rate of 9 bits per sample times 6000 samples
         per second, or 54000 bits per second (6750 bytes per second).

12.4 Digital-to-Analog Conversion Techniques

The basic digital-to-analog converter is little more than a weighted summing
amplifier. Each successive bit in the digital word represents a level that is twice as
large as the preceding bit. If each bit is taken as a given current or voltage, the
increasing levels may be produced by using different gains in the summing inputs. A
simple four-bit converter is shown in Figure 12.5.

                                                                                                                     Figure 12.5
                                                                                                                     A simple 4-bit converter.

511
This system can represent 24, or 16, different levels. Each input is driven by a simple
high/low logic level that represents a 1 or 0 for that particular bit. Note that the input
resistors vary by factors of 2. The gain for the upper most path is Rf/Rf, or unity. This
input is used for the most significant bit of the input word (MSB). The next input
shows a gain of Rf / (2Rf), or 0.5. The third input shows a gain of 0.25, and the final
input shows a gain of 0.125. The final input has the lowest gain and is used for the
least significant bit of the input word (LSB). If the input word had a higher
resolution (i.e., more bits), extra channels would be added, each having half the gain
of the preceding input. To better understand the conversion process, let's take a look
at a few representative inputs and outputs.

The circuit of Figure 12.5 may be driven by simple 5 V TTL-type logic circuits. 5 V
represents a logical high, whereas 0 V represents a logical low. What is the output
level if the input word is 0100? Because a logical high represents 5 V, 5 V is being
applied to the second input. All other inputs receive a logical low, or 0 V. The output
is the summation of the input signals (remember, this is an inverting summer, so the
final output should have its sign reversed).

                                V out=-(V i n1 A1+V i n2 A2 +V i n3 A3+V in4 A4)
                                V out=-(0 V×1+5 V×0.5+0 V×0.25 +0 V×0.125)
                                V out=-2.5 V

So, a value of 4 (binary 100) is equivalent to a potential of 2.5 V. If we increase the
word value to 9 (binary 1001), we see

                                V out=-(V i n1 A1+V i n2 A2 +V i n3 A3+V in4 A4)
                                V out=-(5 V×1 +0 V×0.5+0 V×0.25 +5 V×0.125)
                                V out=-5.625 V

The minimum output occurs at binary 0000, (0 V) and the maximum at binary 1111
(-9.375 V). The step size is equal to the logic level times the minimum gain; in this
case that's 0.625 V. Notice that the output value may be found by simply multiplying
the value of the input word by the minimum step size. Also, it is important to note
that the output signal is unipolar (in this example, always negative).

A digital representation, of course, is made up of a sequence of words, not just one
word. In reality, the logic circuits are constantly feeding the summing amplifier new
words at a predetermined rate. Because of the changing inputs, the output of the
converter is constantly changing as well. Using our previously calculated values, if
the converter is fed the sequence 0000, 0100, 1001, 1111, the output will move from
0 V to -2.5 V, to -5.625 V, to a final value of -9.375 V. This output is graphed in
Figure 12.6.

512
       0 V  t Figure 12.6
 -2.15 V                                  Output with four digital words.
-5.625 V
-9.375 V

If this sequence is repeated over and over, the waveform of Figure 12.7 is the result.
Note that a "stair-step" type wave is created. You might also think of this as a very
rough form of a ramp function. A better ramp would be produced if we used all of
the available values for the input sequence, as in 0000, 0001, 0010, 0011, ... , 1111.
In order to remove the negative DC offset and make the signal bipolar, all we need to
do is pass the signal through a coupling capacitor. The frequency of this waveform is
controlled by the rate at which the words are fed to the converter. Note that by
increasing the resolution and the number of words fed to the converter per cycle, a
very close approximation to the ideal ramp function may be achieved. For that
matter, by changing the input words to other sequences, we can create a wide variety
of output wave shapes. This is the concept behind the digital arbitrary function
generator. An arbitrary function generator allows you to create wave shapes beyond
the simple sine/square/triangle found on the typical laboratory function generator.
We'll take a closer look at this particular piece of test equipment a little later.

            t                                                                           Figure 12.7

                                                                                        Cycled output.

In order to increase resolution, it appears that all you need to do to the summing
amplifier is add extra channels with larger and larger resistors. Unfortunately, the
resistor sizes soon become impractical and another approach is required. For
example, a 16-bit system would require that the LSB resistor be equal to 65,536 Rf.
One problem is that the resulting small input current may be dwarfed by input bias
and offset currents. Also, high component accuracy is needed for the more

513
significant inputs in terms of the input resistors and the drive signals. The
excessively large resistors may also contribute added noise. The standard solution to
this problem involves of the use of an R/2R resistive divider network.

                                                                                                                    Figure 12.8
                                                                                                                    R/2R ladder network.

An R/2R network is shown in Figure 12.8. This circuit exhibits the unique attribute
of constant division by 2 for each stage. You may think of this as either a division of
voltage at each successive node or a division of current in each successive leg. An
example of a four stage (i.e., four-bit) network is shown in Figure 12.9.

                                                                                                                    Figure 12.9
                                                                                                                    A 4-stage ladder.

In order to find the voltage at any given node, the loading effects of the following
stages must be taken into account. This is much easier to do than it first appears. If
we need to find the voltage at point A, we must first find the resistance in parallel
with the initial 2 k resistor. A quick inspection shows that each stage is loaded by
the following stages, so it is easiest if we start at the last stage and work toward the
input. The effective resistance to the right of node C is 1 k in series with 1 k, or 2
k. This resistance is placed in parallel with the 2 k resistor seen from node C to
ground. The result is 1 k. In other words, from C to ground, we see 1 k. This
creates a 2:1 voltage divider with the 1 k resistor placed from B to C, so the
voltage at C must be half the voltage at B. This also points up the fact that the
current entering node C splits into two equal portions: one that travels towards point
D, and the other that travels through the 2 k resistor to ground. This is shown
graphically in Figure 12.10.

514
                                                                                                                    Figure 12.10
                                                                                                                    Ladder analysis.
                                                                                                                    a. Equivalent circuit (top).
                                                                                                                    b. Current division (bottom).

If you look at the equivalent circuit section of Figure 12.10, you will notice that this
portion now looks exactly like the final portion of the original network. That is,
every time a section is simplified and analyzed, the result will be a halving of
voltage and current. It is already apparent that the voltage at D must be half the
voltage at C, which in turn, must be half the voltage at B. As you can now prove, it
follows that the voltage at B must be half the voltage at A. In a similar fashion, the
current passing through each 2R leg is half the preceding current. (For current
division, the final section is not used to derive a current since it will be equal to the
value in the preceding stage.) The halving of current is just what is needed for the
binary representation of the digital input word.
Adapting the R/2R network to the DA converter is relatively easy. The network is
fed from a stable current source, with each 2R element feeding into a summing
amplifier. In series with each 2R element is a solid-state switch, which sets the
appropriate logic level. This is shown in Figure 12.11, with the network effectively
on its side. When a logical high is presented to a given bit, the switch is closed and
current flows through the 2R element and into the op amp. Note that the right end of
the resistor is effectively at ground, as the summing node of the op amp is a virtual
ground. If a logical low is presented, the switch shunts the current to ground,
bypassing the op amp. In this way, the appropriately weighted currents are summed
and used to produce the output voltage.

515
                                                                                                                     Figure 12.11
                                                                                                                     Converter with R/2R ladder.

This technique offers several advantages over the simpler weighted gain version.
First, all branches are fed by one common current source. Because of this, there is
no need for output level matching. Second, only two different values of resistors are
required for any number of bits used, rather than the impractically wide range seen
earlier. It is more economical to control the tolerance of just two different parts than
12 or 16. Note that small input currents are still generated for the least significant
bits, so attention to input bias and offset currents remains important.

Practical Digital-to-Analog Converter Limits

Perhaps the most obvious limit associated with the DA converter is its speed. The op
amp used in the DAC must be much faster than the final signals it is meant to
produce. A given output waveform may contain several dozen individual sample
points per cycle. The op amp must respond to each sample point. Consequently,
wide bandwidth and high slew rates are required.

Integrated DAC spec sheets offer a few important parameters of which you should be
aware. First of all, there is conversion speed. This figure tells how long it takes the
DAC to turn the digital input word into a stable analog output voltage. This sets the
maximum data rate. Next come the accuracy and resolution. Resolution indicates
the number of discrete steps that may be produced at the output, and is set by the
number of bits available. This is not the same as accuracy. Accuracy is actually
comprised of several different factors including offset error, error, and nonlinearity.
Offset error is normally measured by applying the all-zero input word and then
measuring the output signal. Ideally, this signal will be zero volts. The deviation
from zero is taken as the offset error. This has the effect of making all output levels
inaccurate by a constant voltage. Offset error is relatively easy to compensate for in
many applications by applying an equal offset of opposite polarity. Gain error is a

516
deviation that affects each output level by a constant percentage. It is as if the signal
were passed through a small amplifier or attenuator. This error may be compensated
for by using an amplifier with a gain equal to the reciprocal of the error. The two
gains will effectively cancel. The effect of offset and gain error are shown in Figures
12.12 and 12.13.

     Vout                                           } offset                               Figure 12.12
                                                                                           Offset error only.
                                     actual

                                             ideal

         0000  0001  0010                    0011           in

     Vout                                           } gain
                                                        error
                                                                                           Figure 12.13
                                                                                           Gain error only.

                     actual

                                             ideal

                                                              in

     0000      0001  0010                    0011

Nonlinearity errors may be broken into two forms: integral nonlinearity and
differential nonlinearity. Integral nonlinearity details the maximum offset between
the ideal outputs and the actual outputs for all possible inputs. Differential
nonlinearity details the maximum output deviation relative to one LSB caused by
two adjacent input words. If differential nonlinearity is beyond ±1 LSB, the system
may be non-monotonic. In other words, a higher digital input word may actually
produce a lower analog output voltage. These two forms of error are shown in

517
Figure 12.14. Note that it is possible to have high integral nonlinearity and yet still
have modest differential nonlinearity. This is the case in Figure 12.14b.

     Vout                                              ideal                             Figure 12.14a
                                                                                         Linearity error
               integral linearity error  actual                                          Integral linearity error.
               (largest overall error)

                                                                                in

     0000  0001            0010          0011    0100               0101  0110

     Vout                                                                                Figure 12.14b
                                                                                         Linearity error (continued)
           actual step                   actual                                          Differential linearity error
           size = 1.3 LSB                                    ideal                       (relative-adjacent error).

                                                       ideal step
                                                       size = 1 LSB

                                                                                in

     0000  0001            0010          0011    0100               0101  0110

                           1.3 LSB - 1 LSB = .3 LSB

As you can see, accuracy is dependent on rather complex factors. In an effort to boil
this down to a single number, some manufactures give an effective number of bits
specification. For example, a 16-bit DAC may be specified as having 14-bit
accuracy. This means that the 14 most significant bits behave in the idealized
fashion, but the lowest 2 bits may be swamped out by linearity errors. Another spec
that you will sometimes see is no missing codes. This means that for every increase
in the input word, there will be an appropriate positive output level change.
I
n practice, the standard DA converter is used with an output filter. As you can see
from the previous figures, the waveforms produced by the DAC contain a stair-step
side effect. Generally, this is not desirable. The abrupt changes in output level
indicate that higher frequency components are present. All components above the
Nyquist rate should be filtered out with an appropriate low-pass filter. This filter is

518
sometimes referred to as a reconstruction or smoothing filter. In an improperly
designed system, the reconstruction filter will remove some of the highest in-band
frequency components (i.e., components immediately below the Nyquist frequency).
To compensate for this, logic levels are often latched to the DAC for shortened
periods, thus creating a more spiked appearance, rather than the stair-step form. This
effect is shown in Figure 12.15. Although this spiked waveform appears to be less
desirable than the stair-step form, it creates higher levels for the uppermost
components, and after filtering, the result is a smoother overall frequency response.

     Vout                                                                                  Figure 12.15

                                                                                           Output reconstruction.

                                                                                           a. Full period latch (top).

                                                                                           b. Partial period latch

                                                                                           (bottom).

                                                                   t
     Vout

                                                                                        t

To further increase the quality of the output waveform, a technique known as
oversampling is sometimes employed. The basic idea is to create new sample points
in between the existing ones. The result is a much denser data rate, which hopefully,
will yield more exacting results after filtering. Also, the higher data rate may loosen
the requirements of the reconstruction filter. A typical system might use four times
oversampling, meaning that the output data rate is four times the original. Therefore,
for each input word, three new words have to be added. This effect is shown in
Figure 12.16.

519
Vout  original points                                                                      Figure 12.16
                                                                                           Oversampled output.

                                                                         t

                                              new points created by
                                              4X oversampling

There are a number of ways to create the new sample points. The most obvious way
is via simple interpolation, but this does not achieve the best results. Another
technique involves initializing the new values to zero and then passing the data
stream through a digital low-pass filter, which effectively calculates the proper
values. An extension of the oversampling principle is the delta-sigma technique. In
delta-sigma, very high rates of oversampling are used in conjunction with
specialized digital filter algorithms. The algorithms essentially trade the higher data
rate for a slower rate with increased resolution. The design and analysis of delta-
sigma systems is fairly advanced and is beyond the scope of this text. Suffice to say
that these techniques can increase the quality of the output signal and are widely
used in applications such as high-quality audio CD and DVD players.

Digital-to-Analog Converter Integrated Circuits

There are many possible applications for digital-to-analog converters, and a number
of different chips have evolved to meet specific needs. Generally, you can group
these into specific classes, such as high speed, high resolution, or low cost. We will
examine three representative types. The devices we will look at are the DAC0832; a
basic 8-bit unit, the DAC7545; a microprocessor-compatible 12-bit unit, and the
PCM1716; a 24-bit high-quality converter used in the audio industry.

DAC0832
This IC is a popular microprocessor-compatible 8-bit converter. The DAC0830 and
DAC0831 are similar, but with somewhat reduced performance. It is a multiplying
DAC. In other words, the output signal is a function of the digital input word and a
reference input. In some applications, the reference input is not fixed, but rather, is a
variable input signal. A feature list and pin-out are shown in Figure 12.17. Notable
items are a settling time of only 1 s, low power requirements, and high linearity.
The DAC0832 may be used in either stand-alone mode or with a microprocessor.
The switching waveforms are shown in Figure 12.18.

520
                                                                                                                     Figure 12.17
                                                                                                                     DAC0832.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

521
                                                                                                                     Figure 12.18
                                                                                                                     DAC0832 switching
                                                                                                                     waveforms

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

An interesting application of the DAC0832 can be found in Figure 12.19. Basically,
this is a digitally-controlled state variable filter.

                                                                                                                     Figure 12.19
                                                                                                                     DAC0832 state variable
                                                                                                                     filter application.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

522
Note that the converter replaces the input resistor of the second integrator. Normally,
that resistor would be used to convert the output voltage of the first integrator into an
input current for the second integrator. This job is now handled by the DAC0832.
The digital input word effectively sets the voltage-to-current conversion. Thus, a
change in the input word alters the tuning frequency of the filter just as a
potentiometer. Compare this circuit to the OTA-based voltage-controlled filter from
Chapter Eleven. Conceptually, they are very similar.

                                                                                                                     Figure 12.20
                                                                                                                     DAC7821.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instruments

523
DAC7821
The DAC7821 is a fairly standard 12-bit linear converter and is shown in Figure
12.20. Its interesting aspects are that it is a multiplying converter and that it is
microprocessor-compatible. The multiplying effect comes from the fact that a
reference is used to drive the R/2R ladder network. If the reference is changed, the
output is effectively rescaled. Consequently, you can think of the output signal as
equal to the reference value times the digital input word. You may also think of this
as a form of "digital volume control".
With the inclusion of a few extra logic lines, the IC has become microprocessor
compatible. This means that the DAC7821 has chip select and read/write lines along
with the 12 data input lines. This allows the converter to be connected directly to the
microprocessor data bus. By using memory-mapped I/O, the microprocessor can
write data to the converter just as it writes data to memory. A 16-bit microprocessor
system can present the converter with all of the data it needs during one write cycle,
however an 8-bit microprocessor will need two write cycles and some form of latch.
One address may be used for the lower 8 bits, and another address for the remaining
4 bits. A simplified system is shown in Figure 12.21 using an 8-bit microprocessor.

                                                                                                                  Figure 12.21
                                                                                                                  Microprocessor to DAC7821
                                                                                                                  interface.

                                                                                                                                               Reprinted courtesy of Texas
                                                                                                                                               Instruments

PCM5242
The PCM5242 is a stereo 24-bit converter designed specifically for high-quality
digital audio applications. It comes in a VQFN (Very thin Quad Flat No-lead)
package. A block diagram and feature list are shown in Figure 12.22a. Unlike the

524
other converters, the PCM5242 features serial input of data, not parallel. It includes
its own on-board serial conversion circuitry and logic. This technique helps to
reduce system cost. It is also surprisingly convenient as many specialized digital
signal processing ICs that might be used with the PCM5242 utilize a serial-type
output. This may be fed directly into the PCM5242 in 16-, 24-, or 32-bit format.

                                                                                        Figure 12.22a
                                                                                        PCM5242.

                                                                                        Reprinted courtesy of Texas
                                                                                        Instruments

525
The PCM5242 specification sheet is shown in Figure 12.22b. Note that this device is
specified with sampling rates from 48 kHz to 192 kHz. Total harmonic distortion
plus noise is typically 94 dB below a full-scale output when used with any of these
sample rates. Due to its high resolution and 114 dB dynamic range, extra care must
be taken during circuit layout to avoid hum pickup and RF interference.

                                                                                                                     Figure 12.22b
                                                                                                                     PCM5242 specifications.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instruments

526
Applications of Digital-to-Analog Converter Integrated Circuits

Example 12.4

Perhaps the first thing many people think of when they hear the terms
digital or digitized, is the audio compact disk, or CD for short. Home CD
players are excellent examples of the use of precision DA circuitry in our
everyday lives. Music data is stored on the CD with 16-bit resolution and a
sampling rate of 44.1 kHz. This produces a Nyquist frequency of 22.05 kHz,
which is high enough to encompass the hearing range of most humans. Error
correction and auxiliary data is also stored on the disk. The data is stored on
disk in the form of very tiny pits, which are read by a laser. The signal is
then converted into the common electronic logic form where it is checked
for error and adjusted as need be. The data stream is then fed to the DA
converter for audio reconstruction. A single converter may be multiplexed
between the two stereo channels, or two dedicated converters may be used.
Oversampling in the range of 2X to 8X is often used for improved signal
quality. A block diagram of the system is shown in Figure 12.23. The actual
DAC portion seems almost trivial when compared to some of the more
sophisticated elements.

laser     optics to                                                                Figure 12.23
CD        electronic                                                               Audio compact disk playback
          logic                                                                    system.

       error correction  reconstruction  audio to
       and data          DAC             amplifier
       adjustment

The storage density of the optical CD is quite remarkable. This small disk
(less than 5 inches in diameter) can hold 70 minutes of music. Ignoring the
auxiliary data, we can quickly calculate the total storage. We have two
channels of 16-bit data, or 32 bits (4 bytes) per sample point. There are
44,100 samples per second for 70 minutes, yielding 185.22 megasamples.
The total data storage is 5.927 gigabits, or 741 megabytes.

Example 12.5

         As we have already mentioned, it is possible to connect DACs directly to
         microprocessor systems. Furthermore, the microprocessor may write to the
         DAC with no more effort than writing to a memory location. The

527
microprocessor can write any series of data words we desire out to the DAC
and can repeat a sequence virtually forever. Given this ability, we can make
an arbitrary waveform generator. Instead of being locked into a set of pre-
defined wave shapes as on ordinary function generators, this system allows
for all manner of wave shapes. The accuracy and flexibility of the system
will depend on its speed and the available DAC resolution.

The basic idea is one of table look-up. For example, let's say that we have a             Figure 12.24
16-bit system. We will create a table of data values for one cycle of the                 Arbitrary waveform
output waveform. For convenience sake, we might make the table size a                     generator.
handy power of 2, such as 256. In other words, a single output cycle will be
chopped into 256 discrete time chunks. It is obvious, then, that the converter
must be a few hundred times faster than the highest fundamental that we
wish to produce. By increasing or decreasing the output data rate, we can
change the frequency of the output fundamental. This is known as a variable
sample rate technique. It is also possible to change the fundamental
frequency with a fixed rate technique (this is somewhat more complex, but
does offer certain advantages). An output flow chart is shown in Figure
12.24.

initialize table pointer to start (head)  0             data pointer
                                          1 data table   CPU register
         read data pointed to.            2
         store in CPU register

increment pointer                                                             CPU

                                                 255    DAC
write data to DAC address

      delay (if required)

if pointer at end of table,
reset to start

         Upon initialization, an address pointer is set to the starting address of the
         data table. The CPU reads the data from the table via the pointer. The pointer
         is incremented so that it now points to the next element in the table. (Some
         CPUs offer a post-increment addressing mode so that both steps may be
         performed in a single instruction.) Next, the CPU writes the data to the
         special DAC address. At this point, some form of software/hardware delay is
         invoked that sets the output data rate. After the delay, the CPU reads the next

528
data element via the pointer and continues as in the first run. Once the 256th
element is sent out, the pointer is reset to the start of the table and the
process continues on. In this way, the table can be thought of as circular, or
never-ending. If the system software is written in a higher level language,
the pointer/data table may be implemented as a simple array where the array
index is set by a counter. This will not be as efficient as a direct assembly
level approach, though.

The real beauty of this system is that the data table may contain virtually any
sequence of data. The data could represent a sine, pulse, triangle, or other
standard function. More importantly, the data could represent a sine wave
with an embedded noise transient, or a signal containing a hum component
just as easily. This data could come from three basic sources. First, the data
table can be filled through direct computation if the time-domain equation of
the desired function is known. Second, the data could be manufactured by
the user through some form of interaction with a computer, perhaps with a
mouse or drawing pad. Finally, the data may be derived from a real-world
signal. That is, an analog-to-digital converter may be used to record the
signal in digital form. The data may then be loaded into the table and played
back repeatedly. The arbitrary waveform generator allows its user to test
circuits and systems with a range of wave shapes that would be impossible
or impractical to generate otherwise.

Example 12.6

Under computer control, DA converters can be used as part of an automated
test equipment system. In order to fully characterize an electronic product, a
number of individual tests need to be run. Setting up each individual test can
be somewhat time consuming and is subject to operator error. Automating
this procedure may improve repeatability and decrease testing time. There
are many ways in which this process may be automated. We'll look at one
approach.

              signal  amp  voltmeter                                                       Figure 12.25
              source                                                                       Simple test setup.

         Let's assume that we would like to make frequency response measurements
         for an amplifier at 20 different frequencies. A circuit test system appropriate
         for this job is shown in Figure 12.25. To perform this test manually requires
         20 distinct settings of the source signal, and 20 corresponding output
         readings. This can prove to be rather tedious if many units are to be tested. It

529
would be very handy if there was some way in which the source frequency
could be automatically changed to preset values. This is not particularly
difficult. Most modern sources have control voltage inputs that may be used
to set the frequency. The required control voltage can be created and
accurately set through the use of a computer and DA converter. The
computer can be programmed to send specific digital words to the DAC,
which in turn feeds the signal source control input. In other words, the data
word directly sets the frequency of the signal source. The computer can be
programmed to send virtually any sequence of data words at almost any rate
and do it all without operator intervention. All the operator needs to do is
start the process. Test repeatability is very high with a system like this. A
block diagram of this system is shown in Figure 12.26.

signal  amp  voltmeter                                                                     Figure 12.26
source                                                                                     Automated test setup.

                                                    computer

         In order to record the data, the voltmeter may be connected to a strip chart
         recorder, or better yet, back to the computer. The data may be sent to the
         computer in digital form if the voltmeter is of fairly advanced design, or,
         with the inclusion of an analog-to-digital converter, the output signal may be
         directly sampled and manipulated by the computer. In either case, data files
         may be created for each unit tested and stored for later use. Also, convenient
         statistical analysis may be performed quickly at the end of a test batch. Note
         that because the DA converter only generates a control signal, very high
         resolution and low distortion is normally not required. If a high resolution
         converter is used, it is possible to create the test signals in the computer (as
         in the arbitrary function generator), and dispense with the signal source.

The automated test system is only one possible application of instrument control.
Another interesting example is in the generation of laser "light shows". A block
diagram of a simplified system is shown in Figure 12.27. In order to create the
complex patterns seen by the audience, a laser beam is bounced off of tiny moving
mirrors. The mirrors may be mounted on something as simple as a galvanometer.
The galvanometer is fed by a DAC. The pattern that the laser beam makes is
dependent on how the galvanometer moves the mirror, which is in turn controlled by
the data words fed to the DAC. In practice, several mirrors may be used to deflect the
beam along three axes.

530
                                                                                          Figure 12.27
                                                                                          Computer-controlled lighting.

     laser

                                 DAC  computer

            mirror/galvanometer

DA converters can be used to adjust any device with a control-voltage type input.
Also, they may be used to control electromechanical devices that respond to an
applied voltage. Their real advantage is the repeatability and flexibility they offer.

12.5 Analog-to-Digital Conversion                                                         Figure 12.28
                                                                                          Symbol for the track-and-hold
Now that you know the basics behind digital-to-analog conversion, we may examine          amplifier.
the converse system, analog-to-digital conversion. The analog-to-digital conversion
process is sometimes referred to as quantization, implying the individual discrete
steps that the output assumes. There are several techniques to produce the
conversion. Some techniques are optimized for fastest possible conversion speed,
and some for highest accuracy. We will investigate the more popular types.

The concept of AD conversion is simple enough: you wish to measure the voltage of
the incoming waveform at specific instances in time. This measurement will be
translated into a digital word. One practical limitation is the fact that the conversion
circuitry may require a small amount of computation or translation time. For
ultimate accuracy, then, it is important that the measured waveform not change
during the conversion interval. To do this, specialized subcircuits called track-and-
hold (or sample-and-hold) amplifiers are used. They are usually abbreviated as T/H
or S/H. Their job is to capture an input potential and produce a steady output to feed
to the AD converter. The T/H schematic symbol is shown in Figure 12.28. When the
T/H logic is in track mode, the circuit acts as a simple buffer, so its output voltage
equals its input. When the logic goes to the hold state, the output voltage locks at its
present potential and stays there until the circuit is switched back to track mode. A
representation of this operation is shown in Figure 12.29.

531
       Vin                                                                                   Figure 12.29
                                                     Vout                                    Track-and-hold operation.

                                                                              t

H      T  H  T  H                                          T  H  T

In reality, the track-and-hold process is not perfect, and errors may arise. These      Figure 12.30
errors are shown magnified in Figure 12.30. First of all, there is a small delay        Track-and-hold errors.
between the time the logic signal changes and the T/H starts to react. The exact
amount of time is variable and is responsible for aperture error. This is equal to the
voltage difference between the signals at the desired and actual times. Also, due to
the dynamic nature of the process of switching from track to hold, some initial
ringing may occur in the hold waveform.

                                                                                Vin

           aperture
           error

                                                                 feedthrough     } droop

                                                                              Vout

                                                                                 t

                transient settling time

          aperture uncertainty (jitter)
            hold

track

You can see that as time progresses, the hold waveform tends to decay toward zero.
This is because the held voltage is usually formed across a capacitor. Although the
discharge time constant can be very long, it cannot be infinite, and thus, the charge

532
eventually bleeds off. This parameter is measured by the droop rate (fundamental
units of volts per second). Finally, the possibility of feedthrough error exists. If a
large change occurs on the input waveform during the hold period, it is possible that
a portion of the signal may "leak" through to the T/H output. These errors are
particularly troublesome when working with high-resolution converters. Lower-
resolution systems may not be adversely affected by these relatively small
aberrations.

In order to create a T/H, a pair of high-impedance buffers are normally used, along
with some form of switch element and a capacitor to hold the charge. Examples are
shown in Figure 12.31. Figure 12.31a shows the general voltage type, open-loop
T/H. The buffers exhibit high input impedance. When the switch is closed, op amp 1
directly feeds op amp 2, and therefore the output voltage equals the input voltage.
Normally, the hold capacitor is relatively small and does not adversely affect the
drive capability of op amp 1.

                                                                                                                     Figure 12.31a
                                                                                                                     Track-and-hold circuits.
                                                                                                                     General open-loop voltage
                                                                                                                     mode track-and-hold.

A more detailed version of this circuit is shown in Figure 12.31b. Each op amp is a
FET input type for minimum input current draw. The switch is a simple JFET which
is controlled by a comparator.

                                                                                                                     Figure 12.31b
                                                                                                                     Track-and-hold circuits.
                                                                                                                     Op amp based track-and-hold.

When the T/H logic is high, the gate of the JFET is high, thus producing a low on-
resistance (i.e., a closed switch). When the comparator output goes low, the JFET is
turned off creating a high impedance (i.e., open switch). In this state, op amp 2 is fed
by the hold capacitor and buffers this potential to its output. For minimum droop, it
is essential that the capacitor be a low leakage type and that op amp 2 have very low
input bias current (e.g., FET input). The input resistor is used only to limit possible
destructive discharge currents when the circuit is switched off. The diode positioned
between the comparator and FET is used to prevent an excessively large positive

533
comparator output potential from reaching the gate of the FET and possibly
damaging it. (A comparator high will reverse-bias the series diode.) Figure 12.31c
shows an alternate circuit using a closed-loop, current-mode approach. Note that the
hold capacitor is now forming part of an integrator. While the open-loop form offers
faster acquisition and settling times, the closed-loop system offers improved signal
tracking.

                                                                                                                  Figure 12.31c
                                                                                                                  Track-and-hold circuits.
                                                                                                                  General closed-loop current
                                                                                                                  mode track-and-hold.

A closed-loop voltage-mode is also possible, but the current form generally offers
fewer problems with leakage and switching transients. For general-purpose work, a
variety of track-and-hold amplifiers are available in IC form from several
manufacturers.

Computer Simulation

A simulation of a track-and-hold circuit similar to the one shown in Figure 12.31b is
shown in Figure 12.32. The 100 Hz input signal is being sampled at 2 kHz, or 20
times per cycle.

                                                                                                                  Figure 12.32a
                                                                                                                  Track and hold circuit in
                                                                                                                  Multisim.

534
Three waveforms of interest are shown in the Transient Analysis graph. The input
waveform is seen in the center as the smoothly varying sine wave. Along the bottom
of the graph, narrow spikes can be seen. This is the T/H logic signal. The high
portion of the pulse (at 0 volts) is the track logic, and the wider low signal (dropping
below the -1 volt limit of the graph) represents the hold logic. The stair-stepped sine
wave is the output voltage. Note how the circuit acquires or tracks the input signal
during the track pulse and then remains at that level when the hold logic is applied.
It is during these hold times that the computations will be performed by the analog-
to-digital converter.

                                                                                                                     Figure 12.32b
                                                                                                                     Multisim waveforms for track-
                                                                                                                     and-hold circuit.

Analog-to-Digital Conversion Techniques

Several different techniques have evolved for dealing with differing system
requirements. These include flash, staircase, successive approximation, and delta-
sigma forms.
Flash conversion is generally used for high-speed work, such as video applications.
The circuits are usually low resolution. A flash converter is made up of a string of
comparators as shown in Figure 12.33. The input signal is applied to all of the
comparators simultaneously. Each comparator is also tied into a reference ladder.
Effectively, there is one comparator for each quantization step. When a given signal
is applied, a number of comparators towards the bottom of the string will produce a
high level, as Vin will be greater than their references. Conversely, the comparators
towards the top will indicate a low. The comparator at which the outputs shift from
high to low indicates the step value closest to the input signal. The set of comparator

535
outputs can be fed into a priority encoder that will turn this simple unweighted
sequence into a normal binary word.

                                                                                          Figure 12.33
                                                                                          Flash converter.

The only time delay involved in the conversion is that of logic propagation delay.
Therefore, this conversion technique is quite useful for rapidly changing signals. Its
downfall lies in the fact that one comparator is needed for each possible output step
change. An 8-bit flash converter requires 256 comparators, whereas a 16-bit version
requires 65,536. Obviously, this is rather excessive, and units in the 4- to 6-bit range
are common. Although 6-bit resolution may appear at first to be too coarse for any
application, it is actually quite useful for video displays.

For high-resolution work, some other technique must be used. One possibility is
shown in Figure 12.34. This is called a staircase converter. Its operation is fairly
simple. When a conversion is first started, the output of the counter will be all zeros.
This produces a DAC output of zero, and thus, the comparator output will be high.
The next clock cycle will increment the up counter, causing the DAC output to
increase by one step-level. This signal is compared against the input, and if the input
is greater, the output will remain high. The clock will continue to increment the
counter in this fashion until the DAC output just exceeds the input level. At this point
the comparator output drops low, indicating that the conversion is complete. This
signal can then be used to latch the output of the counter. This circuit gets its name
from the fact that the waveform produced by the DAC looks like a staircase. The
staircase technique can be used for very high-resolution conversion, as long as an
appropriate high resolution DAC is used. The major problem with this form is its
very low conversion speed, due to the fact that there must be time to test every

536
possible bit combination. Consequently, a 16-bit system requires 65,536
comparisons. Even if a fast 1 microsecond DAC is used, this would limit the
sampling interval to nearly 66 milliseconds. This translates to a maximum input
frequency before aliasing of only 7 Hz. Noting that the lowest frequency most
humans can hear is about 20 Hz, this technique is hardly suitable for something like
digital audio recording. In fact, for general-purpose work, the staircase system is
avoided in favor of the successive approximation technique.

         clock       up counter                                                            Figure 12.34
                                                 latch                                     Staircase converter.

                     DAC    V

     in         +

                -

                comparator

                                                                                        t

Successive approximation is a good general-purpose solution suitable for systems
requiring resolutions in the 16-bit area. Instead of trying to convert the input signal
at one instant like the flash converter, this technique creates the output bit by bit.
Unlike the staircase converter, each individual level does not need to be tested.
Instead, a binary search algorithm is used. You might think of it as making a series
of guesses, each time getting a little closer to the result. Each guess results in a
simple comparison. For an n-bit output, n comparisons need to be made.

                     clock                                                                 Figure 12.35
                                                                                           Successive-approximation
                                                                                           converter.

                      successive
                     approximation

                          logic
                                                   latch

     in  +

         -           DAC

         comparator

537
A block diagram of a successive approximation converter is shown in Figure 12.35.
Instead of a simple up counter, a circuit is used to implement the successive
approximation algorithm. Here is how the circuit works. The first bit to be tested is
the most significant bit. The DAC is fed a 1 with all of the remaining bits being set to
0 (i.e., 100000...). This word represents half of the maximum value capable by the
system. The comparator output indicates whether Vin is greater or less than the
resulting DAC output. If the comparator output is high, it means that the required
digital output must be greater than the present word. If the comparator output is low,
then the present digital word is too large, so the MSB is set to 0. At this point, the
next most significant bit is tested by setting it to 1. The new word is fed to the DAC,
and again, the comparator is used to determine whether or not the bit under test
should remain at 1 or be reset. At this point the two most significant bits have been
determined. The remaining bits are individually set to 1 and tested in a similar
manner until the least significant bit is determined. In this way, a 16-bit system only
requires 16 comparisons. With a 1 microsecond DAC, conversion takes only 16
microseconds. This translates to a sampling rate of 62.5 kHz; thus a maximum input
frequency of 31.25 kHz is allowed. As you can see, this is far more efficient than the
staircase technique.

For the highest resolutions combined with high sample rates, delta-sigma conversion
techniques are popular. Basically, a low-resolution converter is run at a rate many
times higher than the Nyquist frequency (perhaps 256 times higher). A special
digital filter called a decimator converts the low-resolution high sample-rate data
stream into a lower rate with higher resolution. This technique can achieve
conversions in the 50 kHz range with 20-bit resolution. Design and analysis of delta-
sigma modulators and digital filters is an advanced topic beyond the scope of this
text. We will, however, look at a representative IC in the next section.

Analog-to-Digital Converter Integrated Circuits

In this section we will examine a few specific ADC ICs, along with selected
applications. The ICs include the ADC0844, an 8-bit microprocessor-compatible
unit; the ADC12181, a very fast 12-bit converter utilizing pipeling techniques; and
the CS5396, a 24-bit converter designed primarily for audio applications.

ADC0844
A block diagram of the ADC0844 is shown in Figure 12.36. Along with the built-in
clock and 8-bit successive approximation register (SAR), the IC also includes an
input multiplexer, tri-state latches and read, write, and chip select logic pins. This
means that the ADC0844 is easily interfaced to a microprocessor data bus and may
be used as a memory-mapped I/O device. This IC is a moderate-speed device,
showing a typical conversion speed of 40 microseconds. The timing diagram for the
ADC0844 is shown in Figure 12.37. A conversion is initiated by bringing both the
chip-select and write-logic lines low. The falling edge of write resets the converter
and its rising edge starts the actual conversion. After the conversion period, which is

538
set internally, the digital data may be transferred to the output latches with the read-
logic line. Note that the pulse repetition rate of the write-logic line sets the sampling
rate. Therefore, a small program running on the host microprocessor that reads and
writes to the ADC may be used to control the sampling rate and store the data for
later use.

                                                                                                                     Figure 12.36
                                                                                                                     The ADC0844.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

539
                                                                                                                     Figure 12.37
                                                                                                                     Timing diagram for the
                                                                                                                     ADC0844.

                                                                                                                                                   Reprinted courtesy of Texas
                                                                                                                                                   Instrutments

LTC2282
The LTC2282 is a 12-bit, 105 mega-samples per second converter with an internal
sample-and-hold. Its data sheet is shown in Figure 12.38. In order to achieve its
combination of high sample rate with relatively high resolution, the LTC2282 relies
on a technique known as pipelining. In this particular chip, the pipeline consists of
six stages. Each stage produces a digital signal of just three bits and an error signal
known as a residual. The residual is passed to the following stage where it is
multiplied by a fixed gain, thus bringing it up to the former bit-weight. The newly
resulting residue is passed to the next stage where the process is repeated. In
essence, the signal propagates down the pipeline in a fashion conceptually similar to
the successive approximation technique. Note that pipelining speeds the conversion
540
process because once the residual is passed to the next stage, the prior stage(s) can
begin work on the following sample(s).

                                                                                                                     Figure 12.38a
                                                                                                                      LTC2282.

                                                                                                                                                   Reprinted courtesy of Linear
                                                                                                                                                   Technology

541
                                                                                                                     Figure 12.38b
                                                                                                                      LTC2282 block diagram.

                                                                                                                                                   Reprinted courtesy of Linear
                                                                                                                                                   Technology

The LTC2282 is used for applications requiring both high speed and high resolution.
It also offers self-calibration, single +5 V power supply operation, and low power
consumption.

CS5381
The CS5381 offers stereo 24-bit resolution with a maximum sampling rate of 192
kHz. This is ideal for a wide range of high-quality digital audio systems. The
CS5381 data sheets are shown in Figure 12.39. This IC uses the delta-sigma
conversion technique and achieves a dynamic range of 120 dB. The signal-to-noise
plus distortion rating (THD+N) is typically 110 dB. The device over-samples the
input at 6.144 MHz and has logic settings for 1X, 2X and 4X effective conversion
rates at its output. For example, the standard pro-audio sampling rate is 48 kHz with
double rate at 96 kHz and quad rate at 192 kHz.
As with any high-resolution converter, you must be particularly careful with the
circuit layout or excessive noise may result. Attention must be paid to proper power
supply bypassing. The CS5381, like many ICs in this category, requires separate
analog and digital power supplies. Although this IC only requires 5 V, note that there
are separate physical connections for analog and digital power. Standard logic
supplies are often too noisy for use on such precision devices and will degrade
overall audio performance when applied to the analog portion of the IC.

542
                                                                                                                     Figure 12.39a
                                                                                                                     CS5381.

                                                                                                                                                   Reprinted courtesy of Cirrus Logic, Inc.

543
                                                                                                                   Figure 12.39b
                                                                                                                   CS5381 connection diagram.

                                                                                                                                                Reprinted courtesy of Cirrus Logic,
                                                                                                                                                Inc.

Applications of Analog-to-Digital Converter Integrated Circuits

Example 12.7
         Perhaps the most straightforward application of analog-to-digital conversion
         is the acquisition of a signal. Once in the digital domain, the signal may be
         processed in a variety of ways. An example of this is the Digital Sampling
         Oscilloscope (DSO). A simplified block diagram of a DSO is shown in
         Figure 12.40. Since the final output of the system is a simple graph, it
         generally does not make sense to resolve the input beyond 8 bits (256 steps),
         and often even fewer bits may be used. Typically, high sampling rates are

544
     more important than fine resolution in this application. Consequently, 12-
     and 16-bit converters are not found here. Instead, lower-resolution
     converters capable of sampling at hundreds of MHz are used.

     ADC  RAM             driver  display                                        Figure 12.40
                                                                                 Basic digital sampling
                                                                                 oscilloscope.

          microprocessor

     DSOs can usually be run in one of two modes: continuous, or single-shot. In
     single-shot mode, the ADC acquires the signal and stores it in memory. This
     data can then be routed to the display circuits continuously in order to create
     a trace on the display. The signal is captured and stored in computer
     memory, thus it can be replayed virtually forever without a loss of clarity.
     This is very useful for catching quick, non-repetitive transients. Once the
     signal is captured, it may be examined at leisure. For that matter, if some
     form of level-sensing logic is included, sampling can be initiated by specific
     transient events. This is known as baby-sitting. For example, you might
     suspect that a circuit you have designed occasionally emits an undesirable
     voltage spike. It is not practical for you to hook up the circuit and stare at the
     face of an oscilloscope, perhaps for hours, waiting for the system to
     misbehave. Instead, the DSO can be programmed to wait for the transient
     event before recording. In this way, you can leave the system, and when you
     return some time later, the spike will have been recorded and will be waiting
     your inspection.

                                                                                                                Figure 12.40
                                                                                                                Commercial MDO.

                                                                                                                                          Copyright © Tektronix. Reprinted with
                                                                                                                                          permission. All rights reserved

545
         An extension of this concept is pre-trigger recording. In this variation, the
         DSO is constantly recording and "throwing away" data. When the transient
         spike finally occurs, the DSO has a snapshot of the events leading up to the
         spike, as well as the spike itself. This can provide very useful information in
         some applications. In either case, since the data is in digital form, it may be
         off-loaded to a computer for further analysis. Indeed, many DSOs offer some
         interesting on-board analysis functions, including signal smoothing (noise
         reduction), trace cursors which allow for easy delta time/delta voltage
         computation, basic math functions, spectrum computation via FFT and more.

         In continuous mode, a DSO appears to operate in much the same fashion as
         an ordinary analog oscilloscope. In this mode, the DSO samples the input
         signal and passes the data out to memory. From here the data is relayed to
         the display circuitry where a trace is produced. The trace is being constantly
         updated, so any change in the input will be quickly displayed.

         The basic concept of the DSO has been expanded to the MSO and the MDO.
         The MSO, or Mixed Signal Oscilloscope, adds digital domain measurements
         while the MDO, or Mixed Domain Oscilloscope, extends the MSO into the
         frequency domain as well.

Example 12.8

         Another interesting application of the analog-to-digital converter is in the
         digital sampling music keyboard or drum computer (generally referred to as
         a sampler). The usage of a sampler is quite straightforward, actually. The
         idea is to mimic the sound of a given instrument (such as a trumpet or flute)
         from the keyboard. Before the advent of the sampler, this was done by
         properly setting the filters, amplifiers and oscillators of a keyboard
         synthesizer. Although the resulting sounds were reasonably close to the
         desired instrument, they usually weren't close enough to fool the average
         listener. The sampler bypasses the problems of synthesizers by directly
         recording an instrument with an analog-to-digital converter. For example, a
         trumpet player might sound an A into a microphone that is connected to the
         sampler. This note is digitized and stored in RAM. Now, when the keyboard
         player hits the A key, the data is retrieved from RAM and fed to a DAC
         where it is reconstructed. The result is the exact same note that the trumpet
         player originally produced. By recording several different pitches from
         many different instruments, the keyboard player literally has the power of an
         entire orchestra at his fingertips. Of course, there is no limit to the sounds
         that might be sampled, and the keyboardist could just as easily use the
         sampler to "play" a collection of dog barks, door slams, and bird calls. A
         sampling drum computer is similar to a sampling keyboard, but replaces the

546
     standard musical keyboard with a series of buttons that allow the musician
     to create a programmed sequence of notes. This sequence can be played
     back at any time, and at virtually any tempo. In this manner, an entire
     percussion section may be simulated using digital recordings of real drums.
     A block diagram of a typical musical sampling system is shown in Figure
     12.42.

             CPU and     system ROM       front panel                                                       Figure 12.42
             main logic                   logic and                                                         Block diagram of musical
                                          controls                                                          instrument sampling and
                                                                                                            playback device.

     clock               system RAM
     system              (user programs)

                                          DAC
                                          (reconstruction)

             ADC         sample           final audio
             (sampling)  RAM              circuitry

                                                                                                   audio
                                                                                                   outputs

     Further enhancements to the digital sampling musical instrument include
     direct connections to personal computers. In this way, the computer can be
     used to analyze and augment the sound samples in new ways. For example,
     the personal computer may be used to create a graphic display of the
     waveform, or compute and display the spectral components of the sound
     using a popular technique called the Fast Fourier Transform. An example is
     shown in Figure 12.43. Finally, the computer can be programmed to "play"
     the sampler. In this way, even non-keyboardists can take advantage of the
     inherent musical flexibility this system offers.

547
                                                                                                                  Figure 12.43
                                                                                                                  Commercial waveform
                                                                                                                  display and editing software.

                                                                                                                                              Reprinted courtesy of dissidents

12.6 Extended Topic
Digital Signal Processing

Much has been said in this chapter concerning the ability of personal computers to
store and manipulate data in the digital domain. This process is called digital signal
processing, or DSP. The sampled data is generally stored in RAM as a large array of
values. Normally, the data is in integer form. This is because microprocessors are
generally faster at performing integer calculations than floating point calculations.
Also, AD converters produce integer values, so this is doubly convenient. As an
548
example, if 8-bit resolution is used, each sample point will require one byte (8 bits).
The byte is the fundamental unit of computer memory storage, and thus storage as a
simple byte multiple (8 bits, 16 bits, 32 bits) is straightforward. The data may be
stored in either unipolar (unsigned) or bipolar (signed) formats. For unsigned
systems, the data value "0" means "most negative peak". In signed systems, a two's
compliment form is normally used. Here, a data value of "0" means "0 V". All
negative values have their most significant bit set (for an 8 bit representation,
-1 = 11111111, -2 = 11111110, etc.). Input signals are often AC, thus signed
representations are quite common.

In BASIC, the data array might be called data(), and individual elements are
accessed by properly setting the array index. The first element is data(1), the
second is data(2), and the Nth element is data(N). Although BASIC is useful, it is
not as powerful as languages such as C, which offer direct manipulation of memory
addresses via pointers. In C, the starting, or base, address of the data might be given
the name data_ptr. To access different elements in the array, an offset is added to
the base. The address of the second element is data_ptr + 1, the third is
data_ptr + 2, and so on. Alternately, we could just increment the pointer
continuously, as in data_ptr++. Direct manipulation of pointers is generally faster
for the microprocessor than array indexing. To find the value stored at a given
address, C uses the indirection operator, *. To assign the second data value to the
variable x, you would say x = *(data_ptr + 1) or simply
x = *data_ptr++ if the pointer is being continuously incremented. The BASIC
equivalent is x = data(2).

No matter how the data is accessed, any mathematical function may be applied to
the data elements. In the examples below, C is used to illustrate the concepts. Only
the processing portion of the code is shown. The source array is called src() and
has TOTAL number of elements. The destination array is called dest(). Also,
questions concerning integer versus floating point representation are bypassed in
order to keep the examples as straightforward as possible. In the real world,
problems such as execution speed, round-off error, and overflow cannot be ignored.

Let's start with something simple. Suppose we would like to simulate the operation
of an inverting buffer. An inverting buffer simply multiplies the input signal by -1.
Here is how we do this in the digital domain: each point is multiplied by -1.

                                for( i=0; i<TOTAL; i++ )
                                {

                                           *dest++ = -1 * (*src++);
                                }

We can extend this concept a bit further by replacing "-1" with a variable called
"gain". In this way, we can alter the signal amplitude digitally.

549
Another useful calculation is average value. For signed data, the average value is
equal to the DC offset component.

                                sum = 0;
                                for( i=0; i<TOTAL; i++ )
                                {

                                           sum += *src++;
                                }
                                average = sum / TOTAL;

In order to add a DC offset, a constant is added to each data element in turn.

                                for( i=0; i<TOTAL; i++ )
                                {

                                           *dest++ = offset + (*src++);
                                }

We might wish to combine two different waveforms into a third waveform. Simple
addition is all that is required. (The example assumes that both arrays are the same
size).

                                for( i=0; i<TOTAL; i++ )
                                {

                                           *dest++ = (*src++) + (*src2++);
                                }

If the two source arrays are multiplied instead of added, signal modulation may be
produced.

These examples are relatively simple. With proper programming, a wide variety of
functions may be simulated including spectral analysis, translation to new sampling
rates, and the realization of complex filter functions that are impractical to
implement in the analog domain. The major drawback of DSP techniques is the
inherent computing power required. Thus, real-time application of complex DSP
principles is not possible without using powerful computers. Specialized ICs have
been designed to implement DSP sub-functions very quickly. These chips make real-
time DSP practical and ecomical. The DSP ICs are programmable, thus they offer the
distinct advantage of being able to produce different functions at different times by
loading new programs. In this way, they are far more flexible than dedicated analog
circuits. For example, an all-DSP guitar effects unit encompassing a broad range of
functions such as equalization, pitch shifting, chorusing, reverberation and other
effects can be designed. The amplitude and spectral shaping is performed directly in
the digital domain instead of using dedicated analog circuitry.

550
Summary

In this chapter we have covered the basic concepts of analog-to-digital and digital-
to-analog conversion. By placing a signal in the digital domain, a variety of new
analysis, storage, and transmission techniques become available.

The process of transforming an analog signal into a digital representation is referred
to as quantization, or more simply, as digitizing or sampling. One of the most
popular methods used is PCM, pulse code modulation. In this scheme, the input
signal is measured, or sampled, at a constant rate. Each sample point is represented
as a digital word. The sequence of words describes the input signal and is used to
recreate it, if necessary. The ultimate accuracy of the conversion is dependent on the
resolution and sampling rate of the system. Resolution refers to the number of bits
present in the digital word. An 8-bit word can represent 256 steps, whereas a 16-bit
word is much finer, offering 65,536 discrete steps. With so many steps, round-off
error is much less of a problem in 16-bit systems than in, say, 8- or 12-bit systems.

The minimum allowable sampling rate is twice the highest input frequency. In other
words, at least two samples per cycle are required for the highest harmonic in the
input signal. Another way of stating this is that no input frequency component can
exceed the Nyquist frequency, which is defined as one-half of the sampling
frequency. If the input exceeds this limit, alias distortion may occur. Aliases are
nonharmonically-related frequencies that are effectively created by improper
sampling. In order to remove all possibility of alias distortion, special high-order
low-pass filters, called anti-alias filters, are normally placed before the sampling
circuitry.

Two popular methods of analog-to-digital conversion are the flash and successive
approximation techniques. Flash converters are very fast, but require one comparator
per output step, so they are not normally used where high resolution is required.
Successive approximation takes longer than flash conversion, but can produce
resolutions in excess of 16 bits. In either case, the conversion process is not
instantaneous, and any fluctuation of the input signal during the conversion can
produce errors. In order to alleviate this difficulty, special track-and-hold amplifiers
are used between the anti-alias filters and the AD converter to create a non-varying
signal.

Once the signal has been digitized, it may be stored in RAM or some other media for
future use, or directly analyzed. Often, a personal computer can prove to be very
useful for waveform analysis.

To reconstruct the waveform, a digital-to-analog converter is used. In essence, this is
usually little more than a weighted summing amplifier. Due to accuracy and
construction constraints, an R/2R ladder technique is often employed. In order to
smooth out the resulting waveform and remove any remaining digital "glitches", the

551
signal is passed through a reconstruction filter. This is a low-pass filter and is often
called a smoothing filter. Generally, the process of digital-to-analog conversion is
much faster than analog-to-digital conversion. Indeed, the successive approximation
analog-to-digital scheme requires an internal digital-to-analog converter.

Applications for AD and DA converters range from laboratory instruments such as
digital sampling oscilloscopes and hand-held digital multimeters, to industrial
instrument and device control. AD and DA systems have found a large application
market in the commercial sector. Uses include the popular music CD player and
musical keyboard equipment.

Review Questions

    1. What is PCM?
    2. Define the term resolution.
    3. What is quantization?
    4. What is an alias, and how is it produced? How is an alias avoided?
    5. Define Nyquist frequency, and discuss the importance of this parameter.
    6. Explain how a summing amplifier may be used to create a digital-to-analog

         converter.
    7. Explain the difference between integral nonlinearity and differential

         nonlinearity.
    8. What is a smoothing (reconstruction) filter?
    9. What is the purpose of a track-and-hold amplifier?
    10. Detail the differences between flash conversion and the successive

         approximation technique. Where would each type be used? What are their
         limitations?
    11. Give several examples of possible DSP functions.

Problems

Analysis Problems

    1. Determine the number of quantization steps for a 10-bit system.
    2. A 14-bit converter produces a maximum peak-to-peak output of 2.5 V. What

         is the step size?
    3. Determine the dynamic range of the converters in Problems 1 and 2.
    4. We wish to resolve a 1 V peak-to-peak signal to at least 1 mV. What is the

         minimum allowable number of bits in the converted data?
    5. We wish to create analog signals using an arbitrary waveform generator. If

         we send out digital words at the rate of 50 kHz, what is the maximum
         allowable conversion speed for the DAC?

552
    6. Assume that we are trying to digitize ultrasonic signals lying between
         25 kHz and 45 kHz. A) What is the Nyquist frequency? B) What is the
         minimum acceptable sampling rate?

    7. Determine the maximum allowable conversion time for the ADC of Problem
         6.

    8. Given a 14-bit ADC, A) Determine the number of comparators required for
         the flash technique. B) Determine the number of comparisons required if the
         successive approximation technique is used.

    9. Assume that a single 16-bit ADC is connected to an embedded computer.
         The sampling rate is 10 kHz. Determine the data rate in bytes per second.

    10. Referring to Problem 9, if the computing device has 350 k bytes of RAM
         available for data storage, how much time does this represent?

    11. DAT (digital audio tape) recorders normally use a 16 bit representation with
         a sampling rate of 48 kHz. If the unit is used to record a performance of
         Stravinsky's "Rite of Spring" (35 minutes total), what is the required storage
         capacity in bytes?

    12. If the data is transferred serially from the DAT of Problem 11 to a digital
         signal processing IC in real time, what is the width of each individual pulse?

    13. A 12-bit 2-microsecond DAC is used as part of a discrete successive
         approximation analog-to-digital converter. Assuming that logic delays and
         signal settling times are negligible, determine: A) The minimum time
         allowable between sample points. B) The maximum input signal frequency
         without aliasing.

    14. A 6-bit video DA converter produces a maximum output swing of
         approximately 1.25 V (unipolar). Determine the output voltage for the
         following digital input words. A) 000001 B) 100000 C) 111111 D) 011101

    15. A 10-bit instrumentation DAC produces an output of 16 mV with an input of
         0000000100. Determine: A) The step size B) The maximum output signal.

    16. An 8-bit ADC produces a full scale output of 11111111 with a 2 V input
         signal. Determine the output word given the following inputs. (Assume that
         this converter rounds to the nearest output value and is unipolar.)
         A) 100 mV B) 10 V C) 0 V D) 1.259 V

    17. Assume that comparator/logic delays, amplifier settling times, and other
         factors require 400 ns total in a particular IC fabrication technique. If this
         technology is used to create AD converters, determine the maximum
         conversion time for the following 8-bit converters: A) Flash B) Successive
         approximation C) Staircase/Ramp type

553
Design Problems
    18. We wish to digitize human voice signals. The maximum input frequency is
         to be limited to 3 kHz and resolution to better than 0.5% of the maximum
         input value is required. A) Draw a block diagram of the complete system.
         B) Determine the minimum bit requirement. C) Determine the minimum
         sampling rate if the Nyquist rate is set to 25% greater than the theoretical
         minimum. D) Determine the anti-alias filter tuning frequency. E) Determine
         the preferred conversion technique. F) Determine which of the ICs presented
         in the chapter is best suited for this system.
    19. We wish to design a system capable of digitizing complex signals with a
         spectrum ranging from DC to 400 kHz. Accuracy must be at least 0.2% of
         full scale. A) Draw a block diagram of the complete system. B) Determine
         the minimum bit requirement. C) Determine the minimum sampling rate if
         the Nyquist rate is set to 20% greater than the theoretical minimum.
         D) Determine the anti-alias filter tuning frequency. E) Determine the
         preferred conversion technique. F) Determine which of the ICs presented in
         the chapter is best suited for this system.
    20. Write a computer algorithm that can be used to "flip" digital data back to
         front. (i.e., play it backwards).
    21. Write a computer algorithm that will determine the maximum peak value of
         the digital data.
    22. Write a computer algorithm that will determine the RMS value of the digital
         data.

554
Appendix A

                       Manufacturer's Data Sheet Links

These links are current as of November, 2019 and are listed here for convenience. Always check the
manufacturer's site for the latest information before beginning any new design. Note that some product lines and
companies have been acquired by other companies since the original production of a given IC. Examples include
the acquisitions of Burr-Brown and National Semiconductor by Texas Instruments. Consequently, links to a
National Semiconductor op amp such as the LF411 lead to the Texas Instruments web site.

AD834 http://www.analog.com/media/en/technical-documentation/data-sheets/AD834.pdf
AD847 http://www.analog.com/media/en/technical-documentation/data-sheets/AD847.pdf
ADC0844 http://www.ti.com/lit/ds/symlink/adc0848.pdf

CLC1606 http://www.exar.com/content/document.ashx?id=21395
CS5381 http://www.cirrus.com/en/pubs/proDatasheet/CS5381_F2.pdf

DAC0832 http://www.ti.com/lit/ds/symlink/dac0832.pdf
DAC7821 http://www.ti.com/lit/ds/symlink/dac7821.pdf

LF411 http://www.ti.com/lit/ds/symlink/lf411.pdf
LM301 http://www.ti.com/lit/ds/symlink/lm301a-n-mil.pdf
LM311 http://www.ti.com/lit/ds/symlink/lm311.pdf
LM317 http://www.ti.com/lit/ds/symlink/lm317.pdf
LM386 http://www.ti.com/lit/ds/symlink/lm386.pdf
LM723 http://www.ti.com/lit/ds/symlink/lm723.pdf
LM741 http://www.ti.com/lit/ds/symlink/lm741.pdf
LM2576 http://www.ti.com/lit/ds/symlink/lm2576.pdf
LM3578 http://www.ti.com/lit/ds/symlink/lm3578a.pdf
LM3886 http://www.ti.com/lit/ds/symlink/lm3886.pdf
LM3900 http://www.ti.com/lit/ds/symlink/lm3900.pdf
LM4951 http://www.ti.com/lit/ds/symlink/lm4951.pdf
LM78XX http://www.ti.com/lit/ds/symlink/lm7800.pdf
LM13700 http://www.ti.com/lit/ds/symlink/lm13700.pdf

LT1167 http://cds.linear.com/docs/en/datasheet/1167fc.pdf
LT3032 https://www.analog.com/media/en/technical-documentation/data-sheets/3032ff.pdf
LTC1068 http://cds.linear.com/docs/en/datasheet/1068fc.pdf
LTC2282 http://cds.linear.com/docs/en/datasheet/2282fb.pdf
LTC6900 http://cds.linear.com/docs/en/datasheet/6900fa.pdf
LTC6950 http://cds.linear.com/docs/en/datasheet/6950f.pdf
LTC6990 http://cds.linear.com/docs/en/datasheet/6990fc.pdf

555
MAX4030 https://datasheets.maximintegrated.com/en/ds/MAX4030E-MAX4031E.pdf
MAX4200 https://datasheets.maximintegrated.com/en/ds/MAX4200-MAX4205.pdf
MAX4206 https://datasheets.maximintegrated.com/en/ds/MAX4206.pdf
MF10 http://www.ti.com/lit/ds/symlink/mf10-n.pdf
NE555 http://www.ti.com/lit/ds/symlink/ne555.pdf
NE5534 http://www.ti.com/lit/ds/symlink/ne5534.pdf
PA05 https://www.apexanalog.com/resources/products/pa05u.pdf
PA85 https://www.apexanalog.com/resources/products/pa85u.pdf
PCM5242 http://www.ti.com/lit/ds/symlink/pcm5242.pdf

556
Appendix B

                          Standard Component Sizes

Passive components (resistors, capacitors and inductors) are available in standard sizes. The tables below are for
resistors. The same digits are used in subsequent decades up to at least 1 Meg ohm (higher decades are not
shown). Capacitors and inductors are generally not available in as many standard values as are resistors.
Capacitors below 10 nF (0.01 F) are usually available at the 5% standard digits while larger capacitances tend
to be available at the 20% standards.

                         5% and 10% standard values, EIA E24 and EIA E12

                                                 10% values (EIA E12) are bold
                            20% values (seldom used) are every fourth value starting from 10

                                                   (i.e., every other 10% value)

            10 11 12 13 15 16 18 20 22 24 27 30
            33 36 39 43 47 51 56 62 68 75 82 91

                         1% and 2% standard values, EIA E96 and EIA E48

                                                 2% values (EIA E48) are bold

           10.0 10.2 10.5 10.7 11.0 11.3 11.5 11.8 12.1 12.4 12.7 13.0
           13.3 13.7 14.0 14.3 14.7 15.0 15.4 15.8 16.2 16.5 16.9 17.4
           17.8 18.2 18.7 19.1 19.6 20.0 20.5 21.0 21.5 22.1 22.6 23.2
           23.7 24.3 24.9 25.5 26.1 26.7 27.4 28.0 28.7 29.4 30.1 30.9
           31.6 32.4 33.2 34.0 34.8 35.7 36.5 37.4 38.3 39.2 40.2 41.2
           42.2 43.2 44.2 45.3 46.4 47.5 48.7 49.9 51.1 52.3 53.6 54.9
           56.2 57.6 59.0 60.4 61.9 63.4 64.9 66.5 68.1 69.8 71.5 73.2
           75.0 76.8 78.7 80.6 82.5 84.5 86.6 88.7 90.9 93.1 95.3 97.6
Appendix C

                             Answers to Selected Review Questions

                                               Chapter 1

1) What are the advantages of using the decibel scheme over the ordinary scheme?

The log-based decibel represents ratios of power. As such, decibel-based gains and signals add instead of
multiply, simplifying calculations. Further, the decibel scheme tends to focus on the magnitude of change and
relates well to the human hearing mechanism.

3) What does the third letter in a decibel-based signal measurement indicate (as in dBV or dBm)?

The third letter represents the reference level. dBV is referenced to 1 volt whereas dBm is referenced to 1
milliwatt.

5) What is a lead network? What general response does it yield?

At a minimum, lead networks are comprised of a single capacitor (or inductor) and a resistor. An example is a
coupling capacitor. Lead networks block DC and low frequencies, allowing only higher frequencies to pass
through. The phase response at low frequencies approaches +90 degrees and approaches 0 degrees at high
frequencies (hence its name).

7) What do the terms f1 and f2 indicate about a system's response?

f1 refers to the lower half-power or -3 dB frequency. f2 refers to the upper half-power or -3 dB frequency. f2 - f1
defines the system's bandwidth. f1 and f2 are alternately referred to as corner or break frequencies as well.

9) What are the phase changes produced by individual lead and lag networks?

A single lead network varies from +90 degrees at low frequencies to 0 degrees at high frequencies (+45 degrees
at the break frequency). A single lag network varies from 0 degrees at low frequencies to -90 degrees at high
frequencies (-45 degrees at the break frequency).

11) How do multiple lead or lag networks interact to form an overall system response?

The response of each network is graphically added to the midband response of the system in order to achieve the
overall system response. Rolloff slopes will be additive as will the ultimate phase changes.
13) What is common-mode rejection?

Common-mode rejection is the ability of a differential amplifier to ignore an identical signal (i.e., a common-
mode signal) placed on both inputs. The ratio of the differential gain to the common mode gain yields the
common mode rejection ratio (CMRR). The ideal value for CMRR is infinite.

15) What is the advantage of using an active load?

An active load maximizes voltage gain by forcing all signal current to the following stage.

                                               Chapter 2

1) What is an op amp?

An op amp is a multi-stage amplifier. The circuit is usually DC coupled and is packaged as a single unit. It can
be used as is or as part of a much larger system.

3) What is the typical stage layout of an op amp?

An op amp is a multi-stage amplifier typically consisting of a differential input stage, voltage gain stages, and a
class B output stage.

5) What comprises the final stage of a typical op amp?

The output stage is usually a class B or class AB voltage follower.

7) What is a comparator, and how might it be used?

A comparator is in essence a very high gain differential amplifier used as an interface between analog signals
and digital logic. Even very small differences between the input signals is enough to force the output into either
positive or negative saturation. Thus, a comparator is used to determine if one signal is more positive than the
other, with the output saturation states corresponding to a simple true/false answer.

9) What is a mask, and how is it used in the construction of IC op amps?

A mask is used to expose only certain areas of a wafer to the dopant. In this way, other areas are masked or
shielded and are not affected. A series of masks will be used to create transistors. For example, one mask may
be used to prepare transistor emitter areas.

11) What are the advantages of monolithic IC construction?

Because an entire circuit is made at once, monolithic ICs tend to be inexpensive and very reliable.
                                               Chapter 3

1) Give two examples of how negative feedback is used in everyday life.
Maintaining a constant speed while driving, walking in a straight line, etc.
3) What is meant by the term "Sacrifice Factor"?
Sacrifice factor indicates the amount of gain given up. It is equal to the difference between the open-loop and
closed loop gains in decibels.
5) Name the different negative feedback connections (i.e., variants or forms).
Series-parallel (VCVS or ideal voltage amplifier), parallel-series (CCCS or ideal current amplifier), parallel-
parallel (CCVS or ideal current-to-voltage transducer), and series-series (VCCS or ideal voltage-to-current
transducer).
7) What circuit parameters won't negative feedback effect?
Noise and device-dependent parameters such as output clipping level.

                                               Chapter 4

1) What forms of feedback are used for the inverting and non-inverting voltage amplifiers?
The inverting form uses a modified parallel-parallel scheme whereas the non-inverting form uses series-parallel
negative feedback.
3) What form of feedback is used for the inverting current amplifier?
Parallel-series feedback is used in the inverting current amplifier.

5) What is virtual ground?
A virtual ground is a point that is very close to 0 volts. It is normally found at the inverting input of parallel-
input feedback forms and behaves as an ideal current summing node.

7) How can output current by increased?
Output current can be increased by adding a discrete class B follower stage after the op amp and wrapping it
inside of the feedback loop. The op amp delivers current to the follower, which is then responsible for delivering
final load current.
9) What operational parameters change when a circuit is set up for single supply biasing?

All parameters stay unchanged with the exception of the system input impedance (set by the input divider
network), low frequency response (set by coupling and feedback capacitors), and the current drawn (additional
draw through the bias network).

11) What is meant by the term "floating load"?

A floating load is one that is not tied to ground at one end.

                                               Chapter 5

1) DefineGain-Bandwidth product. What is its use?

Gain-Bandwidth product is also known as funity and is defined as the frequency at which the open-loop response
falls to unity (0dB). It is useful because the product of closed-loop noise gain and f2 must equal funity. It can be
seen, therefore, that gain can be traded for bandwidth and vice versa.

3) What happens if two or more stages share the same break frequency?

For lower breaks, the combination will produce an f1 higher than the individual break frequencies. For upper
breaks, the combination will produce an f2 lower than the individual break frequencies.

5) How is power bandwidth determined?

Power bandwidth (fmax) is proportional to slew rate and inversely proportional to peak sine amplitude. fmax =
Slew Rate/(2Vpeak).

7) What are the advantages and disadvantages of non-compensated op amps?

On the down side, non-compensated amplifiers require external compensation circuits (a capacitor at minimum).
The advantage is that the frequency response and slew rate can be optimized for a given gain.

9) What causes DC offset voltage?

Output offset voltage is caused by less-than-perfect matching of the internal components of the op amp, as well
as in the surrounding feedback network.

11) What is CMRR?

CMRR stands for Common Mode Rejection Ratio. It is a measure of how well the op amp suppresses identical
signals on the inputs relative to differential input signals.
13) What parameters describe an op amps noise performance?

In general, noise is proportional to temperature, bandwidth, and resistance. The key parameters to look for on an
op amp's data sheet are the input noise voltage density and input noise current density.

                                               Chapter 6

1) What are the advantages of using instrumentation amplifiers versus a simple op amp differential
amplifier?

Instrumentation amplifiers generally offer very high gain, isolated high input impedances for both inputs, and
superior common-mode rejection when compared to a single op amp based differential amplifier.

3) What are the advantages of using programmable op amps?

The device is able to go into a "power down" or "sleep" mode and thereby drastically reduce power
consumption. Further, the performance can be fine-tuned against power consumption.

5) Give at least two applications for a high-power op amp.

Direct motor drive and audio power amplifiers.

7) What is an OTA?

OTA stands for Operational Transconductance Amplifier. The transconductance (and hence the gain) of the
device is set by an external control current, IABC.

9) Give an application that might use an OTA.

Any application requiring a controlled-gain amplifier would suffice, such as an audio compressor.

11) Describe how a Norton amplifier achieves input differencing.

Input differencing is achieved through the use of a current mirror. The input circuit generates the difference
between the input currents by subtracting the current presented to one input (via the current mirror) from the
other input current.

13) Explain why a current feedback amplifier does not suffer from the same gain-bandwidth limitations
that ordinary op amps do.

The construction of the current feedback amplifier differs considerably from that of an ordinary op amp. The
current feedback amplifier does not rely on negative feedback to maintain its inverting and non-inverting inputs
at the same level; rather a unity gain buffer is used. Also, the output is modeled as a current-controlled source
rather than as a voltage-controlled source. This combination leads to a situation where the feedback factor Ò
does not enter into the gain equation and thus to a first approximation, the feedback factor (via sacrifice factor)
does not influence the closed-loop gain.

                                               Chapter 7

1) What are the advantages of active rectifiers versus passive rectifiers?

Active rectifiers have the primary advantage of accurately rectifying small signal levels. They also exhibit a
high input impedance and a low output impedance.

3) What is a peak detector?

A peak detector produces an output that is proportional to the peak value of the input waveform. It can be used
as an envelope detector in AM systems.

5) What is the function of a clamper?

A clamper adds or subtracts a DC potential to an input signal in order to shift it to a new level, for example,
making the entire waveform positive by shifting it up.

7) What is a transfer function generator circuit, and what is its use?

A transfer function generator has an arbitrary input/output function curve. In comparison, the function for an
amplifier is a straight line (the slope of which indicates the gain). Function generation circuits can be used to
create some desired transfer characteristic or to pre-distort or compensate for nonlinearities that exist elsewhere,
creating an overall linear system response.

9) What is a Schmitt trigger?

A Schmitt trigger is a comparator with hysteresis. In effect there are different threshold levels depending on the
current output state. The circuit winds up being relatively immune to generating false outputs due to input noise.

11) What are the advantages of dedicated comparators such as the LM311 versus ordinary op amp
comparators?

Dedicated comparators are usually designed to produce very fast switching times. Further, external connections
are usually available for logic interfacing, strobe, and so forth.

13) What is the effect of passing a signal through a log or anti-log amplifier?

A log amplifier produces an output signal that is proportional to the log of the input. This has the effect of
compressing the signal. In contrast, the anti-log amplifier produces a signal that is proportional to the anti-log of
the input, producing an expansion of the input signal.
15) How might a multiplier be used?

A multiplier can be used in a variety of ways. In the simplest case, the multiplier can be used as a controlled
gain amplifier. It can also be used for mathematically squaring a signal (e.g., for RMS calculations) or for other
mathematical operations such as division.

                                               Chapter 8

1) What is the function of a voltage regulator?

A voltage regulator is used to turn the fluctuating output of a rectified and filtered AC power signal into a
smooth and stable DC level.

3) Why do regulators need a reference voltage?

Regulators need something to measure the output voltage against. Without a reference, there is no way of
determining the present output level.

5) What are the main advantages of using linear regulators versus switching regulators?

Linear regulators are relatively simple to design and use. They also exhibit very fast transient response and do
not radiate interference signals as switching regulators do.

7) What is the function of a pass transistor?

The primary function of a pass transistor is that of a control element. In a linear regulator it is used to effectively
absorb the difference between the unregulated input and the desired output. In a switching regulator it is used as
a controlled switch that allows current pulses through which in turn, charge the reactive elements and produce
the desired output.

9) How can fixed "3-pin" regulators be used to regulate at other than their rated voltage?

The normal "ground" pin can be tied to the middle of a voltage divider connected across the output. In this way,
the regulator only "sees" a portion of the output voltage.

11) Explain the correlation between the output current demand and the pulse-width modulator used in
switching regulators.

The average area of the PWM current pulses is equal to the DC current demand. If the current demand goes up,
the pulses will widen to keep the equality. If the current demand drops, the opposite happens and the pulses will
narrow.
13) What is meant by the term thermal resistance?

Thermal resistance is a measure of how easily an item can transfer heat to its surrounding environment. A low
thermal resistance means that the item conducts heat easily.

15) What are the general rules that should be considered when using heat sinks?

Use a heat sink size appropriate for the target power dissipation. Do not block air flow around heat sinks. Use a
modest amount of heat sink grease (more is not better). Excessive torque is not required on the mounting
hardware. Use insulators to prevent the heat sink from becoming electrically "live". In high power situations,
consider using forced air cooling (fans).

                                               Chapter 9

1) How does positive feedback differ from negative feedback?

Positive feedback reinforces change. It causes instability and, hence, oscillation. In contrast, negative feedback
tends to create a stabilizing effect on amplifiers.

3) Explain the operation of the Wien bridge op amp oscillator.

The oscillator exploits the Wien bridge, consisting of a series RC leg, a parallel RC leg, and a pair of resistors
making up the other half of the bridge. At only one frequency will the bridge be in balance; that is, the phase
shift produced by the RC legs will be 0 degrees. As long as sufficient gain is available to overcome the loss of
the RC portion, the circuit will oscillate at this frequency.

5) How might a square wave be generated from a sinusoidal or triangular source?

Simply pass the output of the sine or triangle wave generator into a comparator.

7) What factors contribute to the accuracy of a Wien bridge oscillator's output frequency?

Primarily, the accuracy of the Wien bridge output frequency is set by the accuracy of the timing capacitors and
resistors. It is also influenced by any extra phase shift produced by the op amp.

9) Draw a block diagram of a PLL and explain its basic operation.

(See text for block diagram.) The PLL consists of three major components: A VCO, a phase comparator, and a
loop filter. Negative feedback is used to get the VCO to track the input signal. The phase comparator has two
inputs: one for the input signal and the other for the VCO output. It produces an error signal that is proportional
to the phase difference between these two signals. A control voltage is derived from this signal and is used to
drive the VCO. The loop will be stable as long as the error signal remains small.
11) Give at least two applications for a fixed frequency oscillator or VCO.
Fixed frequency: A local or carrier frequency generator in an AM or FM system, audio calibration oscillator, etc.
VCO: Music synthesizer, tracking generator in a spectrum analyzer, etc.
13) Explain the difference between astable and monostable operation of a timer.
Monostable operation is one-shot or single event. Something has to occur in order to trigger the pulse. Astable
operation is continuous. In other words, a non-stop waveform is being generated.

                                              Chapter 10

1) What is the basic function of an integrator?
Integrators find the "area under the curve" of the input waveform.
3) What is the function of the capacitor in the basic integrator and differentiator?
The capacitor has a differential characteristic between voltage and current, i = C dv/dt. When placed in the
feedback loop, this gives rise to the differential (C as Ri) or the integral (C as Rf) of the input.
5) What practical modifications need to be done to the basic integrator, and why?
The basic integrator has very high DC gain and will eventually saturate due to offsets. For this reason, a lower
gain limit is imposed. This has the side effect of producing a lower frequency limit of accurate integration.
7) What are the negative side effects of the practical versus basic integrator and differentiator?
Primarily the additional components reduce the range of frequencies that can be accurately processed. In the
case of the integrator, a lower limit is created, and in the case of the differentiator, an upper limit is established.
9) What are some of the advantages and disadvantages of the analog computer versus the digital
computer?
One advantage of the analog computer is its immediacy; a technician or engineer can "tweak the knobs" in real-
time if desired. An advantage of using a digital computer is its accuracy and repeatability.
                                              Chapter 11

1) What are the four main types of filters?

High-pass, low-pass, band-pass, and band-reject (or notch).

3) What are the disadvantages of active filters versus passive filters?

Active filters require DC power, their frequency response is limited by the active circuitry, and they do not
handle large amounts of output power (usually).

5) Name several popular filter alignments.

Bessel, Butterworth, Chebyshev, Elliptic (Cauer).

7) Which alignment should be used if linear phase response is of particular importance?

The Bessel alignment is linear phase.

9) When are the "3 dB down" and critical frequencies of a filter identical?

fc and f3dB are identical when using a Butterworth alignment.

11) Explain where each of the following band-pass filters would be appropriate: high-pass/low-pass
cascade, multiple-feedback, and state-variable.

The cascade is appropriate for wide bandwidth applications. Multiple-feedback is appropriate for narrow
bandwidth applications with modest Qs of 10 or less. For higher Q response, the state-variable is preferred.

13) Briefly explain the operation of an adjustable bass equalizer.

In essence, an inverting voltage amplifier is used. A potentiometer is situated between Ri and Rf so that the gain
is a function of the potentiometer's wiper arm. The feedback network is frequency sensitive due to the inclusion
of a capacitor (or capacitors). At high frequencies, the capacitor shorts out the potentiometer leaving the original
Ri and Rf, and a gain of unity.

15) What are the advantages and disadvantages of switched-capacitor ICs versus the more traditional op
amp approach?

A primary advantage is the simplicity of design. Usually, very few additional parts are required to create
complex filters. On the down side, switched-capacitor filter ICs exhibit limited frequency range compared to the
more general op amp approach and there is also the possibility of clock noise leaking into the output signal.
                                              Chapter 12

1) What is PCM?

Pulse Code Modulation. This is the technique of measuring an input signal at regular intervals and storing the
results as a sequence of digital words.

3) What is quantization?

Quantization is the process of measuring and thus defining the signal via a series of discrete steps.

5) Define Nyquist frequency, and discuss the importance of this parameter.

The Nyquist frequency is the highest frequency that can be sampled and recovered without concern of aliasing.
The sample rate must be at least twice the Nyquist frequency, although it is normally somewhat more than
twice. This extra factor is due to the fact that low-pass anti-aliasing filters do not roll-off infinitely fast, and this
transition band must be taken into consideration. In essence, the Nyquist frequency defines the upper limit
frequency of the system.

7) Explain the difference between integral nonlinearity and differential nonlinearity.

Integral nonlinearity is the worst case offset between the actual and ideal conversions for all possible outputs.
Differential nonlinearity is also known as relative-adjacent error. It defines the maximum output deviation
between two adjacent input words relative to the ideal 1 LSB. For the ideal case, both the integral and
differential nonlinearity would be 0 LSB. If the differential nonlinearity is less than 1 LSB, the system response
will be monotonic (i.e., increasing digital words always produce a higher analog output).

9) What is the purpose of a track-and-hold amplifier?

The track-and-hold is used to keep the signal to be measured constant during the measurement interval.

11) Give several examples of possible DSP functions.

Signal compression, filtering, waveform shaping, Fourier Analysis, noise reduction, etc.
Appendix D

                           Answers to Selected Numbered Problems

                                               Chapter 1

1) A) 10 dB B) 19 dB C) 26.99 dB D) 0 dB E) -6.99 dB F) -15.23 dB

3) 33 dB

5) G = 501, Pout = 12.53 W

7) A) 1.06 B) 1 C) 199.5 D) 3.43 E) 0.398 F) 0.188

9) A = 8.57 A' = 18.66 dB

11) A) 0 dBW B) 13.6 dBW C) 8.13 dBW D) -7 dBW E) -26.4 dBW F)30.8 dBW
G) -43.5 dBW H) -65.2 dBW I) -172.5 dBW

13) A) 150 dBf B) 163.6 dBf C) 158.1 dBf D) 143 dBf E) 123.6 dBf F) 180.8 dBf
G) 106.5 dBf H) 84.8 dBf I) -22.5 dBf

15) G'total = 28 dB, G = 631

17) For P'in = 4 dBm: output stage 1 = 6 dBm, stage 2 = 0 dBm, stage 3 = 15 dBm.
For P'in = -34 dBm: output stage 1 = - 24 dBW, stage 2 = -30 dBW, stage 3 = -15 dBW.

19) a. 200 mW

21) V'out = 21 dBV, 21 dBV = 11.2 V (final output)
For stage 1: 4 dBV = 1.58 V
For stage 2: 9 dBV = 2.82 V

23) a. 15 V

25) At 50 kHz: -0.022 dB, -4.09 degrees
At 700 kHz: -3 dB, -45 degrees
At 10 MHz: -23.1 dB, -86 degrees
Tr = 500 sec

27) The amplitude portion does not change. Phases are: At 30 kHz -188.5 degrees, at 200 kHz -225 degrees,
at 1 MHz -258.7 degrees
29)                                                                             20 kHz  2 MHz

                   A'v                                                      0°                    f
                                                                       -180°
                  18 dB
                                                                       -270°
                                                  200 kHz
                                                           f

31) At 4 kHz: 78.7 degrees, at 20 Hz: 45 degrees, at 100 Hz: 11.3 degrees

33)

     A'v                                                   

     32 dB                                                 90°

                                                           45°

            20 Hz                                                          0°   2 Hz 20 Hz 200 Hz f

                                                           f

35) Net gain at 20 kHz = 35.87 dB
Net phase at 20 kHz = 51.7 degrees
At 100 kHz: phase = -5.1 degrees, A'v = 40 dB
At 800 kHz: phase = -70.5 degrees, A'v = 30.5 dB

37)

       A'v

            30 kHz 250 kHz 300 kHz f
39)

             A'v

           36 dB

                       100 kHz 750 kHz 1.2 MHz f

41) Each lag network rolls off at 20 dB/decade for a 60 dB/decade total (i.e., above 1.2 MHz).
43) r'e = 47 ohms, A'v = 61.9
45) 0.254 sin(21000t)
47) 1.656 sin(22000t)
49) 0.775 V
51) 360 W
53) 71.5 dBV
55) Greater than 30 Hz.

                                         Chapter 2

1) A) Vout is unknown B) -Vsat C) +Vsat
3) A) -Vsat B) +Vsat C) -Vsat D) -Vsat
5)                                                        t

                    2 V  Vref = -1 V

               Vin                                        t

              +10.5 V

             Vout

               -10.5 V

7) 55 degrees C
9) 4.967 V
11) 125 ohms

                                               Chapter 3

1) S = 100 at low frequencies, S = 10 at 1 kHz
3) Acl = 19.96, Approximate Acl = 20 At 1 kHz, the approximate Acl = 20, the exact value = 19.6
5) S = 1000, f2sp = 25 kHz
7) The margins are 60 degrees and 12 dB to spare
9) Zincl = 2 M ohms, Zocl = 2.5 ohms
11) S = 200
13) 5 sin 2500t
15) Typical values might be Ri = 1 k ohm, Rf = 9 k ohms.
17) A) Decreased high frequency gain. B) Gain increase for high frequencies.
C) The output signal will appear to be clipped, in the same manner as an overdriven amplifier.
                                      Chapter 4

1) Av = 7.67 Zin = 470 k
3) Av = 10 Zin = infinite
5) -9.7 dBV
7) -660 mV
9) Ri is 20 k, Rf = 50 k
11) Iout = 100 A (1/3 full scale)
13) R = 333.3 ohms
15) Ioutmax = 2.29 mA Iinmax = 208 A
17) R'i = 3.33 k, R'f = 16.67 k
19) 0 dB is a gain of one.

21) Rf = 50 k ohms
23) Ai = -20, Ri = 19Rf One possibility is:
25) R = 1 k ohm, Iout = 200 A
27) The figure below is one possible answer.
29)

31) For C1 dominant (C2 and C3 increased 10X) C1 = 3.18 F
C2 = 7.23 F
C3 = 1.45 F
33) Amax = 9.15 Amin = 6.45
35) The figure below is one possible answer.

37) 1.88 V to 2.12 V
39) Set Av = 20

41) The loss is approximately 0.0119 (ignoring loading and phase angle)
43) Av = 11, Zin approaches infinity.
                                               Chapter 5

1) An = 6, f2 = 667 kHz
3) An = 6, funity = 1.5 MHz
5) fmax = 239 kHz
7) SR = 1.26 V/s
9) SR = 6.79 V/s
11) SR = 1.25 V/s
13) Voutoffset = ±4 mV (approximately)
15) Voutripple = 500 V
17) Voutnoise = 16.8 mV, Input referred noise = 840 V
19) Voutnoise = 290 V, S/N = 6901 (76.8 dB)
21) The result is a 1.25 V peak 100 kHz triangle wave.

                                         actual

                                                       t

                         desired

23) Roff = 952 ohms, Vdrift = ±7.49 mV
25) C = 2.4 F
27) For a single stage, a 411 will do. For gain, set Rf = 49·Ri
29) Try 2 stages with equal gain. A = 12.25 each. funity = 7.35 MHz, 318s will do. Rf = 11.25·Ri (A 3 stage
design is also possible.)
31) En = 5.68 mV RMS
33) Total offset = ±28.5 mV
35) 741 stage 1, f2 = 1 MHz
411 stage 2, f2 = 667 kHz
318 stage 3, f2 = 750 kHz
System f2 is approximately equal to 667 kHz.

                                               Chapter 6

1) Desired output = 200 mV, Hum = 4.5 mV
3) Vout = 1.69 V
5) Iset = 14.5 mA
7) Iset = 14.75 mA, Av = 10.4, SR = 0.3 V/ms, funity = 250 kHz
f2 = 24 kHz, fmax = 4.77 kHz
9) C >= 1 F
11) Pd = 800 mW
13) Iabc = 218 mA
15) C = 212 nF
17) Set Ri to 100 k ohms. Rf = 400 k ohms, Rb = 800 k ohms, C = 63.7 nF
19) Rf = 270, Rg = 270 ohms
21)

23) As outlined in textbook Figure 6.15, but add a capacitor and 1080 ohm in series from pin 1 to 8.
25) Iabc = 150 A, gm = 3 mS, net gain = 0.924

.77 V

       .462 V

                             t

minor variation = 300 kHz
major variation = 1 kHz
1)                            Chapter 7

    2 V                       t
                              t
            10 msec
                                    t
3)                         t

   2.5 V

5) 1 V DC
7)

       2 V

9)          Vin      Vout

      .1 V
11)

       4.6 V

                                                                          t

      -4.6 V

13)

                                 Vout
                                   +
                     -6.6

                                   6.4 V

               -6.6                                   + Vin

     -                                           -6.6

                           -6.4 V

                                      -

15) 8.97 V peak square wave

17)

                           Vout
                                   +
                     -4.5

                           -2.5

                                          2.9 V        + Vin

     -  -2.9 V

                                                 -4.5
19)

     -4.87  Vout
              +
                  -6.67

                                                     -10

     - + Vin

                               -4.6 V
                               -6.4 V

                                  -

21) ±10.4 V
23) Vout = 5 V
25) Vout = -72.9 mV
27) Vout = 0.2 sin 21000t, 0.4 sin 21000t, 1 sin 21000t
29) Vout = -12.5 sin 22000t
31) Rl = 500 k ohms
33) Rf = 60 k, Ri = 6 k, Ra = 6 k
35) R1 = 20 k, R2 = R6 = 5 k, R4 = R8 = 2.87 k
R3 = R7 = 34.1 k, R5 = R9 = 13.7 k
37) Ri = 22.1 k
39) R1 = R2 = 1.35 k
43) Use Figures 7.41 and 7.42 as a guide. Rf = Ri = 10 k, R6 = R2 = 90 k, R8 = R4 = 72k, R3 = R7 = 785 k,
R5 = R9 = 279 k
45) Threshold = ±2.88 V  Vout
                                     t
     10 V
                                Vin
   2.88 V
      2 V                    Chapter 8

   -2.88 V
      -6 V

1) Pd = 9 W
3)

5) Pd = 3.86 W

7) R3 = 10 k, R2 = 35.5 k, R1 = 5.85 k, beta >= 25

9) R2 = 2064 ohms

11) Follow figure 8.11a for this.
For 5 V R2 = 720 ohms, for 12 V R2 = 2064 ohms, for 15 V R2 = 2640 ohms

13) Rsc = 6.5 ohms The general form is shown in textbook Figure 8.14.2
Choosing R2 = 10 k, R1 = 2.59k, R3 = 2.06 k
15) Rpos = 9.86 ohms Rneg = 8.43 ohms. Refer to textbook Figure 8.19.
17) Choose R2 = 10 k, R1 = 40 k, R3 = 0.15 ohms, C1 = 1 nF, C3 = 20 pF, L1 = 278 H,
C2 >= 26.6 F
19)

21) Pd = 8.33 W

                                               Chapter 9

1) fo = 2.4 kHz
3) fo-max = 4081 Hz, fo-min = 371 Hz
5) fo = 229 Hz
7) fo = 200 kHz
9) 10 MHz to 1 MHz
11) 3906 Hz to 11,719 Hz
13) 4687 Hz to 10,937 Hz
15) Using Vsat = 13.5V; Vthres = 9V, fo = 10.3 kHz
17) 96.15 kHz to 224.4 kHz
19) R3 = R4 = 8.47 k ohms
21) R3 = R4 = 81.2 ohms, P1 = P2 = 730.8 ohms
23) R2 = 1.5 k, Rb1 = 2.2 k, Rb2 = 1.8 k (all else unchanged)
25) C1 = 4.59 nF, C2 = 459 pF, C3 = 45.9 pF
27) R = 3938 ohms
29) C = 5.56 nF
31) R2/R3 = 0.37:1
33) Rset = 40 k
35) RVCO = 100 k, RSET = 100 k, R1 = 976 k, R2 = 182 k
37) Increase all tuning capacitors by 71.7.
39) Feed the sine wave into a comparator that has a variable reference.
41) Feed the output through a potentiometer and then through one channel of a summing amplifier. In a second
channel, feed in a DC value derived via a potentiometer connected between the power supplies.
43) The output of the first circuit is a triangle wave centered around ground. The addition of the offset pushes
the signal negatively so that it's most positive peak is 0 volts. For example, if the triangle is 2 volts peak, the
result is a triangle that varies from -4 volts to 0 volts. This is applied to the resistor that programs the master
oscillator frequency, therefore, the output of the master oscillator varies as a triangle, moving smoothly between
the upper and lower frequency extremes (in this case that's a 5:1 ratio because SET is +1 volt).

                                              Chapter 10

1) A 4.17 Vpp triangle at 1 kHz
3) Vout = 0.663 sin 210000t
5) A = -20
7) A 6.06 mVpp triangle at 50 kHz
9) Vout eventually reaches -1 V
11) An 800 mV peak-to-peak square wave at 100 Hz
13) Vout = 2.26 sin 260t
15) Vout = - 0.04t
17)

                                   Vin

                           Vout t

19) A 150 mV peak square wave at 2.5 kHz
21) R = 1 k ohm
23) Cf = 31.8 nF
25) Ri = 50 ohms, C = 31.8 nF, Rf = 3774 ohms, Cf = 422 pF
27) Vout(t) = 6.37 n=1 1/((2n-1)2) cos 2500(2n-1)t
29) Vout(t) = -Rf/L Vin(t)dt
31) Vout = 0.314 n=1 1/(2n-1) sin 2500(2n-1)t

                                              Chapter 11

1) 500 Hz: 0 dB 1 kHz: 3 dB 2 kHz: 13 dB 4 kHz: 24 dB
3) 200 Hz: 10 dB 500 Hz: 3 dB 2 kHz: 0.2 dB
5) Butterworth: 0 dB Bessel: 0.75 dB 1 dB Chebyshev: 1 dB
7) Order 2: 15 dB 3: 20 dB 4: 24 dB 5: 27 dB 6: 30 dB
9) Order 2: 1.75 dB 3: 2.5 dB 4: 0 dB 5: 2.5 dB 6: 2 dB
11) Butterworth: 0 dB Bessel: 1 dB 1 dB Chebyshev: 3 dB
13) Butterworth: 4th (23 dB) 1 dB Chebyshev: 3rd (26 dB)
3 dB Chebyshev: 3rd (28 dB)
15) BW = 1.5 kHz, fo = 8.72 kHz, Q = 5.81
17)
19)
21)
23)
25)
27)
29)

33) Cascade three second order HP stages
Stage 1: C = 345 nF, R1 = 6.57 k, R2 = 15.22 k
Stage 2: C = 729 nF, R1 = 2.28 k, R2 = 44 k
Stage 3: C = 972 nF, R1 = 625 ohms, R2 = 160 k

                                                Chapter 12

1) 1024
3) 60.2 dB, 84.3 dB (for 16384)
5) 20 ms
7) 11.1 ms
9) 20 k bytes per second
11) 403.2 M bytes for stereo
13) fn = 20.8 kHz
15) 4 mV, 4.09 V
17) A: 400 s B: 3.2 ms C: 102.4 ms
19) A:

B: 9 bits
C: fs = 960 kHz
D: fc = 400 kHz
E: Subranging/pipelined
F: LTC2282
21) In C, if A is the start of the data array and N is its size,
Max = 0;
for( i=0; i<N; i++ )
{

          Temp = abs(*A++);
          if( Temp > Max )

                     Max = Temp;
}

                                                 Image from Psychology Doggie cartoon © Jim Fiore, All Rights Reserved
